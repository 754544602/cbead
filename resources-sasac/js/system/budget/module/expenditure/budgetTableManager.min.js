var budgetTableManager={init:function(){$("select").niceSelect();$('#budgetYearInput').calendar({speed:0,dateFmt:"yyyy",nowData:true});$('.add-budget-year').click(function(){budgetTableManager.clickYearButton()});budgetTableManager.getBudgetYear();budgetTableManager.getUtilName()},getBudgetYear:function(){$.ajax({type:"post",url:"budget/bm/getBooksYear",async:true,success:function(data){var datas=data.data;if(data.flag==0){$.each(datas,function(i,n){$('select.budget-year').append('<option value="'+n.booksYear+'">'+n.booksYear+'</option>')});$("select.budget-year").niceSelect();budgetTableManager.divPage($(".budget-year").val());$("select.budget-year").change(function(){var thisYear=$(this).val();budgetTableManager.divPage(thisYear)})}}})},getUtilName:function(){$.ajax({type:"post",url:$yt_option.base_path+'budget/table/getBudgetClassifyDataByParams?tableKey=coso_classify_unit_main',async:false,data:{},success:function(data){var datas=data.data.rows;if(data.flag==0){var numOptions='<option value="">请选择</option>';$('#professional').empty();if(datas.length>0&&datas!=undefined&&datas!=null){$.each(datas,function(i,n){numOptions+='<option value="'+n.code+'" sel-val="'+n.name+'">('+n.num+')'+n.name+'</option>'});$('#professional').append(numOptions)}$('#professional').niceSelect()}}})},divPage:function(budgetYear){$.ajax({type:"post",url:"budget/bm/getBooksList",async:true,data:{booksYear:budgetYear},success:function(data){var datas=data.data;var htmlDiv=$('.plan-list');htmlDiv.empty();var dStr="";if(data.flag==0){var datas=data.data;$.each(datas,function(i,n){dStr+='<div class="plan-list-item" booksId="'+n.booksId+'"><span class="plan-list-title span-font-bold">单位预算表（'+n.booksYear+'）</span><div class="title-line"><div></div></div><table style="border: 0px;" class="plan-list-table"><tbody><tr><td style="width: 90px;" class="span-font-bold"><span style="letter-spacing:5px;">预算年</span>度：</td><td class="budget-annual">'+n.booksYear+'</td></tr><tr><td style="width: 90px;" class="span-font-bold"  valign="top"><span style="letter-spacing:5px;">预算单</span>位：</td><td class="budget-unit" unitNum="'+n.unitNum+'">('+n.unitAsNum+')'+n.unitName+'</td></tr><tr><td style="width: 90px;" class="span-font-bold"><span style="letter-spacing:43px;">状</span>态：</td><td class="budget-state" state="'+n.state+'">'+n.stateName+'</td></tr></tbody></table><div class="button-box"><button class="yt-option-btn yt-common-btn check-details" style="margin-left: 35px;">查看详情</button>';if(n.state==3||n.state==4){dStr+='<button class="yt-option-btn yt-cancel-btn basis-set" style="margin-left: 35px; color:#bbbbbb;" disabled="disabled">基础设置</button>'}else{dStr+='<button class="yt-option-btn yt-cancel-btn basis-set" style="margin-left: 35px;">基础设置</button>'}dStr+='</div></div>';dStr=$(dStr).data("yearData",n);htmlDiv.append(dStr)});budgetTableManager.basisClick();budgetTableManager.detailsClick()}else{$yt_alert_Model.prompt(data.message)}}})},clickYearButton:function(){sysCommon.showModel($("#budgetAlert"));$('#budgetAlert.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){budgetTableManager.clearAlert($("#budgetAlert"));sysCommon.clearValidInfo($("#budgetYearInput"));sysCommon.clearValidInfo($(".professional-select"));$("#budgetAlert.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$('#budgetAlert .yt-model-sure-btn').off().on('click',function(){var valid=$yt_valid.validForm($("#budgetAlert"));if(valid){var budgetYearInput=$('#budgetYearInput').val();var professional=$("#professional").val();$.ajax({type:"post",url:"budget/bm/createBooksInfo",async:true,data:{booksYear:budgetYearInput,unitNum:professional},success:function(data){var datas=data.data;if(data.flag==0){$yt_alert_Model.prompt('创建年度预算成功');sysCommon.closeModel($("#budgetAlert"));budgetTableManager.divPage($(".budget-year").val());budgetTableManager.getBudgetYear()}else{$yt_alert_Model.prompt('创建年度预算重复')}budgetTableManager.clearAlert($("#budgetAlert"));sysCommon.clearValidInfo($("#budgetYearInput"));sysCommon.clearValidInfo($(".professional-select"))}})}})},basisClick:function(){$('.button-box').on('click','.basis-set',function(){var booksObj=$(this).parents(".plan-list-item").data("yearData");var pageUrl="view/system-sasac/budget/module/expenditure/budgetTableStyle.html?booksId="+booksObj.booksId;window.location.href=$yt_option.websit_path+pageUrl})},detailsClick:function(){$('.button-box').on('click','.check-details',function(){var booksObj=$(this).parents(".plan-list-item").data("yearData");var pageUrl="view/system-sasac/budget/module/expenditure/budgetCheckDetails.html?booksId="+booksObj.booksId+"&booksYear="+booksObj.booksYear;window.location.href=$yt_option.websit_path+pageUrl})},clearAlert:function(obj){var selects=obj.find('select');$.each(selects,function(i,n){$(n).find('option:eq(0)').attr('selected',true)});selects.niceSelect();var inputs=obj.find('input:not(input[type="radio"],input[type="checkbox"])');inputs.val('');var radios=obj.find('input[type="radio"]');$.each(radios,function(i,n){$(n).setRadioState('uncheck')});var checks=obj.find('input[type="checkbox"]');$.each(checks,function(i,n){$(n).setCheckBoxState('uncheck')});var textareas=obj.find('textarea');textareas.val('')}};$(function(){budgetTableManager.init()});