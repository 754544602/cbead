var breakDownObj={dataDetail:"",configData:[],tableId:'',publishId:'',budgetStage:'',initDeptData:{},init:function(){sysCommon.getLoginUserInfo();var requerParameter=$yt_common.GetRequest();if(requerParameter){breakDownObj.publishId=requerParameter.publishId;breakDownObj.tableIdDetails();var detailsA=requerParameter.detailsA;var detaData=$("div.details-up").data("detailData");if(detailsA==1){$("button.submit-btn").hide();var flowLogHtml=sysCommon.getCommentByProcessInstanceId(detaData.processInstanceId);$(".flow-log-div").html(flowLogHtml);$(".flow-approve-model").show()}else{$(".flow-approve-model").html(sysCommon.createFlowApproveMode());sysCommon.getApproveFlowData($(".bussiness-code").val(),detaData.processInstanceId);$("select").niceSelect();$(".appr-flow-log").hide()}}breakDownObj.handleEvent();$(".submit-btn").off().on("click",function(){breakDownObj.subApproval()})},tableIdDetails:function(){$.ajax({type:'post',url:'budget/report/getBudgetReportInfoByAppId',async:false,data:{reportId:breakDownObj.publishId},success:function(data){if(data.flag==0){breakDownObj.dataDetail=data.data;$("div.details-up").data("detailData",data.data);$("#formNum").text(data.data.reportNum);$("#applyDate").text(data.data.applicantTime);$(".bussiness-code").val(data.data.bussinessCode);breakDownObj.getBudgetTableDetail();breakDownObj.getFileInfo()}else{$yt_alert_Model.prompt(data.message)}}})},getFileInfo:function(){$.ajax({type:'post',url:'budget/files/getFileInfoList',data:{tableId:breakDownObj.dataDetail.tableId,deptId:$yt_common.user_info.deptId,budgetStage:''},success:function(data){if(data.flag==0){var html='';if(data.data.length>0){$.each(data.data,function(i,n){html+='<div class="file-lable" fid="'+n.attId+'"><div class=""><a class="yt-link file-dw">'+n.attName+'</a></div><div class=""><span>文件说明：</span><span class="">'+(n.attRemarks==""?"--":n.attRemarks)+'</span></div></div>'});$('#attIdStr').html(html)}else{$('#attIdStr').html('<span>暂无数据</span>')}$('#attIdStr').on('click','.file-dw',function(){var id=$(this).parents('.file-lable').attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'})}}})},handleEvent:function(){$("button.page-retun-btn").click(function(){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/budget/module/expenditure/budgetFill.html'}})})},getBudgetTableDetail:function(){$.ajax({type:'post',url:'budget/main/getBudgetTableDetailByPublishTableId',async:false,data:{publishTableId:breakDownObj.dataDetail.publishTableId},success:function(data){var dataObj=data.data||{};var budgetState="";switch(dataObj.budgetStage){case "1":budgetState='一上阶段';break;case "2":budgetState='一下阶段';break;case "3":budgetState='二上阶段';break;case "4":budgetState='二下阶段';break}$(".table-name").text(dataObj.tableName);$(".stage").text(budgetState);$(".label-msg").text(dataObj.tagging);$('#createConfigTableDiv').html('').newRuleTable({theads:dataObj.theads,tbodys:dataObj.tbodys,propertyList:dataObj.propertyList,eventCheck:false,serialNumber:false});var propertyList=dataObj.propertyList;for(var i=0,len=propertyList.length;i<len;i+=1){var proper=propertyList[i];var index=proper.crNum.replace(proper.type,'');if(proper.type=='c'){$('.rule-table .yt-tbody tr').each(function(){$(this).find('td').eq(index-1).addClass('disable-sty')})}else if(proper.type=='r'){$('.rule-table .yt-tbody tr').eq(index-1).find('td,th').addClass('disable-sty')}}$('.rule-table').data('tableData',dataObj);$('.rule-table tbody tr').each(function(i){$(this).attr('fieldflag','r'+(i+1)).addClass('r'+(i+1)).find('td').each(function(j){$(this).attr('fieldflag','c'+(j+1)).addClass('c'+(j+1))})});$('.rule-table tbody tr td:not(.disable-sty)').each(function(){var html=$(this).html();html='<span class="money-text">'+html+'</span>';$(this).html(html)});breakDownObj.getConfigInfo();breakDownObj.getTableInfoList()}})},getConfigInfo:function(){breakDownObj.configData=[];$.ajax({type:"post",url:'budget/confg/getTableAllCongfigByTableId',async:false,data:{tableId:breakDownObj.tableId},success:function(data){var crNums="";if(data.flag==0){if(data.data.length>0){breakDownObj.configData=data.data;$.each(data.data,function(i,n){if(n.type=="cr"){crNums=n.crNum.split("-");$(".rule-table tbody tr").each(function(i,r){if(crNums[1]==$(this).attr("fieldFlag")){if(n.calcItem&&n.calcItem=="2"){$(r).find("input.money-input").addClass("character-inpu")}$.each($(r).find("td"),function(i,c){if(crNums[0]==$(c).attr("fieldFlag")){if(n.calcItem=="1"||n.calcItem=="4"){$(c).addClass("disable-sty")}$(c).data("configData",n)}})}})}else{$(".rule-table tbody tr").each(function(i,r){if(n.crNum==$(this).attr("fieldFlag")){if(n.calcItem=="1"||n.calcItem=="4"){$(this).addClass("disable-sty").find('td').addClass("disable-sty")}if(n.calcItem=="2"){$(this).find("input.money-input").addClass("character-inpu")}$(this).data("configData",n)}});$(".rule-table tbody tr td").each(function(v,c){if(n.crNum==$(this).attr("fieldFlag")){if(n.calcItem=="1"||n.calcItem=="4"){$(this).addClass("disable-sty")}$(this).data("configData",n)}})}})}}else{$yt_alert_Model.prompt(data.message,2000)}}})},subApproval:function(){var dealingWithPeople=$("#approve-users").val();var businessCode=$(".bussiness-code").val();var nextCode=$("#operate-flow").val();var opintion=$("#opintion").val();$.ajax({type:'post',url:'budget/report/submitWorkFlow',data:{appId:breakDownObj.dataDetail.publishTableId,businessCode:"",businessCode:breakDownObj.dataDetail.businessCode,parameters:"",dealingWithPeople:dealingWithPeople,opintion:opintion,processInstanceId:breakDownObj.dataDetail.processInstanceId,nowPersion:"",nextCode:nextCode},success:function(data){if(data.flag==0){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/budget/module/expenditure/budgetFill.html'}})}else{$yt_alert_Model.prompt(data.message)}}})},getTableInfoList:function(){var tableId=$yt_common.GetQueryString('tableId');var publishId=$yt_common.GetQueryString('publishId');$.ajax({type:"post",url:'budget/main/getBudgetDataDetailInfo',async:false,data:{"tableId":breakDownObj.tableId,"publishTableId":breakDownObj.dataDetail.publishTableId},success:function(data){if(data.flag==0){if(data.data.length>0){var tbody=$('.rule-table .yt-tbody');$.each(data.data,function(i,n){$(".rule-table .yt-tbody tr").each(function(i,v){if($(v).attr("fieldFlag")==n.rowNum){$(v).find("td").each(function(t,c){if($(c).attr("fieldFlag")==n.cellNum){$(c).attr("budgetMainId",n.budgetMainId);if(n.crValue!=""&&n.crValue!=null&&n.crValue!=undefined){if(!isNaN(n.crValue)){n.crValue=$yt_baseElement.fmMoney(n.crValue)}$(c).find(".money-text").html(n.crValue);$(c).find(".money-input").val(n.crValue)}$(c).data("cellData",n)}})}})});breakDownObj.cellEvent()}}else{$yt_alert_Model.prompt(data.message,2000)}}})},cellEvent:function(){$('.rule-table .yt-tbody tr td:not(.disable-sty)').click(function(){var cellData=$(this).data("cellData");var cellConfigData=$(this).data("configData");if(cellData!=undefined&&cellConfigData!=undefined&&cellConfigData.calcItem!="1"&&cellConfigData.calcItem!="4"){$('.rule-table .yt-tbody tr td').removeClass("cell-shadow");$(this).addClass("cell-shadow");var unitText=($(".label-msg").text()!=""?'('+$(".label-msg").text()+')':"");$('#mainLayout').layout('add',{region:'south',width:180,title:'分解明细'+unitText,id:"bottomPanel",split:true});breakDownObj.setLayoutPanelHeader();$.ajax({type:"post",url:'budget/resolve/getDpetTotalDataByCells',async:false,data:{tableId:breakDownObj.tableId,budgetStage:breakDownObj.budgetStage,colNum:cellData.cellNum,rowNum:cellData.rowNum },success:function(data){var datas=data.data;if(data.flag==0){var noBreakNum=$yt_baseElement.rmoney(datas.controlAmount)-$yt_baseElement.rmoney(datas.resolveAmount);var botStr='<div code="detail" class="tab-panel"><div class="break-down-info">';botStr+='<div><lable>预算控制数：</lable><input type="hidden" class="con-id" value="'+datas.resolveControlId+'"/><input class="yt-input control-inpu" type="text" value="'+(datas.controlAmount==""?"0.00":($yt_baseElement.fmMoney(datas.controlAmount)))+'"/><lable style="margin-left: 35px;"><span style="letter-spacing: 5px;">分解状</span>态：</lable><span>已分解&nbsp;&nbsp;<span class="break-down-num '+(datas.resolveAmount>datas.controlAmount?"font-red":"")+'">'+(datas.resolveAmount==""?"0.00":($yt_baseElement.fmMoney(datas.resolveAmount)))+'</span><span style="margin-left: 50px;">未分解&nbsp;&nbsp;<span  class="no-break-down-num '+(noBreakNum>0?"font-red":"")+'">'+(noBreakNum==""?"0.00":$yt_baseElement.fmMoney(noBreakNum))+'</span></span></div>';botStr+='</div>';botStr+='<div style="padding:0px 10px;"><table class="yt-table prepare-table" style="width: 100%;margin-top: 20px;"><thead class="yt-thead"><tr><th>编制处室</th><th>编制金额</th><th>备注（汇总编制）</th><th>分解金额</th><th>备注</th></tr></thead><tbody class="yt-tbody"><tr class="sum-row"><td style="text-align: left;">合计</td><td class="prepare-money sum-money" style="text-align: right;">'+(datas.amount==""?"0.00":($yt_baseElement.fmMoney(datas.amount)))+'</td><td></td><td style="text-align: right;"><span class="break-down-sum">'+(datas.resolveAmount==""?"0.00":($yt_baseElement.fmMoney(datas.resolveAmount)))+'</span></td><td><input class="yt-input prepare-remark sum-prepare-remark"  value="'+(datas.remark)+'" placeholder="请输入"/></td></tr>';if(datas.deptBudgetList!=""&&datas.deptBudgetList!=undefined&&datas.deptBudgetList.length>0){$.each(datas.deptBudgetList,function(i,n){botStr+='<tr><td style="text-align: left;" dept-id-data="'+n.deptId+'">'+n.deptName+'</td><td class="prepare-money" style="text-align: right;">'+(n.amount==""?"0.00":($yt_baseElement.fmMoney(n.amount)))+'</td><td>'+n.totalRemark+'</td><td class="adjust-money"><input class="yt-input adjust-inpu" type="text" value="'+(n.resolveAmount==""?"0.00":($yt_baseElement.fmMoney(n.resolveAmount)))+'"/></td><td><input class="yt-input prepare-remark"  value="'+(n.remark)+'" placeholder="请输入"/></td></tr>'})}botStr+='</tbody></table></div>';botStr+='<div class="handle-model" style="text-align: center;margin-top: 20px;"><button class="yt-option-btn yt-common-btn prepare-save-btn" style="margin-right: 20px;">保存</button><button class="yt-option-btn yt-cancel-btn prepare-cancel-btn">取消</button></div></div>';botStr+=breakDownObj.getGistFileHtml();botStr=$(botStr);botStr.find('.break-down-info').data("cellData",cellData);$("#bottomPanel").html(botStr);customResize();breakDownObj.panleEvent();breakDownObj.fileUpEvent();breakDownObj.getFileInfoList(breakDownObj.tableId);breakDownObj.initDeptData=breakDownObj.getCellDeptData()}}})}})},panleEvent:function(){$('#mainLayout').layout({onCollapse:function(){$("#mainLayout").layout('remove','south');$('.rule-table .yt-tbody tr td').removeClass("cell-shadow")}});$("#bottomPanel").on("focus",".adjust-inpu,.control-inpu",function(){$(this).select();if($(this).val()!=""&&$(this).val()!="0.00"&&$(this).val()!=null){$(this).val($yt_baseElement.rmoney($(this).val()))}else{$(this).val("0.00")}});$("#bottomPanel").on("blur",".adjust-inpu,.control-inpu",function(){if($(this).val()!=""&&$(this).val()!="0.00"&&$(this).val()!=null){$(this).val($yt_baseElement.fmMoney($(this).val()))}else{$(this).val("0.00")}if($(this).hasClass("adjust-inpu")){var breakDownSum="0.00";breakDownSum=$yt_baseElement.rmoney(breakDownSum);$(".prepare-table .adjust-inpu").each(function(i,n){breakDownSum+=$yt_baseElement.rmoney($(n).val())});$(".break-down-sum").text($yt_baseElement.fmMoney(breakDownSum))}breakDownObj.calculateBreakDownState()});$("#bottomPanel").on("keyup",'.adjust-inpu,.control-inpu',function(){$(this).val($(this).val().replace(/[^\d.]/g,''))});$("button.prepare-save-btn").click(function(){var thisBtn=$(this);if($yt_baseElement.rmoney($(".break-down-sum").text())==$yt_baseElement.rmoney($(".control-inpu").val())){$(thisBtn).attr("disabled","disabled");breakDownObj.executeSave(thisBtn)}else{$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:"已分解金额应等于预算控制数",cancelFunction:function(){}})}});$("button.prepare-cancel-btn").click(function(){breakDownObj.dataIsUpdate(0)});breakDownObj.uploadFile();$('.file-box').on('click','.del-file',function(){var ithis=$(this);var parent=ithis.parent();$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){parent.remove()}})})},dataIsUpdate:function(isBtn){var saveData=JSON.stringify(!!breakDownObj?breakDownObj.getCellDeptData():{});var initData=JSON.stringify(!!breakDownObj?breakDownObj.initDeptData:{});if(saveData!=initData){$yt_alert_Model.alertOne({leftBtnName:"保存",rightBtnName:"不保存",alertMsg:"当前页面有调整数据尚未保存，是否放弃保存？点击“保存”保存页面调整数，或点击“不保存”继续。",confirmFunction:function(){breakDownObj.executeSave()},cancelFunction:function(){$("#mainLayout").layout('remove','south');$('.rule-table .yt-tbody tr td').removeClass("cell-shadow");if(isBtn==1){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/budget/module/expenditure/budgetBreakDownList.html'}})}}})}else{$("#mainLayout").layout('remove','south');$('.rule-table .yt-tbody tr td').removeClass("cell-shadow");if(isBtn==1){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/budget/module/expenditure/budgetBreakDownList.html'}})}}},executeSave:function(thisBtn){var saveDatas=breakDownObj.getCellDeptData();$.ajax({type:"post",url:"budget/resolve/saveDpetResolveDataByCells",data:saveDatas,success:function(data){$yt_alert_Model.prompt(data.message);if(thisBtn!=undefined&&thisBtn!=""){$(thisBtn).attr("disabled",false)}if(data.flag==0){breakDownObj.getTableInfoList();if(thisBtn==undefined&&$("button.page-retun-btn").hasClass("check")){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/budget/module/expenditure/budgetBreakDownList.html'}})}$("#mainLayout").layout('remove','south');$('.rule-table .yt-tbody tr td').removeClass("cell-shadow")}},error:function(e){if(thisBtn!=undefined&&thisBtn!=""){$(thisBtn).attr("disabled",false)}}})},calculateBreakDownState:function(){var breakDownNum=$yt_baseElement.rmoney($(".break-down-sum").text());var controlNum=$yt_baseElement.rmoney($(".control-inpu").val());if(breakDownNum>controlNum){$(".break-down-num").css("color","#FF0000")}else{$(".no-break-down-num").css("color","#333")}$(".break-down-num").text($(".break-down-sum").text());var noBreakDownNum=0;if($yt_baseElement.rmoney($(".control-inpu").val())>0){noBreakDownNum=$yt_baseElement.rmoney($(".control-inpu").val())-$yt_baseElement.rmoney($(".break-down-num").text())}if(noBreakDownNum>0){$(".no-break-down-num").css("color","#FF0000")}else{$(".no-break-down-num").css("color","#333")}$(".no-break-down-num").text($yt_baseElement.fmMoney(noBreakDownNum))},uploadFile:function(){$(".file-up-div").off().on('change','.cont-file',function(obj){var fileElementId=this.id;var ithisParent=$('#attIdStr');var url=$yt_option.base_path+"/fileUpDownload/upload?ajax=1&modelCode=REIM_APP";var imgUlr='';$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:fileElementId,success:function(data,textStatus){if(data.flag==0){var attaElement=$('<div fid="'+data.data.pkId+'" class="li-div"><span>'+data.data.naming+'</span><span class="del-file">x</span></div>');ithisParent.append(attaElement)}else{$yt_alert_Model.prompt(data.message)}$('#attIdStr .file-pv img').showImg()},error:function(data,status,e){$yt_alert_Model.prompt(data.message)}})})},getCellDeptData:function(){var bottomPanelObj=$("#bottomPanel");var resolveControlId=$(bottomPanelObj).find(".con-id").val();var cellData=$(".break-down-info").data("cellData");var amount=$(bottomPanelObj).find(".sum-money").text();amount=$yt_baseElement.rmoney(amount);var breakDownAmount=($(".break-down-num").text()==""?"0.00":($yt_baseElement.rmoney($(".break-down-num").text())));var confAmount=$yt_baseElement.rmoney($(".control-inpu").val());var files="";if($("#attIdStr .li-div").length>0){files="";$("#attIdStr .li-div").each(function(i,n){files+=$(n).attr("fid")+","})}files=(files==""?"":files.substring(files.length-1,0));var deptBudgetList=[];var deptBudgetJson="";$(bottomPanelObj).find("table.prepare-table tbody tr:gt(0)").each(function(i,n){deptBudgetList.push({deptId:$(n).find("td").attr("dept-id-data"),deptName:$(n).find("td:eq(0)").text(),amount:($yt_baseElement.rmoney($(n).find(".prepare-money").text())),resolveAmount:($yt_baseElement.rmoney($(n).find(".adjust-inpu").val())),remark:$(n).find(".prepare-remark").val()})});if(deptBudgetList!=""&&deptBudgetList.length>0){deptBudgetJson=JSON.stringify(deptBudgetList)}return{tableId:breakDownObj.tableId,budgetStage:breakDownObj.budgetStage,colNum:cellData.cellNum,rowNum:cellData.rowNum,resolveControlId:resolveControlId,amount:amount,resolveAmount:breakDownAmount,controlAmount:confAmount,attIdStr:files,remark:$(bottomPanelObj).find(".sum-prepare-remark").val(),deptBudgetList:deptBudgetJson }},setLayoutPanelHeader:function(){$('.layout-panel-south .panel-title').html('<label code="detail" class="tab-item check">分解明细（单位：万元）</label><label code="gist" class="tab-item">编制依据（文件）</label>');$('.layout-panel-south .tab-item').on('click',function(){$('.layout-panel-south .tab-item').removeClass('check');$(this).addClass('check');var code=$(this).attr('code');$('.tab-panel').hide();$('.tab-panel[code="'+code+'"]').show()})},getGistFileHtml:function(){var html='<div style="display:none;" class="file-content tab-panel" code="gist"><div class="file-update"><div class="file-cont-row"><span><span style="color: #fff;">*</span><span style="letter-spacing: 5px;">上传附</span>件：</span><div class="file-up-div"><div class="dib" style="vertical-align: middle;"><input class="yt-input file-msg" id="fileName" readonly="readonly"></div><div class="file-input-but"><input name="file" class="cont-file" id="fileInput" type="file"><input type="hidden" id="fileId"><button class="yt-option-btn yt-common-btn file-upload-btn" id="" style="margin: 0;">请上传</button></div></div></div><div class="file-cont-row"><div style="float: left;"><label><span class="not-null">*</span><span style="letter-spacing: 5px;">文件说</span>明：</label></div><div style="overflow: hidden;"><textarea class="yt-textarea" id="fileRemark"></textarea></div></div><div class="file-cont-row" style="text-align: center;"><button class="yt-option-btn yt-common-btn" id="fileUp">上传</button></div></div><div class="file-up-list" id="attIdList"></div><div style="clear: both;"></div></div>';return html},fileUpEvent:function(){$(".file-up-div").off().on('change','.cont-file',function(obj){var fileElementId=this.id;var ithisParent=$('#attIdStr');var url=$yt_option.base_path+"/fileUpDownload/upload?ajax=1&modelCode=REIM_APP";var imgUlr='';$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:fileElementId,success:function(data,textStatus){if(data.flag==0){$('#fileId').val(data.data.pkId);$('#fileName').val(data.data.naming)}else{$yt_alert_Model.prompt(data.message)}},error:function(data,status,e){$yt_alert_Model.prompt(data.message)}})});$('#fileUp').on('click',function(){var fid=$('#fileId').val();if(fid){breakDownObj.saveFileInfo()}else{$yt_alert_Model.prompt('请选择附件')}});$('#attIdList').on('click','.file-dw',function(){var id=$(this).parents('.file-lable').attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'});$('#attIdList').on('click','.del-file',function(){var ithis=$(this);var parent=ithis.parents('.file-lable');var id=parent.attr('fid');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){breakDownObj.deleteFileInfoById(id,function(){parent.remove()})}})})},getFileInfoList:function(tableId){$.ajax({type:'post',url:'budget/files/getFileInfoList',data:{tableId:tableId,deptId:'',budgetStage:''},success:function(data){if(data.flag==0){var html='';$.each(data.data,function(i,n){html+='<div class="file-lable" fid="'+n.attId+'"><div class=""><a class="yt-link file-dw">'+n.attName+'</a><label class="del-file">x</label></div><div class=""><span>文件说明：</span><span class="">'+n.attRemarks+'</span></div><div class=""><span>上传人：</span><span class="">'+n.createUserName+'</span></div></div>'});$('#attIdList').html(html)}}})},deleteFileInfoById:function(id,callback){$.ajax({type:'post',url:'budget/files/deleteFileInfoById',data:{attId:id,budgetStage:breakDownObj.budgetStage},success:function(data){if(data.flag==0){if(callback){callback()}}$yt_alert_Model.prompt(data.message)}})},saveFileInfo:function(){$.ajax({type:'post',url:'budget/files/saveFileInfo',data:{tableId:breakDownObj.tableId,budgetStage:breakDownObj.budgetStage,attId:$('#fileId').val(),attRemarks:$('#fileRemark').val()},success:function(data){if(data.flag==0){$('#fileId').val('');$('#fileName').val('');$('#fileRemark').val('');breakDownObj.getFileInfoList(breakDownObj.tableId,breakDownObj.tableObj.deptId)}$yt_alert_Model.prompt(data.message)}})},saveExportDpetResolveDataByCells:function(){$.ajax({type:'post',url:'budget/resolve/saveExportDpetResolveDataByCells',data:{tableId:breakDownObj.tableId,budgetStage:breakDownObj.budgetStage},success:function(data){if(data.flag==0){}$yt_alert_Model.prompt(data.message)}})}};$(function(){breakDownObj.init();redraw()});$(window).resize(function(){redraw()});window.customResize=function(){var width=$(window).width();var height=$(window).height();var panelHeight=parseInt(height/2);};function redraw(){if(window.customResize){customResize();}else{var width=$(window).width();var height=$(window).height();$('.easyui-panel').panel('resize',{width:width,height:height});$('.easyui-layout').layout('resize',{width:width,height:height});$('.easyui-treegrid').treegrid('resize',{width:width,height:height});$('.easyui-datagrid').datagrid('resize',{width:width,height:height})}}