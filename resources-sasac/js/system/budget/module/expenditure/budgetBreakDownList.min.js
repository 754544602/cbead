var budgetReport={init:function(){$("#budgetReport").css("min-height",$(window).height()-12);$("select").niceSelect();$(".budget-radio .yt-radio input").change(function(){budgetReport.tablePage($(".budget-year").val())});$(".yt-table .yt-tbody").on("click"," tr",function(){$(".yt-table .yt-tbody tr.yt-table-active").removeClass("yt-table-active");$(this).addClass("yt-table-active")});budgetReport.getBudgetYear();budgetReport.clickBudgetOrgan();budgetReport.clickBudgetNext()},clickBudgetOrgan:function(){$(".budget-organ").click(function(){var selTrLen=$(".plan-list-model tbody tr.yt-table-active").length;var tableData=$(".plan-list-model tbody tr.yt-table-active").data("tableData");if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作")}else{window.location.href=$yt_option.websit_path+"view/system-sasac/budget/module/expenditure/budgetBreakDown.html?tableId="+tableData.tableId+"&budgetStage="+tableData.budgetStage}});$("button.export-btn").click(function(){var selTrLen=$(".plan-list-model tbody tr.yt-table-active").length;var tableData=$(".plan-list-model tbody tr.yt-table-active").data("tableData");if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作")}else{var yitianSSODynamicKey=$yt_baseElement.getToken();window.location.href=$yt_option.base_path+'gzw/budget/excel/exportResolveAuditToExcel?tableId='+tableData.tableId+'&budgetStage='+tableData.budgetStage+"&yitianSSODynamicKey="+yitianSSODynamicKey+"&ajax=1"}})},getBudgetYear:function(){$.ajax({type:"post",url:"budget/appMain/getBudgetYearInfo",async:false,success:function(data){var datas=data.data;if(data.flag==0){$.each(datas,function(i,n){$('select.budget-year').append('<option value="'+n.budgetYear+'">'+n.budgetYear+'</option>')});$("select.budget-year").niceSelect();budgetReport.tablePage($(".budget-year").val());$("select.budget-year").change(function(){var thisYear=$(this).val();budgetReport.tablePage(thisYear);})}}})},tablePage:function(budgetYear){var budgetStage=$(".budget-radio .yt-radio input:checked").val();$.ajax({type:"post",url:"budget/resolve/getResolvePublishBudgetTableList",async:false,data:{budgetYear:budgetYear,budgetStage:budgetStage},success:function(data){var htmlTbody=$('.publish-table .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data;if(datas.length>0){$.each(datas,function(i,n){trStr+='<tr><td>'+n.tableCode+'</td><td style="">'+n.budgetTypeName+'</td><td style="text-align: left;" class="text-overflow" title="'+n.tableName+'">'+n.tableName+'</td><td>'+(n.budgetStage==1?"一下编制数据分解":"二下编制数据分解")+'</td><td>'+(n.resolveState==1?"已分解":"未分解")+'</td><td style="">'+(n.goDownState==1?"已下达":"未下达")+'</td><td lastOperatorUserCode="'+n.lastOperatorUserCode+'">'+(n.lastOperatorUserName||'--')+'</td><td>'+(n.lastOperatorDateTime.substring(0,n.lastOperatorDateTime.length-3)||'--')+'</td></tr>';trStr=$(trStr).data("tableData",n);htmlTbody.append(trStr)})}else{$('.before-table-page').hide();htmlTbody.html(sysCommon.noDataTrStr(9))}}else{$('.before-table-page').hide();htmlTbody.html(sysCommon.noDataTrStr(9));$yt_alert_Model.prompt(data.message)}}})},clickBudgetNext:function(){$(".budget-next").click(function(){var budgetStage=$(".budget-radio .yt-radio input:checked").val();var budgetYear=$(".budget-year").val();$.ajax({type:"post",url:"budget/resolve/setGoDownBudgetResolveData",async:false,data:{budgetYear:budgetYear,budgetStage:budgetStage},success:function(data){var datas=data.data;if(data.flag==0){budgetReport.tablePage(budgetYear)}$yt_alert_Model.prompt(data.message)}})})}};$(function(){budgetReport.init()});