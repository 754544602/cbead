var budgetFill={init:function(){$("#budgetFill").css("min-height",$(window).height()-12);$(".yt-select").niceSelect();$(".budget-radio .yt-radio input").change(function(){budgetFill.searchList()});budgetFill.clickBudgetOrgan()},clickBudgetOrgan:function(){$(".budget-organ").click(function(){var selTrLen=$(".before-apply-table tbody tr.yt-table-active").length;var tableData=$(".before-apply-table tbody tr.yt-table-active").data("tableData");if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作")}else{window.location.href=$yt_option.websit_path+"view/system-sasac/budget/module/expenditure/budgetFillDetails.html?tableId="+tableData.tableId+"&publishId="+tableData.publishTableId}})},getBudgetStageOption:function(thisYear){$.ajax({type:"post",url:"budget/report/getBudgetStageOption",async:false,data:{budgetYear:thisYear},success:function(data){var datas=data.data;if(data.flag==0){$('.budget-radio input.docu-style[value="'+datas+'"]').setRadioState("check");budgetFill.searchList()}}})},searchList:function(thisYear){var status=$('.active-li input').val();if(status=='WF_SUSPENDING_QUERY_SQL_PARAMS'){budgetFill.getPendingList(status)}else if(status=='WF_SOLVED_QUERY_SQL_PARAMS'){budgetFill.getProcessingAndFinishList(status)}else if(status=='WF_COMPLETED_QUERY_SQL_PARAMS'){budgetFill.getPendingList(status)}else if(status=='WF_DRAFTS_QUERY_SQL_PARAMS'){}},switcher:function(){$('.tab-li').off().on('click',function(){var index=$(this).index();$('.tab-li').removeClass('active-li');$(this).addClass('active-li');$('.tab-content').hide();if(index==1){$('.tab-content').eq(1).show()}else{$('.tab-content').eq(0).show()}if(index==1){$('.node-now-state').show()}else{$('.node-now-state').hide()}budgetFill.searchList()})},getPendingList:function(status){var budgetStage=$(".budget-radio .yt-radio input:checked").val();$('.page1').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:"budget/report/getUserBudgetReportAppInfoWFListToPageByParams",type:"post",data:{queryStateParams:status,budgetStage:budgetStage},objName:'data',success:function(data){var datas=data.data.rows;var htmlTbody=$('.pending .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){if(datas.length>0){$('.page1').show();$.each(datas,function(i,n){var editorStage="";if(n.editorStage=="1"){editorStage="未开始"}else if(n.editorStage=="2"){editorStage="编制中"}else if(n.editorStage=="3"){editorStage="编制完成"}var appaovalBtn='<a class="yt-link apprv-btn"  taskKey="'+n.taskKey+'">'+(n.taskKey=='activitiStartTask'?'处理':'审批')+'</a><span class="center-line">|</span>';if(status=='WF_COMPLETED_QUERY_SQL_PARAMS'){appaovalBtn=''}trStr+='<tr><td><a class="yt-link to-detail">'+n.reportNum+'</a><input type="hidden" class="hid-reim-id" value="'+n.tableId+'"/><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/></td><td>'+n.sourceDeptName+'</td><td>'+n.budgetTypeName+'</td><td>'+n.tableName+'</td><td>'+n.budgetStageName+'</td><td>'+editorStage+'</td><td>'+n.submitRemainTimeShort+'</td><td>'+n.lastUpdateTime+'</td><td>'+appaovalBtn+'<a class="yt-link log-mod">日志</a></td></tr>';trStr=$(trStr).data("dataTr",n);htmlTbody.append(trStr)});sysCommon.initQtip($(".log-mod"));budgetFill.goApprovePage();budgetFill.toDetails()}else{$('.page1').hide();htmlTbody.append(budgetFill.noDataTrStr(8))}}},isSelPageNum:true })},goApprovePage:function(){$(".apprv-btn").off().click(function(){var tableId=$(this).parents("tr").data("dataTr").tableId;var processInstanceId=$(this).parents("tr").data("dataTr").processInstanceId;var publishId=$(this).parents("tr").data("dataTr").publishId;var detailsA=2;window.location.href=$yt_option.websit_path+"view/system-sasac/budget/module/expenditure/budgetFillDetails.html?publishId="+publishId+"&detailsA="+detailsA})},toDetails:function(){$('.yt-link.to-detail').off().on('click',function(){var tableId=$(this).parents("tr").data("dataTr").tableId;var publishId=$(this).parents("tr").data("dataTr").publishId;var detailsA=1;window.location.href=$yt_option.websit_path+"view/system-sasac/budget/module/expenditure/budgetFillDetails.html?publishId="+publishId+"&detailsA="+detailsA});$(".process-state").click(function(){var processInstanceId=$(this).parents("tr").find(".processInstanceId").val();sysCommon.processStatePop(processInstanceId)})},getProcessingAndFinishList:function(){var status=$('.active-li input').val();var budgetStage=$(".budget-radio .yt-radio input:checked").val();$('.page2').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:"budget/report/getUserBudgetReportAppInfoWFListToPageByParams",type:"post",data:{queryStateParams:status,budgetStage:budgetStage},objName:'data',success:function(data){var datas=data.data.rows;var htmlTbody=$('.handle-and-end .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){if(datas.length>0){$('.page2').show();$.each(datas,function(i,n){var editorStage="";if(n.editorStage=="1"){editorStage="未开始"}else if(n.editorStage=="2"){editorStage="编制中"}else if(n.editorStage=="3"){editorStage="编制完成"}trStr+='<tr><td><a class="yt-link to-detail">'+n.reportNum+'</a><input type="hidden" class="hid-reim-id" value="'+n.tableId+'"/><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/></td><td>'+n.sourceDeptName+'</td><td>'+n.budgetTypeName+'</td><td>'+n.tableName+'</td><td>'+n.budgetStageName+'</td><td>'+editorStage+'</td><td>'+n.submitRemainTimeShort+'</td>';if(status=='WF_SOLVED_QUERY_SQL_PARAMS'){trStr+='<td style="text-align:left;"><span class="yt-link process-state">'+n.nodeNowState+'</span></td>';}trStr+='<td><a class="yt-link log-mod">日志</a></td></tr>';trStr=$(trStr).data("dataTr",n);htmlTbody.append(trStr)});sysCommon.initQtip($(".log-mod"));budgetFill.toDetails()}else{$('.page2').hide();htmlTbody.append(budgetFill.noDataTrStr(8))}}},isSelPageNum:true })},noDataTrStr:function(trNum){var noDataStr='<tr style="border:0px;background-color:#fff !important;"><td  colspan="'+trNum+'" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';return noDataStr}};$(function(){budgetFill.init();budgetFill.switcher();var state=$yt_common.GetRequest().state;if(state){$('.tab-header .tab-li').removeClass('active-li');$('.tab-header .tab-li').eq(1).addClass('active-li');$('.tab-content').eq(1).css("display",'block').siblings('.tab-content').hide()}budgetFill.searchList();$("#reimApproList").css("min-height",$(window).height()-12)});