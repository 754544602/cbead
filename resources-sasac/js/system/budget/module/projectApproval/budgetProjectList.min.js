var beforeApproList={init:function(){$(".project-summary").click(function(){beforeApproList.toProjectSummary()});$('.info-sidebar .sidebar-head').on('click',function(){var div=$('.info-sidebar .sidebar-data');if(div.is(':hidden')){div.show()}else{div.hide()}});beforeApproList.infoSidebarList();beforeApproList.checkBoxEvent();beforeApproList.toDetails()},searchInput:function(){$('.search').on('keydown',function(){if($(this).val()!=''){$('.clearImg').show()}});$('.clearImg').on('click',function(){$('.search').val('');$(this).hide();beforeApproList.searchList()});$("#resetBtn").off().on("click",function(){$('.search').val('');$(".clearImg").hide();beforeApproList.searchList()});$("#heardSearchBtn").off().on("click",function(){beforeApproList.searchList()});$(".end-table").on('click','.process-state',function(){var processInstanceId=$(this).parents("tr").find(".processInstanceId").val();sysCommon.processStatePop(processInstanceId)})},searchList:function(){var status=$('.active-li input').val();if(status=='WF_SUSPENDING_QUERY_SQL_PARAMS'){beforeApproList.getPendingList(status)}else if(status=='WF_SOLVED_QUERY_SQL_PARAMS'){$(".app-date-th").text("申请日期");beforeApproList.getProcessingAndFinishList(status)}else if(status=='WF_COMPLETED_QUERY_SQL_PARAMS'){beforeApproList.getProcessingAndFinishList(status)}},switcher:function(){$('.tab-li').off().on('click',function(){var index=$(this).index();$(this).addClass('active-li').siblings('.tab-li').removeClass('active-li');if(index==1||index==2){$('.tab-content').eq(1).css("display",'block').addClass("check").siblings('.tab-content').hide().removeClass("check")}else{$('.tab-content').eq(index).css("display",'block').addClass("check").siblings('.tab-content').hide().removeClass("check")}beforeApproList.searchList()})},getPendingList:function(stateCode){var keyWord=$('.search').val();$('.page1').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:'budget/prjApp/getUserBudgetPrjAppInfoWFListToPageByParams',type:'post',data:{queryStateParams:stateCode,queryParams:keyWord},objName:'data',success:function(data){var htmlTbody=$('.wait-table .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data.rows;if(datas.length>0){$('.page1').show();$.each(datas,function(i,n){trStr+='<tr><td><label class="check-label yt-checkbox"><input class="check-but" type="checkbox" name="check" value="'+n.budgetPrjAppId+'"/></label></td><td><a class="yt-link to-detail">'+n.budgetPrjAppNum+'</a><input type="hidden" class="budgetPrjAppId" value="'+n.budgetPrjAppId+'"/><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/></td><td style="text-align: left;" class="prj-name">'+n.prjName+'</td><td>'+n.prjUnitName+'</td>'+'<td>'+n.applicantDeptName+'</td><td>'+n.stagnationTime+'</td>'+'<td><a class="yt-link apprv-btn" taskKey="'+n.taskKey+'">'+(n.taskKey=='activitiStartTask'?'处理':'审批')+'</a><span class="center-line">|</span><a class="yt-link log-mod">日志</a></td></tr>';trStr=$(trStr).data("dataStr",n);htmlTbody.append(trStr)});beforeApproList.goApprovePage();sysCommon.initQtip($(".log-mod"))}else{$('.page1').hide();htmlTbody.append(sysCommon.noDataTrStr(7))}}else{$('.page1').hide();htmlTbody.append(sysCommon.noDataTrStr(7))}},isSelPageNum:true })},infoSidebarList:function(){$('.info-sidebar-page').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:'budget/prjSummaryApp/getBudgetPrjAppInfoPageByParams',type:'post',data:{startTime:"",queryParams:"",endTime:""},objName:'data',success:function(data){var htmlTbody=$('.info-sidebar-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data.rows;if(datas.length>0){$('.info-sidebar-tbody').show();$.each(datas,function(i,n){trStr+='<tr><td style="text-align: left;"><input type="hidden" class="budgetPrjAppId" value="'+n.budgetPrjAppId+'" /><a class="yt-link to-detail type">'+n.prjName+'</a></td><td>'+n.prjUnitName+'</td>'+'<td>'+n.applicantUserName+'</td><td>'+n.applicantTime+'</td>';trStr=$(trStr).data("dataStr",n);htmlTbody.append(trStr)})}else{$('.info-sidebar-tbody').hide();htmlTbody.append(sysCommon.noDataTrStr(7))}}else{$('.page1').hide();htmlTbody.append(sysCommon.noDataTrStr(7))}},isSelPageNum:true })},toDetails:function(){$('.yt-table').off("click").on('click','.to-detail',function(){var budgetPrjAppId=$(this).parents('tr').find('.budgetPrjAppId').val();var processInstanceId=$(this).parents('tr').find('.processInstanceId').val();$yt_baseElement.eventStopPageaction();var pageUrl="view/system-sasac/budget/module/projectApproval/budgetApprovalDetails.html?budgetPrjAppId="+budgetPrjAppId+'&processInstanceId='+processInstanceId;if($(this).hasClass('type')){pageUrl+='&type=2'}$yt_baseElement.openNewPage(2,pageUrl)})},getProcessingAndFinishList:function(stateCode){var keyWord=$('.search').val();$('.page2').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:'budget/prjApp/getUserBudgetPrjAppInfoWFListToPageByParams',type:'post',data:{queryStateParams:stateCode,queryParams:keyWord},objName:'data',success:function(data){var htmlTbody=$('.end-table .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data.rows;if(datas.length>0){$('.page2').show();$.each(datas,function(i,n){trStr+='<tr><td><label class="check-label yt-checkbox"><input class="check-but" type="checkbox" name="check" value="'+n.budgetPrjAppId+'"/></label></td><td><a class="yt-link to-detail">'+n.budgetPrjAppNum+'</a><input type="hidden" class="budgetPrjAppId" value="'+n.budgetPrjAppId+'"/><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/></td><td style="text-align: left;">'+n.prjName+'</td><td style="">'+n.prjUnitName+'</td>'+'<td>'+n.applicantDeptName+'</td>';if(stateCode=='WF_COMPLETED_QUERY_SQL_PARAMS'){$(".now-show-th").hide();$(".now-show-td").hide();$(".apply-date-th").show();$(".apply-date-td").show();trStr+='<td>'+n.applicantTime+'</td>'}else{$(".now-show-th").show();$(".now-show-td").show();$(".apply-date-th").hide();$(".apply-date-td").hide();trStr+='<td><a class="yt-link process-state">'+n.nodeNowState+'</a></td>'}trStr+='<td><a class="yt-link log-mod">日志</a></td></tr>';trStr=$(trStr).data("dataStr",n);htmlTbody.append(trStr)});if(stateCode=="WF_SOLVED_QUERY_SQL_PARAMS"){$(".app-state-td,.app-state-th").hide()}else{$(".app-state-td,.app-state-th").show()}beforeApproList.goApprovePage();sysCommon.initQtip($(".log-mod"))}else{$('.page2').hide();htmlTbody.append(sysCommon.noDataTrStr(8))}}else{$('.page1').hide();htmlTbody.append(sysCommon.noDataTrStr(8))}},isSelPageNum:true })},goApprovePage:function(){$(".apprv-btn").off().click(function(){var pageUrl='';var budgetPrjAppId=$(this).parents('tr').find('.budgetPrjAppId').val();var processInstanceId=$(this).parents('tr').find('.processInstanceId').val();var state=$(this).attr('taskKey');pageUrl='view/system-sasac/budget/module/projectApproval/projectApplyApproval.html?budgetPrjAppId='+budgetPrjAppId+'&processInstanceId='+processInstanceId+'&draCode=3';parent.parent.$yt_baseElement.showLoading();window.location.href=$yt_option.websit_path+pageUrl})},checkBoxEvent:function(){$('.checkAll').on('change',function(){var checks=$('.check>table .yt-tbody .check-but');if(this.checked){checks.each(function(){$(this).setCheckBoxState('check')})}else{checks.each(function(){$(this).setCheckBoxState('uncheck')})}});$('.check>table .yt-tbody').on('change','.check-but',function(){var check=true;$('.check>table .yt-tbody .check-but').each(function(){if(!this.checked){check=false;return false}});if(check){$('.checkAll').setCheckBoxState('check')}else{$('.checkAll').setCheckBoxState('uncheck')}})},toProjectSummary:function(){var selData=$('.check>.yt-table>tbody label.check input');if(selData.length>0){if(beforeApproList.verifyProjectName(selData)){var ids='';selData.each(function(i,n){ids+=$(n).val()+(i<selData.length-1?',':'')});window.location.href=$yt_option.websit_path+"view/system-sasac/budget/module/projectApproval/projectApplyApproval.html?budgetPrjAppId="+ids+'&draCode=2'}else{$yt_alert_Model.prompt('请选择相同的项目名称')}}else{$yt_alert_Model.prompt('请选择数据进行操作')}},verifyProjectName:function(data){var verify=true;var prjName=data.eq(0).parents('tr').find('.prj-name').text();$.each(data,function(i,n){if(prjName!=$(n).parents('tr').find('.prj-name').text()){verify=false;return false}});return verify}};$(function(){beforeApproList.init();beforeApproList.searchInput();beforeApproList.switcher();var state=$yt_common.GetRequest().state;if(state){$('.tab-header .tab-li').removeClass('active-li');$('.tab-header .tab-li').eq(1).addClass('active-li');$('.tab-content').eq(1).css("display",'block').siblings('.tab-content').hide()}beforeApproList.searchList();$("#reimApproList").css("min-height",$(window).height()-12)});function checkbox(){var budgetPrjAppIdArr=$("lable.check");console.log(budgetPrjAppIdArr);var budgetPrjAppIdLength=budgetPrjAppIdArr.length;var chestr="";for(i=0;i<budgetPrjAppIdLength;i+=1){if(budgetPrjAppIdArr[i].checked==true){if(budgetPrjAppIdArr[i].value!=""){chestr=budgetPrjAppIdArr[i].value}}}return chestr}