var beforeApproList={searchInput:function(){$('.search').on('keydown',function(){if($(this).val()!=''){$('.clearImg').show()}});$('.clearImg').on('click',function(){$('.search').val('');$(this).hide();beforeApproList.searchList()});$("#resetBtn").off().on("click",function(){$('.search').val('');beforeApproList.searchList()});$("#heardSearchBtn").off().on("click",function(){beforeApproList.searchList()});$("#scanSearch").off().on("click",function(){var reimId=$("div.tab-content:visible").find("table tbody tr:eq(0) .hid-reim-id").val();$yt_alert_Model.alertOne({leftBtnName:"等待扫描...",rightBtnName:"取消",alertMsg:"请使用终端设备扫描报销单的二维码",confirmFunction:function(){var pageUrl='view/system-sasac/expensesReim/module/reimApply/reimApprove.html?reimId='+reimId;window.location.href=$yt_option.websit_path+pageUrl}})})},searchList:function(){var status=$('.active-li input').val();if(status=='WF_SUSPENDING_QUERY_SQL_PARAMS'){beforeApproList.getPendingList(status)}else if(status=='WF_SOLVED_QUERY_SQL_PARAMS'){beforeApproList.getProcessingAndFinishList(status)}else if(status=='WF_COMPLETED_QUERY_SQL_PARAMS'){beforeApproList.getOverendList(status)}else if(status=='WF_DRAFTS_QUERY_SQL_PARAMS'){}},switcher:function(){$('.tab-li').off().on('click',function(){var index=$(this).index();$(this).addClass('active-li').siblings('.tab-li').removeClass('active-li');if(index==1){$('.tab-content').eq(1).css("display",'block').siblings('.tab-content').hide()}else if(index==2){$('.tab-content').eq(2).css("display",'block').siblings('.tab-content').hide()}else{$('.tab-content').eq(index).css("display",'block').siblings('.tab-content').hide()}beforeApproList.searchList()})},getPendingList:function(stateCode){var keyWord=$('.search').val();$('.page1').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:"sz/payApp/getUserPayAppInfoListToPageByParams",type:"post",data:{queryStateParams:stateCode,queryParams:keyWord},objName:'data',success:function(data){var datas=data.data.rows;var htmlTbody=$('.pending .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){if(datas.length>0){$('.page1').show();$.each(datas,function(i,n){trStr+='<tr><td><a class="yt-link to-detail">'+n.paymentAppNum+'</a><input type="hidden" class="pay-app-id" value="'+n.payAppId+'"><input type="hidden" class="pay-app-id" value="'+n.payAppId+'"><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/></td><td class="tl"><div style="white-space: normal;word-break: break-all;word-wrap: break-word;">'+(n.paymentAppName==""?"":n.paymentAppName)+'</div></td><td>'+(n.costType==""?"":n.costType)+'</td><td>'+n.applicantUserName+'</td><td>'+(n.applicantUserDeptName==""?"":n.applicantUserDeptName)+'</td><td style="text-align: right;" class="moneyTreated">'+(n.totalAmount==""?"":($yt_baseElement.fmMoney(n.totalAmount)))+'</td><td>'+(n.applicantTime==""?"":n.applicantTime)+'</td><td><a  class="yt-link flowBtn">'+n.nodeNowState+'</a></td><td class=""><a id=""class="yt-link apprv-btn" taskKey="'+n.taskKey+'">'+(n.taskKey=='activitiStartTask'?'处理':'审批')+'</a><span class="center-line">|</span><a class="yt-link log-mod">日志</a></td></tr>'});htmlTbody.append(trStr);beforeApproList.goApprovePage();beforeApproList.initQtip();beforeApproList.flowWindow();beforeApproList.toDetails();}else{$('.page1').hide();htmlTbody.empty();htmlTbody.append(beforeApproList.noDataTrStr(9))}}else{}},isSelPageNum:true })},getProcessingAndFinishList:function(stateCode){var keyWord=$('.search').val();$('.page2').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:"sz/payApp/getUserPayAppInfoListToPageByParams",type:"post",data:{queryStateParams:stateCode,queryParams:keyWord},objName:'data',success:function(data){var datas=data.data.rows;var htmlTbody=$('.handle-and-end .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){if(stateCode=="WF_SOLVED_QUERY_SQL_PARAMS"){if(datas.length>0){$('.page2').show();$.each(datas,function(i,n){trStr+='<tr><td><a class="yt-link to-detail">'+n.paymentAppNum+'</a><input type="hidden" class="pay-app-id" value="'+n.payAppId+'"><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/></td><td class="tl"><div style="white-space: normal;word-break: break-all;word-wrap: break-word;">'+(n.paymentAppName==""?"":n.paymentAppName)+'</div></td><td>'+(n.costType==""?"":n.costType)+'</td><td>'+n.applicantUserName+'</td><td>'+(n.applicantUserDeptName==""?"":n.applicantUserDeptName)+'</td><td style="text-align: right;" class="moneyTreated">'+(n.totalAmount==""?"":($yt_baseElement.fmMoney(n.totalAmount)))+'</td><td>'+(n.applicantTime==""?"":n.applicantTime)+'</td><td><a  class="yt-link flowBtn">'+n.nodeNowState+'</a></td><td><a class="yt-link log-mod">日志</a></td></tr>'});htmlTbody.append(trStr);beforeApproList.initQtip();beforeApproList.flowWindow();beforeApproList.toDetails()}else{$('.page2').hide();htmlTbody.html('');htmlTbody.empty();htmlTbody.append(beforeApproList.noDataTrStr(9))}}}},isSelPageNum:true })},getOverendList:function(stateCode){var keyWord=$('.search').val();$('.page3').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:"sz/payApp/getUserPayAppInfoListToPageByParams",type:"post",data:{queryStateParams:stateCode,queryParams:keyWord},objName:'data',success:function(data){var datas=data.data.rows;var htmlTbody=$('.overend .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){if(stateCode=="WF_COMPLETED_QUERY_SQL_PARAMS"){if(datas.length>0){$('.page3').show();$.each(datas,function(i,n){trStr+='<tr><td><a class="yt-link to-detail">'+n.paymentAppNum+'</a><input type="hidden" class="pay-app-id" value="'+n.payAppId+'"><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/></td><td class="tl"><div style="white-space: normal;word-break: break-all;word-wrap: break-word;">'+(n.paymentAppName==""?"":n.paymentAppName)+'</div></td><td>'+(n.costType==""?"":n.costType)+'</td><td>'+n.applicantUserName+'</td><td>'+(n.applicantUserDeptName==""?"":n.applicantUserDeptName)+'</td><td style="text-align: right;" class="moneyTreated">'+(n.totalAmount==""?"":($yt_baseElement.fmMoney(n.totalAmount)))+'</td><td>'+(n.applicantTime==""?"":n.applicantTime)+'</td><td>'+n.nodeNowState+'</td><td><a class="yt-link log-mod">日志</a></td></tr>'});htmlTbody.append(trStr);beforeApproList.initQtip();beforeApproList.flowWindow();beforeApproList.toDetails()}else{$('.page3').hide();htmlTbody.empty();htmlTbody.append(beforeApproList.noDataTrStr(9))}}}},isSelPageNum:true })},noDataTrStr:function(trNum){var noDataStr='<tr style="border:0px;background-color:#fff !important;"><td  colspan="'+trNum+'" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';return noDataStr},goApprovePage:function(){$(".apprv-btn").off().click(function(){beforeApproList.eventStopPageaction();var payAppId=$(this).parents('tr').find('.pay-app-id').val();var taskKey=$(this).attr('taskKey');if(taskKey=='activitiStartTask'){window.location.href=$yt_option.websit_path+'view/system-sasac/expensesReim/module/payment/paymentApply.html?payAppId='+payAppId}else{window.location.href=$yt_option.websit_path+'view/system-sasac/expensesReim/module/payment/paymentApproval.html?payAppId='+payAppId}})},toDetails:function(){$('.yt-link.to-detail').off("click").on('click',function(){beforeApproList.eventStopPageaction();var processInstanceId=$(this).parents('tr').find('.processInstanceId').val();var payAppId=$(this).parents('tr').find('.pay-app-id').val();var pageUrl="view/system-sasac/expensesReim/module/payment/paymentApplyDetail.html?processInstanceId="+processInstanceId+"&payAppId="+payAppId;var goPageUrl="view/system-sasac/expensesReim/module/approval/paymentApprovalList.html";window.open($yt_option.websit_path+"index.html?pageUrl="+encodeURIComponent(pageUrl)+'&goPageUrl='+goPageUrl)})},eventStopPageaction:function(){var e=arguments.callee.caller.arguments[0]||event;if(e&&e.stopPropagation){e.stopPropagation()}else if(window.event){window.event.cancelBubble=true}},initQtip:function(){$('.log-mod').qtip({content:{text:function(event,api){var txt='';var WorkFlowLogList=[];var td=$(this).parent("td").prevAll("td");var processInstanceId=td.find('.processInstanceId').val();$.ajax({type:"post",url:"basicconfig/workFlow/getWorkFlowLog",async:false,data:{processInstanceId:processInstanceId},success:function(data){if(data.data!=undefined&&data.data!=null){WorkFlowLogList=data.data}if(WorkFlowLogList==null||WorkFlowLogList==undefined){return}shomd="";shomd='<div class="suspension" >';var WorkFlowLog;for(var i=0;i<WorkFlowLogList.length;i+=1){WorkFlowLog=WorkFlowLogList[i];if(i==0){shomd+='<div class="log-msg-model"><div><div class="first-log-msg"><span class="log-num">'+(WorkFlowLogList.length-i)+'</span></div><span class="user-name">'+(WorkFlowLog.userName==""?'无':WorkFlowLog.userName)+'</span><div style="clear:both;"></div></div><div class="log-line-div" style="'+(i==(WorkFlowLogList.length-1)?"padding-bottom: 0px;":"padding-bottom: 10px;")+''+(WorkFlowLogList.length==1?"border:0px;":"")+'"><div style="'+(WorkFlowLogList.length==1?"border:0px;":"border-bottom: 1px solid #D6E6F3;")+'"><div class="oper-status-model"><label class="log-label-text">操作状态</label><span>：</span><span>'+(WorkFlowLog.taskName==""?"无":WorkFlowLog.taskName)+'</span></div><div class="oper-time-model"><label class="log-label-text">操作时间</label><span>：</span><span>'+(WorkFlowLog.commentTime==""?"无":WorkFlowLog.commentTime)+'</span></div>';if(WorkFlowLog.comment!=""&&WorkFlowLog.comment!=null&&WorkFlowLog.comment!=" "){shomd+='<div class="log-comment-model"><label class="log-label-text">操作意见</label><span>：</span><div class="oper-comment-msg">'+WorkFlowLog.comment+'</div></div>'}shomd+='</div></div>'}else{shomd+='<div class="log-msg-model"><div><div class="log-msg-def-bak"><span class="log-num">'+(WorkFlowLogList.length-i)+'</span></div><span class="user-name" style="top:0px;">'+(WorkFlowLog.userName==""?'无':WorkFlowLog.userName)+'</span><div style="clear:both;"></div></div><div class="log-line-div" style="'+(i==(WorkFlowLogList.length-1)?"padding-bottom: 0px;":"padding-bottom: 10px;")+''+(i==(WorkFlowLogList.length-1)?"border:0px;":"")+'"><div style="'+(i==(WorkFlowLogList.length-1)?"border:0px;":"border-bottom: 1px solid #D6E6F3;")+'"><div class="oper-status-model"><label class="log-label-text">操作状态</label><span>：</span><span>'+(WorkFlowLog.taskName==""?"无":WorkFlowLog.taskName)+'</span></div><div class="oper-time-model"><label class="log-label-text">操作时间</label><span>：</span><span>'+(WorkFlowLog.commentTime==""?"无":WorkFlowLog.commentTime)+'</span></div>';if(WorkFlowLog.comment!=""&&WorkFlowLog.comment!=null&&WorkFlowLog.comment!=" "){shomd+='<div class="log-comment-model"><label class="log-label-text">操作意见</label><span>：</span><div class="oper-comment-msg">'+WorkFlowLog.comment+'</div></div>'}shomd+='</div></div>'}shomd+='</div>'}}});return(WorkFlowLogList.length<1?'<span style="color:#999">暂无数据</span>':shomd);}},position:{my:'right top',at:'left top',container:false,viewport:$('body'),adjust:{x:0,y:0,mouse:true,resize:true,method:'flip flip'}},hide:{fixed:true,},style:{classes:'showmod',tip:{corner:true,mimic:false,width:10,height:10,border:true,offset:0}},events:{show:function(data){$(data.target).find(".qtip-content").css("max-height",$('#frame-right-model').height()-200)}}})},flowWindow:function(){$('.flowBtn').off().on('click',function(){$(".flowWindow").show();$yt_alert_Model.getDivPosition($(".yt-edit-alert.flowWindow"));var processInstanceId=$(this).parent('td').parent('tr').find('.processInstanceId').val();$('.imgBox').html('<img src="'+$yt_option.workFlow+'findPngByProcessInstanceId?processInstanceId='+processInstanceId+'">');$('.flowWindow .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".flowWindow").hide()})})}};$(function(){beforeApproList.searchInput();beforeApproList.switcher();var state=$yt_common.GetRequest().state;if(state){$('.tab-header .tab-li').removeClass('active-li');$('.tab-header .tab-li').eq(1).addClass('active-li');$('.tab-content').eq(1).css("display",'block').siblings('.tab-content').hide()}beforeApproList.searchList();$("#reimApproList").css("min-height",$(window).height()-12);beforeApproList.goApprovePage()});