var mal={initDate:function(){$(".body-div").css("min-height",$(window).height()-16);$("#startDate").calendar({controlId:"startTime",nowData:false,upperLimit:$("#endDate"),speed:0,callback:function(){}});$("#endDate").calendar({controlId:"endTime",nowData:false,lowerLimit:$("#startDate"),speed:0,callback:function(){}});mal.setAddselect();mal.moneyFormat();mal.getDraftsList();mal.thisEvent()},thisEvent:function(){$(".drafts-search-btn").click(function(){mal.getDraftsList()});$(".drafts-reset-btn").click(function(){$(".apply-reason").val('');$(".apply-type").html('<option value="">请选择</option>');mal.setAddselect();$(".apply-type").niceSelect();$(".save-begin-date").val('');$(".save-end-date").val('');$(".apply-begin-money").val('');$(".apply-end-money").val('');mal.getDraftsList()});$(".drafts-list").on('click','.operate-update',function(){var thisObj=$(this);var tr=thisObj.parents("tr");var type=tr.attr('formType');var id=tr.attr('pkId');mal.formTypeUpdata(type,id)});$(".drafts-list").on('click','.operate-del',function(){var thisObj=$(this);var tr=thisObj.parents("tr");var type=tr.attr('formType');var id=tr.attr('pkId');$yt_alert_Model.alertOne({alertMsg:"确定要删除此条数据吗?",leftBtnName:"确定",confirmFunction:function(){mal.formTypeEvent(type,id)}})})},setAddselect:function(thisData){var me=this;$.ajax({type:"post",data:{dictTypeCode:'APPLY_TYPE'},url:'basicconfig/dictInfo/getDictInfoByTypeCode',success:function(data){var datas=data.data;$.each(datas,function(i,n){var value=n.value;if(value!='CHANGE_APP'&&value!='FINAL_APP'){$('select.user-name-sel').append('<option value="'+n.value+'">'+n.disvalue+'</option>')}});$("select.user-name-sel").niceSelect()}})},moneyFormat:function(){$(".top-money,.bottom-money").on("focus",function(){if($(this).val()!=""){$(this).val($yt_baseElement.rmoney($(this).val()))}});$(".top-money,.bottom-money").on("blur",function(){if($(this).val()!=""){$(this).val($yt_baseElement.fmMoney($(this).val()))}})},getDraftsList:function(){var me=this;var applyReason=$(".apply-reason").val();var applyType=$(".apply-type").val();var saveBgDate=$(".save-begin-date").val();var saveEndDate=$(".save-end-date").val();var applyBgMoney="";if($(".apply-begin-money").val()){applyBgMoney=$yt_baseElement.rmoney($(".apply-begin-money").val())}var applyEndMoney="";if($(".apply-end-money").val()){applyEndMoney=$yt_baseElement.rmoney($(".apply-end-money").val())}$('.page1').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:'sz/applyApp/DraftsAppInfo',type:"post",data:{startDate:saveBgDate,endDate:saveEndDate,queryParams:applyReason,formType:applyType,startAmount:applyBgMoney,endAmount:applyEndMoney,type:"expenditure"},objName:'data',success:function(data){var htmlTbody=$('.plan-list-model .yt-tbody.drafts-list');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data.rows;if(datas.length>0){$('.page1').show();$.each(datas,function(i,n){trStr+='<tr pkId='+n.pkId+' formType='+n.formType+'><td>'+n.applicantTime+'</td><td style="text-align: left;">'+n.appName+'</td><td>'+n.formTypeName+'</td><td style="text-align: right;">'+$yt_baseElement.fmMoney(n.totalAmount)+'</td><td width: 150px;><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});htmlTbody.append(trStr)}else{$('.page1').hide();htmlTbody.html(sysCommon.noDataTrStr(5))}}},isSelPageNum:true })},formTypeUpdata:function(type,id,fun){switch(type){case 'ADVANCE_APP':window.location.href=$yt_option.websit_path+'view/system-sasac/expensesReim/module/busiTripApply/serveApply.html?advanceId='+id;break;case 'LOAN_APP':window.location.href=$yt_option.websit_path+'view/system-sasac/expensesReim/module/loanApply/loanApply.html?loanId='+id;break;case 'REIM_APP':window.location.href=$yt_option.websit_path+'view/system-sasac/expensesReim/module/reimApply/serveFunds.html?reimId='+id;break;case 'PAYMENT_APP':window.location.href=$yt_option.websit_path+'view/system-sasac/expensesReim/module/payment/paymentApply.html?payAppId='+id;break;case 'EXPENDITURE_APP':var systemId=$yt_common.GetQueryString("systemId");var menuId=$yt_common.GetQueryString("menuId");window.location.href=$yt_option.websit_path+'view/system-sasac/expensesReim/module/reimApply/expenseAccount.html?appId='+id+"&systemId="+systemId+"&menuId="+menuId;break;case 'FINAL_APP':window.location.href=$yt_option.websit_path+'view/system-sasac/expensesReim/module/finalApply/finalAccount.html?appId='+id;break;case 'CHANGE_APP':window.location.href=$yt_option.websit_path+'view/system-sasac/expensesReim/module/busiTripApply/projectServeApply.html?appId='+id;break;default:break}},formTypeEvent:function(type,id,fun){switch(type){case 'ADVANCE_APP':mal.deleteAdvanceInfoById(id);break;case 'LOAN_APP':mal.deleteLoanInfoById(id);break;case 'REIM_APP':mal.deleteReimInfoById(id);break;case 'PAYMENT_APP':mal.deletePaymentInfoById(id);break;case 'EXPENDITURE_APP':mal.deleteExpenditureInfoById(id);break;case 'FINAL_APP':mal.deleteFinalInfoById(id);break;case 'CHANGE_APP':mal.deleteAdvanceUpdateById(id);default:break}},deleteAdvanceInfoById:function(id){$.ajax({type:"post",url:"sz/advanceApp/deleteAdvanceInfoById",async:true,data:{advanceId:id},success:function(data){if(data.flag==0){mal.getDraftsList()}$yt_alert_Model.prompt(data.message)}})},deleteLoanInfoById:function(id){$.ajax({type:"post",url:"sz/loanApp/deleteLoanInfoById",async:true,data:{loanId:id},success:function(data){if(data.flag==0){mal.getDraftsList()}$yt_alert_Model.prompt(data.message)}})},deleteReimInfoById:function(id){$.ajax({type:"post",url:"sz/reimApp/deleteReimInfoById",async:true,data:{reimId:id},success:function(data){if(data.flag==0){mal.getDraftsList()}$yt_alert_Model.prompt(data.message)}})},deletePaymentInfoById:function(id){$.ajax({type:"post",url:"sz/payApp/deletePaymentInfoById",async:true,data:{paymentId:id},success:function(data){if(data.flag==0){mal.getDraftsList()}$yt_alert_Model.prompt(data.message)}})},deleteExpenditureInfoById:function(id){$.ajax({type:"post",url:"sz/expenditureApp/deleteExpenditureInfoById",async:true,data:{appId:id},success:function(data){if(data.flag==0){mal.getDraftsList()}$yt_alert_Model.prompt(data.message)}})},deleteFinalInfoById:function(id){$.ajax({type:"post",url:"sz/finalApp/deleteFinalInfoById",async:true,data:{appId:id},success:function(data){if(data.flag==0){mal.getDraftsList()}$yt_alert_Model.prompt(data.message)}})},deleteAdvanceUpdateById:function(id){$.ajax({type:"post",url:"sz/advanceAppUpdate/deleteAdvanceUpdateById",async:true,data:{appId:id},success:function(data){if(data.flag==0){mal.getDraftsList()}$yt_alert_Model.prompt(data.message)}})}};$(function(){mal.initDate()});