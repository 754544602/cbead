var printTE={expenditureAppId:'',processInstanceId:'',inits:function(){printTE.expenditureAppId=$yt_common.GetQueryString('expenditureAppId');printTE.processInstanceId=$yt_common.GetQueryString('processInstanceId');var flowLogHtml=sysCommon.getCommentByProcessInstanceId(printTE.processInstanceId);$(".flow-log-div").html(flowLogHtml);printTE.events();printTE.initDate()},events:function(){$("#printBtn").off().on("click",function(){printTE.doPrint()});$("#closeBtn").off().on("click",function(){parent.closeWindow()})},initDate:function(){$.ajax({type:"post",url:"sz/expenditureApp/printTravelExpensesByExpenditureAppId",async:true,data:{expenditureAppId:printTE.expenditureAppId,},success:function(data){if(data.flag==0){var datas=data.data;$(".expenditure-app-num").text(datas.expenditureAppNum);$(".expenditure-app-num").text(datas.expenditureAppNum);var entryVal=[];var entryLength=0;entryVal=datas.expenditureAppName.split('');$(entryVal).each(function(i,n){if(n.charCodeAt()>255){entryLength+=2;}else{entryLength+=1;}});if(entryLength>=68){$(".expenditure-app-name").addClass("expenditure-app-name-css");if(entryLength>=136){$(".expenditure-app-name").css("font-size","12px")}}$(".expenditure-app-name").text(datas.expenditureAppName);$(".total-amount").text(datas.totalAmount);$(".invoice-num").text(datas.invoiceNum);$(".applicant-user").text(datas.applicantUser);$(".applicant-user-name").text(datas.applicantUserName);$(".applicant-user-dept-name").text(datas.applicantUserDeptName);$(".print-year").text(datas.printYear);$(".print-month").text(datas.printMonth);$(".print-day").text(datas.printDay);$(".travel-personnels").text(datas.travelPersonnels);$(".travel-personnels-name").text(datas.travelPersonnelsName);$(".travel-subsidy-day").text(datas.travelSubsidyDay);$(".hotel-amount").text($yt_baseElement.fmMoney(datas.hotelAmount));$(".city-fare").text($yt_baseElement.fmMoney(datas.cityFare));$(".post-fee").text($yt_baseElement.fmMoney(datas.postFee));$(".office-supplies").text($yt_baseElement.fmMoney(datas.officeSupplies));$(".un-sleeper-subsidy").text($yt_baseElement.fmMoney(datas.unSleeperSubsidy));$(".other").text($yt_baseElement.fmMoney(datas.other));$(".write-offs").text($yt_baseElement.fmMoney(datas.writeOffs));var thisTr=$(".travel-start-tr");thisTr.find('td').eq(11).text(datas.travelSubsidyDay);thisTr.find('td').eq(12).text($yt_baseElement.fmMoney(datas.travelSubsidyAmount));var carFareTotal=0;var travelExpenseTotal=datas.travelSubsidyAmount;var otherTotal=0;$(datas.travelCostList).each(function(i,n){thisTr.find("td").eq(0).text(n.goMonth);thisTr.find("td").eq(1).text(n.goDay);thisTr.find("td").eq(2).text();thisTr.find("td").eq(3).text(n.goAddressName);thisTr.find("td").eq(4).text(n.arrivalMonth);thisTr.find("td").eq(5).text(n.arrivalDay);thisTr.find("td").eq(6).text();thisTr.find("td").eq(7).text(n.arrivalAddressName);thisTr.find("td").eq(8).text(n.vehicleName);thisTr.find("td").eq(9).text();thisTr.find("td").eq(10).text(n.carfare);thisTr.find("td").eq(11).text();thisTr.find("td").eq(12).text();carFareTotal+=0;travelExpenseTotal+=0;if(i>=5){thisTr.after('<tr style=""><td class="tr"></td> <td class="tr"></td> <td></td> <td class="tl"></td><td class="tr"></td> <td class="tr"></td> <td></td> <td class="tl"></td><td class="tl"></td> <td class="tr"></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>');$(".rowspan-td").attr("rowspan",(i+7))}thisTr=thisTr.next()});if($(".travel-table tr").length>15){thisTr.remove()}$(".car-fare-total").text($yt_baseElement.fmMoney(carFareTotal));$(".travel-expense-total").text($yt_baseElement.fmMoney(travelExpenseTotal));$(".other-total").text($yt_baseElement.fmMoney($yt_baseElement.rmoney(datas.hotelAmount)+$yt_baseElement.rmoney(datas.cityFare)+$yt_baseElement.rmoney(datas.postFee)+$yt_baseElement.rmoney(datas.officeSupplies)+$yt_baseElement.rmoney(datas.unSleeperSubsidy)+$yt_baseElement.rmoney(datas.other)));var totalMoney=$yt_baseElement.rmoney($(".other-total").text())+carFareTotal+travelExpenseTotal;$(".total-money").text(arabiaToChinese(totalMoney+''));if((totalMoney-datas.writeOffs)>0){$(".replace-money").text($yt_baseElement.fmMoney((totalMoney-datas.writeOffs)))}else{$(".return-money").text($yt_baseElement.fmMoney((totalMoney-datas.writeOffs)))}}else{$yt_alert_Model.prompt(data.message)}}})},doPrint:function(){bdhtml=window.document.body.innerHTML;sprnstr="<!--startprint-->";eprnstr="<!--endprint-->";prnhtml=bdhtml.substr(bdhtml.indexOf(sprnstr)+17);prnhtml=prnhtml.substring(0,prnhtml.indexOf(eprnstr));window.document.body.innerHTML=prnhtml;window.print();window.document.body.innerHTML=bdhtml;window.location.reload()}};$(function(){printTE.inits()});