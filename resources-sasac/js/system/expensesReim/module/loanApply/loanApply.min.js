var loanApply={loanId:"",riskExcMark:"../../../../../resources-sasac/images/common/war-red.png",riskWarImg:"../../../../../resources-sasac/images/common/risk-war.png",riskViaImg:"../../../../../resources-sasac/images/common/risk-via.png",init:function(){var requerParameter=$yt_common.GetRequest();loanApply.loanId=requerParameter.loanId;sysCommon.getLoginUserInfo();$("#loanApply select").niceSelect();loanApply.getInitFunDatas();$("#returnDate").calendar({speed:0,complement:true,readonly:true,lowerLimit:"2010/01/01",nowData:false,speed:0,dateFmt:"yyyy-MM-dd",callback:function(){$("#returnDate").parent().find(".risk-img").attr("src",loanApply.riskViaImg);sysCommon.clearValidInfo($("#returnDate"))}});loanApply.loanMoneyEvent();loanApply.funOperationEvent(loanApply.eaa);$("#loanApply").css("min-height",$(window).height()-32);loanApply.events();loanApply.fmMonList();if(loanApply.loanId!=""&&loanApply.loanId!=null){loanApply.getLoanDetailById()};loanApply.getCurrentUserIsSettleInfo();loanApply.getDictInfoByTypeCode();loanApply.alertClearReceivables();loanApply.getBusiTripUsersList('');loanApply.getArrearsAmount();loanApply.getAllPaymentReceivablesUnitList($("#companyPram").val());$("#userRadio").val($yt_common.user_info.userName);$(".user-radio-label").change(function(){var userCode=$(this).find("input").val();$('#payeeName option[value="'+userCode+'"]').prop("selected","selected");loanApply.setPayeeNameSelect(userCode);var jobLevelName=$('#payeeName option[value="'+userCode+'"]').attr("jobLevelName");var deptName=$('#payeeName option[value="'+userCode+'"]').attr("deptName");$(".pe-department").text(deptName);$(".pe-rank").text(jobLevelName==""?"--":jobLevelName);$(".display-rank,.dis-r").show();$("input.where-company").removeAttr("validform");if(userCode==$("#userRadio").val()){loanApply.getPaymentReceivablesPersonalByUserCode(userCode,'')}setTimeout(function(){$("label.user-radio-label").hide().removeClass("check");$("label.user-radio-label input").prop("checked",false)},200)})},getCurrentUserIsSettleInfo:function(){$.ajax({type:"post",url:"sz/loanApp/getCurrentUserIsSettleInfo",async:false,data:{},success:function(data){if(data.flag==0){$("#noCloseOut").text(data.data.noCloseOut);if(data.data.rows.length>0){var datas=data.data.rows;var htmlSpan="";$.each(datas,function(i,n){if(datas.length-1==i){htmlSpan+='<a class="yt-link to-detail" loanAppId="'+n.loanAppId+'">'+n.loanAppNumStr+'</a>'}else{htmlSpan+='<a class="yt-link to-detail" loanAppId="'+n.loanAppId+'">'+n.loanAppNumStr+'</a>,'}});$("#loanAppNumStr").html(htmlSpan);loanApply.toDetails()}else{$("#loanAppNumStr").text('--')}}}})},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},rmoney:function(str){return $yt_baseElement.rmoney(str||'0')},getAllPaymentReceivablesUnitList:function(keyword){$.ajax({type:"post",url:'sz/expenditureApp/getAllPaymentReceivablesUnit',async:true,data:{unitName:keyword},success:function(data){loanApply.payeeCompanyList=data.data.paymentReceivablesUnitList}})},fmMonList:function(){$(".refund-tab-inp").attr("placeholder","0.00");var moneyInpArray=$(".refund-tab-inp");for(j=0;j<moneyInpArray.length;j+=1){if(moneyInpArray.eq(j).val()!=''){moneyInpArray.eq(j).val($yt_baseElement.fmMoney(moneyInpArray.eq(j).val()))}};var moneyTextArray=$(".moneyText");for(h=0;h<moneyTextArray.length;h+=1){if(moneyTextArray.eq(h).text()!=''){moneyTextArray.eq(h).text($yt_baseElement.fmMoney(moneyTextArray.eq(h).text()))}else{moneyTextArray.eq(h).text($yt_baseElement.fmMoney(0))}}},events:function(){var me=this;$('.refund-tab-inp,.money-input').on('focus',function(){var ts=$(this);if(ts.val()!=""){ts.val($yt_baseElement.rmoney(ts.val()))}});$('.refund-tab-inp,.money-input').on('blur',function(){var ts=$(this);if(ts.val()!=''){ts.val($yt_baseElement.fmMoney(ts.val()))}});$('.refund-tab-inp,.money-input').on('keyup',function(){var ts=$(this);if(ts.val()!=''){ts.val(ts.val().replace(/[^\d.]/g,''))}});$('.yt-table tbody').on('click','tr',function(){var ts=$(this);var trs=ts.siblings();trs.removeClass('yt-table-active');ts.addClass('yt-table-active')});$("#cancelBtn").off().on('click',function(){window.history.back(-1)});$('#cash,#officialCard,#transferAccounts').on('focus',function(){if($(this).val()=='0'){$(this).val('')}});$(".receipt-alert .cost-type-tab li").click(function(){loanApply.clearAlert($(".model-content"));$("label.user-radio-label").show();$(".display-rank").hide();$('#cash,#officialCard,#transferAccounts').val('0.00');$('.arrears-money').text(0.00);$('.pe-department,.pe-rank').text('');$('.receipt-alert .display-loan').hide();loanApply.setPayeeNameSelect();$(this).addClass("tab-check").siblings().removeClass("tab-check");var tabIndex=$(this).index();$(".receipt-alert .tab-info").hide().eq(tabIndex).show();$yt_alert_Model.getDivPosition($('#cost-apply-model'))});$("#companyName").on("keyup",function(){$("#companyNameList ul").empty();$("#openBank").val('');$("#accountNumber").val('');var companyName=$("#companyName");var text='';var html='';text=companyName.val();var arr=loanApply.payeeCompanyList;var map={},dest=[];for(var i=0;i<arr.length;i+=1){var ai=arr[i];if(!map[ai.unitName]){dest.push({unitName:ai.unitName,openBank:ai.openBank,accounts:ai.accounts});map[ai.unitName]=ai}else{for(var j=0;j<dest.length;j+=1){var dj=dest[j];if(dj.unitName==ai.unitName){break}}}};$.each(dest,function(i,n){if(n.unitName.indexOf(text)!=-1){html+='<li unitName="'+n.unitName+'" openBank="'+n.openBank+'" accounts="'+n.accounts+'">'+n.unitName+'</li>'}});$("#companyNameList ul").append(html);$("#companyNameList").show();$("#companyNameList ul li").off().on("click",function(){var companyName=$(this).text();var openBank=$(this).attr('openBank');var accounts=$(this).attr('accounts');$("#companyName").val(companyName).attr({'openBank':openBank,'accounts':accounts});$("#openBank").val(openBank);$("#accountNumber").val(accounts);$("#companyNameList").hide()})});me.updataPersonal();me.updataReceivables();me.updataOther()},getPaymentReceivablesPersonalByUserCode:function(userCode,username){$.ajax({type:"post",url:"sz/loanApp/getPaymentReceivablesPersonalByUserCode",async:true,data:{userCode:userCode,username:username},success:function(data){if(data.data!=null){$("#bankName").val(data.data.openBank);$("#payeeBank").val(data.data.accounts);$("#offOpenBank").val(data.data.offOpenBank);$("#offAccounts").val(data.data.offAccounts);$("#idCarkno").val(data.data.idCarkno);$("#phoneNum").val(data.data.phoneNum);$("#personalUnit").val(data.data.personalUnit)}else{$("#bankName").val('');$("#payeeBank").val('');$("#offOpenBank").val('');$("#offAccounts").val('');$("#idCarkno").val('');$("#phoneNum").val('');$("#personalUnit").val('')}}})},getChoiceLoanList:function(code){var userCode=$('#payeeName option:selected').val();$.ajax({type:"post",url:"sz/loanApp/getLoanAppInfoListToPageByParams",async:true,data:{queryParams:'',userCode:userCode,pageIndex:1,pageNum:99999},success:function(data){var list=data.data.rows||[];var opts='<option value="">请选择</option>';$.each(list,function(i,n){opts+='<option '+(code==n.loanAppId?'selected="selected"':'')+' arrearsAmount="'+n.arrearsAmount+'" value="'+n.loanAppId+'">'+n.loanAppNum+'</option>';if(code==n.loanAppId){$('.arrears-money').text(loanApply.fmMoney(n.arrearsAmount))}});$('#choiceLoan').html(opts).niceSelect()}})},getArrearsAmount:function(){var me=this;$('#personalTotal').on('blur',function(){loanApply.calculatePaymentAlertPerson()});$("#choiceLoan").change(function(){loanApply.calculatePaymentAlertPerson()});$("#witeOffPersonal").change(function(){var thischange=$("#witeOffPersonal").find("option:selected").val();if(thischange=='LOAN_REVERSE'){$(".display-loan").show()}else{$(".display-loan").hide();$('.arrears-money,.the-reverse-money').text('0.00');$('.personal-writeoff-money').text($('#personalTotal').val())}me.getChoiceLoanList()});$("#payeeName").change(function(){var jobLevelName=$("#payeeName").find("option:selected").attr("jobLevelName");var deptName=$("#payeeName").find("option:selected").attr("deptName");$(".pe-department").text(deptName);$(".pe-rank").text(jobLevelName);$("#payeeName").next().find(".current").text($("#payeeName").find("option:selected").attr("username"));$("label.user-radio-label").hide().removeClass("check");$("#userRadio").prop("checked",false);var userCode=$('#payeeName option:selected').val();var isChange=$("#payeeName").find("option:selected").val();var username=$('#payeeName').next().find(".search-current").val();if(isChange=='external'||isChange=='noUser'){$(".display-rank").show();$(".pe-department").text("外部人员");$(".dis-r").hide();$(".where-company").show();$("input.where-company").attr("validform","{isNull:true,blurFlag:true,msg:'请输入收款人所在单位'}")}else{if(isChange==""){$(".display-rank").hide()}else{$(".display-rank").show();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").show()}}loanApply.getChoiceLoanList();loanApply.getPaymentReceivablesPersonalByUserCode(userCode,username)});$('table.payee-personal').on('click','.to-data',function(){var tr=$(this).parents('tr');$('#perPayeeName').text(tr.attr('payeename')||'--');$('#perPersonalTotal').text(tr.attr('personalTotal')||'0.00');var choiceLoan=tr.attr('choiceLoan');if(choiceLoan&&choiceLoan!='请选择'){$('.personal-payment .display-loan').show();$('#perChoiceLoan').text(tr.attr('choiceLoan')||'--');$('.per-arrears-money').text(tr.attr('arrearsmoney')||'0.00');$('.per-reverse-money').text(tr.attr('thereversemoney')||'0.00')}else{$('.personal-payment .display-loan').hide();$('#perChoiceLoan').text('');$('.per-arrears-money').text('0.00');$('.per-reverse-money').text('0.00')}$('#perWiteOffPersonal').text(tr.find('td').eq(2).text()||'无');if(tr.attr('witeOffPersonal')){$('.personal-payment .display-loan').show()}else{$('.personal-payment .display-loan').hide()}$('.per-writeoff-money').text(tr.attr('personalWriteoff')||'0.00');$('#perCash').text(tr.attr('cash')||'0.00');$('#perOfficialCard').text(tr.attr('officialCard')||'0.00');$('#perTransferAccounts').text(tr.attr('transferAccounts')||'0.00');$('#perIdCarkno').text(tr.attr('idCarkno')||'--');$('#perPayeeBank').text(tr.attr('payeeBank')||'--');$('#perPerank').text(tr.attr('personalUnit')||'--');$('#perBankName').text(tr.attr('bankName')||'--');$('#perPhoneNum').text(tr.attr('phoneNum')||'--');$('#perOffOpenBank').text(tr.attr('offOpenBank')||'--');$('#perOffAccounts').text(tr.attr('offAccounts')||'--');var payeeRadio=tr.attr('payeeRadio');$('#payeeRadio').text(payeeRadio==1?'有':'无');$('#perSpecial').text(tr.attr('personalSpecial'));$('#personalPayment').show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#personalPayment'));$('#pop-modle-alert').show();$('#personalPayment').show()});$('#personalPayment .model-bottom-btn .yt-cancel-btn').on('click',function(){$yt_baseElement.hideMongoliaLayer();$('#pop-modle-alert').hide();$('#personalPayment').hide();$('#perPayeeName').text('--');$('#perPersonalTotal').text('0.00');$('.personal-payment .display-loan').hide();$('#perChoiceLoan').text('--');$('.per-arrears-money').text('0.00');$('.per-arrears-money').text('0.00');$('#perWiteOffPersonal').text('--');$('.per-writeoff-money').text('0.00');$('#perCash').text('0.00');$('#perOfficialCard').text('0.00');$('#perTransferAccounts').text('0.00');$('#perIdCarkno').text('--');$('#perPerank').text('--');$('#perPayeeBank').text('--');$('#perBankName').text('--');$('#perPhoneNum').text('--');$('#payeeRadio').text('--');$('#perSpecial').text('无')});$('.rece-msg').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();loanApply.companyTotal();loanApply.personalTotal();loanApply.otherTotal()}})})},calculatePaymentAlertPerson:function(){var total=$yt_baseElement.rmoney($('#personalTotal').val());var arrearsAmount=$("#choiceLoan").find("option:selected").attr("arrearsAmount")||0;$(".arrears-money").text($yt_baseElement.fmMoney(arrearsAmount));var outWriteAmount=total<=arrearsAmount?total:arrearsAmount;$('.the-reverse-money').text($yt_baseElement.fmMoney(outWriteAmount));var personalTotal=$yt_baseElement.rmoney($('#personalTotal').val()||'0');var writeTotal=personalTotal-outWriteAmount;writeTotal=writeTotal>0?writeTotal:0;$('.personal-writeoff-money').text(loanApply.fmMoney(writeTotal))},getLoanDetailById:function(){var me=this;$.ajax({type:"post",url:"sz/loanApp/getLoanAppInfoDetailByLoanAppId",async:false,data:{loanAppId:loanApply.loanId},success:function(data){if(data.flag==0){var dataObj=data.data;if(dataObj&&dataObj!=""&&dataObj!=undefined){$("#busiUsers").text(dataObj.applicantUserName);$("#deptName").text(dataObj.applicantUserDeptName);$("#jobName").text(dataObj.applicantUserPositionName==""?"--":dataObj.applicantUserPositionName);$("#telPhone").text(dataObj.applicantUserPhone==""?"--":dataObj.applicantUserPhone);$("#loanApply").setDatas(dataObj);$("#moneyLower").text(arabiaToChinese(dataObj.loanAmount+''));$("#lifeOfLoan option").each(function(){if($(this).text()==dataObj.loanTerm){$(this).attr("selected",true)}});$("#lifeOfLoan").niceSelect();if(dataObj.isSettleInfo){$("#loanAppNumStr").text(dataObj.isSettleInfo.loanAppNumStr||'--');$("#noCloseOut").text(dataObj.isSettleInfo.noCloseOut)}me.setHeringUnitList(dataObj.payReceivablesData.gatheringUnitList);me.setHeringPersonList(dataObj.payReceivablesData.gatheringPersonList);me.setHeringOtherList(dataObj.payReceivablesData.gatheringOtherList)}sysCommon.getApproveFlowData("SZ_LOAN_APP",dataObj.processInstanceId)}else{$yt_alert_Model.prompt(data.message,2000)}}})},getInitFunDatas:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:false,data:{dictTypeCode:"AMOUNT_NATURE"},success:function(data){if(data.flag==0){var optionText='<option value="">请选择</option>';if(data.data.length>0){$.each(data.data,function(i,n){if(n.dictTypeCode=="AMOUNT_NATURE"){optionText='<option value="'+n.value+'">'+n.disvalue+'</option>';$("#moneyQuality").append(optionText);$("#moneyQuality").niceSelect();$("#moneyQuality").on("change",function(){loanApply.getProjectInfoList($("#prjKeyWord").val(),$(this).val())})}});$("#moneyQuality").niceSelect()}}}});sysCommon.getApproveFlowData("SZ_LOAN_APP")},funOperationEvent:function(){$('#approveCanelBtn').on("click",function(){loanApply.clearPageData()});$("#approveSubBtn").off().on("click",function(){var thisBtn=$(this);$(this).attr('disabled',true).addClass('btn-disabled');var ajaxUrl="";var validFlag=true;var fromUrl='';if(thisBtn.hasClass("sub-btn")){ajaxUrl="sz/loanApp/submitLoanAppInfo";validFlag=$yt_valid.validForm($("#loanApply"));fromUrl='view/system-sasac/expensesReim/module/approval/myApplyList.html'}var paytotal=$yt_baseElement.rmoney($('.payee-unit-money').text());var pertotal=$yt_baseElement.rmoney($('.payee-personal-money').text());var othtotal=$yt_baseElement.rmoney($('.payee-other-total-money').text());var alltotal=paytotal+pertotal+othtotal;if(alltotal==$yt_baseElement.rmoney($('#loanMoney').val())){if(validFlag){var formDatas=loanApply.getLoanFormData();$.ajax({type:"post",url:ajaxUrl,async:false,data:formDatas,success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:fromUrl }})};$(this).attr('disabled',false).removeClass('btn-disabled')}})}else{sysCommon.pageToScroll($("#loanApply .valid-font"));$(this).attr('disabled',false).removeClass('btn-disabled')}}else{$yt_alert_Model.prompt('所有收款方收款金额合计必须等于借款金额');sysCommon.pageToScroll($("#loanApply .valid-font"));$(this).attr('disabled',false).removeClass('btn-disabled')}});$("#saveBtn").off().on("click",function(){var thisBtn=$(this);$(this).attr('disabled',true).addClass('btn-disabled');var ajaxUrl="";var validFlag=true;var fromUrl='';if(thisBtn.hasClass("save-btn")){ajaxUrl="sz/loanApp/saveLoanAppInfoToDrafts";fromUrl='view/system-sasac/expensesReim/module/approval/draftsList.html'}var paytotal=$yt_baseElement.rmoney($('.payee-unit-money').text());var pertotal=$yt_baseElement.rmoney($('.payee-personal-money').text());var othtotal=$yt_baseElement.rmoney($('.payee-other-total-money').text());var alltotal=paytotal+pertotal+othtotal;if(validFlag){var formDatas=loanApply.getLoanFormData();$.ajax({type:"post",url:ajaxUrl,async:false,data:formDatas,success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:fromUrl }})};$(this).attr('disabled',false).removeClass('btn-disabled')}})}else{sysCommon.pageToScroll($("#loanApply .valid-font"));$(this).attr('disabled',false).removeClass('btn-disabled')}})},getLoanFormData:function(){var me=this;var applicantUserCode="";if($("#hidUserCode").val()!=""){applicantUserCode=$("#hidUserCode").val()}else{applicantUserCode=$yt_common.user_info.userName}var payReceivablesData=function(){return JSON.stringify({gatheringUnitList:me.gatheringUnitList(),gatheringPersonList:me.gatheringPersonList(),gatheringOtherList:me.gatheringOtherList()})};var loanTerm=$("#lifeOfLoan option:selected").text();loanTerm=(loanTerm=='请选择'?'':loanTerm);return{loanAppId:loanApply.loanId,loanAppNum:$("#hidFormNum").val(),isSpecial:'',loanAppName:$("#loanReason").val(),loanAmount:$yt_baseElement.rmoney($("#loanMoney").val()||'0'),paymentMethod:$(".pay-met .yt-radio.check input").val(),loanTerm:loanTerm,expectRepaymentTime:$("#returnDate").val(),applicantUser:applicantUserCode,parameters:"",nextCode:$("#operate-flow").val(),dealingWithPeople:$("#approve-users").val(),opintion:$("#operateMsg").val(),processInstanceId:$("#processInstanceId").val(),payReceivablesData:payReceivablesData()}},clearPageData:function(){$("#loanApply input:not(.radio-inpu,.hid-risk-code),#loanApply textarea").val('');$("#loanMoney").val('');$("#moneyLower").text('--');$("#approve-users,#operate-flow,#lifeOfLoan").each(function(i,n){$(this).find("option:eq(0)").attr("selected","selected")});$("#loanApply select").each(function(i,n){$(this).find("option:eq(0)").attr("selected","selected")});$("#loanApply select").niceSelect();$("#loanApply .risk-img").attr("src",loanApply.riskExcMark)},loanMoneyEvent:function(){$("#loanMoney").on("focus",function(){if($(this).val()!=""&&$(this).val()!=null){$(this).val($yt_baseElement.rmoney($(this).val()));$(this).select()}});$("#loanMoney").on("blur",function(){if($(this).val()!=""&&$(this).val()!=null){var fmMoney=$yt_baseElement.fmMoney($(this).val());$(this).val(fmMoney);var lowerMoney=arabiaToChinese($(this).val());$("#moneyLower").text(lowerMoney)}})},gatheringUnitList:function(){var list=[];var trs=$('table.payee-unit tbody tr:not(.payee-unit-total)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({unitName:tr.attr('companyname'),openBank:tr.attr('openbank'),accounts:tr.attr('accountnumber'),amount:$yt_baseElement.rmoney(tr.attr('companymoney')),isContract:tr.attr('contractradio'),isSettlement:tr.attr('settlementRadio'),reverseTheWay:'',reverseTheWayName:$yt_baseElement.rmoney(tr.find('td').eq(1).text()),remarks:tr.attr('companyspecial')=='无'?'':tr.attr('companyspecial')})});return list},setHeringUnitList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="payee-unit-tr" pkid="" witeOffCompany="'+n.reverseTheWay+'" companyname="'+n.unitName+'" openbank="'+n.openBank+'" accountnumber="'+n.accounts+'" companymoney="'+n.amount+'" contractradio="'+n.isContract+'" settlementradio="'+n.isSettlement+'" companyspecial="'+n.remarks+'"><td class="com" value="Company">'+n.unitName+'</td><td style="text-align: right;" class="unitTotal">'+($yt_baseElement.fmMoney(n.amount))+'</td><td>'+n.openBank+'</td><td>'+n.accounts+'</td><td value="1">'+(n.isContract==1?'有':'无')+'</td><td value="1">'+(n.isSettlement==1?'汇款':'支票')+'</td><td>'+n.remarks+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.amount});$('table.payee-unit .payee-unit-total').before(html).find('.payee-unit-money').text($yt_baseElement.fmMoney(total))},gatheringPersonList:function(){var list=[];var trs=$('table.payee-personal tbody tr:not(.payee-personal-total)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({personalType:2,personalCode:tr.attr('payeeval'),personalName:tr.attr('payeename'),personalUnit:tr.attr('perank'),idCard:tr.attr('idcarkno'),phoneNum:tr.attr('phonenum'),openBank:tr.attr('bankname'),accounts:tr.attr('payeebank'),writeOffAmount:$yt_baseElement.rmoney(tr.attr('theReverseMoney')),offOpenBank:tr.attr('offOpenBank'),offAccounts:tr.attr('offAccounts'),amount:$yt_baseElement.rmoney(tr.attr('personaltotal')),loanAppId:tr.attr('choiceloanval')=='undefined'?'':tr.attr('choiceloanval'),replaceAmount:$yt_baseElement.rmoney(tr.attr('personalwriteoff')),cash:$yt_baseElement.rmoney(tr.attr('cash')),officialCard:$yt_baseElement.rmoney(tr.attr('officialcard')),transfer:$yt_baseElement.rmoney(tr.attr('transferaccounts')),isContract:tr.attr('payeeradio'),reverseTheWay:'',remarks:tr.attr('personalspecial')=='无'?'':tr.attr('personalspecial')})});return list},setHeringPersonList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="payee-personal-tr" pkid="" payeeval="'+n.personalCode+'" payeename="'+n.personalName+'" personalUnit="'+n.personalUnit+'" pedepartment="'+n.personalDept+'" perank="'+n.personalJobLevelName+'" personaltotal="'+n.amount+'" witeoffpersonal="'+n.reverseTheWay+'" personalwriteoff="'+n.replaceAmount+'" cash="'+n.cash+'" officialcard="'+n.officialCard+'" transferaccounts="'+n.transfer+'" payeeradio="'+n.isContract+'" personalspecial="'+n.remarks+'" idcarkno="'+n.idCard+'" payeebank="'+n.accounts+'" bankname="'+n.openBank+'" phonenum="'+n.phoneNum+'" choiceloan="'+n.loanAppNum+'" choiceloanval="'+n.loanAppId+'" arrearsmoney="'+n.loanAppArrearsAmount+'" thereversemoney="'+n.writeOffAmount+'" offOpenBank="'+n.offOpenBank+'" offAccounts="'+n.offAccounts+'"><td class="per" value="personal">'+n.personalName+'</td><td style="text-align: right;" class="personalTotal">'+loanApply.fmMoney(n.amount)+'</td><td style="text-align: right;">'+(loanApply.fmMoney(n.cash))+'</td><td style="text-align: right;">'+(loanApply.fmMoney(n.officialCard))+'</td><td style="text-align: right;">'+(loanApply.fmMoney(n.transfer))+'</td><td><a class="yt-link to-data">详情</a></td><td>'+(n.isContract==1?'有':'无')+'</td><td>'+n.remarks+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.amount});$('table.payee-personal .payee-personal-total').before(html).find('.payee-personal-money').text($yt_baseElement.fmMoney(total))},gatheringOtherList:function(){var list=[];var trs=$('table.payee-other tbody tr:not(.payee-other-total)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({otherName:tr.attr('othermoney'),amount:$yt_baseElement.rmoney(tr.attr('otherallmoney')),isContract:tr.attr('otherradio'),reverseTheWay:'',remarks:tr.attr('otherspecial')=='无'?'':tr.attr('otherspecial')})});return list},setHeringOtherList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="payee-other-tr" pkid="" witeoffother="'+n.reverseTheWay+'" othermoney="'+n.otherName+'" otherallmoney="'+n.amount+'" otherradio="'+n.isContract+'" otherspecial="'+n.remarks+'"><td class="oth" value="Other">'+n.otherName+'</td><td style="text-align: right;" class="otherTotal">'+loanApply.fmMoney(n.amount)+'</td><td>'+(n.isContract==1?'有':'无')+'</td><td>'+n.remarks+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.amount});$('table.payee-other .payee-other-total').before(html).find('.payee-other-total-money').text($yt_baseElement.fmMoney(total))},getDictInfoByTypeCode:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:true,data:{dictTypeCode:'ACTIVITY_PRO,SPECIFIC_COST_TYPE,TRAVEL_TYPE,VEHICIE_CODE,HOTEL_ADDRESS,COST_TYPE,OTHER_UNIT_REC_TYPE,PERSONAL_REC_TYPE'},success:function(data){var list=data.data||[];var start='<option value="">请选择</option>',optone=start,opttwo=start,travelType=start,vehicieCode=start,hotel=start,reverse='<option value="">无</option>',reverseUser='<option value="">无</option>',cost=start;$.each(list,function(i,n){if(n.dictTypeCode=='ACTIVITY_PRO'){optone+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='SPECIFIC_COST_TYPE'){opttwo+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='TRAVEL_TYPE'){travelType+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='VEHICIE_CODE'){vehicieCode+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='HOTEL_ADDRESS'){hotel+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='COST_TYPE'){cost+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='OTHER_UNIT_REC_TYPE'){reverse+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='PERSONAL_REC_TYPE'){reverseUser+='<option value="'+n.value+'">'+n.disvalue+'</option>'}});$('#witeOffCompany,#witeOffOther').html(reverse).niceSelect();$('#witeOffPersonal').html(reverseUser).niceSelect();$('#budgetProject').html(optone).niceSelect();$('#costBreakdown').html(opttwo).niceSelect();$('#modelBusiType').html(travelType).niceSelect();$('select.cost-type-sel').html(cost).niceSelect()}})},getPaymentTermTotal:function(){var cash=loanApply.rmoney($('#cash').val());var offic=loanApply.rmoney($('#officialCard').val());var trans=loanApply.rmoney($('#transferAccounts').val());return cash+offic+trans},alertClearReceivables:function(){$('#cash,#officialCard,#transferAccounts').on('blur',function(){var writeoff=loanApply.rmoney($('#personalTotal').val());var total=loanApply.getPaymentTermTotal();if(total>writeoff){$(this).focus();$yt_alert_Model.prompt('各收款方式的金额合计与个人收款的金额不相等');return false}});$('#addExpense').click(function(){var code='company';$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();$('#cash,#officialCard,#transferAccounts').val('0.00');$("label.user-radio-label").show();$('#appendPaymentInfo').off().on('click',function(){loanApply.raceAddList()}).text('保存')});$("#modelCanelBtn,#cost-apply-model .closed-span").click(function(){sysCommon.closeModel($("#cost-apply-model"));loanApply.clearAlert($(".model-content"));$('.arrears-money').text(0.00);$('.pe-department,.pe-rank').text('');$('.personal-writeoff-money').text('0.00');$('#cash,#officialCard,#transferAccounts').val('0.00');loanApply.setPayeeNameSelect();$('.receipt-alert .display-loan').hide();$(".display-rank").hide();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").hide();$("label.user-radio-label").hide().removeClass("check");$("#userRadio").prop("checked",false)});},raceAddList:function(tr){var code=$('.receipt-alert ul li.tab-check').attr('code');var form=$('.receipt-alert .model-content[code="'+code+'"]');var is=$yt_valid.validForm(form);if(is){var companyName=form.find('#companyName').val();var personalUnit=form.find('#personalUnit').val();var witeOffCompany=form.find('#witeOffCompany option:selected').text();var witeOffCompanyCode=form.find('#witeOffCompany option:selected').val();var openBank=form.find('#openBank').val();var accountNumber=form.find('#accountNumber').val();var companyMoney=form.find('#companyMoney').val();var contractRadio=form.find('.check .contractRadio').val();var contractRadioText='';if(contractRadio==1){contractRadioText='有'}else{contractRadioText='无'}var settlementRadio=form.find('.check .settlementRadio').val();var settlementRadioText='';if(settlementRadio==1){settlementRadioText='汇款'}else{settlementRadioText='支票'}var companySpecial=form.find('#companySpecial').val();var payeeName=form.find('#payeeName option:selected').attr('username');var payeeVal=form.find('#payeeName option:selected').val();var peDepartment=form.find('.pe-department').text();var peRank=form.find('.pe-rank').text();if(payeeVal=='external'||!($('input.where-company').is(":hidden"))){peRank=form.find('input.where-company').val();$(".display-rank").show();$(".pe-department").text("外部人员");$(".dis-r").hide();$(".where-company").show();$("input.where-company").attr("validform","{isNull:true,blurFlag:true,msg:'请输入收款人所在单位'}");payeeName=$('#payeeName').next().find('.search-current').val();payeeName=payeeName=='请选择'?'':payeeName;payeeVal='external'}else{$(".display-rank").show();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").show()}var verifyName=function(){if(payeeName){return true;$('#payeeName').parent().find('.valid-font').text('')}else{$('#payeeName').parent().find('.valid-font').text('请填写外部人员名称');return false}};var personalTotal=form.find('#personalTotal').val();var witeOffPersonal=form.find("#witeOffPersonal option:selected").text();var witeOffPersonalVal=form.find("#witeOffPersonal option:selected").val();var choiceLoan=form.find('#choiceLoan option:selected').text();var choiceLoanVal=form.find('#choiceLoan option:selected').val();var arrearsMoney=form.find('.arrears-money').text();var theReverseMoney=form.find('.the-reverse-money').text();var personalWriteoff=form.find('#personalTotal').val();var cash=form.find('#cash').val();var officialCard=form.find('#officialCard').val()||'0.00';var transferAccounts=form.find('#transferAccounts').val()||'0.00';var payeeRadio=form.find('.check .payeeRadio').val()||'0.00';var payeeRadioText='';if(payeeRadio==1){payeeRadioText='有'}else{payeeRadioText='无'}var personalSpecial=form.find('#personalSpecial').val();var idCarkno=form.find('#idCarkno').val();var payeeBank=form.find('#payeeBank').val();var bankName=form.find('#bankName').val();var phoneNum=form.find('#phoneNum').val();var offOpenBank=form.find('#offOpenBank').val();var offAccounts=form.find('#offAccounts').val();var otherMoney=form.find('#otherMoney').val();var witeOffOther=form.find('#witeOffOther option:selected').text();var witeOffOtherVal=form.find('#witeOffOther option:selected').val();var otherAllMoney=form.find('#otherAllMoney').val();var otherRadio=form.find('.check .otherRadio').val();var otherRadioText='';if(otherRadio==1){otherRadioText='有'}else{otherRadioText='无'}var otherSpecial=form.find('#otherSpecial').val();var trHtml='';var pamTotal=loanApply.getPaymentTermTotal();var writeOffNum=loanApply.rmoney(personalWriteoff);if(pamTotal==writeOffNum){var receMoney=loanApply.getReceMsgMoney(tr)+loanApply.rmoney(otherAllMoney)+loanApply.rmoney(personalWriteoff)+loanApply.rmoney(companyMoney);var sumMoney=loanApply.rmoney($('#loanMoney').val());if(receMoney<=sumMoney){switch(code){case 'company':trHtml='<tr  pkid="" class="payee-unit-tr" witeOffCompany="'+witeOffCompanyCode+'" companyName="'+companyName+'" openBank="'+openBank+'" accountNumber="'+accountNumber+'" companyMoney="'+companyMoney+'" contractRadio="'+contractRadio+'" settlementRadio="'+settlementRadio+'" companySpecial="'+companySpecial+'"><td class="com" value="Company">'+companyName+'</td><td style="text-align: right;" class="unitTotal">'+($yt_baseElement.fmMoney(companyMoney))+'</td><td>'+openBank+'</td><td>'+accountNumber+'</td><td value="'+contractRadio+'">'+contractRadioText+'</td><td value="'+settlementRadio+'">'+settlementRadioText+'</td><td>'+companySpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(trHtml);loanApply.clearAlterTable()}else{$('.rece-msg table[code="'+code+'"] tbody .payee-unit-total').before(trHtml);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}loanApply.companyTotal();break;case 'personal':if(verifyName()){trHtml='<tr class="payee-personal-tr" pkid="" payeeVal="'+payeeVal+'" payeeName="'+payeeName+'" personalUnit="'+personalUnit+'" peDepartment="'+peDepartment+'" peRank="'+peRank+'" personalTotal="'+personalTotal+'" witeOffPersonal="'+witeOffPersonalVal+'" personalWriteoff="'+personalWriteoff+'" cash="'+cash+'" officialCard="'+officialCard+'" transferAccounts="'+transferAccounts+'" payeeRadio="'+payeeRadio+'" personalSpecial="'+personalSpecial+'" idCarkno="'+idCarkno+'" payeeBank="'+payeeBank+'" bankName="'+bankName+'" phoneNum="'+phoneNum+'" choiceLoan="'+choiceLoan+'" choiceLoanVal="'+choiceLoanVal+'" arrearsMoney="'+arrearsMoney+'" theReverseMoney="'+theReverseMoney+'" offOpenBank="'+offOpenBank+'" offAccounts="'+offAccounts+'"><td class="per" value="personal">'+payeeName+'</td><td style="text-align: right;" class="personalTotal">'+($yt_baseElement.fmMoney(personalTotal))+'</td><td style="text-align: right;">'+cash+'</td><td style="text-align: right;">'+officialCard+'</td><td style="text-align: right;">'+transferAccounts+'</td><td><a class="yt-link to-data">详情</a></td><td>'+payeeRadioText+'</td><td>'+personalSpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(trHtml);loanApply.clearAlterTable()}else{$('.rece-msg table[code="'+code+'"] tbody .payee-personal-total').before(trHtml);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}loanApply.personalTotal()}break;case 'other':trHtml='<tr class="payee-other-tr"  pkid="" witeOffOther="'+witeOffOtherVal+'" otherMoney="'+otherMoney+'" otherAllMoney="'+otherAllMoney+'" otherRadio="'+otherRadio+'" otherSpecial="'+otherSpecial+'"><td class="oth" value="Other">'+otherMoney+'</td><td style="text-align: right;" class="otherTotal">'+($yt_baseElement.fmMoney(otherAllMoney))+'</td><td>'+otherRadioText+'</td><td>'+otherSpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(trHtml);loanApply.clearAlterTable()}else{$('.rece-msg table[code="'+code+'"] tbody .payee-other-total').before(trHtml);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}loanApply.otherTotal();break;default:break}loanApply.clearAlert($(".model-content"));loanApply.setPayeeNameSelect();$yt_baseElement.tableRowActive();$('.receipt-alert .display-loan').hide();$('.pe-department,.pe-rank').text('');$('.personal-writeoff-money').text('0.00');$('#cash,#officialCard,#transferAccounts').val('0.00');$(".display-rank").hide();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").hide();$("label.user-radio-label").hide().removeClass("check");$("#userRadio").prop("checked",false)}else{$yt_alert_Model.prompt('金额不能大于申请支出总金额')}}else{$yt_alert_Model.prompt('各收款方式的金额合计与个人收款的金额不相等')}}},updataPersonal:function(){$(".payee-unit tbody").on("click",".operate-update",function(){var ithis=$(this);var tr=ithis.parents('tr');var table=ithis.parents('table');var code=table.attr('code');$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();$('#witeOffCompany').val(tr.attr('witeOffCompany')).niceSelect();$('#companyName').val(tr.attr('companyName'));$('#openBank').val(tr.attr('openBank'));$('#accountNumber').val(tr.attr('accountNumber'));$('#companyMoney').val(tr.attr('companyMoney'));var contractRadio=tr.attr('contractRadio');$('.companyCheck .check-label input[value="'+contractRadio+'"]').setRadioState('check');var settlementRadio=tr.attr('settlementRadio');$('.settlementCheck .check-label input[value="'+settlementRadio+'"]').setRadioState('check');var companySpecial=tr.attr('companySpecial');$('#appendPaymentInfo').off().on('click',function(){loanApply.raceAddList(tr)}).text('确定')})},updataReceivables:function(){$(".payee-personal tbody").on("click",".operate-update",function(){$("#appendPaymentInfo").text('确定');var ithis=$(this);var tr=ithis.parents('tr');var table=ithis.parents('table');var code=table.attr('code');$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();var payee=tr.attr('payeeVal');loanApply.setPayeeNameSelect(payee);$('.pe-department').text(tr.attr('pedepartment'));$('.pe-rank').text(tr.attr('perank'));if(payee=='external'){$('input.where-company').val(tr.attr('perank'));$(".display-rank").show();$(".pe-department").text("外部人员");$(".dis-r").hide();$(".where-company").show();$("input.where-company").attr("validform","{isNull:true,blurFlag:true,msg:'请输入收款人所在单位'}");$('#payeeName').attr('validform','{}').next().find('.search-current').val(tr.attr('payeeName'));$('#personalUnit').val(tr.attr('personalUnit'))}else{$(".display-rank").show();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").show();$('#payeeName').attr('validform','{isNull:true,blurFlag:true,msg:\'请输入收款人姓名\'}')}$('#personalTotal').val(tr.attr('personalTotal'));var choiceLoan=tr.attr('choiceLoan');if(choiceLoan&&choiceLoan!='请选择'){$('.receipt-alert .display-loan').show();loanApply.getChoiceLoanList(tr.attr('choiceLoanVal'));$('.the-reverse-money').text(tr.attr('thereversemoney'))}else{$('.receipt-alert .display-loan').hide();$('#choiceLoan').val('').niceSelect();$('.arrears-money').text('0.00');$('.the-reverse-money').text('0.00')}$('#witeOffPersonal').val(tr.attr('witeOffPersonal')).niceSelect();$('.personal-writeoff-money').text(tr.attr('personalwriteoff'));$('#cash').val(tr.attr('cash')||'0.00');$('#officialCard').val(tr.attr('officialCard')||'0.00');$('#transferAccounts').val(tr.attr('transferAccounts')||'0.00');$('#idCarkno').val(tr.attr('idCarkno'));$('#payeeBank').val(tr.attr('payeeBank'));$('#bankName').val(tr.attr('bankName'));$('#phoneNum').val(tr.attr('phoneNum'));$('#offOpenBank').val(tr.attr('offOpenBank'));$('#offAccounts').val(tr.attr('offAccounts'));var payeeRadio=tr.attr('payeeRadio');$('.personalCheck .check-label input[value="'+payeeRadio+'"]').setRadioState('check');var personalSpecial=tr.attr('personalSpecial');$('#appendPaymentInfo').off().on('click',function(){loanApply.raceAddList(tr)})})},updataOther:function(){$(".payee-other tbody").on("click",".operate-update",function(){$("#appendPaymentInfo").text('确定');var ithis=$(this);var tr=ithis.parents('tr');var table=ithis.parents('table');var code=table.attr('code');$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();$('#otherMoney').val(tr.attr('otherMoney'));$('#otherAllMoney').val(tr.attr('otherAllMoney'));var otherRadio=tr.attr('otherRadio');$('.otherCheck .check-label input[value="'+otherRadio+'"]').setRadioState('check');var otherSpecial=tr.attr('otherSpecial');$('#otherSpecial').val(otherSpecial=='无'?'':otherSpecial);$('#appendPaymentInfo').off().on('click',function(){loanApply.raceAddList(tr)}).text('确定')})},clearAlterTable:function(){sysCommon.closeModel($("#cost-apply-model"));loanApply.clearAlert($(".model-content"));loanApply.setPayeeNameSelect()},getBusiTripUsersList:function(keyword){var me=this;$.ajax({type:"post",url:'user/userInfo/getAllUserInfoToPage',async:true,data:{params:keyword,pageIndex:1,pageNum:99999},success:function(data){if(data.flag==0){$("#busiUserInfo ul").empty();var liStr="";var opts='';if(data.data.rows.length>0){loanApply.payeeUserList=data.data.rows;$.each(data.data.rows,function(i,n){liStr=$('<li>'+n.userName+'/'+n.deptName+'</li>');opts+='<option value="'+n.userItcode+'">'+n.userName+'</option>';liStr.data("userData",n);$("#busiUserInfo ul").append(liStr)});if($("#modelUserCodes").val()){var usersCodes=$("#modelUserCodes").val().split(",");$("#busiUserInfo ul li").each(function(i,t){$.each(usersCodes,function(i,l){if($(t).data("userData").userItcode==l){$(t).addClass("tr-check")}})})}me.setPayeeNameSelect()}else{$("#busiUserInfo ul").append('<li style="text-align: center;">暂无数据</li>')}}}})},setPayeeNameSelect:function(code){var me=this;var payeeName=$('#payeeName');payeeName.attr('validform','{isNull:true,blurFlag:true,msg:\'请输入收款人姓名\'}');payeeName.html('<option value="">请选择</option>');$.each(loanApply.payeeUserList,function(i,n){payeeName.append('<option userName="'+n.userName+'" jobLevelName="'+n.jobLevelName+'" deptName="'+n.deptName+'" value="'+n.userItcode+'">'+n.userName+'/'+n.deptName+'/'+n.jobName+'</option>')});payeeName.append('<option userName="" value="external">外部人员</option>');if(code){payeeName.find('option[value="'+code+'"]').attr('selected','selected');payeeName.next().find(".current").text($('#payeeName option[value="'+code+'"]').attr("username"));payeeName.next().find(".search-current").val($('#payeeName option:selected').attr("username")==undefined?"请选择":$('#payeeName option:selected').attr("username"))}me.payeeKeyText='';payeeName.niceSelect({search:true,backFunction:function(text){payeeName.html('');if(text==""){payeeName.html('<option value="">请选择</option>')}else{payeeName.parent().find('.valid-font').text('');me.payeeKeyText=text}$.each(loanApply.payeeUserList,function(i,n){if(n.userName.indexOf(text)!=-1){payeeName.append('<option userName="'+n.userName+'" jobLevelName="'+n.jobLevelName+'" deptName="'+n.deptName+'" value="'+n.userItcode+'">'+n.userName+'/'+n.deptName+'/'+n.jobName+'</option>')}else{}});payeeName.append('<option  userName="" value="external">外部人员</option>');if(payeeName.find('option').length==1&&$('payeeName option[value="external"]')){payeeName.html('<option value="noUser" disabled="disabled">没有找到匹配的单位内部人员</option><option  userName="" value="external">外部人员</option>')}if(payeeName.find('option').length==2&&$('payeeName option[value="noUser"]')){}},optionCallBcak:function(opt){if(opt.attr('data-value')=='external'){payeeName.next().find('.search-current').val(me.payeeKeyText);payeeName.attr('validform','{}')}else{payeeName.attr('validform','{isNull:true,blurFlag:true,msg:\'请输入收款人姓名\'}');payeeName.next().find(".current").text($('#payeeName option:selected').attr("username"));payeeName.next().find(".search-current").val($('#payeeName option:selected').attr("username")==undefined?"请选择":$('#payeeName option:selected').attr("username"))}}});payeeName.next().find(".current").text($('#payeeName option:selected').attr("username"));payeeName.next().find(".search-current").val($('#payeeName option:selected').attr("username")==undefined?"请选择":$('#payeeName option:selected').attr("username"))},clearAlert:function(obj){var selects=obj.find('select');$.each(selects,function(i,n){$(n).find('option:eq(0)').attr('selected',true)});selects.niceSelect();var inputs=obj.find('input:not(input[type="radio"],input[type="checkbox"])');inputs.val('');var checks=obj.find('input[type="checkbox"]');$.each(checks,function(i,n){$(n).setCheckBoxState('uncheck')});var textareas=obj.find('textarea');obj.find('.valid-font').text('');obj.find('.valid-hint').removeClass('valid-hint');textareas.val('')},getReceMsgMoney:function(tr){var total=0;var unit=0;$('table.payee-unit tbody tr:not(.payee-unit-total)').not(tr).each(function(){unit+=loanApply.rmoney($(this).find('.unitTotal').text())});var us=0;$('table.payee-personal tbody tr:not(.payee-personal-total)').not(tr).each(function(){other+=loanApply.rmoney($(this).find('.personalTotal').text())});var other=0;$('table.payee-other tbody tr:not(.payee-other-total)').not(tr).each(function(){other+=loanApply.rmoney($(this).find('.otherTotal').text())});total=unit+us+other;return total},companyTotal:function(){var tds=$('.payee-unit tbody .unitTotal');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('.payee-unit tbody .payee-unit-money').text(fmTotal))},personalTotal:function(){var tds=$('.payee-personal tbody tr:not(.payee-personal-total)');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).find('.personalTotal').text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('.payee-personal tbody .payee-personal-money').text(fmTotal))},otherTotal:function(){var tds=$('.payee-other tbody .otherTotal');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('.payee-other tbody .payee-other-total-money').text(fmTotal))},toDetails:function(){$('.to-detail').off("click").on('click',function(){$yt_baseElement.eventStopPageaction();var loanAppId=$(this).attr("loanAppId");var pageUrl="view/system-sasac/expensesReim/module/loanApply/loanApplyDetail.html?loanId="+loanAppId;$yt_baseElement.openNewPage(2,pageUrl)})}};$(function(){loanApply.init()});