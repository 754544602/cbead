var personnelFunds={riskViaImg:"../../../../../resources-sasac/images/common/risk-via.png",trainingDay:0,stayDays:0,hotCityList:'',addressList:'',tabIndex:0,thisPopM:'',lectureId:1,initMoney:function(){var moneyTextList=$(".moneyText");moneyTextList.each(function(){var thisObj=$(this);if(thisObj.text()){thisObj.text($yt_baseElement.fmMoney(thisObj.text()))}});var moneyInputList=$(".moneyInput");moneyInputList.each(function(){var thisObj=$(this);if(thisObj.val()){thisObj.val($yt_baseElement.fmMoney(thisObj.val()))}thisObj.focus(function(){var thisInput=$(this);if(thisInput.val()){thisInput.val($yt_baseElement.rmoney(thisInput.val()))}});thisObj.blur(function(){var thisInput=$(this);if(thisInput.val()){thisInput.val($yt_baseElement.fmMoney(thisInput.val()))}})});$('.standard-money,.people-num,.day-num').on('blur',function(){var standard=$yt_baseElement.rmoney($('input.standard-money').val()||'0');var people=Number($('input.people-num').val()||'0');var day=Number($('input.day-num').val()||'0');var count=standard*people*day;$('input.smallplan-money').val($yt_baseElement.fmMoney(count||'0'))});$('.predict-standard-money,.predict-people-num').on('blur',function(){var standard=$yt_baseElement.rmoney($('input.predict-standard-money').val()||'0');var people=Number($('input.predict-people-num').val()||'0');var count=standard*people/1.03;$('input.predict-smallplan-money').val($yt_baseElement.fmMoney(count||'0'));$('input.predict-people-num').val($('input.predict-people-num').val()||'1');$('input.predict-all-money').val($yt_baseElement.fmMoney(standard*people||'0'))})},getData:function(){$("#startTimeTop").calendar({nowData:false,upperLimit:$("#endTimeTop"),speed:0,callback:function(){sysCommon.clearValidInfo($("#startTimeTop"));var tdStartDate=$("#startTimeTop").val();var tdEndDate=$('#endTimeTop').val();var dateFrom=new Date(tdStartDate);var dateTo=new Date(tdEndDate);if(tdStartDate!=""&&tdEndDate!=""){var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24));$("#calculationSession").css("color","#333333").text(diff_day+1);$("#calculationSession").removeClass("calculation-Identification")}}});$("#endTimeTop").calendar({nowData:false,lowerLimit:$("#startTimeTop"),speed:0,callback:function(){sysCommon.clearValidInfo($("#endTime"));var tdStartDate=$("#startTimeTop").val();var tdEndDate=$('#endTimeTop').val();var dateFrom=new Date(tdStartDate);var dateTo=new Date(tdEndDate);if(tdStartDate!=""&&tdEndDate!=""){var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24));$("#calculationSession").css("color","#333333").text(diff_day+1);$("#calculationSession").removeClass("calculation-Identification")}}})},init:function(){var requerParameter=$yt_common.GetRequest();if('expenditure'==requerParameter.workCode){$("#predictCostDiv").hide();$("#preTaxDiv").hide()}personnelFunds.getCostActivityPro();personnelFunds.getDictTypeByTypeCode();$(".standard-money,.smallplan-money").on("focus",function(){if($(this).val()!=""){$(this).val($yt_baseElement.rmoney($(this).val()))}});$(".standard-money,.smallplan-money").on("blur",function(){if($(this).val()!=""){$(this).val($yt_baseElement.fmMoney($(this).val()))}});$(".predict-standard-money,.predict-smallplan-money").on("focus",function(){if($(this).val()!=""){$(this).val($yt_baseElement.rmoney($(this).val()))}});$(".predict-standard-money,.predict-smallplan-money").on("blur",function(){if($(this).val()!=""){$(this).val($yt_baseElement.fmMoney($(this).val()))}});personnelFunds.tabIndex=$(".train-district .tab-check").index();personnelFunds.thisPopM=$(".train-district .tab-info").eq(personnelFunds.tabIndex);$("#addTraining").click(function(){if($("#trainingPopTable .yt-table .yt-tbody tr").size()<1){personnelFunds.trainingPopModel()}else{$yt_alert_Model.prompt("最多添加一条培训信息")}});$("#addCostAppBtn").click(function(){if($('#lecturerTable table tbody tr').length>0){personnelFunds.initPopMTab();personnelFunds.initLecturerSelect();personnelFunds.costPopModelAddOrUp()}else{$yt_alert_Model.prompt('请添加讲师信息')}});$("#addTrainingOther").click(function(){$('#oherTrainingAlert.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){var isFalse=$yt_valid.validForm($("#trainingFeePopM"));if(isFalse){personnelFunds.addOtherTrainingList()}});personnelFunds.showOtherAlert()});$("#addPredictCostBtn").click(function(){$('#predictCostAlert.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){var isFalse=$yt_valid.validForm($("#predictCostPopM"));if(isFalse){personnelFunds.addPredictCostList()}});personnelFunds.showPredictCostAlert();});$("#model-canel-btn,#costPopModel .closed-span").click(function(){sysCommon.closeModel($("#costPopModel"));sysCommon.clearFormData()});$("#trainingReportDate").calendar({controlId:"trd",upperLimit:$("#trainingEndingDate"),speed:0,complement:true,readonly:true,nowData:false,speed:0,dateFmt:"yyyy-MM-dd",callback:function(){$("#trainingReportDate").parent().find(".risk-img").attr("src",personnelFunds.riskViaImg);sysCommon.clearValidInfo($("#trainingReportDate"));if($("#trainingReportDate").val()&&$("#trainingEndingDate").val()){personnelFunds.trainingDay=personnelFunds.GetDateDiff($("#trainingReportDate").val(),$("#trainingEndingDate").val(),"day")+1;$("#trainingDay").text(personnelFunds.trainingDay)}}});$("#trainingEndingDate").calendar({controlId:"ted",lowerLimit:$("#trainingReportDate"),speed:0,complement:true,readonly:true,nowData:false,speed:0,dateFmt:"yyyy-MM-dd",callback:function(){$("#trainingEndingDate").parent().find(".risk-img").attr("src",personnelFunds.riskViaImg);sysCommon.clearValidInfo($("#trainingEndingDate"));if($("#trainingReportDate").val()&&$("#trainingEndingDate").val()){personnelFunds.trainingDay=personnelFunds.GetDateDiff($("#trainingReportDate").val(),$("#trainingEndingDate").val(),"day")+1;$("#trainingDay").text(personnelFunds.trainingDay)}}});$("#startTime").calendar({controlId:"st",upperLimit:$("#endTime"),speed:0,complement:true,readonly:true,nowData:false,speed:0,dateFmt:"yyyy-MM-dd",callback:function(){$("#startTime").parent().find(".risk-img").attr("src",personnelFunds.riskViaImg);sysCommon.clearValidInfo($("#startTime"));if($("#startTime").val()&&$("#endTime").val()){var trainingDay=personnelFunds.GetDateDiff($("#startTime").val(),$("#endTime").val(),"day")+1;}}});$("#endTime").calendar({controlId:"et",lowerLimit:$("#startTime"),speed:0,complement:true,readonly:true,nowData:false,speed:0,dateFmt:"yyyy-MM-dd",callback:function(){$("#endTime").parent().find(".risk-img").attr("src",personnelFunds.riskViaImg);sysCommon.clearValidInfo($("#endTime"));if($("#startTime").val()&&$("#endTime").val()){var trainingDay=personnelFunds.GetDateDiff($("#startTime").val(),$("#endTime").val(),"day")+1;}}});$("#checkInDate").calendar({controlId:"cd",upperLimit:$("#leaveDate"),speed:0,complement:true,readonly:true,nowData:false,speed:0,dateFmt:"yyyy-MM-dd",callback:function(){$("#checkInDate").parent().find(".risk-img").attr("src",personnelFunds.riskViaImg);sysCommon.clearValidInfo($("#checkInDate"));if($("#checkInDate").val()&&$("#leaveDate").val()){personnelFunds.stayDays=personnelFunds.GetDateDiff($("#checkInDate").val(),$("#leaveDate").val(),"day");$("#stayDays").text(personnelFunds.stayDays);var avgCost=0;var stayCost=personnelFunds.thisPopM.find(".stayCost").val();if(stayCost){if($("#stayDays").text()==0){avgCost= +$yt_baseElement.rmoney(personnelFunds.thisPopM.find(".stayCost").val())}else{avgCost= +$yt_baseElement.rmoney(personnelFunds.thisPopM.find(".stayCost").val())/personnelFunds.thisPopM.find("#stayDays").text()}}personnelFunds.thisPopM.find(".avgCost").text($yt_baseElement.fmMoney(avgCost))}}});$("#leaveDate").calendar({controlId:"ld",lowerLimit:$("#checkInDate"),speed:0,complement:true,readonly:true,nowData:false,speed:0,dateFmt:"yyyy-MM-dd",callback:function(){$("#leaveDate").parent().find(".risk-img").attr("src",personnelFunds.riskViaImg);sysCommon.clearValidInfo($("#leaveDate"));if($("#checkInDate").val()&&$("#leaveDate").val()){personnelFunds.stayDays=personnelFunds.GetDateDiff($("#checkInDate").val(),$("#leaveDate").val(),"day");$("#stayDays").text(personnelFunds.stayDays);var avgCost=0;var stayCost=personnelFunds.thisPopM.find(".stayCost").val();if(stayCost){if($("#stayDays").text()==0){avgCost= +$yt_baseElement.rmoney(personnelFunds.thisPopM.find(".stayCost").val())}else{avgCost= +$yt_baseElement.rmoney(personnelFunds.thisPopM.find(".stayCost").val())/personnelFunds.thisPopM.find("#stayDays").text()}}personnelFunds.thisPopM.find(".avgCost").text($yt_baseElement.fmMoney(avgCost))}}});$("#model-add-list-btn").click(function(){if($(this).hasClass("save")){var tabIndex=$(".train-district .cost-type-tab li.tab-check").index();var trHtml='';switch(tabIndex){case 0:var pAmount=$(".pAmount").val();var pDay=$(".pDay").val();var pNum=$(".pNum").val();var pAverage=$(".pAverage").text();trHtml='<tr><td>'+pAmount+'</td><td>'+pDay+'</td><td>'+pNum+'</td><td>'+pAverage+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';break;case 1:var name=$(".teacher-name").val();var title=$(".title-select option:selected").text();var costAmount=$(".cost-amount").val();var hoursVal=$(".hours-val").val();trHtml='<tr><td>'+name+'</td><td>'+title+'</td><td>'+costAmount+'</td><td>'+hoursVal+'</td><td></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';break;case 2:var reimReason=$('#reimReason').val();var stateDate=$("#traffic-start-time").val();var endDate=$("#traffic-end-time").val();var fromcity=$("#fromcity").val();var tocity=$("#tocity").val();var trafficTool=$(".traffic-tool option:selected").text();var cityCost=$(".city-cost-input").val();var specialRemark=$("#special-remark").val();trHtml='<tr><td><span>'+reimReason+'</span></td><td></td><td data-text="goTime">'+stateDate+'</td><td data-text="goAddress">'+fromcity+'</td><td data-text="arrivalTime">'+endDate+'</td><td data-text="arrivalAddress">'+tocity+'</td><td><span>'+trafficTool+'</span><input class="hid-child-code" type="hidden" value=""/></td><td class="font-right money-td" data-text="crafare">'+cityCost+'</td><td class="text-overflow-sty" title="" data-text="remarks">'+specialRemark+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';break;default:break}trHtml=$(trHtml);trHtml.find(".operate-del").click(function(){var thisObj=$(this);$yt_alert_Model.alertOne({alertMsg:"确定要删除此条数据吗?",leftBtnName:"确定",confirmFunction:function(){if(thisObj.parents("tbody").find("tr:not(.total-last-tr)").length==1){thisObj.parents("tbody").empty()}thisObj.parents("tr").remove();personnelFunds.updateTotalNum()}})});trHtml.find(".operate-update").click(function(){var modelIndex=$(this).parents(".traffic-cost-model").index();$(".train-district .tab-info").hide().eq(modelIndex).show();$(".train-district .cost-type-tab li").removeClass("tab-check").eq(modelIndex).addClass("tab-check");$(".train-district .tab-top").show();$("#model-add-list-btn").removeClass("save").addClass("update").text("保存");sysCommon.showModel($("#costPopModel"))});$(".traffic-cost-model").eq(tabIndex).find(".yt-tbody").append(trHtml)}else{}personnelFunds.updateTotalNum();sysCommon.closeModel($("#costPopModel"));sysCommon.clearFormData()});$(".train-district .cost-type-tab li").click(function(){var thisObj=$(this);if(true){if($("#lecturerTable .yt-tbody tr").size()>0){thisObj.addClass("tab-check").siblings().removeClass("tab-check");personnelFunds.tabIndex=thisObj.index();personnelFunds.thisPopM=$(".train-district .tab-info").eq(personnelFunds.tabIndex);$(".train-district .tab-info").hide().eq(personnelFunds.tabIndex).show();personnelFunds.costPopModel();personnelFunds.initLecturerSelect()}else{personnelFunds.initLecturerSelect();$yt_alert_Model.prompt("请添加讲师信息")}}else{thisObj.addClass("tab-check").siblings().removeClass("tab-check");personnelFunds.tabIndex=thisObj.index();personnelFunds.thisPopM=$(".train-district .tab-info").eq(personnelFunds.tabIndex);$(".train-district .tab-info").hide().eq(personnelFunds.tabIndex).show();personnelFunds.costPopModel()}personnelFunds.initModel();$yt_alert_Model.getDivPosition($("#costPopModel"))});$('.train-district select').niceSelect();$(".pAmount,.pDay,.pNum").blur(function(){if($(".pAmount").val()!=""&&$(".pDay").val()!=""&&$(".pNum").val()!=""){var average=parseFloat($(".pAmount").val())/parseFloat($(".pDay").val())/parseFloat($(".pNum").val());$(".pAverage").text(isNaN(average)?"":average)}});$('.file-name-list').on('click','.del-file',function(){var ithis=$(this);ithis.parent().remove()});personnelFunds.initMoney();personnelFunds.initModel($("#trainingPopModel,#lecturerPopModel,#costPopModel,#trainingPopModel"));personnelFunds.setTableOperaEvent();personnelFunds.getData();$('#oherTrainingAlert.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn,#oherTrainingAlert .closed-span').off().on("click",function(){sysCommon.closeModel($("#oherTrainingAlert"));sysCommon.clearFormData();$("#trainingFeePopM textarea").val("")});$('#predictCostAlert.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn,#predictCostAlert .closed-span').off().on("click",function(){sysCommon.closeModel($("#predictCostAlert"));sysCommon.clearFormData();$("#predictCostPopM textarea").val("")});$("#trainingFeeTable").on('click','.operate-update',function(){var thisObj=this;var thisTr=$(thisObj).parents('tr');var costname=$(thisTr).find(".cost-name").text();var standardmoney=$(thisTr).find(".standard-money").text();var peoplenum=$(thisTr).find(".people-num").text();var daynum=$(thisTr).find(".day-num").text();var smallplanmoney=$(thisTr).find(".smallplan-money").text();var specialinstruct=$(thisTr).find(".special-instruct").text();var costNameVal=$(thisTr).attr('costNameVal');var lecturerNameVal=$(thisTr).find(".lectureId").val();personnelFunds.showOtherAlert();personnelFunds.initLecturerSelect();$("#trainingFeePopM").find("select.cost-name").niceSelect();$('#trainingFeePopM').find('select.cost-name').setSelectVal(costNameVal);$('#trainingFeePopM').find('.standard-money').val(standardmoney);$('#trainingFeePopM').find('.people-num').val(peoplenum);$('#trainingFeePopM').find('.day-num').val(daynum);$('#trainingFeePopM').find('.smallplan-money').val(smallplanmoney);$('#trainingFeePopM').find('.specialInstruct').val(specialinstruct);$('#oherTrainingAlert.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){personnelFunds.addOtherTrainingList(thisTr)})});$("#predictCostTable").on('click','.operate-update',function(){var thisObj=this;var thisTr=$(thisObj).parents('tr');var costname=$(thisTr).find(".cost-name").text();var standardmoney=$(thisTr).find(".predict-standard-money").text();var peoplenum=$(thisTr).find(".predict-people-num").text();var smallplanmoney=$(thisTr).find(".predict-smallplan-money").text();var predictAllMoney=$(thisTr).find(".predict-all-money").text();var specialinstruct=$(thisTr).find(".special-instruct").text();personnelFunds.showPredictCostAlert();$('#predictCostPopM').find('.cost-name').val(costname);$('#predictCostPopM').find('.predict-standard-money').val(standardmoney);$('#predictCostPopM').find('.predict-people-num').val(peoplenum);$('#predictCostPopM').find('.predict-smallplan-money').val(smallplanmoney);$('#predictCostPopM').find('.predict-all-money').val(predictAllMoney);$('#predictCostPopM').find('.specialInstruct').val(specialinstruct);$('#predictCostAlert.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){personnelFunds.addPredictCostList(thisTr)})})},addOtherTrainingList:function(tr){if(true){var costName=$("#trainingFeePopM .cost-name option:selected").text();var costNameVal=$("#trainingFeePopM .cost-name option:selected").val();var standardMoney=$("#trainingFeePopM .standard-money").val();var peopleNum=$("#trainingFeePopM .people-num").val();var dayNum=$("#trainingFeePopM .day-num").val();var smallplanMoney=$("#trainingFeePopM .smallplan-money").val();var specialInstruct=$("#trainingFeePopM .specialInstruct").val();html='<tr costNameVal="'+costNameVal+'" pid=""><td class="cost-name">'+costName+'</td><td class="moneyText standard-money">'+standardMoney+'</td><td class="people-num">'+peopleNum+'</td><td class="day-num">'+dayNum+'</td><td class="moneyText smallplan-money">'+smallplanMoney+'</td><td class="special-instruct">'+specialInstruct+'</td><td><input type="hidden" class="popM" value="'+personnelFunds.tabIndex+'"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(html);personnelFunds.hideOtherAlert()}else{$("#trainingFeeTable .yt-tbody .last").before(html);$yt_alert_Model.prompt("填写的信息已成功加入到列表")}var totalAmount=0;$('#trainingFeeTable tbody .smallplan-money').each(function(){totalAmount+=$yt_baseElement.rmoney($(this).text())});$('#trainingFeeTable tbody .costTotal').text($yt_baseElement.fmMoney(totalAmount));personnelFunds.initModel(personnelFunds.thisPopM);personnelFunds.updateTotalNum();sysCommon.clearFormData();$("#trainingFeePopM select").val("").niceSelect();$("#trainingFeePopM textarea").val("")}else{$yt_alert_Model.prompt("只能添加一条培训信息")}},addPredictCostList:function(tr){if(true){var costName=$("#predictCostPopM .cost-name").val();var standardMoney=$("#predictCostPopM .predict-standard-money").val();var peopleNum=$("#predictCostPopM .predict-people-num").val();var smallplanMoney=$("#predictCostPopM .predict-smallplan-money").val();var predictAllMoney=$("#predictCostPopM .predict-all-money").val();var specialInstruct=$("#predictCostPopM .specialInstruct").val();html='<tr  pid=""><td class="cost-name">'+costName+'</td><td class="moneyText predict-standard-money">'+standardMoney+'</td><td class="predict-people-num">'+peopleNum+'</td><td class="moneyText predict-smallplan-money">'+smallplanMoney+'</td><td class="moneyText predict-all-money" style="display:none;">'+predictAllMoney+'</td><td class="special-instruct">'+specialInstruct+'</td><td><input type="hidden" class="popM" value="'+personnelFunds.tabIndex+'"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(html);personnelFunds.hidePredictCostAlert()}else{$("#predictCostTable .yt-tbody .last").before(html);$yt_alert_Model.prompt("填写的信息已成功加入到列表")}var totalAmount=0;$('#predictCostTable tbody .predict-smallplan-money').each(function(){totalAmount+=$yt_baseElement.rmoney($(this).text())});$('#predictCostTable tbody .costTotal').text($yt_baseElement.fmMoney(totalAmount));var costTotalAfter=0;$('#predictCostTable tbody .predict-all-money').each(function(){costTotalAfter+=$yt_baseElement.rmoney($(this).text())});$('#predictCostTable tbody .costTotal-after').text($yt_baseElement.fmMoney(costTotalAfter));personnelFunds.initModel(personnelFunds.thisPopM);personnelFunds.updateTotalNum();sysCommon.clearFormData();$("#predictCostPopM textarea").val("")}},showOtherAlert:function(){var alert=$('#oherTrainingAlert');sysCommon.showModel(alert);$yt_model_drag.modelDragEvent($("#oherTrainingAlert.yt-edit-alert .yt-edit-alert-title"))},showPredictCostAlert:function(){var alert=$('#predictCostAlert');sysCommon.showModel(alert)},hideOtherAlert:function(){var alert=$('#oherTrainingAlert');sysCommon.closeModel(alert)},hidePredictCostAlert:function(){var alert=$('#predictCostAlert');$yt_baseElement.hideMongoliaLayer();alert.hide();$('#pop-modle-alert').hide()},setTableOperaEvent:function(){$("#trainingPopTable").on('click','.operate-del',function(){var thisObj=$(this);$yt_alert_Model.alertOne({alertMsg:"确定要删除此条数据吗?",leftBtnName:"确定",confirmFunction:function(){thisObj.parents('tr').remove();$("#trainingFeeTable").find(".yt-tbody tr").remove();$("#lectureFeeTable,#carFeeTable,#hotelFeeTable,#dietFeeTable").find(".yt-tbody tr:not(:last)").remove();$("#lectureFeeTable,#carFeeTable,#hotelFeeTable,#dietFeeTable").find(".costTotal").text($yt_baseElement.fmMoney('0'));$("#lectureFeeTable").find(".costTotal-after").text($yt_baseElement.fmMoney('0'));personnelFunds.updateTotalNum()}})});$("#trainingPopTable").on('click','.operate-update',function(){var thisData=this;personnelFunds.updateThisTr(thisData,$("#trainingPopTable"))});$("#lecturerTable").on('click','.operate-del',function(){var thisObj=$(this);var thisTr=thisObj.parents('tr');var thisId=thisTr.find(".lectureId").val();$yt_alert_Model.alertOne({alertMsg:"确定要删除此条数据吗?",leftBtnName:"确定",confirmFunction:function(){personnelFunds.deleteLecturerInfo(thisId,thisTr)}})});$("#lecturerTable").on('click','.operate-update',function(){var thisObj=this;var thisTr=$(thisObj).parents('tr');personnelFunds.lecturerPopModel(thisTr);var lecturerName=$(thisTr).find(".lecturerName").text();var professional=$(thisTr).find(".professional").text();professional=professional=='--'?'请选择':professional;var level=$(thisTr).find(".level").text();level=level=='--'?'请选择':level;$("#lecturerPopModel").find("#lecturerName").val(lecturerName);$("#lecturerPopModel #professional").find("option:contains('"+professional+"')").attr("selected",true);$("#lecturerPopModel #level").find("option:contains('"+level+"')").attr("selected",true);$("#lecturerPopModel #professional,#level").niceSelect()});$("#trainingFeeTable").on('click','.operate-del',function(){var thisObj=this;var tr=$(this).parents('tr');$yt_alert_Model.alertOne({alertMsg:"确定要删除此条数据吗?",leftBtnName:"确定",confirmFunction:function(){tr.remove();var sum=0;$("#trainingFeeTable").find("tbody tr:not(.last)").each(function(){sum+=$yt_baseElement.rmoney($(this).find(".smallplan-money").text())});$("#trainingFeeTable").find(".costTotal").text($yt_baseElement.fmMoney(sum));personnelFunds.updateTotalNum()}})});$("#predictCostTable").on('click','.operate-del',function(){var thisObj=this;var tr=$(this).parents('tr');$yt_alert_Model.alertOne({alertMsg:"确定要删除此条数据吗?",leftBtnName:"确定",confirmFunction:function(){tr.remove();var sum=0;$("#predictCostTable").find("tbody tr:not(.last)").each(function(){sum+=$yt_baseElement.rmoney($(this).find(".predict-smallplan-money").text())});$("#predictCostTable").find(".costTotal").text($yt_baseElement.fmMoney(sum));var costTotalAfter=0;$("#predictCostTable").find("tbody tr:not(.last)").each(function(){costTotalAfter+=$yt_baseElement.rmoney($(this).find(".predict-all-money").text())});$("#predictCostTable").find(".costTotal-after").text($yt_baseElement.fmMoney(costTotalAfter));personnelFunds.updateTotalNum()}})});$("#lectureFeeTable").on('click','.operate-del',function(){var thisObj=this;personnelFunds.deleteThisTr(thisObj,$("#lectureFeeTable"))});$("#lectureFeeTable").on('click','.operate-update',function(){var thisObj=this;var thisTr=$(thisObj).parents('tr');personnelFunds.handlePopMShow(thisTr);var lecturerName=$(thisTr).find(".uname").text();var lecturerNameVal=$(thisTr).find(".lectureId").val();var lecturerProfessional=$(thisTr).find(".holder").text();var teachingHours=$(thisTr).find(".hour").text();var courseName=$(thisTr).find(".cname").text();var preTaxPay=0;var afterTaxPay=$(thisTr).find(".after").text();preTaxPay=$yt_baseElement.fmMoney($yt_baseElement.preTaxPaymoney(afterTaxPay));var athPay=$(thisTr).find(".avg").text();personnelFunds.initLecturerSelect(lecturerNameVal);$('#lectureFeePopM').find('.lecturerProfessional').text(lecturerProfessional);$('#lectureFeePopM').find('.teachingHours').val(teachingHours);$('#lectureFeePopM').find('.courseName').val(courseName);$('#lectureFeePopM').find('.preTaxPay').text(preTaxPay);$('#lectureFeePopM').find('.afterTaxPay').val(afterTaxPay);$('#lectureFeePopM').find('.athPay').text(athPay);personnelFunds.costPopModel(thisTr)});$("#carFeeTable").on('click','.operate-del',function(){var thisObj=this;personnelFunds.deleteThisTr(thisObj,$("#carFeeTable"))});$("#carFeeTable").on('click','.operate-update',function(){var thisObj=this;var thisTr=$(thisObj).parents('tr');personnelFunds.costPopModel(thisTr);var lecturerName=$(thisTr).find(".uname").text();var lecturerlevel=$(thisTr).find(".ulv").text();var startTime=$(thisTr).find(".sdate").text();var endTime=$(thisTr).find(".edate").text();var fromAddr=$(thisTr).find(".sadd").text();var endAddr=$(thisTr).find(".eadd").text();var vehicleArr=$(thisTr).find(".tname").text().split('-');var vehicle1='';var vehicle2='';if(vehicleArr.length>1){vehicle1=vehicleArr[0];vehicle2=vehicleArr[1]}else{vehicle1=vehicleArr[0]}var vehicleValArr=$(thisTr).find(".tool").val().split('-');var vehicle1Val='';var vehicle2Val='';if(vehicleValArr.length>1){vehicle1Val=vehicleValArr[0];vehicle2Val=vehicleValArr[1]}else{vehicle1Val=vehicleValArr[0]}var carFare=$(thisTr).find(".sum-pay").text();var specialInstruct=$(thisTr).find(".dec").text();var lecturerNameVal=$(thisTr).find("td").eq(0).find("input").val();var fromAddrVal=$(thisTr).find(".scode").val();var endAddrVal=$(thisTr).find(".ecode").val();personnelFunds.initLecturerSelect($(thisTr).find(".lectureId").val());$("#carFeePopM").find('.lecturerlevel').text(lecturerlevel);$('#carFeePopM').find('.startTime').val(startTime);$('#carFeePopM').find('.endTime').val(endTime);$('#carFeePopM').find(".fromAddr").html('<option value="'+fromAddrVal+'">'+fromAddr+'</option>');personnelFunds.getPlanBusiAddress($("#fromAddr"));$('#carFeePopM').find(".endAddr").html('<option value="'+endAddrVal+'">'+endAddr+'</option>');personnelFunds.getPlanBusiAddress($("#endAddr"));$('#carFeePopM select.vehicle1 option[value="'+vehicle1Val+'"]').attr("selected","selected");if(vehicleValArr.length>1){personnelFunds.vechicleChildData(vehicle1Val);$('#carFeePopM select.vehicle2 option[value="'+vehicle2Val+'"]').attr("selected","selected");$('#vehicle1,#vehicle2').niceSelect();$("div.vehicle2").show()}else{$('#vehicle1,#vehicle2').niceSelect();$(".vehicle2").hide()}$('#carFeePopM').find('.carFare').val(carFare);$('#carFeePopM').find('.specialInstruct').val(specialInstruct)});$("#hotelFeeTable").on('click','.operate-del',function(){var thisObj=this;personnelFunds.deleteThisTr(thisObj,$("#hotelFeeTable"))});$("#hotelFeeTable").on('click','.operate-update',function(){var thisObj=this;var thisTr=$(thisObj).parents('tr');personnelFunds.handlePopMShow(thisTr);personnelFunds.costPopModel(thisTr);var lecturerName=$(thisTr).find(".name").text();var checkInDate=$(thisTr).find(".sdate").text();var level=$(thisTr).find("input.level").val();var leaveDate=$(thisTr).find(".edate").text();var avgCost=$(thisTr).find(".avg").text();var stayDays=$(thisTr).find(".day").text();var stayCost=$(thisTr).find(".sum-pay").text();var specialInstruct=$(thisTr).find(".dec").text();var lecturerNameVal=$(thisTr).find(".lectureId").val();personnelFunds.initLecturerSelect(lecturerNameVal);$("#hotelFeePopM").find("select.lecturerName").niceSelect();$("#hotelFeePopM").find(".level").text(level);$("#hotelFeePopM").find(".lecturerName").niceSelect();$('#hotelFeePopM').find('.checkInDate').val(checkInDate);$('#hotelFeePopM').find('.leaveDate').val(leaveDate);$('#hotelFeePopM').find('.avgCost').text(avgCost);$('#hotelFeePopM').find('.stayDays').text(stayDays);$('#hotelFeePopM').find('.stayCost').val(stayCost);$("#hotelFeePopM").find(".level").text(level);$('#hotelFeePopM').find('.specialInstruct').val(specialInstruct)});$("#dietFeeTable").on('click','.operate-del',function(){var thisObj=this;personnelFunds.deleteThisTr(thisObj,$("#dietFeeTable"))});$("#dietFeeTable").on('click','.operate-update',function(){var thisObj=this;var thisTr=$(thisObj).parents('tr');personnelFunds.handlePopMShow(thisTr);var lecturerName=$(thisTr).find(".name").text();var avgCost=$(thisTr).find(".avg").text();var mealDays=$(thisTr).find(".day").text();var mealCost=$(thisTr).find(".sum-pay").text();var specialInstruct=$(thisTr).find(".dec").text();var lecturerNameVal=$(thisTr).find(".lectureId").val();personnelFunds.costPopModel(thisTr);personnelFunds.initLecturerSelect();$('#dietFeePopM select.lecturerName option[value="'+lecturerNameVal+'"]').attr("selected","selected");$("#dietFeePopM").find("select.lecturerName").niceSelect();$('#dietFeePopM').find('.avgCost').val(avgCost);$('#dietFeePopM').find('.mealDays').val(mealDays);$('#dietFeePopM').find('.mealCost').val(mealCost);$('#dietFeePopM').find('.specialInstruct').val(specialInstruct);})},getCostActivityPro:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:false,data:{dictTypeCode:'TEACHE_JOB_LEVEL_CODE,TEACHE_JOB_CODE,TRAIN_TYPE,VEHICIE_CODE,SPECIFIC_COST_TYPE'},success:function(data){var list=data.data||[];var start='<option value="">请选择</option>',optone=start,opttwo=start,travelType=start,vehicle=start,detaMoney=start;$.each(list,function(i,n){if(n.dictTypeCode=='TEACHE_JOB_LEVEL_CODE'){optone+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='TEACHE_JOB_CODE'){opttwo+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='TRAIN_TYPE'){travelType+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='VEHICIE_CODE'){vehicle+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='SPECIFIC_COST_TYPE'){detaMoney+='<option value="'+n.value+'">'+n.disvalue+'</option>'}});$('#level').html(optone).niceSelect();$('#professional').html(opttwo).niceSelect();$('#vehicle1').html(vehicle).on("change",function(){var selVal=$(this).val();personnelFunds.vechicleChildData(selVal)}).niceSelect()}})},getDictTypeByTypeCode:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictTypeByTypeCode",async:true,data:{dictTypeCode:'COST_OTHER'},success:function(data){var list=data.data||[];var start='<option value="">请选择</option>';$.each(list,function(i,n){if(n.value!="COST_OTHER9"){start+='<option value="'+n.value+'">'+n.disvalue+'</option>'}});$('select.cost-name').html(start).niceSelect()}})},vechicleChildData:function(selVal){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:false,data:{dictTypeCode:selVal},success:function(data){if(data.flag==0){var veStr="";$(".vehicle2").empty();veStr='';if(data.data.length>0){$(".vehicle2").attr("validform","{isNull:true,changeFlag:true,msg:'请选择交通工具'}");$.each(data.data,function(i,n){veStr+='<option value="'+n.value+'">'+n.disvalue+'</option>'});$(".vehicle2").append(veStr).niceSelect();$("div.vehicle2").show()}else{$(".vehicle2").attr("validform","{}");$(".vehicle2").niceSelect();$(".vehicle2").hide()}}}})},initLecturerSelect:function(code){var lecturerTrList=$("#lecturerTable .yt-tbody tr");personnelFunds.thisPopM.find(".lecturerNameSel").html('<option value="">请选择</option>');lecturerTrList.each(function(){var lecturerName=$(this).find('.lecturerName span').text();var lecturerId=$(this).find('.lecturerName input.lectureId').val();if(code&&code==lecturerId){personnelFunds.thisPopM.find(".lecturerNameSel").append('<option selected="selected" value="'+lecturerId+'">'+lecturerName+'</option>')}else{personnelFunds.thisPopM.find(".lecturerNameSel").append('<option value="'+lecturerId+'">'+lecturerName+'</option>')}});$('select.lecturerNameSel').niceSelect();personnelFunds.thisPopM.find(".lecturerNameSel").change(function(){var thisObj=$(this);var lecturerNameSelVal=thisObj.val();if(lecturerNameSelVal!=''){lecturerTrList.each(function(){var thisTr=$(this);var lecturerId=thisTr.find('.lecturerName input.lectureId').val();if(lecturerNameSelVal==lecturerId){var professional=thisTr.find('.professional').text();var level=thisTr.find('.level').text();personnelFunds.thisPopM.find(".professional").text(professional);personnelFunds.thisPopM.find(".level").text(level)}})}else{personnelFunds.thisPopM.find(".professional").text('');personnelFunds.thisPopM.find(".level").text('')}})},initPopMTab:function(){personnelFunds.tabIndex=0;$(".train-district .cost-type-tab li").eq(personnelFunds.tabIndex).addClass("tab-check").siblings().removeClass("tab-check");personnelFunds.thisPopM=$(".train-district .tab-info").hide().eq(personnelFunds.tabIndex).show();$("#trainingTotal").val("");$(".aupr").text($yt_baseElement.fmMoney(0))},costPopModelAddOrUp:function(){var trainingClasses=$("#trainingPopTable .trainingClasses").text();var trainingDay=$("#trainingPopTable .trainingDay").text();var trainingPerNumber=$("#trainingPopTable .trainingPerNumber").text();$("#trainingFeePopM .trainingClasses").text(trainingClasses);$("#trainingFeePopM .trainingDay").text(trainingDay);$("#trainingFeePopM .trainingPerNumber").text(trainingPerNumber);personnelFunds.costPopModel();$("#trainingTotal").blur(function(){var trainingTotal=$("#trainingTotal").val();if(trainingTotal){var aupr=$yt_baseElement.rmoney(trainingTotal);/ trainingDay /trainingPerNumber;$("#trainingFeePopM .aupr").text($yt_baseElement.fmMoney(aupr))}})},GetDateDiff:function(startTime,endTime,diffType){startTime=startTime.replace(/\-/g,"/");endTime=endTime.replace(/\-/g,"/");diffType=diffType.toLowerCase();var sTime=new Date(startTime);var eTime=new Date(endTime);var divNum=1;switch(diffType){case "second":divNum=1000;break;case "minute":divNum=1000*60;break;case "hour":divNum=1000*3600;break;case "day":divNum=1000*3600*24;break;default:break}return parseInt((eTime.getTime()-sTime.getTime())/parseInt(divNum))},updateTotalNum:function(){var fundsTotalNum=0;var afterNum=0;var aft=$('#carFeeTable,#hotelFeeTable,#dietFeeTable,#trainingFeeTable,#predictCostTable').find('.costTotal');var aftt=$('#lectureFeeTable').find('.costTotal');aft.each(function(){afterNum+=$yt_baseElement.rmoney($(this).text()||'0')});aftt.each(function(){afterNum+=$yt_baseElement.rmoney($(this).text()||'0')});var costTotal=$yt_baseElement.rmoney($("#lectureFeeTable .costTotal").text());var costTotalAfter=$yt_baseElement.rmoney($("#lectureFeeTable .costTotal-after").text());var tds=$('#lectureFeeTable,#carFeeTable,#hotelFeeTable,#dietFeeTable,#trainingFeeTable').find('.costTotal');tds.each(function(){fundsTotalNum+=$yt_baseElement.rmoney($(this).text()||'0')});$('#trainingFeeTable .training-total').each(function(){fundsTotalNum+=$yt_baseElement.rmoney($(this).text()||'0')});$("#serveAllMoney").text($yt_baseElement.fmMoney(fundsTotalNum||'0')).attr('num',fundsTotalNum);$("#doAdvanceAmount").text($yt_baseElement.fmMoney(afterNum||'0')).attr('num',afterNum);$("#applyTotalMoney").text($yt_baseElement.fmMoney(afterNum||'0')).attr('num',afterNum);var taxAmount=Number(costTotal-costTotalAfter);$("#taxAmount").text($yt_baseElement.fmMoney(taxAmount||'0')).attr('num',taxAmount);$("#payTeacherAll").text($yt_baseElement.fmMoney(taxAmount||'0')).attr('num',taxAmount);var sumMoneyLower=arabiaToChinese(fundsTotalNum||'0');var afterTaxAllMoney=$yt_baseElement.rmoney($("#predictCostTable .costTotal").text());$("#afterTaxAllMoney").text($yt_baseElement.fmMoney(afterTaxAllMoney||'0')).attr('num',afterTaxAllMoney);var preTaxAllMoney=$yt_baseElement.rmoney($("#predictCostTable .costTotal-after").text());$("#preTaxAllMoney").text($yt_baseElement.fmMoney(preTaxAllMoney||'0')).attr('num',preTaxAllMoney);$("#TotalMoneyUpper,.total-money-up").text(sumMoneyLower)},initModel:function(thisPopM){var costPopModel=$('#costPopModel');costPopModel.find(".lecturerProfessional,.lecturerlevel,#stayDays,.avgCost,#mealCost,.professional").text('');costPopModel.find("#startTime,#endTime,#checkInDate,#leaveDate,.specialInstruct").val('');sysCommon.clearValidInfo($("#startTime,#endTime,#checkInDate,#leaveDate"));$("#trainingAddr,#vehicle2").html("");$("#fromAddr,#endAddr").html('<option value="">请输入</option>');costPopModel.find(".yt-input,.yt-select").val('').removeClass('valid-hint');costPopModel.find(".yt-select:not(.fromAddr,.endAddr,.trainingAddr)").niceSelect();costPopModel.find(".valid-font").text('');$("#trainingDay").text('0');costPopModel.find(".aupr,.athPay,.preTaxPay").text($yt_baseElement.fmMoney('0'));personnelFunds.addressList=sysCommon.getAddressInfoList();personnelFunds.hotCityList=sysCommon.getHotCityList();if(personnelFunds.addressList!=""&&personnelFunds.addressList!=null){personnelFunds.getPlanBusiAddress($("#trainingAddr"));personnelFunds.getPlanBusiAddress($("#fromAddr"));personnelFunds.getPlanBusiAddress($("#endAddr"))}if(thisPopM){}costPopModel.find('.lecturerProfessional,.level').text('');$("#startTime,#endTime,#checkInDate,#leaveDate").val("")},getPlanBusiAddress:function(labelObj){$(labelObj).niceSelect({search:true,backFunction:function(text){$(labelObj).find("option").remove();var opt='';if(text==""){opt+='<option value="" disabled="disabled">热门城市</option>';$.each(personnelFunds.hotCityList,function(i,n){opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'/'+n.regionMergerName+'</option>'})}else{$.each(personnelFunds.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1){opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'/'+n.regionMergerName+'</option>'}if(n.regionNamePinYin.indexOf(text)!=-1){opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'/'+n.regionMergerName+'</option>'}})}$(labelObj).append(opt)}});$(labelObj).next("div.nice-select").find(".search-current").blur(function(){if($(this).val()==""){$(this).val("请输入")}})},deleteThisTr:function(thisObj,thisTable){$yt_alert_Model.alertOne({alertMsg:"确定要删除此条数据吗?",leftBtnName:"确定",confirmFunction:function(){$(thisObj).parents('tr').remove();if(thisTable){var sum=0;thisTable.find("tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);sum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});thisTable.find(".costTotal").text($yt_baseElement.fmMoney(sum))}if(thisTable.selector=="#lectureFeeTable"){var sum=0;thisTable.find("tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);sum+=$yt_baseElement.rmoney(thisObj.find(".after").text())});thisTable.find(".costTotal-after").text($yt_baseElement.fmMoney(sum))}personnelFunds.updateTotalNum()}})},updateThisTr:function(thisObj){var thisTr=$(thisObj).parents('tr');personnelFunds.trainingPopModel(thisTr);var trainingClasses=$(thisTr).attr('traintype');var trainingAddr=$(thisTr).find(".trainingAddr").text();var trainingAddrVal=$(thisTr).find(".trainingAddrVal").val();var trainingReportDate=$(thisTr).find(".trainingReportDate").text();var trainingEndingDate=$(thisTr).find(".trainingEndingDate").text();var trainingDay=$(thisTr).find(".trainingDay").text();var trainingPerNumber=$(thisTr).find(".trainingPerNumber").text();$("#trainingClasses").find('option[value="'+trainingClasses+'"]').attr("selected",true);$("#trainingAddr").html('<option value="'+trainingAddrVal+'">'+trainingAddr+'</option>');personnelFunds.getPlanBusiAddress($("#trainingAddr"));$("#trainingClasses").niceSelect();$("#trainingReportDate").val(trainingReportDate);$("#trainingEndingDate").val(trainingEndingDate);$("#trainingDay").text(trainingDay);$("#trainingPerNumber").val(trainingPerNumber)},saveUpdateThisTr:function(thisTr){if(thisTr){thisTr.remove()}var trainingClassVal=$("#trainingClasses").val();var trainingClasses=$("#trainingClasses option:selected").text();var trainingAddrVal=$("#trainingAddr").val();var trainingAddr=$("#trainingAddr option:selected").text();var trainingReportDate=$("#trainingReportDate").val();var trainingEndingDate=$("#trainingEndingDate").val();var day=personnelFunds.GetDateDiff(trainingReportDate,trainingEndingDate,"day")+1;var trainingPerNumber=$("#trainingPerNumber").val();$("#trainingPopTable .yt-table .yt-tbody").append('<tr pid="" trainType="'+trainingClassVal+'"><td class="trainingClasses">'+trainingClasses+'</td><td class="trainingAddr"><input type="hidden" class="trainingAddrVal" value="'+trainingAddrVal+'">'+trainingAddr+'</td><td class="trainingReportDate">'+trainingReportDate+'</td><td class="trainingEndingDate">'+trainingEndingDate+'</td><td class="trainingDay">'+day+'</td><td class="trainingPerNumber">'+trainingPerNumber+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>')},trainingPopModel:function(thisTr){if(thisTr){$("#trainingPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn").addClass('yt-model-save-btn').text('确定')}else{$("#trainingPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-save-btn").removeClass('yt-model-save-btn').text('保存')}$("#trainingPopModel.yt-edit-alert,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($("#trainingPopModel"));$yt_model_drag.modelDragEvent($("#trainingPopModel.yt-edit-alert .yt-edit-alert-title"));$('#trainingPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn,#trainingPopModel .closed-span').off().on("click",function(){personnelFunds.initModel($("#trainingPopModel"));$("#trainingPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$('#trainingPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){var isFalse=$yt_valid.validForm($("#trainingPopModel"));if(isFalse){personnelFunds.saveUpdateThisTr();$("#trainingPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();$("#trainingPopTable .operate-update").click(function(){var thisData=this;personnelFunds.updateThisTr(thisData,$("#trainingPopTable"))});$("#trainingPopTable .operate-del").click(function(){var thisObj=$(this);$yt_alert_Model.alertOne({alertMsg:"确定要删除此条数据吗?",leftBtnName:"确定",confirmFunction:function(){thisObj.parents('tr').remove();$("#trainingFeeTable").find(".yt-tbody tr").remove();$("#lectureFeeTable,#carFeeTable,#hotelFeeTable,#dietFeeTable").find(".yt-tbody tr:not(:last)").remove();$("#lectureFeeTable,#carFeeTable,#hotelFeeTable,#dietFeeTable").find(".costTotal").text($yt_baseElement.fmMoney('0'));$("#lectureFeeTable").find(".costTotal-after").text($yt_baseElement.fmMoney('0'));personnelFunds.updateTotalNum()}})});personnelFunds.initModel($("#trainingPopModel"))}});$("#trainingPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-save-btn").off().on("click",function(){var isFalse=$yt_valid.validForm($("#trainingPopModel"));if(isFalse){personnelFunds.saveUpdateThisTr(thisTr);$("#trainingPopTable .operate-del").click(function(){var thisObj=$(this);$yt_alert_Model.alertOne({alertMsg:"确定要删除此条数据吗?",leftBtnName:"确定",confirmFunction:function(){thisObj.parents('tr').remove();$("#trainingFeeTable").find(".yt-tbody").remove();$("#lectureFeeTable,#carFeeTable,#hotelFeeTable,#dietFeeTable").find(".yt-tbody tr:not(:last)").remove();$("#lectureFeeTable,#carFeeTable,#hotelFeeTable,#dietFeeTable").find(".costTotal").text($yt_baseElement.fmMoney('0'));$("#lectureFeeTable").find(".costTotal-after").text($yt_baseElement.fmMoney('0'));personnelFunds.updateTotalNum()}})});$("#trainingPopTable .operate-update").click(function(){var thisData=this;personnelFunds.updateThisTr(thisData,$("#trainingPopTable"))});personnelFunds.initModel($("#trainingPopModel"));$("#trainingPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();personnelFunds.updateTotalNum()}})},lecturerPopModel:function(thisTr){if(thisTr){$("#lecturerPopModel.yt-edit-alert .yt-eidt-model-bottom .请先选择事前申请单").addClass('yt-model-save-btn').text('确定')}else{$("#lecturerPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-save-btn").removeClass('yt-model-save-btn').text('保存');}$("#lecturerPopModel.yt-edit-alert,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($("#lecturerPopModel"));$yt_model_drag.modelDragEvent($("#lecturerPopModel.yt-edit-alert .yt-edit-alert-title"));$('#lecturerPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn,#lecturerPopModel .closed-span').off().on("click",function(){personnelFunds.initModel($("#lecturerPopModel"));$("#lecturerPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$('#lecturerPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){var isFalse=$yt_valid.validForm($("#lecturerPopModel"));if(isFalse){var lectureId='';var lecturerName=$("#lecturerName").val();var professional=$("#professional option:selected").val();var professionalVal=$("#professional option:selected").text();professionalVal=professionalVal=='请选择'?'':professionalVal;var level=$("#level option:selected").val();var levelVal=$("#level option:selected").text();levelVal=levelVal=='请选择'?'':levelVal;personnelFunds.lectureId+=1;if(thisTr){lectureId=thisTr.find('.lectureId').val()}personnelFunds.addToListLecturerInfo({lectureId:lectureId,lecturerName:lecturerName,lecturerTitleCode:professional,professionalVal:professionalVal,lecturerLevelCode:level,levelVal:levelVal},thisTr)}})},setLecturerTableEvent:function(){$('#lecturerPopModel input').val('');$('#lecturerPopModel select').each(function(){$(this).find('option:first-child').attr('selected',true)}).niceSelect();$yt_alert_Model.prompt("填写的信息已成功加入到列表")},costPopModel:function(thisTr){personnelFunds.handlePopMShow(thisTr);$("#costPopModel.yt-edit-alert,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($("#costPopModel"));$yt_model_drag.modelDragEvent($("#costPopModel.yt-edit-alert .yt-edit-alert-title"));if(personnelFunds.tabIndex==0){personnelFunds.lectureFeePopM(thisTr)}else if(personnelFunds.tabIndex==1){personnelFunds.carFeePopM(thisTr)}else if(personnelFunds.tabIndex==2){personnelFunds.hotelFeePopM(thisTr)}else if(personnelFunds.tabIndex==3){personnelFunds.dietFeePopM(thisTr)}else if(personnelFunds.tabIndex==4){personnelFunds.trainingFeePopM(thisTr)}},trainingFeePopM:function(thisTr){$("#trainingTotal").blur(function(){if($("#trainingTotal").val()){var aupr=$yt_baseElement.rmoney($("#trainingTotal").val())/personnelFunds.thisPopM.find(".trainingDay").text()/personnelFunds.thisPopM.find(".trainingPerNumber").text();$("#trainingFeePopM .aupr").text($yt_baseElement.fmMoney(aupr))}else{$("#trainingFeePopM .aupr").text($yt_baseElement.fmMoney('0'))}});personnelFunds.handlePopMShow(thisTr);$("#costPopModel.yt-edit-alert,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($("#costPopModel"));$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn,#costPopModel .closed-span').off().on("click",function(){personnelFunds.initModel(personnelFunds.thisPopM);$("#costPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$('#oherTrainingAlert.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){if(true){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var costName=$("#trainingFeePopM .cost-name option:selected").text();var costNameVal=$("#trainingFeePopM .cost-name option:selected").val();var standardMoney=$("#trainingFeePopM .standard-money").val();var peopleNum=$("#trainingFeePopM .people-num").val();var dayNum=$("#trainingFeePopM .day-num").val();var smallplanMoney=$("#trainingFeePopM .smallplan-money").val();var specialInstruct=$("#trainingFeePopM .specialInstruct").val();$("#trainingFeeTable .yt-tbody tr").eq(-1).before('<tr costNameVal="'+costNameVal+'" pid=""><td class="cost-name">'+costName+'</td><td class="moneyText standard-money">'+standardMoney+'</td><td class="people-num">'+peopleNum+'</td><td class="day-num">'+dayNum+'</td><td class="moneyText smallplan-money">'+smallplanMoney+'</td><td class="special-instruct">'+specialInstruct+'</td><td><input type="hidden" class="popM" value="'+personnelFunds.tabIndex+'"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>');var totalAmount=0;$('#trainingFeeTable tbody .smallplan-money').each(function(){totalAmount+=$yt_baseElement.rmoney($(this).text())});$('#trainingFeeTable tbody .costTotal').text($yt_baseElement.fmMoney(totalAmount));personnelFunds.initModel(personnelFunds.thisPopM);$yt_alert_Model.prompt("填写的信息已成功加入到列表");personnelFunds.updateTotalNum()}}else{$yt_alert_Model.prompt("只能添加一条培训信息")}});$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-save-btn').off().on("click",function(){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var costName=$("#trainingFeePopM .cost-name option:selected").text();var costNameVal=$("#trainingFeePopM .cost-name option:selected").val();var standardMoney=$("#trainingFeePopM .standard-money").val();var peopleNum=$("#trainingFeePopM .people-num").val();var dayNum=$("#trainingFeePopM .day-num").val();var smallplanMoney=$("#trainingFeePopM .smallplan-money").val();var specialInstruct=$("#trainingFeePopM .specialInstruct").val();thisTr.replaceWith('<tr costNameVal="'+costNameVal+'" pid=""><td class="cost-name">'+costName+'</td><td class="moneyText standard-money">'+standardMoney+'</td><td class="people-num">'+peopleNum+'</td><td class="day-num">'+dayNum+'</td><td class="moneyText smallplan-money">'+smallplanMoney+'</td><td class="special-instruct">'+specialInstruct+'</td><td><input type="hidden" class="popM" value="'+personnelFunds.tabIndex+'"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>');var totalAmount=0;$('#trainingFeeTable tbody .smallplan-money').each(function(){totalAmount+=$yt_baseElement.rmoney($(this).text())});$('#trainingFeeTable tbody .costTotal').text($yt_baseElement.fmMoney(totalAmount));personnelFunds.initModel(personnelFunds.thisPopM);$("#costPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();$yt_alert_Model.prompt("填写的信息已成功加入到列表");personnelFunds.updateTotalNum()}})},predictCostPopM:function(thisTr){$("#trainingTotal").blur(function(){if($("#trainingTotal").val()){var aupr=$yt_baseElement.rmoney($("#trainingTotal").val())/personnelFunds.thisPopM.find(".trainingDay").text()/personnelFunds.thisPopM.find(".trainingPerNumber").text();$("#predictCostPopM .aupr").text($yt_baseElement.fmMoney(aupr))}else{$("#predictCostPopM .aupr").text($yt_baseElement.fmMoney('0'))}});personnelFunds.handlePopMShow(thisTr);$("#predictCostPopM.yt-edit-alert,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($("#costPopModel"));$('#predictCostPopM.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn,#predictCostPopM .closed-span').off().on("click",function(){personnelFunds.initModel(personnelFunds.thisPopM);$("#predictCostPopM.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$('#oherTrainingAlert.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){if(true){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var costName=$("#predictCostPopM .cost-name option:selected").text();var costNameVal=$("#predictCostPopM .cost-name option:selected").val();var standardMoney=$("#predictCostPopM .standard-money").val();var peopleNum=$("#predictCostPopM .people-num").val();var dayNum=$("#predictCostPopM .day-num").val();var smallplanMoney=$("#predictCostPopM .smallplan-money").val();var specialInstruct=$("#predictCostPopM .specialInstruct").val();$("#trainingFeeTable .yt-tbody tr").eq(-1).before('<tr costNameVal="'+costNameVal+'" pid=""><td class="cost-name">'+costName+'</td><td class="moneyText standard-money">'+standardMoney+'</td><td class="people-num">'+peopleNum+'</td><td class="day-num">'+dayNum+'</td><td class="moneyText smallplan-money">'+smallplanMoney+'</td><td class="special-instruct">'+specialInstruct+'</td><td><input type="hidden" class="popM" value="'+personnelFunds.tabIndex+'"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>');var totalAmount=0;$('#trainingFeeTable tbody .smallplan-money').each(function(){totalAmount+=$yt_baseElement.rmoney($(this).text())});$('#trainingFeeTable tbody .costTotal').text($yt_baseElement.fmMoney(totalAmount));personnelFunds.initModel(personnelFunds.thisPopM);$yt_alert_Model.prompt("填写的信息已成功加入到列表");personnelFunds.updateTotalNum()}}else{$yt_alert_Model.prompt("只能添加一条培训信息")}});$('#predictCostPopM.yt-edit-alert .yt-eidt-model-bottom .yt-model-save-btn').off().on("click",function(){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var costName=$("#predictCostPopM .cost-name").val();var standardMoney=$("#predictCostPopM .standard-money").val();var peopleNum=$("#predictCostPopM .people-num").val();var smallplanMoney=$("#predictCostPopM .smallplan-money").val();var predictAllMoney=$("#predictCostPopM .predict-all-money").val();var specialInstruct=$("#predictCostPopM .specialInstruct").val();thisTr.replaceWith('<tr  pid=""><td class="cost-name">'+costName+'</td><td class="moneyText standard-money">'+standardMoney+'</td><td class="people-num">'+peopleNum+'</td><td class="moneyText smallplan-money">'+smallplanMoney+'</td><td class="moneyText predict-all-money" style="display:none;">'+predictAllMoney+'</td><td class="special-instruct">'+specialInstruct+'</td><td><input type="hidden" class="popM" value="'+personnelFunds.tabIndex+'"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>');var totalAmount=0;$('#predictCostTable tbody .smallplan-money').each(function(){totalAmount+=$yt_baseElement.rmoney($(this).text())});$('#predictCostTable tbody .costTotal').text($yt_baseElement.fmMoney(totalAmount));var costTotalAfter=0;$('#predictCostTable tbody .predict-all-money').each(function(){costTotalAfter+=$yt_baseElement.rmoney($(this).text())});$('#predictCostTable tbody .costTotal-after').text($yt_baseElement.fmMoney(costTotalAfter));personnelFunds.initModel(personnelFunds.thisPopM);$yt_alert_Model.prompt("填写的信息已成功加入到列表");personnelFunds.updateTotalNum()}})},lectureFeePopM:function(thisTr){if(!thisTr){personnelFunds.thisPopM.find(".athPay").text($yt_baseElement.fmMoney('0'))}$(personnelFunds.thisPopM.find(".afterTaxPay,.teachingHours")).blur(function(){var athPay=0;var preTaxPay=0;if(personnelFunds.thisPopM.find(".afterTaxPay").val()&&personnelFunds.thisPopM.find(".teachingHours").val()){var afterTaxPay=personnelFunds.thisPopM.find('.afterTaxPay').val();athPay=$yt_baseElement.rmoney(afterTaxPay)/personnelFunds.thisPopM.find(".teachingHours").val();preTaxPay=$yt_baseElement.preTaxPaymoney($yt_baseElement.rmoney(afterTaxPay));personnelFunds.thisPopM.find(".athPay").text($yt_baseElement.fmMoney(athPay));personnelFunds.thisPopM.find(".preTaxPay").text($yt_baseElement.fmMoney(preTaxPay))}});$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn,#costPopModel .closed-span').off().on("click",function(){personnelFunds.initModel(personnelFunds.thisPopM);$("#costPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var lecturerName=personnelFunds.thisPopM.find('.lecturerName option:selected').text();var lecturerProfessional=personnelFunds.thisPopM.find('.lecturerProfessional').text();var teachingHours=personnelFunds.thisPopM.find('.teachingHours').val();var courseName=personnelFunds.thisPopM.find('.courseName').val();var preTaxPay=0;var afterTaxPay=$yt_baseElement.fmMoney(personnelFunds.thisPopM.find('.afterTaxPay').val());preTaxPay=$yt_baseElement.fmMoney($yt_baseElement.preTaxPaymoney(afterTaxPay));var athPay=personnelFunds.thisPopM.find('.athPay').text();var lecturerNameVal=personnelFunds.thisPopM.find('.lecturerName option:selected').val();$("#lectureFeeTable .yt-tbody tr").eq(-1).before('<tr pid=""><td class="uname"><input type="hidden" class="lectureId" value="'+lecturerNameVal+'">'+lecturerName+'</td><td class="holder">'+lecturerProfessional+'</td><td class="hour">'+teachingHours+'</td><td class="cname">'+(courseName||'--')+'</td><td class="moneyText sum-pay">'+preTaxPay+'</td><td class="moneyText after">'+afterTaxPay+'</td><td class="moneyText avg">'+athPay+'</td><td><input type="hidden" class="popM" value="'+personnelFunds.tabIndex+'"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>');var sum=0;$("#lectureFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);sum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});var after=0;$("#lectureFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);after+=$yt_baseElement.rmoney(thisObj.find(".after").text())});$("#lectureFeeTable .costTotal-after").text($yt_baseElement.fmMoney(after));$("#lectureFeeTable .costTotal").text($yt_baseElement.fmMoney(sum));personnelFunds.updateTotalNum();personnelFunds.initModel(personnelFunds.thisPopM);personnelFunds.initPopMTab();$yt_alert_Model.prompt("填写的信息已成功加入到列表")}});$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-save-btn').off().on("click",function(){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var lecturerName=personnelFunds.thisPopM.find('.lecturerName option:selected').text();var lecturerProfessional=personnelFunds.thisPopM.find('.lecturerProfessional').text();var teachingHours=personnelFunds.thisPopM.find('.teachingHours').val();var courseName=personnelFunds.thisPopM.find('.courseName').val();var preTaxPay=0;var afterTaxPay=$yt_baseElement.fmMoney(personnelFunds.thisPopM.find('.afterTaxPay').val());preTaxPay=$yt_baseElement.fmMoney($yt_baseElement.preTaxPaymoney(afterTaxPay));var athPay=personnelFunds.thisPopM.find('.athPay').text();var lecturerNameVal=personnelFunds.thisPopM.find('.lecturerName option:selected').val();$(thisTr).find("td").eq(0).html('<input type="hidden" class="lectureId" value="'+lecturerNameVal+'">'+lecturerName);$(thisTr).find("td").eq(1).text(lecturerProfessional);$(thisTr).find("td").eq(2).text(teachingHours);$(thisTr).find("td").eq(3).text(courseName);$(thisTr).find("td").eq(4).text(preTaxPay);$(thisTr).find("td").eq(5).text(afterTaxPay);$(thisTr).find("td").eq(6).text(athPay);var sum=0;$("#lectureFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);sum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});var after=0;$("#lectureFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);after+=$yt_baseElement.rmoney(thisObj.find(".after").text())});$("#lectureFeeTable .costTotal-after").text($yt_baseElement.fmMoney(after));$("#lectureFeeTable .costTotal").text($yt_baseElement.fmMoney(sum));personnelFunds.updateTotalNum();personnelFunds.initModel(personnelFunds.thisPopM);$("#costPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()}})},carFeePopM:function(thisTr){$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn,#costPopModel .closed-span').off().on("click",function(){personnelFunds.initModel(personnelFunds.thisPopM);$("#costPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var lecturerName=personnelFunds.thisPopM.find('.lecturerName option:selected').text();var lecturerlevel=personnelFunds.thisPopM.find('.lecturerlevel').text();var startTime=personnelFunds.thisPopM.find('.startTime').val();var endTime=personnelFunds.thisPopM.find('.endTime').val();var fromAddr=personnelFunds.thisPopM.find("select.fromAddr option:selected").text();var endAddr=personnelFunds.thisPopM.find("select.endAddr option:selected").text();var vehicle1=personnelFunds.thisPopM.find('.vehicle1 option:selected').text();var vehicle2=personnelFunds.thisPopM.find('.vehicle2 option:selected').text();var carFare=personnelFunds.thisPopM.find('.carFare').val();var specialInstruct=personnelFunds.thisPopM.find('.specialInstruct').val();var lecturerNameVal=personnelFunds.thisPopM.find('.lecturerName').val();var fromAddrVal=personnelFunds.thisPopM.find('.fromAddr').val();var endAddrVal=personnelFunds.thisPopM.find('.endAddr').val();var vehicle1Val=personnelFunds.thisPopM.find('.vehicle1').val();var vehicle2Val=personnelFunds.thisPopM.find('.vehicle2').val();var thisHtml="";thisHtml+='<tr pid=""><td class="uname"><input type="hidden" class="lectureId" value="'+lecturerNameVal+'">'+lecturerName+'</td><td class="ulv">'+lecturerlevel+'</td><td class="sdate">'+startTime+'</td><td class="edate">'+endTime+'</td><td class="sadd"><input type="hidden" class="scode" value="'+fromAddrVal+'">'+fromAddr+'</td><td class="eadd"><input type="hidden" class="ecode" value="'+endAddrVal+'">'+endAddr+'</td><td class="tname"><input type="hidden" class="tool" value="'+vehicle1Val;if(vehicle2){thisHtml+='-'+vehicle2Val}thisHtml+='">'+vehicle1;if(vehicle2){thisHtml+='-'+vehicle2}thisHtml+='</td><td class="moneyText sum-pay">'+carFare+'</td><td style="" class="dec">'+specialInstruct+'</td><td><input type="hidden" class="popM" value="'+personnelFunds.tabIndex+'"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';$("#carFeeTable .yt-tbody tr").eq(-1).before(thisHtml);var sum=0;$("#carFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);sum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#carFeeTable .costTotal").text($yt_baseElement.fmMoney(sum));personnelFunds.updateTotalNum();personnelFunds.initModel(personnelFunds.thisPopM);personnelFunds.initPopMTab();$yt_alert_Model.prompt("填写的信息已成功加入到列表")}});$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-save-btn').off().on("click",function(){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var lecturerName=personnelFunds.thisPopM.find('.lecturerName option:selected').text();var lecturerlevel=personnelFunds.thisPopM.find('.lecturerlevel').text();var startTime=personnelFunds.thisPopM.find('.startTime').val();var endTime=personnelFunds.thisPopM.find('.endTime').val();var fromAddr=personnelFunds.thisPopM.find("select.fromAddr option:selected").text();var endAddr=personnelFunds.thisPopM.find("select.endAddr option:selected").text();var vehicle1=personnelFunds.thisPopM.find('.vehicle1 option:selected').text();var vehicle2=personnelFunds.thisPopM.find('.vehicle2 option:selected').text();var carFare=personnelFunds.thisPopM.find('.carFare').val();var specialInstruct=personnelFunds.thisPopM.find('.specialInstruct').val();var lecturerNameVal=personnelFunds.thisPopM.find('.lecturerName').val();var fromAddrVal=personnelFunds.thisPopM.find('.fromAddr').val();var endAddrVal=personnelFunds.thisPopM.find('.endAddr').val();var vehicle1Val=personnelFunds.thisPopM.find('.vehicle1').val();var vehicle2Val=personnelFunds.thisPopM.find('.vehicle2').val();var thisHtml="";thisHtml+='<tr pid=""><td class="uname"><input type="hidden" class="lectureId" value="'+lecturerNameVal+'">'+lecturerName+'</td><td class="ulv">'+lecturerlevel+'</td><td class="sdate">'+startTime+'</td><td class="edate">'+endTime+'</td><td class="sadd"><input type="hidden" class="scode" value="'+fromAddrVal+'">'+fromAddr+'</td><td class="eadd"><input type="hidden" class="ecode" value="'+endAddrVal+'">'+endAddr+'</td><td class="tname"><input type="hidden" class="tool" value="'+vehicle1Val;if(vehicle2){thisHtml+='-'+vehicle2Val}thisHtml+='">'+vehicle1;if(vehicle2){thisHtml+='-'+vehicle2}thisHtml+='</td><td class="moneyText sum-pay">'+carFare+'</td><td style="" class="dec">'+specialInstruct+'</td><td><input type="hidden" class="popM" value="'+personnelFunds.tabIndex+'"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';$(thisTr).replaceWith(thisHtml);var sum=0;$("#carFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);sum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#carFeeTable .costTotal").text($yt_baseElement.fmMoney(sum));personnelFunds.updateTotalNum();personnelFunds.initModel(personnelFunds.thisPopM);personnelFunds.initPopMTab();$("#costPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()}})},hotelFeePopM:function(thisTr){$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn,#costPopModel .closed-span').off().on("click",function(){personnelFunds.initModel(personnelFunds.thisPopM);$("#costPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$(personnelFunds.thisPopM.find(".stayCost")).keyup(function(){var avgCost=0;var stayCost=personnelFunds.thisPopM.find(".stayCost").val();var checkInDate=personnelFunds.thisPopM.find(".checkInDate").val();var leaveDate=personnelFunds.thisPopM.find(".leaveDate").val();if(stayCost&&checkInDate&&leaveDate){if(personnelFunds.thisPopM.find("#stayDays").text()==0){avgCost= +$yt_baseElement.rmoney(personnelFunds.thisPopM.find(".stayCost").val())}else{avgCost= +$yt_baseElement.rmoney(personnelFunds.thisPopM.find(".stayCost").val())/personnelFunds.thisPopM.find("#stayDays").text()}}personnelFunds.thisPopM.find(".avgCost").text($yt_baseElement.fmMoney(avgCost))});$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var lecturerName=personnelFunds.thisPopM.find('select.lecturerName option:selected').text();var checkInDate=personnelFunds.thisPopM.find('.checkInDate').val();var level=personnelFunds.thisPopM.find('.level').text();var leaveDate=personnelFunds.thisPopM.find('.leaveDate').val();var avgCost=personnelFunds.thisPopM.find('.avgCost').text();var stayDays=personnelFunds.thisPopM.find('.stayDays').text();var stayCost=personnelFunds.thisPopM.find('.stayCost').val();var specialInstruct=personnelFunds.thisPopM.find('.specialInstruct').val();var lecturerNameVal=personnelFunds.thisPopM.find('select.lecturerName').val();$("#hotelFeeTable .yt-tbody tr").eq(-1).before('<tr><td class="name"><input type="hidden" class="level" value="'+level+'"><input type="hidden" class="lectureId" value="'+lecturerNameVal+'">'+lecturerName+'</td><td class="sdate">'+checkInDate+'</td><td class="edate">'+leaveDate+'</td><td class="moneyText avg">'+avgCost+'</td><td class="day">'+stayDays+'</td><td class="moneyText sum-pay">'+stayCost+'</td><td style="" class="dec">'+specialInstruct+'</td><td><input type="hidden" class="popM" value="'+personnelFunds.tabIndex+'"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>');var sum=0;$("#hotelFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);sum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#hotelFeeTable .costTotal").text($yt_baseElement.fmMoney(sum));personnelFunds.updateTotalNum();personnelFunds.initModel(personnelFunds.thisPopM);personnelFunds.initPopMTab();$yt_alert_Model.prompt("填写的信息已成功加入到列表")}});$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-save-btn').off().on("click",function(){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var lecturerName=personnelFunds.thisPopM.find('.lecturerName option:selected').text();var checkInDate=personnelFunds.thisPopM.find('.checkInDate').val();var leaveDate=personnelFunds.thisPopM.find('.leaveDate').val();var avgCost=personnelFunds.thisPopM.find('.avgCost').text();var stayDays=personnelFunds.thisPopM.find('.stayDays').text();var stayCost=personnelFunds.thisPopM.find('.stayCost').val();var specialInstruct=personnelFunds.thisPopM.find('.specialInstruct').val();var lecturerNameVal=personnelFunds.thisPopM.find('.lecturerName').val();$(thisTr).find("td").eq(0).html('<input type="hidden" class="lectureId" value="'+lecturerNameVal+'">'+lecturerName);$(thisTr).find("td").eq(1).text(checkInDate);$(thisTr).find("td").eq(2).text(leaveDate);$(thisTr).find("td").eq(3).text(avgCost);$(thisTr).find("td").eq(4).text(stayDays);$(thisTr).find("td").eq(5).text(stayCost);$(thisTr).find("td").eq(6).text(specialInstruct);var sum=0;$("#hotelFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);sum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#hotelFeeTable .costTotal").text($yt_baseElement.fmMoney(sum));personnelFunds.updateTotalNum();personnelFunds.initModel(personnelFunds.thisPopM);personnelFunds.initPopMTab();$("#costPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()}})},dietFeePopM:function(thisTr){$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn,#costPopModel .closed-span').off().on("click",function(){personnelFunds.initModel(personnelFunds.thisPopM);$("#costPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$(personnelFunds.thisPopM.find(".avgCost,.mealDays")).blur(function(){var mealCost=0;if(personnelFunds.thisPopM.find(".avgCost").val()&&personnelFunds.thisPopM.find(".mealDays").val()){mealCost=$yt_baseElement.rmoney(personnelFunds.thisPopM.find(".avgCost").val())*personnelFunds.thisPopM.find(".mealDays").val();personnelFunds.thisPopM.find(".mealCost").val($yt_baseElement.fmMoney(mealCost||'0'))}else{personnelFunds.thisPopM.find(".mealCost").val($yt_baseElement.fmMoney(mealCost||'0'))}});$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var lecturerName=personnelFunds.thisPopM.find('.lecturerName option:selected').text();var avgCost=personnelFunds.thisPopM.find('.avgCost').val();var mealDays=personnelFunds.thisPopM.find('.mealDays').val();var mealCost=personnelFunds.thisPopM.find('.mealCost').val();var specialInstruct=personnelFunds.thisPopM.find('.specialInstruct').val();var lecturerNameVal=personnelFunds.thisPopM.find('.lecturerName option:selected').val();$("#dietFeeTable .yt-tbody tr").eq(-1).before('<tr pid=""><td class="name"><input type="hidden" class="lectureId" value="'+lecturerNameVal+'">'+lecturerName+'</td><td class="avg">'+avgCost+'</td><td class="day">'+mealDays+'</td><td class="moneyText sum-pay">'+mealCost+'</td><td style="" class="dec">'+specialInstruct+'</td><td><input type="hidden" class="popM" value="'+personnelFunds.tabIndex+'"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>');var sum=0;$("#dietFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);sum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text()||'0')});$("#dietFeeTable .costTotal").text($yt_baseElement.fmMoney(sum||'0'));personnelFunds.updateTotalNum();personnelFunds.initModel(personnelFunds.thisPopM);personnelFunds.initPopMTab();$yt_alert_Model.prompt("填写的信息已成功加入到列表")}});$('#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-save-btn').off().on("click",function(){var isFalse=$yt_valid.validForm(personnelFunds.thisPopM);if(isFalse){var lecturerName=personnelFunds.thisPopM.find('.lecturerName option:selected').text();var avgCost=personnelFunds.thisPopM.find('.avgCost').val();var mealDays=personnelFunds.thisPopM.find('.mealDays').val();var mealCost=personnelFunds.thisPopM.find('.mealCost').val();var specialInstruct=personnelFunds.thisPopM.find('.specialInstruct').val();var lecturerNameVal=personnelFunds.thisPopM.find('.lecturerName option:selected').val();$(thisTr).find("td").eq(0).html('<input type="hidden" class="lectureId" value="'+lecturerNameVal+'">'+lecturerName);$(thisTr).find("td").eq(1).text($yt_baseElement.fmMoney(avgCost||'0'));$(thisTr).find("td").eq(2).text(mealDays);$(thisTr).find("td").eq(3).text($yt_baseElement.fmMoney(mealCost||'0'));$(thisTr).find("td").eq(4).text(specialInstruct);var sum=0;$("#dietFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);sum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text()||'0')});$("#dietFeeTable .costTotal").text($yt_baseElement.fmMoney(sum||'0'));personnelFunds.updateTotalNum();personnelFunds.initModel(personnelFunds.thisPopM);personnelFunds.initPopMTab();$("#costPopModel.yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()}})},handlePopMShow:function(thisTr){if(thisTr){personnelFunds.tabIndex=thisTr.find('input.popM').val();personnelFunds.thisPopM=$(".train-district .tab-info").eq(personnelFunds.tabIndex);$(".train-district .cost-type-tab li").eq(personnelFunds.tabIndex).addClass("tab-check").siblings().removeClass("tab-check");$(".train-district .tab-info").hide().eq(personnelFunds.tabIndex).show();$("#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-sure-btn").addClass('yt-model-save-btn').text('确定')}else{$("#costPopModel.yt-edit-alert .yt-eidt-model-bottom .yt-model-save-btn").removeClass('yt-model-save-btn').text('保存');}},addToListLecturerInfo:function(saveData,tr){$.ajax({type:'post',url:'sz/lecturerApp/addToListLecturerInfo',data:saveData,success:function(data){if(data.flag==0){saveData.professionalVal=saveData.professionalVal==''?'--':saveData.professionalVal;saveData.levelVal=saveData.levelVal==''?'--':saveData.levelVal;var html='<tr pid="" lecturerTitleCode="'+saveData.lecturerTitleCode+'" lecturerLevelCode="'+saveData.lecturerLevelCode+'"><td class="lecturerName"><input type="hidden" class="lectureId" value="'+data.data+'"><span>'+saveData.lecturerName+'</span></td><td class="professional">'+saveData.professionalVal+'</td><td class="level">'+saveData.levelVal+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(html)}else{$("#lecturerTable .yt-table .yt-tbody").append(html)}personnelFunds.setLecturerTableEvent()}}})},deleteLecturerInfo:function(thisId,thisTr){thisTr.remove();var lecturerTrs=$('.cost-apply-model tr');$.each(lecturerTrs,function(i,n){if($(n).find("input.lectureId").val()==thisId){var thisTable=$(n).parents('table');var sum=0;$(n).remove();thisTable.find("tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);sum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});thisTable.find(".costTotal").text($yt_baseElement.fmMoney(sum))}});personnelFunds.updateTotalNum()}};function datedifference(sDate1,sDate2){var dateSpan,tempDate,iDays;sDate1=Date.parse(sDate1);sDate2=Date.parse(sDate2);dateSpan=sDate2-sDate1;dateSpan=Math.abs(dateSpan);iDays=Math.floor(dateSpan/(24*3600*1000));return iDays};$(function(){personnelFunds.init()});