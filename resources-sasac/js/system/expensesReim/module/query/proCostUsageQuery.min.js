var proCostUsageQuery={thisDate:"",init:function(){$("#proCostUsageQuery").css("min-height",$(window).height()-13);var requerParameter=$yt_common.GetRequest();var advanceAppId=requerParameter.advanceAppId;var appName=requerParameter.appName;var appNum=requerParameter.appNum;$(".query-text").val(appNum);$(".query-pid").val(advanceAppId);if($(".query-text").val()!=''){$('.clearImg').show()}proCostUsageQuery.events();$("#startDate").calendar({controlId:"startTime",nowData:true,upperLimit:$("#endDate"),speed:0,callback:function(){}});$("#endDate").calendar({controlId:"endTime",nowData:true,lowerLimit:$("#startDate"),speed:0,callback:function(){}});proCostUsageQuery.thisDate=$("#endDate").val();$("#startDate").val(proCostUsageQuery.thisDate.substring(0,proCostUsageQuery.thisDate.length-5)+"01-01");proCostUsageQuery.tablePage();proCostUsageQuery.verifyTable();proCostUsageQuery.popTablePage()},verifyTable:function(){var leTdList=$(".le-td");var gtTdList=$(".gt-td");leTdList.each(function(index){if($yt_baseElement.rmoney(leTdList.eq(index).text())>0){leTdList.eq(index).addClass("red-color")}else{leTdList.eq(index).removeClass("red-color")}});gtTdList.each(function(index){if(gtTdList.eq(index).text().substring(0,gtTdList.eq(index).text().length-1)/100>1){gtTdList.eq(index).addClass("red-color")}else{gtTdList.eq(index).removeClass("red-color")}})},events:function(){$('.clearImg').on('click',function(){$('.query-text').val('');$(".query-pid").val('');$(this).hide();proCostUsageQuery.tablePage();});$("#resetBtn").click(function(){$(".query-text").val('');$(".query-pid").val('');$("#startDate").val(proCostUsageQuery.thisDate.substring(0,proCostUsageQuery.thisDate.length-5)+"01-01");$("#endDate").val(proCostUsageQuery.thisDate);$(".radio-input-list input").parent("label").removeClass("check");$(".radio-input-list .yt-radio input:checked").val('');$('.clearImg').hide();proCostUsageQuery.tablePage()});$("#heardSearchBtn").click(function(){proCostUsageQuery.tablePage()});$(".radio-input-list .yt-radio").change(function(){proCostUsageQuery.tablePage()});$('.query-text').click(function(){proCostUsageQuery.showAlert()});$(".yt-edit-alert").on("click",".pop-search",function(){proCostUsageQuery.popTablePage()});$(".yt-edit-alert").on("click",".pop-reset",function(){$(".pop-text").val("");proCostUsageQuery.popTablePage()});$(".pop-sure-btn").click(function(){var selTrLen=$(".pro-pop-table tbody tr.yt-table-active").length;var thisTr=$(".pro-pop-table tbody tr.yt-table-active");var thisBtn=$(this);var Id=thisTr.find("input.tableId").val();if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作")}else{$(".query-text").val(thisTr.find("td").eq(0).text());var pid=thisTr.attr("pid");$(".query-pid").val(pid);if($(".query-text").val()!=''){$('.clearImg').show()}$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();proCostUsageQuery.tablePage()}});$('.export-excel').on('click',function(){var pid=$(".query-pid").val();var inputCheck=$(".radio-input-list input:checked").val()||'';var startDate=$("#startDate").val();var endDate=$("#endDate").val();var advanceAppNum=$('.query-text').val();var urlStr=$yt_option.base_path+'sz/advanceAppUpdate/exportTotalProjectAdvanceAppQueryByParams?projectId='+pid+'&startDate='+startDate+'&endDate='+endDate+'&differentAmount='+inputCheck+'&advanceAppNum='+advanceAppNum;if(typeof(downloadIframe)=="undefined"){var iframe=document.createElement("iframe");downloadIframe=iframe;document.body.appendChild(downloadIframe)}downloadIframe.src=urlStr;downloadIframe.style.display="none"});$(".button-box .yt-cancel-btn").click(function(){if(window.top==window.self){window.close()}else{parent.closeWindow()}})},tablePage:function(){var pid=$(".query-pid").val();var inputCheck=$(".radio-input-list input:checked").val();var startDate=$("#startDate").val();var endDate=$("#endDate").val();$.ajax({type:"post",url:"sz/advanceAppUpdate/getTotalProjectAdvanceAppQueryByParams",async:true,data:{projectId:pid,startDate:startDate,endDate:endDate,differentAmount:inputCheck,},success:function(data){var htmlTbody=$('.pro-cost-table .yt-tbody.tbody-content');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data.rows;if(data.data.amountParams){$("#advanceAllAmount").text($yt_baseElement.fmMoney(data.data.amountParams.advanceAllAmount));$("#expendAllAmount").text($yt_baseElement.fmMoney(data.data.amountParams.expendAllAmount));$("#differentAllAmount").text($yt_baseElement.fmMoney(data.data.amountParams.differentAllAmount));$("#advanceScaleAllAmount").text((data.data.amountParams.advanceScaleAllAmount*100)+'%');}else{$(".amount-params").hide();}if(datas.length>0){$(".amount-params").show();$('.payment-table-page').show();$.each(datas,function(i,n){trStr+='<tr><td>'+(n.amountName=="师资费-课酬费"?n.amountName+"<span style='font-size:12px;'>(不包含课酬相关税金)</span>":n.amountName)+'</td><td style="text-align: right;">'+$yt_baseElement.fmMoney(n.advanceAmount)+'</td>'+'<td style="text-align: right;">'+$yt_baseElement.fmMoney(n.expendAmount)+'</td>'+'<td style="text-align: right;" class="le-td">'+$yt_baseElement.fmMoney(n.differentAmount)+'</td>'+'<td style="text-align: right;" class="gt-td">'+(n.advanceScale*100).toFixed(2)+'%</td>'+'</tr>'});htmlTbody.html(trStr);proCostUsageQuery.verifyTable()}else{$(".amount-params").hide();$('.payment-table-page').hide();htmlTbody.html(proCostUsageQuery.noDataTrStr(5))}}}})},popTablePage:function(){var queryParams=$(".pop-text").val();$('.prior-page').pageInfo({pageIndex:1,pageNum:5,pageSize:5,url:'sz/advanceApp/getAdvanceProjectByParams',type:"post",async:false,data:{queryParams:queryParams},success:function(data){var htmlTbody=$('.pro-pop-table .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data.rows;if(datas.length>0){$('.prior-page').show();$.each(datas,function(i,n){trStr+='<tr pid="'+n.advanceAppId+'" code="'+n.advanceAppNum+'"><td>'+n.advanceAppNum+'<input type="hidden" class="balance" value="'+n.advanceAppBalance+'" /></td><td>'+n.applicantUserName+'</td><td>'+n.applicantUserDeptName+'</td><td style="text-align:left;">'+n.advanceAppName+'</td><td>'+n.advanceCostTypeName+'</td><td>'+n.applicantTime+'</td></tr>'});htmlTbody.html(trStr)}else{htmlTbody.html('<tr style="border:0px;background-color:#fff !important;"><td  colspan="6" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;padding:10px"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="width: 180px;padding: 10px 0 20px;"></div></td></tr>');$('.prior-page').hide()}}else{htmlTbody.html('<tr style="border:0px;background-color:#fff !important;"><td  colspan="6" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;padding:10px"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="width: 180px;padding: 10px 0 20px;"></div></td></tr>');$('.prior-page').hide()}},isSelPageNum:false })},noDataTrStr:function(trNum){var noDataStr='<tr style="border:0px;background-color:#fff !important;"><td  colspan="'+trNum+'" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';return noDataStr},showAlert:function(){$(".yt-edit-alert,#heard-nav-bak").show();proCostUsageQuery.popTablePage();$yt_alert_Model.getDivPosition($(".yt-edit-alert"));$('.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();$(".yt-edit-alert .pop-text").val("")})}};$(function(){proCostUsageQuery.init()});