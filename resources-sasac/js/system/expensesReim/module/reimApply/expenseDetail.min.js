(function($,window){var serveExamine={appId:'',costType:'',processInstanceId:'',init:function(){var ts=this;serveExamine.appId=$yt_common.GetQueryString('appId');ts.getReimAppInfoDetailByReimAppId();ts.getDictInfoByTypeCode();ts.start();ts.events()},start:function(){$('select').niceSelect()},events:function(){var me=this;if($("#costTypeName").text()!="差旅费"){$("#budgetPprojectDetailsTd").hide()}else if($("#specialName").text().split("-")[0]=="基本支出"){$("#budgetPprojectDetailsTd").hide()}else{$("#budgetPprojectDetailsTd").show()}if($("#costTypeName").text()=="培训费"){$("#budgetPprojectDetailsTd").hide();$("#budgetPprojectDetailsTd").prev("td").show();$("#budgetPprojectDetailsTd").prev("td").find("label").text("预算项目：");$(".advance-relevance label").text("预算项目可用余额：")}$("#closeBtn").click(function(){if(window.top==window.self){window.close()}else{parent.closeWindow()}});$('#advanceAppNum').click(function(){var SQ="SQ";if($("#costTypeName").text()=="培训费"){var pageUrl="view/projectManagement-sasac/expensesReim/module/beforehand/beforeApplyDetail.html?advanceId="+$("#advanceAppNumHiddenInput").val()+'&SQ=SQ'}else{var pageUrl="view/system-sasac/expensesReim/module/beforehand/beforeApplyDetail.html?advanceId="+$("#advanceAppNumHiddenInput").val()+'&SQ=SQ'}$yt_baseElement.openNewPage(2,pageUrl)});$('.budget-project').click(function(){var pageUrl="view/projectManagement-sasac/expensesReim/module/beforehand/beforeApplyDetail.html?advanceId="+$("#hiddenBudgetProject").val();$yt_baseElement.openNewPage(2,pageUrl)});$('.file-box').on('click','.del-file',function(){var ithis=$(this);var parent=ithis.parent();$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){parent.remove()}})});$('.money-input').on('focus',function(){var ts=$(this);if(ts.val()!=""){ts.val($yt_baseElement.rmoney(ts.val()))}});$('.money-input').on('blur',function(){var ts=$(this);if(ts.val()!=''){ts.val($yt_baseElement.fmMoney(ts.val()))}});$('.money-input').on('keyup',function(){var ts=$(this);if(ts.val()!=''){ts.val(ts.val().replace(/[^\d.]/g,''))}});$(".bottom-btn button.print-btn").on("click",function(){var pageUrl="";var goPageUrl="view/system-sasac/expensesReim/module/approval/expenApplApprList.html";if($(this).val()=="printBills"){pageUrl="view/system-sasac/expensesReim/module/print/InvoicePasting.html?appId="+serveExamine.appId}if($(this).val()=="printExpend"){pageUrl="view/system-sasac/expensesReim/module/print/expenditureVoucher.html?expenditureAppId="+serveExamine.appId}if($(this).val()=="printExpendDetail"){pageUrl='view/system-sasac/expensesReim/module/print/expenditureVoucherDetailed.html?expenditureAppId='+serveExamine.appId+"&costType="+serveExamine.costType}$yt_baseElement.openNewPage(2,pageUrl)});$("#expenseEdit").on("click",function(){var systemId=$yt_common.GetQueryString("systemId");var menuId=$yt_common.GetQueryString("menuId");var pageUrl=$yt_option.websit_path+'view/system-sasac/expensesReim/module/reimApply/expenseAccount.html?appId='+serveExamine.appId+"&systemId="+systemId+"&menuId="+menuId;window.location.href=pageUrl});$('.amount-table .money-input').blur(function(){var body=$('.amount-table');var official=Number($yt_baseElement.rmoney(body.find('.official').val()||'0'));var cash=Number($yt_baseElement.rmoney(body.find('.cash').val()||'0'));var cheque=Number($yt_baseElement.rmoney(body.find('.cheque').val()||'0'));var transfer=Number($yt_baseElement.rmoney(body.find('.transfer').val()||'0'));var total= +official+cash+cheque+transfer;body.find('.total').text($yt_baseElement.fmMoney(total))});$('#submitPayment').on('click',function(){if($yt_valid.validForm($('.approve-div'))){var d=me.getSubData();var costData=me.saveData.costData;d.costData=typeof(costData)=='string'?costData:JSON.stringify(costData);me.submitReimAppInfo(d)}});me.tallyListEvent();$('.yt-table tbody').on('click','tr',function(){var ts=$(this);var trs=ts.siblings();trs.removeClass('yt-table-active');ts.addClass('yt-table-active')});$('table.payee-personal').on('click','.to-data',function(){var tr=$(this).parents('tr');$('#perPayeeName').text(tr.attr('payeename')||'--');$('#perPersonalTotal').text($yt_baseElement.fmMoney(tr.attr('personalTotal'))||'0.00');var choiceLoan=tr.attr('choiceLoan');if(choiceLoan&&choiceLoan!='请选择'){$('.personal-payment .display-loan').show();$('#perChoiceLoan').text(tr.attr('choiceLoan')||'--');$('.per-arrears-money').text(tr.attr('arrearsmoney')||'0.00');$('.per-reverse-money').text(tr.attr('thereversemoney')||'0.00')}else{$('.personal-payment .display-loan').hide();$('#perChoiceLoan').text('');$('.per-arrears-money').text('0.00');$('.per-reverse-money').text('0.00')}$('#perWiteOffPersonal').text(tr.find('td').eq(2).text()||'无');if(tr.attr('witeOffPersonal')){$('.personal-payment .display-loan').show()}else{$('.personal-payment .display-loan').hide()}$('.per-writeoff-money').text($yt_baseElement.fmMoney(tr.attr('personalWriteoff'))||'0.00');$('#perCash').text($yt_baseElement.fmMoney(tr.attr('cash'))||'0.00');$('#perOfficialCard').text($yt_baseElement.fmMoney(tr.attr('officialCard'))||'0.00');$('#perTransferAccounts').text($yt_baseElement.fmMoney(tr.attr('transferAccounts'))||'0.00');$('#perIdCarkno').text(tr.attr('idCarkno')||'--');$('#perPayeeBank').text(tr.attr('payeeBank')||'--');$('#perBankName').text(tr.attr('bankName')||'--');$('#perPhoneNum').text(tr.attr('phoneNum')||'--');$('#perPerank').text(tr.attr('personalUnit')||'--');$('#perOffOpenBank').text(tr.attr('offOpenBank')||'--');$('#perOffAccounts').text(tr.attr('offAccounts')||'--');var payeeRadio=tr.attr('payeeRadio');$('#payeeRadio').text(payeeRadio==1?'有':'无');$('#perSpecial').text(tr.attr('personalSpecial')||'');$('#personalPayment').show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#personalPayment'));$('#pop-modle-alert').show();$('#personalPayment').show()});$('#personalPayment .model-bottom-btn .yt-cancel-btn,#personalPayment .closed-span').on('click',function(){var tr=$(this).parents('tr');$yt_baseElement.hideMongoliaLayer();$('#pop-modle-alert').hide();$('#personalPayment').hide();$('#perPayeeName').text('--');$('#perPersonalTotal').text('0.00');var choiceLoan=tr.attr('choiceLoan');if(choiceLoan){$('.personal-payment .display-loan').show();$('#perChoiceLoan').text('--');$('.per-arrears-money').text('0.00');$('.per-reverse-money').text('0.00')}else{$('.personal-payment .display-loan').hide();$('#perChoiceLoan').text('--');$('.per-arrears-money').text('0.00');$('.per-arrears-money').text('0.00')}$('#perWiteOffPersonal').text('--');$('.per-writeoff-money').text('0.00');$('#perCash').text('0.00');$('#perOfficialCard').text('0.00');$('#perTransferAccounts').text('0.00');$('#perIdCarkno').text('--');$('#perPayeeBank').text('--');$('#perBankName').text('--');$('#perPhoneNum').text('--');$('#perPerank').text('--');$('#payeeRadio').text('--');$('#perSpecial').text('')});$('.payee-unit,.payee-other,.payee-personal').on('click','.to-detail',function(){var loanAppId=$(this).parents('tr').attr('loanAppId');var pageUrl="view/system-sasac/expensesReim/module/loanApply/loanApplyDetail.html?loanId="+loanAppId;$yt_baseElement.openNewPage(2,pageUrl)})},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},rmoney:function(str){return $yt_baseElement.rmoney(str||'0')},paymentListEvent:function(){var me=this;$('#addProcuList').on('click',function(){me.showPaymentAlert()});$("#paymentAddBtn").on('click',function(){var budgetProject=$('#budgetProject option:selected').text();var budgetMoney=$('#budgetMoney').val();var specialNum=$('#specialNum').text();var html='<tr> <td>'+budgetProject+'</td> <td style="text-align: right;">'+budgetMoney+'</td> <td>'+specialNum+'</td> <td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td> </tr>';$('#paymentList tbody').append(html);me.hidePaymentAlert()});$('#paymentList').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})});$('#paymentList').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');me.showPaymentAlert()});$('#paymentCanelBtn').on('click',function(){me.hidePaymentAlert()})},showPaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hidePaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.hideMongoliaLayer();alert.hide();$('#pop-modle-alert').hide()},serveExamineEvent:function(){$('.prior-approval').click(function(){$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('.prior-alert'));$('#pop-modle-alert').show();$('.prior-alert').show()});$('.prior-common').click(function(){var code=$('.prior-approval-list .yt-table-active').attr('code');if(code){$('.prior-approval').val(code);$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()}else{$yt_alert_Model.prompt('请选择一条数据')}});$('.prior-cancel').click(function(){$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()})},tallyListEvent:function(){var me=this;$('.add-tally').click(function(){me.showMsgAlert();$('.tally-common').off().on('click',function(){me.appendMsgList()}).text('添加到列表')});$('.tally-cancel').click(function(){me.hideMsgAlert();me.clearAlert($('.msg-alert'))});$('.tally-list').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})});$('.tally-list').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var loanType=$('#loanType option[value="'+tr.attr('loanCode')+'"]').attr('selected',true);var abstract=$('#abstract').val(tr.attr('abstract'));var totalSubject=$('#totalSubject').val(tr.attr('totalSubject'));var detailSubject=$('#detailSubject').val(tr.attr('detailSubject'));var tallyMoney=$('#tallyMoney').val(tr.attr('tallyMoney'));$('#loanType').niceSelect();me.showMsgAlert();$('.tally-common').off().on('click',function(){me.appendMsgList(tr)}).text('确定')})},appendMsgList:function(tr){var me=this;if($yt_valid.validForm($('.tally-alert'))){var loanType=$('#loanType option:selected').text();var loanCode=$('#loanType option:selected').val();var abstract=$('#abstract').val();var totalSubject=$('#totalSubject').val();var detailSubject=$('#detailSubject').val();var tallyMoney=$('#tallyMoney').val();var totalText='';var detailText='';if(loanType=='DEBIT_ENTRY'){totalText=tallyMoney}else{detailText=tallyMoney}var html='<tr pid="" class="" loanCode="'+loanCode+'" loanType="'+loanType+'" abstract="'+abstract+'" totalSubject="'+totalSubject+'" detailSubject="'+detailSubject+'" tallyMoney="'+tallyMoney+'"><td>'+abstract+'</td><td>'+totalSubject+'</td><td>'+detailSubject+'</td><td>'+totalText+'</td><td>'+detailText+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(html)}else{$('.tally-list').append(html)}me.hideMsgAlert();me.clearAlert($('.tally-alert'))}else{}},showMsgAlert:function(){var alert=$('.tally-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideMsgAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.tally-alert').hide();$('#pop-modle-alert').hide()},clearAlert:function(obj){var selects=obj.find('select');$.each(selects,function(i,n){$(n).find('option:first-child').attr('selected',true)});selects.niceSelect();var inputs=obj.find('input');inputs.val('')},getReimAppInfoDetailByReimAppId:function(){var me=this;$.ajax({type:"post",url:"sz/expenditureApp/getExpenditureAppInfoByAppId",async:false,data:{expenditureAppId:serveExamine.appId},success:function(data){var d=data.data;$("#hiddenBudgetProject").val(d.budgetAppId);serveExamine.processInstanceId=d.processInstanceId;serveExamine.costType=d.costType;me.saveData=d;if(d.jsFun){me[d.jsFun]()}$("#advanceAppNumHiddenInput").val(d.advanceAppId);me.showDetail(d);if(d.costType=='SPECIAL_DEDUCTION'){$("#expenseEdit").hide();$("#closeBtn").show()}else{if(sysCommon.processState[0].operationState=='待申请人再次提交'||sysCommon.processState[0].operationState.indexOf('退回到申请人')>0){$("#expenseEdit").show();$("#closeBtn").hide();$("#printExpend,#printExpendDetail").remove()}}if(d.costType=='TRAIN_APPLY'){$("#predictCostDiv").hide();$("#payTaxesDiv").show()}if(d.costType=='ACCRUED_TAX'||d.costType=='SPECIAL_DEDUCTION'){$('.pay-detail,.print-div').hide()}else{if(d.workFlowState=='已完结'||d.workFlowState=='已完成'){serveExamine.setPayDetailList(d.payDetailList);$('.pay-detail,.print-div').show()}else{$('.pay-detail,.print-div').hide()}}$('#approve-users').attr("validform","{isNull:false,msg:'请选择审批人'}");$('.check-label').off('click');$('.check-label input').attr('disabled',true).off('click');if($("#costTypeName").text()=="培训费"){$("#budgetPprojectDetailsTd").show();$("#budgetPprojectDetailsTd").prev("td").hide()}if(data.data.validateType=="UNIT"){$("#deptBudgetBalanceAmount").hide();$("#deptBudgetBalanceAmount").prev().hide();$("#deptBudgetBalanceAmount").next().hide()}if(data.data.validateType=="DEPT"){$("#budgetBalanceAmount").hide();$("#budgetBalanceAmount").prev().hide()}}})},getCostAppInfoDetailByParams:function(appId,costType){var me=this;$.ajax({type:"post",url:"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{appId:appId,costType:costType},success:function(data){if(data){me.showCostDetail(data.data)}else{$yt_alert_Model.prompt(data.message)}}})},getReimPreviewDetailByReimAppId:function(reimAppId,previewFalg,qrCodeContext){var me=this;$.ajax({type:"post",url:"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{reimAppId:reimAppId,previewFalg:previewFalg,qrCodeContext:qrCodeContext},success:function(data){}})},getSubData:function(){var getFileList=function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length?',':'')});return str};var costReceptionistList=function(){var list=[];var trs=$('.msg-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costReceptionistId:tr.attr('pkId'),name:tr.find('.name-text').text(),jobName:tr.find('.job-text').text(),unitName:tr.find('.unit-text').text(),})});return list};var costDetailsList=function(){var list=[];var trs=$('#paymentList tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costDetailsId:tr.attr('pkId'),publicServiceProCode:tr.attr('budgetcode'),activityDate:tr.find('.act-date').text(),placeName:tr.find('.place-name').text(),costType:tr.attr('costcode'),standardAmount:tr.find('.stan-money').attr('money'),activityAmount:tr.find('.money').attr('money'),peopleNum:tr.find('.people-num').text(),setMethod:''})});return list};var tripPlanList=function(){var list=[];var trs=$('#tripList tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelType:tr.attr('busicode'),travelAddress:tr.find('.address').attr('val'),travelAddressName:tr.find('.address').text(),startTime:tr.find('.sdate').text(),endTime:tr.find('.edate').text(),travelPersonnels:tr.attr('usercode'),receptionCostItem:tr.attr('rececode'),setMethod:''})});return list};var carfareList=function(){var costCarfareList=[];var costCarfareJson="";var cityDatas;if($("#traffic-list-info tbody tr:not(.total-last-tr)").length>0){$("#traffic-list-info tbody tr:not(.total-last-tr)").each(function(i,n){cityDatas=$(this).getDatas();cityDatas.crafare=$yt_baseElement.rmoney(cityDatas.crafare);cityDatas.setMethod='';if($(this).find(".hid-child-code").val()=="null"||$(this).find(".hid-child-code").val()==""){cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."}else{cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."+$(this).find(".hid-child-code").val()+"."}costCarfareList.push(cityDatas)})}return costCarfareList};var hotelList=function(){var costHotelList=[];var costHotelJson="";var hotelDatas;if($("#hotel-list-info tbody tr:not(.total-last-tr)").length>0){$("#hotel-list-info tbody tr:not(.total-last-tr)").each(function(i,n){hotelDatas=$(this).getDatas();hotelDatas.hotelExpense=$yt_baseElement.rmoney(hotelDatas.hotelExpense);hotelDatas.setMethod='';costHotelList.push(hotelDatas)});if(costHotelList.length>0){costHotelJson=JSON.stringify(costHotelList)}}return costHotelList};var otherList=function(){var costOtherList=[];var costOtherJson="";var otherDatas;if($("#other-list-info tbody tr:not(.total-last-tr)").length>0){$("#other-list-info tbody tr:not(.total-last-tr)").each(function(i,n){otherDatas=$(this).getDatas();otherDatas.reimAmount=$yt_baseElement.rmoney(otherDatas.reimAmount);otherDatas.setMethod='';costOtherList.push(otherDatas)});if(costOtherList.length>0){costOtherJson=JSON.stringify(costOtherList)}}return costOtherList};var costSubsidyList=function(){var list=[];var trs=$('#subsidy-list-info tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelPersonnel:tr.find('.user').attr('code'),subsidyDays:tr.find('.subsidy-num').text(),subsidyFoodAmount:tr.find('.food').attr('num'),carfare:tr.find('.traffic').attr('num'),setMethod:''})});return list};var costData=function(){return JSON.stringify({costReceptionistList:costReceptionistList(),costDetailsList:costDetailsList(),travelRouteList:tripPlanList(),costCarfareList:carfareList(),costHotelList:hotelList(),costOtherList:otherList(),costSubsidyList:costSubsidyList()})};var billingVoucherJson=function(){var list=[];var trs=$('#tally-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({billingVoucherId:tr.attr('pid'),toLoanType:tr.attr('loancode'),abstracts:tr.attr('abstract'),ledger:tr.attr('totalsubject'),detailed:tr.attr('detailsubject'),amount:tr.attr('tallymoney')})});return JSON.stringify(list)};return{advanceAppId:$('#advanceAppId').val(),loanAppId:$('#loanAppId').val(),reimAppId:$('#reimAppId').val(),reimAppNum:$('#reimAppNum').val(),reimAppName:$('#reimAppName').attr('val'),costType:$('#costTypeName').attr('val'),isSpecial:$('#isSpecial').attr('val'),specialCode:$('#specialName').attr('val'),invoiceNum:$('#invoiceNum').text(),totalAmount:$('#totalAmount').attr('num'),writeOffAmount:$('#writeOffAmount').attr('num'),officialCard:$('#officialCard').attr('num'),cash:$('#cash').attr('num'),cheque:$('#cheque').attr('num'),transfer:0,attIdStr:getFileList(),paymentDate:$('#paymentDate').val(),paymentAmount:$('#paymentAmount').val(),cmTotalAmount:$('#cmTotalAmount').attr('num'),cmWriteOffAmount:$('#cmWriteOffAmount').attr('num'),cmOfficialCard:$('#cmOfficialCard').val(),cmCash:$('#cmCash').val(),cmCheque:$('#cmCheque').val(),cmTransfer:0,applicantUser:$('#applicantUser').val(),parameters:'',dealingWithPeople:$('#approve-users option:selected').val(),opintion:$('#opintion').val(),processInstanceId:$('#processInstanceId').val(),nextCode:$('#operate-flow option:selected').val(),costData:[],billingVoucherJson:billingVoucherJson(),}},showDetail:function(d){var me=this;var fMoney=$yt_baseElement.fmMoney;$(".ordinary-div").setDatas(d);$('#busiUsers').text(d.applicantUserName);$('#deptName').text(d.applicantUserDeptName);$('#jobName').text(d.applicantUserPositionName==""?"--":d.applicantUserPositionName);$("#telPhone").text(d.applicantUserPhone==""?"--":d.applicantUserPhone);$("#expenditureAppName").text(d.expenditureAppName);$('#advanceAppId').val(d.advanceAppId);var outWriteAmount=d.totalAmount<=d.arrearsAmount?d.totalAmount:d.arrearsAmount;$('#outWriteAmount').text(fMoney(outWriteAmount||'0'));$('#reimAppId').val(d.reimAppId);$('#advanceAppNum').text((d.advanceAppNum==''?'--':d.advanceAppNum));if(d.advanceAppNum){$('.advance-relevance').show();$('#advanceAppBalance').text(d.advanceAppBalance?(fMoney(d.advanceAppBalance)+'元'):'0.00');$('.advance-relevance').append('<span>（不包含冻结金额'+d.frozenMount+'元）</span>')}var specialValArr=d.specialCode.split('-');if(specialValArr[0]=='395'){$('.prj-name-tr').show();$('#prjName').text(d.prjName);}else{$('.prj-name-tr').hide();}if(specialValArr[0]=='402'){$(".budgetBalanceAmount").hide();$(".deptBudgetBalanceAmount").hide()}else{$(".budgetBalanceAmount").show();$(".deptBudgetBalanceAmount").show()}$('#reimAppNum').val(d.reimAppNum);$('#formNum').text(d.expenditureAppNum).attr('val',d.expenditureAppNum);$('#reimAppName').text(d.reimAppName).attr('val',d.advanceAppReason);$('#costTypeName').text(d.costTypeName).attr('val',d.costType);if(d.costType=='TRAIN_APPLY'){$('#doAdvanceBox').show();$('#predictCostDetailDiv').hide()}$('#specialName').text((d.specialName==''?'--':d.specialName)).attr('val',d.specialCode);$('#budgetBalanceAmount').text(d.budgetBalanceAmount?fMoney(d.budgetBalanceAmount)+'万元':'--');$('#deptBudgetBalanceAmount').text(d.deptBudgetBalanceAmount?fMoney(d.deptBudgetBalanceAmount)+'万元':'--');$('#invoiceNum').text(d.invoiceNum||'0');$('#totalAmount').text(fMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$("#deductBudgetTotalMoney").text(fMoney(d.deductBudgetAmount||'0')).attr('num',d.deductBudgetAmount);$('#amountTotalMoney').text(fMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$('#paymentList .total-money').text(fMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$('#totalMoneyUpper').text(arabiaToChinese(d.totalAmount+''||'0'));$('#writeOffAmount,#outWriteAmount').text(fMoney(d.writeOffAmount||'0')).attr('num',d.writeOffAmount);$('#balanceMoney').text(fMoney(d.totalAmount<d.loanAppBalance?d.loanAppBalance-d.totalAmount:'0'));$('#officialCard').text(fMoney(d.officialCard||'0')).attr('num',d.officialCard);$('#cash').text(fMoney(d.cash||'0')).attr('num',d.cash);$('#cheque').text(fMoney(d.cheque||'0')).attr('num',d.cheque);var body=$('#applyTable tbody');var total= +d.officialCard+ +d.cash+ +d.cheque+0;var rtotal=fMoney(total||'0');body.find('.total').text(rtotal).attr('num',total);$('#replaceMoney,#cmReplaceMoney').text(fMoney(total));$('#paymentDate').text(d.paymentDate);$('#paymentAmount').text(fMoney(d.paymentAmount||'0'));var cmTotalAmount=d.cmTotalAmount?d.cmTotalAmount:d.totalAmount;$('#cmTotalAmount').text(fMoney(cmTotalAmount||'0')).attr('num',cmTotalAmount);var cmWriteOffAmount= +cmTotalAmount- +d.cmWriteOffAmount;cmWriteOffAmount=cmWriteOffAmount>0?cmWriteOffAmount:'';$('#cmWriteOffAmount').text(fMoney(d.cmWriteOffAmount||'0')).attr('num',d.cmWriteOffAmount);$('#cmOfficialCard').text(fMoney(d.cmOfficialCard||'0'));$('#cmCash').text(fMoney(d.cmCash||'0'));$('#cmCheque').text(fMoney(d.cmCheque||'0'));$('#applicantUser').val(d.applicantUser);$('#applicantTime').text(d.applicantTime);$('#operate-flow option[value="'+d.nodeNowState+'"]').attr('selected',true);$('#processInstanceId').val(serveExamine.processInstanceId);var flowLogHtml=sysCommon.getCommentByProcessInstanceId(serveExamine.processInstanceId);$(".flow-log-div").html(flowLogHtml);$('#approve-users option[value="'+d.currentAssignee+'"]').attr('selected',true);$('#operate-flow,#approve-users').niceSelect();me.showFileList(d.attList);me.showAdvanceFileList(d.advanceAppAttList);me.showCostDetail(d.costData);},showCostDetail:function(data){var me=this;var fMoney=$yt_baseElement.fmMoney;var costReceptionistList=data.costReceptionistList;var costDetailsList=data.costDetailsList;var receHtml='';$.each(costReceptionistList,function(i,n){receHtml+='<tr pkId="'+n.costReceptionistId+'" class="" nameVal="'+n.name+'" dutyVal="'+n.jobName+'" deptVal="'+n.unitName+'"><td><span class="num">1</span></td><td><span class="name-text">'+n.name+'</span></td><td><span class="job-text">'+n.jobName+'</span></td><td><span class="unit-text">'+n.unitName+'</span></td></tr>'});$('.msg-list tbody').append(receHtml);me.resetNum($('.msg-list'));var detaHtml='';var costDetaClose=$('#paymentList').next().find('.check-label input');var thisTotal=0;$.each(costDetailsList,function(i,n){detaHtml+='<tr pkId="'+n.costDetailsId+'" budgetCode="'+n.publicServiceProCode+'" costCode="'+n.costType+'" budgetProject="'+n.publicServiceProName+'" applyDate="'+n.activityDate+'" siteVal="'+n.placeName+'" costBreakdown="'+n.costTypeName+'" standardMoney="'+n.standardAmount+'" budgetMoney="'+n.activityAmount+'" accompanyNum="'+n.peopleNum+'"><td><span class="">'+n.publicServiceProName+'</span></td><td><span class="act-date">'+n.activityDate+'</span></td><td><span class="place-name">'+n.placeName+'</span></td><td>'+n.costTypeName+'</td>'+'<td style="text-align: right;"><div class="money" money='+n.activityAmount+'>'+fMoney(n.activityAmount||'0')+'</div></td><td><span class="people-num">'+n.peopleNum+'</span></td></tr>';thisTotal+= +n.activityAmount;if(costDetaClose.length>0&&n.setMethod){costDetaClose.setCheckBoxState('check')}});detaHtml+='<tr><td>合计</td><td></td><td></td><td></td><td style="text-align: right;" class="total-money">'+$yt_baseElement.fmMoney(thisTotal)+'</td><td></td></tr>';$('#paymentList .yt-tbody').html(detaHtml);var tripPlanList=data.travelRouteList;var tripHtml='';var travelPersonnelsList=[];var getUserNames=function(list){var str='';$.each(list,function(i,n){str+=n.travelPersonnelName+(i<list.length-1?'、':'')});return str};var costItem=function(str){switch(str){case '1':return '住宿费';break;case '2':return '伙食费';break;case '3':return '市内交通费';break;default:return '';break}};var getCostItemName=function(str){var txt='';if(str){var list=str.split(',');$.each(list,function(i,n){if(n){txt+=costItem(n)+(i<list.length-1?'、':'')}});return txt}return '--'};$.each(tripPlanList,function(i,n){var dateFrom=new Date(n.startTime);var dateTo=new Date(n.endTime);var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24));tripHtml+='<tr busicode="'+n.travelType+'" usercode="'+n.travelPersonnels+'" rececode="'+n.receptionCostItem+'" ><td><input type="hidden" class="hid-user-code" value="'+n.travelPersonnels+'" /> <span class="name">'+n.travelTypeName+'</span></td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="day">'+diff_day+'</td><td class="address" val="'+n.travelAddress+'">'+n.travelAddressName+'</td><td class="uname">'+getUserNames(n.travelPersonnelsList)+'</td><td class="numof">'+n.travelPersonnelsList.length+'</td><td class="reception">'+getCostItemName(n.receptionCostItem)+'</td></tr>'});$('#tripList tbody').html(tripHtml);var costCarfareList=data.costCarfareList;var carHtml='';var costCarfareClose=$('#traffic-list-info').next().find('.check-label input');$.each(costCarfareList,function(i,n){carHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+n.travelPersonnel+'"/></td><td>'+n.travelPersonnelsDept+'</td><td data-text="goTime">'+n.goTime+'</td><td><input data-val="goAddress" type="hidden" value="'+n.goAddress+'"><span data-text="goAddressName">'+n.goAddressName+'</span></td><td data-text="arrivalTime">'+n.arrivalTime+'</td><td><input data-val="arrivalAddress" type="hidden" value="'+n.arrivalAddress+'"> <span data-text="arrivalAddressName">'+n.arrivalAddressName+'</span></td><td><span data-text="vehicle">'+n.vehicleName+'</span><input type="hidden" class="hid-vehicle" value="'+n.vehicle+'"/><input type="hidden" class="hid-child-code" value=""/></td><td class="font-right money-td" data-text="crafare">'+(n.crafare==""?"--":fMoney(n.crafare||'0'))+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks||"")+'</td><td style="display:none;"><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costCarfareClose.length>0&&n.setMethod){costCarfareClose.setCheckBoxState('check')}});carHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td></tr>';$('#traffic-list-info tbody').html(carHtml);sysCommon.updateMoneySum(0);var costHotelList=data.costHotelList;var hotelHtml='';var costHotelClose=$('#hotel-list-info').next().find('.check-label input');$.each(costHotelList,function(i,n){var avg=n.hotelDays>0?fMoney((+n.hotelExpense/ +n.hotelDays)||'0'):n.hotelExpense;hotelHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" value="'+n.travelpersonnel+'"/></td><td>'+n.travelPersonnelsJobLevelName+'</td>'+'<td class="font-right">'+avg+'</td><td risk-code-val="hotelCheckInDate" class="check-in-date"><span class="sdate">'+n.hotelTime+'</span></td><td class="leave-date"><span class="edate">'+n.leaveTime+'</span></td><td data-text="hotelDays">'+n.hotelDays+'</td><td class="font-right money-td" data-text="hotelExpense">'+fMoney(n.hotelExpense||'0')+'</td><td><span data-text="hotelAddressName">'+n.hotelAddressName+'</span><input type="hidden" data-val="hotelAddress" value="'+n.hotelAddress+'"</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks||"")+'</td><td style="display:none;"><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costHotelClose.length>0&&n.setMethod){costHotelClose.setCheckBoxState('check')}});hotelHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$('#hotel-list-info tbody').html(hotelHtml);sysCommon.updateMoneySum(1);var costOtherList=data.costOtherList;var otherHtml='';var costOtherClose=$('#other-list-info').next().find('.check-label input');$.each(costOtherList,function(i,n){otherHtml+='<tr><td><span>'+n.costType+'</span><input type="hidden" data-val="costType" value="'+n.costType+'"/></td><td class="font-right money-td" data-text="reimAmount">'+fMoney(n.reimAmount||'0')+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks||"")+'</td></tr>';if(costOtherClose.length>0&&n.setMethod){costOtherClose.setCheckBoxState('check')}});otherHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td class="font-right"><span class="tab-font-blod money-sum"></span></td><td></td></tr>';$('#other-list-info tbody').html(otherHtml);sysCommon.updateMoneySum(2);var costSubsidyList=data.costSubsidyList;var subHtml='';var totalFood=0;var totalTraffic=0;$.each(costSubsidyList,function(i,n){subHtml+='<tr class="'+n.travelPersonnel+'" code="'+n.travelPersonnel+'"><td><div class="user" code="'+n.travelPersonnel+'">'+n.travelPersonnelName+'</div></td><td><div class="lv">'+n.travelPersonnelsDept+'</div></td><td><div class="subsidy-num">'+n.subsidyDays+'</div></td><td><div style="text-align:right;" class="food">'+fMoney(n.subsidyFoodAmount||'0')+'</div></td><td><div  style="text-align:right;" class="traffic">'+fMoney(n.carfare||'0')+'</div></td></tr>';totalFood+= +n.subsidyFoodAmount;totalTraffic+= +n.carfare});subHtml+='<tr class="last"><td>合计</td><td></td><td></td><td class="total-food"  style="text-align:right;">'+fMoney(totalFood||'0')+'</td><td class="total-traffic"  style="text-align:right;">'+fMoney(totalTraffic||'0')+'</td></tr>';$('#subsidy-list-info tbody').html(subHtml);var meetingList=data.meetingList;$.each(meetingList,function(i,n){$("#meetTypeName").text(n.meetTypeName);$("#meetName").text(n.meetName);$("#meetAddress").text(n.meetAddress);$("#meetStartTime").text(n.meetStartTime);$("#meetEndTime").text(n.meetEndTime);$("#meetDays").text(n.meetDays);$("#meetOfNum").text(n.meetOfNum);$("#meetWorkerNum").text(n.meetWorkerNum)});var meetingCostList=data.meetingCostList;$.each(meetingCostList,function(i,n){$("#meetHotel").text($yt_baseElement.fmMoney((n.meetHotel||0)));$("#meetFood").text($yt_baseElement.fmMoney((n.meetFood||0)));$("#meetOther").text($yt_baseElement.fmMoney((n.meetOther||0)));$("#meetAmount").text($yt_baseElement.fmMoney((n.meetAmount||0)));$("#meetAverage").text($yt_baseElement.fmMoney((n.meetAverage||0)))});var payReceivablesData=me.saveData.payReceivablesData;var gatheringUnitList=payReceivablesData.gatheringUnitList;var otherPayeeHtml="";var otherPayeeTotale=0;$.each(gatheringUnitList,function(i,n){otherPayeeHtml+='<tr loanAppId="'+n.loanAppId+'"><td>'+n.unitName+'</td><td style="text-align:right;">'+$yt_baseElement.fmMoney(n.amount)+'</td>'+'<td >'+n.openBank+'</td><td >'+n.accounts+'</td><td >'+(n.isContract==1?'是':'否')+'</td><td >'+(n.isSettlement==1?'汇款':'支票')+'</td><td style="text-align:right;">'+(n.paidAmount==''?"0.00":$yt_baseElement.fmMoney(n.paidAmount))+'</td><td >'+(n.remarks||"")+'</td></tr>';otherPayeeTotale+= +n.amount});$(".payee-unit .yt-tbody .payee-unit-total").before(otherPayeeHtml);$(".payee-unit .payee-unit-total .payee-unit-money").text($yt_baseElement.fmMoney(otherPayeeTotale));if(gatheringUnitList.length==0){$(".payee-unit-model").hide()}var gatheringPersonList=payReceivablesData.gatheringPersonList;var gatheringPersonHtml="";var gatheringPersonTotale=0;$.each(gatheringPersonList,function(i,n){gatheringPersonHtml+='<tr class="payee-personal-tr" loanAppId="'+n.loanAppId+'" pkid="" personalUnit="'+n.personalUnit+'" payeeval="'+n.personalCode+'" payeename="'+n.personalName+'" pedepartment="'+n.personalDept+'" perank="'+n.personalJobLevelName+'" personaltotal="'+n.amount+'" witeoffpersonal="'+n.reverseTheWay+'" personalwriteoff="'+n.replaceAmount+'" cash="'+n.cash+'" officialcard="'+n.officialCard+'" transferaccounts="'+n.transfer+'" payeeradio="'+n.isContract+'" personalspecial="'+n.remarks+'" idcarkno="'+n.idCard+'" payeebank="'+n.accounts+'" bankname="'+n.openBank+'" phonenum="'+n.phoneNum+'" choiceloan="'+n.loanAppNum+'" choiceloanval="'+n.loanAppId+'" arrearsmoney="'+n.loanAppArrearsAmount+'" thereversemoney="'+n.writeOffAmount+'" offOpenBank="'+n.offOpenBank+'" offAccounts="'+n.offAccounts+'"><td class="per" value="personal">'+n.personalName+'</td><td style="text-align: right;" class="personalTotal">'+serveExamine.fmMoney(n.amount)+'</td>'+'<td style="text-align: right;">'+(serveExamine.fmMoney(n.cash))+'</td><td style="text-align: right;">'+(serveExamine.fmMoney(n.officialCard))+'</td><td style="text-align: right;">'+(serveExamine.fmMoney(n.transfer))+'</td><td><a class="yt-link to-data">详情</a></td><td>'+(n.isContract==1?'有':'无')+'</td><td style="text-align:right;">'+(n.paidAmount==''?"0.00":$yt_baseElement.fmMoney(n.paidAmount))+'</td><td>'+(n.remarks||'')+'</td></tr>';gatheringPersonTotale+= +n.amount});$(".payee-personal .yt-tbody .payee-personal-total").before(gatheringPersonHtml);$(".payee-personal .payee-personal-total .payee-personal-money").text($yt_baseElement.fmMoney(gatheringPersonTotale));if(gatheringPersonList.length==0){$(".payee-personal-model").hide()}var gatheringOtherList=payReceivablesData.gatheringOtherList;var gatheringOtherHtml="";var gatheringOtherTotale=0;$.each(gatheringOtherList,function(i,n){gatheringOtherHtml+='<tr loanAppId="'+n.loanAppId+'"><td>'+n.otherName+'</td>'+'<td style="text-align:right;">'+$yt_baseElement.fmMoney(n.amount)+'</td>'+'<td >'+(n.isContract==1?'是':'否')+'</td>'+'<td style="text-align:right;">'+(n.paidAmount==''?"0.00":$yt_baseElement.fmMoney(n.paidAmount))+'</td>'+'<td>'+(n.remarks||"")+'</td>'+'</tr>';gatheringOtherTotale+= +n.amount});$(".payee-other .yt-tbody .payee-other-total").before(gatheringOtherHtml);$(".payee-other .payee-other-total .payee-other-total-money").text($yt_baseElement.fmMoney(gatheringOtherTotale));if(gatheringOtherList.length==0){$(".payee-other-model").hide()}if(gatheringOtherList.length==0&&gatheringPersonList.length==0&&gatheringUnitList.length==0){$(".payee-info-isshow").html('<table style="width:100%"><tr style="border:0px;background-color:#fff !important;"><td align="center"style="border:0px;"><div class="no-data" style="width: 280px;padding:0;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding:10px 0;"></div></td></tr></table>')}me.setTrainApplyInfoList(data.trainApplyInfoList);me.setTeacherClassExpenseDetails(data.expenseClassDetails);me.setTeacherTrainDetails(data.expenseDetails);me.setCostTrainApplyInfoList(data.costTrainApplyInfoList);if(data.costOtherList.length==0){$(".other-cost-model").hide()}},setTrainApplyInfoList:function(list){var html='';var me=this;$.each(list,function(i,n){me.initProjectSelect(n.projectCode,n.projectId);$('.from-table-detail').setDatas(n)});$('#trainingPopTable tbody').html(html)},setCostTrainApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr><td>'+n.trainTypeName+'</td><td class="moneyText">'+$yt_baseElement.fmMoney(n.standard)+'</td><td>'+n.trainOfNum+'</td><td class="moneyText">'+$yt_baseElement.fmMoney(n.averageMoney)+'</td><td>'+(n.remark||"")+'</td></tr>';total+= +n.averageMoney});html+='<tr class="last"><td>合计</td><td></td><td></td><td class="moneyText costTotal">'+$yt_baseElement.fmMoney(total)+'</td><td></td></tr>';$('#trainingFeeTable tbody').html(html);if(list.length==0){$('.train-money').hide();$('.train-money').parent().hide();$('#trainingFeeTable,.other-title-train').hide()}},showFileList:function(list){if(list.length>0){var ls='';var src='';$.each(list,function(i,n){var imgType=n.attName.split('.');if(imgType.length>1&&(imgType[1]=='png'||imgType[1]=='jpeg'||imgType[1]=='bmp'||imgType[1]=='jpg')){src=$yt_option.base_path+'fileUpDownload/download?pkId='+n.attId+'&isDownload=false';ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pv">预览<img src="'+src+'" ></label></div>'}else{ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pvno">预览</label></div>'}});$('#attIdStr').html(ls);$('#attIdStr .file-dw').on('click',function(){var id=$(this).parent().attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'});$('#attIdStr .file-pv img').showImg()}else{$("#attIdStr").html("暂无附件")}},showAdvanceFileList:function(list){var ls='';var src='';if(list&&list.length>0){$.each(list,function(i,n){var imgType=n.attName.split('.');if(imgType.length>1&&(imgType[1]=='png'||imgType[1]=='jpeg'||imgType[1]=='bmp'||imgType[1]=='jpg')){src=$yt_option.base_path+'fileUpDownload/download?pkId='+n.attId+'&isDownload=false';ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pv">预览<img src="'+src+'" ></label></div>'}else{ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pvno">预览</label></div>'}});$('#advanceIdStr').html(ls);$('#advanceIdStr .file-dw').on('click',function(){var id=$(this).parent().attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'});$('#advanceIdStr .file-pv img').showImg()}else{$('#advanceIdStr').html('暂无附件')}},showBillingVoucherList:function(list){var totalText='';var detailText='';var html='';$.each(function(i,n){if(n.toLoanType=='DEBIT_ENTRY'){totalText=n.amount}else{detailText=n.amount}html+='<tr pid="'+n.billingVoucherId+'" class="" loanCode="'+n.toLoanType+'" loanType="'+n.toLoanTypeName+'" abstract="'+n.abstracts+'" totalSubject="'+n.ledger+'" detailSubject="'+n.detailed+'" tallyMoney="'+n.amount+'"><td>'+n.abstracts+'</td><td>'+n.ledger+'</td><td>'+n.detailed+'</td><td>'+totalText+'</td><td>'+detailText+'</td></tr>'});$('.tally-list').append(html)},getDictInfoByTypeCode:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:true,data:{dictTypeCode:'TO_LOAN_TYPE'},success:function(data){var list=data.data||[];var optone='<option value="">请选择</option>';$.each(list,function(i,n){optone+='<option value="'+n.value+'">'+n.disvalue+'</option>'});$('#loanType').html(optone).niceSelect();}})},resetNum:function(obj){var trs=obj.find('tbody tr');$.each(trs,function(i,n){$(n).find('.num').text(i+1)})},submitReimAppInfo:function(subData){$.ajax({type:"post",url:"sz/reimApp/submitReimAppInfo",async:true,data:subData,success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){window.location.href=$yt_option.websit_path+'view/system-sasac/expensesReim/module/reimApply/reimApproveList.html'}}})},getTotleMoney:function(){var tds=$('#paymentList tbody .money');var total=0;$.each(tds,function(i,n){total+= +$(n).attr('money')});var fmTotal=$yt_baseElement.fmMoney(total||'0');$('#paymentList tbody .total-money').text(fmTotal);$('#applyTotalMoney').text(fmTotal).attr('num',total);$('#amountTotalMoney').text(fmTotal).attr('num',total);$('#TotalMoneyUpper').text(arabiaToChinese(fmTotal));var writeOffAmount= +($('#writeOffAmount').attr('num'));var num= +total-writeOffAmount;if(num>=0){$('#replaceMoney').text($yt_baseElement.fmMoney(num))}else{$('#balanceMoney').text($yt_baseElement.fmMoney(num))}},getSaveData:function(){var me=this;var data=me.saveData;data.paymentDate=$('#paymentDate').val();data.paymentAmount=$('#paymentAmount').val();data.cmTotalAmount=$('#cmTotalAmount').attr('num');data.cmWriteOffAmount=$('#cmWriteOffAmount').attr('num');data.cmOfficialCard=$yt_baseElement.rmoney($('#cmOfficialCard').val()||'0');data.cmCash=$yt_baseElement.rmoney($('#cmCash').val()||'0');data.cmCheque=$yt_baseElement.rmoney($('#cmCheque').val()||'0');data.costData=JSON.stringify(data.costData);data.nextCode=$('#operate-flow option:selected').val();data.dealingWithPeople=$('#approve-users option:selected').val();data.attIdStr=me.getFileList();return data},getFileList:function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length?',':'')});return str},showBusinessFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.index-main-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/hospitalitySpendingDetail.html');$(".rece-msg").hide()},showGeneralFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.index-main-div').show();$(".advance-file-div").hide();$("#advanceApplication").hide();$(".rece-msg").hide();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetailApproval.html')},showTravelFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.index-main-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/travelSpendingDetails.html');$(".rece-msg").hide()},showTrainFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.index-main-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/busiTripApply/trainApproval.html')},showMettingFun:function(){$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/beforehand/meetingCostApplyDetails.html');$(".rece-msg").hide()},showSheBaoFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$(".deductBudgetAmountTr").show();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},showYingJiaoFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},showYiLiaoFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},showGongHuiFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},showDangJianFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},showWithMoneyFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#payeeInformation").show();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},showKouChuFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();$("#payeeInformation").hide();$(".appr-flow-log").hide();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},clearexamine:function(){$("#clearBtn").off().on("click",function(){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/expensesReim/module/reimApply/reimApproveList.html'}})})},setPayDetailList:function(list){var html='';var total=0;$('.pay-detail-tabel tbody tr:not(.pay-detail-tabel-total)').remove();if(list&&list.length>0){$.each(list,function(i,n){var count=Number(n.cash)+Number(n.officialCard)+Number(n.transfer);html+='<tr class=""><td>'+n.receivablesName+'</td><td>'+n.paymentDate+'</td>'+'<td>'+serveExamine.fmMoney(n.cash)+'</td><td>'+serveExamine.fmMoney(n.officialCard)+'</td><td>'+serveExamine.fmMoney(n.transfer)+'</td><td class="row-total">'+(serveExamine.fmMoney(count))+'</td></tr>';total+= +count})}$('.pay-detail-tabel .pay-detail-tabel-total').before(html);$('.pay-detail-tabel .payee-other-total-money').text(serveExamine.fmMoney(total))},getPaymentAmountInfoList:function(appId){$.ajax({type:"post",url:"sz/payDetailBillingVoucher/getPaymentAmountInfoList",async:true,data:{appId:appId},success:function(data){if(data.flag==0){var d=data.data;$('#mustMoney').text(serveExamine.fmMoney(d.totalAmount));var paymentAmount=d.paymentAmount;$('#alreadyMoney').text(serveExamine.fmMoney(paymentAmount));var paymentBalanceAmount=d.paymentBalanceAmount;$('#notMoney').text(serveExamine.fmMoney(paymentBalanceAmount));var payDetailList=d.payDetailList||[];serveExamine.setPayDetailList(payDetailList)}}})},setTeacherClassExpenseDetails:function(list){var tBody=$('#expenseDetails tbody');tBody.find('tr:not(.end-tr)').remove();var tr='';$.each(list,function(i,n){var rowspan=n.courseDateJson.length;tr='<tr teacherId="'+n.teacherId+'" class="expenseTr"><td rowspan="'+rowspan+'"><a class="teacherName">'+n.teacherName+'</a></td><td>'+(n.courseDateJson.length>0?n.courseDateJson[0].courseDate:"")+'</td><td>'+(n.courseDateJson[0].courseName?n.courseDateJson[0].courseName:"")+'</td><td rowspan="'+rowspan+'" class="expenseMoney moneyText">'+$yt_baseElement.fmMoney(n.expenseMoney)+'</td><td rowspan="'+rowspan+'" class="surrenderPersonal moneyText">'+$yt_baseElement.fmMoney(n.surrenderPersonal)+'</td><td rowspan="'+rowspan+'" class="moneyText" style="height:28px"><span class="afterTax desc-text">'+$yt_baseElement.fmMoney(n.afterTax)+'</span></td></tr>';tr=$(tr).data('data',n);tBody.find('.end-tr').before(tr);$.each(n.courseDateJson,function(x,y){if(x!=0){tr='<tr teacherId="'+n.teacherId+'"><td>'+y.courseDate+'</td><td>'+(y.courseName?y.courseName:"")+'</td></tr>';tBody.find('.end-tr').before(tr)}})});serveExamine.sumExpenseDetails()},sumExpenseDetails:function(){var expenseMoney=0;var surrenderPersonal=0;var afterTax=0;$.each($('#expenseDetails tbody .expenseMoney'),function(i,n){expenseMoney+=$yt_baseElement.rmoney($(n).text())});$.each($('#expenseDetails tbody .surrenderPersonal'),function(i,n){surrenderPersonal+=$yt_baseElement.rmoney($(n).text())});$.each($('#expenseDetails tbody .afterTax'),function(i,n){afterTax+=$yt_baseElement.rmoney($(n).text())});$('#payTeacherAll').text($yt_baseElement.fmMoney(surrenderPersonal));$('#expenseDetails tbody .costTotal-before').text($yt_baseElement.fmMoney(expenseMoney));$('#expenseDetails tbody .costTotal').text($yt_baseElement.fmMoney(surrenderPersonal));$('#expenseDetails tbody .costTotal-after').text($yt_baseElement.fmMoney(afterTax))},setTeacherTrainDetails:function(list){var tBody=$('#carFeeTable tbody');tBody.find('tr:not(.end-tr)').remove();var tr='';$.each(list,function(i,n){n.costSum=Number(n.salesPrice)+Number(n.insurance)+Number(n.refundSigningFee);if(!n.bookingRecord){n.bookingRecord=[]}tr='<tr teacherId="'+n.teacherId+'" class="teachertravelTr"><td>'+n.teacherName+'</td><td>'+n.startEndTime.split('至')[0]+'</td><td>'+(n.startEndTime.split('至')[1]?n.startEndTime.split('至')[1]:"")+'</td><td>'+n.placeDeparture+'</td><td>'+n.bourn+'</td><td>'+n.flighttrainNumber+'</td><td class="moneyText" style="height:28px"><span class="salesPrice desc-text">'+$yt_baseElement.fmMoney(n.salesPrice)+'</span></td><td class="moneyText" style="height:28px"><span class="insurance desc-text">'+$yt_baseElement.fmMoney(n.insurance)+'</span></td><td class="moneyText" style="height:28px"><span class="refundSigningFee desc-text">'+$yt_baseElement.fmMoney(n.refundSigningFee)+'</span></td><td class="costSum moneyText">'+$yt_baseElement.fmMoney(n.costSum)+'</td><td class="teacherStatementDetailsId" teacherStatementDetailsId="'+n.bookingRecord.map(function(x){return x.teacherStatementDetailsId}).join(",")+'">'+n.bookingRecord.map(function(x){return x.teacherStatementDetails}).join("</br>")+'</td><td>'+(n.warehousePositionDetails?n.warehousePositionDetails:"")+'</td></tr>';tr=$(tr).data('data',n);tBody.find('.end-tr').before(tr)});serveExamine.sumTeacherTrainDetails()},sumTeacherTrainDetails:function(){var salesPrice=0;var insurance=0;var refundSigningFee=0;var costSum=0;$.each($('#carFeeTable tbody .salesPrice'),function(i,n){salesPrice+=$yt_baseElement.rmoney($(n).text())});$.each($('#carFeeTable tbody .insurance'),function(i,n){insurance+=$yt_baseElement.rmoney($(n).text())});$.each($('#carFeeTable tbody .refundSigningFee'),function(i,n){refundSigningFee+=$yt_baseElement.rmoney($(n).text())});$.each($('#carFeeTable tbody .costSum'),function(i,n){costSum+=$yt_baseElement.rmoney($(n).text())});$('#carFeeTable tbody .sumSalesPrice').text($yt_baseElement.fmMoney(salesPrice));$('#carFeeTable tbody .sumInsurance').text($yt_baseElement.fmMoney(insurance));$('#carFeeTable tbody .sumRefundSigningFee').text($yt_baseElement.fmMoney(refundSigningFee));$('#carFeeTable tbody .costTotal').text($yt_baseElement.fmMoney(costSum))},initProjectSelect:function(projectCode,projectId){if(projectCode){$.ajax({type:"post",url:"finance/budget/lookForProjectListBudget",async:false,data:{projectCode:projectCode,projectId:projectId},beforeSend:function(){},success:function(data){if(data.flag==0){var datas=data.data[0];datas.projectTypeName=$yt_baseElement.setProjectTypeName(datas.projectType);$('.from-table-detail').setDatas(datas)}},error:function(){$yt_alert_Model.prompt('网络异常')}})}}};$(function(){serveExamine.init();serveExamine.clearexamine()})})(jQuery,window);