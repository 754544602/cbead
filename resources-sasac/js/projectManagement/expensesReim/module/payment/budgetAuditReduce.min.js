var budgetAuditReduce={saveData:{},advanceAppId:'',applicantUserCode:'',inits:function(){budgetAuditReduce.advanceAppId=$yt_common.GetQueryString('advanceAppId');var costType=$yt_common.GetQueryString('costType');budgetAuditReduce.getExpenditureAppInfoByAppId(budgetAuditReduce.advanceAppId);budgetAuditReduce.getCostType(costType);$("#budgetAuditReduce").css("min-height",$(window).height()-16);budgetAuditReduce.events();budgetAuditReduce.countBudgetMoney();var indexHeight=$("#locationId").offset().top;$(window).scrollTop(indexHeight)},events:function(){$(".this-budget-table").on("keypress",".input-money",function(even){var event=event||window.event;var getValue=$(this).val();if(getValue.length==0&&event.which==46){alert(1);event.preventDefault();return}if(getValue.indexOf('.')!=-1&&event.which==46){event.preventDefault();return}if(event.which&&(event.which<48||event.which>57)&&event.which!=8&&event.which!=46){event.preventDefault();return}});$('.this-budget-table').on('blur','.budget-money',function(){var total=$yt_baseElement.rmoney($('#totalAmount').text()||'0');var money=$yt_baseElement.rmoney($(this).val()||'0');if(money>total){$yt_alert_Model.prompt('金额不能大于申请支出总金额');$(this).focus()}});$(".this-budget-table").on("blur",".input-money",function(event){var value=$(this).val();var reg='/^\d/g';$(this).val(value.replace(/[^\d.]/g,""));$(this).val($(this).val()==''?'':$yt_baseElement.fmMoney($(this).val()))});$(".this-budget-table").on("focus",".input-money",function(){$(this).val($(this).val()==''?'':$yt_baseElement.rmoney($(this).val()))});$(".this-budget-table").on("click",".operate-update",function(){var thisBtn=$(this);var thisTr=thisBtn.parents("tr");var thisTrHtml=thisTr.html();var specialCode=thisTr.find(".special-code").val()==null?' , ':thisTr.find(".special-code").val();var specialCodeArr=specialCode.split("-");var budgetObject=thisTr.find(".budget-info-td-two").text();var budgetMoney=thisTr.find(".budget-money-td span").text();var selectHtml='<select name="" class="yt-select budget-item-one"><option value=""></option></select><select name="" class="yt-select budget-item-two"><option value=""></option></select><select name="" class="yt-select budget-item-three"><option value=""></option></select><input type="text" class="yt-input budget-object" value="'+budgetObject+'" placeholder="请输入项目名称" style="margin-left:10px;padding-left: 4px;width:130px;display: inline-block;"/>';var moneyHtml='<input type="text" class="yt-input input-money budget-money" value="'+budgetMoney+'" placeholder="0.00" style="text-align: right;width: 95%;padding-right: 4px;" />';thisTr.find(".theif-budget-object").html(selectHtml);thisTr.find(".budget-money-td").html(moneyHtml);thisTr.find(".img-icon").html('<span class="operate-save"><img src="../../../../../resources-sasac/images/common/save-icon.png"></span><span class="operate-canel" style="margin-left: 15px;"><img src="../../../../../resources-sasac/images/common/canel-icon.png"></span>');budgetAuditReduce.setBudgetItme(specialCodeArr,thisTr);thisTr.find(".budget-item-two,.budget-item-three").hide();thisTr.find(".operate-canel").click(function(){thisTr.html(thisTrHtml);budgetAuditReduce.countBudgetMoney()});budgetAuditReduce.countBudgetMoney()});$(".this-budget-table").on("click",".operate-del",function(){var thisBtn=$(this);var thisTr=thisBtn.parents("tr");$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){thisTr.remove();budgetAuditReduce.countBudgetMoney()}})});$(".this-budget-table").on("click",".operate-save",function(){var thisBtn=$(this);var thisTr=thisBtn.parents("tr");var budgetObject=thisTr.find(".budget-object").val();var budgetMoney=thisTr.find(".budget-money").val();var total=$yt_baseElement.rmoney($('#totalAmount').text()||'0');var money=$yt_baseElement.rmoney(thisTr.find('.budget-money').val()||'0');var isTrue=false;var codeId=thisTr.find('select.budget-item-one').find('option:selected').val();if(codeId){if(codeId=="395"){if(budgetObject&&budgetMoney){isTrue=true;thisTr.find(".budget-money").removeClass("valid-hint");thisTr.find(".budget-object").removeClass("valid-hint")}else{if(!budgetMoney){thisTr.find(".budget-money").addClass("valid-hint")}else{thisTr.find(".budget-money").removeClass("valid-hint")}if(!budgetObject){thisTr.find(".budget-object").addClass("valid-hint")}else{thisTr.find(".budget-object").removeClass("valid-hint")}}}else{if(budgetMoney){isTrue=true;thisTr.find(".budget-money").removeClass("valid-hint");thisTr.find(".budget-object").removeClass("valid-hint")}else{thisTr.find(".budget-money").addClass("valid-hint")}}thisTr.find('.budget-item-one').removeClass("valid-hint")}else{if(!budgetMoney){thisTr.find(".budget-money").addClass("valid-hint")}else{thisTr.find(".budget-money").removeClass("valid-hint")}thisTr.find('.budget-item-one').addClass("valid-hint")}if(isTrue){if(budgetAuditReduce.verifyBudgetExpendSum(thisTr)){if(money<=total){var budgetOneText=thisTr.find("select.budget-item-one option:selected").text();var budgetTwoText=thisTr.find("select.budget-item-two option:selected").text();var budgetThreeText=thisTr.find("select.budget-item-three option:selected").text();var specialCode=function(){var code='';thisTr.find('select.budget-item-one,select.budget-item-two,select.budget-item-three').each(function(i,n){var val=$(this).find('option:selected').val();if(val){code+=val+'-'}});code=(code.substring(code.length-1)=='-')?code.substring(0,code.length-1):code;return code};var subText=(budgetOneText=='请选择'||''?'':budgetOneText+'-'+(budgetTwoText==''?'':budgetTwoText+'-'+(budgetThreeText==''?'':budgetThreeText+'-')));if(codeId!='395'){subText=subText.substr(0,subText.length-1)}var budgetText='<input type="hidden" class="special-code" value="'+specialCode()+'"/><span class="budget-info-td-one">'+subText+' </span> <span class="budget-info-td-two">'+budgetObject+'</span> ';thisTr.find(".theif-budget-object").html(budgetText);thisTr.find(".budget-money-td").html('<span>'+budgetMoney+'</span>');thisTr.find(".img-icon").html('<span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span>');budgetAuditReduce.countBudgetMoney()}else{$yt_alert_Model.prompt('金额不能大于申请支出总金额')}}}else{$yt_alert_Model.prompt("请输入完整数据")}});$(".this-budget-table").on("click",".add-row",function(){var thisBtn=$(this);var thisTr=thisBtn.parents("tr");var tr=$('<tr><td style="text-align: left;padding-left:15px"><div style="float: left;" class="theif-budget-object"><select name="" class="yt-select budget-item-one"><option value=""></option></select><select name="" class="yt-select budget-item-two"><option value=""></option></select><select name="" class="yt-select budget-item-three"><option value=""></option></select><input type="text" class="yt-input budget-object" placeholder="请输入项目名称" style="margin-left:10px;padding-left: 4px;width:130px;display: inline-block;"/></div><div style="float: right;margin-right: 10px;"><div style="padding-top: 5px;display: inline-block;">部门可用预算余额：<span class="text-money code-dept">--</span></div><div style="padding-top: 5px;display: inline-block;margin-left:20px;">单位可用预算余额：<span class="text-money code-mon">--</span></div></div></td><td class="budget-money-td" style="text-align: right;"><input type="text" class="yt-input input-money budget-money" placeholder="0.00" style="text-align: right;width: 95%;padding-right: 4px;" /></td><td class="img-icon"><span class="operate-save"><img src="../../../../../resources-sasac/images/common/save-icon.png"></span><span class="operate-canel" style="margin-left: 15px;"><img src="../../../../../resources-sasac/images/common/canel-icon.png"></span></td></tr>');thisTr.before(tr);budgetAuditReduce.setBudgetItme([],tr);tr.find(".budget-item-two,.budget-item-three").hide();tr.find(".operate-canel").click(function(){tr.remove()})});$("#closeBtn").click(function(){if(window.top==window.self){window.close()}else{parent.closeWindow()}});$("#saveBtn").click(function(){var me=$(this);var list=[];var special='';var lists;var advanceAppId=budgetAuditReduce.advanceAppId;var count=0;$('.this-budget-table tbody tr:not(.last,.cut-total)').each(function(i){var two=$(this).find('.budget-info-td-two').text();var special=$(this).find('.budget-info-td-one').text();var amount=$yt_baseElement.rmoney($(this).find('.budget-money-td span').text()||'0');list.push({specialCode:$(this).find('.special-code').val(),specialName:special,amount:amount,prjName:two,prjCode:$(this).attr('prjCode')});count+=amount;lists=JSON.stringify(list)});var total=$yt_baseElement.rmoney($('#totalAmount').text()||'0');if($yt_baseElement.fmMoney(count) == $yt_baseElement.fmMoney(total)) {budgetAuditReduce.saveBudgetSubInfo(lists,advanceAppId)}else{$yt_alert_Model.prompt('手动核减后金额必须等于申请支出总金额')}})},verifyBudgetExpendSum:function(tr){var expend=$yt_baseElement.rmoney(tr.find('.budget-money').val());var budget=$yt_baseElement.rmoney(tr.find('.code-dept').text().replace('万元',''))*10000;if(budget<expend){$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:"部门可用预算余额小于当前要核减的金额，请调整核减金额，或先调整部门预算再重新手动核减预算。",cancelFunction:function(){}});return false}return true},saveBudgetSubInfo:function(lists,advanceAppId){$.ajax({type:"post",url:"sz/expenditureApp/saveBudgetSubInfo",async:true,data:{expenditureAppId:advanceAppId,budgetSubList:lists},success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){setTimeout(function(){if(window.top==window.self){window.close()}else{parent.closeWindow()}},500)}}})},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},resetNum:function(obj){var trs=obj.find('tbody tr');$.each(trs,function(i,n){$(n).find('.num').text(i+1)})},countBudgetMoney:function(){var budgetMoneyArr=$(".this-budget-table .yt-tbody .budget-money-td span");var budgetSumMoney=0;budgetMoneyArr.each(function(i,n){budgetSumMoney+=$yt_baseElement.rmoney($(n).text())});$(".this-budget-table .budget-sum-me-money").text($yt_baseElement.fmMoney(budgetSumMoney))},setBudgetItme:function(arr,thisTr){var me=this;var codeArr=arr?arr:[];var budgetOne=thisTr.find('.budget-item-one');var budgetTwo=thisTr.find('.budget-item-two');var budgetThree=thisTr.find('.budget-item-three');var getBudgetCode=function(){thisTr.find('select.budget-item-one,select.budget-item-two,select.budget-item-three').each(function(){})};thisTr.find('div.budget-item-two').hide();thisTr.find('div.budget-item-three').hide();me.getSpecialDictList(thisTr.find('select.budget-item-one'),'',function(list){var code=thisTr.find('select.budget-item-one').find('option:selected').val();if(code){if(code=="395"){thisTr.find(".budget-object").show()}else{thisTr.find(".budget-object").val("").hide()}me.getSpecialDictList(thisTr.find('select.budget-item-two'),code,function(list){if(list.length>0){var twoCode=thisTr.find('select.budget-item-two').find('option:selected').val();me.getSpecialDictList(thisTr.find('select.budget-item-three'),twoCode,function(list){if(list.length>0){var threeCode=thisTr.find('select.budget-item-three').find('option:selected').val();me.getBudgetBalanceAmount(threeCode,thisTr)}else{thisTr.find('div.budget-item-three').hide();me.getBudgetBalanceAmount(twoCode,thisTr)}},codeArr.length>2?codeArr[2]:'')}else{thisTr.find('div.budget-item-two').hide();thisTr.find('div.budget-item-three').hide()}},codeArr.length>1?codeArr[1]:'')}else{thisTr.find(".budget-object").val("").hide();thisTr.find('.code-mon').text('--');thisTr.find('div.budget-item-two').hide();thisTr.find('div.budget-item-three').hide()}},codeArr.length>0?codeArr[0]:'');thisTr.find('select.budget-item-one').on('change',function(){var code=$(this).find('option:selected').val();if(code){if(code=="395"){thisTr.find(".budget-object").show()}else{thisTr.find(".budget-object").val("").hide()}me.getSpecialDictList(thisTr.find('select.budget-item-two'),code,function(list){if(list.length>0){var twoCode=budgetTwo.find('option:selected').val();me.getSpecialDictList(thisTr.find('select.budget-item-three'),twoCode,function(list){if(list.length>0){var threeCode=thisTr.find('select.budget-item-three').find('option:selected').val();me.getBudgetBalanceAmount(threeCode,thisTr)}else{thisTr.find('div.budget-item-three').hide();me.getBudgetBalanceAmount(twoCode,thisTr)}})}else{thisTr.find('div.budget-item-two').hide();thisTr.find('div.budget-item-three').hide()}})}else{thisTr.find(".budget-object").val("").hide();thisTr.find('.code-mon').text('--');thisTr.find('div.budget-item-two').hide();thisTr.find('div.budget-item-three').hide()}if(code=='395'){$('.prj-name-tr').show()}else{$('.prj-name-tr').hide().val('')}});thisTr.find('select.budget-item-two').on('change',function(){var code=$(this).find('option:selected').val();me.getSpecialDictList(thisTr.find('select.budget-item-three'),code,function(list){if(list.length>0){var threeCode=thisTr.find('select.budget-item-three').find('option:selected').val();me.getBudgetBalanceAmount(threeCode,thisTr)}else{thisTr.find('div.budget-item-three').hide();me.getBudgetBalanceAmount(code,thisTr)}})});thisTr.find('select.budget-item-three').on('change',function(){var threeCode=thisTr.find('select.budget-item-three').find('option:selected').val();me.getBudgetBalanceAmount(threeCode,thisTr)})},getSpecialDictList:function(obj,parentCode,fun,code){obj.find('option').remove();$.ajax({type:"post",url:"budget/main/getSpecialDictList",async:true,data:{parentCode:parentCode},success:function(data){var list=data.data||[];var opts='';if(obj.hasClass('budget-item-one')){opts+='<option value="">请选择</option>'}if(data.flag==0&&list.length>0){$.each(list,function(i,n){if(code&&code==n.specialCode){opts+='<option selected="selected" value="'+n.specialCode+'">'+n.specialName+'</option>'}else{opts+='<option value="'+n.specialCode+'">'+n.specialName+'</option>'}});obj.html(opts).niceSelect()}else{}if(fun){fun(list)}}})},getBudgetBalanceAmount:function(specialCodeSeq,thisTr){var applicantUser=budgetAuditReduce.applicantUserCode;$.ajax({type:"post",url:"budget/main/getBudgetOtherBalanceAmount",async:true,data:{specialCodeSeq:specialCodeSeq,applicantUser:applicantUser},success:function(data){if(data.flag==0){var deptBudgetBalanceAmount=data.data.deptBudgetBalanceAmount;thisTr.find('.code-dept').text(deptBudgetBalanceAmount?$yt_baseElement.fmMoney(deptBudgetBalanceAmount)+'万元':'--');var budgetBalanceAmount=data.data.budgetBalanceAmount;thisTr.find('.code-mon').text(budgetBalanceAmount?$yt_baseElement.fmMoney(budgetBalanceAmount)+'万元':'--')}}})},getExpenditureAppInfoByAppId:function(advanceAppId){var me=$(this);$.ajax({type:"post",url:"sz/expenditureApp/getExpenditureAppInfoByAppId",async:true,data:{expenditureAppId:advanceAppId},success:function(data){var data=data.data;budgetAuditReduce.saveData=data;budgetAuditReduce.applicant(data)}})},applicant:function(data){var me=this;budgetAuditReduce.applicantUserCode=data.applicantUser;$("#applicantUser").text(data.applicantUserName);$("#applicantUserDeptName").text(data.applicantUserDeptName);$("#expenditureAppName").text(data.expenditureAppName);$("#totalAmount").text($yt_baseElement.fmMoney(data.totalAmount));$("#nodeNowState").text(data.nodeNowState);$("#formNum").text(data.expenditureAppNum);$("#fuData").text(data.applicantTime);me.showCostDetail(data.costData);me.showCurrentBudgetSubList(data.currentBudgetSubList);me.showCurrentBudgetSub(data.currentBudgetSubList)},showCurrentBudgetSubList:function(data){var total=0;var SubHtml='';$.each(data,function(i,n){SubHtml+='<tr class="" specialCode="'+n.specialCode+'" specialName="'+n.specialName+'" prjCode="'+n.prjCode+'" prjName="'+n.prjName+'" amount="'+n.amount+'" createTime="'+n.createTime+'"><td><span class="specialName">'+n.specialName+'</span><span class="specialName">'+(n.prjName?'-'+n.prjName:'')+'</span></td><td style="text-align: right;"><span class="amount">'+$yt_baseElement.fmMoney(n.amount)+'</span></td></tr>';if(n.createTime){$(".last-modified-date").text(n.createTime)}total+=n.amount});$(".budget-sum-money").text($yt_baseElement.fmMoney(total));$('.cut-after-examination tbody .last').before(SubHtml)},showCurrentBudgetSub:function(data){var total=0;var SubHtml='';$.each(data,function(i,n){SubHtml+='<tr prjCode = '+n.prjCode+' prjName = '+n.prjName+'><td style="text-align: left;padding-left:15px"><div style="float: left;" class="theif-budget-object"><input type="hidden" class="special-code" value="'+n.specialCode+'"><span class="budget-info-td-one">'+n.specialName+'</span>'+(n.prjName?'-':'')+'<span class="budget-info-td-two">'+n.prjName+'</span> </div><div style="float: right;margin-right: 10px;"><div style="padding-top: 5px;display: inline-block;">部门可用预算余额：<span class="text-money code-dept">'+(n.deptBudgetBalanceAmount?$yt_baseElement.fmMoney(n.deptBudgetBalanceAmount)+'万元':'--')+'</span></div><div style="padding-top: 5px;display: inline-block;margin-left: 20px;">单位可用预算余额：<span class="text-money code-mon">'+(n.budgetBalanceAmount?$yt_baseElement.fmMoney(n.budgetBalanceAmount)+'万元':'--')+'</span></div></div></td><td class="budget-money-td" style="text-align: right;"><span>'+$yt_baseElement.fmMoney(n.amount)+'</span></td><td class="img-icon"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+=n.amount});$(".budget-sum-me-money").text($yt_baseElement.fmMoney(total));$('.this-budget-table tbody .last').before(SubHtml)},showCostDetail:function(data){var me=this;var costReceptionistList=data.costReceptionistList;var costDetailsList=data.costDetailsList;var receHtml='';$.each(costReceptionistList,function(i,n){receHtml+='<tr pkId="'+n.costReceptionistId+'" class="" nameVal="'+n.name+'" dutyVal="'+n.jobName+'" deptVal="'+n.unitName+'"><td><span class="num">1</span></td><td><span class="name-text">'+n.name+'</span></td><td><span class="job-text">'+n.jobName+'</span></td><td><span class="unit-text">'+n.unitName+'</span></td></tr>'});$('.msg-list tbody').append(receHtml);var indexHeight=$("#locationId").offset().top;$(window).scrollTop(indexHeight);me.resetNum($('.msg-list'));var tripPlanList=data.travelRouteList;var tripHtml='';var travelPersonnelsList=[];var getUserNames=function(list){var str='';$.each(list,function(i,n){str+=n.travelPersonnelName+(i<list.length-1?'、':'')});return str};var costItem=function(str){switch(str){case '1':return '住宿费';break;case '2':return '伙食费';break;case '3':return '市内交通费';break;default:return '';break}};var getCostItemName=function(str){var txt='';if(str){var list=str.split('-');$.each(list,function(i,n){if(n){txt+=costItem(n)+(i<list.length-1?'、':'')}});return txt}return ''};$.each(tripPlanList,function(i,n){var dateFrom=new Date(n.startTime);var dateTo=new Date(n.endTime);var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24));tripHtml+='<tr busicode="'+n.travelType+'" usercode="'+n.travelPersonnels+'" rececode="'+n.receptionCostItem+'" ><td><input type="hidden" class="hid-user-code" value="'+n.travelPersonnels+'" /> <span class="name">'+n.travelTypeName+'</span></td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="day">'+diff_day+'</td><td class="address" val="'+n.travelAddress+'">'+n.travelAddressName+'</td><td class="uname">'+getUserNames(n.travelPersonnelsList)+'</td><td class="numof">'+n.travelPersonnelsList.length+'</td><td class="reception">'+getCostItemName(n.receptionCostItem)+'</td></tr>'});$('#tripList tbody').html(tripHtml);if(data.costCarfareList.length==0&&data.costHotelList.length==0&&data.costOtherList.length==0&&data.costSubsidyList.length==0){$(".cost-list-model").html('<table style="width:100%"><tr style="border:0px;background-color:#fff !important;"><td align="center"style="border:0px;"><div class="no-data" style="width: 280px;padding:0;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding:10px 0;"></div></td></tr></table>')}else{me.setCostCarfareList(data);me.setCostHotelList(data);me.setCostOtherList(data);me.setCostSubsidyList(data)}if(data.teacherApplyInfoList.length==0&&data.costTrainApplyInfoList.length==0&&data.costTeachersFoodApplyInfoList.length==0&&data.costTeachersLectureApplyInfoList.length==0&&data.costTeachersTravelApplyInfoList.length==0&&data.costTeachersHotelApplyInfoList.length==0&&data.costNormalList.length==0){$(".hide-div").html('<table style="width:100%"><tr style="border:0px;background-color:#fff !important;"><td align="center"style="border:0px;"><div class="no-data" style="width: 280px;padding:0;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding:10px 0;"></div></td></tr></table>')}else{me.setTeacherApplyInfoList(data.teacherApplyInfoList);me.setCostTrainApplyInfoList(data.costTrainApplyInfoList);me.setCostTeachersFoodApplyInfoList(data.costTeachersFoodApplyInfoList);me.setCostTeachersLectureApplyInfoList(data.costTeachersLectureApplyInfoList);me.setCostTeachersTravelApplyInfoList(data.costTeachersTravelApplyInfoList);me.setCostTeachersHotelApplyInfoList(data.costTeachersHotelApplyInfoList);me.setCostNormalList(data.costNormalList)}me.setMeetingList(data.meetingList);me.setMeetingCostList(data.meetingCostList);me.setTrainApplyInfoList(data.trainApplyInfoList);var indexHeight=$("#locationId").offset().top;$(window).scrollTop(indexHeight)},setCostCarfareList:function(data){var fMoney=$yt_baseElement.fmMoney;var costCarfareList=data.costCarfareList;var carHtml='';var costCarfareClose=$('#traffic-list-info').next().find('.check-label input');if(costCarfareList!=0){$.each(costCarfareList,function(i,n){carHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+n.travelPersonnel+'"/></td><td>'+n.travelPersonnelsDept+'</td><td data-text="goTime">'+n.goTime+'</td><td><input data-val="goAddress" type="hidden" value="'+n.goAddress+'"><span data-text="goAddressName">'+n.goAddressName+'</span></td><td data-text="arrivalTime">'+n.arrivalTime+'</td><td><input data-val="arrivalAddress" type="hidden" value="'+n.arrivalAddress+'"> <span data-text="arrivalAddressName">'+n.arrivalAddressName+'</span></td><td><span data-text="vehicle">'+n.vehicleName+'</span><input type="hidden" class="hid-vehicle" value="'+n.vehicle+'"/><input type="hidden" class="hid-child-code" value=""/></td><td class="font-right money-td" data-text="crafare">'+(n.crafare==""?"--":fMoney(n.crafare||'0'))+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"--":n.remarks)+'</td><td style="display:none;"><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costCarfareClose.length>0&&n.setMethod){costCarfareClose.setCheckBoxState('check')}});carHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td></tr>';$('#traffic-list-info tbody').html(carHtml);sysCommon.updateMoneySum(0)}else{$('#traffic-list-info').hide();$('.traffic-title').hide()}},setCostHotelList:function(data){var fMoney=$yt_baseElement.fmMoney;var costHotelList=data.costHotelList;var hotelHtml='';var costHotelClose=$('#hotel-list-info').next().find('.check-label input');if(costHotelList!=0){$.each(costHotelList,function(i,n){var avg=n.hotelDays>0?fMoney((+n.hotelExpense/ +n.hotelDays)||'0'):n.hotelExpense;hotelHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" value="'+n.travelpersonnel+'"/></td><td>'+n.travelPersonnelsJobLevelName+'</td>'+'<td class="font-right">'+avg+'</td><td risk-code-val="hotelCheckInDate" class="check-in-date"><span class="sdate">'+n.hotelTime+'</span></td><td class="leave-date"><span class="edate">'+n.leaveTime+'</span></td><td data-text="hotelDays">'+n.hotelDays+'</td><td class="font-right money-td" data-text="hotelExpense">'+fMoney(n.hotelExpense||'0')+'</td><td><span data-text="hotelAddressName">'+n.hotelAddressName+'</span><input type="hidden" data-val="hotelAddress" value="'+n.hotelAddress+'"</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"--":n.remarks)+'</td><td style="display:none;"><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costHotelClose.length>0&&n.setMethod){costHotelClose.setCheckBoxState('check')}});hotelHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$('#hotel-list-info tbody').html(hotelHtml);sysCommon.updateMoneySum(1)}else{$('#hotel-list-info').hide();$('.accommodation-title').hide()}},setCostOtherList:function(data){var fMoney=$yt_baseElement.fmMoney;var costOtherList=data.costOtherList;var otherHtml='';var costOtherClose=$('#other-list-info').next().find('.check-label input');if(costOtherList!=0){$.each(costOtherList,function(i,n){otherHtml+='<tr><td><span>'+n.costTypeName+'</span><input type="hidden" data-val="costType" value="'+n.costType+'"/></td><td class="font-right money-td" data-text="reimAmount">'+fMoney(n.reimAmount||'0')+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"--":n.remarks)+'</td></tr>';if(costOtherClose.length>0&&n.setMethod){costOtherClose.setCheckBoxState('check')}});otherHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td></tr>';$('#other-list-info tbody').html(otherHtml);sysCommon.updateMoneySum(2)}else{$('#other-list-info').hide();$('.other-title-hide').hide()}},setCostSubsidyList:function(data){var fMoney=$yt_baseElement.fmMoney;var costSubsidyList=data.costSubsidyList;var subHtml='';var totalFood=0;var totalTraffic=0;if(costSubsidyList!=0){$.each(costSubsidyList,function(i,n){subHtml+='<tr class="'+n.travelPersonnel+'" code="'+n.travelPersonnel+'"><td><div class="user" code="'+n.travelPersonnel+'">'+n.travelPersonnelName+'</div></td><td><div class="lv">'+n.travelPersonnelsDept+'</div></td><td><div class="subsidy-num">'+n.subsidyDays+'</div></td><td><div style="text-align:right;" class="food">'+fMoney(n.subsidyFoodAmount||'0')+'</div></td><td><div  style="text-align:right;" class="traffic">'+fMoney(n.carfare||'0')+'</div></td></tr>';totalFood+= +n.subsidyFoodAmount;totalTraffic+= +n.carfare});subHtml+='<tr class="last"><td>合计</td><td></td><td></td><td class="total-food"  style="text-align:right;">'+fMoney(totalFood||'0')+'</td><td class="total-traffic"  style="text-align:right;">'+fMoney(totalTraffic||'0')+'</td></tr>';$('#subsidy-list-info tbody').html(subHtml)}else{$('#subsidy-list-info').hide();$('.subsidy-title').hide()}},setTeacherApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr><td class="lecturerName"><input type="hidden" class="lectureId" value="'+n.lecturerId+'"><span>'+n.lecturerName+'</span></td><td class="professional">'+n.lecturerTitleName+'</td><td class="level">'+n.lecturerLevelName+'</td><td style="display:none"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#lecturerTable tbody').html(html)},setCostTrainApplyInfoList:function(list){var html='';var total=0;if(list!=0){$.each(list,function(i,n){html+='<tr pid="'+n.trainAppId+'" trainType="'+n.trainType+'"><td class="trainTypeName">'+n.trainTypeName+'</td><td style="text-align: right" class="standard">'+$yt_baseElement.fmMoney(n.standard)+'</td><td class="trainOfNum">'+n.trainOfNum+'</td><td class="trainDays">'+n.trainDays+'</td><td class="moneyText averageMoney">'+n.averageMoney+'</td><td style="text-align: left" class="trainingPerNumber">'+n.trainOfNum+'</td></tr>';total+= +n.averageMoney});$('#trainingFeeTable tbody .last').before(html);$('#trainingFeeTable .costTotal').text(budgetAuditReduce.fmMoney(total))}else{$('#trainingFeeTable').hide();$('.other-title').hide()}},setCostTeachersFoodApplyInfoList:function(list){var html='';var total=0;if(list!=0){$.each(list,function(i,n){html+='<tr pid="'+n.foodId+'"><td><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="avg moneyText">'+budgetAuditReduce.fmMoney(n.averageMoney)+'</td><td class="day">'+n.foodOfDays+'</td><td class="moneyText sum-pay">'+budgetAuditReduce.fmMoney(n.foodAmount)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td style="display:none"><input type="hidden" class="popM" value="4"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.foodAmount});$('#dietFeeTable tbody .end-tr').before(html);$('#dietFeeTable tbody .costTotal').text(budgetAuditReduce.fmMoney(total))}else{$('#dietFeeTable').hide();$('.food-title').hide()}},setCostTeachersLectureApplyInfoList:function(list){var html='';var total=0;if(list!=0){$.each(list,function(i,n){html+='<tr pid="'+n.teachersLectureId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="holder">'+n.lecturerTitleName+'</td><td class="hour">'+n.teachingHours+'</td><td class="cname">'+n.courseName+'</td><td class="moneyText sum-pay">'+budgetAuditReduce.fmMoney(n.perTaxAmount)+'</td><td class="moneyText after">'+budgetAuditReduce.fmMoney(n.afterTaxAmount)+'</td><td class="moneyText avg">'+budgetAuditReduce.fmMoney(n.averageMoney)+'</td><td style="display:none"><input type="hidden" class="popM" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.perTaxAmount});$('#lectureFeeTable tbody .end-tr').before(html);$('#lectureFeeTable tbody .costTotal').text(budgetAuditReduce.fmMoney(total))}else{$('#lectureFeeTable').hide();$('.lecture-title').hide()}},setCostTeachersTravelApplyInfoList:function(list){var html='';var total=0;if(list!=0){$.each(list,function(i,n){html+='<tr pid="'+n.teachersTravelId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="ulv">'+n.lecturerLevelName+'</td><td class="sdate">'+n.goTime+'</td><td class="edate">'+n.arrivalTime+'</td><td class="sadd"><input type="hidden" class="scode" value="'+n.goAddress+'">'+n.goAddressName+'</td><td class="eadd"><input type="hidden" class="ecode" value="'+n.arrivalAddress+'">'+n.arrivalAddressName+'</td><td class="tname"><input type="hidden" class="tool" value="'+n.vehicle+'">'+n.vehicleName+'</td><td class="moneyText sum-pay">'+budgetAuditReduce.fmMoney(n.carfare)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td  style="display:none"><input type="hidden" class="popM" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.carfare});$('#carFeeTable tbody .end-tr').before(html);$('#carFeeTable tbody .costTotal').text(budgetAuditReduce.fmMoney(total))}else{$('#carFeeTable').hide();$('.traffic-title').hide()}},setCostTeachersHotelApplyInfoList:function(list){var html='';var total=0;if(list!=0){$.each(list,function(i,n){html+='<tr pid="'+n.teachersHotelId+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="moneyText avg">'+budgetAuditReduce.fmMoney(n.averageMoney)+'</td><td class="day">'+n.hotelDays+'</td><td class="moneyText sum-pay">'+budgetAuditReduce.fmMoney(n.hotelExpense)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td style="display:none"><input type="hidden" class="popM" value="3"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.hotelExpense});$('#hotelFeeTable tbody .end-tr').before(html);$('#hotelFeeTable tbody .costTotal').text(budgetAuditReduce.fmMoney(total))}else{$('#hotelFeeTable').hide();$('.accommodation-title').hide()}},setCostNormalList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr><td style="text-align:left;" class="reimContent">'+n.normalName+'</td><td style="text-align: right;" class="reimAmount">'+($yt_baseElement.fmMoney(n.normalAmount))+'</td><td class="remarks">'+(n.remarks||'无')+'</td></tr>';total+= +n.normalAmount});$('.ordinary-approval #costList tbody .last').before(html);$('.ordinary-approval #costList tbody #reimAmountlSum').text($yt_baseElement.fmMoney(total))},setTrainApplyInfoList:function(list){if(list.length>0){$("#trainType").text(list[0].trainTypeName);$("#regionDesignation").text(list[0].regionDesignation);$("#regionName").text(list[0].regionName);$("#reportTime").text(list[0].reportTime);$("#endTime").text(list[0].endTime);$("#trainDays").text(list[0].trainDays);$("#trainOfNum").text(list[0].trainOfNum);$("#workerNum").text(list[0].workerNum)}},setMeetingList:function(list){if(list.length>0){$("#meetTypeName").text(list[0].meetTypeName);$("#meetName").text(list[0].meetName);$("#meetAddress").text(list[0].meetAddress);$("#meetStartTime").text(list[0].meetStartTime);$("#meetEndTime").text(list[0].meetEndTime);$("#meetDays").text(list[0].meetDays);$("#meetOfNum").text(list[0].meetOfNum);$("#meetWorkerNum").text(list[0].meetWorkerNum)}},setMeetingCostList:function(list){if(list.length>0){$("#meetHotel").text(list[0].meetHotel||'--');$("#meetFood").text(list[0].meetFood||'--');$("#meetOther").text(list[0].meetOther||'--');$("#meetAmount").text(list[0].meetAmount||'--');$("#meetAverage").text(list[0].meetAverage||'--')}else{$("#meetHotel").text('--');$("#meetFood").text('--');$("#meetOther").text('--');$("#meetAmount").text('--');$("#meetAverage").text('--')}},getCostType:function(costType){if(costType=='NORMAL_APPLY'){sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetailApproval.html')}else if(costType=='TRAIN_APPLY'){sysCommon.loadingWord('view/system-sasac/expensesReim/module/busiTripApply/trainApproval.html')}else if(costType=='MEETING_APPLY'){sysCommon.loadingWord('view/system-sasac/expensesReim/module/beforehand/meetingCostApplyDetails.html')}else if(costType=='BH_APPLY'){sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/hospitalitySpendingDetail.html')}else if(costType=='TRAVEL_APPLY'){sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/travelSpendingDetails.html')}}};$(function(){budgetAuditReduce.inits();var indexHeight=$("#locationId").offset().top;$(window).scrollTop(indexHeight)});