(function($,window){var ordernumber=0;var serveApply={addressList:"",selUsersName:"",selUsersCode:"",usersInfoList:"",usersInfoJson:"",beforeCostList:[],riskExcMark:"../../../../../resources-sasac/images/common/war-red.png",riskWarImg:"../../../../../resources-sasac/images/common/risk-war.png",riskViaImg:"../../../../../resources-sasac/images/common/risk-via.png",init:function(){var ts=this;var pid=$yt_common.GetQueryString('advanceId');if(pid){ts.getAdvanceAppInfoDetailByAdvanceAppId(pid)}else{ts.getCostTypeList();ts.showTrainFun();}ts.start();sysCommon.getLoginUserInfo();$(".applicantUser").val($yt_common.user_info.userName);sysCommon.getApproveFlowData("SZ_ADVANCE_APP");ts.getCostActivityPro();ts.getSpectificCostType();ts.setAddress();ts.events();ts.costApplyAlertEvent();sysCommon.costDetailModelTabEvent();ts.uploadFile()},start:function(){$yt_baseElement.numberInput($(".yt-numberInput-box"));$('select').niceSelect()},events:function(){var me=this;$('.file-box').on('click','.del-file',function(){var ithis=$(this);var parent=ithis.parent();$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){parent.remove()}})});$('.money-input').on('focus',function(){var ts=$(this);if(ts.val()!=""){ts.val($yt_baseElement.rmoney(ts.val()))}});$('.money-input').on('blur',function(){var ts=$(this);if(ts.val()!=''){ts.val($yt_baseElement.fmMoney(ts.val()))}});$('.money-input').on('keyup',function(){var ts=$(this);if(ts.val()!=''){ts.val(ts.val().replace(/[^\d.]/g,''))}});$('#addExpense').on('click',function(){me.showPaymentAlert();$('#paymentAddBtn').off().on('click',function(){me.appendPaymentList()})});$("#budgetMoney").on("blur",function(){if($(this).val()!=""){$(this).val($yt_baseElement.fmMoney($(this).val()))}});$("#bzy-span,#budgetMoney").on("focus",function(){if($(this).val()!=""){$(this).val($yt_baseElement.rmoney($(this).val()))}});$('.add-msg').click(function(){me.showMsgAlert();$('#LpaymentAddBtn').off().on('click',function(){var isNull=$yt_valid.validForm($("#addObjInfo"));if(isNull){me.appendMsgList()}})});$('#paymentCanelBtn').click(function(){me.hideMsgAlert();me.clearAlert($('#createDetali'))});$("#bzy-span").on("blur",function(){if($(this).val()!=""){$(this).val($yt_baseElement.fmMoney($(this).val()))}});$('#getvalue').change(function(){var name=$('#getvalue option:selected').text();$('.special-label').text(name+'余额：')});$('.special-type').change(function(){var val=$(this).val();var yesno='';if(val=='2'){$('.special-yes').hide();$('.special-no').show();var name=$('#getvalue option:selected').text();$('.special-label').text(name+'余额：');var yesno='否'}else{$('.special-yes').show();$('.special-no').hide();var yesno='是'}});$('#paymentList').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();var tds=$('#paymentList tbody .money');var total=0;$.each(tds,function(i,n){total+= +$(n).attr('money')});var fmTotal=$yt_baseElement.fmMoney(total);$('#paymentList tbody .total-money').text(fmTotal);$('.count-val-num').text(fmTotal);$('.count-val').text(arabiaToChinese(fmTotal+''))}})});$('#targetList').on('click','.receive-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();me.resetNum($('.msg-list'))}})});$('#targetList').on('click','.receive-update',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#createDetali'));$('#pop-modle-alert').show();$('#createDetali').show()});$('#paymentCanelBtn').on('click',function(){$yt_baseElement.hideMongoliaLayer();$('#createDetali').hide();$('#pop-modle-alert').hide()});$('#GpaymentCanelBtn').on('click',function(){$yt_baseElement.hideMongoliaLayer();$('#createExpense').hide();$('#pop-modle-alert').hide();me.clearAlert($('.create-detali'))});$('.prior-approval').click(function(){$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('.prior-alert'));$('#pop-modle-alert').show();$('.prior-alert').show()});$('.prior-common').click(function(){var code=$('.special-list .yt-table-active').attr('code');var codeName=$('.special-list .yt-table-active').find('td').eq(1).text();var codeMon=$('.special-list .yt-table-active').find('td').eq(2).text();if(code){$('#codeMon').text(codeMon);$('.prior-approval').val(codeName);$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()}else{$yt_alert_Model.prompt('请选择一条数据')}});$('.prior-cancel').click(function(){$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()});$('.yt-table tbody').on('click','tr',function(){var ts=$(this);var trs=ts.siblings();trs.removeClass('yt-table-active');ts.addClass('yt-table-active')});$('.docu-style-box').on('change','.docu-style',function(){var fun=$(this).attr('fun');if(fun){$('.qtip-text-div').hide();$('.mod-div').hide();me[fun]();$('.dottom-div').show();$('.grod-div').show()}else{$('.qtip-text-div').show();$('.mod-div').hide();$('.dottom-div').hide();$('.grod-div').hide()}$('.label-title.item .title-text').text('事前申请事项信息');$('.label-title.cost .title-text').text('事前申请费用信息')});$yt_baseElement.tableRowActive();$('#inputcancel').click(function(){$('#askinput').val('')});$('#resetting').click(function(){$('#askinput').val('')});$('#targetList').on('click','.receive-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var objId=tr.attr('pkid');var applyName=$('#applyName').val(tr.attr('applyName'));var Duties=$('#Duties').val(tr.attr('Duties'));var Unit=$('#Unit').val(tr.attr('Unit'));me.showMsgAlert();$('#LpaymentAddBtn').off().on('click',function(){var isNull=$yt_valid.validForm($("#addObjInfo"));if(isNull){me.appendMsgList(tr,objId)}})});$('#paymentList').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var budgetProject=$('#budgetProject option[value="'+tr.attr('pcode')+'"]').attr('selected',true);var txtDate=$('#txtDate').val(tr.attr('txtDate'));var place=$('#place').val(tr.attr('place'));var costBreakdown=$('#costBreakdown option[value="'+tr.attr('tcode')+'"]').attr('selected',true);var bzyspan=$('#bzy-span').val($yt_baseElement.fmMoney(tr.attr('bzy-span')));var budgetMoney=$('#budgetMoney').val($yt_baseElement.fmMoney(tr.attr('budgetMoney')));var peoplenum=$('#peoplenum').val(tr.attr('peoplenum'));$('#budgetProject,#costBreakdown').niceSelect();me.showPaymentAlert();$('#paymentAddBtn').off().on('click',function(){me.appendPaymentList(tr)})});$("#cancelBtn").off().on('click',function(){window.history.back(-1)});$('.clear-historical-approval').on('click',function(){$yt_alert_Model.alertOne({alertMsg:'变更历史预算单后，从历史预算单导入的数据将清空是否确定变更预算单？',confirmFunction:function(){$('.historical-approval').val('');$('#advanceAppId').val('');$('.index-main-div .export-but').hide();me.clearPriorApproval();$('.clear-historical-approval').hide();$('#trainDetails,#exportLecturer,#exportCostApp,#exportPredictCost,#importTrainingOther').attr("disabled",false)}})});$("#advanceAppReason").on("blur",function(){var value=$(this).val();$("#prjName").val(value);});me.setSubmitEvent();me.setSaveEvent();me.historicalApprovalEvent();me.showImportFun()},setSubmitEvent:function(){var me=this;$('#getPayment').on('click',function(){var budgetMoney="";var validMsg="";var applyTotalMoneyAmount=$yt_baseElement.rmoney($("#applyTotalMoney").text());var lastSelectIndex=$(".budget-items .nice-select:visible").length-1;if($(".budget-items select").eq(lastSelectIndex).find("option:selected").attr("valid-type")=="DEPT"){budgetMoney=$("#deptBudgetBalanceAmountHidden").val()*10000;validMsg="部门预算可用余额小于当前申请的金额，请调整申请内容，或先保存页面信息，待部门预算调整后再重新提交申请。"}if($(".budget-items select").eq(lastSelectIndex).find("option:selected").attr("valid-type")=="UNIT"){budgetMoney=$yt_baseElement.rmoney($('#budgetBalanceAmount').text().replace('万元',''))*10000;validMsg="中心预算可用余额小于当前申请的金额，请调整申请内容，或先保存页面信息，待单位预算调整后再重新提交申请。"}if(applyTotalMoneyAmount>budgetMoney){$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:validMsg,cancelFunction:function(){}})}else{var thisBtn=$(this);var verifyBudgetExpendSum=me.verifyBudgetExpendSum();if($yt_valid.validForm($('.base-info-form-modle,.grod-div,.verify-div'))&&verifyBudgetExpendSum){thisBtn.off();var d=me.getJsonVal();me.submitAdvanceAppInfo(d,thisBtn)}else{sysCommon.pageToScroll($("body .valid-font"));thisBtn.attr('disabled',false).removeClass('btn-disabled')}}})},setSaveEvent:function(){var me=this;$('#saveask').on('click',function(){var thisBtn=$(this);thisBtn.off();var d=me.getJsonVal();me.saveAdvanceAppInfoToDrafts(d,thisBtn)})},historicalApprovalEvent:function(){var me=this;$('.historical-approval').click(function(){me.getHistoricalApprovalList();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('.historical-alert'));$('#pop-modle-alert').show();$('.historical-alert').show()});$('.historical-common').click(function(){var tr=$('.historical-approval-list .yt-table-active');var code=tr.attr('code');var name=tr.find('.sname').text();var id=tr.attr('pid');var types=tr.attr('type');var balance=tr.find('.balance').val();var thisVal=$('.historical-approval').val();if(thisVal&&thisVal!=code){$yt_alert_Model.alertOne({alertMsg:"变更历史预算单后，从历史预算单导入的数据将清空是否确定变更预算单？",confirmFunction:function(){if(code){me.clearPriorApproval();$('.historical-approval').val(code).attr('costType',types).removeClass('valid-hint').nextAll().find('.valid-font').text('');$yt_baseElement.hideMongoliaLayer();$('.historical-alert').hide();$('#pop-modle-alert').hide();$('.clear-historical-approval').show();$('.export-but').show()}else{$yt_alert_Model.prompt('请选择一条数据')}}})}else{if(code){me.clearPriorApproval();me.getHistoricalAdvanceAppInfoDetailByAdvanceAppId(id);$('.historical-approval').val(code).attr('costType',types).removeClass('valid-hint').nextAll().find('.valid-font').text('');$yt_baseElement.hideMongoliaLayer();$('.historical-alert').hide();$('#pop-modle-alert').hide();$('.clear-historical-approval').show();$('.export-but').show();$(".historical-approval").parent().find(".valid-font").text('')}else{$yt_alert_Model.prompt('请选择一条数据')}}});$('.historical-cancel,.historical-alert .closed-span').click(function(){$yt_baseElement.hideMongoliaLayer();$('.historical-alert').hide();$('#pop-modle-alert').hide();$('.historical-approval-val').val('');});$('.historical-approval-search').click(function(){me.getHistoricalApprovalList()});$('.historical-approval-reset').click(function(){$('.historical-approval-val').val('');me.getHistoricalApprovalList()})},getHistoricalApprovalList:function(){var tbody=$('.historical-approval-list tbody');var queryParams=$('.historical-approval-val').val();var costType=$('.docu-style-box .check input').val();var pageDiv=$('.historical-page');$('.historical-page').pageInfo({pageIndex:1,pageNum:5,pageSize:3,url:"sz/advanceApp/getAdvanceAppListToPageByParams",objName:'data',data:{type:'FINAL_APP',costType:'TRAIN_APPLY',queryParams:queryParams},success:function(data){tbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){pageDiv.show();$.each(data.data.rows,function(i,n){var advanceAppName=n.advanceAppName;if(advanceAppName.length>17){advanceAppName=n.advanceAppName.substr(0,15)+"..."}trStr+='<tr pid="'+n.advanceAppId+'" code="'+n.advanceAppNum+'" type="'+n.advanceCostType+'"><td>'+n.advanceAppNum+'<input type="hidden" class="balance" value="'+n.advanceAppBalance+'" /></td><td>'+n.applicantUserName+'</td><td>'+n.applicantUserDeptName+'</td><td title='+n.advanceAppName+'>'+advanceAppName+'</td><td>'+n.advanceCostTypeName+'</td><td>'+n.applicantTime+'</td></tr>'});tbody.append(trStr)}else{pageDiv.hide();var noTr='<tr class="model-no-data-tr"><td colspan="7"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';tbody.append(noTr)}}}})},getHistoricalAdvanceAppInfoDetailByAdvanceAppId:function(id,upDate){$.ajax({type:"post",url:"sz/advanceApp/getHistoricalAdvanceAppInfoDetail",async:true,data:{advanceAppId:id},success:function(data){if(data.flag==0){data.data.advanceAppId='';data.data.nodeNowState='';data.data.workFlowState='';data.data.currentAssignee='';data.data.historyAssignee='';serveApply.beforeCostList=data.data}}})},clearPriorApproval:function(){$('#trainDetails,#exportLecturer,#exportCostApp,#exportPredictCost,#importTrainingOther').attr("disabled",false);$('#indexMainDiv table tr.exports').remove();$('#meetingClassification.exports option:first-child').attr('selected','selected');$('#meetingClassification.exports').removeClass('exports').niceSelect();$('#regionDesignation.exports,#regionName.exports,#startTimeTop.exports,#endTimeTop.exports,#calculationSession.exports,#trainOfNum.exports,#workerNum.exports,#approvaNum.exports,#chargeStandard.exports').val('').removeClass('exports');var predictSum=0;$("#predictCostTable tbody tr:not(.last)").each(function(){var thisObj=$(this);predictSum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#predictCostTable .costTotal").text($yt_baseElement.fmMoney(predictSum));var lectureSum=0;$("#lectureFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);lectureSum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#lectureFeeTable .costTotal").text($yt_baseElement.fmMoney(lectureSum));$("#lectureFeeTable .costTotal-after").text($yt_baseElement.fmMoney(lectureSum));var hotelSum=0;$("#hotelFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);hotelSum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#hotelFeeTable .costTotal").text($yt_baseElement.fmMoney(hotelSum));var dietSum=0;$("#dietFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);dietSum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#dietFeeTable .costTotal").text($yt_baseElement.fmMoney(dietSum));var carSum=0;$("#carFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);carSum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#carFeeTable .costTotal").text($yt_baseElement.fmMoney(carSum));var totalAmount=0;$('#trainingFeeTable tbody .smallplan-money').each(function(){totalAmount+=$yt_baseElement.rmoney($(this).text())});$('#trainingFeeTable tbody .costTotal').text($yt_baseElement.fmMoney(totalAmount));personnelFunds.updateTotalNum()},showImportFun:function(){var me=this;$('#trainDetails').click(function(){var thisBtn=$(this);thisBtn.attr("disabled",true);var list=me.beforeCostList.costData.trainApplyInfoList;me.setTrainApplyInfoList(list,true)});$('#exportLecturer').click(function(){var thisBtn=$(this);thisBtn.attr("disabled",true);var list=me.beforeCostList.costData.teacherApplyInfoList;me.setTeacherApplyInfoList(list,true)});$('#exportCostApp').click(function(){var thisBtn=$(this);thisBtn.attr("disabled",true);var data=me.beforeCostList.costData;me.setCostTeachersFoodApplyInfoList(data.costTeachersFoodApplyInfoList,true);me.setCostTeachersLectureApplyInfoList(data.costTeachersLectureApplyInfoList,true);me.setCostTeachersTravelApplyInfoList(data.costTeachersTravelApplyInfoList,true);me.setCostTeachersHotelApplyInfoList(data.costTeachersHotelApplyInfoList,true);personnelFunds.updateTotalNum()});$('#exportPredictCost').click(function(){var thisBtn=$(this);thisBtn.attr("disabled",true);var data=me.beforeCostList.costData;me.setCostPredictInfoList(data.costPredictInfoList,true);personnelFunds.updateTotalNum()});$('#importTrainingOther').click(function(){var thisBtn=$(this);thisBtn.attr("disabled",true);var data=me.beforeCostList.costData;me.setCostTrainApplyInfoList(data.costTrainApplyInfoList,true);personnelFunds.updateTotalNum()})},uploadFile:function(){$(".file-up-div").off().on('change','.cont-file',function(obj){var fileElementId=this.id;var ithisParent=$('#attIdStr');var url=$yt_option.base_path+"/fileUpDownload/upload?ajax=1&modelCode=REIM_APP";var imgUlr='';$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:fileElementId,success:function(data,textStatus){if(data.flag==0){var attaElement=$('<div fId="'+data.data.pkId+'" class="li-div"><span>'+data.data.naming+'</span><span class="del-file">x</span></div>');ithisParent.append(attaElement);$('#'+fileElementId).val('')}else{$yt_alert_Model.prompt(data.message)}},error:function(data,status,e){$yt_alert_Model.prompt(data.message)}})})},getJsonVal:function(){var me=this;var costData=function(){return JSON.stringify({costReceptionistList:me.costReceptionistList(),costDetailsList:me.costDetailsList(),travelRouteList:me.tripPlanList(),costCarfareList:me.carfareList(),costHotelList:me.hotelList(),costOtherList:me.otherList(),costSubsidyList:me.costSubsidyList(),trainApplyInfoList:me.trainApplyInfoList(),teacherApplyInfoList:me.teacherApplyInfoList(),costTrainApplyInfoList:me.costTrainApplyInfoList(),costPredictInfoList:me.costPredictInfoList(),costTeachersFoodApplyInfoList:me.costTeachersFoodApplyInfoList(),costTeachersLectureApplyInfoList:me.costTeachersLectureApplyInfoList(),costTeachersTravelApplyInfoList:me.costTeachersTravelApplyInfoList(),costTeachersHotelApplyInfoList:me.costTeachersHotelApplyInfoList(),costNormalList:me.costNormalList(),meetingList:me.meetingList(),meetingCostList:me.meetingCostList(),projectBudgetList:me.projectBudgetList()})};var getjsons={advanceAppId:$("#advanceAppId").val(),advanceAppNum:$("#advanceAppNum").val(),advanceAppReason:$("#advanceAppReason").val(),costType:'TRAIN_APPLY',doAdvanceAmount:$yt_baseElement.rmoney($("#doAdvanceAmount").text()||'0'),advanceAmount:$yt_baseElement.rmoney($(".count-val-num").text()||'0'),prjName:$('#prjName').val(),applicantUser:$(".applicantUser").val(),parameters:'',dealingWithPeople:$("#approve-users option:selected").val(),opintion:$(".textareaHQ").val(),processInstanceId:$("#processInstanceId").val(),nextCode:$("#operate-flow option:selected").val(),costData:costData(),advanceAttIdStr:me.getFileList()};return getjsons},projectBudgetList:function(){var list=[];$.each($('#lectureFeeTable tbody tr'),function(i,n){list.push({costCode:$(n).find('.cost-code').val(),budgetCost:$yt_baseElement.rmoney($(n).find('.budget-cost').val()),accordingInstructions:$(n).find('.accordingInstructions').val()})});$.each($('#trainingFeeTable tbody tr'),function(i,n){list.push({costCode:$(n).find('.cost-code').val(),budgetCost:$yt_baseElement.rmoney($(n).find('.budget-cost').val()),accordingInstructions:$(n).find('.accordingInstructions').val()})});return list},meetingList:function(){var costType=$(".docu-style-box .check input").val();var list=costType=='MEETING_APPLY'?[{meetType:$('#meetingClassification option:selected').val(),meetName:$('#meetName').val(),meetAddress:$('#meetAddress').val(),meetStartTime:$('#startTime').val(),meetEndTime:$('#endTime').val(),meetDays: +$('#calculationSession').text()||'0',meetOfNum:$('#meetOfNum').val(),meetWorkerNum:$('#meetWorkerNum').val(),}]:[];return list},meetingCostList:function(){var costType=$(".docu-style-box .check input").val();var list=costType=='MEETING_APPLY'?[{meetHotel:$yt_baseElement.rmoney($('#meetHotel').val()),meetFood:$yt_baseElement.rmoney($('#meetFood').val()),meetOther:$yt_baseElement.rmoney($('#meetOther').val()),meetAmount:$yt_baseElement.rmoney($('#costTotal').text()),meetAverage:$yt_baseElement.rmoney($('#dailyAverageConsumption').text()),}]:[];return list},getFileList:function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length-1?',':'')});return str},costReceptionistList:function(){var list=[];var trs=$('.msg-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costReceptionistId:tr.attr('pkid'),name:tr.find('.name-text').text(),jobName:tr.find('.job-text').text(),unitName:tr.find('.unit-text').text(),})});return list},costDetailsList:function(){var list=[];var trs=$('#paymentList tbody tr:not(.last)');var tr=null;var setMethod=$('#paymentList').next().find('.check-label.check input').val();$.each(trs,function(i,n){tr=$(n);list.push({publicServiceProCode:tr.attr('budgetcode'),activityDate:tr.find('.act-date').text(),placeName:tr.find('.place-name').text(),costType:tr.attr('costcode'),activityAmount:$yt_baseElement.rmoney(tr.find('.money').text()||'0'),peopleNum:tr.find('.people-num').text(),setMethod:setMethod })});return list},tripPlanList:function(){var list=[];var trs=$('#tripList tbody tr:not(.last)');var tr=null;var setMethod=$('#tripList').next().find('.check-label.check input').val();$.each(trs,function(i,n){tr=$(n);list.push({travelType:tr.attr('busicode'),travelAddress:tr.find('.address').attr('val'),travelAddressName:tr.find('.address').text(),startTime:tr.find('.sdate').text(),endTime:tr.find('.edate').text(),travelPersonnels:tr.attr('usercode'),receptionCostItem:tr.attr('rececode'),setMethod:setMethod })});return list},carfareList:function(){var costCarfareList=[];var costCarfareJson="";var cityDatas;var setMethod=$('#traffic-list-info').next().find('.check-label.check input').val();if($("#traffic-list-info tbody tr:not(.total-last-tr)").length>0){$("#traffic-list-info tbody tr:not(.total-last-tr)").each(function(i,n){cityDatas=$(this).getDatas();cityDatas.crafare=$yt_baseElement.rmoney(cityDatas.crafare);cityDatas.setMethod=setMethod;if($(this).find(".hid-child-code").val()=="null"||$(this).find(".hid-child-code").val()==""){cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."}else{cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."+$(this).find(".hid-child-code").val()+"."}costCarfareList.push(cityDatas)})}return costCarfareList},hotelList:function(){var costHotelList=[];var costHotelJson="";var hotelDatas;var setMethod=$('#hotel-list-info').next().find('.check-label.check input').val();if($("#hotel-list-info tbody tr:not(.total-last-tr)").length>0){$("#hotel-list-info tbody tr:not(.total-last-tr)").each(function(i,n){hotelDatas=$(this).getDatas();hotelDatas.hotelExpense=$yt_baseElement.rmoney(hotelDatas.hotelExpense);hotelDatas.setMethod=setMethod;costHotelList.push(hotelDatas)});if(costHotelList.length>0){costHotelJson=JSON.stringify(costHotelList)}}return costHotelList},otherList:function(){var costOtherList=[];var costOtherJson="";var otherDatas;var setMethod=$('#other-list-info').next().find('.check-label.check input').val();if($("#other-list-info tbody tr:not(.total-last-tr)").length>0){$("#other-list-info tbody tr:not(.total-last-tr)").each(function(i,n){otherDatas=$(this).getDatas();otherDatas.reimAmount=$yt_baseElement.rmoney(otherDatas.reimAmount);otherDatas.setMethod=setMethod;costOtherList.push(otherDatas)});if(costOtherList.length>0){costOtherJson=JSON.stringify(costOtherList)}}return costOtherList},costSubsidyList:function(){var list=[];var trs=$('#subsidy-list-info tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelPersonnel:tr.find('.user').attr('code'),subsidyDays:tr.find('.subsidy-num').text(),subsidyFoodAmount:$yt_baseElement.rmoney(tr.find('.food').text()),carfare:$yt_baseElement.rmoney(tr.find('.traffic').text()),setMethod:''})});return list},trainApplyInfoList:function(){var list=[{trainType:$('.trainType').val(),regionDesignation:$('#regionDesignation option:selected').text(),projectId:$('#regionDesignation').val(),reportTime:$('.reportTime').val(),endTime:$('.endTime').val(),trainDays: +$('#calculationSession').text()||'0',budgetTraineeSum:$('.trainOfNum').val(),reportDate:$("#startTimeTop").val(),outHospitalDate:$("#endTimeTop").val(),isOffSiteTraining:$('.is-off-site-training:checked').val(),offSiteTrainingRequirement:$('.offsite-training-requirement').val(),costStandard:$('.cost-standard:checked').val()}];return list},teacherApplyInfoList:function(){var list=[];var trs=$('#lecturerTable tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val()})});return list},costTrainApplyInfoList:function(){var list=[];var trs=$('#trainingFeeTable tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({trainType:tr.attr('costnameval'),standard:$yt_baseElement.rmoney(tr.find('.standard-money').text()),trainDays:tr.find('.day-num').text(),trainOfNum:tr.find('.people-num').text(),averageMoney:$yt_baseElement.rmoney(tr.find('.smallplan-money').text()),remark:tr.find('.special-instruct').text()})});return list},costPredictInfoList:function(){var list=[];var trs=$('#predictCostTable tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({predictName:tr.find('.cost-name').text(),predictStandardMoney:$yt_baseElement.rmoney(tr.find('.predict-standard-money').text()),predictPeopleNum:tr.find('.predict-people-num').text(),averageMoney:$yt_baseElement.rmoney(tr.find('.predict-smallplan-money').text()),remark:tr.find('.special-instruct').text()})});return list},costTeachersFoodApplyInfoList:function(){var list=[];var trs=$('#dietFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),averageMoney:serveApply.rmoney(tr.find('.avg').text()),foodOfDays:tr.find('.day').text(),foodAmount:serveApply.rmoney(tr.find('.sum-pay').text()),remarks:tr.find('.dec').text()=='无'?'':tr.find('.dec').text(),setMethod:''})});return list},costTeachersLectureApplyInfoList:function(){var list=[];var trs=$('#lectureFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),courseName:tr.find('.cname').text(),teachingHours:tr.find('.hour').text(),perTaxAmount:serveApply.rmoney(tr.find('.sum-pay').text()),afterTaxAmount:serveApply.rmoney(tr.find('.after').text()),averageMoney:serveApply.rmoney(tr.find('.avg').text()),remarks:tr.find('.lectureId').val(),setMethod:''})});return list},costTeachersTravelApplyInfoList:function(){var list=[];var trs=$('#carFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),goTime:tr.find('.sdate').text(),arrivalTime:tr.find('.edate').text(),goAddress:tr.find('.scode').val(),goAddressName:tr.find('.sadd').text(),arrivalAddress:tr.find('.ecode').val(),arrivalAddressName:tr.find('.eadd').text(),vehicle:tr.find('.tool').val(),carfare:serveApply.rmoney(tr.find('.sum-pay').text()),remarks:tr.find('.dec').text()=='无'?'':tr.find('.dec').text(),setMethod:'',})});return list},costTeachersHotelApplyInfoList:function(){var list=[];var trs=$('#hotelFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),startTime:tr.find('.sdate').text(),endTime:tr.find('.edate').text(),hotelDays:tr.find('.day').text(),hotelAddress:'',hotelAddressName:'',hotelExpense:serveApply.rmoney(tr.find('.sum-pay').text()),averageMoney:serveApply.rmoney(tr.find('.avg').text()),remarks:tr.find('.dec').text()=='无'?'':tr.find('.dec').text(),setMethod:''})});return list},costNormalList:function(){var list=[];return list},getPriorApprovalList:function(){var tbody=$('.special-list tbody');var pageDiv=$('.prior-page');$('.prior-page').pageInfo({pageIndex:1,pageNum:1,pageSize:3,url:"sz/travelApp/getUserTravelAppListByParams",objName:'data',data:{},success:function(data){tbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){pageDiv.show();$.each(data.data.rows,function(i,n){trStr+='<tr code="ZX201804011"><td>ZX201804011</td><td>人工智能研发</td><td>10,000.00万元</td><td>8,500.00万元</td></tr>'});tbody.append(trStr)}else{pageDiv.hide();var noTr='<tr class="model-no-data-tr"><td colspan="2"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';tbody.append(noTr)}}}})},appendPaymentList:function(tr){var me=this;var budgetProject=$('#budgetProject option:selected').text();var budgetCode=$('#budgetProject option:selected').val();var budgetdata=$('#txtDate').val();var budgetchang=$('#place').val();var budgetfei=$('#costBreakdown option:selected').text();var budgetfeiCode=$('#costBreakdown option:selected').val();var budgetbiao=$('#bzy-span').val();var budgetMoney=$('#budgetMoney').val();var numMoney=$yt_baseElement.rmoney(budgetMoney);var budgetpeople=$('#peoplenum').val();var BMoney='';var html='<tr Tcode="'+budgetfeiCode+'" Pcode="'+budgetCode+'" budgetProject="'+budgetProject+'" txtDate="'+budgetdata+'" place="'+budgetchang+'" costBreakdown= "'+budgetfei+'" bzy-span="'+BMoney+'" budgetMoney="'+numMoney+'" peoplenum="'+budgetpeople+'"> <td >'+budgetProject+'</td><td class="activityDate">'+budgetdata+'</td><td class="placeName">'+budgetchang+'</td> <td>'+budgetfei+'</td><td style="text-align: right;" class="money" money='+numMoney+'>'+budgetMoney+'</td> <td class="peopleNum">'+budgetpeople+'</td> <td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td> </tr>';var isNull=$yt_valid.validForm($("#AddAppDetails"));if(isNull){if(tr){tr.replaceWith(html);me.hidePaymentAlert()}else{$('#paymentList tbody .last').before(html)}me.clearAlert($('#createExpense'));var tds=$('#paymentList tbody .money');var total=0;$.each(tds,function(i,n){total+= +$(n).attr('money')});var fmTotal=$yt_baseElement.fmMoney(total);$('#paymentList tbody .total-money').text(fmTotal);$('.count-val-num').text(fmTotal);console.log(fmTotal);$('.count-val').text(arabiaToChinese(fmTotal+''))}},showPaymentAlert:function(){$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#createExpense'));$('#pop-modle-alert').show();$('#createExpense').show()},showMsgAlert:function(){$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#createDetali'));$('#pop-modle-alert').show();$('#createDetali').show()},appendMsgList:function(tr,objId){var me=this;var applyName=$('#applyName').val();var Unit=$('#Unit').val();var Duties=$('#Duties').val();if(tr){tr.replaceWith('<tr pkId="'+objId+'" applyName="'+applyName+'" Duties="'+Duties+'" Unit="'+Unit+'"> <td class="order-number">1</td> <td class="name" style="width: 100px;">'+applyName+'</td> <td class="jobName" style="width: 100px;">'+Duties+'</td> <td class="DutiesName" style="text-align: left;">'+Unit+'</td> <td><span class="receive-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="receive-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td> </tr>');me.hideMsgAlert()}else{$('#targetList tbody').append('<tr pkId="" applyName="'+applyName+'" Duties="'+Duties+'" Unit="'+Unit+'"> <td class="order-number">1</td> <td class="name" style="width: 100px;">'+applyName+'</td> <td class="jobName" style="width: 100px;">'+Duties+'</td> <td class="DutiesName" style="text-align: left;">'+Unit+'</td> <td><span class="receive-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="receive-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td> </tr>')}me.clearAlert($('.create-detali'));me.resetNum($('.msg-list'))},hideMsgAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#createDetali').hide();$('#pop-modle-alert').hide()},hidePaymentAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#createExpense').hide();$('#pop-modle-alert').hide()},clearAlert:function(obj){var selects=obj.find('select');$.each(selects,function(i,n){$(n).find('option:first-child').attr('selected',true)});selects.niceSelect();var inputs=obj.find('input:not(input[type="radio"],input[type="checkbox"])');inputs.val('');var radios=obj.find('input[type="radio"]');$.each(radios,function(i,n){$(n).setRadioState('uncheck')});var checks=obj.find('input[type="checkbox"]');$.each(checks,function(i,n){$(n).setCheckBoxState('uncheck')});var textareas=obj.find('textarea')},submitAdvanceAppInfo:function(d,thisBtn){var me=this;$.ajax({type:"post",url:"sz/advanceApp/submitAdvanceAppInfo",async:true,data:d,success:function(data){if(data.flag==0){d.appId=data.data;me.submitWorkFlow(d,thisBtn)}else{me.setSubmitEvent()}}})},submitWorkFlow:function(d,thisBtn){var me=this;$.ajax({type:"post",url:"sz/advanceApp/submitWorkFlow",async:true,data:d,success:function(data){if(data.flag==0){var menUrl='view/projectManagement-sasac/expensesReim/module/approval/myApplyList.html';if(window.frames.length==parent.frames.length){$yt_baseElement.openNewPage(1,menUrl,menUrl);window.close()}else{$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:menUrl }})}}else{me.setSubmitEvent()}thisBtn.attr('disabled',false).removeClass('btn-disabled');$yt_alert_Model.prompt(data.message)}})},saveAdvanceAppInfoToDrafts:function(d,thisBtn){var me=this;$.ajax({type:"post",url:"sz/advanceApp/saveAdvanceAppInfoToDrafts",data:d,success:function(data){if(data.flag==0){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/projectManagement-sasac/expensesReim/module/approval/draftsList.html'}})}else{me.setSaveEvent()}$yt_alert_Model.prompt(data.message)}})},getAdvanceAppInfoDetailByAdvanceAppId:function(advanceAppId){$.ajax({type:"post",url:" sz/advanceApp/getAdvanceAppInfoDetailByAdvanceAppId",async:true,data:{advanceAppId:advanceAppId},success:function(data){var d=data.data;if(d.taskKey=='activitiStartTask'){$('#saveask').remove()}serveApply.setformdata(d);var afterTaxAllMoney=$yt_baseElement.rmoney($("#predictCostTable .costTotal").text());var vatSalesTax=afterTaxAllMoney*0.03;$("#vatSalesTax").text($yt_baseElement.fmMoney(vatSalesTax||'0')).attr('num',vatSalesTax);var surtax=vatSalesTax*0.12;$("#surtax").text($yt_baseElement.fmMoney(surtax||'0')).attr('num',surtax)}})},getCostTypeList:function(code){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByFormCode",async:true,data:{formAppCode:'ADVANCE_APP'},success:function(data){var list=data.data||[];var opts='';$.each(list,function(i,n){if(n.costCode=='TRAIN_APPLY'){opts+='<span >'+n.costName+'</span>'}});$('.docu-style-box').append(opts)}})},getCostActivityPro:function(){},getSpectificCostType:function(){},setformdata:function(d){var me=this;var fmMoney=$yt_baseElement.fmMoney;if(d.jsFun){if(d.jsFun=='showTrainFun'){me[d.jsFun]('',d.costData.trainApplyInfoList[0].projectId)}else{me[d.jsFun]()}$('.label-title.item .title-text').text('事前申请事项信息');$('.label-title.cost .title-text').text('事前申请费用信息')}$('#advanceAppId').val(d.advanceAppId);$('#form-num').text(d.advanceAppNum);$('#advanceAppNum').val(d.advanceAppNum);$('#advanceAppReason').val(d.advanceAppName);me.getCostTypeList(d.advanceCostType);if(d.costData.costPredictInfoList){var afterTaxAllMoney='0';if(d.costData.costPredictInfoList.length>0){afterTaxAllMoney=$yt_baseElement.rmoney(d.costData.costPredictInfoList[0].averageMoney);$("#afterTaxAllMoney").text($yt_baseElement.fmMoney(afterTaxAllMoney||'0')).attr('num',afterTaxAllMoney)}else{$("#afterTaxAllMoney").text(afterTaxAllMoney).attr('num',afterTaxAllMoney)}var preTaxAllMoney=afterTaxAllMoney*1.03;$("#preTaxAllMoney").text($yt_baseElement.fmMoney(preTaxAllMoney||'0')).attr('num',preTaxAllMoney)}$('.count-val-num').text(fmMoney(d.advanceAmount||'0')).attr('num',d.advanceAmount);$('#TotalMoneyUpper').text(arabiaToChinese(d.advanceAmount+''));$('#doAdvanceAmount').text(fmMoney(d.doAdvanceAmount||'0'));$('#busiUsers').text(d.applicantUserName);$('#deptName').text(d.deptName);$('#jobName').text(d.positionName==""?"--":d.positionName);$('#telPhone').text(d.applicantUserPhone==""?"--":d.applicantUserPhone);$('#fuData').text(d.applicantTime);$('#operate-flow option[value="'+d.nodeNowState+'"]').attr('selected',true);$('#processInstanceId').val(d.processInstanceId);$('#approve-users option[value="'+d.currentAssignee+'"]').attr('selected',true);$('#operate-flow,#approve-users').niceSelect();$('#taxAmount').text(fmMoney(d.taxAmount));me.showFileList(d.attList);me.showCostDetail(d.costData)},showFileList:function(list){var ls='';$.each(list,function(i,n){ls+='<div fId="'+n.attId+'" class="li-div"><span>'+n.attName+'</span><span class="del-file">x</span></div>'});$('#attIdStr').html(ls)},resetNum:function(obj){var trs=obj.find('tbody tr');$.each(trs,function(i,n){$(n).find('.order-number').text(i+1)})},showCostDetail:function(data){var me=this;var costReceptionistList=data.costReceptionistList;me.setCostReceptionistList(costReceptionistList);var costDetailsList=data.costDetailsList;me.setCostDetailsList(costDetailsList);var tripPlanList=data.travelRouteList;me.setTravelRouteList(tripPlanList);var costCarfareList=data.costCarfareList;me.setCostCarfareList(costCarfareList);var costHotelList=data.costHotelList;me.setCostHotelList(costHotelList);var costOtherList=data.costOtherList;me.setCostOtherList(costOtherList);var costSubsidyList=data.costSubsidyList;me.setCostSubsidyList(costSubsidyList);me.setTrainApplyInfoList(data.trainApplyInfoList);me.setCostList(data.projectBudgetList);me.setTeacherApplyInfoList(data.teacherApplyInfoList);me.setCostTrainApplyInfoList(data.costTrainApplyInfoList);me.setCostPredictInfoList(data.costPredictInfoList);me.setCostTeachersFoodApplyInfoList(data.costTeachersFoodApplyInfoList);me.setCostTeachersLectureApplyInfoList(data.costTeachersLectureApplyInfoList);me.setCostTeachersTravelApplyInfoList(data.costTeachersTravelApplyInfoList);me.setCostTeachersHotelApplyInfoList(data.costTeachersHotelApplyInfoList);me.setCostNormalList(data.costNormalList);me.setMeetingList(data.meetingList);me.setMeetingCostList(data.meetingCostList)},showBusinessFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/hospitalitySpending.html');$('.advance-relevance').hide();$('#tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num').text('0.00');$('#TotalMoneyUpper').text('--');$('#doAdvanceBox').hide()},showGeneralFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$("#targetList tbody").empty();$("#paymentList tbody tr:not(.last)").remove();$('#tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num').text('0.00');$('#TotalMoneyUpper').text('--');$('#doAdvanceBox').hide()},showTravelFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();$('.index-main-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/travelSpending.html');$('.advance-relevance').hide();$("#targetList tbody").empty();$("#paymentList tbody tr:not(.last)").remove();$('.count-val-num').text('0.00');$('#TotalMoneyUpper').text('--');$('#doAdvanceBox').hide()},showTrainFun:function(code,projectId){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();$('.index-main-div').show();var id='';if(projectId){id='?projectId='+projectId}sysCommon.loadingWord('view/projectManagement-sasac/expensesReim/module/beforehand/trainingFeeApply.html'+id);$("#targetList tbody").empty();$("#paymentList tbody tr:not(.last)").remove();$('#tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num').text('0.00');$('#TotalMoneyUpper').text('--');$('#doAdvanceBox').show();serveApply.getTrainingTypeOption(code)},showMettingFun:function(){$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/beforehand/meetingCostApply.html');$('#doAdvanceBox').hide();serveApply.getMeetingTypeCode()},costApplyAlertEvent:function(){var me=this;$("#modelBusiUser").off().on("click",function(){$("#busiUserInfo").show();if(!$("#busiUserInfo").hasClass("check")){me.getBusiTripUsersList($("#userPram").val())}me.busiTripUserModelEvent($("#modelBusiUser"),$("#busiPlanEditModel .auto-font"),$(".model-user-num-show"),1)});$('#tripAddBtn').click(function(){me.showTripAlert();$('#planSaveBtn').off().on('click',function(){me.appendTripList()})});$('#tripList').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();var trs=$('#tripList tbody tr');if(trs.length<=0){$('#traffic-list-info tbody').empty();$('#hotel-list-info tbody').empty();$('#other-list-info tbody').empty();$('#subsidy-list-info tbody').empty()}else{me.setSubsidyList()}}})});$('#subsidy-list-info').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();me.setSubsidyTotal();me.updateMoneySum()}})});$('#tripList').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');me.setTripAlertData(tr);me.showTripAlert();$('#planSaveBtn').off().on('click',function(){me.appendTripList(tr)})});$('#planCanelBtn').click(function(){me.hideTripAlert();$("#busiUserInfo ul li").removeClass("tr-check");$("#busiUserInfo").removeClass("check");$("#tdStartDate,#tdEndDate,#modelBusiUser,#modelBusiAddres,#busiPlanEditModel .model-busi-addres").removeClass("valid-hint");$("#busiPlanEditModel .valid-font").text("");me.selUsersName="";me.selUsersCode="";me.clearAlert($('#busiPlanEditModel'));me.getPlanBusiAddress($("#modelBusiAddres"));me.clearUser()});$('#addCostApplyBtn').click(function(){me.showCostApplyAlert();$('#modelSureBtn').off().on('click',function(){var tabFlag=$(".cost-type-tab li.tab-check .hid-tab").val();var validModel="";if(tabFlag==0){validModel=$(".traffic-form")}else if(tabFlag==1){validModel=$(".hotel-form")}else if(tabFlag==2){validModel=$(".other-form")}var validFlag=$yt_valid.validForm(validModel);if(validFlag){me.appendCostApplyList(tabFlag)}})});$("#addres-icon").off().on("click",function(){var startCity=$("#fromcity option:selected");var endCity=$("#tocity option:selected");$("#tocity").html(startCity);$("#fromcity").html(endCity);me.getPlanBusiAddress($("#tocity"));me.getPlanBusiAddress($("#fromcity"))});$(".yt-spin").click(function(){var hotelDay=$(".hotel-form .yt-numberInput").val();if(hotelDay<1){hotelDay=$(".hotel-form .yt-numberInput").val(1)}var hotelMoney=$(".cost-detail-money").val();if(hotelDay>0&&hotelMoney!=""){$("#peoDayMoney").html($yt_baseElement.fmMoney(($yt_baseElement.rmoney(hotelMoney))/hotelDay))}});$(".yt-numberInput").on("blur",function(){var hotelMoney=$(".cost-detail-money").val();if($(this).val()>0&&hotelMoney!=""){$("#peoDayMoney").html($yt_baseElement.fmMoney(hotelMoney/$(this).val()))}});$(".city-cost-input,.cost-detail-money").on("focus",function(){if($(this).val()!=""&&$(this).val()!=null){$(this).val($yt_baseElement.rmoney($(this).val()));$(this).select()}});$(".city-cost-input,.cost-detail-money").on("blur",function(){var val=$yt_baseElement.rmoney($(this).val()||'0');if($(this).hasClass("cost-detail-money")){if($(this).val()!=""){var hotelDay=$(".hotel-form .hotel-num").text();if(hotelDay==0){$("#peoDayMoney").html($yt_baseElement.fmMoney(val))}else{$("#peoDayMoney").html($yt_baseElement.fmMoney(val/hotelDay))}}}});$('#traffic-list-info,#hotel-list-info,#other-list-info').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');var table=ithis.parents('table');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();if(table.find('tbody tr:not(.total-last-tr)').length<=0){var cols=table.find('thead tr th').length;var noDataTr='<tr class="not-date-tr"><td colspan="'+cols+'"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';table.find('tbody').html('')}me.updateMoneySum(0);me.updateMoneySum(1);me.updateMoneySum(2);me.updateApplyMeonySum()}})});$('#traffic-list-info,#hotel-list-info,#other-list-info').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');me.showCostApplyAlert();me.setFormInfo(tr);var costType=tr.find(".hid-cost-type").val();$(".cost-type-tab ul li").removeClass("tab-check");$('.cost-type-tab ul li input[value="'+costType+'"]').parent().addClass("tab-check");if(costType==0){$(".traffic-form").show();$(".traffic-form .risk-img").attr("src",me.riskViaImg)}if(costType==1){$(".hotel-form").show();$(".traffic-form").hide();$(".hotel-form .risk-img").attr("src",me.riskViaImg)}if(costType==2){$(".other-form").show();$(".traffic-form").hide();$(".other-form .risk-img").attr("src",me.riskViaImg)}$('#modelSureBtn').off().on('click',function(){me.appendCostApplyList(costType,tr)})});$('#modelCanelBtn').click(function(){$('#fromcity,#tocity,#hotelParentAddress,#hotelTwoAddres,#hotelChildAddres').html('<option value="">请选择</option>');me.hideCostApplyAlert();me.clearFormData()});$('#subsidy-list-info').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');me.showSubsidiesAlert();$('#subsidyBusinUser').text(tr.find('.user').text());$('#subsidyBusinLevel').text(tr.find('.lv').text());$('#subsidiesDays').val(tr.find('.subsidy-num').text());$('#subsidiesFood').val(tr.find('.food').text());$('#subsidiesTraffic').val(tr.find('.traffic').text());$('#subsidiesCommon').off().on('click',function(){me.appendSubdisyList(tr)}).text('确定')});$('#subsidiesCancel').click(function(){me.hideSubsidiesAlert();me.clearAlert($('#subdisyInfoAlert'))})},showSubsidiesAlert:function(){var me=this;var alert=$('#subdisyInfoAlert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideSubsidiesAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#subdisyInfoAlert').hide();$('#pop-modle-alert').hide()},appendSubdisyList:function(tr){var me=this;var subsidyBusinUser=$('#subsidyBusinUser').text();var subsidyBusinLevel=$('#subsidyBusinLevel').text();var subsidiesDays=$('#subsidiesDays').val();var subsidiesFood=$('#subsidiesFood').val();var subsidiesTraffic=$('#subsidiesTraffic').val();tr.find('.subsidy-num').text(subsidiesDays);tr.find('.food').text(subsidiesFood);tr.find('.traffic').text(subsidiesTraffic);me.setSubsidyTotal();me.updateMoneySum();me.hideSubsidiesAlert()},showTripAlert:function(){var me=this;var alert=$('#busiPlanEditModel');me.getPlanBusiAddress($('#modelBusiAddres'));$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideTripAlert:function(){$('#modelBusiAddres').html('<option value="">请选择</option>');$yt_baseElement.hideMongoliaLayer();$('#busiPlanEditModel').hide();$('#pop-modle-alert').hide()},getBusiTripUsersList:function(keyword){var me=this;$.ajax({type:"post",url:'user/userInfo/getAllUserInfoToPage',async:true,data:{params:keyword,pageIndex:1,pageNum:99999},success:function(data){if(data.flag==0){$("#busiUserInfo ul").empty();var liStr="";if(data.data.rows.length>0){$.each(data.data.rows,function(i,n){liStr=$('<li>'+n.userName+'/'+n.deptName+'</li>');liStr.data("userData",n);$("#busiUserInfo ul").append(liStr)});if($("#modelUserCodes").val()!=""){var usersCodes=$("#modelUserCodes").val().split(",");$("#busiUserInfo ul li").each(function(i,t){$.each(usersCodes,function(i,l){if($(t).data("userData").userItcode==l){$(t).addClass("tr-check")}})})}me.busiTripUserModelEvent($("#modelBusiUser"),$("#busiPlanEditModel .auto-font"),$(".model-user-num-show"),1)}else{$("#busiUserInfo ul").append('<li style="text-align: center;">暂无数据</li>')}}}})},busiTripUserModelEvent:function(busiInputObj,autoFontObj,userNumObj,clickFlag){var me=this;var busiTripUserModel=$("#busiTripUserModel");$("#searchUser").off().on("click",function(){me.getBusiTripUsersList($("#userPram").val())});$("#userPram").on("keyup",function(){me.getBusiTripUsersList($(this).val())});$("#busiUserInfo ul li").off("click").on("click",function(){var usersDatas="";if($(this).hasClass("tr-check")){$(this).removeClass("tr-check");me.selUsersName="";me.selUsersCode="";$("#busiUserInfo ul li.tr-check").each(function(i,n){usersDatas=$(this).data("userData");me.selUsersName+=usersDatas.userName+"、";me.selUsersCode+=usersDatas.userItcode+","})}else{$(this).addClass("tr-check");usersDatas=$(this).data("userData");me.selUsersName+=usersDatas.userName+"、";me.selUsersCode+=usersDatas.userItcode+",";var checkUsersCodes="";$("#tripList tbody .hid-user-code").each(function(){checkUsersCodes+=$(this).val()+","});var selUsersCode=","+usersDatas.userItcode+",";if(checkUsersCodes!=""&&checkUsersCodes!=undefined){checkUsersCodes=","+checkUsersCodes}if(checkUsersCodes.indexOf(selUsersCode)<0){var userLevel=usersDatas.jobLevelName=="--"?"":usersDatas.jobLevelName;me.usersInfoList=me.usersInfoList+'{"userItcode":"'+usersDatas.userItcode+'","jobLevelName":"'+usersDatas.jobLevelName+'","userName":"'+usersDatas.userName+'"},'}}var selTr=$("#busiUserInfo ul li.tr-check");if(selTr!=""&&selTr.length>0){var selUser="";var userCode="";selUser=me.selUsersName.substring(0,me.selUsersName.length-1);userCode=me.selUsersCode.substring(0,me.selUsersCode.length-1);$(busiInputObj).val(selUser);$(busiInputObj).prev("input[type=hidden]").val(userCode);$(autoFontObj).hide();$(userNumObj).show();var userNums=selUser.split("、");$(userNumObj).find(".users-num").text(userNums.length);sysCommon.clearValidInfo(busiInputObj);$("#clearUser").show()}else{$(busiInputObj).val('');$(busiInputObj).prev("input[type=hidden]").val('');$(autoFontObj).show();$(userNumObj).hide();$(userNumObj).find(".users-num").text(0);$(busiInputObj).next(".valid-font").text("请选择出差人");$(busiInputObj).addClass("valid-hint");me.selUsersName="";me.selUsersCode="";me.usersInfoList="";me.usersInfoJson="";var optionText='<option value="">请选择</option>';$("#clearUser").hide()}});$("#clearUser").click(function(){$("#modelBusiUser").val('');$("#modelBusiUser").prev("input[type=hidden]").val('');$(".model-user-num-show").find(".users-num").text(0);$("#modelBusiUser").next(".valid-font").text("请选择出差人");$("#modelBusiUser").addClass("valid-hint");me.selUsersName="";me.selUsersCode="";me.usersInfoList="";me.usersInfoJson="";var optionText='<option value="">请选择</option>';$("#busiUserInfo ul li").removeClass("tr-check");me.clearUser()});$("#busiUserInfo").mouseleave(function(){$(this).hide();$(this).addClass("check")})},clearUser:function(){$("#busiPlanEditModel .auto-font").show();$(".model-user-num-show").hide()},appendTripList:function(tr){var me=this;var planModel=$("#busiPlanEditModel");var modelBusiType=$('#modelBusiType option:selected');var name=modelBusiType.text();var code=modelBusiType.val();var tdStartDate=$('#tdStartDate').val();var tdEndDate=$('#tdEndDate').val();var dateFrom=new Date(tdStartDate);var dateTo=new Date(tdEndDate);var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24));var day=diff_day+1;var modelBusiAddres=$('#modelBusiAddres option:selected').val();var budiAddName=$('#modelBusiAddres option:selected').text();var busiUsersName=$("#modelBusiUser").val();var busiUsersCode=$("#modelUserCodes").val();var busiNum=$(".model-user-num-show .users-num").text();var receptionMoney="";var receptionMoneyCode="";if(planModel.find(".check-label.check").length>0){planModel.find(".check-label.check").each(function(i,n){receptionMoney+=$(n).find("span").text()+"、";receptionMoneyCode+=$(n).find("input").val()+","});receptionMoney=receptionMoney.substring(0,receptionMoney.length-1);receptionMoneyCode=receptionMoneyCode.substring(0,receptionMoneyCode.length-1)}else{receptionMoney="--"}var html='<tr busicode="'+code+'" usercode="'+busiUsersCode+'" rececode="'+receptionMoneyCode+'" ><td><input type="hidden" class="hid-user-code" value="'+busiUsersCode+'" /> <span class="name">'+name+'</span></td><td class="sdate">'+tdStartDate+'</td><td class="edate">'+tdEndDate+'</td><td class="day">'+day+'</td><td class="address" val="'+modelBusiAddres+'">'+budiAddName+'</td><td class="uname">'+busiUsersName+'</td><td class="numof">'+busiNum+'</td><td class="reception">'+receptionMoney+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del" style=""><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if($yt_valid.validForm($('#busiPlanEditModel'))){if(tr){tr.replaceWith(html);me.hideTripAlert()}else{$('#tripList tbody').append(html)}me.clearUser();$("#busiUserInfo ul li").removeClass("tr-check");$("#busiUserInfo").removeClass("check");me.selUsersName="";me.selUsersCode="";me.clearAlert($('#busiPlanEditModel'));me.getPlanBusiAddress($("#modelBusiAddres"));me.setSubsidyList()}},setTripAlertData:function(tr){var me=this;var planModel=$("#busiPlanEditModel");var modelBusiType=$('#modelBusiType option[value="'+tr.attr('busicode')+'"]').attr('selected',true);$('#modelBusiType').niceSelect();var tdStartDate=$('#tdStartDate').val(tr.find('.sdate').text());var tdEndDate=$('#tdEndDate').val(tr.find('.edate').text());var modelBusiAddres=$('#modelBusiAddres').html('<option value="'+tr.find('.address').attr('val')+'">'+tr.find('.address').text()+'</option>');var busiUsersName=$("#modelBusiUser").val(tr.find('.uname').text());var busiUsersCode=$("#modelUserCodes").val(tr.attr('usercode'));var busiNum=$(".model-user-num-show .users-num").text(tr.find('.numof').text());var rececode=tr.attr('rececode');var receList=rececode.split(',');$.each(receList,function(i,n){if(n){planModel.find('.check-label input[value="'+n+'"]').setCheckBoxState('check')}});me.getPlanBusiAddress($("#modelBusiAddres"))},appendCostApplyList:function(tabFlag,tr){var me=this;if(tabFlag==0){me.getTrafficCostFormInfo(tr)}if(tabFlag==1){me.getHotelFormInfo(tr)}if(tabFlag==2){me.getOtherCostFormInfo(tr)}},getTrafficCostFormInfo:function(tr){var me=this;var trabfficObj=$(".traffic-form");sysCommon.createSumTr(0);var tripUser=trabfficObj.find("#model-trip-user option:selected").text();var userCode=trabfficObj.find("#model-trip-user option:selected").val();var level=trabfficObj.find("#model-trip-user option:selected").attr("data-level");var trafficStartTime=$('#traffic-start-time').val();var trafficEndTime=$('#traffic-end-time').val();var fromcityName=$('#fromcity option:selected').text();var fromcity=$('#fromcity option:selected').val();var tocityName=$('#tocity option:selected').text();var tocity=$('#tocity option:selected').val();var specialRemark=$('#special-remark').val();var vehicle="";var vehicleCode="";vehicleCode=trabfficObj.find(".vehicle-sel").val();var vehicleChildCode="";vehicleChildCode=trabfficObj.find(".vehicle-two-sel").val();if($(".vehicle-two-sel").val()!=""&&$(".vehicle-two-sel").val()!=null){vehicle=trabfficObj.find(".vehicle-two-sel option:selected").text()}else{vehicle=trabfficObj.find(".vehicle-sel option:selected").text()}var cityMoney=trabfficObj.find(".city-cost-input").val();var trafficCostStr='<tr><td><span>'+tripUser+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+userCode+'"/></td><td>'+level+'</td><td data-text="goTime">'+trafficStartTime+'</td><td><input data-val="goAddress" type="hidden" value="'+fromcity+'"><span data-text="goAddressName">'+fromcityName+'</span></td><td data-text="arrivalTime">'+trafficEndTime+'</td><td><input data-val="arrivalAddress" type="hidden" value="'+tocity+'"> <span data-text="arrivalAddressName">'+tocityName+'</span></td><td><span data-text="vehicle">'+vehicle+'</span><input type="hidden" class="hid-vehicle" value="'+vehicleCode+'"/><input type="hidden" class="hid-child-code" value="'+vehicleChildCode+'"/></td><td class="font-right money-td" data-text="crafare">'+(cityMoney==""?"--":cityMoney)+'</td><td class="text-overflow-sty" data-text="remarks" title="'+specialRemark+'">'+(specialRemark==""?"无":specialRemark)+'</td><td><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(trafficCostStr);me.hideCostApplyAlert()}else{$("#traffic-list-info tbody .total-last-tr").before(trafficCostStr)}me.updateMoneySum(0);me.clearFormData();},setFormInfo:function(thisTr){var me=this;var costType=$(thisTr).find(".hid-cost-type").val();if(costType==0){var busiUser=$(thisTr).find("td:eq(0) .hid-traf-users").val();var startDate=$(thisTr).find("td:eq(2)").text();var startAddre=$(thisTr).find("td:eq(3)").text();var startVal=$(thisTr).find("td:eq(3)").attr('val');var endDate=$(thisTr).find("td:eq(4)").text();var endAddre=$(thisTr).find("td:eq(5)").text();var endVal=$(thisTr).find("td:eq(5)").attr('val');var vehicles=0;if($(thisTr).find("td:eq(6) input:eq(0)").val().indexOf(".")!=-1){vehicles=$(thisTr).find("td:eq(6) input:eq(0)").val().split(".")}var vehicle="";var vehicleChildCode="";if(vehicles.length>0){vehicle=vehicles[1];vehicleChildCode=vehicles[2]}else{vehicle=$(thisTr).find("td:eq(6) input:eq(0)").val();vehicleChildCode=$(thisTr).find("td:eq(6) .hid-child-code").val()}var cityMoney=$(thisTr).find("td:eq(7)").text();var cityMsg=$(thisTr).find("td:eq(8)").text();$('#model-trip-user option[value="'+busiUser+'"]').attr("selected",true);$("#traffic-start-time").val(startDate);$("#traffic-end-time").val(endDate);$("#fromcity").html('<option value="'+startVal+'">'+startAddre+'</option>');$("#tocity").html('<option value="'+endVal+'">'+endAddre+'</option>');$('.traffic-form .vehicle-sel option[value="'+vehicle+'"]').attr("selected","selected");if(vehicleChildCode!=""){$("#vehicleTwoDiv").css('display','inline-block');sysCommon.vechicleChildData(vehicle);$('.traffic-form .vehicle-two-sel option[value="'+vehicleChildCode+'"]').attr("selected","selected")}$(".traffic-form .city-cost-input").val(cityMoney);$("#special-remark").val((cityMsg=="--"?"":cityMsg));$('#model-trip-user,.traffic-form .vehicle-sel,.traffic-form .vehicle-two-sel').niceSelect();me.getPlanBusiAddress($("#fromcity"));me.getPlanBusiAddress($("#tocity"));if(vehicle!=""||vehicleChildCode!=""){$(".vehicle-sel").parents("td").find(".risk-img").attr("src",me.riskViaImg)}}if(costType==1){var busiUser=$(thisTr).find("td:eq(0) input").val();var dayMoney=$(thisTr).find("td:eq(2)").text();var hotelDay=$(thisTr).find("td:eq(5)").text();var hotelMoney=$(thisTr).find("td:eq(6)").text();var hotelAddress=$(thisTr).find("td:eq(7) input").val();var sDate=$(thisTr).find('.sdate').text();$('.hotel-form #hotelDate').val(sDate);var eDate=$(thisTr).find('.edate').text();$('.hotel-form #leaveDate').val(eDate);hotelAddress=hotelAddress.split("-");var hotelAddressName=$(thisTr).find('td:eq(7) span').text().split('-');var textareMsg=$(thisTr).find("td:eq(8)").text();$('#hotel-trip-user').val(busiUser);$(".hotel-form .hotel-num").text(hotelDay);if(hotelAddress.length==3){$('#hotelParentAddress').html('<option value="'+hotelAddress[0]+'">'+hotelAddressName[0]+'</option>');$('#hotelTwoAddres').html('<option value="'+hotelAddress[1]+'">'+hotelAddressName[1]+'</option>');$('#hotelChildAddres').html('<option value="'+hotelAddress[2]+'">'+hotelAddressName[2]+'</option>')}else if(hotelAddress.length==2){$('#hotelChildAddres').html('<option value="'+hotelAddress[1]+'">'+hotelAddressName[1]+'</option>')}$(".hotel-form .hotel-money").val(hotelMoney);$("#peoDayMoney").text(dayMoney);$(".hotel-form .hotel-msg").val((textareMsg=="--"?"":textareMsg));me.setAddress();$('#hotel-trip-user').niceSelect();me.hotelChildDisa(hotelAddress[0],"CITY");me.hotelChildDisa(hotelAddress[1],"AREA")}if(costType==2){var costType=$(thisTr).find("td:eq(0) input").val();var costMoney=$(thisTr).find("td:eq(1)").text();var textareMsg=$(thisTr).find("td:eq(2)").text();$('#cost-type option[value="'+costType+'"]').attr("selected","selected");$(".other-form .other-money").val(costMoney);$(".other-form .other-msg").val((textareMsg=="--"?"":textareMsg));$('#cost-type').niceSelect()}},getHotelFormInfo:function(tr){var me=this;var hotelObj=$(".hotel-form");sysCommon.createSumTr(1);var tripUser=hotelObj.find("select.hotel-trip-user-sel option:selected").text();var level=hotelObj.find("select.hotel-trip-user-sel option:selected").attr("data-level");var hotelAddress="";var hotelAdressCode="";var hotelParentAdres=hotelObj.find("#hotelParentAddress option:selected").text();var hotelTwoAdres=hotelObj.find("#hotelTwoAddres option:selected").text();var hotelChildAdres=hotelObj.find("#hotelChildAddres option:selected").text();if(hotelTwoAdres==""||hotelTwoAdres=="请选择"){hotelAddress=hotelParentAdres;hotelAdressCode=hotelObj.find("#hotelParentAddress").val()}else{hotelAddress=hotelParentAdres+"-"+hotelTwoAdres+"-"+hotelChildAdres;hotelAdressCode=hotelObj.find("#hotelParentAddress").val()+"-"+hotelObj.find("#hotelTwoAddres").val()+"-"+hotelObj.find("#hotelChildAddres").val()}var hotelCheckInDate=$("#hotelDate").val();var leaveDate=$("#leaveDate").val();var hotelCostStr='<tr><td><span>'+tripUser+'</span><input type="hidden" data-val="travelPersonnel" value="'+hotelObj.find("select.hotel-trip-user-sel").val()+'"/></td><td>'+level+'</td>'+'<td class="font-right">'+hotelObj.find("#peoDayMoney").text()+'</td><td  risk-code-val="hotelCheckInDate" class="check-in-date"><span data-text="hotelTime" class="sdate">'+hotelCheckInDate+'</span></td><td class="leave-date"><span data-text="leaveTime" class="edate">'+leaveDate+'</span></td><td data-text="hotelDays">'+hotelObj.find(".hotel-num").text()+'</td><td class="font-right money-td" data-text="hotelExpense">'+hotelObj.find(".cost-detail-money").val()+'</td><td><span data-text="hotelAddressName">'+hotelAddress+'</span><input type="hidden" data-val="hotelAddress" value="'+hotelAdressCode+'"</td><td class="text-overflow-sty" data-text="remarks" title="'+hotelObj.find(".hotel-msg").val()+'">'+(hotelObj.find(".hotel-msg").val()==""?"--":hotelObj.find(".hotel-msg").val())+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(hotelCostStr);me.hideCostApplyAlert()}else{$("#hotel-list-info tbody .total-last-tr").before(hotelCostStr)}me.updateMoneySum(1);me.clearFormData();},getOtherCostFormInfo:function(tr){var me=this;var otherObj=$(".other-form");sysCommon.createSumTr(2);var costType=otherObj.find("#cost-type option:selected").text();var otherCostStr='<tr><td><span>'+costType+'</span><input type="hidden" data-val="costType" value="'+otherObj.find("#cost-type").val()+'"/></td><td class="font-right money-td" data-text="reimAmount">'+otherObj.find(".other-money").val()+'</td><td class="text-overflow-sty" data-text="remarks" title="'+otherObj.find(".other-msg").val()+'">'+(otherObj.find(".other-msg").val()==""?"--":otherObj.find(".other-msg").val())+'</td><td><input type="hidden" class="hid-cost-type" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(otherCostStr);me.hideCostApplyAlert()}else{$("#other-list-info tbody .total-last-tr").before(otherCostStr)}me.updateMoneySum(2);me.clearFormData();$("#other-list-info").parent().find(".cost-list-title .risk-img").attr("src",me.riskViaImg)},getModelUsersInfo:function(){var me=this;if(me.usersInfoList!=""&&me.usersInfoList!=null){me.usersInfoJson="["+me.usersInfoList+"]";me.usersInfoJson=me.usersInfoJson.substr(0,me.usersInfoJson.length-2);me.usersInfoJson+="]"}var optionText='<option value="">请选择</option>';$("#model-trip-user,#hotel-trip-user").empty().append(optionText);if(me.usersInfoJson!=""&&me.usersInfoJson.length>0){me.usersInfoJson=eval("("+me.usersInfoJson+")");$.each(me.usersInfoJson,function(i,n){optionText='<option value="'+n.userItcode+'" data-level="'+n.jobLevelName+'">'+n.userName+'</option>';$("#model-trip-user,#hotel-trip-user").append(optionText)})}$("#model-trip-user,#hotel-trip-user").niceSelect()},setModelUsers:function(){var userStr='';var trs=$('#tripList tbody tr');trs.each(function(i,n){var ls=$(n).attr('usercode').split(',');$.each(ls,function(j,m){if(userStr.indexOf(m)<0){userStr+=m+','}})});userStr=(userStr.substring(userStr.length-1)==',')?userStr.substring(0,userStr.length-1):userStr;if(userStr){var userList=sysCommon.getUserAllInfo('',userStr,'');var opts='<option value="">请选择</option>';$.each(userList,function(i,n){opts+='<option value="'+n.userItcode+'" data-level="'+n.jobLevelName+'">'+n.userName+'</option>'});$("#model-trip-user,#hotel-trip-user").html(opts).niceSelect()}},setSubsidyList:function(){var me=this;var userStr='';var trs=$('#tripList tbody tr');trs.each(function(i,n){var ls=$(n).attr('usercode').split(',');$.each(ls,function(j,m){if(userStr.indexOf(m)<0){userStr+=m+','}})});userStr=(userStr.substring(userStr.length-1)==',')?userStr.substring(0,userStr.length-1):userStr;var userList=sysCommon.getUserAllInfo('',userStr,'');var html='';$.each(userList,function(i,n){html+='<tr class="'+n.userItcode+'" code="'+n.userItcode+'"><td><div class="user" code="'+n.userItcode+'">'+n.userName+'</div></td><td><div class="lv">'+n.jobLevelName+'</div></td><td><div class="subsidy-num">0</div></td><td><div style="text-align:right;" class="food">0.00</div></td><td><div  style="text-align:right;" class="traffic">0.00</div></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});html+='<tr class="last"><td>合计</td><td></td><td></td><td class="total-food"  style="text-align:right;">0.00</td><td class="total-traffic"  style="text-align:right;">0.00</td><td></td></tr>';var jqHtml=$(html);var code='',tr=[],jqTr=[],day=0,totalFood=0,totalTraffic=0;$.each(trs,function(i,n){tr=$(n);codeList=tr.attr('usercode').length>0?tr.attr('usercode').split(','):[];day= +tr.find('.day').text();$.each(codeList,function(j,m){jqTr=jqHtml.siblings('[code="'+m+'"]');if(jqTr.length>0){var d= +(jqTr.find('.subsidy-num').text())+day;jqTr.find('.subsidy-num').text(d);jqTr.find('.food').text($yt_baseElement.fmMoney(d*100)).attr('num',d*100);jqTr.find('.traffic').text($yt_baseElement.fmMoney(d*80)).attr('num',d*80)}})});jqHtml.find('.total-food').text($yt_baseElement.fmMoney(totalFood)).attr('num',totalFood);jqHtml.find('.total-traffic').text($yt_baseElement.fmMoney(totalTraffic)).attr('num',totalTraffic);$('#subsidy-list-info tbody').html(jqHtml);me.setSubsidyTotal();me.updateMoneySum()},setSubsidyTotal:function(){var trs=$('#subsidy-list-info tbody tr:not(.last)');var totalFood=0,totalTraffic=0,tr=[];$.each(trs,function(i,n){tr=$(n);totalFood+= +(serveApply.rmoney(tr.find('.food').text()));totalTraffic+= +(serveApply.rmoney(tr.find('.traffic').text()))});$('#subsidy-list-info tbody .total-food').text($yt_baseElement.fmMoney(totalFood)).attr('num',totalFood);$('#subsidy-list-info tbody .total-traffic').text($yt_baseElement.fmMoney(totalTraffic)).attr('num',totalTraffic)},clearFormData:function(){var me=this;var modelObj=$("#costApplyAlert");$(".traffic-form input:not(.hid-risk-code),.hotel-form input:not(.hid-risk-code),.other-form input:not(.hid-risk-code)").val('');modelObj.find("textarea").val('');modelObj.find("select").each(function(i,n){$(n).find("option:eq(0)").attr("selected","selected")});$("#vehicleTwoDiv").hide();modelObj.find("#hotelParentAddress,#hotelTwoAddres,#hotelChildAddres").html('').append('<option value="">请选择</option>');modelObj.find("select").niceSelect();$(".hotel-num").css("color","#999999");modelObj.find(".hotel-num").text("自动计算");modelObj.find(".yt-numberInput").val(1);modelObj.find("#peoDayMoney").text("0.00");modelObj.find("#hotelDay").text("*");$(".cost-type-tab ul li").removeClass("tab-check");$(".cost-type-tab ul li:eq(0)").addClass("tab-check");$(".traffic-form").show();$(".hotel-form,.other-form").hide();$("#model-add-list-btn").show();$("#model-sure-btn").hide();modelObj.find(".risk-img").attr("src",sysCommon.riskExcMark);modelObj.find(".valid-font").text("");modelObj.find(".valid-hint").removeClass("valid-hint");me.setModelUsers();me.setAddress();me.getPlanBusiAddress($("#fromcity"));me.getPlanBusiAddress($("#tocity"))},showCostApplyAlert:function(){var me=this;var alert=$('#costApplyAlert');me.setModelUsers();me.setAddress();me.getPlanBusiAddress($("#fromcity"));me.getPlanBusiAddress($("#tocity"));$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideCostApplyAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#costApplyAlert').hide();$('#pop-modle-alert').hide()},updateMoneySum:function(thisTab){var me=this;var moenySum=0.00;if(thisTab==0){$("#traffic-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#traffic-list-info tbody .money-sum").text(moenySum)}else{$("#traffic-list-info tbody .money-sum").text("0.00")}}if(thisTab==1){$("#hotel-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#hotel-list-info tbody .money-sum").text(moenySum)}else{$("#hotel-list-info tbody .money-sum").text("0.00")}}if(thisTab==2){$("#other-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#other-list-info tbody .money-sum").text(moenySum)}else{$("#other-list-info tbody .money-sum").text("0.00")}}if(thisTab==3){$("#subsidy-list-info tbody .food-money").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#subsidy-list-info tbody .money-sum").text(moenySum)}else{$("#subsidy-list-info tbody .money-sum").text("0.00")}var cityMoneySum=0.00;$("#subsidy-list-info tbody .city-money").each(function(i,n){cityMoneySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});cityMoneySum=$yt_baseElement.fmMoney(cityMoneySum);if(cityMoneySum!=undefined&&$yt_baseElement.rmoney(cityMoneySum)>0){$("#subsidy-list-info tbody .city-money-td").text(cityMoneySum)}else{$("#subsidy-list-info tbody .city-money-td").text("0.00")}}me.updateApplyMeonySum()},updateApplyMeonySum:function(){var sumMoney=0;$(".cost-list-model table .money-sum").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});$(".cost-list-model table .city-money-td").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});$('#subsidy-list-info tbody tr:not(.last)').each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).find('.food').text());sumMoney+=$yt_baseElement.rmoney($(n).find('.traffic').text())});sumMoney=$yt_baseElement.fmMoney(sumMoney);var vatSalesTax=afterTaxAllMoney*0.03;$("#vatSalesTax").text($yt_baseElement.fmMoney(vatSalesTax||'0')).attr('num',vatSalesTax);var surtax=vatSalesTax*0.12;$("#surtax").text($yt_baseElement.fmMoney(surtax||'0')).attr('num',surtax);$("span.count-val-num").text(sumMoney).attr('num',sumMoney);if($("body").find("#reimPrice")){$("#reimPrice").text(sumMoney);var loanPrice=$("#loanCost").text();var replPrice=$yt_baseElement.rmoney(sumMoney)-parseFloat(loanPrice);replPrice=$yt_baseElement.fmMoney(replPrice);$("#givePrice").text(replPrice)}if(sumMoney!=null&&sumMoney!=undefined&&$yt_baseElement.rmoney(sumMoney)>0){var sumMoneyLower=arabiaToChinese(sumMoney+'');$("span.count-val").text(sumMoneyLower)}else{$("span.count-val-num").text("0.00")}},setAddress:function(){var me=this;},setAddressSelect:function(){var me=this;$("#hotelParentAddress").niceSelect({search:true,backFunction:function(text){$("#hotelParentAddress option").remove();if(text==""){$("#hotelParentAddress").append('<option value="">请选择</option>')}$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1&&n.regionLevel=='PROVINCE'){$("#hotelParentAddress").append('<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" >'+n.regionName+'</option>')}})}});$("#hotelParentAddress").on("change",function(){var thisSel=$(this);$("#hotelTwoAddres,#hotelChildAddres").html('').append('<option value="">请选择</option>');me.hotelAddressChild(thisSel.val(),"CITY")});$("#hotelTwoAddres").on("change",function(){var thisSel=$(this);$("#hotelChildAddres").html('').append('<option value="">请选择</option>');me.hotelAddressArea(thisSel.val(),"AREA")});me.getPlanBusiAddress($("#modelBusiAddres"))},hotelChildDisa:function(addressCode,addressLevel){var me=this;if(addressLevel=="CITY"){var disaFlag=true;if($("#hotelTwoAddres option").length<1){$("#hotelTwoAddres,#hotelChildAddres").prop("disabled","disabled");$("#hotelTwoAddres,#hotelChildAddres").removeAttr("validform");sysCommon.clearValidInfo($("div.hotel-child-addres,div.hotel-two-addres,#hotelTwoAddres,#hotelChildAddres"))}else{$("#hotelTwoAddres,#hotelChildAddres").prop("disabled","");$("#hotelTwoAddres").attr("validform","{isNull:true,changeFlag:true,msg:'请选择市'}");$("#hotelChildAddres").attr("validform","{isNull:true,changeFlag:true,msg:'请选择区'}");disaFlag=false}me.hotelAddressChild(addressCode,addressLevel);me.hotelAddressArea(addressCode,addressLevel);if(disaFlag){$("div.hotel-child-addres,div.hotel-two-addres").css("background-color","#D0D0D0")}}else if(addressLevel=="AREA"){var disaFlag=true;if($("#hotelChildAddres option").length<1){$("#hotelChildAddres").prop("disabled","disabled")}else{$("#hotelChildAddres").prop("disabled","");disaFlag=false}me.hotelAddressArea(addressCode,addressLevel);if(disaFlag){$("div.hotel-child-addres").css("background-color","#D0D0D0")}}},hotelAddressChild:function(addressCode,addressLevel){var me=this;$("#hotelTwoAddres").niceSelect({search:true,backFunction:function(text){$("#hotelTwoAddres option").remove();if(text==""){$("#hotelTwoAddres").append('<option value="">请选择</option>')}$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1&&n.parentCode==addressCode&&addressLevel=="CITY"){$("#hotelTwoAddres").append('<option value="'+n.regionCode+'">'+n.regionName+'</option>')}})}});},hotelAddressArea:function(addressCode,addressLevel){var me=this;$("#hotelChildAddres").niceSelect({search:true,backFunction:function(text){$("#hotelChildAddres option").remove();if(text==""){$("#hotelChildAddres").append('<option value="">请选择</option>')}$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1&&n.parentCode==addressCode&&addressLevel=="AREA"){$("#hotelChildAddres").append('<option value="'+n.regionCode+'">'+n.regionName+'</option>')}})}});},getPlanBusiAddress:function(labelObj){var me=this;$(labelObj).niceSelect({search:true,backFunction:function(text){$(labelObj).find("option").remove();var opt='';if(text==""){$.each(me.addressList,function(i,n){if(n.regionLevel=="PROVINCE"){opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'</option>'}})}else{$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1){opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'/'+n.regionMergerName.substr(3)+'</option>'}if(n.regionNamePinYin.indexOf(text)!=-1){opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'/'+n.regionMergerName.substr(3)+'</option>'}})}$(labelObj).append(opt)}});},exportBeforeFiles:function(files){var ls='';$.each(files,function(i,n){ls+='<div fId="'+n.attId+'" class="li-div"><span>'+n.attName+'</span></div>'});$('#attIdStr').append(ls)},setCostReceptionistList:function(costReceptionistList){var me=this;var receHtml='';$.each(costReceptionistList,function(i,n){receHtml+='<tr pkId="'+n.costReceptionistId+'" applyName="'+n.name+'" Duties="'+n.jobName+'" Unit="'+n.unitName+'"> <td class="order-number">1</td> <td class="name" style="width: 100px;">'+n.name+'</td> <td class="jobName" style="width: 100px;">'+n.jobName+'</td> <td class="DutiesName">'+n.unitName+'</td> <td><span class="receive-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="receive-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td> </tr>'});$('.msg-list tbody').append(receHtml);me.resetNum($('.msg-list'))},setCostDetailsList:function(costDetailsList){var detaHtml='';var fmTotal=0;$.each(costDetailsList,function(i,n){fmTotal+= +n.activityAmount;detaHtml+='<tr class="" pkId="'+n.costDetailsId+'" budgetCode="'+n.publicServiceProCode+'" costCode="'+n.costType+'" budgetProject="'+n.publicServiceProName+'" applyDate="'+n.activityDate+'" siteVal="'+n.placeName+'" costBreakdown="'+n.costTypeName+'" standardMoney="'+n.standardAmount+'" budgetMoney="'+n.activityAmount+'" accompanyNum="'+n.peopleNum+'"><td><span class="">'+n.publicServiceProName+'</span></td><td><span class="act-date">'+n.activityDate+'</span></td><td><span class="place-name">'+n.placeName+'</span></td><td><span>'+n.costTypeName+'</span></td>'+'<td style="text-align: right;"><div class="money" money='+n.activityAmount+'>'+$yt_baseElement.fmMoney(n.activityAmount||'0')+'</div></td><td><span class="people-num">'+n.peopleNum+'</span></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#paymentList tbody .last').before(detaHtml);$('#paymentList tbody .total-money').text(serveApply.fmMoney(fmTotal))},setTravelRouteList:function(tripPlanList){var me=this;var tripHtml='';var travelPersonnelsList=[];var getUserNames=function(list){var str='';$.each(list,function(i,n){str+=n.travelPersonnelName+(i<list.length-1?'、':'')});return str};var costItem=function(str){switch(str){case '1':return '住宿费';break;case '2':return '伙食费';break;case '3':return '市内交通费';break;default:return '';break}};var getCostItemName=function(str){var txt='';if(str){var list=str.split(',');$.each(list,function(i,n){if(n){txt+=costItem(n)+(i<list.length-1?'、':'')}});return txt}return ''};var clearRepetitionUser=function(list,str){var checkUsersCodes=me.usersInfoList;var srtList=str.split(',');$.each(srtList,function(i,n){if(checkUsersCodes.indexOf(n)<0){me.usersInfoList=me.usersInfoList+'{"userItcode":"'+n+'","jobLevelName":"'+list[i].travelPersonnelsJobLevelName+'","userName":"'+list[i].travelPersonnelName+'"},'}})};$.each(tripPlanList,function(i,n){var dateFrom=new Date(n.startTime);var dateTo=new Date(n.endTime);var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24))+1;var costItemName=getCostItemName(n.receptionCostItem);tripHtml+='<tr busicode="'+n.travelType+'" usercode="'+n.travelPersonnels+'" rececode="'+(n.receptionCostItem)+'" ><td><input type="hidden" class="hid-user-code" value="'+n.travelPersonnels+'" /> <span class="name">'+n.travelTypeName+'</span></td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="day">'+diff_day+'</td><td class="address" val="'+n.travelAddress+'">'+n.travelAddressName+'</td><td class="uname">'+getUserNames(n.travelPersonnelsList)+'</td><td class="numof">'+n.travelPersonnelsList.length+'</td><td class="reception">'+(costItemName?costItemName:'无')+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';clearRepetitionUser(n.travelPersonnelsList,n.travelPersonnels)});$('#tripList tbody').append(tripHtml);},setCostCarfareList:function(costCarfareList){var carHtml='';var costCarfareClose=$('#traffic-list-info').next().find('.check-label input');var vehicle=[];$.each(costCarfareList,function(i,n){vehicle=n.vehicle.substr(1).substr(0,n.vehicle.length-2).split('.');carHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+n.travelPersonnel+'"/></td><td>'+n.travelPersonnelsDept+'</td><td data-text="goTime">'+n.goTime+'</td><td><input data-val="goAddress" type="hidden" value="'+n.goAddress+'"><span data-text="goAddressName">'+n.goAddressName+'</span></td><td data-text="arrivalTime">'+n.arrivalTime+'</td><td><input data-val="arrivalAddress" type="hidden" value="'+n.arrivalAddress+'"> <span data-text="arrivalAddressName">'+n.arrivalAddressName+'</span></td><td><span data-text="vehicle">'+n.vehicleName+'</span><input type="hidden" class="hid-vehicle" value="'+vehicle[0]+'"/><input type="hidden" class="hid-child-code" value="'+(vehicle.length>1?vehicle[1]:'')+'"/></td><td class="font-right money-td" data-text="crafare">'+(n.crafare==""?"--":serveApply.fmMoney(n.crafare))+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"无":n.remarks)+'</td><td><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costCarfareClose.length>0&&n.setMethod){costCarfareClose.setCheckBoxState('check')}});carHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$('#traffic-list-info tbody').html(carHtml);sysCommon.updateMoneySum(0)},setCostHotelList:function(costHotelList){var hotelHtml='';var costHotelClose=$('#hotel-list-info').next().find('.check-label input');$.each(costHotelList,function(i,n){var avg=n.hotelDays>0?serveApply.fmMoney(+n.hotelExpense/ +n.hotelDays):n.hotelExpense;hotelHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" value="'+n.travelPersonnel+'"/></td><td>'+n.travelPersonnelsJobLevelName+'</td>'+'<td class="font-right">'+avg+'</td><td risk-code-val="hotelCheckInDate" class="check-in-date"><span  data-text="hotelTime" class="sdate">'+n.hotelTime+'</span></td><td class="leave-date"><span data-text="leaveTime" class="edate">'+n.leaveTime+'</span></td><td data-text="hotelDays">'+n.hotelDays+'</td><td class="font-right money-td" data-text="hotelExpense">'+serveApply.fmMoney(n.hotelExpense)+'</td><td><span data-text="hotelAddressName">'+n.hotelAddressName+'</span><input type="hidden" data-val="hotelAddress" value="'+n.hotelAddress+'"</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"无":n.remarks)+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costHotelClose.length>0&&n.setMethod){costHotelClose.setCheckBoxState('check')}});hotelHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td><td></td></tr>';$('#hotel-list-info tbody').html(hotelHtml);sysCommon.updateMoneySum(1)},setCostOtherList:function(costOtherList){var otherHtml='';var costOtherClose=$('#other-list-info').next().find('.check-label input');$.each(costOtherList,function(i,n){otherHtml+='<tr><td><span>'+n.costTypeName+'</span><input type="hidden" data-val="costType" value="'+n.costType+'"/></td><td class="font-right money-td" data-text="reimAmount">'+serveApply.fmMoney(n.reimAmount)+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"无":n.remarks)+'</td><td><input type="hidden" class="hid-cost-type" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costOtherClose.length>0&&n.setMethod){costOtherClose.setCheckBoxState('check')}});otherHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$('#other-list-info tbody').html(otherHtml);sysCommon.updateMoneySum(2)},setCostSubsidyList:function(costSubsidyList){var subHtml='';var totalFood=0;var totalTraffic=0;$.each(costSubsidyList,function(i,n){subHtml+='<tr class="'+n.travelPersonnel+'" code="'+n.travelPersonnel+'"><td><div class="user" code="'+n.travelPersonnel+'">'+n.travelPersonnelName+'</div></td><td><div class="lv">'+n.travelPersonnelsDept+'</div></td><td><div class="subsidy-num">'+n.subsidyDays+'</div></td><td><div style="text-align:right;" class="food">'+serveApply.fmMoney(n.subsidyFoodAmount)+'</div></td><td><div  style="text-align:right;" class="traffic">'+serveApply.fmMoney(n.carfare)+'</div></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';totalFood+= +n.subsidyFoodAmount;totalTraffic+= +n.carfare});subHtml+='<tr class="last"><td>合计</td><td></td><td></td><td class="total-food"  style="text-align:right;">'+serveApply.fmMoney(totalFood)+'</td><td class="total-traffic"  style="text-align:right;">'+serveApply.fmMoney(totalTraffic)+'</td><td></td></tr>';$('#subsidy-list-info tbody').html(subHtml)},setTrainApplyInfoList:function(list,exports){var me=this;var html='';$.each(list,function(i,n){serveApply.getTrainingTypeOption(n.trainType);$('#meetingClassification').niceSelect();$('#regionDesignation').setSelectVal(n.projectId);var data=$('#regionDesignation option:selected').data('data');data.projectTypeName=$yt_baseElement.setProjectTypeName(data.projectType);$('.verify-div').setDatas(data);$('.trainOfNum').val(n.budgetTraineeSum);$('#startTimeTop').val(n.reportDate);$('#endTimeTop').val(n.outHospitalDate);$('.is-off-site-training[value='+n.isOffSiteTraining+']').setRadioState('check');$('.cost-standard[value='+n.costStandard+']').setRadioState('check');$('.offsite-training-requirement').val(n.offSiteTrainingRequirement);if(exports){$('#meetingClassification,#regionDesignation,#regionName,#startTimeTop,#endTimeTop,#calculationSession,#trainOfNum,#workerNum,#approvaNum,#chargeStandard').addClass('exports')}});$('#trainingPopTable tbody').html(html)},setCostList:function(list){var html='';$('#lectureFeeTable tbody').empty();$('#trainingFeeTable tbody').empty();$.each(list,function(i,n){html='<tr><td align="right"><input type="hidden" value="'+n.costCode+'" class="cost-code"><span>'+n.costName+'</span></td><td><input type="text" class="yt-money-input budget-cost" data-val="budgetCost" placeholder="请输入" value="'+$yt_baseElement.fmMoney(n.budgetCost)+'"/></td><td><textarea class="yt-textarea accordingInstructions" style="height:28px;line-height:28px;padding:0 4px;width:95%" data-val="accordingInstructions" placeholder="请输入依据说明">'+n.accordingInstructions+'</textarea></td></tr>';if(n.costType==1){$('#lectureFeeTable tbody').append(html)}if(n.costType==2){$('#trainingFeeTable tbody').append(html)}$('#lectureFeeTable,#trainingFeeTable').find('.yt-textarea').autoHeight();$('#lectureFeeTable,#trainingFeeTable').off('blur',($('.yt-money-input'))).off('focus',($('.yt-money-input'))).on('blur','.yt-money-input',function(){if($(this).val()!=''){$(this).val($yt_baseElement.fmMoney($(this).val()))}}).on('focus','.yt-money-input',function(){$(this).val($yt_baseElement.rmoney($(this).val()))})})},setTeacherApplyInfoList:function(list,exports){var html='';$.each(list,function(i,n){html+='<tr class="'+(exports?'exports':'')+'"><td class="lecturerName"><input type="hidden" class="lectureId" value="'+n.lecturerId+'"><span>'+n.lecturerName+'</span></td><td class="professional">'+(n.lecturerTitleName==''?'--':n.lecturerTitleName)+'</td><td class="level">'+(n.lecturerLevelName==''?'--':n.lecturerLevelName)+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#lecturerTable tbody').html(html)},setCostTrainApplyInfoList:function(list,exports){var html='';var total=0;$.each(list,function(i,n){var standard=(n.standard=='0.00'||n.standard=='')?'':$yt_baseElement.fmMoney(n.standard);var trainOfNum=(n.trainOfNum=='0'||n.trainOfNum=='')?'':n.trainOfNum;var trainDays=(n.trainDays=='0'||n.trainDays=='')?'':n.trainDays;html+='<tr class="'+(exports?'exports':'')+'" costnameval="'+n.trainType+'" pid=""><td class="cost-name">'+n.trainTypeName+'</td><td class="moneyText standard-money">'+standard+'</td><td class="people-num">'+trainOfNum+'</td><td class="day-num">'+trainDays+'</td><td class="moneyText smallplan-money">'+serveApply.fmMoney(n.averageMoney)+'</td><td class="special-instruct">'+n.remark+'</td><td><input type="hidden" class="popM" value="4"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.averageMoney});$('#trainingFeeTable tbody tr.last').before(html).find('.costTotal').text(serveApply.fmMoney(total))},setCostPredictInfoList:function(list,exports){var html='';var costTotal=0;var costTotalAfter=0;$.each(list,function(i,n){html+='<tr class="'+(exports?'exports':'')+'" pid="'+n.teachersTrainId+'"><td class="cost-name">'+n.predictName+'</td><td class="moneyText predict-standard-money">'+($yt_baseElement.fmMoney(n.predictStandardMoney))+'</td><td class="predict-people-num">'+n.predictPeopleNum+'</td><td class="moneyText predict-smallplan-money sum-pay">'+serveApply.fmMoney(n.averageMoney)+'</td><td class="moneyText predict-all-money" style="display:none;">'+serveApply.fmMoney(n.predictAllMoney)+'</td><td class="special-instruct">'+n.remark+'</td><td><input type="hidden" class="popM" value="4"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';costTotalAfter+= +n.predictStandardMoney;costTotal+= +n.averageMoney});$('#predictCostTable tbody tr.last').find('.costTotal-after').text(serveApply.fmMoney(costTotalAfter));$('#predictCostTable tbody tr.last').before(html).find('.costTotal').text(serveApply.fmMoney(costTotal))},setCostTeachersFoodApplyInfoList:function(list,exports){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="'+(exports?'exports':'')+'" pid="'+n.foodId+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="moneyText avg">'+serveApply.fmMoney(n.averageMoney)+'</td><td class="day">'+n.foodOfDays+'</td><td class="moneyText sum-pay">'+serveApply.fmMoney(n.foodAmount)+'</td><td style="text-align: left !important;" class="dec">'+(n.remarks||'无')+'</td><td><input type="hidden" class="popM" value="3"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';});$('#dietFeeTable tbody .end-tr').before(html);$('#dietFeeTable tbody tr:not(.end-tr)').each(function(){total+=serveApply.rmoney($(this).find('.sum-pay').text())});$('#dietFeeTable tbody .costTotal').text(serveApply.fmMoney(total))},setCostTeachersLectureApplyInfoList:function(list,exports){var html='';var total=0;var afterTotal=0;$.each(list,function(i,n){html+='<tr class="'+(exports?'exports':'')+'" pid="'+n.teachersLectureId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="holder">'+(n.lecturerTitleName||'--')+'</td><td class="hour">'+n.teachingHours+'</td><td class="cname">'+(n.courseName||'--')+'</td><td class="moneyText sum-pay">'+serveApply.fmMoney(n.perTaxAmount)+'</td><td class="moneyText after">'+serveApply.fmMoney(n.afterTaxAmount)+'</td><td class="moneyText avg">'+serveApply.fmMoney(n.averageMoney)+'</td><td><input type="hidden" class="popM" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.perTaxAmount;afterTotal+= +n.afterTaxAmount});$('#lectureFeeTable tbody .end-tr').before(html);$('#lectureFeeTable tbody .costTotal').text(serveApply.fmMoney(total));$('#lectureFeeTable tbody .costTotal-after').text(serveApply.fmMoney(afterTotal))},setCostTeachersTravelApplyInfoList:function(list,exports){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="'+(exports?'exports':'')+'" pid="'+n.teachersTravelId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="ulv">'+(n.lecturerLevelName||'--')+'</td><td class="sdate">'+n.goTime+'</td><td class="edate">'+n.arrivalTime+'</td><td class="sadd"><input type="hidden" class="scode" value="'+n.goAddress+'">'+n.goAddressName+'</td><td class="eadd"><input type="hidden" class="ecode" value="'+n.arrivalAddress+'">'+n.arrivalAddressName+'</td><td class="tname"><input type="hidden" class="tool" value="'+n.vehicle+'">'+n.vehicleName+'</td><td class="moneyText sum-pay">'+serveApply.fmMoney(n.carfare)+'</td><td style="text-align: left !important;" class="dec">'+(n.remarks||'')+'</td><td><input type="hidden" class="popM" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';});$('#carFeeTable tbody .end-tr').before(html);$('#carFeeTable tbody tr:not(.end-tr)').each(function(){total+=serveApply.rmoney($(this).find('.sum-pay').text())});$('#carFeeTable tbody .costTotal').text(serveApply.fmMoney(total))},setCostTeachersHotelApplyInfoList:function(list,exports){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="'+(exports?'exports':'')+'" pid="'+n.teachersHotelId+'" level="'+n.lecturerLevelName+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="moneyText avg">'+serveApply.fmMoney(n.averageMoney)+'</td><td class="day">'+n.hotelDays+'</td><td class="moneyText sum-pay">'+serveApply.fmMoney(n.hotelExpense)+'</td><td style="text-align: left !important;" class="dec">'+(n.remarks||'')+'</td><td><input type="hidden" class="popM" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';});$('#hotelFeeTable tbody .end-tr').before(html);$('#hotelFeeTable tbody tr:not(.end-tr)').each(function(){total+=serveApply.rmoney($(this).find('.sum-pay').text())});$('#hotelFeeTable tbody .costTotal').text(serveApply.fmMoney(total))},setCostNormalList:function(list){},setMeetingList:function(list){$.each(list,function(i,n){serveApply.getMeetingTypeCode(n.meetType);$('#meetName').val(n.meetName);$('#meetAddress').val(n.meetAddress);$('#startTime').val(n.meetStartTime);$('#endTime').val(n.meetEndTime);$('#calculationSession').text(n.meetDays);$('#meetOfNum').val(n.meetOfNum);$('#meetWorkerNum').val(n.meetWorkerNum);})},setMeetingCostList:function(list){$.each(list,function(i,n){$('#meetHotel').val($yt_baseElement.fmMoney(n.meetHotel));$('#meetFood').val($yt_baseElement.fmMoney(n.meetFood));$('#meetOther').val($yt_baseElement.fmMoney(n.meetOther));$('#costTotal').text($yt_baseElement.fmMoney(n.meetAmount)).css('color','#333');$('#dailyAverageConsumption').text($yt_baseElement.fmMoney(n.meetAverage)).css('color','#333');})},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},rmoney:function(str){return $yt_baseElement.rmoney(str||'0')},verifyBudgetExpendSum:function(){var expend=serveApply.rmoney($('.count-val-num').text());var budget=serveApply.rmoney($('#deptBudgetBalanceAmount').text().replace('万元',''))*10000;if(false){$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:"部门预算可用余额小于当前申请的金额，请调整申请内容，或先保存页面信息，待部门预算调整后再重新提交申请。",cancelFunction:function(){}});return false}return true},getTrainingTypeOption:function(code){},getMeetingTypeCode:function(code){}};$(function(){serveApply.init()})})(jQuery,window);