var printSF={expenditureAppId:'',processInstanceId:'',inits:function(){printSF.expenditureAppId=$yt_common.GetQueryString('expenditureAppId');printSF.processInstanceId=$yt_common.GetQueryString('processInstanceId');var flowLogHtml=sysCommon.getCommentByProcessInstanceId(printSF.processInstanceId);$(".flow-log-div").html(flowLogHtml);printSF.events();printSF.initDate()},events:function(){$("#printBtn").off().on("click",function(){printSF.doPrint()});$("#closeBtn").off().on("click",function(){parent.closeWindow()})},initDate:function(){$.ajax({type:"post",url:"sz/expenditureApp/printSpendingFormByExpenditureAppId",async:true,data:{expenditureAppId:printSF.expenditureAppId,},success:function(data){if(data.flag==0){var datas=data.data;$(".expenditure-app-num").text(datas.expenditureAppNum);var entryVal=[];var entryLength=0;entryVal=datas.expenditureAppName.split('');$(entryVal).each(function(i,n){if(n.charCodeAt()>255){entryLength+=2}else{entryLength+=1}});if(entryLength>=56){$(".expenditure-app-name").addClass("expenditure-app-name-css");if(entryLength>=112){$(".expenditure-app-name").css("font-size","12px")}}$(".expenditure-app-name").text(datas.expenditureAppName);$(".total-amount").text($yt_baseElement.fmMoney(datas.totalAmount));$(".print-year").text(datas.printYear);$(".print-month").text(datas.printMonth);$(".print-day").text(datas.printDay);var payReceivablesList=datas.payReceivablesList;var thisTr=$(".datas-start-tr");var sumMoney=0;$(payReceivablesList).each(function(i,n){if(i>=3){thisTr.after('<td style="text-align:left;padding:2px 5px;"><div class="width-td"></div></td><td></td><td></td><td></td><td></td>');$(".rowspan-attr-td").attr("rowspan",(i+3))}$(".width-td");var entryArr=[];var entryArrLength=0;entryArr=n.payName.split('');$(entryArr).each(function(i,n){if(n.charCodeAt()>255){entryArrLength+=2}else{entryArrLength+=1}});if(entryArrLength>=50){thisTr.find("td .width-td").addClass("expenditure-app-name-css");if(entryArrLength>=100){thisTr.find("td .width-td").css("font-size","12px")}}thisTr.find("td .width-td").text(n.payName);thisTr.find("td").eq(1).text($yt_baseElement.fmMoney(n.amount)).css("text-align","right");thisTr.find("td").eq(2).text(n.openBank);thisTr.find("td").eq(3).text(n.accounts);thisTr.find("td").eq(4).text((n.isContract==1?'是':'否'));sumMoney+=$yt_baseElement.rmoney(n.amount);thisTr=thisTr.next()});$(".sum-money").text($yt_baseElement.fmMoney(sumMoney));$(".text-sum-money").text(arabiaToChinese(sumMoney+""))}else{$yt_alert_Model.prompt(data.message)}}})},doPrint:function(){bdhtml=window.document.body.innerHTML;sprnstr="<!--startprint-->";eprnstr="<!--endprint-->";prnhtml=bdhtml.substr(bdhtml.indexOf(sprnstr)+17);prnhtml=prnhtml.substring(0,prnhtml.indexOf(eprnstr));window.document.body.innerHTML=prnhtml;window.print();window.document.body.innerHTML=bdhtml;window.location.reload()}};$(function(){printSF.inits()});