(function($,window){var serveFunds={addressList:"",selUsersName:"",selUsersCode:"",usersInfoList:"",usersInfoJson:"",riskExcMark:"../../../../../resources-sasac/images/common/war-red.png",riskWarImg:"../../../../../resources-sasac/images/common/risk-war.png",riskViaImg:"../../../../../resources-sasac/images/common/risk-via.png",init:function(){var ts=this;ts.start();ts.events();ts.uploadFile();sysCommon.getLoginUserInfo();sysCommon.getApproveFlowData("SZ_REIM_APP");$('#applicantUser').val($yt_common.user_info.userName);ts.getCostTypeList();ts.getDictInfoByTypeCode()},start:function(){$('select:not(.busi-addres-sel)').niceSelect();$('#applyDate').calendar({speed:0,nowData:false});$("#tdStartDate").calendar({controlId:"planStartDate",nowData:false,upperLimit:$("#tdEndDate"),speed:0,callback:function(){sysCommon.clearValidInfo($("#tdStartDate"))}});$("#tdEndDate").calendar({controlId:"planEndDate",nowData:false,lowerLimit:$("#tdStartDate"),speed:0,callback:function(){sysCommon.clearValidInfo($("#tdEndDate"))}});$("#traffic-start-time").calendar({controlId:"trafficStartTime",nowData:false,upperLimit:$("#traffic-end-time"),speed:0,callback:function(){sysCommon.clearValidInfo($("#traffic-start-time"))}});$("#traffic-end-time").calendar({controlId:"trafficEndTime",nowData:false,lowerLimit:$("#traffic-start-time"),speed:0,callback:function(){sysCommon.clearValidInfo($("#traffic-end-time"))}});$yt_baseElement.numberInput($(".yt-numberInput-box"))},events:function(){var me=this;$('.file-box').on('click','.del-file',function(){var ithis=$(this);var parent=ithis.parent();$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){parent.remove()}})});$('.expense-type').change(function(){var code=$(this).find('option:selected').val();var fun=$(this).find('option:selected').attr('fun');if(code){$('.qtip-text-div').hide();$('.mod-div').hide();me[fun]();$('.else-div').show();$('.approve-div').show()}else{$('.qtip-text-div').show();$('.mod-div').hide();$('.else-div').hide();$('.approve-div').hide()}});$('.special-type').change(function(){var val=$(this).val();if(val=='2'){$('.special-yes').hide();$('.special-no').show();var name=$('select.expense-type option:selected').text();$('.special-label').text(name+'余额：')}else{$('.special-yes').show();$('.special-no').hide()}});$('.money-input').on('focus',function(){var ts=$(this);if(ts.val()!=""){ts.val($yt_baseElement.rmoney(ts.val()))}});$('.money-input').on('blur',function(){var ts=$(this);if(ts.val()!=''){ts.val($yt_baseElement.fmMoney(ts.val()))}});$('.money-input').on('keyup',function(){var ts=$(this);if(ts.val()!=''){ts.val(ts.val().replace(/[^\d.]/g,''))}});$('.amount-table .money-input').blur(function(){var body=$('.amount-table');var official=Number($yt_baseElement.rmoney(body.find('.official').val()||'0'));var cash=Number($yt_baseElement.rmoney(body.find('.cash').val()||'0'));var cheque=Number($yt_baseElement.rmoney(body.find('.cheque').val()||'0'));var transfer=Number($yt_baseElement.rmoney(body.find('.transfer').val()||'0'));var total=official+cash+cheque+transfer;var rtotal=$yt_baseElement.fmMoney(total);body.find('.total').text(rtotal).attr('num',total)});$('#exportMst').click(function(){me.getCostAppInfoDetailByParams(1,1)});$('#exportPayment').click(function(){me.getCostAppInfoDetailByParams(1,1)});$('#savePayment').on('click',function(){if($yt_valid.validForm($('.ordinary-div'))){var data=me.getSubData();me.saveReimAppInfoToDrafts(data)}});$('#submitPayment').on('click',function(){if($yt_valid.validForm($('.ordinary-div'))){var data=me.getSubData();me.submitReimAppInfo(data)}});me.paymentListEvent();me.priorApprovalEvent();me.msgListEvent();me.borrowListEvent();me.specialListEvent();me.generalListEvent();me.costApplyAlertEvent();sysCommon.costDetailModelTabEvent();$('.yt-table tbody').on('click','tr',function(){var ts=$(this);var trs=ts.siblings();trs.removeClass('yt-table-active');ts.addClass('yt-table-active')})},uploadFile:function(){$(".file-up-div").off().on('.cont-file',"change",function(obj){var fileElementId=this.id;var ithisParent=$('#attIdStr');var url=$yt_option.base_path+"/fileUpDownload/upload?ajax=1&modelCode=REIM_APP";var imgUlr='';$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:fileElementId,success:function(data,textStatus){if(data.flag==0){var attaElement=$('<div fId="'+data.data.pkId+'" class="li-div"><span>'+data.data.naming+'</span><span class="del-file">x</span></div>');ithisParent.append(attaElement)}else{$yt_alert_Model.prompt(data.message)}},error:function(data,status,e){$yt_alert_Model.prompt(data.message)}})})},paymentListEvent:function(){var me=this;$('#addProcuList').on('click',function(){me.showPaymentAlert();$('#paymentAddBtn').off().on('click',function(){me.appendPaymentList()}).text('添加到列表')});$('#paymentList').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();me.getTotleMoney()}})});$('#paymentList').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var budgetProject=$('#budgetProject option[value="'+tr.attr('budgetcode')+'"]').attr('selected',true);var applyDate=$('#applyDate').val(tr.attr('applyDate'));var siteVal=$('#siteVal').val(tr.attr('siteVal'));var costBreakdown=$('#costBreakdown option[value="'+tr.attr('costcode')+'"]').attr('selected',true);var standardMoney=$('#standardMoney').val(tr.attr('standardMoney'));var budgetMoney=$('#budgetMoney').val(tr.attr('budgetMoney'));var accompanyNum=$('#accompanyNum').val(tr.attr('accompanyNum'));$('#budgetProject,#costBreakdown').niceSelect();me.showPaymentAlert();$('#paymentAddBtn').off().on('click',function(){me.appendPaymentList(tr)}).text('确定')});$('#paymentCanelBtn').on('click',function(){me.hidePaymentAlert();me.clearAlert($('#createDetali'))})},showPaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hidePaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.hideMongoliaLayer();alert.hide();$('#pop-modle-alert').hide()},appendPaymentList:function(tr){var me=this;var budgetProject=$('#budgetProject option:selected').text();var budgetCode=$('#budgetProject option:selected').val();var applyDate=$('#applyDate').val();var siteVal=$('#siteVal').val();var costBreakdown=$('#costBreakdown option:selected').text();var costCode=$('#costBreakdown option:selected').val();var standardMoney=$('#standardMoney').val();var stanMoney=$yt_baseElement.rmoney(standardMoney);var budgetMoney=$('#budgetMoney').val();var numMoney=$yt_baseElement.rmoney(budgetMoney);var accompanyNum=$('#accompanyNum').val();var html='<tr pkId="" budgetCode="'+budgetCode+'" costCode="'+costCode+'" budgetProject="'+budgetProject+'" applyDate="'+applyDate+'" siteVal="'+siteVal+'" costBreakdown="'+costBreakdown+'" standardMoney="'+standardMoney+'" budgetMoney="'+budgetMoney+'" accompanyNum="'+accompanyNum+'"><td><span class="">'+budgetProject+'</span></td><td><span class="act-date">'+applyDate+'</span></td><td><span class="place-name">'+siteVal+'</span></td><td><span>'+costBreakdown+'</span></td><td style="text-align: right;"><div class="stan-money" money='+stanMoney+'>'+standardMoney+'</div></td><td style="text-align: right;"><div class="money" money='+numMoney+'>'+budgetMoney+'</div></td><td><span class="people-num">'+accompanyNum+'</span></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(budgetProject&&applyDate&&siteVal&&costBreakdown&&standardMoney&&budgetMoney&&accompanyNum){if(tr){tr.replaceWith(html)}else{$('#paymentList tbody .last').before(html)}me.hidePaymentAlert();me.clearAlert($('#createDetali'));me.getTotleMoney()}else{$yt_alert_Model.prompt('请完整填写数据')}},getTotleMoney:function(){var tds=$('#paymentList tbody .money');var total=0;$.each(tds,function(i,n){total+= +$(n).attr('money')});var fmTotal=$yt_baseElement.fmMoney(total);$('#paymentList tbody .total-money').text(fmTotal);$('#applyTotalMoney').text(fmTotal).attr('num',total);$('#amountTotalMoney').text(fmTotal).attr('num',total);$('#TotalMoneyUpper').text(arabiaToChinese(fmTotal));var writeOffAmount= +($('#writeOffAmount').attr('num'));var num=total-writeOffAmount;if(num>=0){$('#replaceMoney').text(num)}else{$('#balanceMoney').text(num)}},updatePaymentList:function(tr){},priorApprovalEvent:function(){var me=this;$('.prior-approval').click(function(){me.getPriorApprovalList();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('.prior-alert'));$('#pop-modle-alert').show();$('.prior-alert').show()});$('.prior-common').click(function(){var code=$('.prior-approval-list .yt-table-active').attr('code');if(code){$('.prior-approval').val(code);$('.advance-relevance').show();$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()}else{$yt_alert_Model.prompt('请选择一条数据')}});$('.prior-cancel').click(function(){$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide();$('.prior-approval-val').val('');me.getPriorApprovalList()});$('.prior-approval-search').click(function(){me.getPriorApprovalList()});$('.prior-approval-reset').click(function(){$('.prior-approval-val').val('');me.getPriorApprovalList()})},msgListEvent:function(){var me=this;$('.add-msg').click(function(){me.showMsgAlert();$('.msg-common').off().on('click',function(){me.appendMsgList()}).text('添加到列表')});$('.msg-cancel').click(function(){me.hideMsgAlert();me.clearAlert($('.msg-alert'))});$('.msg-list').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();me.resetNum($('.msg-list'))}})});$('.msg-list').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var nameVal=$('#nameVal').val(tr.attr('nameVal'));var dutyVal=$('#dutyVal').val(tr.attr('dutyVal'));var deptVal=$('#deptVal').val(tr.attr('deptVal'));me.showMsgAlert();$('.msg-common').off().on('click',function(){me.appendMsgList(tr)}).text('确定')})},appendMsgList:function(tr){var me=this;var nameVal=$('#nameVal').val();var dutyVal=$('#dutyVal').val();var deptVal=$('#deptVal').val();var html='<tr pkId="" class="" nameVal="'+nameVal+'" dutyVal="'+dutyVal+'" deptVal="'+deptVal+'"><td><span class="num">1</span></td><td><span class="name-text">'+nameVal+'</span></td><td><span class="job-text">'+dutyVal+'</span></td><td><span class="unit-text">'+deptVal+'</span></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(nameVal!=''&&dutyVal!=''&&deptVal!=''){if(tr){tr.replaceWith(html)}else{$('.msg-list').append(html)}me.hideMsgAlert();me.clearAlert($('.msg-alert'));me.resetNum($('.msg-list'))}else{$yt_alert_Model.prompt('请完整填写数据')}},updateMsgList:function(tr){},resetNum:function(obj){var trs=obj.find('tbody tr');$.each(trs,function(i,n){$(n).find('.num').text(i+1)})},showMsgAlert:function(){var alert=$('.msg-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideMsgAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.msg-alert').hide();$('#pop-modle-alert').hide()},generalListEvent:function(){var me=this;$('.add-general').click(function(){me.showGeneralAlert();$('.general-common').off().on('click',function(){me.appendGeneralList()}).text('添加到列表')});$('.general-cancel').click(function(){me.hideGeneralAlert();me.clearAlert($('.general-alert'))});$('.general-list').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})});$('.general-list').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var cont=$('#generalCostContent').val(tr.attr('cont'));var sum=$('#generalSum').val(tr.attr('num'));me.showGeneralAlert();$('.general-common').off().on('click',function(){me.appendGeneralList(tr)}).text('确定')})},showGeneralAlert:function(){var alert=$('.general-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideGeneralAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.general-alert').hide();$('#pop-modle-alert').hide()},appendGeneralList:function(tr){var me=this;var cont=$('#generalCostContent').val();var sum=$('#generalSum').val();if(cont&&sum){var num=$yt_baseElement.rmoney(sum);var html='<tr cont="'+cont+'" sum="'+num+'"  class=""> <td style="text-align:left;" class="">'+cont+'</td> <td style="text-align: right;" class="">'+sum+'</td> <td> <span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span> <span class="operate-del" style=""><img src="../../../../../resources-sasac/images/common/del-icon.png"></span> </td> </tr>';if(tr){tr.replaceWith(html)}else{$('#generalList tbody .last').before(html)}me.hideGeneralAlert();me.clearAlert($('.general-alert'))}else{$yt_alert_Model.prompt('请填写完整数据')}},costApplyAlertEvent:function(){var me=this;$("#modelBusiUser").off().on("click",function(){$("#busiUserInfo").show();if(!$("#busiUserInfo").hasClass("check")){me.getBusiTripUsersList($("#userPram").val())}me.busiTripUserModelEvent($("#modelBusiUser"),$("#busiPlanEditModel .auto-font"),$(".model-user-num-show"),1)});$('#tripAddBtn').click(function(){me.showTripAlert();$('#planSaveBtn').off().on('click',function(){me.appendTripList()}).text('添加到列表')});$('#tripList').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();var trs=$('#tripList tbody tr');if(trs.length<=0){$('#traffic-list-info tbody').empty();$('#hotel-list-info tbody').empty();$('#other-list-info tbody').empty();$('#subsidy-list-info tbody').empty()}else{me.setSubsidyList()}}})});$('#subsidy-list-info').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();me.setSubsidyTotal()}})});$('#tripList').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');me.setTripAlertData(tr);me.showTripAlert();$('#planSaveBtn').off().on('click',function(){me.appendTripList(tr)}).text('确定')});$('#planCanelBtn').click(function(){me.hideTripAlert();$("#busiUserInfo ul li").removeClass("tr-check");$("#busiUserInfo").removeClass("check");$('#modelBusiAddres').html('<option value="">请选择</option>');me.selUsersName="";me.selUsersCode="";me.clearAlert($('#busiPlanEditModel'))});$('#addCostApplyBtn').click(function(){me.showCostApplyAlert();me.busiTripUserModelEvent();$('#modelSureBtn').off().on('click',function(){var tabFlag=$(".cost-type-tab li.tab-check .hid-tab").val();var validModel="";if(tabFlag==0){validModel=$(".traffic-form")}else if(tabFlag==1){validModel=$(".hotel-form")}else if(tabFlag==2){validModel=$(".other-form")}var validFlag=$yt_valid.validForm(validModel);if(validFlag){me.appendCostApplyList(tabFlag)}}).text('添加到列表')});$("#addres-icon").off().on("click",function(){var startCity=$("#fromcity option:selected");var endCity=$("#tocity option:selected");$("#tocity").html(startCity);$("#fromcity").html(endCity);me.getPlanBusiAddress($("#tocity"));me.getPlanBusiAddress($("#fromcity"))});$(".yt-spin").click(function(){var hotelDay=$(".hotel-form .yt-numberInput").val();if(hotelDay<1){hotelDay=$(".hotel-form .yt-numberInput").val(1)}var hotelMoney=$(".cost-detail-money").val();if(hotelDay>0&&hotelMoney!=""){$("#peoDayMoney").html($yt_baseElement.fmMoney(($yt_baseElement.rmoney(hotelMoney))/hotelDay))}});$(".yt-numberInput").on("blur",function(){var hotelMoney=$(".cost-detail-money").val();if($(this).val()>0&&hotelMoney!=""){$("#peoDayMoney").html($yt_baseElement.fmMoney(hotelMoney/$(this).val()))}});$(".city-cost-input,.cost-detail-money").on("focus",function(){if($(this).val()!=""&&$(this).val()!=null){$(this).val($yt_baseElement.rmoney($(this).val()));$(this).select()}});$(".city-cost-input,.cost-detail-money").off("blur").on("blur",function(){if($(this).hasClass("cost-detail-money")){var hotelDay=$(".hotel-form .yt-numberInput").val();$("#peoDayMoney").html($yt_baseElement.fmMoney($(this).val()/hotelDay))}$yt_baseElement.fmMoney($(this))});$('#traffic-list-info').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();if($(".travel-list-tab-model table tbody tr").length==0){var noDataTr='<tr class="not-date-tr"><td colspan="10"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';$(".travel-list-tab-model table tbody").append(noDataTr);$(".cost-apply-model,.flow-approve-model").hide();}}})});$('#traffic-list-info,#hotel-list-info,#other-list-info').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');me.setFormInfo(tr);me.showCostApplyAlert();var costType=tr.find(".hid-cost-type").val();$(".cost-type-tab ul li").removeClass("tab-check");$('.cost-type-tab ul li input[value="'+costType+'"]').parent().addClass("tab-check");if(costType==0){$(".traffic-form").show();$(".traffic-form .risk-img").attr("src",me.riskViaImg)}if(costType==1){$(".hotel-form").show();$(".traffic-form").hide();$(".hotel-form .risk-img").attr("src",me.riskViaImg)}if(costType==2){$(".other-form").show();$(".traffic-form").hide();$(".other-form .risk-img").attr("src",me.riskViaImg)}$('#modelSureBtn').off().on('click',function(){me.appendCostApplyList(costType,tr)}).text('确定')});$('#modelCanelBtn').click(function(){me.hideCostApplyAlert();me.clearFormData()})},showTripAlert:function(){var me=this;var alert=$('#busiPlanEditModel');me.setAddress();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideTripAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#busiPlanEditModel').hide();$('#pop-modle-alert').hide()},showCostApplyAlert:function(){var me=this;var alert=$('#costApplyAlert');me.setAddress();me.getPlanBusiAddress($("#fromcity"));me.getPlanBusiAddress($("#tocity"));$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideCostApplyAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#costApplyAlert').hide();$('#pop-modle-alert').hide()},appendTripList:function(tr){var me=this;var planModel=$("#busiPlanEditModel");var modelBusiType=$('#modelBusiType option:selected');var name=modelBusiType.text();var code=modelBusiType.val();var tdStartDate=$('#tdStartDate').val();var tdEndDate=$('#tdEndDate').val();var dateFrom=new Date(tdStartDate);var dateTo=new Date(tdEndDate);var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24));var day=diff_day;var modelBusiAddres=$('#modelBusiAddres option:selected').val();var budiAddName=$('#modelBusiAddres option:selected').text();var busiUsersName=$("#modelBusiUser").val();var busiUsersCode=$("#modelUserCodes").val();var busiNum=$(".model-user-num-show .users-num").text();var receptionMoney="";var receptionMoneyCode="";if(planModel.find(".check-label.check").length>0){planModel.find(".check-label.check").each(function(i,n){receptionMoney+=$(n).find("span").text()+"、";receptionMoneyCode+=$(n).find("input").val()+","});receptionMoney=receptionMoney.substring(0,receptionMoney.length-1);receptionMoneyCode=receptionMoneyCode.substring(0,receptionMoneyCode.length-1)}else{receptionMoney="--"}var html='<tr busicode="'+code+'" usercode="'+busiUsersCode+'" rececode="'+receptionMoneyCode+'" ><td><input type="hidden" class="hid-user-code" value="'+busiUsersCode+'" /> <span class="name">'+name+'</span></td><td class="sdate">'+tdStartDate+'</td><td class="edate">'+tdEndDate+'</td><td class="day">'+day+'</td><td class="address" val="'+modelBusiAddres+'">'+budiAddName+'</td><td class="uname">'+busiUsersName+'</td><td class="numof">'+busiNum+'</td><td class="reception">'+receptionMoney+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del" style=""><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if($yt_valid.validForm($('#busiPlanEditModel'))){if(tr){tr.replaceWith(html)}else{$('#tripList tbody').append(html)}me.hideTripAlert();$("#busiUserInfo ul li").removeClass("tr-check");$("#busiUserInfo").removeClass("check");me.selUsersName="";me.selUsersCode="";me.clearAlert($('#busiPlanEditModel'));$('#modelBusiAddres').html('<option value="">请选择</option>');me.getModelUsersInfo();me.setSubsidyList()}},setTripAlertData:function(tr){var planModel=$("#busiPlanEditModel");var modelBusiType=$('#modelBusiType option[value="'+tr.attr('busicode')+'"]').attr('selected',true);$('#modelBusiType').niceSelect();var tdStartDate=$('#tdStartDate').val(tr.find('.sdate').text());var tdEndDate=$('#tdEndDate').val(tr.find('.edate').text());var modelBusiAddres=$('#modelBusiAddres').html('<option value="'+tr.find('.address').attr('val')+'">'+tr.find('.address').text()+'</option>');var busiUsersName=$("#modelBusiUser").val(tr.find('.uname').text());var busiUsersCode=$("#modelUserCodes").val(tr.attr('usercode'));var busiNum=$(".model-user-num-show .users-num").text(tr.find('.numof').text());var rececode=tr.attr('rececode');var receList=rececode.split(',');$.each(receList,function(i,n){if(n){planModel.find('.check-label input[value="'+n+'"]').setCheckBoxState('check')}});serveFunds.getPlanBusiAddress($("#modelBusiAddres"))},appendCostApplyList:function(tabFlag,tr){var me=this;if(tabFlag==0){me.getTrafficCostFormInfo(tr)}if(tabFlag==1){me.getHotelFormInfo(tr)}if(tabFlag==2){me.getOtherCostFormInfo(tr)}},getTrafficCostFormInfo:function(tr){var me=this;var trabfficObj=$(".traffic-form");sysCommon.createSumTr(0);var tripUser=trabfficObj.find("#model-trip-user option:selected").text();var userCode=trabfficObj.find("#model-trip-user option:selected").val();var level=trabfficObj.find("#model-trip-user option:selected").attr("data-level");var trafficStartTime=$('#traffic-start-time').val();var trafficEndTime=$('#traffic-end-time').val();var fromcityName=$('#fromcity option:selected').text();var fromcity=$('#fromcity option:selected').val();var tocityName=$('#tocity option:selected').text();var tocity=$('#tocity option:selected').val();var specialRemark=$('#special-remark').val();var vehicle="";var vehicleCode="";vehicleCode=trabfficObj.find(".vehicle-sel").val();var vehicleChildCode="";vehicleChildCode=trabfficObj.find(".vehicle-two-sel").val();if($(".vehicle-two-sel").val()!=""&&$(".vehicle-two-sel").val()!=null){vehicle=trabfficObj.find(".vehicle-two-sel option:selected").text()}else{vehicle=trabfficObj.find(".vehicle-sel option:selected").text()}var cityMoney=trabfficObj.find(".city-cost-input").val();var trafficCostStr='<tr><td><span>'+tripUser+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+userCode+'"/></td><td>'+level+'</td><td data-text="goTime">'+trafficStartTime+'</td><td><input data-val="goAddress" type="hidden" value="'+fromcity+'"><span data-text="goAddressName">'+fromcityName+'</span></td><td data-text="arrivalTime">'+trafficEndTime+'</td><td><input data-val="arrivalAddress" type="hidden" value="'+tocity+'"> <span data-text="arrivalAddressName">'+tocityName+'</span></td><td><span data-text="vehicle">'+vehicle+'</span><input type="hidden" class="hid-vehicle" value="'+vehicleCode+'"/><input type="hidden" class="hid-child-code" value="'+vehicleChildCode+'"/></td><td class="font-right money-td" data-text="crafare">'+(cityMoney==''?"--":$yt_baseElement.fmMoney(cityMoney))+'</td><td class="text-overflow-sty" data-text="remarks" title="'+specialRemark+'">'+(specialRemark==""?"--":specialRemark)+'</td><td><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(trafficCostStr)}else{$("#traffic-list-info tbody .total-last-tr").before(trafficCostStr)}me.hideCostApplyAlert();me.updateMoneySum(0);me.clearFormData();},setFormInfo:function(thisTr){var me=this;var costType=$(thisTr).find(".hid-cost-type").val();if(costType==0){var busiUser=$(thisTr).find("td:eq(0) .hid-traf-users").val();var startDate=$(thisTr).find("td:eq(2)").text();var startAddre=$(thisTr).find("td:eq(3)").text();var startVal=$(thisTr).find("td:eq(3)").attr('val');var endDate=$(thisTr).find("td:eq(4)").text();var endAddre=$(thisTr).find("td:eq(5)").text();var endVal=$(thisTr).find("td:eq(5)").attr('val');var vehicles=0;if($(thisTr).find("td:eq(6) input:eq(0)").val().indexOf(".")!=-1){vehicles=$(thisTr).find("td:eq(6) input:eq(0)").val().split(".")}var vehicle="";var vehicleChildCode="";if(vehicles.length>0){vehicle=vehicles[1];vehicleChildCode=vehicles[2]}else{vehicle=$(thisTr).find("td:eq(6) input:eq(0)").val();vehicleChildCode=$(thisTr).find("td:eq(6) .hid-child-code").val()}var cityMoney=$(thisTr).find("td:eq(7)").text();var cityMsg=$(thisTr).find("td:eq(8)").text();$('#model-trip-user option[value="'+busiUser+'"]').attr("selected","selected");$("#traffic-start-time").val(startDate);$("#traffic-end-time").val(endDate);$("#fromcity").html('<option value="'+startVal+'">'+startAddre+'</option>');$("#tocity").html('<option value="'+endVal+'">'+endAddre+'</option>');$('.traffic-form .vehicle-sel option[value="'+vehicle+'"]').attr("selected","selected");if(vehicleChildCode!=""){$("#vehicleTwoDiv").css('display','inline-block');sysCommon.vechicleChildData(vehicle);$('.traffic-form .vehicle-two-sel option[value="'+vehicleChildCode+'"]').attr("selected","selected")}$(".traffic-form .city-cost-input").val(cityMoney);$("#special-remark").val((cityMsg=="--"?"":cityMsg));$('#model-trip-user,.traffic-form .vehicle-sel,.traffic-form .vehicle-two-sel').niceSelect();me.getPlanBusiAddress($("#fromcity"));me.getPlanBusiAddress($("#tocity"));if(vehicle!=""||vehicleChildCode!=""){$(".vehicle-sel").parents("td").find(".risk-img").attr("src",me.riskViaImg)}}if(costType==1){var busiUser=$(thisTr).find("td:eq(0) input").val();var dayMoney=$(thisTr).find("td:eq(2)").text();var hotelDay=$(thisTr).find("td:eq(3)").text();var hotelMoney=$(thisTr).find("td:eq(4)").text();var hotelAddress=$(thisTr).find("td:eq(5) input").val();hotelAddress=hotelAddress.split("-");var hotelAddressName=$(thisTr).find('td:eq(5) span').text().split('-');var textareMsg=$(thisTr).find("td:eq(6)").text();$('#hotel-trip-user option[value="'+busiUser+'"]').attr("selected","selected");$(".hotel-form .yt-numberInput").val(hotelDay);if(hotelAddress.length==3){$('#hotelParentAddress').html('<option value="'+hotelAddress[0]+'">'+hotelAddressName[0]+'</option>');$('#hotelTwoAddres').html('<option value="'+hotelAddress[1]+'">'+hotelAddressName[1]+'</option>');$('#hotelChildAddres').html('<option value="'+hotelAddress[2]+'">'+hotelAddressName[2]+'</option>');}else if(hotelAddress.length==2){$('#hotelChildAddres').html('<option value="'+hotelAddress[1]+'">'+hotelAddressName[1]+'</option>');}$(".hotel-form .hotel-money").val(hotelMoney);$("#peoDayMoney").text(dayMoney);$(".hotel-form .hotel-msg").val((textareMsg=="--"?"":textareMsg));me.setAddress();$('#hotel-trip-user').niceSelect();me.hotelChildDisa(hotelAddress[0],"CITY");me.hotelChildDisa(hotelAddress[1],"AREA")}if(costType==2){var costType=$(thisTr).find("td:eq(0) input").val();var costMoney=$(thisTr).find("td:eq(1)").text();var textareMsg=$(thisTr).find("td:eq(2)").text();$('#cost-type option[value="'+costType+'"]').attr("selected","selected");$(".other-form .other-money").val(costMoney);$(".other-form .other-msg").val((textareMsg=="--"?"":textareMsg));$('#cost-type').niceSelect()}},getHotelFormInfo:function(tr){var me=this;var hotelObj=$(".hotel-form");sysCommon.createSumTr(1);var tripUser=hotelObj.find("select.hotel-trip-user-sel option:selected").text();var level=hotelObj.find("select.hotel-trip-user-sel option:selected").attr("data-level");var hotelAddress="";var hotelAdressCode="";var hotelParentAdres=hotelObj.find("#hotelParentAddress option:selected").text();var hotelTwoAdres=hotelObj.find("#hotelTwoAddres option:selected").text();var hotelChildAdres=hotelObj.find("#hotelChildAddres option:selected").text();if(hotelTwoAdres==""||hotelTwoAdres=="请选择"){hotelAddress=hotelParentAdres;hotelAdressCode=hotelObj.find("#hotelParentAddress").val()}else{hotelAddress=hotelParentAdres+"-"+hotelTwoAdres+"-"+hotelChildAdres;hotelAdressCode=hotelObj.find("#hotelParentAddress").val()+"-"+hotelObj.find("#hotelTwoAddres").val()+"-"+hotelObj.find("#hotelChildAddres").val()}var hotelCostStr='<tr><td><span>'+tripUser+'</span><input type="hidden" data-val="travelPersonnel" value="'+hotelObj.find("select.hotel-trip-user-sel").val()+'"/></td><td>'+level+'</td>'+'<td class="font-right">'+$("#peoDayMoney").html()+'</td><td data-text="hotelDays">'+hotelObj.find(".yt-numberInput").val()+'</td><td class="font-right money-td" data-text="hotelExpense">'+$yt_baseElement.fmMoney(hotelObj.find(".cost-detail-money").val()||'0')+'</td><td><span data-text="hotelAddressName">'+hotelAddress+'</span><input type="hidden" data-val="hotelAddress" value="'+hotelAdressCode+'"</td><td class="text-overflow-sty" data-text="remarks" title="'+hotelObj.find(".hotel-msg").val()+'">'+(hotelObj.find(".hotel-msg").val()==""?"--":hotelObj.find(".hotel-msg").val())+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(hotelCostStr)}else{$("#hotel-list-info tbody .total-last-tr").before(hotelCostStr)}me.updateMoneySum(1);me.hideCostApplyAlert();me.clearFormData();},getOtherCostFormInfo:function(tr){var me=this;var otherObj=$(".other-form");sysCommon.createSumTr(2);var costType=otherObj.find("#cost-type option:selected").text();var otherCostStr='<tr><td><span>'+costType+'</span><input type="hidden" data-val="costType" value="'+otherObj.find("#cost-type").val()+'"/></td><td class="font-right money-td" data-text="reimAmount">'+$yt_baseElement.fmMoney(otherObj.find(".other-money").val()||'0')+'</td><td class="text-overflow-sty" data-text="remarks" title="'+otherObj.find(".other-msg").val()+'">'+(otherObj.find(".other-msg").val()==""?"--":otherObj.find(".other-msg").val())+'</td><td><input type="hidden" class="hid-cost-type" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(otherCostStr)}else{$("#other-list-info tbody .total-last-tr").before(otherCostStr)}me.updateMoneySum(2);me.hideCostApplyAlert();me.clearFormData();$("#other-list-info").parent().find(".cost-list-title .risk-img").attr("src",me.riskViaImg)},borrowListEvent:function(){var me=this;$('.borrow-money').click(function(){me.getBorrowList();me.showBorrowAlert()});$('.borrow-common').click(function(){var code=$('.borrow-list .yt-table-active').attr('code');if(code){$('.borrow-money').val(code);var loanMoney=$('.borrow-list .yt-table-active').find(".loanApp-balance").text();$("#outstandingBalance").text(loanMoney);me.hideBorrowAlert()}else{$yt_alert_Model.prompt('请选择一条数据')}});$('.borrow-cancel').click(function(){me.hideBorrowAlert();$('.borrow-val').val('');me.getPriorApprovalList()});$('.borrow-search').click(function(){me.getPriorApprovalList()});$('.borrow-reset').click(function(){$('.borrow-val').val('');me.getPriorApprovalList()})},showBorrowAlert:function(){var alert=$('.borrow-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideBorrowAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.borrow-alert').hide();$('#pop-modle-alert').hide()},specialListEvent:function(){var me=this;$('.special-name').click(function(){me.getSpecialList();me.showSpecialAlert()});$('.special-common').click(function(){var code=$('.special-list .yt-table-active').attr('code');if(code){$('.special-name').val(code);me.hideSpecialAlert()}else{$yt_alert_Model.prompt('请选择一条数据')}});$('.special-cancel').click(function(){me.hideSpecialAlert();$('.special-val').val('');me.getPriorApprovalList()});$('.special-search').click(function(){me.getPriorApprovalList()});$('.special-reset').click(function(){$('.special-val').val('');me.getPriorApprovalList()})},showSpecialAlert:function(){var alert=$('.special-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideSpecialAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.special-alert').hide();$('#pop-modle-alert').hide()},getPriorApprovalList:function(){var tbody=$('.prior-approval-list tbody');var queryParams=$('.prior-approval-val').val();var pageDiv=$('.prior-page');$('.prior-page').pageInfo({pageIndex:1,pageNum:5,pageSize:3,url:"sz/advanceApp/getAdvanceAppListToPageByParams",objName:'data',data:{queryParams:queryParams},success:function(data){tbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){pageDiv.show();$.each(data.data.rows,function(i,n){trStr+='<tr pid="'+n.advanceAppId+'" code="'+n.advanceAppNum+'"><td>'+n.advanceAppNum+'</td><td>'+n.applicantUserName+'</td><td>'+n.applicantUserDeptName+'</td><td>'+n.advanceAppName+'</td><td>'+n.advanceCostTypeName+'</td><td>'+n.applicantTime+'</td><td>XX专项</td></tr>'});tbody.append(trStr)}else{pageDiv.hide();var noTr='<tr class="model-no-data-tr"><td colspan="7"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';tbody.append(noTr)}}}})},getBorrowList:function(){var tbody=$('.borrow-list tbody');var pageDiv=$('.borrow-page');var queryParams=$('.borrow-val').val();$('.borrow-page').pageInfo({pageIndex:1,pageNum:5,pageSize:3,url:"sz/loanApp/getUserLoanAppInfoListToPageByParams",objName:'data',data:{queryParams:queryParams},success:function(data){tbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){pageDiv.show();$.each(data.data.rows,function(i,n){trStr+='<tr code="'+n.loanAppNum+'"><td>'+n.loanAppNum+'</td><td>'+n.applicantUserName+'</td><td>'+n.applicantUserDeptName+'</td><td>'+n.loanAppName+'</td><td>'+n.applicantTime+'</td><td style="text-align: right;"><span class="loanApp-balance">'+(n.loanAppBalance==""?"":($yt_baseElement.fmMoney(n.loanAppBalance)))+'</span></td></tr>'});tbody.append(trStr)}else{pageDiv.hide();var noTr='<tr class="model-no-data-tr"><td colspan="6"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';tbody.append(noTr)}}}})},getSpecialList:function(){var tbody=$('.special-list tbody');var pageDiv=$('.special-page');var quertStr=$('.special-val').val();$('.special-page').pageInfo({pageIndex:1,pageNum:5,pageSize:3,url:"sz/travelApp/getUserTravelAppListByParams",objName:'data',data:{},success:function(data){tbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){pageDiv.show();$.each(data.data.rows,function(i,n){trStr+='<tr code="ZX201804011"><td>ZX201804011</td><td>人工智能研发</td><td style="text-align:right;">10,000.00</td><td>8,500.00</td></tr>'});tbody.append(trStr)}else{pageDiv.hide();var noTr='<tr class="model-no-data-tr"><td colspan="4"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';tbody.append(noTr)}}}})},getCostTypeList:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getCostTypeList",async:true,data:{dictTypeCode:'COST_TYPE'},success:function(data){var list=data.data||[];var opts='<option value="">请选择</option>';$.each(list,function(i,n){opts+='<option fun="'+n.jsFun+'" value="'+n.costCode+'">'+n.costName+'</option>'});$('select.expense-type').html(opts).niceSelect()}})},getDictInfoByTypeCode:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:true,data:{dictTypeCode:'ACTIVITY_PRO,SPECIFIC_COST_TYPE,TRAVEL_TYPE,VEHICIE_CODE,HOTEL_ADDRESS,COST_TYPE'},success:function(data){var list=data.data||[];var start='<option value="">请选择</option>',optone=start,opttwo=start,travelType=start,vehicieCode=start,hotel=start,cost=start;$.each(list,function(i,n){if(n.dictTypeCode=='ACTIVITY_PRO'){optone+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='SPECIFIC_COST_TYPE'){opttwo+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='TRAVEL_TYPE'){travelType+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='VEHICIE_CODE'){vehicieCode+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='HOTEL_ADDRESS'){hotel+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='COST_TYPE'){cost+='<option value="'+n.value+'">'+n.disvalue+'</option>'}});$('#budgetProject').html(optone).niceSelect();$('#costBreakdown').html(opttwo).niceSelect();$('#modelBusiType').html(travelType).niceSelect();$('select.vehicle-sel').html(vehicieCode).on("change",function(){var selVal=$(this).val();sysCommon.vechicleChildData(selVal)}).niceSelect();$('select.cost-type-sel').html(cost).niceSelect()}})},clearAlert:function(obj){var selects=obj.find('select');$.each(selects,function(i,n){$(n).find('option:first-child').attr('selected',true)});selects.niceSelect();var inputs=obj.find('input:not(input[type="radio"],input[type="checkbox"])');inputs.val('');var radios=obj.find('input[type="radio"]');$.each(radios,function(i,n){$(n).setRadioState('uncheck')});var checks=obj.find('input[type="checkbox"]');$.each(checks,function(i,n){$(n).setCheckBoxState('uncheck')});var textareas=obj.find('textarea')},submitReimAppInfo:function(subData){$.ajax({type:"post",url:"sz/reimApp/submitReimAppInfo",async:true,data:subData,success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/expensesReim/module/reimApply/reimApproveList.html'}})}}})},saveReimAppInfoToDrafts:function(subData){$.ajax({type:"post",url:"sz/reimApp/saveReimAppInfoToDrafts",data:subData,success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/expensesReim/module/reimApply/reimApproveList.html'}})}}})},getReimAppInfoDetailByReimAppId:function(reimAppId){var me=this;$.ajax({type:"post",url:"sz/reimApp/getReimAppInfoDetailByReimAppId",data:{reimAppId:reimAppId},success:function(data){me.showDetail(data.data)}})},getCostAppInfoDetailByParams:function(appId,costType){var me=this;$.ajax({type:"post",url:"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{appId:appId,costType:costType},success:function(data){me.showCostDetail(data.data)}})},getReimPreviewDetailByReimAppId:function(reimAppId,previewFalg,qrCodeContext){var me=this;$.ajax({type:"post",url:"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{reimAppId:reimAppId,previewFalg:previewFalg,qrCodeContext:qrCodeContext},success:function(data){}})},getSubData:function(){var getFileList=function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length-1?',':'')});return str};var costReceptionistList=function(){var list=[];var trs=$('.msg-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costReceptionistId:tr.attr('pkId'),name:tr.find('.name-text').text(),jobName:tr.find('.job-text').text(),unitName:tr.find('.unit-text').text(),})});return list};var costDetailsList=function(){var list=[];var trs=$('#paymentList tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costDetailsId:tr.attr('pkId'),publicServiceProCode:tr.attr('budgetcode'),activityDate:tr.find('.act-date').text(),placeName:tr.find('.place-name').text(),costType:tr.attr('costcode'),standardAmount:tr.find('.stan-money').attr('money'),activityAmount:tr.find('.money').attr('money'),peopleNum:tr.find('.people-num').text(),setMethod:$('#paymentList').next().find('.check-label.check input').val()})});return list};var tripPlanList=function(){var list=[];var trs=$('#tripList tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelType:tr.attr('busicode'),travelAddress:tr.find('.address').attr('val'),travelAddressName:tr.find('.address').text(),startTime:tr.find('.sdate').text(),endTime:tr.find('.edate').text(),travelPersonnels:tr.attr('usercode'),receptionCostItem:tr.attr('rececode'),setMethod:$('#tripList').next().find('.check-label.check input').val()})});return list};var carfareList=function(){var costCarfareList=[];var costCarfareJson="";var cityDatas;if($("#traffic-list-info tbody tr:not(.total-last-tr)").length>0){$("#traffic-list-info tbody tr:not(.total-last-tr)").each(function(i,n){cityDatas=$(this).getDatas();cityDatas.crafare=$yt_baseElement.rmoney(cityDatas.crafare);cityDatas.setMethod=$('#traffic-list-info').next().find('.check-label.check input').val();if($(this).find(".hid-child-code").val()=="null"||$(this).find(".hid-child-code").val()==""){cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."}else{cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."+$(this).find(".hid-child-code").val()+"."}costCarfareList.push(cityDatas)})}return costCarfareList};var hotelList=function(){var costHotelList=[];var costHotelJson="";var hotelDatas;if($("#hotel-list-info tbody tr:not(.total-last-tr)").length>0){$("#hotel-list-info tbody tr:not(.total-last-tr)").each(function(i,n){hotelDatas=$(this).getDatas();hotelDatas.hotelExpense=$yt_baseElement.rmoney(hotelDatas.hotelExpense);hotelDatas.setMethod=$('#hotel-list-info').next().find('.check-label.check input').val();costHotelList.push(hotelDatas)});if(costHotelList.length>0){costHotelJson=JSON.stringify(costHotelList)}}return costHotelList};var otherList=function(){var costOtherList=[];var costOtherJson="";var otherDatas;if($("#other-list-info tbody tr:not(.total-last-tr)").length>0){$("#other-list-info tbody tr:not(.total-last-tr)").each(function(i,n){otherDatas=$(this).getDatas();otherDatas.reimAmount=$yt_baseElement.rmoney(otherDatas.reimAmount);otherDatas.setMethod=$('#other-list-info').next().find('.check-label.check input').val();costOtherList.push(otherDatas)});if(costOtherList.length>0){costOtherJson=JSON.stringify(costOtherList)}}return costOtherList};var costSubsidyList=function(){var list=[];var trs=$('#subsidy-list-info tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelPersonnel:tr.find('.user').attr('code'),subsidyDays:tr.find('.subsidy-num').text(),subsidyFoodAmount:tr.find('.food').attr('num'),carfare:tr.find('.traffic').attr('num'),setMethod:''})});return list};var costData=function(){return JSON.stringify({costReceptionistList:costReceptionistList(),costDetailsList:costDetailsList(),travelRouteList:tripPlanList(),costCarfareList:carfareList(),costHotelList:hotelList(),costOtherList:otherList(),costSubsidyList:costSubsidyList()})};return{advanceAppId:$('#advanceAppId').val(),loanAppId:$('#loanAppId').val(),reimAppId:$('#reimAppId').val(),reimAppNum:$('#reimAppNum').val(),reimAppName:$('#reimAppName').val(),costType:$('select.expense-type option:selected').val(),isSpecial:$('#isSpecial .check input').val(),specialCode:$('#specialCode').val(),invoiceNum:$('#invoiceNum').val(),totalAmount:$('#applyTotalMoney').attr('num'),writeOffAmount:$('#writeOffAmount').attr('num'),officialCard:$('.amount-table .official').val(),cash:$('.amount-table .cash').val(),cheque:$('.amount-table .cheque').val(),transfer:0,attIdStr:getFileList(),paymentDate:'',paymentAmount:0,cmTotalAmount:0,cmWriteOffAmount:0,cmOfficialCard:0,cmCash:0,cmCheque:0,cmTransfer:0,applicantUser:$('#applicantUser').val(),parameters:'',dealingWithPeople:$('#approve-users option:selected').val(),opintion:$('#opintion').val(),processInstanceId:'',nextCode:$('#operate-flow option:selected').val(),costData:costData(),billingVoucherJson:''}},showDetail:function(d){var me=this;$('#advanceAppId').val(d.advanceAppId);$('#loanAppId').val(d.loanAppId);$('#reimAppId').val(d.reimAppId);$('#reimAppNum').val(d.reimAppNum);$('#formNum').text(d.reimAppNum);$('#reimAppName').val(d.reimAppName);$('select.expense-type option[value="'+d.costType+'"]').attr('selected',true);$('select.expense-type').niceSelect();$('#special'+d.isSpecial).setRadioState('check');$('#specialCode').val(d.specialCode);$('.special-name').val(d.specialName);$('#invoiceNum').val(d.invoiceNum);$('#applyTotalMoney').text(d.totalAmount).attr('num',d.totalAmount);$('#amountTotalMoney').text(d.totalAmount).attr('num',d.totalAmount);$('#paymentList .total-money').text(d.totalAmount).attr('num',d.totalAmount);$('#writeOffAmount').text(d.totalAmount).attr('num',d.totalAmount);$('input.official').val(d.officialCard);$('input.cash').val(d.cash);$('input.cheque').val(d.cheque);$('#applicantTime').text(d.applicantTime);$('#operate-flow option[value="'+d.nodeNowState+'"]').attr('selected',true);$('#processInstanceId').val(d.processInstanceId);$('#approve-users option[value="'+d.currentAssignee+'"]').attr('selected',true);$('#operate-flow,#approve-users').niceSelect();me.showFileList(d.attList);me.showCostDetail(d.costData);},showCostDetail:function(data){var me=this;var costReceptionistList=data.costReceptionistList;var costDetailsList=data.costDetailsList;var receHtml='';$.each(costReceptionistList,function(i,n){receHtml+='<tr pkId="'+n.costReceptionistId+'" class="" nameVal="'+n.name+'" dutyVal="'+n.jobName+'" deptVal="'+n.unitName+'"><td><span class="num">1</span></td><td><span class="name-text">'+n.name+'</span></td><td><span class="job-text">'+n.jobName+'</span></td><td><span class="unit-text">'+n.unitName+'</span></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('.msg-list tbody').append(receHtml);me.resetNum($('.msg-list'));var detaHtml='';$.each(costDetailsList,function(i,n){detaHtml+='<tr pkId="'+n.costDetailsId+'" budgetCode="'+n.publicServiceProCode+'" costCode="'+n.costType+'" budgetProject="'+n.publicServiceProName+'" applyDate="'+n.activityDate+'" siteVal="'+n.placeName+'" costBreakdown="'+n.costTypeName+'" standardMoney="'+n.standardAmount+'" budgetMoney="'+n.activityAmount+'" accompanyNum="'+n.peopleNum+'"><td><span class="">'+n.publicServiceProName+'</span></td><td><span class="act-date">'+n.activityDate+'</span></td><td><span class="place-name">'+n.placeName+'</span></td><td><span>'+n.costTypeName+'</span></td><td style="text-align: right;"><div class="stan-money" money='+n.standardAmount+'>'+n.standardAmount+'</div></td><td style="text-align: right;"><div class="money" money='+n.activityAmount+'>'+n.activityAmount+'</div></td><td><span class="people-num">'+n.peopleNum+'</span></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#paymentList tbody .last').before(detaHtml)},showFileList:function(list){var ls='';$.each(list,function(i,n){ls+='<div fId="'+n.attId+'" class="li-div"><span>'+n.attName+'</span><span class="del-file">x</span></div>'});$('#attIdStr').html(ls)},showBusinessFun:function(){$('.business-div').show();},showGeneralFun:function(){$('.general-div').show();},showTravelFun:function(){$('.travel-div').show()},showTrainFun:function(){},showMettingFun:function(){},busiTripUserModelEvent:function(busiInputObj,autoFontObj,userNumObj,clickFlag){var me=this;var busiTripUserModel=$("#busiTripUserModel");$("#searchUser").off().on("click",function(){me.getBusiTripUsersList($("#userPram").val())});$("#userPram").on("keyup",function(){me.getBusiTripUsersList($(this).val())});$("#busiUserInfo ul li").off("click").on("click",function(){var usersDatas="";if($(this).hasClass("tr-check")){$(this).removeClass("tr-check");me.selUsersName="";me.selUsersCode="";$("#busiUserInfo ul li.tr-check").each(function(i,n){usersDatas=$(this).data("userData");me.selUsersName+=usersDatas.userName+"、";me.selUsersCode+=usersDatas.userItcode+","})}else{$(this).addClass("tr-check");usersDatas=$(this).data("userData");me.selUsersName+=usersDatas.userName+"、";me.selUsersCode+=usersDatas.userItcode+",";var checkUsersCodes="";$("#tripList tbody .hid-user-code").each(function(){checkUsersCodes+=$(this).val()+","});var selUsersCode=","+usersDatas.userItcode+",";if(checkUsersCodes!=""&&checkUsersCodes!=undefined){checkUsersCodes=","+checkUsersCodes}if(checkUsersCodes.indexOf(selUsersCode)<0){var userLevel=usersDatas.jobLevelName=="--"?"":usersDatas.jobLevelName;me.usersInfoList=me.usersInfoList+'{"userItcode":"'+usersDatas.userItcode+'","jobLevelName":"'+usersDatas.jobLevelName+'","userName":"'+usersDatas.userName+'"},'}}var selTr=$("#busiUserInfo ul li.tr-check");if(selTr!=""&&selTr.length>0){var selUser="";var userCode="";selUser=me.selUsersName.substring(0,me.selUsersName.length-1);userCode=me.selUsersCode.substring(0,me.selUsersCode.length-1);$(busiInputObj).val(selUser);$(busiInputObj).prev("input[type=hidden]").val(userCode);$(autoFontObj).hide();$(userNumObj).show();var userNums=selUser.split("、");$(userNumObj).find(".users-num").text(userNums.length);sysCommon.clearValidInfo(busiInputObj);$("#clearUser").show()}else{$(busiInputObj).val('');$(busiInputObj).prev("input[type=hidden]").val('');$(autoFontObj).show();$(userNumObj).hide();$(userNumObj).find(".users-num").text(0);$(busiInputObj).next(".valid-font").text("请选择出差人");$(busiInputObj).addClass("valid-hint");me.selUsersName="";me.selUsersCode="";me.usersInfoList="";me.usersInfoJson="";var optionText='<option value="">请选择</option>';$("#model-trip-user,#hotel-trip-user").empty().append(optionText);$("#model-trip-user,#hotel-trip-user").niceSelect();$("#clearUser").hide()}});$("#clearUser").click(function(){$(busiInputObj).val('');$(busiInputObj).prev("input[type=hidden]").val('');$(autoFontObj).show();$(userNumObj).hide();$(userNumObj).find(".users-num").text(0);$(busiInputObj).next(".valid-font").text("请选择出差人");$(busiInputObj).addClass("valid-hint");me.selUsersName="";me.selUsersCode="";me.usersInfoList="";me.usersInfoJson="";var optionText='<option value="">请选择</option>';$("#model-trip-user,#hotel-trip-user").empty().append(optionText);$("#model-trip-user,#hotel-trip-user").niceSelect();$("#busiUserInfo ul li").removeClass("tr-check")});$("#busiUserInfo").mouseleave(function(){$(this).hide();$(this).addClass("check")})},getBusiTripUsersList:function(keyword){var me=this;$.ajax({type:"post",url:'user/userInfo/getAllUserInfoToPage',async:true,data:{params:keyword,pageIndex:1,pageNum:99999},success:function(data){if(data.flag==0){$("#busiUserInfo ul").empty();var liStr="";if(data.data.rows.length>0){$.each(data.data.rows,function(i,n){liStr=$('<li>'+n.userName+'/'+n.deptName+'</li>');liStr.data("userData",n);$("#busiUserInfo ul").append(liStr)});if($("#modelUserCodes").val()!=""){var usersCodes=$("#modelUserCodes").val().split(",");$("#busiUserInfo ul li").each(function(i,t){$.each(usersCodes,function(i,l){if($(t).data("userData").userItcode==l){$(t).addClass("tr-check")}})})}me.busiTripUserModelEvent($("#modelBusiUser"),$("#busiPlanEditModel .auto-font"),$(".model-user-num-show"),1)}else{$("#busiUserInfo ul").append('<li style="text-align: center;">暂无数据</li>')}}}})},hotelAddressChild:function(addressCode,addressLevel){var me=this;$("#hotelTwoAddres").niceSelect({search:true,backFunction:function(text){$("#hotelTwoAddres option").remove();if(text==""){$("#hotelTwoAddres").append('<option value="">请选择</option>')}$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1&&n.parentCode==addressCode&&addressLevel=="CITY"){$("#hotelTwoAddres").append('<option value="'+n.regionCode+'">'+n.regionName+'</option>')}})}});},hotelAddressArea:function(addressCode,addressLevel){var me=this;$("#hotelChildAddres").niceSelect({search:true,backFunction:function(text){$("#hotelChildAddres option").remove();if(text==""){$("#hotelChildAddres").append('<option value="">请选择</option>')}$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1&&n.parentCode==addressCode&&addressLevel=="AREA"){$("#hotelChildAddres").append('<option value="'+n.regionCode+'">'+n.regionName+'</option>')}})}});},setAddress:function(){var me=this;$.ajax({type:"get",url:$yt_option.websit_path+'resources-sasac/js/system/expensesReim/module/reimApply/regionList.json',async:false,success:function(data){var dataList=data;me.addressList=data;me.setAddressSelect()}})},setAddressSelect:function(){var me=this;$("#hotelParentAddress").niceSelect({search:true,backFunction:function(text){$("#hotelParentAddress option").remove();if(text==""){$("#hotelParentAddress").append('<option value="">请选择</option>')}$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1&&n.regionLevel=='PROVINCE'){$("#hotelParentAddress").append('<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" >'+n.regionName+'</option>')}})}});$("#hotelParentAddress").on("change",function(){var thisSel=$(this);$("#hotelTwoAddres,#hotelChildAddres").html('').append('<option value="">请选择</option>');me.hotelAddressChild(thisSel.val(),"CITY")});$("#hotelTwoAddres").on("change",function(){var thisSel=$(this);$("#hotelChildAddres").html('').append('<option value="">请选择</option>');me.hotelAddressArea(thisSel.val(),"AREA")});me.getPlanBusiAddress($("#modelBusiAddres"))},hotelChildDisa:function(addressCode,addressLevel){var me=this;if(addressLevel=="CITY"){var disaFlag=true;if($("#hotelTwoAddres option").length<1){$("#hotelTwoAddres,#hotelChildAddres").prop("disabled","disabled");$("#hotelTwoAddres,#hotelChildAddres").removeAttr("validform");sysCommon.clearValidInfo($("div.hotel-child-addres,div.hotel-two-addres,#hotelTwoAddres,#hotelChildAddres"))}else{$("#hotelTwoAddres,#hotelChildAddres").prop("disabled","");$("#hotelTwoAddres").attr("validform","{isNull:true,changeFlag:true,msg:'请选择市'}");$("#hotelChildAddres").attr("validform","{isNull:true,changeFlag:true,msg:'请选择区'}");disaFlag=false}me.hotelAddressChild(addressCode,addressLevel);me.hotelAddressArea(addressCode,addressLevel);if(disaFlag){$("div.hotel-child-addres,div.hotel-two-addres").css("background-color","#D0D0D0")}}else if(addressLevel=="AREA"){var disaFlag=true;if($("#hotelChildAddres option").length<1){$("#hotelChildAddres").prop("disabled","disabled")}else{$("#hotelChildAddres").prop("disabled","");disaFlag=false}me.hotelAddressArea(addressCode,addressLevel);if(disaFlag){$("div.hotel-child-addres").css("background-color","#D0D0D0")}}},getModelUsersInfo:function(){var me=this;if(me.usersInfoList!=""&&me.usersInfoList!=null){me.usersInfoJson="["+me.usersInfoList+"]";me.usersInfoJson=me.usersInfoJson.substr(0,me.usersInfoJson.length-2);me.usersInfoJson+="]"}var optionText='<option value="">请选择</option>';$("#model-trip-user,#hotel-trip-user").empty().append(optionText);if(me.usersInfoJson!=""&&me.usersInfoJson.length>0){me.usersInfoJson=eval("("+me.usersInfoJson+")");$.each(me.usersInfoJson,function(i,n){optionText='<option value="'+n.userItcode+'" data-level="'+n.jobLevelName+'">'+n.userName+'</option>';$("#model-trip-user,#hotel-trip-user").append(optionText)})}$("#model-trip-user,#hotel-trip-user").niceSelect()},updateApplyMeonySum:function(){var sumMoney=0;$(".cost-list-model table .money-sum").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});$(".cost-list-model table .city-money-td").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});var rMoney=$yt_baseElement.fmMoney(sumMoney);$("#applyTotalMoney").text(rMoney).attr('num',sumMoney);if($("body").find("#reimPrice")){$("#reimPrice").text(rMoney);var loanPrice=$("#loanCost").text();var replPrice=sumMoney-parseFloat(loanPrice);replPrice=$yt_baseElement.fmMoney(replPrice);$("#givePrice").text(replPrice)}if(sumMoney!=null&&sumMoney!=undefined&&sumMoney>0){var sumMoneyLower=arabiaToChinese(rMoney);$("#TotalMoneyUpper").text(sumMoneyLower)}else{$("#applyTotalMoney").text("0.00")}$('#amountTotalMoney').text(rMoney).attr('num',sumMoney);var writeOffAmount=$('#writeOffAmount').attr('num');var num=sumMoney- +writeOffAmount;if(num>0){$('#replaceMoney').text($yt_baseElement.fmMoney(num)).attr('num',num)}else{$('#balanceMoney').text($yt_baseElement.fmMoney(num)).attr('num',num)}},updateMoneySum:function(thisTab){var me=this;var moenySum=0.00;if(thisTab==0){$("#traffic-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#traffic-list-info tbody .money-sum").text(moenySum)}else{$("#traffic-list-info tbody .money-sum").text("0.00")}}if(thisTab==1){$("#hotel-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#hotel-list-info tbody .money-sum").text(moenySum)}else{$("#hotel-list-info tbody .money-sum").text("0.00")}}if(thisTab==2){$("#other-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#other-list-info tbody .money-sum").text(moenySum)}else{$("#other-list-info tbody .money-sum").text("0.00")}}if(thisTab==3){$("#subsidy-list-info tbody .food-money").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#subsidy-list-info tbody .money-sum").text(moenySum)}else{$("#subsidy-list-info tbody .money-sum").text("0.00")}var cityMoneySum=0.00;$("#subsidy-list-info tbody .city-money").each(function(i,n){cityMoneySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});cityMoneySum=$yt_baseElement.fmMoney(cityMoneySum);if(cityMoneySum!=undefined&&$yt_baseElement.rmoney(cityMoneySum)>0){$("#subsidy-list-info tbody .city-money-td").text(cityMoneySum)}else{$("#subsidy-list-info tbody .city-money-td").text("0.00")}}me.updateApplyMeonySum()},setSubsidyList:function(){var me=this;var userList=me.usersInfoList.length>0?eval('['+me.usersInfoList+']'):[];var html='';$.each(userList,function(i,n){html+='<tr class="'+n.userItcode+'" code="'+n.userItcode+'"><td><div class="user" code="'+n.userItcode+'">'+n.userName+'</div></td><td><div class="lv">'+n.jobLevelName+'</div></td><td><div class="subsidy-num">0</div></td><td><div style="text-align:right;" class="food">0.00</div></td><td><div  style="text-align:right;" class="traffic">0.00</div></td><td><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});html+='<tr class="last"><td>合计</td><td></td><td></td><td class="total-food"  style="text-align:right;">0.00</td><td class="total-traffic"  style="text-align:right;">0.00</td><td></td></tr>';var jqHtml=$(html);var trip=$('#tripList tbody tr');var code='',tr=[],jqTr=[],day=0,totalFood=0,totalTraffic=0;$.each(trip,function(i,n){tr=$(n);codeList=tr.attr('usercode').length>0?tr.attr('usercode').split(','):[];day= +tr.find('.day').text();$.each(codeList,function(j,m){jqTr=jqHtml.siblings('[code="'+m+'"]');if(jqTr.length>0){var d= +(jqTr.find('.subsidy-num').text())+day;jqTr.find('.subsidy-num').text(d);jqTr.find('.food').text($yt_baseElement.fmMoney(d*100)).attr('num',d*100);jqTr.find('.traffic').text($yt_baseElement.fmMoney(d*80)).attr('num',d*80)}})});jqHtml.find('.total-food').text($yt_baseElement.fmMoney(totalFood)).attr('num',totalFood);jqHtml.find('.total-traffic').text($yt_baseElement.fmMoney(totalTraffic)).attr('num',totalTraffic);$('#subsidy-list-info tbody').html(jqHtml);me.setSubsidyTotal()},setSubsidyTotal:function(){var trs=$('#subsidy-list-info tbody tr:not(.last)');var totalFood=0,totalTraffic=0,tr=[];$.each(trs,function(i,n){tr=$(n);totalFood+= +(tr.find('.food').attr('num'));totalTraffic+= +(tr.find('.traffic').attr('num'))});$('#subsidy-list-info tbody .total-food').text($yt_baseElement.fmMoney(totalFood)).attr('num',totalFood);$('#subsidy-list-info tbody .total-traffic').text($yt_baseElement.fmMoney(totalTraffic)).attr('num',totalTraffic)},clearFormData:function(){var modelObj=$("#costApplyAlert");$(".traffic-form input:not(.hid-risk-code),.hotel-form input:not(.hid-risk-code),.other-form input:not(.hid-risk-code)").val('');modelObj.find("textarea").val('');modelObj.find("select").each(function(i,n){$(n).find("option:eq(0)").attr("selected","selected")});$("#vehicleTwoDiv").hide();modelObj.find("#hotelTwoAddres,#hotelChildAddres,#fromcity,#tocity").html('').append('<option value="">请选择</option>');modelObj.find("select").niceSelect();modelObj.find(".yt-numberInput").val(1);modelObj.find("#peoDayMoney").text("0.00");modelObj.find("#hotelDay").text("*");$(".cost-type-tab ul li").removeClass("tab-check");$(".cost-type-tab ul li:eq(0)").addClass("tab-check");$(".traffic-form").show();$(".hotel-form,.other-form").hide();$("#model-add-list-btn").show();$("#model-sure-btn").hide();modelObj.find(".risk-img").attr("src",sysCommon.riskExcMark);modelObj.find(".valid-font").text("");modelObj.find(".valid-hint").removeClass("valid-hint")},getPlanBusiAddress:function(labelObj){var me=this;$(labelObj).niceSelect({search:true,backFunction:function(text){$(labelObj).find("option").remove();var opt='';opt+='<option   disabled="disabled">支持模糊搜索省/市/区</option>';if(text==""){$.each(me.addressList,function(i,n){if(n.regionLevel=="PROVINCE"){opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'</option>'}})}else{$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1){n.regionMergerName=n.regionMergerName.substr(3);opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'/'+n.regionMergerName+'</option>'}if(n.regionNamePinYin.indexOf(text)!=-1){n.regionMergerName=n.regionMergerName.substr(3);opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'/'+n.regionMergerName+'</option>'}})}$(labelObj).append(opt)}})}};$(function(){serveFunds.init()})})(jQuery,window);