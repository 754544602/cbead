(function($,window){var serveExamine={init:function(){var ts=this;var pid=$yt_common.GetQueryString('reimId');ts.getReimAppInfoDetailByReimAppId(pid);sysCommon.getLoginUserInfo();ts.getDictInfoByTypeCode();ts.start();ts.events()},start:function(){$('select').niceSelect();$('#paymentDate').calendar({speed:0,nowData:false})},events:function(){var me=this;$('.file-box').on('click','.del-file',function(){var ithis=$(this);var parent=ithis.parent();$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){parent.remove()}})});$('.money-input').on('focus',function(){var ts=$(this);if(ts.val()!=""){ts.val($yt_baseElement.rmoney(ts.val()))}});$('.money-input').on('blur',function(){var ts=$(this);if(ts.val()!=''){ts.val($yt_baseElement.fmMoney(ts.val()))}});$('.money-input').on('keyup',function(){var ts=$(this);if(ts.val()!=''){ts.val(ts.val().replace(/[^\d.]/g,''))}});$('.amount-table .money-input').blur(function(){var body=$('.payment-detail .amount-table');var official=Number($yt_baseElement.rmoney(body.find('.official').val()||'0'));var cash=Number($yt_baseElement.rmoney(body.find('.cash').val()||'0'));var cheque=Number($yt_baseElement.rmoney(body.find('.cheque').val()||'0'));var transfer=Number($yt_baseElement.rmoney(body.find('.transfer').val()||'0'));var total=official+cash+cheque+transfer;body.find('.total').text($yt_baseElement.fmMoney(total));if($('.payroll-working').is(':visible')){body=$('.payroll-working .amount-table');var cmOfficialCard=$yt_baseElement.rmoney($('#cmOfficialCard').val()||'0');var cmCash=$yt_baseElement.rmoney($('#cmCash').val()||'0');var cmCheque=$yt_baseElement.rmoney($('#cmCheque').val()||'0');var cmTotal=cmOfficialCard+cmCash+cmCheque;var replaceMoney=$yt_baseElement.rmoney($('#cmReplaceMoney').text()||'0');if(replaceMoney>0&&total>replaceMoney){$(this).focus();$yt_alert_Model.prompt('金额不能大于补领金额金额')}else{var rtotal=me.fmMoney(cmTotal);body.find('.total').text(rtotal).attr('num',cmTotal)}}});$('#submitPayment').on('click',function(){var thisBtn=$(this);thisBtn.attr('disabled',true).addClass('btn-disabled');if($yt_valid.validForm($('.approve-div'))){var cmReplaceMoney=me.rmoney($('#cmReplaceMoney').text());var total=me.rmoney($('.payroll-working .amount-table .total').text());var paymentAmount=me.rmoney($('#paymentAmount').val());if($(".payroll-working").is(':visible')&&paymentAmount!=cmReplaceMoney){$yt_alert_Model.prompt('补领方式金额合计必须等于补领金额')}else if($(".payroll-working").is(':visible')&&total!=cmReplaceMoney){$yt_alert_Model.prompt('支付金额不等于补领金额')}else{var d=me.getSubData();var costData=me.saveData.costData;d.costData=typeof(costData)=='string'?costData:JSON.stringify(costData);me.submitReimAppInfo(d,thisBtn)}}else{thisBtn.attr('disabled',false).removeClass('btn-disabled')}});me.tallyListEvent();$('.yt-table tbody').on('click','tr',function(){var ts=$(this);var trs=ts.siblings();trs.removeClass('yt-table-active');ts.addClass('yt-table-active')})},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},rmoney:function(str){return $yt_baseElement.rmoney(str||'0')},paymentListEvent:function(){var me=this;$('#addProcuList').on('click',function(){me.showPaymentAlert()});$("#paymentAddBtn").on('click',function(){var budgetProject=$('#budgetProject option:selected').text();var budgetMoney=$('#budgetMoney').val();var specialNum=$('#specialNum').text();var html='<tr> <td>'+budgetProject+'</td> <td style="text-align: right;">'+budgetMoney+'</td> <td>'+specialNum+'</td> <td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td> </tr>';$('#paymentList tbody').append(html);me.hidePaymentAlert()});$('#paymentList').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})});$('#paymentList').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');me.showPaymentAlert()});$('#paymentCanelBtn').on('click',function(){me.hidePaymentAlert()})},showPaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hidePaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.hideMongoliaLayer();alert.hide();$('#pop-modle-alert').hide()},serveExamineEvent:function(){$('.prior-approval').click(function(){$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('.prior-alert'));$('#pop-modle-alert').show();$('.prior-alert').show()});$('.prior-common').click(function(){var code=$('.prior-approval-list .yt-table-active').attr('code');if(code){$('.prior-approval').val(code);$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()}else{$yt_alert_Model.prompt('请选择一条数据')}});$('.prior-cancel').click(function(){$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()})},tallyListEvent:function(){var me=this;$('.add-tally').click(function(){me.showMsgAlert();$('.tally-common').off().on('click',function(){me.appendMsgList()}).text('添加到列表')});$('.tally-cancel').click(function(){me.hideMsgAlert();me.clearAlert($('.msg-alert'))});$('.tally-list').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})});$('.tally-list').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var loanType=$('#loanType option[value="'+tr.attr('loanCode')+'"]').attr('selected',true);var abstract=$('#abstract').val(tr.attr('abstract'));var totalSubject=$('#totalSubject').val(tr.attr('totalSubject'));var detailSubject=$('#detailSubject').val(tr.attr('detailSubject'));var tallyMoney=$('#tallyMoney').val(tr.attr('tallyMoney'));$('#loanType').niceSelect();me.showMsgAlert();$('.tally-common').off().on('click',function(){me.appendMsgList(tr)}).text('确定')})},appendMsgList:function(tr){var me=this;if($yt_valid.validForm($('.tally-alert'))){var loanType=$('#loanType option:selected').text();var loanCode=$('#loanType option:selected').val();var abstract=$('#abstract').val();var totalSubject=$('#totalSubject').val();var detailSubject=$('#detailSubject').val();var tallyMoney=$('#tallyMoney').val();var totalText='';var detailText='';if(loanType=='DEBIT_ENTRY'){totalText=tallyMoney}else{detailText=tallyMoney}var html='<tr pid="" class="" loanCode="'+loanCode+'" loanType="'+loanType+'" abstract="'+abstract+'" totalSubject="'+totalSubject+'" detailSubject="'+detailSubject+'" tallyMoney="'+tallyMoney+'"><td>'+abstract+'</td><td>'+totalSubject+'</td><td>'+detailSubject+'</td><td>'+totalText+'</td><td>'+detailText+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(html)}else{$('.tally-list').append(html)}me.hideMsgAlert();me.clearAlert($('.tally-alert'))}else{}},showMsgAlert:function(){var alert=$('.tally-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideMsgAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.tally-alert').hide();$('#pop-modle-alert').hide()},clearAlert:function(obj){var selects=obj.find('select');$.each(selects,function(i,n){$(n).find('option:first-child').attr('selected',true)});selects.niceSelect();var inputs=obj.find('input');inputs.val('')},getReimAppInfoDetailByReimAppId:function(reimAppId){var me=this;$.ajax({type:"post",url:"sz/reimApp/getReimAppInfoDetailByReimAppId",async:true,data:{reimAppId:reimAppId},success:function(data){var d=data.data;me.saveData=d;if(d.jsFun){me[d.jsFun]()}sysCommon.getApproveFlowData("SZ_REIM_APP",d.processInstanceId);me.showDetail(d);if(d.taskKey=='activitiEndTask'){$('.payroll-working').show();$('#approve-users').attr("validform","{isNull:false,msg:'请选择审批人'}")}else{$('.payroll-working').hide();$('#submitPayment').text('提交');}$('.check-label').off('click');$('.check-label input').attr('disabled',true).off('click')}})},getCostAppInfoDetailByParams:function(appId,costType){var me=this;$.ajax({type:"post",url:"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{appId:appId,costType:costType},success:function(data){me.showCostDetail(data.data)}})},getReimPreviewDetailByReimAppId:function(reimAppId,previewFalg,qrCodeContext){var me=this;$.ajax({type:"post",url:"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{reimAppId:reimAppId,previewFalg:previewFalg,qrCodeContext:qrCodeContext},success:function(data){}})},getSubData:function(){var getFileList=function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length?',':'')});return str};var costReceptionistList=function(){var list=[];var trs=$('.msg-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costReceptionistId:tr.attr('pkId'),name:tr.find('.name-text').text(),jobName:tr.find('.job-text').text(),unitName:tr.find('.unit-text').text(),})});return list};var costDetailsList=function(){var list=[];var trs=$('#paymentList tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costDetailsId:tr.attr('pkId'),publicServiceProCode:tr.attr('budgetcode'),activityDate:tr.find('.act-date').text(),placeName:tr.find('.place-name').text(),costType:tr.attr('costcode'),standardAmount:tr.find('.stan-money').attr('money'),activityAmount:tr.find('.money').attr('money'),peopleNum:tr.find('.people-num').text(),setMethod:''})});return list};var tripPlanList=function(){var list=[];var trs=$('#tripList tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelType:tr.attr('busicode'),travelAddress:tr.find('.address').attr('val'),travelAddressName:tr.find('.address').text(),startTime:tr.find('.sdate').text(),endTime:tr.find('.edate').text(),travelPersonnels:tr.attr('usercode'),receptionCostItem:tr.attr('rececode'),setMethod:''})});return list};var carfareList=function(){var costCarfareList=[];var costCarfareJson="";var cityDatas;if($("#traffic-list-info tbody tr:not(.total-last-tr)").length>0){$("#traffic-list-info tbody tr:not(.total-last-tr)").each(function(i,n){cityDatas=$(this).getDatas();cityDatas.crafare=$yt_baseElement.rmoney(cityDatas.crafare);cityDatas.setMethod='';if($(this).find(".hid-child-code").val()=="null"||$(this).find(".hid-child-code").val()==""){cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."}else{cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."+$(this).find(".hid-child-code").val()+"."}costCarfareList.push(cityDatas)})}return costCarfareList};var hotelList=function(){var costHotelList=[];var costHotelJson="";var hotelDatas;if($("#hotel-list-info tbody tr:not(.total-last-tr)").length>0){$("#hotel-list-info tbody tr:not(.total-last-tr)").each(function(i,n){hotelDatas=$(this).getDatas();hotelDatas.hotelExpense=$yt_baseElement.rmoney(hotelDatas.hotelExpense);hotelDatas.setMethod='';costHotelList.push(hotelDatas)});if(costHotelList.length>0){costHotelJson=JSON.stringify(costHotelList)}}return costHotelList};var otherList=function(){var costOtherList=[];var costOtherJson="";var otherDatas;if($("#other-list-info tbody tr:not(.total-last-tr)").length>0){$("#other-list-info tbody tr:not(.total-last-tr)").each(function(i,n){otherDatas=$(this).getDatas();otherDatas.reimAmount=$yt_baseElement.rmoney(otherDatas.reimAmount);otherDatas.setMethod='';costOtherList.push(otherDatas)});if(costOtherList.length>0){costOtherJson=JSON.stringify(costOtherList)}}return costOtherList};var costSubsidyList=function(){var list=[];var trs=$('#subsidy-list-info tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelPersonnel:tr.find('.user').attr('code'),subsidyDays:tr.find('.subsidy-num').text(),subsidyFoodAmount:tr.find('.food').attr('num'),carfare:tr.find('.traffic').attr('num'),setMethod:''})});return list};var costData=function(){return JSON.stringify({costReceptionistList:costReceptionistList(),costDetailsList:costDetailsList(),travelRouteList:tripPlanList(),costCarfareList:carfareList(),costHotelList:hotelList(),costOtherList:otherList(),costSubsidyList:costSubsidyList()})};var billingVoucherJson=function(){var list=[];var trs=$('#tally-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({billingVoucherId:tr.attr('pid'),toLoanType:tr.attr('loancode'),abstracts:tr.attr('abstract'),ledger:tr.attr('totalsubject'),detailed:tr.attr('detailsubject'),amount:tr.attr('tallymoney')})});return JSON.stringify(list)};return{advanceAppId:$('#advanceAppId').val(),loanAppId:$('#loanAppId').val(),reimAppId:$('#reimAppId').val(),reimAppNum:$('#reimAppNum').val(),reimAppName:$('#reimAppName').attr('val'),costType:$('#costTypeName').attr('val'),specialCode:$('#specialName').attr('val'),invoiceNum:$('#invoiceNum').text(),totalAmount:$('#totalAmount').attr('num'),writeOffAmount:$yt_baseElement.rmoney($('#writeOffAmount').text()),officialCard:$yt_baseElement.rmoney($('#officialCard').text()),cash:$yt_baseElement.rmoney($('#cash').text()),cheque:$yt_baseElement.rmoney($('#cheque').text()),transfer:0,attIdStr:getFileList(),paymentDate:$('#paymentDate').val(),paymentAmount:$yt_baseElement.rmoney($('#paymentAmount').val()||'0'),cmTotalAmount:$yt_baseElement.rmoney($('#cmTotalAmount').text()||'0'),cmWriteOffAmount:$yt_baseElement.rmoney($('#cmWriteOffAmount').text()||'0'),cmOfficialCard:$yt_baseElement.rmoney($('#cmOfficialCard').val()||'0'),cmCash:$yt_baseElement.rmoney($('#cmCash').val()||'0'),cmCheque:$yt_baseElement.rmoney($('#cmCheque').val()||'0'),cmTransfer:0,applicantUser:$('#applicantUser').val(),parameters:'',dealingWithPeople:$('#approve-users option:selected').val(),opintion:$('#opintion').val(),processInstanceId:$('#processInstanceId').val(),nextCode:$('#operate-flow option:selected').val(),costData:[],billingVoucherJson:billingVoucherJson(),}},showDetail:function(d){var me=this;var fMoney=$yt_baseElement.fmMoney;$(".ordinary-div").setDatas(d);$('#busiUsers').text(d.applicantUserName);$('#deptName').text(d.applicantUserDeptName);$('#jobName').text(d.applicantUserJobLevelName);$('#advanceAppId').val(d.advanceAppId);$('#loanAppId').val(d.loanAppId);$('#loanAmount').text(d.arrearsAmount?(fMoney(d.arrearsAmount)):'0.00');var outWriteAmount= +d.totalAmount<= +d.arrearsAmount?d.totalAmount:d.arrearsAmount;$('#outWriteAmount').text(fMoney(outWriteAmount||'0'));$('#reimAppId').val(d.reimAppId);$('#advanceAppNum').text(d.advanceAppNum||'--');if(d.advanceAppNum){$('.advance-relevance').show();$('#advanceAppBalance').text(d.advanceAppBalance?(fMoney(d.advanceAppBalance)+'元'):'--')}if(d.prjName){$('#prjName').text(d.prjName);$('.prj-name-tr').show()}$('#reimAppNum').val(d.reimAppNum);$('#formNum').text(d.reimAppNum).attr('val',d.reimAppNum);$('#reimAppName').text(d.reimAppName).attr('val',d.reimAppName);$('#costTypeName').text(d.costTypeName).attr('val',d.costType);$('#specialName').text(d.specialName).attr('val',d.specialCode);$('#budgetBalanceAmount').text(d.budgetBalanceAmount?fMoney(d.budgetBalanceAmount)+'万元':'--');$('#invoiceNum').text(d.invoiceNum);$('#totalAmount').text(fMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$('#amountTotalMoney').text(fMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$('#paymentList .total-money').text(fMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$('#totalMoneyUpper').text(arabiaToChinese(d.totalAmount+''||'0'));$('#writeOffAmount,#outWriteAmount').text(fMoney(d.writeOffAmount||'0')).attr('num',d.writeOffAmount);var balanceMoney=d.totalAmount<d.arrearsAmount?d.arrearsAmount-d.totalAmount:'0';$('#balanceMoney').text(fMoney(balanceMoney));$('#officialCard').text(fMoney(d.officialCard||'0')).attr('num',d.officialCard);$('#cash').text(fMoney(d.cash||'0')).attr('num',d.cash);$('#cheque').text(fMoney(d.cheque||'0')).attr('num',d.cheque);var body=$('#applyTable tbody');var total= +d.officialCard+ +d.cash+ +d.cheque+0;var rtotal=fMoney(total||'0');body.find('.total').text(rtotal).attr('num',total);var replaceMoney=total;$('#replaceMoney').text(fMoney(replaceMoney));$('#loanAppNum').text(d.loanAppNum?d.loanAppNum:'--');$('#invoiceNum').text(d.invoiceNum);$('#paymentDate').val(d.paymentDate);$('#paymentAmount').val(d.paymentAmount);var cmTotalAmount=d.cmTotalAmount?d.cmTotalAmount:d.totalAmount;$('#cmTotalAmount').text(fMoney(cmTotalAmount||'0')).attr('num',cmTotalAmount);$('#cmWriteOffAmount').text(fMoney(d.writeOffAmount||'0')).attr('num',d.writeOffAmount);$('#cmReplaceMoney').text(fMoney(replaceMoney)).attr('num',replaceMoney);$('#cmOfficialCard').val(fMoney(d.cmOfficialCard||'0'));$('#cmCash').val(fMoney(d.cmCash||'0'));$('#cmCheque').val(fMoney(d.cmCheque||'0'));if(replaceMoney<=0){$('.payroll-working .amount-table tbody input').attr('disabled',true)}$('#applicantUser').val(d.applicantUser);$('#applicantTime').text(d.applicantTime);$('#operate-flow option[value="'+d.nodeNowState+'"]').attr('selected',true);$('#processInstanceId').val(d.processInstanceId);$('#approve-users option[value="'+d.currentAssignee+'"]').attr('selected',true);$('#operate-flow,#approve-users').niceSelect();me.showFileList(d.attList);me.showCostDetail(d.costData);},showCostDetail:function(data){var me=this;var fMoney=$yt_baseElement.fmMoney;var costReceptionistList=data.costReceptionistList;var costDetailsList=data.costDetailsList;var receHtml='';$.each(costReceptionistList,function(i,n){receHtml+='<tr pkId="'+n.costReceptionistId+'" class="" nameVal="'+n.name+'" dutyVal="'+n.jobName+'" deptVal="'+n.unitName+'"><td><span class="num">1</span></td><td><span class="name-text">'+n.name+'</span></td><td><span class="job-text">'+n.jobName+'</span></td><td><span class="unit-text">'+n.unitName+'</span></td></tr>'});$('.msg-list tbody').append(receHtml);me.resetNum($('.msg-list'));var detaHtml='';var costDetaClose=$('#paymentList').next().find('.check-label input');$.each(costDetailsList,function(i,n){detaHtml+='<tr pkId="'+n.costDetailsId+'" budgetCode="'+n.publicServiceProCode+'" costCode="'+n.costType+'" budgetProject="'+n.publicServiceProName+'" applyDate="'+n.activityDate+'" siteVal="'+n.placeName+'" costBreakdown="'+n.costTypeName+'" standardMoney="'+n.standardAmount+'" budgetMoney="'+n.activityAmount+'" accompanyNum="'+n.peopleNum+'"><td><span class="">'+n.publicServiceProName+'</span></td><td><span class="act-date">'+n.activityDate+'</span></td><td><span class="place-name">'+n.placeName+'</span></td><td><span>'+n.costTypeName+'</span></td>'+'<td style="text-align: right;"><div class="money" money='+n.activityAmount+'>'+fMoney(n.activityAmount||'0')+'</div></td><td><span class="people-num">'+n.peopleNum+'</span></td></tr>';if(costDetaClose.length>0&&n.setMethod){costDetaClose.setCheckBoxState('check')}});$('#paymentList tbody .last').before(detaHtml);var tripPlanList=data.travelRouteList;var tripHtml='';var travelPersonnelsList=[];var getUserNames=function(list){var str='';$.each(list,function(i,n){str+=n.travelPersonnelName+(i<list.length-1?'、':'')});return str};var costItem=function(str){switch(str){case '1':return '住宿费';break;case '2':return '伙食费';break;case '3':return '市内交通费';break;default:return '';break}};var getCostItemName=function(str){var txt='';if(str){var list=str.split(',');$.each(list,function(i,n){if(n){txt+=costItem(n)+(i<list.length-1?'、':'')}});return txt}return ''};$.each(tripPlanList,function(i,n){var dateFrom=new Date(n.startTime);var dateTo=new Date(n.endTime);var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24));tripHtml+='<tr busicode="'+n.travelType+'" usercode="'+n.travelPersonnels+'" rececode="'+n.receptionCostItem+'" ><td><input type="hidden" class="hid-user-code" value="'+n.travelPersonnels+'" /> <span class="name">'+n.travelTypeName+'</span></td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="day">'+diff_day+'</td><td class="address" val="'+n.travelAddress+'">'+n.travelAddressName+'</td><td class="uname">'+getUserNames(n.travelPersonnelsList)+'</td><td class="numof">'+n.travelPersonnelsList.length+'</td><td class="reception">'+getCostItemName(n.receptionCostItem)+'</td></tr>'});$('#tripList tbody').html(tripHtml);var costCarfareList=data.costCarfareList;var carHtml='';var costCarfareClose=$('#traffic-list-info').next().find('.check-label input');$.each(costCarfareList,function(i,n){carHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+n.travelPersonnel+'"/></td><td>'+n.travelPersonnelsDept+'</td><td data-text="goTime">'+n.goTime+'</td><td><input data-val="goAddress" type="hidden" value="'+n.goAddress+'"><span data-text="goAddressName">'+n.goAddressName+'</span></td><td data-text="arrivalTime">'+n.arrivalTime+'</td><td><input data-val="arrivalAddress" type="hidden" value="'+n.arrivalAddress+'"> <span data-text="arrivalAddressName">'+n.arrivalAddressName+'</span></td><td><span data-text="vehicle">'+n.vehicleName+'</span><input type="hidden" class="hid-vehicle" value="'+n.vehicle+'"/><input type="hidden" class="hid-child-code" value=""/></td><td class="font-right money-td" data-text="crafare">'+(n.crafare==""?"--":fMoney(n.crafare||'0'))+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"--":n.remarks)+'</td><td style="display:none;"><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costCarfareClose.length>0&&n.setMethod){costCarfareClose.setCheckBoxState('check')}});carHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td></tr>';$('#traffic-list-info tbody').html(carHtml);sysCommon.updateMoneySum(0);var costHotelList=data.costHotelList;var hotelHtml='';var costHotelClose=$('#hotel-list-info').next().find('.check-label input');$.each(costHotelList,function(i,n){var avg=n.hotelDays>0?fMoney((+n.hotelExpense/ +n.hotelDays)||'0'):n.hotelExpense;hotelHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" value="'+n.travelpersonnel+'"/></td><td>'+n.travelPersonnelsJobLevelName+'</td>'+'<td class="font-right">'+avg+'</td><td risk-code-val="hotelCheckInDate" class="check-in-date"><span class="sdate">'+n.hotelTime+'</span></td><td class="leave-date"><span class="edate">'+n.leaveTime+'</span></td><td data-text="hotelDays">'+n.hotelDays+'</td><td class="font-right money-td" data-text="hotelExpense">'+fMoney(n.hotelExpense||'0')+'</td><td><span data-text="hotelAddressName">'+n.hotelAddressName+'</span><input type="hidden" data-val="hotelAddress" value="'+n.hotelAddress+'"</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"--":n.remarks)+'</td><td style="display:none;"><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costHotelClose.length>0&&n.setMethod){costHotelClose.setCheckBoxState('check')}});hotelHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$('#hotel-list-info tbody').html(hotelHtml);sysCommon.updateMoneySum(1);var costOtherList=data.costOtherList;var otherHtml='';var costOtherClose=$('#other-list-info').next().find('.check-label input');$.each(costOtherList,function(i,n){otherHtml+='<tr><td><span>'+n.costTypeName+'</span><input type="hidden" data-val="costType" value="'+n.costType+'"/></td><td class="font-right money-td" data-text="reimAmount">'+fMoney(n.reimAmount||'0')+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"--":n.remarks)+'</td></tr>';if(costOtherClose.length>0&&n.setMethod){costOtherClose.setCheckBoxState('check')}});otherHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td></tr>';$('#other-list-info tbody').html(otherHtml);sysCommon.updateMoneySum(2);var costSubsidyList=data.costSubsidyList;var subHtml='';var totalFood=0;var totalTraffic=0;$.each(costSubsidyList,function(i,n){subHtml+='<tr class="'+n.travelPersonnel+'" code="'+n.travelPersonnel+'"><td><div class="user" code="'+n.travelPersonnel+'">'+n.travelPersonnelName+'</div></td><td><div class="lv">'+n.travelPersonnelsDept+'</div></td><td><div class="subsidy-num">'+n.subsidyDays+'</div></td><td><div style="text-align:right;" class="food">'+fMoney(n.subsidyFoodAmount||'0')+'</div></td><td><div  style="text-align:right;" class="traffic">'+fMoney(n.carfare||'0')+'</div></td></tr>';totalFood+= +n.subsidyFoodAmount;totalTraffic+= +n.carfare});subHtml+='<tr class="last"><td>合计</td><td></td><td></td><td class="total-food"  style="text-align:right;">'+fMoney(totalFood||'0')+'</td><td class="total-traffic"  style="text-align:right;">'+fMoney(totalTraffic||'0')+'</td></tr>';$('#subsidy-list-info tbody').html(subHtml);me.setTrainApplyInfoList(data.trainApplyInfoList);me.setTeacherApplyInfoList(data.teacherApplyInfoList);me.setCostTrainApplyInfoList(data.costTrainApplyInfoList);me.setCostTeachersFoodApplyInfoList(data.costTeachersFoodApplyInfoList);me.setCostTeachersLectureApplyInfoList(data.costTeachersLectureApplyInfoList);me.setCostTeachersTravelApplyInfoList(data.costTeachersTravelApplyInfoList);me.setCostTeachersHotelApplyInfoList(data.costTeachersHotelApplyInfoList);me.setCostNormalList(data.costNormalList)},setTrainApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr pid="'+n.trainAppId+'" trainType="'+n.trainType+'"><td class="trainingClasses">'+n.trainTypeName+'</td><td class="trainingAddr"><input type="hidden" class="trainingAddrVal" value="'+n.regionCode+'">'+n.regionName+'</td><td class="trainingReportDate">'+n.reportTime+'</td><td class="trainingEndingDate">'+n.endTime+'</td><td class="trainingDay">'+n.trainDays+'</td><td class="trainingPerNumber">'+n.trainOfNum+'</td><td style="display:none"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#trainingPopTable tbody').html(html)},setTeacherApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr><td class="lecturerName"><input type="hidden" class="lectureId" value="'+n.lecturerId+'"><span>'+n.lecturerName+'</span></td><td class="professional">'+n.lecturerTitleName+'</td><td class="level">'+n.lecturerLevelName+'</td><td style="display:none"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#lecturerTable tbody').html(html)},setCostTrainApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr pid="'+n.teachersTrainId+'"><td class="day">'+n.trainDays+'</td><td class="num">'+n.trainOfNum+'</td><td class="moneyText" class="avg">'+serveExamine.fmMoney(n.averageMoney)+'</td><td class="moneyText training-total">'+serveExamine.fmMoney(n.trainAmount)+'</td><td style="display:none"><input type="hidden" class="popM" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#trainingFeeTable tbody').html(html)},setCostTeachersFoodApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.foodId+'"><td><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="avg" style="text-align: right;">'+serveExamine.fmMoney(n.averageMoney)+'</td><td class="day">'+n.foodOfDays+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.foodAmount)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td style="display:none"><input type="hidden" class="popM" value="4"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.foodAmount});$('#dietFeeTable tbody .end-tr').before(html);$('#dietFeeTable tbody .costTotal').text(serveExamine.fmMoney(total))},setCostTeachersLectureApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersLectureId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="holder">'+n.lecturerTitleName+'</td><td class="hour">'+n.teachingHours+'</td><td class="cname">'+n.courseName+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.perTaxAmount)+'</td><td class="moneyText after">'+serveExamine.fmMoney(n.afterTaxAmount)+'</td><td class="moneyText avg">'+serveExamine.fmMoney(n.averageMoney)+'</td><td style="display:none"><input type="hidden" class="popM" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.perTaxAmount});$('#lectureFeeTable tbody .end-tr').before(html);$('#lectureFeeTable tbody .costTotal').text(serveExamine.fmMoney(total))},setCostTeachersTravelApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersTravelId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="ulv">'+n.lecturerLevelName+'</td><td class="sdate">'+n.goTime+'</td><td class="edate">'+n.arrivalTime+'</td><td class="sadd"><input type="hidden" class="scode" value="'+n.goAddress+'">'+n.goAddressName+'</td><td class="eadd"><input type="hidden" class="ecode" value="'+n.arrivalAddress+'">'+n.arrivalAddressName+'</td><td class="tname"><input type="hidden" class="tool" value="'+n.vehicle+'">'+n.vehicleName+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.carfare)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td  style="display:none"><input type="hidden" class="popM" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.carfare});$('#carFeeTable tbody .end-tr').before(html);$('#carFeeTable tbody .costTotal').text(serveExamine.fmMoney(total))},setCostTeachersHotelApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersHotelId+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="moneyText avg">'+serveExamine.fmMoney(n.averageMoney)+'</td><td class="day">'+n.hotelDays+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.hotelExpense)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td style="display:none"><input type="hidden" class="popM" value="3"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.hotelExpense});$('#hotelFeeTable tbody .end-tr').before(html);$('#hotelFeeTable tbody .costTotal').text(serveExamine.fmMoney(total))},setCostNormalList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr><td style="text-align:left;" class="reimContent">'+n.normalName+'</td><td style="text-align: right;" class="reimAmount">'+($yt_baseElement.fmMoney(n.normalAmount))+'</td><td></td></tr>';total+= +n.normalAmount});$('.ordinary-approval #costList tbody .last').before(html);$('.ordinary-approval #costList tbody #reimAmountlSum').text($yt_baseElement.fmMoney(total))},showFileList:function(list){var ls='';var src='';$.each(list,function(i,n){var imgType=n.attName.split('.');if(imgType.length>1&&(imgType[1]=='png'||imgType[1]=='jpeg'||imgType[1]=='bmp'||imgType[1]=='jpg')){src=$yt_option.base_path+'fileUpDownload/download?pkId='+n.attId+'&isDownload=false';ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pv">预览<img src="'+src+'" ></label></div>'}else{ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pvno">预览</label></div>'}});$('#attIdStr').html(ls);$('#attIdStr .file-dw').on('click',function(){var id=$(this).parent().attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'});$('#attIdStr .file-pv img').showImg()},showBillingVoucherList:function(list){var totalText='';var detailText='';var html='';$.each(function(i,n){if(n.toLoanType=='DEBIT_ENTRY'){totalText=n.amount}else{detailText=n.amount}html+='<tr pid="'+n.billingVoucherId+'" class="" loanCode="'+n.toLoanType+'" loanType="'+n.toLoanTypeName+'" abstract="'+n.abstracts+'" totalSubject="'+n.ledger+'" detailSubject="'+n.detailed+'" tallyMoney="'+n.amount+'"><td>'+n.abstracts+'</td><td>'+n.ledger+'</td><td>'+n.detailed+'</td><td>'+totalText+'</td><td>'+detailText+'</td></tr>'});$('.tally-list').append(html)},getDictInfoByTypeCode:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:true,data:{dictTypeCode:'TO_LOAN_TYPE'},success:function(data){var list=data.data||[];var optone='<option value="">请选择</option>';$.each(list,function(i,n){optone+='<option value="'+n.value+'">'+n.disvalue+'</option>'});$('#loanType').html(optone).niceSelect();}})},resetNum:function(obj){var trs=obj.find('tbody tr');$.each(trs,function(i,n){$(n).find('.num').text(i+1)})},submitReimAppInfo:function(subData,thisBtn){$.ajax({type:"post",url:"sz/reimApp/submitReimAppInfo",async:true,data:subData,success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){window.location.href=$yt_option.websit_path+'view/system-sasac/expensesReim/module/reimApply/reimApproveList.html?state=1'}thisBtn.attr('disabled',false).removeClass('btn-disabled')}})},getTotleMoney:function(){var tds=$('#paymentList tbody .money');var total=0;$.each(tds,function(i,n){total+= +$(n).attr('money')});var fmTotal=$yt_baseElement.fmMoney(total||'0');$('#paymentList tbody .total-money').text(fmTotal);$('#applyTotalMoney').text(fmTotal).attr('num',total);$('#amountTotalMoney').text(fmTotal).attr('num',total);$('#TotalMoneyUpper').text(arabiaToChinese(fmTotal+''));var writeOffAmount= +($('#writeOffAmount').attr('num'));var num=total-writeOffAmount;if(num>=0){$('#replaceMoney').text($yt_baseElement.fmMoney(num))}else{$('#balanceMoney').text($yt_baseElement.fmMoney(num))}},getSaveData:function(){var me=this;var data=me.saveData;data.paymentDate=$('#paymentDate').val();data.paymentAmount=$yt_baseElement.rmoney($('#paymentAmount').val()||'0');data.cmTotalAmount=$('#cmTotalAmount').attr('num');data.cmWriteOffAmount=$('#cmWriteOffAmount').attr('num');data.cmOfficialCard=$yt_baseElement.rmoney($('#cmOfficialCard').val()||'0');data.cmCash=$yt_baseElement.rmoney($('#cmCash').val()||'0');data.cmCheque=$yt_baseElement.rmoney($('#cmCheque').val()||'0');data.costData=JSON.stringify(data.costData);data.nextCode=$('#operate-flow option:selected').val();data.dealingWithPeople=$('#approve-users option:selected').val();data.attIdStr=me.getFileList();return data},getFileList:function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length?',':'')});return str},showBusinessFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.business-div').show()},showGeneralFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.index-main-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetailApproval.html')},showTravelFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.travel-div').show()},showTrainFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.index-main-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/busiTripApply/trainApproval.html')},showMettingFun:function(){$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();},clearexamine:function(){$("#clearBtn").off().on("click",function(){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/expensesReim/module/reimApply/reimApproveList.html'}})})}};$(function(){serveExamine.init();serveExamine.clearexamine()})})(jQuery,window);