(function($,window){var paymentRequest={orderDef:'../../../../../resources-sasac/images/module/order-def.png',orderAsc:'../../../../../resources-sasac/images/module/order-acs.png',orderDesc:'../../../../../resources-sasac/images/module/order-desc.png',getUserList:function(){var userList=sysCommon.getUserAllInfo();$("select.user-name-sel").html('<option value="">请选择</option>').niceSelect({search:true,backFunction:function(text){$("select.user-name-sel option").remove();$.each(userList,function(i,n){if(n.userName.indexOf(text)!=-1){$("select.user-name-sel").append('<option value="'+n.userItcode+'">'+n.userName+'</option>')}})}})},init:function(){var ts=this;ts.module();ts.events();ts.moneyFormat();ts.switchtimeclick();ts.getBeforehandList();ts.queryBeforehand();ts.clearBtn();ts.getCostTypeList();ts.getUserList();ts.getDeptList()},module:function(){$('select').niceSelect();$('#startDate').calendar({speed:0,nowData:false});$('#endDate').calendar({speed:0,nowData:false})},events:function(){$('.checkbox-state').change(function(){paymentRequest.getBeforehandList()});$('.checkbox-quota').change(function(){paymentRequest.getBeforehandList()})},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},rmoney:function(str){return $yt_baseElement.rmoney(str||'0')},switchtimeclick:function(){$(".sort-span").on("click",function(){var img=$(this).find('img');var src=img.attr("src");var code=$(this).attr('code');$(".sort-span img").attr('src',paymentRequest.orderDef);if(src==paymentRequest.orderAsc){img.attr("src",paymentRequest.orderDesc);paymentRequest.getBeforehandList('DESC',code)}else if(src==paymentRequest.orderDesc||src==paymentRequest.orderDef){img.attr("src",paymentRequest.orderAsc);paymentRequest.getBeforehandList('ASC',code)}})},switchpayableclick:function(){$(".payable-img").on("click",function(){var src=$(".payable-img").attr("src");if(src=="../../../../../resources-sasac/images/module/order-acs.png"){$(".payable-img").attr("src","../../../../../resources-sasac/images/module/order-desc.png")}else if(src=="../../../../../resources-sasac/images/module/order-desc.png"){$(".payable-img").attr("src","../../../../../resources-sasac/images/module/order-acs.png")}})},switchcontractclick:function(){$(".contract-img").on("click",function(){var src=$(".contract-img").attr("src");if(src=="../../../../../resources-sasac/images/module/order-acs.png"){$(".contract-img").attr("src","../../../../../resources-sasac/images/module/order-desc.png")}else if(src=="../../../../../resources-sasac/images/module/order-desc.png"){$(".contract-img").attr("src","../../../../../resources-sasac/images/module/order-acs.png")}})},switchalreadyclick:function(){$(".already-img").on("click",function(){var src=$(".already-img").attr("src");if(src=="../../../../../resources-sasac/images/module/order-acs.png"){$(".already-img").attr("src","../../../../../resources-sasac/images/module/order-desc.png")}else if(src=="../../../../../resources-sasac/images/module/order-desc.png"){$(".already-img").attr("src","../../../../../resources-sasac/images/module/order-acs.png")}})},switchpercentageclick:function(){$(".percentage-img").on("click",function(){var src=$(".percentage-img").attr("src");if(src=="../../../../../resources-sasac/images/module/order-acs.png"){$(".percentage-img").attr("src","../../../../../resources-sasac/images/module/order-desc.png")}else if(src=="../../../../../resources-sasac/images/module/order-desc.png"){$(".percentage-img").attr("src","../../../../../resources-sasac/images/module/order-acs.png")}})},moneyFormat:function(){$(".top-money,.bottom-money").on("focus",function(){if($(this).val()!=""){$(this).val($yt_baseElement.rmoney($(this).val()))}});$(".top-money,.bottom-money").on("blur",function(){if($(this).val()!=""){$(this).val($yt_baseElement.fmMoney($(this).val()))}})},multiSelection:function(){var str='';$('.checkbox-state').each(function(i,n){if(n.checked){var s=$(n).val();str+=s+','}});return str},quotaCheck:function(){var str='';$('.checkbox-quota').each(function(i,n){if(n.checked){var s=$(n).val();str+=s+','}});return str},queryBeforehand:function(){$("#heardSearchBtn").on("click",function(){paymentRequest.getBeforehandList()})},getBeforehandList:function(order,property){order=order||'DESC';property=property||'applicateTime';var queryParams=$('.keyword-input').val();var userCode=$('.user-name-sel option:selected').val();var costType=$('.cost-types option:selected').val();var formAppType=$('.apply-types option:selected').val();var deptId=$('.department option:selected').val();var startAmount=$('.top-money').val();var endAmount=$('.bottom-money').val();var startDate=$('#startDate').val();var endDate=$('#endDate').val();var queryStateParams=paymentRequest.multiSelection();var quota=paymentRequest.quotaCheck();$('.table-page').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:'sz/payApp/getTotalPaymentAppQueryByParams',data:{queryStateParams:queryStateParams,queryParams:queryParams,userCode:userCode,deptId:deptId,costType:costType,startDate:startDate,endDate:endDate,startAmount:startAmount,endAmount:endAmount,formAppType:formAppType,property:property,direction:order },success:function(data){var htmlTbody=$('#dataListTable tbody');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data.rows;if(datas.length>0){$('.table-page').show();$.each(datas,function(i,n){trStr+='<tr><input class="processInstanceId" type="hidden" value="'+n.processInstanceId+'"/><td>'+n.applicateTime+'</td><td>'+n.appNum+'</td><td>'+n.advAppNum+'</td><td style="text-align: left;">'+n.formAppTypeName+'</td><td>'+n.applicantUserName+'</td><td>'+n.applicantUserDeptName+'</td><td style="text-align: left;">'+n.appName+'</td><td style="text-align: left;">'+n.receivablesName+'</td><td>'+n.costTypeName+'</td><td style="text-align: left;">'+n.specialName+'</td><td style="text-align: right;">'+(paymentRequest.fmMoney(n.totalAmount))+'</td><td style="text-align: right;">'+(paymentRequest.fmMoney(n.contractAmount))+'</td><td style="text-align: right;">'+(paymentRequest.fmMoney(n.paymentAmount))+'</td><td style="text-align: right;">'+n.percentPay+'</td><td><a>'+n.workFlowState+'</a></td><td><a class="yt-link log-mod">查看</a></td></tr>'});htmlTbody.append(trStr);paymentRequest.initQtip();}else{$('.table-page').hide();htmlTbody.append(paymentRequest.noDataTrStr(10))}$('#totalAllAmount').text($yt_baseElement.fmMoney(data.data.totalAllAmount));$('#contractAllAmount').text($yt_baseElement.fmMoney(data.data.contractAllAmount));$('#paymentAllAmount').text($yt_baseElement.fmMoney(data.data.paymentAllAmount));}},isSelPageNum:true })},noDataTrStr:function(trNum){var noDataStr='<tr style="border:0px;background-color:#fff !important;"><td  colspan="'+trNum+'" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';return noDataStr},clearBtn:function(){$('.yt-reset-btn').on('click',function(){paymentRequest.clearAlert($(".body-div"));paymentRequest.getBeforehandList()})},clearAlert:function(obj){var selects=obj.find('select:not(.user-name-sel)');$.each(selects,function(i,n){$(n).find('option:eq(0)').attr('selected',true)});selects.niceSelect();paymentRequest.getUserList();var check1=obj.find('.checkbox-state');$.each(check1,function(i,n){$(n).setCheckBoxState("uncheck")});var check2=obj.find('.checkbox-quota');$.each(check2,function(i,n){$(n).setCheckBoxState("uncheck")});var inputs=obj.find('input:not(input[type="checkbox"])');inputs.val('')},getCostTypeList:function(code){$.ajax({type:"post",url:"basicconfig/dictInfo/getCostTypeList",async:true,data:{dictTypeCode:'COST_TYPE'},success:function(data){var list=data.data||[];var opts='<option value="">请选择</option>';$.each(list,function(i,n){if(code&&code==n.costCode){opts+='<option selected="selected" fun="'+n.jsFun+'" value="'+n.costCode+'">'+n.costName+'</option>'}else{opts+='<option fun="'+n.jsFun+'" value="'+n.costCode+'">'+n.costName+'</option>'}});$('select.cost-types').html(opts).niceSelect()}})},getDeptList:function(code){$.ajax({type:"post",url:"user/userInfo/getAllDeptsInfo",async:true,success:function(data){var list=data.data||[];var opts='<option value="">请选择</option>';$.each(list,function(i,n){if(n.type==2){if(code&&code==n.id){opts+='<option selected="selected" value="'+n.id+'">'+n.text+'</option>'}else{opts+='<option value="'+n.id+'">'+n.text+'</option>'}}});$('.department').html(opts).niceSelect()}})},initQtip:function(){$('.log-mod').qtip({content:{text:function(event,api){var txt='';var WorkFlowLogList=[];var thisTr=$(this).parents("tr");var processInstanceId=thisTr.find('.processInstanceId').val();$.ajax({type:"post",url:"basicconfig/workFlow/getWorkFlowLog",async:false,data:{processInstanceId:processInstanceId},success:function(data){if(data.data!=undefined&&data.data!=null){WorkFlowLogList=data.data}if(WorkFlowLogList==null||WorkFlowLogList==undefined){return}shomd="";shomd='<div class="suspension" >';var WorkFlowLog;for(var i=0;i<WorkFlowLogList.length;i+=1){WorkFlowLog=WorkFlowLogList[i];if(i==0){shomd+='<div class="log-msg-model"><div><div class="first-log-msg"><span class="log-num">'+(WorkFlowLogList.length-i)+'</span></div><span class="user-name">'+(WorkFlowLog.userName==""?'无':WorkFlowLog.userName)+'</span><div style="clear:both;"></div></div><div class="log-line-div" style="'+(i==(WorkFlowLogList.length-1)?"padding-bottom: 0px;":"padding-bottom: 10px;")+''+(WorkFlowLogList.length==1?"border:0px;":"")+'"><div style="'+(WorkFlowLogList.length==1?"border:0px;":"border-bottom: 1px solid #D6E6F3;")+'"><div class="oper-status-model"><label class="log-label-text">操作状态</label><span>：</span><span>'+(WorkFlowLog.taskName==""?"无":WorkFlowLog.taskName)+'</span></div><div class="oper-time-model"><label class="log-label-text">操作时间</label><span>：</span><span>'+(WorkFlowLog.commentTime==""?"无":WorkFlowLog.commentTime)+'</span></div>';if(WorkFlowLog.comment!=""&&WorkFlowLog.comment!=null&&WorkFlowLog.comment!=" "){shomd+='<div class="log-comment-model"><label class="log-label-text">操作意见</label><span>：</span><div class="oper-comment-msg">'+WorkFlowLog.comment+'</div></div>'}shomd+='</div></div>'}else{shomd+='<div class="log-msg-model"><div><div class="log-msg-def-bak"><span class="log-num">'+(WorkFlowLogList.length-i)+'</span></div><span class="user-name" style="top:0px;">'+(WorkFlowLog.userName==""?'无':WorkFlowLog.userName)+'</span><div style="clear:both;"></div></div><div class="log-line-div" style="'+(i==(WorkFlowLogList.length-1)?"padding-bottom: 0px;":"padding-bottom: 10px;")+''+(i==(WorkFlowLogList.length-1)?"border:0px;":"")+'"><div style="'+(i==(WorkFlowLogList.length-1)?"border:0px;":"border-bottom: 1px solid #D6E6F3;")+'"><div class="oper-status-model"><label class="log-label-text">操作状态</label><span>：</span><span>'+(WorkFlowLog.taskName==""?"无":WorkFlowLog.taskName)+'</span></div><div class="oper-time-model"><label class="log-label-text">操作时间</label><span>：</span><span>'+(WorkFlowLog.commentTime==""?"无":WorkFlowLog.commentTime)+'</span></div>';if(WorkFlowLog.comment!=""&&WorkFlowLog.comment!=null&&WorkFlowLog.comment!=" "){shomd+='<div class="log-comment-model"><label class="log-label-text">操作意见</label><span>：</span><div class="oper-comment-msg">'+WorkFlowLog.comment+'</div></div>'}shomd+='</div></div>'}shomd+='</div>'}}});return(WorkFlowLogList.length<1?'<span style="color:#999">暂无数据</span>':shomd);}},position:{my:'right top',at:'left top',container:false,viewport:$('body'),adjust:{x:0,y:0,mouse:true,resize:true,method:'flip flip'}},hide:{fixed:true,},style:{classes:'showmod',tip:{corner:true,mimic:false,width:10,height:10,border:true,offset:0}},events:{show:function(data){$(data.target).find(".qtip-content").css("max-height",$('#frame-right-model').height()-200)}}})}};$(function(){paymentRequest.events();paymentRequest.init()})})(jQuery,window);