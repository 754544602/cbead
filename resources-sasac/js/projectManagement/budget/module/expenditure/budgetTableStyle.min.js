var budgetTableStyle={booksId:'',budgetStage:'',init:function(){var requerParameter=$yt_common.GetRequest();budgetTableStyle.booksId=requerParameter.booksId;budgetTableStyle.budgetStage=requerParameter.budgetStage;budgetTableStyle.getUtilName();budgetTableStyle.events();$("#budgetTableStyle").css("min-height",$(window).height()-15)},events:function(){$("#approveCanelBtn").click(function(){window.history.back(-1)});$('.status-model .checkbox1').change(function(){if($(".status-model .checkbox1").is(':checked')){$(".status-model .checkbox-state").each(function(i,n){$(n).setCheckBoxState("check")})}else{$(".status-model .checkbox-state").each(function(i,n){$(n).setCheckBoxState("uncheck")})}budgetTableStyle.getBudgetList()});$('.status-model .checkbox2,.status-model .checkbox3').change(function(){if($(".status-model .checkbox2").is(':checked')&&$(".status-model .checkbox3").is(':checked')){$(".status-model .checkbox-state").each(function(i,n){$(n).setCheckBoxState("check")})}else{$(".status-model .checkbox1").each(function(i,n){$(n).setCheckBoxState("uncheck")})}budgetTableStyle.getBudgetList()});$('.update-data-pop .checkbox1').change(function(){if($(".update-data-pop .checkbox1").is(':checked')){$(".update-data-pop .checkbox1").each(function(i,n){$(n).setCheckBoxState("check")})}else{$(".update-data-pop .checkbox-state").each(function(i,n){$(n).setCheckBoxState("uncheck")})}});$('.update-data-pop .checkbox2').change(function(){if($(".update-data-pop .checkbox2").is(':checked')){$(".update-data-pop .checkbox1,.update-data-pop .checkbox2").each(function(i,n){$(n).setCheckBoxState("check")})}else{$(".update-data-pop .checkbox2,.update-data-pop .checkbox3").each(function(i,n){$(n).setCheckBoxState("uncheck")})}});$('.update-data-pop .checkbox3').change(function(){if($(".update-data-pop .checkbox3").is(':checked')){$(".update-data-pop .checkbox-state").each(function(i,n){$(n).setCheckBoxState("check")})}else{$(".update-data-pop .checkbox3").each(function(i,n){$(n).setCheckBoxState("uncheck")})}});$('.update-data-pop').on('change','.checkbox-all',function(){if($(".update-data-pop .checkbox-all").is(':checked')){$(".table-div-checkbox .pop-checkbox").each(function(i,n){$(n).setCheckBoxState("check")})}else{$(".table-div-checkbox .pop-checkbox").each(function(i,n){$(n).setCheckBoxState("uncheck")})}});$(".table-div-checkbox").on('change','.pop-checkbox',function(){var isChecked=true;$(".table-div-checkbox .pop-checkbox").each(function(i,n){if(!$(n).is(':checked')){isChecked=false;return}});if(isChecked){$(".update-data-pop .checkbox-all").each(function(i,n){$(n).setCheckBoxState("check")})}else{$(".update-data-pop .checkbox-all").each(function(i,n){$(n).setCheckBoxState("uncheck")})}});$("#resetBtn").click(function(){$("#queryParams").val("");$(".checkbox-state").each(function(i,n){$(n).setCheckBoxState("uncheck")});budgetTableStyle.getBudgetList()});$("#heardSearchBtn").click(function(){budgetTableStyle.getBudgetList()});$("#addRiskBtn").click(function(){window.location.href=$yt_option.websit_path+'view/system-sasac/budget/module/expenditure/addTable.html?booksId='+budgetTableStyle.booksId+'&budgetStage='+budgetTableStyle.budgetStage});$("#tableList").on("click",".operate-update",function(){var thisObj=$(this);var tableId=thisObj.parents("tr").find("input.tableId").val();window.location.href=$yt_option.websit_path+'view/system-sasac/budget/module/expenditure/addTable.html?tableId='+tableId+'&booksId='+budgetTableStyle.booksId+'&budgetStage='+budgetTableStyle.budgetStage});$("#tableList tbody").on("click","tr",function(){var thisObj=$(this);var trState=thisObj.find(".tr-state").text();if(trState=="启用"){$("#blockUpBtn").text("停用")}else{$("#blockUpBtn").text("启用")}});$("#blockUpBtn").click(function(){var selTrLen=$("#tableList tbody tr.yt-table-active").length;var thisTr=$("#tableList tbody tr.yt-table-active");var thisBtn=$(this);var loanId=thisTr.find("input.tableId").val();if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作")}else{if(thisBtn.text()=="启用"){$.ajax({type:"post",url:"budget/table/setBudgetTableStateToEnable",async:false,data:{tableId:loanId},success:function(data){if(data.flag==0){thisTr.find(".tr-state").text("启用").css("color","#4aae62");thisBtn.text("停用")}else{$yt_alert_Model.prompt(data.message,2000)}}})}else{$.ajax({type:"post",url:"budget/table/setBudgetTableStateToDisable",async:false,data:{tableId:loanId},success:function(data){if(data.flag==0){thisTr.find(".tr-state").text("停用").css("color","#ff0000");thisBtn.text("启用")}else{$yt_alert_Model.prompt(data.message,2000)}}})}}});$(".fun-btn-group").on("click",".update-plan-item",function(){budgetTableStyle.showUpdateAlert()});$(".fun-btn-group button.adjust").on("click",function(){var selTrLen=$("#tableList tbody tr.yt-table-active").length;var thisTr=$("#tableList tbody tr.yt-table-active");var tableOjbData=$(thisTr).data("tableObj");tableOjbData=JSON.stringify(tableOjbData);tableOjbData=escape(tableOjbData);var thisBtn=$(this);var pageUrl="";var tableId=thisTr.find("input.tableId").val();var trState=$("#tableList tbody tr.yt-table-active").find(".tr-state").text();if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作");return false}else if(trState=="停用"){$yt_alert_Model.prompt("该表格已被停用");return false}else{var btnFlag=$(this).attr("btnFlag");if(btnFlag=="0"){pageUrl='view/system-sasac/budget/module/expenditure/addTable.html?tableId='+tableId+'&tableOjbData='+tableOjbData+'&booksId='+budgetTableStyle.booksId+'&budgetStage='+budgetTableStyle.budgetStage}else if(btnFlag=="1"){pageUrl='view/system-sasac/budget/module/expenditure/configDefinition.html?tableId='+tableId+'&tableOjbData='+tableOjbData+'&booksId='+budgetTableStyle.booksId+'&budgetStage='+budgetTableStyle.budgetStage}else if(btnFlag=="2"){pageUrl='view/system-sasac/budget/module/expenditure/budgetStatistics.html?tableId='+tableId+'&tableOjbData='+tableOjbData+'&booksId='+budgetTableStyle.booksId+'&budgetStage='+budgetTableStyle.budgetStage}window.location.href=$yt_option.websit_path+pageUrl}})},getBudgetList:function(){var queryParams=$("#queryParams").val();var stateStr=budgetTableStyle.quotaCheck();$('.budget-table-page').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:"/budget/table/getPageTableDetailListByParams",type:"post",data:{booksId:budgetTableStyle.booksId,budgetStage:budgetTableStyle.budgetStage,queryParams:queryParams,stateStr:stateStr},objName:'data',success:function(data){var htmlTbody=$('#tableList .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data.rows;if(datas.length>0){$(".budget-table-page").show();var trDoc='';var defSty="background: #ccc;color: #666666;";var colorSty="background: #6495bc;color: #fff;";var sty1="";var sty2="";var sty3="";$.each(datas,function(i,n){sty1=defSty;sty2=defSty;sty3=defSty;trDoc='<tr><td><input class="tableId" value="'+n.tableId+'" type="hidden">'+n.tableCode+'</td><td>'+n.budgetTypeName+'</td><td style="text-align: left;">'+n.tableName+'</td><td class="plan-td">';if(n.scheduleState==1){sty1=colorSty}else if(n.scheduleState==2){sty1=colorSty;sty2=colorSty}else if(n.scheduleState==3){sty1=colorSty;sty2=colorSty;sty3=colorSty}trDoc+='<div class="plan-div style-plan" style="'+sty1+'">表样配置</div><div class="plan-div config-plan" style="'+sty2+'">属性配置</div><div class="plan-div edit-plan"style="margin-right:0px;'+sty3+'">预算编制</div>';trDoc+='</td><td>'+(n.state==1?'<span class="tr-state" style="color:#4aae62">启用</span>':'<span class="tr-state" style="color:#ff0000">停用</span>')+'</td><td>'+n.lastOperatorUserName+'</td><td>'+n.lastOperatorDateTime+'</td>';'</tr>';trDoc=$(trDoc);trDoc.data("tableObj",n);$("#tableList tbody").append(trDoc)})}else{htmlTbody.append(budgetTableStyle.noDataTrStr(7));$(".budget-table-page").hide()}}},isSelPageNum:true })},quotaCheck:function(){var str='';$('.status-model .checkbox-state').each(function(i,n){if(n.checked){var s=$(n).val();str+=s+','}});return str.substring(0,str.length-1)},noDataTrStr:function(trNum){var noDataStr='<tr style="border:0px;background-color:#fff !important;"><td  colspan="'+trNum+'" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';return noDataStr},showUpdateAlert:function(){budgetTableStyle.anImportGetQueryInfo();budgetTableStyle.anImportGetList();$(".yt-edit-alert.update-data-pop,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($(".yt-edit-alert.update-data-pop"));$(".update-data-pop .query-plan-btn").click(function(){var isTrue=$yt_valid.validForm($(".yt-edit-alert.update-data-pop .pop-query-group"));if(isTrue){budgetTableStyle.anImportGetList();$yt_alert_Model.getDivPosition($(".yt-edit-alert.update-data-pop"))}});$(".update-data-pop .reset-btn").click(function(){$(".update-data-pop .nice-select,#copyBudgetStage,#copyBooksYear").removeClass("valid-hint");$(".update-data-pop .valid-font").text("");$('#copyBudgetStage,#copyBooksYear').val("");$('#copyBudgetStage').niceSelect();budgetTableStyle.anImportGetList()});$(".update-data-pop").off("click").on("click",".sure-plan-btn",function(){var isTrue=$yt_valid.validForm($(".yt-edit-alert.update-data-pop"));var isChecked=false;$(".update-data-pop .checkbox1,.update-data-pop .checkbox2,.update-data-pop .checkbox3").each(function(i,n){if($(n).is(':checked')){isChecked=true;return}});if(isChecked){var isChecked2=false;$(".update-data-pop .table-div-checkbox .pop-checkbox").each(function(i,n){if($(n).is(':checked')){isChecked2=true;return}});if(!isChecked2){$yt_alert_Model.prompt("请选择一条数据");isTrue=false}}else{$yt_alert_Model.prompt("请选择一条复制样式");isTrue=false}if(isTrue){var copyBooksYear=$("#copyBooksYear").val();var copyBudgetStage=$("#copyBudgetStage").val();var copyStyle=($(".update-data-pop .checkbox1").is(':checked')?1:2);var copyConfig=($(".update-data-pop .checkbox2").is(':checked')?1:2);var copyData=($(".update-data-pop .checkbox3").is(':checked')?1:2);var copyTableIdStr="";$(".table-div-checkbox .pop-checkbox").each(function(i,n){if($(n).is(':checked')){copyTableIdStr+=$(n).val()+','}});copyTableIdStr=copyTableIdStr.substring(0,copyTableIdStr.length-1);$.ajax({type:"post",url:'budget/books/saveCopyBooksInfo',async:false,data:{booksId:budgetTableStyle.booksId,budgetStage:budgetTableStyle.budgetStage,copyBooksYear:copyBooksYear,copyBudgetStage:copyBudgetStage,copyStyle:copyStyle,copyConfig:copyConfig,copyData:copyData,copyTableIdStr:copyTableIdStr},success:function(data){$(".update-data-pop .nice-select,#copyBudgetStage,#copyBooksYear").removeClass("valid-hint");$(".update-data-pop .valid-font").text("");$('#copyBudgetStage,#copyBooksYear').val("");$('#copyBudgetStage').niceSelect();$(".table-div-checkbox .yt-tbody").html("");$(".update-data-pop .checkbox1,.update-data-pop .checkbox2,.update-data-pop .checkbox3").each(function(i,n){$(n).setCheckBoxState("uncheck")});$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();budgetTableStyle.getBudgetList();$yt_alert_Model.prompt(data.message)}})}});$('.update-data-pop .canel-btn').click(function(){$(".update-data-pop .nice-select,#copyBudgetStage,#copyBooksYear").removeClass("valid-hint");$(".update-data-pop .valid-font").text("");$('#copyBudgetStage,#copyBooksYear').val("");$('#copyBudgetStage').niceSelect();$(".table-div-checkbox .yt-tbody").html("");$(".update-data-pop .checkbox1,.update-data-pop .checkbox2,.update-data-pop .checkbox3").each(function(i,n){$(n).setCheckBoxState("uncheck")});$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},anImportGetList:function(){var copyBudgetStage=$("#copyBudgetStage").val();var copyBooksYear=$("#copyBooksYear").val();$.ajax({type:"post",url:'budget/books/getNotCopyTableListByParams',async:false,data:{copyBooksYear:copyBooksYear,copyBudgetStage:copyBudgetStage,booksId:budgetTableStyle.booksId,budgetStage:budgetTableStyle.budgetStage},success:function(data){var datas=data.data;if(data.flag==0){if(data.data.length>0){$(".table-div-checkbox .yt-tbody").html("");var allHtml="";$(data.data).each(function(i,n){allHtml+='<tr><td style="text-align: left;padding-left: 17px;"><label class="check-label yt-checkbox"><input class="pop-checkbox checkbox-'+i+'" type="checkbox" name="test" value="'+n.tableId+'"/>'+n.tableCode+'</label></td><td>'+n.tableName+'</td></tr>'});$(".table-div-checkbox .yt-tbody").html(allHtml);$(".update-data-pop .table-two,.update-data-pop .check-label").show()}else{var noDataStr='<tr style="border:0px;background-color:#fff !important;"><td  colspan="'+2+'" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;padding:0px;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding:0;"></div></td></tr>';$(".table-div-checkbox .yt-tbody").html(noDataStr);$(".update-data-pop .table-two,.update-data-pop .check-label").hide()}$(".update-data-pop .checkbox1,.update-data-pop .checkbox2,.update-data-pop .checkbox3,.update-data-pop .checkbox-all,.table-div-checkbox .pop-checkbox").each(function(i,n){$(n).setCheckBoxState("check")})}else{$yt_alert_Model.prompt(data.message)}}})},anImportGetQueryInfo:function(){$.ajax({type:"post",url:'budget/books/getCopyBooksAttrsByBooksId',async:false,data:{booksId:budgetTableStyle.booksId,budgetStage:budgetTableStyle.budgetStage},success:function(data){var datas=data.data;if(data.flag==0){if(data.data){$("#copyBudgetStage").val(datas.copyBudgetStage).niceSelect();$("#copyBooksYear").val(datas.copyBooksYear);if($("#copyBudgetStage").val()&&$("#copyBooksYear").val()){$("#copyBudgetStage").attr('disabled',true).niceSelect();$("#copyBooksYear").attr('disabled','disabled');$(".update-data-pop .query-plan-btn,.update-data-pop .reset-btn").hide()}else{$("#copyBudgetStage").attr('disabled',false).niceSelect();$("#copyBooksYear").attr('disabled','false');$(".update-data-pop .query-plan-btn,.update-data-pop .reset-btn").show()}}}else{$yt_alert_Model.prompt(data.message)}}})},getUtilName:function(){$.ajax({type:"post",url:$yt_option.base_path+'budget/table/getBudgetClassifyDataByParams?tableKey=coso_classify_budget_stage',async:false,data:{},success:function(data){var datas=data.data.rows;if(data.flag==0){var numOptions='<option value="">请选择</option>';$('#copyBudgetStage').empty();if(datas.length>0&&datas!=undefined&&datas!=null){$.each(datas,function(i,n){numOptions+='<option value="'+n.code+'" sel-val="'+n.name+'">'+n.name+'</option>'});$('#copyBudgetStage').append(numOptions)}$('#copyBudgetStage').niceSelect()}}})}};$(function(){budgetTableStyle.init();budgetTableStyle.getBudgetList()});