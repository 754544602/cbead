var budgetList={inits:function(){$("#budgetList").css("min-height",$(window).height()-13);budgetList.events();budgetList.getPlanList()},events:function(){$(".plan-list").on("click",".plan-list-item",function(){var thisObj=$(this);$(".plan-list .plan-list-item").removeClass("plan-item-active");thisObj.addClass("plan-item-active")});$(".operation-btn-list").on("click",".add-plan-item",function(){budgetList.showAlert()});$(".operation-btn-list").on("click",".update-plan-item",function(){var selTrLen=$(".plan-list .plan-list-item.plan-item-active").length;if(selTrLen==0){$yt_alert_Model.prompt("请选择一项数据进行操作")}else{var thisObj=$(".plan-list .plan-list-item.plan-item-active");$(".plan-list .plan-list-item").removeClass("plan-item-active");budgetList.showAlert(thisObj)}});$(".plan-list").on("click",".to-list-link",function(){var thisObj=$(this);var thisTr=thisObj.parents("tr");var thisDiv=thisTr.parents("div.plan-list-item");var booksId=thisDiv.find(".books-id").val();var budgetStage=thisTr.find(".budget-stage").val();window.location.href=$yt_option.websit_path+"view/system-sasac/budget/module/expenditure/budgetTableStyle.html?booksId="+booksId+"&budgetStage="+budgetStage;});$("#resetBtn").click(function(){$(".query-text").val("");budgetList.getPlanList()});$("#heardSearchBtn").click(function(){budgetList.getPlanList()})},showAlert:function(thisObj){$(".add-data-pop .add-plan-btn").show();$(".add-data-pop .save-plan-btn").hide();$(".yt-edit-alert.add-data-pop,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($(".yt-edit-alert.add-data-pop"));$("#planInput,#yearInput,#describeTextarea").val("").removeClass("valid-hint");$(".add-data-pop .valid-font").text("");budgetList.getUtilName();if(thisObj){$(".add-data-pop .add-plan-btn").hide();$(".add-data-pop .save-plan-btn").show();$("#booksId").val(thisObj.find(".list-item-title .books-id").val());$("#planInput").val(thisObj.find(".list-item-title .books-name").text());$("#yearInput").val(thisObj.find(".list-item-title .books-year").text());$("#unitCode").val(thisObj.find(".list-item-title .unit-num").text());$("#unitCode").niceSelect();$("#describeTextarea").val(thisObj.find(".list-item-title .books-describe input").val())}$(".add-data-pop").on("click",".save-plan-btn",function(){var isTrue=$yt_valid.validForm($(".yt-edit-alert.add-data-pop"));if(isTrue){var booksId=$("#booksId").val();var planInput=$("#planInput").val();var yearInput=$("#yearInput").val();var unitCode=$("#unitCode").val();var describeTextarea=$("#describeTextarea").val();$.ajax({type:"post",url:'budget/books/updateBooksInfo',async:false,data:{booksId:booksId,booksName:planInput,booksYear:yearInput,unitNum:unitCode,booksDescribe:describeTextarea},success:function(data){if(data.flag==0){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();budgetList.getPlanList()}else{$yt_alert_Model.prompt(data.message)}}})}});$(".add-data-pop").on("click",".add-plan-btn",function(){var isTrue=$yt_valid.validForm($(".yt-edit-alert.add-data-pop"));if(isTrue){var planInput=$("#planInput").val();var yearInput=$("#yearInput").val();var unitCode=$("#unitCode").val();var describeTextarea=$("#describeTextarea").val();$.ajax({type:"post",url:'budget/books/saveBooksInfo',async:false,data:{booksName:planInput,booksYear:yearInput,unitNum:unitCode,booksDescribe:describeTextarea},success:function(data){if(data.flag==0){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();budgetList.getPlanList()}$yt_alert_Model.prompt(data.message)}})}});$('.yt-edit-alert.add-data-pop .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();$("#planInput,#yearInput,#describeTextarea").val("").removeClass("valid-hint");$(".add-data-pop .valid-font").text("");budgetList.getUtilName()})},getUtilName:function(){$.ajax({type:"post",url:$yt_option.base_path+'budget/table/getBudgetClassifyDataByParams?tableKey=coso_classify_unit_main',async:false,data:{},success:function(data){var datas=data.data.rows;if(data.flag==0){var numOptions='<option value="">请选择</option>';$('#unitCode').empty();if(datas.length>0&&datas!=undefined&&datas!=null){$.each(datas,function(i,n){numOptions+='<option value="'+n.code+'" sel-val="'+n.name+'">'+n.name+'</option>'});$('#unitCode').append(numOptions)}$('#unitCode').niceSelect()}}})},getPlanList:function(){var queryParams=$(".query-text").val();$.ajax({type:"post",url:"budget/books/getAllBooksInfoListByParams",async:false,data:{queryParams:queryParams},success:function(data){if(data.flag==0){$(".plan-list").html("");var thisData=data.data;if(thisData.length>0){var plalListHtml="";$.each(thisData,function(i,n){plalListHtml+='<div class="plan-list-item"><div class="list-item-title"><label><span style="letter-spacing:5px;">账套名</span>称：<span class="books-name"><input type="hidden" class="books-id" value="'+n.booksId+'"/>'+n.booksName+'</span></label><label><span style="letter-spacing:5px;">所属年</span>度：<span class="books-year">'+n.booksYear+'</span></label><label class="qtip-lable"><span style="letter-spacing:5px;">单位编</span>码：<span class="unit-num"><input type="hidden" value="'+n.unitNum+'"/>'+(n.unitNum==''?'--':n.unitNum)+'</span></label><label class="qtip-lable"><span style="letter-spacing:5px;">单位名</span>称：<span><input type="hidden" value="'+n.unitName+'"/>'+(n.unitName==''?'--':(n.unitName.length>12?n.unitName.substring(0,12)+'...':n.unitName))+'</span></label><label class="qtip-lable"><span style="letter-spacing:43px;">描</span>述：<span class="books-describe"><input type="hidden" value="'+n.booksDescribe+'"/>'+(n.booksDescribe==''?'--':(n.booksDescribe.length>12?n.booksDescribe.substring(0,12)+'...':n.booksDescribe))+'</span></label></div><div class="list-item-table"><table class="yt-table" style=""><thead class="yt-thead"><tr><th>阶段</th><th>状态</th></tr></thead><tbody class="yt-tbody">';if(n.budgetStageList.length>0){$.each(n.budgetStageList,function(index,nl){plalListHtml+='<tr><td><a class="yt-link to-list-link"><input type="hidden" class="budget-stage" value="'+nl.budgetStage+'"/>'+nl.budgetStageName+'('+nl.tableNum+')</a></td>';if(nl.stageState==0){plalListHtml+='<td>未创建</td>'}else if(nl.stageState==1){plalListHtml+='<td>已创建</td>'}else if(nl.stageState==2){plalListHtml+='<td>已发布</td>'}else if(nl.stageState==3){plalListHtml+='<td>已生效</td>'}else if(nl.stageState==4){plalListHtml+='<td>已完成</td>'}else{plalListHtml+='<td>已执行</td>'};plalListHtml+='</tr></tr>'})};plalListHtml+='</tbody></table></div></div>';});$(".plan-list").html(plalListHtml);budgetList.initQtip()}else{var noDataStr='<table style="width:100%;"><tr style="border:0px;background-color:#fff !important;"><td  colspan="'+1+'" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr></table>';$(".plan-list").html(noDataStr)}}else{$yt_alert_Model.prompt(data.messager)}}})},initQtip:function(){$('.qtip-lable').qtip({content:{text:function(event,api){var thisObj=$(this);var showText='<div style="max-width:220px;padding:3px 5px">'+(thisObj.find("input").val()==''?'暂无数据':thisObj.find("input").val())+'</div>';return showText}},position:{my:'top center',at:'bottom center',container:false,viewport:$('body'),adjust:{x:0,y:0,mouse:true,resize:true,method:'flip flip'}},hide:{fixed:true,},style:{classes:'showmod',tip:{corner:true,mimic:false,width:10,height:10,border:true,offset:0}},events:{show:function(data){$(data.target).find(".qtip-content").css("max-height",$('#frame-right-model').height()-200)}}})}};$(function(){budgetList.inits()});