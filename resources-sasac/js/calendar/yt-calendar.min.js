jQuery.fn.extend({calendar:function(S){function G(){$("#"+S.controlId).find(".tabD a").mouseup(function(){var e=new Date($("#"+S.controlId).find(".currentYear").text()+"/"+$("#"+S.controlId).find(".currentMonth").text()+"/1");if($(this).hasClass("prevD")){e.setMonth(e.getMonth()-1);e.setDate($(this).text());var c=S.speed;S.speed=0;$("#"+S.controlId).find(".prevMonth").triggerHandler("mouseup");S.speed=c}else{if($(this).hasClass("nextD")){e.setMonth(e.getMonth()+1);e.setDate($(this).text());c=S.speed;S.speed=0;$("#"+S.controlId).find(".nextMonth").triggerHandler("mouseup");S.speed=c}}var f=$(this).text();if(S.dateFmt!="yyyy-MM-dd HH:mm:ss"){e=e.getFullYear()+"-"+(Number(e.getMonth()+1)<10?"0"+Number(e.getMonth()+1):Number(e.getMonth()+1))+"-"+(Number(f)<10?"0"+f:f);N.val(e)}$("#"+S.controlId+" div table a").removeClass("select");$("#"+S.controlId+" .tabD a:contains('"+f+"')").each(function(){f==$(this).text()&&!$(this).hasClass("prevD")&&!$(this).hasClass("nextD")&&$(this).addClass("select")});if(S.dateFmt!="yyyy-MM-dd HH:mm:ss"){if(S.promHide){$("#"+S.controlId).remove()}}S.callback()}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}function o(){$("#"+S.controlId).find(".tabM a").mouseup(function(){if(S.dateFmt=="yyyy-MM"||S.dateFmt=="MM"){var e=$(this).attr("val");$("#"+S.controlId).find(".currentMonth").text(Number($(this).attr("val"))+1);var c=new Date(Number($("#"+S.controlId).find(".currentYear").text())+"/"+Number($("#"+S.controlId).find(".currentMonth").text())+"/1");if(S.dateFmt=="MM"){c=Number(c.getMonth()+1)<10?"0"+Number(c.getMonth()+1):Number(c.getMonth()+1)}else{c=c.getFullYear()+"-"+(Number(c.getMonth()+1)<10?"0"+Number(c.getMonth()+1):Number(c.getMonth()+1))}N.val(c);$("#"+S.controlId+" div table a").removeClass("select");if(S.promHide){S.callback();$("#"+S.controlId).remove()}}else{if(S.dateFmt=="yyyy-MM-dd"){var c=y(Number($("#"+S.controlId).find(".currentYear").text()),Number($(this).attr("val")));x(c);G();$("#"+S.controlId).find(".currentMonth").text(Number($(this).attr("val"))+1);$("#"+S.controlId).find(".calTitle").css("border-bottom","none");$("#"+S.controlId).height(242);$("#"+S.controlId).find(".btCurrentYear").hide();$("#"+S.controlId).find(".t_date div,.t_date,.currentYearText").show();$("#"+S.controlId).find(".t_date div:eq(0)").css("width","50%")}}}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}function m(){$("#"+S.controlId).find(".tabY a").mouseup(function(){if(S.dateFmt=="yyyy-MM"){if(!($("#"+S.controlId).find(".enabled > .tabM").length>0)){var c=j(Number($("#"+S.controlId).find(".currentYear").text()));t(c);o()}$("#"+S.controlId).find(".calTitle").css("border-bottom","1px solid #e5e5e5");$("#"+S.controlId).height(146);$("#"+S.controlId).find(".t_date div:eq(1)").hide()}else{if(S.dateFmt=="yyyy-MM-dd"){var c=y(Number($(this).text()),Number($("#"+S.controlId).find(".currentMonth").text())-1);x(c);G();$("#"+S.controlId).height(242)}else{if(S.dateFmt=="yyyy"){var e=$(this).text();$("#"+S.controlId).find(".currentYear").text(Number($(this).text()));var c=new Date($("#"+S.controlId).find(".currentYear").text()+"/1/1");c=c.getFullYear();N.val(c);$("#"+S.controlId+" div table a").removeClass("select");if(S.promHide){S.callback();$("#"+S.controlId).remove()}}}}$("#"+S.controlId).find(".currentYear").text(Number($(this).text()));$("#"+S.controlId).find(".calTitle").css("border-bottom","none");$("#"+S.controlId).find(".btCurrentYear").hide();$("#"+S.controlId).find(".t_date div:eq(0),.t_date,.currentYearText").show();$("#"+S.controlId).find(".t_date div:eq(0)").css("width","50%");$("#"+S.controlId).find(".t_date div:eq(1)").show()}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}function y(B,z){newDate=new Date(B,z,1);newDate.setDate(0);var v=1,s=newDate.getDate();newDate.setDate(1);newDate.setMonth(newDate.getMonth()+1);var f=newDate.getDay();if(f==0){f=7}s=s-f+1;newDate.setMonth(newDate.getMonth()+1);newDate.setDate(0);var e=newDate.getDate(),u="<table class='tabD'>";u+="<tr><th>周日</th><th>周一</th><th>周二</th><th>周三</th><th>周四</th><th>周五</th><th>周六</th></tr>";var r=l(),k="",c="",D="";S.complement||(D="style='display:none'");var n=!!S.upperLimit?(Object.prototype.toString.call(S.upperLimit)==="[object String]"?new Date(S.upperLimit):(!!S.upperLimit.val()?new Date(S.upperLimit.val()):NaN)):S.upperLimit;var C=!!S.lowerLimit?(Object.prototype.toString.call(S.lowerLimit)==="[object String]"?new Date(S.lowerLimit):(!!S.lowerLimit.val()?new Date(S.lowerLimit.val()):NaN)):S.lowerLimit;if(!isNaN(C)){C=new Date(C.getTime()-24*60*60*1000)}for(var A=0;A<6;A++){u+="<tr>";for(var w=0;w<7;w++){var q=A*7+w+1-f;c=k="";if(C!=NaN&&C>new Date(newDate.getFullYear(),newDate.getMonth(),q)||n!=NaN&&new Date(newDate.getFullYear(),newDate.getMonth(),q)>n){if(0<q&&q<=e){if(newDate.getFullYear()==R&&newDate.getMonth()==Q&&q==I){k="current"}u+="<td><span class='"+k+"'>"+q+"</span></td>"}else{if(q<=0){if(newDate.getFullYear()==R&&newDate.getMonth()-1==Q&&s==I){k="current"}u+="<td><span class='"+k+"' "+D+">"+s+"</span></td>";s++}else{if(q>e){if(newDate.getFullYear()==R&&newDate.getMonth()+1==Q&&v==I){k="current"}u+="<td><span class='"+k+"' "+D+">"+v+"</span></td>";v++}}}}else{if(0<q&&q<=e){if(newDate.getFullYear()==R&&newDate.getMonth()==Q&&q==I){k="current"}if(newDate.getFullYear()==r.getFullYear()&&newDate.getMonth()==r.getMonth()&&q==r.getDate()){c="select"}u+="<td><a class='"+c+" "+k+"'>"+q+"</a></td>"}else{if(q<=0){if(newDate.getFullYear()==R&&newDate.getMonth()-1==Q&&s==I){k="current"}if(newDate.getFullYear()==r.getFullYear()&&newDate.getMonth()-1==r.getMonth()&&s==r.getDate()){c="select"}u+="<td><a class='prevD "+c+" "+k+"' "+D+">"+s+"</a></td>";s++}else{if(q>e){if(newDate.getFullYear()==R&&newDate.getMonth()+1==Q&&v==I){k="current"}if(newDate.getFullYear()==r.getFullYear()&&newDate.getMonth()+1==r.getMonth()&&v==r.getDate()){c="select"}u+="<td><a class='nextD "+c+" "+k+"' "+D+">"+v+"</a></td>";v++}}}}u=u.replace("class=' '","")}u+="</tr>"}u+="</table>";return u}function j(e){var c=l(),f="<table class='tabM'>";f+="<tr>";f+="<td><a val='0' "+(e==c.getFullYear()&&0==c.getMonth()?"class='select'":"")+" "+(e==R&&0==Q?"class='current'":"")+">\u4e00\u6708</a></td>";f+="<td><a val='1' "+(e==c.getFullYear()&&1==c.getMonth()?"class='select'":"")+" "+(e==R&&1==Q?"class='current'":"")+">\u4e8c\u6708</a></td>";f+="<td><a val='2' "+(e==c.getFullYear()&&2==c.getMonth()?"class='select'":"")+" "+(e==R&&2==Q?"class='current'":"")+">\u4e09\u6708</a></td>";f+="<td><a val='3' "+(e==c.getFullYear()&&3==c.getMonth()?"class='select'":"")+" "+(e==R&&3==Q?"class='current'":"")+">\u56db\u6708</a></td>";f+="</tr>";f+="<tr>";f+="<td><a val='4' "+(e==c.getFullYear()&&4==c.getMonth()?"class='select'":"")+" "+(e==R&&4==Q?"class='current'":"")+">\u4e94\u6708</a></td>";f+="<td><a val='5' "+(e==c.getFullYear()&&5==c.getMonth()?"class='select'":"")+" "+(e==R&&5==Q?"class='current'":"")+">\u516d\u6708</a></td>";f+="<td><a val='6' "+(e==c.getFullYear()&&6==c.getMonth()?"class='select'":"")+" "+(e==R&&6==Q?"class='current'":"")+">\u4e03\u6708</a></td>";f+="<td><a val='7' "+(e==c.getFullYear()&&7==c.getMonth()?"class='select'":"")+" "+(e==R&&7==Q?"class='current'":"")+">\u516b\u6708</a></td>";f+="</tr>";f+="<tr>";f+="<td><a val='8' "+(e==c.getFullYear()&&8==c.getMonth()?"class='select'":"")+" "+(e==R&&8==Q?"class='current'":"")+">\u4e5d\u6708</a></td>";f+="<td><a val='9' "+(e==c.getFullYear()&&9==c.getMonth()?"class='select'":"")+" "+(e==R&&9==Q?"class='current'":"")+">\u5341\u6708</a></td>";f+="<td><a val='10' "+(e==c.getFullYear()&&10==c.getMonth()?"class='select'":"")+" "+(e==R&&10==Q?"class='current'":"")+">\u5341\u4e00\u6708</a></td>";f+="<td><a val='11' "+(e==c.getFullYear()&&11==c.getMonth()?"class='select'":"")+" "+(e==R&&11==Q?"class='current'":"")+">\u5341\u4e8c\u6708</a></td>";f+="</tr>";f+="</table>";return f}function L(v){$("#"+S.controlId).find(".btNowCurrentYear").text(v);var c=0,w=0,k=0;v=Math.floor(v/10)*10;var u="<table class='tabY'>",s=l(),q="",f="",e="";S.complement||(e="style='display:none'");for(var r=0;r<3;r++){u+="<tr>";for(var n=0;n<4;n++){f=q="";if(r+1*n+1!=1&&(r+1)*(n+1)!=12){if(v==s.getFullYear()){q="select"}if(v==R){f="current"}u+="<td><a class='"+q+" "+f+"' >"+v+"</a></td>";k=v;v++}else{if(r+1*n+1==1){if(v-1==s.getFullYear()){q="select"}if(v-1==R){f="current"}u+="<td><a class='prevY "+q+" "+f+"' "+e+">"+(v-1)+"</a></td>";k=v-1}else{if(v==s.getFullYear()){q="select"}if(v==R){f="current"}u+="<td><a class='nextY "+q+" "+f+"' "+e+">"+v+"</a></td>";k=v}}if(r==0&&n==0){c=k}if(r==2&&n==3){w=k}}u+="</tr>"}u+="</table>";$("#"+S.controlId).find(".btCurrentYear").text(c+"-"+w);return u}function J(e){var c=$("#"+S.controlId).find(".reserve"),f=$("#"+S.controlId).find(".enabled");c.stop();f.stop();c.removeClass("reserve").addClass("enabled");f.removeClass("enabled").addClass("reserve");c.css({"margin-left":f.width()+"px","margin-top":"0px"});c.empty().append(e);c.animate({"margin-left":"0px"},S.speed);f.animate({"margin-left":"-"+f.width()+"px"},S.speed,function(){f.empty()})}function H(e){var c=$("#"+S.controlId).find(".reserve"),f=$("#"+S.controlId).find(".enabled");c.stop();f.stop();c.removeClass("reserve").addClass("enabled");f.removeClass("enabled").addClass("reserve");c.css({"margin-left":"-"+f.width()+"px","margin-top":"0px"});c.empty().append(e);c.animate({"margin-left":"0px"},S.speed);f.animate({"margin-left":f.width()+"px"},S.speed,function(){f.empty()})}function x(e){var c=$("#"+S.controlId).find(".reserve"),f=$("#"+S.controlId).find(".enabled");c.stop();f.stop();c.removeClass("reserve").addClass("enabled");f.removeClass("enabled").addClass("reserve");$("#"+S.controlId).css({"z-index":1});c.css({"z-index":-1});f.css({"z-index":-1});c.css({"margin-left":"0px","margin-top":f.height()+"px"});c.empty().append(e);c.animate({"margin-top":"0px"},S.speed);f.animate({"margin-top":"-"+f.width()+"px"},S.speed,function(){f.empty();$("#"+S.controlId).css({"z-index":0});c.css({"z-index":0});f.css({"z-index":0})})}function O(c,n){var f={"M+":n.getMonth()+1,"d+":n.getDate(),"H+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};if(/(y+)/.test(c)){c=c.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))}for(var e in f){if(new RegExp("("+e+")").test(c)){c=c.replace(RegExp.$1,(RegExp.$1.length==1)?(f[e]):(("00"+f[e]).substr((""+f[e]).length)))}}return c}function t(e){var c=$("#"+S.controlId).find(".reserve"),f=$("#"+S.controlId).find(".enabled");c.stop();f.stop();c.removeClass("reserve").addClass("enabled");f.removeClass("enabled").addClass("reserve");$("#"+S.controlId).css({"z-index":1});c.css({"z-index":-1});f.css({"z-index":-1});c.css({"margin-left":"0px","margin-top":"-"+f.height()+"px"});c.empty().append(e);c.animate({"margin-top":"0px"},S.speed);f.animate({"margin-top":f.width()+"px"},S.speed,function(){f.empty();$("#"+S.controlId).css({"z-index":0});c.css({"z-index":0});f.css({"z-index":0})})}function l(){re=/(\d\d\d\d)(\W)?(\d\d)(\W)?(\d\d)/g;var c=N.val();c=c.replace(re,"$1/$3/$5@").split("@")[0];return new Date(c)}function p(e){var c=[];c.x=e.offsetLeft;for(c.y=e.offsetTop;e=e.offsetParent;){c.x+=e.offsetLeft;c.y+=e.offsetTop}return c}function h(){today=new Date;var C=today.getFullYear(),w=today.getMonth(),c=today.getDate(),r="";r+="<div id='"+S.controlId+"'class='calendar'>";r+="<div class='calMain'>";r+="<div class='calTitle'>";r+="<div class='t_date'>";r+="<div><a class='prevYear'></a><span class='btCurrentYear'></span><span style='display:none' class='btNowCurrentYear'></span><span class='currentYearText'><a class='currentYear'>"+Number(C)+"</a>\u5e74</span><a class='nextYear'></a></div>";r+="<div><a class='prevMonth'></a>";r+="<span class='currentMonthText'><a class='currentMonth'>"+Number(w+1)+"</a>\u6708</span>";r+="<a class='nextMonth'></a></div>";r+="</div>";r+="</div>";r+="<div class='calContent'>";r+="<div class='reserve'>";r+="</div>";r+="<div class='enabled'>";r+=y(C,w);r+="</div>";r+="</div>";r+="</div>";r+="</div>";$("body").find("#"+S.controlId).remove();$("body").append(r);G();$("#"+S.controlId).find(".prevMonth").mouseup(function(){var f=$("#"+S.controlId).find(".currentYear"),e=$("#"+S.controlId).find(".currentMonth"),k=y(Number(f.text()),Number(e.text())-2);H(k);if(Number(e.text())!=1){e.text(Number(e.text())-1)}else{f.text(Number(f.text())-1);e.text("12")}G()});$("#"+S.controlId).find(".nextMonth").mouseup(function(){if($("#"+S.controlId).find(".enabled > .tabD").length>0){var f=$("#"+S.controlId).find(".currentYear"),e=$("#"+S.controlId).find(".currentMonth"),k=y(Number(f.text()),Number(e.text()));J(k);if(Number(e.text())!=12){e.text(Number(e.text())+1)}else{f.text(Number(f.text())+1);e.text("1")}G()}else{if($("#"+S.controlId).find(".enabled > .tabM").length>0){k=j(Number($("#"+S.controlId).find(".currentYear").text())+1);J(k);o();$("#"+S.controlId).find(".currentYear").text(Number($("#"+S.controlId).find(".currentYear").text())+1)}else{if($("#"+S.controlId).find(".enabled > .tabY").length>0){k=L(Number($("#"+S.controlId).find(".currentYear").text())+10);J(k);m();$("#"+S.controlId).find(".currentYear").text(Number($("#"+S.controlId).find(".currentYear").text())+10)}}}});$("#"+S.controlId).find(".currentMonthText").mouseup(function(){if(!($("#"+S.controlId).find(".enabled > .tabM").length>0)){var e=j(Number($("#"+S.controlId).find(".currentYear").text()));t(e);o()}$("#"+S.controlId).find(".calTitle").css("border-bottom","1px solid #e5e5e5");$("#"+S.controlId).height(146);$("#"+S.controlId).find(".t_date div:eq(1)").hide()});$("#"+S.controlId).find(".prevYear").mouseup(function(){if($("#"+S.controlId).find(".btCurrentYear:visible").length>0){var e=L(Number($("#"+S.controlId).find(".btNowCurrentYear").text())-10);t(e);m();return}if($("#"+S.controlId).find(".enabled > .tabD").length>0){var e=y(Number($("#"+S.controlId).find(".currentYear").text())-1,Number($("#"+S.controlId).find(".currentMonth").text())-1);x(e);G()}$("#"+S.controlId).find(".currentYear").text(Number($("#"+S.controlId).find(".currentYear").text())-1)});$("#"+S.controlId).find(".nextYear").mouseup(function(){if($("#"+S.controlId).find(".btCurrentYear:visible").length>0){var e=L(Number($("#"+S.controlId).find(".btNowCurrentYear").text())+10);t(e);m();return}if($("#"+S.controlId).find(".enabled > .tabD").length>0){var e=y(Number($("#"+S.controlId).find(".currentYear").text())+1,Number($("#"+S.controlId).find(".currentMonth").text())-1);x(e);G()}$("#"+S.controlId).find(".currentYear").text(Number($("#"+S.controlId).find(".currentYear").text())+1)});$("#"+S.controlId).find(".currentYearText").mouseup(function(){if(!($("#"+S.controlId).find(".enabled > .tabY").length>0)){var e=L(Number($("#"+S.controlId).find(".currentYear").text()));t(e);m()}$("#"+S.controlId).find(".calTitle").css("border-bottom","1px solid #e5e5e5");$("#"+S.controlId).height(146);$("#"+S.controlId).find(".t_date div:eq(1)").hide();$("#"+S.controlId).find(".t_date .currentYearText").hide();$("#"+S.controlId).find(".t_date .btCurrentYear").show();$("#"+S.controlId).find(".t_date div:eq(0)").css("width","150px")});$(N).addClass("calendar-input-bg");var z,v,n;v=parseInt($(N).css("padding-left"));n=parseInt($(N).css("padding-right"));z=$(N).width()-(v)-(v!=0?5:10);$(N).css("background-position",(z)+"px 7px");N.mouseover(function(){$(N).css("background-position",(z)+"px -25px")});N.blur(function(){$(N).css("background-position",(z)+"px 7px")});var D="今天";var u="";if(S.dateFmt=="yyyy-MM"||S.dateFmt=="MM"){D="本月"}else{if(S.dateFmt=="yyyy"){D="本年"}}var B='<button class="close">关闭</button>';if(S.dateFmt=="yyyy-MM-dd HH:mm:ss"){u='<div class="calendar-hms"><input class="tH" type="text" value="12" /><span>:</span><input type="text" class="tm" value="12" /><span>:</span><input class="tS" type="text" value="12" /></div>';B='<button class="confirm">确定</button>'}var s=$('<div class="buttonBox">'+u+'<div class="buttonList"><button class="empty">清空</button><button class="today">'+D+"</button>"+B+"</div></div>");var A=$(N).val();if(A!=""){A=new Date(A.replace(/-/g,"/"))}else{A=new Date()}s.find(".calendar-hms input:eq(0)").val(A.getHours());s.find(".calendar-hms input:eq(1)").val(A.getMinutes());s.find(".calendar-hms input:eq(2)").val(A.getSeconds());s.find(".calendar-hms input").focus(function(){this.select()}).keyup(function(){$(this).val($(this).val().replace(/[^0-9]/ig,""));if($(this).val().length>2){$(this).val($(this).val().substr(0,2))}if(Number($(this).val())>24&&$(this).hasClass("tH")){$(this).val(24)}if(Number($(this).val())>59&&!$(this).hasClass("tH")){$(this).val(59)}}).bind("paste input",function(){$(this).val($(this).val().replace(/[^0-9]/ig,""));if($(this).val().length>2){$(this).val($(this).val().substr(0,2))}if(Number($(this).val())>24&&$(this).hasClass("tH")){$(this).val(24)}if(Number($(this).val())>59&&!$(this).hasClass("tH")){$(this).val(59)}}).css("ime-mode","disabled");s.find(".calendar-hms input").off().on("keydown",function(e){if(e.keyCode==40){if($(this).val()==0){$(this).val(59)}else{$(this).val(Number($(this).val())-1)}}if(e.keyCode==38){$(this).val(Number($(this).val())+1);if(Number($(this).val())>24&&$(this).hasClass("tH")){$(this).val(0)}if(Number($(this).val())>59&&!$(this).hasClass("tH")){$(this).val(0)}}});$(s).find(".empty").unbind("click").bind("click",function(){$(N).val("");$(N).css("background-position",(z)+"px 7px");S.emptyCallback();$("#"+S.controlId).remove()});$(s).find(".today").unbind("click").bind("click",function(){var e=C+"-"+((w+1)<10?"0"+(w+1):(w+1))+"-"+(c<10?"0"+c:c);if(S.dateFmt=="yyyy-MM"){e=C+"-"+((w+1)<10?"0"+(w+1):(w+1))}else{if(S.dateFmt=="MM"){e=(w+1)<10?"0"+(w+1):(w+1)}else{if(S.dateFmt=="yyyy"){e=C}}}$(N).val(e);$(N).css("background-position",(z)+"px 7px");S.callback();$("#"+S.controlId).remove()});$(s).find(".close").unbind("click").bind("click",function(){$(N).css("background-position",(z)+"px 7px");$("#"+S.controlId).remove()});$(s).find(".confirm").unbind("click").bind("click",function(){var k=$("#"+S.controlId).find(".tH").val()|0;var q=$("#"+S.controlId).find(".tm").val()|0;var f=$("#"+S.controlId).find(".tS").val()|0;var e=new Date($("#"+S.controlId).find(".currentYear").text()+"/"+$("#"+S.controlId).find(".currentMonth").text()+"/"+($("#"+S.controlId).find(".tabD a.select").text()||$("#"+S.controlId).find(".tabD a.current").text())+" "+k+":"+q+":"+f);$(N).val(O(S.dateFmt,e));$(N).css("background-position",(z)+"px 7px");$("#"+S.controlId).remove()});$("#"+S.controlId).append(s)}S=jQuery.extend({controlId:$(this).attr("id")+"Calendar",speed:200,complement:true,readonly:true,upperLimit:NaN,lowerLimit:NaN,nowData:true,promHide:true,dateFmt:"yyyy-MM-dd",callback:function(){},emptyCallback:function(){}},S||{});var N=$(this);if(S.readonly){N.attr("readonly",true);N.bind("keydown",function(){if(event.keyCode==8){event.keyCode=0}})}today=new Date;var R=today.getFullYear(),Q=today.getMonth(),I=today.getDate(),P="";P+="<div id='"+S.controlId+"'class='calendar'>";P+="<div class='calMain'>";P+="<div class='calTitle'>";P+="<div class='t_date'>";P+="<div><a class='prevYear'></a><span class='btCurrentYear'></span><span style='display:none' class='btNowCurrentYear'></span><span class='currentYearText'><a class='currentYear'>"+Number(R)+"</a>\u5e74</span><a class='nextYear'></a></div>";P+="<div><a class='prevMonth'></a>";P+="<span class='currentMonthText'><a class='currentMonth'>"+Number(Q+1)+"</a>\u6708</span>";P+="<a class='nextMonth'></a></div>";P+="</div>";P+="</div>";P+="<div class='calContent'>";P+="<div class='reserve'>";P+="</div>";P+="<div class='enabled'>";P+=y(R,Q);P+="</div>";P+="</div>";P+="</div>";P+="</div>";G();$("#"+S.controlId).find(".prevMonth").mouseup(function(){var e=$("#"+S.controlId).find(".currentYear"),c=$("#"+S.controlId).find(".currentMonth"),f=y(Number(e.text()),Number(c.text())-2);H(f);if(Number(c.text())!=1){c.text(Number(c.text())-1)}else{e.text(Number(e.text())-1);c.text("12")}G()});$("#"+S.controlId).find(".nextMonth").mouseup(function(){if($("#"+S.controlId).find(".enabled > .tabD").length>0){var e=$("#"+S.controlId).find(".currentYear"),c=$("#"+S.controlId).find(".currentMonth"),f=y(Number(e.text()),Number(c.text()));J(f);if(Number(c.text())!=12){c.text(Number(c.text())+1)}else{e.text(Number(e.text())+1);c.text("1")}G()}else{if($("#"+S.controlId).find(".enabled > .tabM").length>0){f=j(Number($("#"+S.controlId).find(".currentYear").text())+1);J(f);o();$("#"+S.controlId).find(".currentYear").text(Number($("#"+S.controlId).find(".currentYear").text())+1)}else{if($("#"+S.controlId).find(".enabled > .tabY").length>0){f=L(Number($("#"+S.controlId).find(".currentYear").text())+10);J(f);m();$("#"+S.controlId).find(".currentYear").text(Number($("#"+S.controlId).find(".currentYear").text())+10)}}}});$("#"+S.controlId).find(".currentMonthText").mouseup(function(){if(!($("#"+S.controlId).find(".enabled > .tabM").length>0)){var c=j(Number($("#"+S.controlId).find(".currentYear").text()));t(c);o()}$("#"+S.controlId).find(".calTitle").css("border-bottom","1px solid #e5e5e5");$("#"+S.controlId).height(146);$("#"+S.controlId).find(".t_date div:eq(1)").hide()});$("#"+S.controlId).find(".prevYear").mouseup(function(){if($("#"+S.controlId).find(".btCurrentYear:visible").length>0){var c=L(Number($("#"+S.controlId).find(".btNowCurrentYear").text())-10);t(c);m();return}if($("#"+S.controlId).find(".enabled > .tabD").length>0){var c=y(Number($("#"+S.controlId).find(".currentYear").text())-1,Number($("#"+S.controlId).find(".currentMonth").text())-1);x(c);G()}$("#"+S.controlId).find(".currentYear").text(Number($("#"+S.controlId).find(".currentYear").text())-1)});$("#"+S.controlId).find(".nextYear").mouseup(function(){if($("#"+S.controlId).find(".btCurrentYear:visible").length>0){var c=L(Number($("#"+S.controlId).find(".btNowCurrentYear").text())+10);t(c);m();return}if($("#"+S.controlId).find(".enabled > .tabD").length>0){var c=y(Number($("#"+S.controlId).find(".currentYear").text())+1,Number($("#"+S.controlId).find(".currentMonth").text())-1);x(c);G()}$("#"+S.controlId).find(".currentYear").text(Number($("#"+S.controlId).find(".currentYear").text())+1)});$("#"+S.controlId).find(".currentYearText").mouseup(function(){if(!($("#"+S.controlId).find(".enabled > .tabY").length>0)){var c=L(Number($("#"+S.controlId).find(".currentYear").text()));t(c);m()}$("#"+S.controlId).find(".calTitle").css("border-bottom","1px solid #e5e5e5");$("#"+S.controlId).height(146);$("#"+S.controlId).find(".t_date div:eq(1)").hide();$("#"+S.controlId).find(".t_date .currentYearText").hide();$("#"+S.controlId).find(".t_date .btCurrentYear").show();$("#"+S.controlId).find(".t_date div:eq(0)").css("width","150px")});$(N).addClass("calendar-input-bg");var T,M,a;M=parseInt($(N).css("padding-left"));a=parseInt($(N).css("padding-right"));T=$(N).width()-(M)-(M!=0?5:10);$(N).css("background-position",(T)+"px 7px");N.mouseover(function(){$(N).css("background-position",(T)+"px -25px")});N.blur(function(){$(N).css("background-position",(T)+"px 7px")});var d="今天";var i="";if(S.dateFmt=="yyyy-MM"||S.dateFmt=="MM"){d="本月"}else{if(S.dateFmt=="yyyy"){d="本年"}}var K='<button class="close">关闭</button>';if(S.dateFmt=="yyyy-MM-dd HH:mm:ss"){i='<div class="calendar-hms"><input class="tH" type="text" value="12" /><span>:</span><input type="text" class="tm" value="12" /><span>:</span><input class="tS" type="text" value="12" /></div>';K='<button class="confirm">确定</button>'}var b=$('<div class="buttonBox">'+i+'<div class="buttonList"><button class="empty">清空</button><button class="today">'+d+"</button>"+K+"</div></div>");var g=$(N).val();if(g!=""){g=new Date(g.replace(/-/g,"/"))}else{g=new Date()}b.find(".calendar-hms input:eq(0)").val(g.getHours());b.find(".calendar-hms input:eq(1)").val(g.getMinutes());b.find(".calendar-hms input:eq(2)").val(g.getSeconds());b.find(".calendar-hms input").focus(function(){this.select()}).keyup(function(){$(this).val($(this).val().replace(/[^0-9]/ig,""));if($(this).val().length>2){$(this).val($(this).val().substr(0,2))}if(Number($(this).val())>24&&$(this).hasClass("tH")){$(this).val(24)}if(Number($(this).val())>59&&!$(this).hasClass("tH")){$(this).val(59)}}).bind("paste input",function(){$(this).val($(this).val().replace(/[^0-9]/ig,""));if($(this).val().length>2){$(this).val($(this).val().substr(0,2))}if(Number($(this).val())>24&&$(this).hasClass("tH")){$(this).val(24)}if(Number($(this).val())>59&&!$(this).hasClass("tH")){$(this).val(59)}}).css("ime-mode","disabled");b.find(".calendar-hms input").off().on("keydown",function(c){if(c.keyCode==40){if($(this).val()==0){$(this).val(59)}else{$(this).val(Number($(this).val())-1)}}if(c.keyCode==38){$(this).val(Number($(this).val())+1);if(Number($(this).val())>24&&$(this).hasClass("tH")){$(this).val(0)}if(Number($(this).val())>59&&!$(this).hasClass("tH")){$(this).val(0)}}});$(b).find(".empty").unbind("click").bind("click",function(){$(N).val("");$(N).css("background-position",(T)+"px 7px");S.emptyCallback();$("#"+S.controlId).remove()});$(b).find(".today").unbind("click").bind("click",function(){var c=R+"-"+((Q+1)<10?"0"+(Q+1):(Q+1))+"-"+(I<10?"0"+I:I);if(S.dateFmt=="yyyy-MM"){c=R+"-"+((Q+1)<10?"0"+(Q+1):(Q+1))}else{if(S.dateFmt=="MM"){c=(Q+1)<10?"0"+(Q+1):(Q+1)}else{if(S.dateFmt=="yyyy"){c=R}}}$(N).val(c);$(N).css("background-position",(T)+"px 7px");S.callback();$("#"+S.controlId).remove()});$(b).find(".close").unbind("click").bind("click",function(){$(N).css("background-position",(T)+"px 7px");$("#"+S.controlId).remove()});$(b).find(".confirm").unbind("click").bind("click",function(){var f=$("#"+S.controlId).find(".tH").val()|0;var k=$("#"+S.controlId).find(".tm").val()|0;var e=$("#"+S.controlId).find(".tS").val()|0;var c=new Date($("#"+S.controlId).find(".currentYear").text()+"/"+$("#"+S.controlId).find(".currentMonth").text()+"/"+($("#"+S.controlId).find(".tabD a.select").text()||$("#"+S.controlId).find(".tabD a.current").text())+" "+f+":"+k+":"+e);$(N).val(O(S.dateFmt,c));$(N).css("background-position",(T)+"px 7px");$("#"+S.controlId).remove()});$("#"+S.controlId).append(b);if(S.nowData){if(S.dateFmt=="yyyy-MM"){$(N).val(R+"-"+((Q+1)<10?"0"+(Q+1):(Q+1)))}else{if(S.dateFmt=="yyyy-MM-dd"){$(N).val(R+"-"+((Q+1)<10?"0"+(Q+1):(Q+1))+"-"+(I<10?"0"+I:I))}else{if(S.dateFmt=="yyyy"){$(N).val(R)}else{if(S.dateFmt=="MM"){$(N).val((Q+1)<10?"0"+(Q+1):(Q+1))}}}}}N.bind("click focus",function(r){if(true){h();var k=$("#"+S.controlId),f=p(N[0]),s=$(N).offset().left+Number($(N).get(0).clientLeft)-1;f=Number($(N).offset().top)+Number($(N).get(0).clientHeight)+1;var n=$(document).scrollTop();if(n>0){f=f+Number($(N).height())+Number($(k).height())}if((f+244)>$(window).height()){f=f-243-$(N).get(0).clientHeight}if((s+222)>$(window).width()){s=s-220+$(N).get(0).clientWidth}k.css({top:f+"px",left:s+"px"});s=$("#"+S.controlId).width();f=$("#"+S.controlId).height();$(N).css("background-position",(T)+"px -57px");k.width(0);k.height(0);k.css("display","block").css({width:s+"px",height:f+"px"});var u=new Date();if(N.val()!=""&&N.val()!=undefined){u=new Date(N.val().replace(/-/g,"/"))}if(S.dateFmt=="yyyy-MM"||S.dateFmt=="MM"){if(S.dateFmt=="yyyy-MM"){u=new Date(N.val().replace(/-/g,"/")+"/01")}else{var q=new Date();u=new Date(q.getYear()+"/"+N.val()+"/01")}var c=j(Number(u.getFullYear()));t(c);o();$("#"+S.controlId).find(".currentYear").text(Number(u.getFullYear()));$("#"+S.controlId).find(".currentMonth").text(Number(u.getMonth()+1));if(S.dateFmt=="MM"){$("#"+S.controlId).height(116);$("#"+S.controlId).find(".calTitle").hide()}else{$("#"+S.controlId).height(146);$("#"+S.controlId).find(".t_date div:eq(1)").hide();$("#"+S.controlId).find(".t_date div:eq(1)").hide();$("#"+S.controlId).find(".t_date .currentYearText").show();$("#"+S.controlId).find(".t_date .btCurrentYear").hide();$("#"+S.controlId).find(".t_date div:eq(0)").css("width","150px")}}else{if(S.dateFmt=="yyyy-MM-dd"){var c=y(u.getFullYear(),u.getMonth());x(c);G();$("#"+S.controlId).find(".currentYear").text(Number(u.getFullYear()));$("#"+S.controlId).find(".currentMonth").text(Number(u.getMonth()+1));$("#"+S.controlId).height(242);$("#"+S.controlId).find(".btCurrentYear").hide();$("#"+S.controlId).find(".t_date div,.t_date,.currentYearText").show();$("#"+S.controlId).find(".t_date div:eq(0)").css("width","50%")}else{if(S.dateFmt=="yyyy"){u=new Date(N.val().replace(/-/g,"/")+"/01/01");var k=L(Number(Number(u.getFullYear())));t(k);m();$("#"+S.controlId).find(".calTitle").css("border-bottom","1px solid #e5e5e5");$("#"+S.controlId).height(146);$("#"+S.controlId).find(".t_date div:eq(1)").hide();$("#"+S.controlId).find(".t_date .currentYearText").hide();$("#"+S.controlId).find(".t_date .btCurrentYear").show();$("#"+S.controlId).find(".t_date div:eq(0)").css("width","150px")}}}}$yt_common.eventStopPageaction(r)});$(document).mouseup(function(c){if($(c.target).attr("id")!=N.attr("id")&&($(c.target).parentsUntil("#"+S.controlId).parent().length==0||$(c.target).parentsUntil("#"+S.controlId).parent()[0].id!=S.controlId)&&!$(c.target).hasClass("hover")){$("#"+S.controlId).remove()}})}});