var sysCommon={riskData:"",processState:[],comRiskCodes:"",riskExcMark:"../../../../../resources-sasac/images/common/war-red.png",riskWarImg:"../../../../../resources-sasac/images/common/risk-war.png",riskViaImg:"../../../../../resources-sasac/images/common/risk-via.png",isWorkFlowStateStr:'未通过,已完成,已撤销',clearValidInfo:function(validObj){$(validObj).find(".valid-font").text("");$(validObj).find("input,textarea,select").removeClass("valid-hint")},pageToScroll:function(validObj){var scrollTopVal=0;$(validObj).each(function(){if($(this).text()!=""){if($(window).scrollTop()&&($(this).eq(0).parent().offset().top<$(window).scrollTop()||$(this).eq(0).parent().offset().top>$(window).height())){scrollTopVal=$(this).eq(0).parents().offset().top-30;$(window).scrollTop(scrollTopVal)}return false}})},getUserAllInfo:function(userIds,userCodes,userName){var usersData="";userIds=(userIds==undefined?"":userIds);userCodes=(userCodes==undefined?"":userCodes);userName=(userName==undefined?"":userName);$.ajax({type:"post",url:'user/userInfo/getAllUserObjectsByParams',async:false,data:{userIds:userIds,userCodes:userCodes,userName:userName},success:function(data){if(data.flag==0){usersData=data.data}}});return usersData},calculateDays:function(startDate,endDate){var days=0;if(startDate!=""&&endDate!=""){var startDates=new Date(startDate.replace(/-/g,"/"));var endDates=new Date(endDate.replace(/-/g,"/"));var time=endDates.getTime()-startDates.getTime();days=parseInt(time/(1000*60*60*24)+1);if(startDates.getTime()==endDates.getTime()){days=1}}return days},getNowDate:function(){var nowDate=new Date();var year=nowDate.getFullYear();var month=nowDate.getMonth()+1;var day=nowDate.getDate();if(month<10){month="0"+month}if(day<10){day="0"+day}var currentDate=year+"年"+month+"月"+day+"日";return currentDate},getRiskData:function(modelFlag){$.ajax({type:"post",url:'basicconfig/risk/getSystemRiskByParams',async:false,success:function(data){if(data.flag==0){var riskCode="";$.each(data.data,function(i,n){$("[datariskcode]").each(function(i,v){riskCode=$(v).attr("datariskcode");if(n.pageFieldCode==riskCode){var obj=$(v).next(".risk-model");if(obj.length==0){obj=$(v).parent().next(".risk-model")}obj.show();var lableType=$(v)[0].tagName;if(lableType=="SELECT"||lableType=="INPUT"||lableType=="TEXTAREA"){}$(v).data("riskData",n);var objs=null;$.each(n.ruleCheckFields,function(k,j){objs=$('[datariskcode = "'+j.pageFieldCode+'"]');objs.on(j.funEvent,function(){var riskData=n;if(j.funExecuted!=""&&j.funExecuted!=undefined){eval(j.funExecuted)}else{eval(n.ruleImplJsCode)}})})}})});sysCommon.riskData=data.data;sysCommon.riskMsgClickEvent(modelFlag)}}})},riskMsgClickEvent:function(modelFlag){$(modelFlag).find(".risk-model").off().on("click",function(){sysCommon.showRiskMsg($(this).find(".hid-risk-code").val())})},showRiskMsg:function(riskCode){$.each(sysCommon.riskData,function(i,n){if(riskCode==n.pageFieldCode){if(n.pageFieldCode=="costDetailVehicle"||n.pageFieldCode=="costDetailHotelCost"){$("#cost-apply-model").hide()}var riskMsg='<div>'+n.lawsTitle+n.riskLawsContents+'<a class="yt-link risk-link">'+n.linkKeyWord+'</a></div>';riskMsg=$(riskMsg);riskMsg.find(".risk-link").data("riskLink",n.linkContents);$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:riskMsg,cancelFunction:function(){if(n.pageFieldCode=="costDetailVehicle"||n.pageFieldCode=="costDetailHotelCost"){$("#cost-apply-model").show();$("#heard-nav-bak,#pop-modle-alert").show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($("#cost-apply-model"));$("body").css("overflow","hidden")}}})}});$(".risk-link").on("click",function(){sysCommon.riskLinkModel($(this).data("riskLink"))})},createSumTr:function(tabObj){if(tabObj==0){if($("#traffic-list-info tbody").find(".total-last-tr").length==0){var totalRows='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$("#traffic-list-info tbody").append(totalRows)}}if(tabObj==1){if($("#hotel-list-info tbody").find(".total-last-tr").length==0){var totalRows='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td  class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td><td></td></tr>';$("#hotel-list-info tbody").append(totalRows)}}if(tabObj==2){if($("#other-list-info tbody").find(".total-last-tr").length==0){var totalRows='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$("#other-list-info").append(totalRows)}}if(tabObj==3){if($("#subsidy-list-info tbody").find(".total-last-tr").length==0){var totalRows='<tr class="total-last-tr">< <td class="tab-font-blod">合计</td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td class="font-right tab-font-blod city-money-td"></td><td></td></tr>';$("#subsidy-list-info").append(totalRows)}}},costDetailModelTabEvent:function(){$("#costApplyAlert .cost-type-tab ul li").off().on("click",function(){$(this).siblings().removeClass("tab-check");$(this).addClass("tab-check");if($(this).hasClass("traffic-tab")){$(".traffic-form").show();$(".hotel-form,.other-form").hide();$(".hotel-form,.other-form").find(".valid-font").text("");$(".hotel-form,.other-form").find(".valid-hint").removeClass("valid-hint")}else if($(this).hasClass("hotel-tab")){$(".hotel-form").show();$(".traffic-form,.other-form").hide();$(".traffic-form,.other-form").find(".valid-font").text("");$(".traffic-form,.other-form").find(".valid-hint").removeClass("valid-hint")}else{$(".other-form").show();$(".traffic-form,.hotel-form").hide();$(".traffic-form,.hotel-form").find(".valid-font").text("");$(".traffic-form,.hotel-form").find(".valid-hint").removeClass("valid-hint")}})},clearFormData:function(){var modelObj=$(".cost-detail-info-model");$(".traffic-form input:not(.hid-risk-code),.hotel-form input:not(.hid-risk-code),.other-form input:not(.hid-risk-code)").val('');modelObj.find("textarea").val('');modelObj.find("select").each(function(i,n){$(n).find("option:eq(0)").attr("selected","selected")});$("#vehicleTwoDiv").hide();modelObj.find("#hotelTwoAddres,#hotelChildAddres").html('').append('<option value="">请选择</option>');modelObj.find("select").niceSelect();modelObj.find(".yt-numberInput").val(1);modelObj.find("#peoDayMoney").text("0.00");modelObj.find("#hotelDay").text("*");$(".cost-type-tab ul li").removeClass("tab-check");$(".cost-type-tab ul li:eq(0)").addClass("tab-check");$(".traffic-form").show();$(".hotel-form,.other-form").hide();$("#model-add-list-btn").show();$("#model-sure-btn").hide();modelObj.find(".risk-img").attr("src",sysCommon.riskExcMark);modelObj.find(".valid-font").text("");modelObj.find(".valid-hint").removeClass("valid-hint")},getBusiTripUsersSelData:function(){$.ajax({type:"post",url:"user/userInfo/getAllUserInfoByParams",async:false,success:function(data){if(data.flag==0){var optionText='<option value="">请选择</option>';if(data.data.length>0){$.each(data.data,function(i,n){optionText='<option value="'+n.userItcode+'" data-level="'+n.jobLevelName+'">'+n.userName+'</option>';$("#model-trip-user").append(optionText);$("#hotel-trip-user").append(optionText)});$("#model-trip-user,#hotel-trip-user").niceSelect()}$("#model-trip-user").on("change",function(){var userCode=$(this).val();if(userCode==""){$(".vehicle-sel").parents("td").find(".risk-img").attr("src",sysCommon.riskWarImg)}else{$(".vehicle-sel").parents("td").find(".risk-img").attr("src",sysCommon.riskViaImg);var userObj=sysCommon.getUserAllInfo("",userCode);var riskData=$(".vehicle-sel").parents("td").find(".hid-risk-code").data("riskData");if(userObj[userCode]!=undefined&&userObj[userCode]!=""){var level=userObj[userCode].jobLevelCode;var ruleFormImpl=eval("("+riskData.ruleFormImpl+")");if(ruleFormImpl[level]){var vehicleOne=$(".vehicle-sel").val();var riskObj=ruleFormImpl[level];if(riskObj[vehicleOne]!=undefined){var vehicleTwo=$(".vehicle-two-sel").val();if($(".vehicle-two-sel option").length>0){if(riskObj[vehicleOne].indexOf(vehicleTwo)>-1){$(".vehicle-sel").parents("td").find(".risk-img").attr("src",sysCommon.riskViaImg)}else{$(".vehicle-sel").parents("td").find(".risk-img").attr("src",sysCommon.riskWarImg)}}}else{$(".vehicle-sel").parents("td").find(".risk-img").attr("src",sysCommon.riskWarImg)}}else{$(".vehicle-sel").parents("td").find(".risk-img").attr("src",sysCommon.riskWarImg)}}}})}}})},vechicleChildData:function(selVal){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:false,data:{dictTypeCode:selVal},success:function(data){if(data.flag==0){var veStr="";$(".vehicle-two-sel").empty();veStr='<option value="">请选择</option>';if(data.data.length>0){$("#vehicleTwoDiv").show();$.each(data.data,function(i,n){veStr='<option value="'+n.value+'">'+n.disvalue+'</option>';$(".vehicle-two-sel").append(veStr)});$(".vehicle-two-sel").niceSelect()}else{$("#vehicleTwoDiv").hide();if(selVal==""){$(".vehicle-sel").parents("td").find(".risk-img").attr("src",sysCommon.riskWarImg)}else{if($("#model-trip-user").val()!=""){$(".vehicle-sel").parents("td").find(".risk-img").attr("src",sysCommon.riskViaImg)}}}}}})},noDataTrStr:function(tdNum){var noDataStr='<tr style="border:0px;background-color:#fff !important;"><td  colspan="'+tdNum+'" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';return noDataStr},createFlowApproveMode:function(){var flowStr='';flowStr='<div class="ordinar-div approve-div"><div class="label-title"><div class="title-model-sty"><img src="../../../../../resources-sasac/images/icons/flow-title-icon.png"><span class="title-text">流程审批</span></div><div class="title-line"><div></div></div></div>';flowStr+='<div class="operation"><div class="count-box" style="margin-left: 0px;padding-left: 0;padding-top: 0;"><div class="form-label"><label><span class="not-null">*</span>选择操作流程：</label><select name="" id="operate-flow" risk-code-val="reimApplyOperFlow" class="oper-select" validform={isNull:true,msg:\'请选择操作流程\'} style="display: none;"><option value="">请选择</option></select><div class="valid-font" style="left: 105px;"></div></div>';flowStr+='<div class="form-label"><label><span class="not-null">*</span>选择审批人：</label><select name="" risk-code-val="reimApplyApproveUsers" id="approve-users" class="oper-select" validform="{isNull:true,msg:\'请选择审批人\'}" style="display: none;"><option value="">请选择</option></select><div class="valid-font" style="left: 92px;"></div></div>';flowStr+='</div>';flowStr+='<div class="count-box" style="margin-left: 0px;padding-left: 0px;"><div class="left"><span class="not-null opintion-msg-null" style="display: none;">*</span><span>操作意见：</span></div><div class="right"><textarea id="opintion" risk-code-val="reimApplyFlowOperSug" class="yt-textarea" placeholder="请输入"style="resize: none;width: 98%;"></textarea><div class="valid-font"></div></div></div></div></div>';return flowStr},getApproveFlowData:function(businessCode,processInstanceId,parameters){$.ajax({type:"post",url:"basicconfig/workFlow/getSubmitPageData",async:false,data:{processInstanceId:processInstanceId,parameters:parameters,businessCode:businessCode},success:function(data){if(data.flag==0){var optionText='<option value="">请选择</option>';var dataList=[];var dataObj="";if(data.data.length>0){$.each(data.data,function(i,n){for(var k in n){dataObj=eval("("+k+")");dataObj["approveUsers"]=n[k];dataList.push(dataObj)}})}var optionText='<option value="">请选择</option>';$("#operate-flow,#approve-users").empty();if(dataList.length>0){$("#operate-flow,#approve-users").append(optionText);$.each(dataList,function(i,n){optionText='<option value="'+n.nextCode+'">'+n.nextName+'</option>';$("#operate-flow").append(optionText)});$("#operate-flow,#approve-users").niceSelect();$("#operate-flow").on("change",function(){if($(this).val()=="returnedSubmit"||$(this).val()=="returnedTask"||$(this).val()=="returnedUp"||$(this).val()=="refusedToApproval"){$(".not-null.opintion-msg-null").show();$("#opintion").attr("validform","{isNull:true,blurFlag:true,msg:'请填写操作意见'}")}else{$(".not-null.opintion-msg-null").hide();$("#opintion").attr("validform","''").removeClass("valid-hint");$("#opintion").parent().find(".valid-font").text('')}sysCommon.getApproveUsersByFlow(dataList,$(this).val())})}else{$("#operate-flow,#approve-users").append(optionText)}}}})},getApproveUsersByFlow:function(flowData,nextOperCode){var optionText='<option value="">请选择</option>';$("#approve-users").append(optionText);$.each(flowData,function(i,n){if(n.nextCode==nextOperCode){$("#approve-users").parents("td").prev().find("div").show();$("#approve-users").parent().show();if(n.approveUsers.length>0){$("#approve-users").empty();$("#approve-users").parents("td").prev().find("div").show();$("#approve-users").parent().show();$.each(n.approveUsers,function(i,v){optionText='<option value="'+v.userCode+'">'+v.userName+'</option>';$("#approve-users").append(optionText)});$("#approve-users").attr("validform","{isNull:true,msg:'请选择审批人'}")}else{$("#approve-users").append(optionText);$("#approve-users").niceSelect();$("#approve-users").parents("td").prev().find("div").hide();$("#approve-users").parent().hide();$("#approve-users").attr("validform","{isNull:false,msg:'请选择审批人'}")}return false}else{$("#approve-users").append(optionText);$("#approve-users").niceSelect();$("#approve-users").parents("td").prev().find("div").hide();$("#approve-users").parent().hide();$("#approve-users").attr("validform","{isNull:false,msg:'请选择审批人'}")}});$("#approve-users").niceSelect()},updateMoneySum:function(thisTab){var moenySum=0.00;if(thisTab==0){$("#traffic-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#traffic-list-info tbody .money-sum").text(moenySum)}else{$("#traffic-list-info tbody .money-sum").text("0.00")}}if(thisTab==1){$("#hotel-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#hotel-list-info tbody .money-sum").text(moenySum)}else{$("#hotel-list-info tbody .money-sum").text("0.00")}}if(thisTab==2){$("#other-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#other-list-info tbody .money-sum").text(moenySum)}else{$("#other-list-info tbody .money-sum").text("0.00")}}if(thisTab==3){$("#subsidy-list-info tbody .food-money").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#subsidy-list-info tbody .money-sum").text(moenySum)}else{$("#subsidy-list-info tbody .money-sum").text("0.00")}var cityMoneySum=0.00;$("#subsidy-list-info tbody .city-money").each(function(i,n){cityMoneySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});cityMoneySum=$yt_baseElement.fmMoney(cityMoneySum);if(cityMoneySum!=undefined&&$yt_baseElement.rmoney(cityMoneySum)>0){$("#subsidy-list-info tbody .city-money-td").text(cityMoneySum)}else{$("#subsidy-list-info tbody .city-money-td").text("0.00")}}sysCommon.updateApplyMeonySum()},updateApplyMeonySum:function(){var sumMoney=0;$(".cost-list-model table .money-sum").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});$(".cost-list-model table .city-money-td").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});sumMoney=$yt_baseElement.fmMoney(sumMoney);$("#applySumMoney").text(sumMoney);if($("body").find("#reimPrice")){$("#reimPrice").text(sumMoney);var loanPrice=$("#loanCost").text();var replPrice=$yt_baseElement.rmoney(sumMoney)-parseFloat(loanPrice);replPrice=$yt_baseElement.fmMoney(replPrice);$("#givePrice").text(replPrice)}if(sumMoney!=null&&sumMoney!=undefined&&$yt_baseElement.rmoney(sumMoney)>0){var sumMoneyLower=arabiaToChinese(sumMoney);$("#applyMoneyLower").text(sumMoneyLower)}else{$("#applySumMoney").text("0.00")}},getLoginUserInfo:function(){$("#busiUsers").text($yt_common.user_info.userRealName);$("#deptName").text($yt_common.user_info.deptName);$("#jobName").text($yt_common.user_info.posiNaming==""?"--":$yt_common.user_info.positionName);$("#telPhone").text($yt_common.user_info.userPhone==""?"--":$yt_common.user_info.userPhone)},closeModel:function(thisObj){thisObj.hide();$("#heard-nav-bak").hide();$('#pop-modle-alert').hide();$yt_baseElement.hideMongoliaLayer();$("body").css("overflow","auto")},showModel:function(thisObj){$("#heard-nav-bak,#pop-modle-alert").show();$yt_baseElement.showMongoliaLayer();thisObj.show();$(thisObj).find("tbody tr").removeClass("yt-table-active");$yt_alert_Model.getDivPosition(thisObj);$("body").css("overflow","hidden")},riskLinkModel:function(linkCont){var linkModel='<div class="link-cont-model"><div>'+linkCont+'</div><div><div class="yt-alert-one-bottom"><input type="button" class="yt-model-bot-btn yt-model-sure-btn" id="linkCloseBtn" value="关闭"></div>';+'</div></div>';$("body").append(linkModel);sysCommon.showModel($(".link-cont-model"));$("#linkCloseBtn").off().on("click",function(){$(".link-cont-model").remove()});$(".link-cont-model").mCustomScrollbar()},getAddressInfoList:function(){var dataList="";$.ajax({type:"get",url:$yt_option.websit_path+'resources-sasac/js/system/expensesReim/module/reimApply/regionList.json',async:false,success:function(data){dataList=data}});return dataList},getHotCityList:function(){var dataList="";$.ajax({type:"get",url:$yt_option.websit_path+'resources-sasac/js/system/expensesReim/module/reimApply/hotCityList.json',async:false,success:function(data){dataList=data}});return dataList},loadingWord:function(url){if(url.indexOf("http://")!=0){url=$yt_option.websit_path+url}$yt_common.request_params={};if(url.indexOf("?")!=-1){var str=url.substr(url.indexOf("?")+1);strs=str.split("&");for(var i=0;i<strs.length;i+=1){$yt_common.request_params[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}}else{$yt_common.request_params=null}$("#indexMainDiv").html("");$.ajax({type:"get",url:url,async:false,success:function(data){$("#indexMainDiv").html(data);}})},initQtip:function(logQtipObj){logQtipObj.qtip({content:{text:function(event,api){var txt='';var WorkFlowLogList=[];var td=$(this).parent("td").prevAll("td");var processInstanceId=td.find('.processInstanceId').val();$.ajax({type:"post",url:"basicconfig/workFlow/getWorkFlowLog",async:false,data:{processInstanceId:processInstanceId},success:function(data){if(data.data!=undefined&&data.data!=null){WorkFlowLogList=data.data}if(WorkFlowLogList==null||WorkFlowLogList==undefined){return}shomd="";shomd='<div class="suspension" >';var WorkFlowLog;for(var i=0;i<WorkFlowLogList.length;i+=1){WorkFlowLog=WorkFlowLogList[i];if(i==0){shomd+='<div class="log-msg-model"><div><div class="first-log-msg"><span class="log-num">'+(WorkFlowLogList.length-i)+'</span></div><span class="user-name">【'+(WorkFlowLog.taskName==''?'':WorkFlowLog.taskName)+'】'+(WorkFlowLog.userName==""?'无':WorkFlowLog.userName)+'</span><div style="clear:both;"></div></div><div class="log-line-div" style="'+(i==(WorkFlowLogList.length-1)?"padding-bottom: 0px;":"padding-bottom: 10px;")+''+(WorkFlowLogList.length==1?"border:0px;":"")+'"><div style="'+(WorkFlowLogList.length==1?"border:0px;":"border-bottom: 1px solid #D6E6F3;")+'"><div class="oper-status-model"><label class="log-label-text">操作状态</label><span>：</span><span>'+(WorkFlowLog.operationState==""?"无":WorkFlowLog.operationState)+'</span></div><div class="oper-time-model"><label class="log-label-text">操作时间</label><span>：</span><span>'+(WorkFlowLog.commentTime==""?"无":WorkFlowLog.commentTime)+'</span></div>';if(WorkFlowLog.comment!=""&&WorkFlowLog.comment!=null&&WorkFlowLog.comment!=" "){shomd+='<div class="log-comment-model"><label class="log-label-text">操作意见</label><span>：</span><span class="oper-comment-msg">'+(WorkFlowLog.comment==''?'':WorkFlowLog.comment)+'</span></div>'}shomd+='</div></div>'}else{shomd+='<div class="log-msg-model"><div><div class="log-msg-def-bak"><span class="log-num">'+(WorkFlowLogList.length-i)+'</span></div><span class="user-name" style="top:0px;">【'+(WorkFlowLog.taskName==''?'':WorkFlowLog.taskName)+'】'+(WorkFlowLog.userName==""?'无':WorkFlowLog.userName)+'</span><div style="clear:both;"></div></div><div class="log-line-div" style="'+(i==(WorkFlowLogList.length-1)?"padding-bottom: 0px;":"padding-bottom: 10px;")+''+(i==(WorkFlowLogList.length-1)?"border:0px;":"")+'"><div style="'+(i==(WorkFlowLogList.length-1)?"border:0px;":"border-bottom: 1px solid #D6E6F3;")+'"><div class="oper-status-model"><label class="log-label-text">操作状态</label><span>：</span><span>'+(WorkFlowLog.operationState==""?"无":WorkFlowLog.operationState)+'</span></div><div class="oper-time-model"><label class="log-label-text">操作时间</label><span>：</span><span>'+(WorkFlowLog.commentTime==""?"无":WorkFlowLog.commentTime)+'</span></div>';if(WorkFlowLog.comment!=""&&WorkFlowLog.comment!=null&&WorkFlowLog.comment!=" "){shomd+='<div class="log-comment-model"><label class="log-label-text">操作意见</label><span>：</span><span class="oper-comment-msg">'+(WorkFlowLog.comment==''?'':WorkFlowLog.comment)+'</span></div>'}shomd+='</div></div>'}shomd+='</div>'}}});return(WorkFlowLogList.length<1?'<span style="color:#999">暂无数据</span>':shomd);}},position:{my:'right top',at:'left top',container:false,viewport:false,adjust:{x:8,y:8,mouse:true,resize:true,method:'flip flip'}},hide:{fixed:true,},style:{classes:'showmod',tip:{corner:true,mimic:false,width:10,height:10,border:true,offset:0,}},events:{show:function(data){$(data.target).find(".qtip-content").css("max-height",$('#frame-right-model').height()-200)}}})},getCommentByProcessInstanceId:function(processInstanceId){var flowLogHtml='<div class="flow-div flow-log">';$.ajax({type:"post",url:"basicconfig/workFlow/getWorkFlowLog",async:false,data:{processInstanceId:processInstanceId},success:function(data){var txt='';if(!!data&&data.flag=='0'){var list=data.data||[];sysCommon.processState=list;var imgUrl="";for(var i=0,len=list.length;i<len;i+=1){if(i==0){imgUrl="../../../../../resources-sasac/images/common/log-border-color.png"}else{imgUrl="../../../../../resources-sasac/images/common/log-info-border.png"}txt+='<div class="log-info">'+(i==list.length-1?'':'<div class="log-icon-border"></div>')+'<div class="log-icon"><img src="'+(list.length==1?'../../../../../resources-sasac/images/common/num-icon-one.png':(i==0?'../../../../../resources-sasac/images/common/log-num-first.png':'../../../../../resources-sasac/images/common/log-num.png'))+'" /><div class="log-icon-num" '+(i==0?'style="top: 7px;"':'')+'>'+(list.length-i)+'<div></div></div></div><div class="log-details '+(i==0?"log-shadow-sty":"")+'" '+((list[i].comment==undefined||list[i].comment==null||list[i].comment=="")?'style="padding-bottom: 30px;"':'')+'><label class="log-task-name">【'+list[i].taskName+'】</label><label class="log-name">'+list[i].userName+'</label><img style="'+(i==0?"left: -9px;":"left:-8px;")+'" src="'+imgUrl+'"/><div><p><label class="log-title">操作状态：</label><span class="log-state">'+list[i].operationState+'</span></p>'+((list[i].comment==undefined||list[i].comment==null||list[i].comment=="")?'':('<p class="log-ideap"><label class="log-title">操作意见：</label><label class="log-idea">'+list[i].comment+'</label></p>'))+'</div></div><label class="log-time">'+list[i].commentTime+'</label></div>'}flowLogHtml+=txt+'</div>'}}});return flowLogHtml},processStatePop:function(processInstanceId){var popHtml='<div class="yt-pop-model yt-edit-alert process-state-pop"><div class="model-title"><span class="yt-edit-alert-icon"><img src="../../../../../resources-sasac/images/common/loop.png"></span><span class="yt-edit-alert-title-msg">当前状态</span></div><!--主体内容部分START--><div class="yt-edit-alert-main cont-edit-test"><div class="imgBox"></div><!--底部按钮操作区域START--><div class="model-bottom-btn"><button class="yt-option-btn yt-cancel-btn canel-btn" id="" style="margin-left: 10px;">关闭</button></div></div></div>';$("body").append(popHtml);var thisPop=$(".yt-edit-alert.process-state-pop");sysCommon.showModel(thisPop);$yt_alert_Model.getDivPosition(thisPop);$('.imgBox').html('<img src="'+$yt_option.workFlow+'findPngByProcessInstanceId?processInstanceId='+processInstanceId+'">');thisPop.on("click",".canel-btn",function(){sysCommon.closeModel(thisPop);thisPop.remove();})}};var EventUtil={add:function(element,type,callback){if(element.addEventListener){element.addEventListener(type,callback,false)}else if(element.attachEvent){element.attachEvent('on'+type,callback)}else{element['on'+type]=callback}},remove:function(element,type,callback){if(element.removeEventListener){element.removeEventListener(type,callback,false)}else if(element.detachEvent){element.detachEvent('on'+type,callback)}else{element['on'+type]=null}},getEvent:function(event){return event?event:window.event},getTarget:function(event){return event.target||event.srcElement},preventDefault:function(event){if(event.preventDefault){event.preventDefault()}else{event.returnValue=false}},stopPropagation:function(){if(event.stopPropagation){event.stopPropagation()}else{event.cancelBubble=true}}};function arabiaToChinese(Num){Num=Num+"";for(i=Num.length-1;i>=0;i-=1){Num=Num.replace(",","");Num=Num.replace(" ","");}Num=Num.replace("￥","");if(isNaN(Num)){$yt_alert_Model.prompt("请检查小写金额是否正确",2000);return}part=String(Num).split(".");newchar="";for(i=part[0].length-1;i>=0;i-=1){if(part[0].length>10){$yt_alert_Model.prompt("位数过大，无法计算",2000);return ""}tmpnewchar="";perchar=part[0].charAt(i);switch(perchar){case "0":tmpnewchar="零"+tmpnewchar;break;case "1":tmpnewchar="壹"+tmpnewchar;break;case "2":tmpnewchar="贰"+tmpnewchar;break;case "3":tmpnewchar="叁"+tmpnewchar;break;case "4":tmpnewchar="肆"+tmpnewchar;break;case "5":tmpnewchar="伍"+tmpnewchar;break;case "6":tmpnewchar="陆"+tmpnewchar;break;case "7":tmpnewchar="柒"+tmpnewchar;break;case "8":tmpnewchar="捌"+tmpnewchar;break;case "9":tmpnewchar="玖"+tmpnewchar;break}switch(part[0].length-i-1){case 0:tmpnewchar=tmpnewchar+"元";break;case 1:if(perchar!=0){tmpnewchar=tmpnewchar+"拾"}break;case 2:if(perchar!=0){tmpnewchar=tmpnewchar+"佰"}break;case 3:if(perchar!=0){tmpnewchar=tmpnewchar+"仟"}break;case 4:tmpnewchar=tmpnewchar+"万";break;case 5:if(perchar!=0){tmpnewchar=tmpnewchar+"拾"}break;case 6:if(perchar!=0){tmpnewchar=tmpnewchar+"佰"}break;case 7:if(perchar!=0){tmpnewchar=tmpnewchar+"仟"}break;case 8:tmpnewchar=tmpnewchar+"亿";break;case 9:tmpnewchar=tmpnewchar+"拾";break}newchar=tmpnewchar+newchar}if(Num.indexOf(".")!=-1){if(part[1].length>2){part[1]=part[1].substr(0,2)}for(i=0;i<part[1].length;i+=1){tmpnewchar="";perchar=part[1].charAt(i);switch(perchar){case "0":tmpnewchar="零"+tmpnewchar;break;case "1":tmpnewchar="壹"+tmpnewchar;break;case "2":tmpnewchar="贰"+tmpnewchar;break;case "3":tmpnewchar="叁"+tmpnewchar;break;case "4":tmpnewchar="肆"+tmpnewchar;break;case "5":tmpnewchar="伍"+tmpnewchar;break;case "6":tmpnewchar="陆"+tmpnewchar;break;case "7":tmpnewchar="柒"+tmpnewchar;break;case "8":tmpnewchar="捌"+tmpnewchar;break;case "9":tmpnewchar="玖"+tmpnewchar;break}if(i==0){tmpnewchar=tmpnewchar+"角"}if(i==1){tmpnewchar=tmpnewchar+"分"}newchar=newchar+tmpnewchar}}while(newchar.search("零零")!=-1){newchar=newchar.replace("零零","零")}newchar=newchar.replace("零亿","亿");newchar=newchar.replace("亿万","亿");newchar=newchar.replace("零万","万");newchar=newchar.replace("零元","元");newchar=newchar.replace("零角","");newchar=newchar.replace("零分","");if(newchar.charAt(newchar.length-1)=="元"||newchar.charAt(newchar.length-1)=="角"){newchar=newchar+"整"}if(newchar=="元整"){newchar="--"}return newchar};$.fn.extend({showImg:function(obj){var imgId='show-img-box'+(parseInt(Math.random()*1000000000));var imgs=$(this);imgs.addClass(imgId);imgs.off().on("click",function(){var ulMl=$("#"+imgId).find("li").width()*imgs.index($(this))*-1;if($("#"+imgId).length>0){$("#"+imgId).find("ul").css("margin-left",ulMl+"px");$("#"+imgId).show();$('#pop-modle-alert').show()}else{var wHeigth=$(window).height();var wWidth=$(window).width();if(wWidth/wHeigth>20/13){wWidth=Math.floor(wHeigth*20/13-200)}else{wWidth=wWidth-100}var bannerWidth=Math.floor(wWidth*0.8);var hannerHeight=Math.floor(bannerWidth*13/20);var imgsElement=$('<div id="'+imgId+'" class="show-img-box"><a class="prev"></a><a class="next"></a></div>');$("body").append(imgsElement);var closeElement=$('<a class="close-btn" src="img/icons/atta-x.png"></a>');var imgBox=$('<div class="imgs-list"></div>');imgBox.css({width:bannerWidth,height:hannerHeight});closeElement.click(function(){$("#"+imgId).hide();$('#pop-modle-alert').hide()});imgsElement.append(closeElement).append(imgBox);var imgListEle=$('<ul style="width: '+($("."+imgId).length*bannerWidth)+'px;"></ul>');imgListEle.css("margin-left",ulMl+"px");$("."+imgId).each(function(){var img=new Image();var imgLi=$('<li></li>').append(img);imgLi.css({width:bannerWidth,height:hannerHeight});img.draggable=false;img.src=$(this).attr('src');img.name='viewImg';var meImg=imgLi.find("img");img.onload=function(){if(img.width/img.height>20/13){$(meImg).css("width","100%")}else{$(meImg).css("height","100%")}};imgListEle.append(imgLi)});imgBox.append(imgListEle);ulMl=imgsElement.find("li").width()*imgs.index($(this))*-1;imgsElement.find("ul").css("margin-left",ulMl+"px");imgsElement.find(".next").click(function(){$(this).siblings(".imgs-list").find("ul").stop(true,true);var bannerWidth=$(this).siblings(".imgs-list").find("li").width();var bannerUlWidth=$(this).siblings(".imgs-list").find("ul").width();var ulLeft=$(this).siblings(".imgs-list").find("ul").css("margin-left");var nextUlLeft=parseInt(ulLeft.replace("px","").replace("PX",""))-bannerWidth;if(nextUlLeft>bannerUlWidth*-1){$(this).siblings(".imgs-list").find("ul").animate({marginLeft:nextUlLeft},500,function(){});}});imgsElement.find(".prev").click(function(){$(this).siblings(".imgs-list").find("ul").stop(true,true);var bannerWidth=$(this).siblings(".imgs-list").find("li").width();var ulLeft=$(this).siblings(".imgs-list").find("ul").css("margin-left");var nextUlLeft=parseInt(ulLeft.replace("px","").replace("PX",""))+bannerWidth;console.log(nextUlLeft);if(nextUlLeft<=10){$(this).siblings(".imgs-list").find("ul").animate({marginLeft:nextUlLeft},500,function(){});}});imgsElement.show();$('#pop-modle-alert').show()}})}});