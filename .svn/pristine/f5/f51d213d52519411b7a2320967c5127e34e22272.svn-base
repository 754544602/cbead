var demand={budgetApprovalDetails:"",init:function(){$("#demandApply").css("min-height",$(window).height()-32);sysCommon.getLoginUserInfo();var budgetPrjAppId=$yt_common.GetQueryString('budgetPrjAppId');var processInstanceId=$yt_common.GetQueryString('processInstanceId');var flowLogHtml=sysCommon.getCommentByProcessInstanceId(processInstanceId);$(".flow-log-div").html(flowLogHtml);demand.getBudgetPrjAppInfoByAppId(budgetPrjAppId);$("#closeBtn").click(function(){if(window.top==window.self){window.close()}else{parent.closeWindow()}})},getBudgetPrjAppInfoByAppId:function(budgetPrjAppId){$.ajax({type:"post",url:"budget/prjApp/getBudgetPrjAppInfoByAppId",async:false,data:{budgetPrjAppId:budgetPrjAppId},success:function(data){if(data.flag==0){var datas=data.data;demand.budgetApprovalDetails=datas;if(datas&&datas!=""&&datas!=undefined){$("#formNum").text(datas.budgetPrjAppNum);$("#applyDate").text(datas.applicantTime);$("#busiUsers").text(datas.applicantUserName);$("#deptName").text(datas.applicantUserDeptName);$("#jobName").text(datas.applicantUserJobName==""?"--":datas.applicantUserJobName);$("#telPhone").text(datas.applicantUserPhone==""?"--":datas.applicantUserPhone);$(".project-name").text(datas.prjName);$(".project-company").text(datas.prjUnitName);$(".company-code").text((datas.compUnitName||"无"));$(".project-type").text(datas.prjClassifyName);$(".project-year").text(datas.prjStartYear);$(".project-cycle").text(datas.prjCycle);$(".implementation-company").text(datas.implUnitName);$(".project-attribute").text((datas.prjAttrName||"无"));$(".project-basis").text((datas.prjBasisContent||'无'));$(".implementation-feasibility").text((datas.implPlanFeasContent||'无'));demand.midGoalInfo(datas.midGoalInfo);demand.yearGoalInfo(datas.yearGoalInfo);demand.showFileList(datas.attrList)}}else{}}})},midGoalInfo:function(datas){if(datas&&datas!=''&&datas!=undefined){$(".metaphase-total").text($yt_baseElement.fmMoney(datas.totalAmount)+"万元"||'--');$(".among-finance").text($yt_baseElement.fmMoney(datas.financeAmount)+"万元"||'--');$(".other-capital").text($yt_baseElement.fmMoney(datas.otherAmount)+"万元"||'--');$(".metaphase-target").text(datas.goalContent||"无");var midKpiInfoList=datas.midKpiInfoList;var trStr="";var htmlTbody=$('.metaphase-table .yt-tbody');if(midKpiInfoList&&midKpiInfoList!=''&&midKpiInfoList!=undefined){htmlTbody.empty();$.each(midKpiInfoList,function(i,n){trStr+='<tr><td oneTargetCode='+n.oneTargetCode+'>'+n.oneTargetName+'</td><td twoTargetCode='+n.twoTargetCode+'>'+n.twoTargetName+'</td><td threeTargetCode='+n.threeTargetCode+'>'+n.threeTargetName+'</td><td style="">'+n.prjTargetValue+'</td><td>'+(n.units||"--")+'</td></tr>'});htmlTbody.append(trStr)}else{htmlTbody.html(sysCommon.noDataTrStr(5))}}else{$yt_alert_Model.prompt('无中期目标')}},yearGoalInfo:function(datas){if(datas&&datas!=''&&datas!=undefined){$(".year-total").text($yt_baseElement.fmMoney(datas.totalAmount)+"万元"||'--');$(".year-finance").text($yt_baseElement.fmMoney(datas.financeAmount)+"万元"||'--');$(".year-other").text($yt_baseElement.fmMoney(datas.otherAmount)+"万元"||'--');$(".year-target").text(datas.goalContent||"无");var yearKpiInfoList=datas.yearKpiInfoList;var trStr="";var htmlTbody=$('.year-table .yt-tbody');if(yearKpiInfoList&&yearKpiInfoList!=''&&yearKpiInfoList!=undefined){htmlTbody.empty();$.each(datas.yearKpiInfoList,function(i,n){trStr+='<tr><td oneTargetCode='+n.oneTargetCode+'>'+n.oneTargetName+'</td><td twoTargetCode='+n.twoTargetCode+'>'+n.twoTargetName+'</td><td threeTargetCode='+n.threeTargetCode+'>'+n.threeTargetName+'</td><td style="">'+n.prjTargetValue+'</td><td>'+(n.units||"--")+'</td></tr>'});htmlTbody.append(trStr)}else{htmlTbody.html(sysCommon.noDataTrStr(5))}}else{$yt_alert_Model.prompt('无年度目标')}},showFileList:function(list){if(list.length>0){var ls='';var src='';$.each(list,function(i,n){var imgType=n.attName.split('.');if(imgType.length>1&&(imgType[1]=='png'||imgType[1]=='jpeg'||imgType[1]=='bmp'||imgType[1]=='jpg')){src=$yt_option.base_path+'fileUpDownload/download?pkId='+n.attId+'&isDownload=false';ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pv">预览<img src="'+src+'" ></label></div>'}else{ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pvno">预览</label></div>'}});$('#attIdStr').html(ls);$('#attIdStr .file-dw').on('click',function(){var id=$(this).parent().attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'});$('#attIdStr .file-pv img').showImg()}else{$("#attIdStr").html("暂无附件")}}};$(function(){demand.init()});