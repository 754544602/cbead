//开班式资料归档
var projectList={init:function(){var types=$yt_common.GetQueryString("types");if(types==1){$(".class-title").text("开班式");$(".class-order-title").text("开班式会序");$(".class-order-file").text("开班式讲稿");$(".depute-order-file").text("委托单位讲稿归档");$(".depute-img").text("开班式照片")};if(types==2){$(".class-title").text("结业式");$(".class-order-title").text("结业式会序");$(".class-order-file").text("结业式讲稿讲稿");$(".depute-order-file").text("委托单位讲稿归档");$(".depute-img").text("结业式照片")};projectList.getOneListInfo();projectList.delFileTr();projectList.delImgLi();$("#up-file").undelegate().delegate("input","change",function(){$(".up-fileIds").next().text("");var addFile=$(this).attr("id");var fileName=$(this).val().split('\\');var fm=fileName[fileName.length-1];var fileTypeLen=fm.split(".");var fileType=fileTypeLen[(fileTypeLen.length-1)];if(fileType=="docx"||fileType=="doc"||fileType=="xls"||fileType=="xlsx"||fileType=="pdf"||fileType=="xls"||fileType=="ppt"||fileType=="pptx"){var url=$yt_option.acl_path+"api/tAscPortraitInfo/addFile?modelCode=caFile";$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:addFile,success:function(data,textStatus){var resultData=$.parseJSON(data);var fileId=resultData.obj.pkId;if(resultData.success==0){$yt_alert_Model.prompt("附件上传成功");fileList=[fm,fileId];projectList.addLineLecture(fm,fileId)}else{$yt_alert_Model.prompt("附件上传失败")}},error:function(data,status,e){$yt_alert_Model.prompt("附件上传失败!!!!")}})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("请上传doc,xls,pdf,ppt格式文件！")})}});$(".operate-depute-img-box").undelegate().delegate("input","change",function(){$(".up-fileIds").next().text("");var addImg=$(this).attr("id");var fileName=$(this).val().split('\\');var imgName=fileName[fileName.length-1];var fileTypeLen=imgName.split(".");var imgType=fileTypeLen[(fileTypeLen.length-1)];if(imgType=="jpg"||imgType=="jpeg"||imgType=="png"||imgType=="tiff"||imgType=="gif"){var url=$yt_option.acl_path+"api/tAscPortraitInfo/addFile?modelCode=caFile";$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:addImg,success:function(data,textStatus){var resultData=$.parseJSON(data);var imgId=resultData.obj.pkId;if(resultData.success==0){$yt_alert_Model.prompt("附件上传成功");fileList=[imgName,imgId];projectList.addOneImg(imgName,imgId);$(".operate-depute-img-box input").val("")}},error:function(data,status,e){$yt_alert_Model.prompt("附件上传失败!")}})}else{$yt_alert_Model.prompt("请上传jpg格式图片!")}});$('.add-lecture-tb tbody').on('click',".down-file",function(){var filePkId=$(this).parent().parent().find('.file-span-id').val();var fileURL=$(this).parent().parent().find('.fileURL').val();$.ajaxDownloadFile({url:fileURL})});$('.add-depute-lecture-tb tbody').on('click',".down-file",function(){var filePkId=$(this).parent().parent().find('.file-span-id').val();var fileURL=$(this).parent().parent().find('.fileURL').val();$.ajaxDownloadFile({url:fileURL})});$('#last-cancel').click(function(){window.location.href="lectureList.html"});$('.page-return-btn').click(function(){window.location.href="lectureList.html"});projectList.imgStyleFn();$('#submit').click(function(){projectList.addImgInfo()})},imgStyleFn:function(){$('.testjqthumb').jqthumb({width:120,height:130})},addClassInfo:function(){$yt_baseElement.showLoading();var pkId=$yt_common.GetQueryString("pkId");var operateType=$yt_common.GetQueryString("types");var businessCode=$('#businessCode').val();var processInstanceId=$('#processInstanceId').val();var projectCode=$('#projectCode').val();var startTime=$('.startTime').val();var orderListArr=[];var details="";var dateLength="";var orderBy="";$(".add-order-tb tbody tr").each(function(i,n){orderBy=i+1;details=$(n).find('.details').val();dateLength=$(n).find('.dateLength').val();var orderList={details:details,dateLength:dateLength,orderBy:orderBy};orderListArr.push(orderList)});var orderListJson=JSON.stringify(orderListArr);var fileListArr=[];var fileId="";var fileName="";var types="";var fileListArr=[];$(".add-lecture-tb tbody tr").each(function(i,n){fileId=$(n).find('.file-span-id').val();fileName=$(n).find('.fileName').text();var fileList={fileId:fileId,fileName:fileName,types:2};fileListArr.push(fileList)});var fileListJson=JSON.stringify(fileListArr);var opintion="";var dealingWithPeople=$('#nextPeople').val();var nextCode="submited";$.ajax({type:"post",url:$yt_option.base_path+"class/openHonors/addOrUpdateBean",data:{pkId:pkId,types:operateType,projectCode:projectCode,startTime:startTime,orderList:orderListJson,fileList:fileListJson,dataStates:dataStates,businessCode:businessCode,nextCode:nextCode},success:function(data){if(data.flag==0){projectList.init();$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("添加失败");$(".yt-edit-alert,#heard-nav-bak").hide();$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("添加失败")})}projectList.getPlanListInfo()}})},delFileTr:function(){$(".add-depute-lecture-tb").on('click',".entry-del-icon",function(){var tr=$(this).parent().parent();$yt_alert_Model.alertOne({haveAlertIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})})},addLineLecture:function(fileName,fileId){var num=$(".add-depute-lecture-tb tbody tr").length+1;var lineTrHtml='<tr><input type="hidden" class="fileURL" value="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+fileId+'"><td class="lecture-tds">【<span class="fileLineNum">'+num+'</span>】</td><td class="fileName"><input type="hidden" class="file-span-id" value="'+fileId+'" >'+fileName+'</td><td style="display:none;" class="lecture-tds"><img class="ioc-img" src="../../resources/images/open/yulan.png" /></td><td style="width: 40px; display:none;">预览</td><td class="lecture-tds" style="text-align:center;width:70px"><span style="cursor: pointer;" class="down-file"><img class="ioc-img" src="../../resources/images/open/xiazai2.png" />下载</span></td><td class="lecture-tds" style="text-align:center;width:170px"><span style="cursor: pointer;" class="entry-del-icon"><img class="ioc-img" src="../../resources/images/open/delete.png" />删除</span></td></tr>';$(".depute-lecture tbody").append(lineTrHtml)},delImgLi:function(){$(".content-div-box ").on('click',".dele-img",function(){var tr=$(this).parent().parent();$yt_alert_Model.alertOne({haveAlertIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})});$('.content-div-box').on('click',".down-img",function(){var filePkId=$(this).parent().parent().find('.imgId').val();var fileURL=$(this).parent().parent().find('.fileURL').val();$.ajaxDownloadFile({url:fileURL})})},addOneImg:function(imgName,imgId){var liHtml='<li class="img-li"><div class="img-div-box"><input type="hidden" class="imgId" value="'+imgId+'"><input type="hidden" class="fileURL" value="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+imgId+'"><input type="hidden" class="imgName" value="'+imgName+'"><img class="testjqthumb " src="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+imgId+'" alt="'+imgName+'"> </div><div class="operate-box"><div class="down-img" style="cursor: pointer;"><img class="ioc-img down-btn-img" src="../../resources/images/open/xiazai2.png" />下载</div><div class="dele-img" style="cursor: pointer;"><img class="dele-btn-img ioc-img" src="../../resources/images/open/delete.png" />删除</div></div></li>';$('.ul-btn').append(liHtml);$('.ul-btn .testjqthumb').last().jqthumb({width:120,height:130});projectList.delImgLi()},getOutOpenHonors:function(){var alertNmae="";var pkId=$('#pkId').val();var types=$('#types').val();$.ajaxDownloadFile({url:$yt_option.base_path+"class/openHonors/exportOrder",pkId:pkId,types:types})},getOneListInfo:function(){$yt_baseElement.showLoading();var pkId=$yt_common.GetQueryString("pkId");var types=$yt_common.GetQueryString("types");$.ajax({type:"post",url:$yt_option.base_path+"class/openHonors/getBeanById",async:false,data:{pkId:pkId,types:types},objName:'data',success:function(data){if(data.flag==0){$('#projectCode').text(data.data.projectName);$('#projectUserName').text(data.data.projectUserName);$('#startTime').text(data.data.startTime);$('#traineeCount').text(data.data.traineeCount);$('#createTimeString').text(data.data.createTimeString);$('#createUser').text(data.data.createUserName);$('#types').val(data.data.types);$('#pkId').val(data.data.pkId);var orderList=data.data.orderList;var orderListObj=$.parseJSON(orderList);$.each(orderListObj,function(i,v){var num=$(".add-order-tb tbody tr").length+1;var lineTrHtml='<tr class="add-textList tr-border-style"><td style="text-align:center;" class="order-by"> <input type="hidden" class="orderBy" value="'+v.orderBy+'"/>'+num+'</td><td class="td-input details">'+v.details+'</td><td class="dateLength" style="padding-right:10px; text-align:right;"><span style="margin-right:5px">'+v.dateLength+'</span>分钟</td></tr>';$(".add-order-tb tbody").append(lineTrHtml)});var fileList=data.data.fileList;var fileListObj=$.parseJSON(fileList);var fileType;$.each(fileListObj,function(i,v){fileType=v.fileType;if(fileType==1){var i=i+1;var lineTrHtml='<tr class="file-tr-border-style"><input type="hidden" class="fileURL" value="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+v.fileId+'"><td class="lecture-tds">【<span class="fileLineNum">'+i+'</span>】</td><td class="fileName"><input type="hidden" class="file-span-id" value="'+v.fileId+'" >'+v.fileName+'</td><td style="display:none;" class="lecture-tds"><img class="ioc-img" src="../../resources/images/open/yulan.png" /></td><td style="width: 40px; display:none;">预览</td><td class="lecture-tds" style="text-align:center;width:70px"><span style="cursor: pointer;" class="down-file"><img class="ioc-img" src="../../resources/images/open/xiazai2.png" />下载</span></td></tr>'}else if(fileType==2){var num=$(".depute-lecture tbody tr").length+1;var lineTrHtml='<tr class="file-tr-border-style"><input type="hidden" class="fileURL" value="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+v.fileId+'"><td class="lecture-tds">【<span class="fileLineNum">'+num+'</span>】</td><td class="fileName"><input type="hidden" class="file-span-id" value="'+v.fileId+'" >'+v.fileName+'</td><td style="display:none;" class="lecture-tds"><img class="ioc-img" src="../../resources/images/open/yulan.png" /></td><td style="width: 40px; display:none;">预览</td><td class="lecture-tds" style="text-align:center;width:70px"><span style="cursor: pointer;" class="down-file"><img class="ioc-img" src="../../resources/images/open/xiazai2.png" />下载</span></td><td class="lecture-tds" style="text-align:center;width:170px"><span style="cursor: pointer;" class="entry-del-icon"><img class="ioc-img" src="../../resources/images/open/delete.png" />删除</span></td></tr>';$(".depute-lecture").append(lineTrHtml)}else if(fileType==4){var len=$('.ul-btn').children().length;var liHtml='<li class="img-li"><div class="img-div-box"><input type="hidden" class="imgId" value="'+v.fileId+'"><input type="hidden" class="imgName" value="'+v.fileName+'"><input type="hidden" class="fileURL" value="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+v.fileId+'"><img class="testjqthumb " src="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+v.fileId+'" alt="'+v.fileName+'"> </div><div class="operate-box"><div class="down-img" style="cursor: pointer;"><img class="ioc-img down-btn-img" src="../../resources/images/open/xiazai2.png" />下载</div><div class="dele-img" style="cursor: pointer;"><img class="dele-btn-img ioc-img" src="../../resources/images/open/delete.png" />删除</div></div></li>';$('.ul-btn').append(liHtml)}});$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},addImgInfo:function(){$yt_baseElement.showLoading();var fileId="";var fileName="";var fileLists=[];$(".add-depute-lecture-tb tbody tr").each(function(i,n){fileId=$(n).find('.file-span-id').val();fileName=$(n).find('.fileName').text();var fileList={fileId:fileId,fileName:fileName,types:2,fileType:2};fileLists.push(fileList)});var pkId=$('#pkId').val();var imgId="";var imgName="";$(".content-div-box .ul-btn li").each(function(i,n){imgId=$(n).find('.imgId').val();imgName=$(n).find('.imgName').val();var imgList={fileId:imgId,fileName:imgName,types:1,fileType:4};fileLists.push(imgList)});var fileListJson=JSON.stringify(fileLists);$.ajax({type:"post",url:$yt_option.base_path+"class/openHonors/addHonorsLecture",data:{pkId:pkId,fileList:fileListJson},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$(".yt-edit-alert,#heard-nav-bak").hide()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("归档失败");$(".yt-edit-alert,#heard-nav-bak").hide()})}window.location.href="lectureList.html"}})}};$(function(){projectList.init()});