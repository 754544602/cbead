var trainingProgramsList={init:function(){$(".yt-select").niceSelect();$(".chose-year").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy",callback:function(){trainingProgramsList.getTrainingProgramsList();trainingProgramsList.getAnnualTarget()}});var judgeList=2;$(".addList").on('click',function(){window.location.href=$yt_option.base_path+"website/view/project/addProjectList.html?judgeList=2"});$(".updateList").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要修改的数据");return false}var projectType=$("tr.yt-table-active").find(".hid-project-type").val();window.location.href=$yt_option.base_path+"website/view/project/addProjectList.html?pkId="+$('.yt-table-active .pkId').val()+"&judgeList=2&projectType="+projectType});$(".train-tbody").on('click',".real-name-inf",function(){var projectState=$(this).parents('tr').find(".project-state-step").val();window.location.href=$yt_option.base_path+"website/view/project/projectDetails.html?pkId="+$('.yt-table-active .pkId').val()+"&projectCode="+$('.yt-table-active .project-code-list').text()+"&judgeList=2&projectState="+projectState});$(".set-principal-btn").off().on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}var num=Number($('tr.none-tr').index());for(let i=3;i<num;i+=1){$('.none-tr').parents('tbody').find('tr').eq(3).remove()}$('.none-tr').parents('tbody').find('tr').eq(2).find('select').val('');var name=$(".yt-table-active").find('.real-name-inf').text();var projectType=$(".yt-table-active").find('.projectType').text();var principalInf=$(".yt-table-active .project-head-text").text();var principalArr=principalInf.split("、");$('.project-name').text(name);$('.project-type').text(projectType);var selectVal="";$.each(principalArr,function(i,n){if(i==0){var userNmae=$('select.project-director:eq(0) option[realName="'+n+'"]').val();$('select.project-director:eq(0)').setSelectVal(userNmae);$(".set-principal-alert").find("select.project-director").eq(0).hide()}else{$(".none-tr").before('<tr><td align="right"></td><td><div class="set-principal-alert-select"><select class="yt-select project-director types" data-val="" style="width: 201px;" ><option value="">请选择</option></select></div></td><td width="100px" style="padding-left: 10px;color: lightskyblue;cursor: pointer;"><span class="add-project-director">新增</span></td></tr>');$('.none-tr').prev().prev().find('.add-project-director').text('删除');$(".none-tr").prev().prev().find('.add-project-director').attr('class','delete-project-director');$('.delete-project-director').off().click(function(){if($(this).parents('tr').find('.project-head')[0]==undefined){$(this).parents('tr').remove()}else{$(this).parents('tr').next().find('td').eq(0).text($(this).parents('tr').find('.project-head').text());$(this).parents('tr').next().find('td').eq(0).addClass('project-head');$(this).parents('tr').remove()}});$.each(trainingProgramsList.getTreeAllPersonnel(),function(j,m){selectVal="";if(m.type==3){if(n==m.text){selectVal='selected="selected"'}$(".none-tr").prev().find(".project-director").append('<option '+selectVal+' value="'+m.textName+'" types="2" realName="'+m.text+'" >'+m.text+'</option>')}});$(".none-tr").prev().find(".project-director").niceSelect()}});trainingProgramsList.setPrincipal();$(".set-principal-alert").on('click','.add-project-director',function(){$(".none-tr").before('<tr><td align="right"></td><td><div class="set-principal-alert-select"><select class="yt-select project-director types" data-val="" style="width: 201px;" ><option value="">请选择</option></select></div></td><td width="100px" style="padding-left: 10px;color: lightskyblue;cursor: pointer;"><span class="add-project-director">新增</span></td></tr>');$(".none-tr").prev().prev().find('.add-project-director').text('删除');$(".none-tr").prev().prev().find('.add-project-director').attr('class','delete-project-director');$('.delete-project-director').off().click(function(){if($(this).parents('tr').find('.project-head')[0]==undefined){$(this).parents('tr').remove()}else{$(this).parents('tr').next().find('td').eq(0).text($(this).parents('tr').find('.project-head').text());$(this).parents('tr').next().find('td').eq(0).addClass('project-head');$(this).parents('tr').remove()}});var treeAllPersonal=trainingProgramsList.getTreeAllPersonnel();if(treeAllPersonal!=null){$.each(treeAllPersonal,function(i,n){if(n.type==3){$(".project-director").append('<option value="'+n.textName+'" types="2" realName="'+n.text+'" >'+n.text+'</option>')}})}$(".project-director").niceSelect()});$(".set-principal-alert").on('click','.add-teacher-head',function(){$(this).text("");$(".project-assistant").parent().parent().parent().before('<tr><td align="right"></td><td><div class="set-principal-alert-select"><select class="yt-select teacher-head types" data-val="" style="width: 201px;" ><option value="">请选择</option></select></div></td><td width="100px" style="padding-left: 10px;color: lightskyblue;cursor: pointer;"><span class="add-teacher-head">新增</span></td></tr>');$(".project-assistant").parent().parent().parent().prev().prev().find('.add-teacher-head').text('删除');$(".project-assistant").parent().parent().parent().prev().prev().find('.add-teacher-head').attr('class','delete-teacher-director');$('.delete-teacher-director').off().click(function(){if($(this).parents('tr').find('.project-head')[0]==undefined){$(this).parents('tr').remove()}else{$(this).parents('tr').next().find('td').eq(0).text($(this).parents('tr').find('.project-head').text());$(this).parents('tr').next().find('td').eq(0).addClass('project-head');$(this).parents('tr').remove()}});var treeAllPersonal=trainingProgramsList.getTreeAllPersonnel();if(treeAllPersonal!=null){$.each(treeAllPersonal,function(i,n){if(n.type==3){$(".teacher-head").append('<option value="'+n.textName+'" types=3 >'+n.text+'</option>')}})}$(".teacher-head").niceSelect()});$(".set-principal-alert .yt-model-sure-btn").off().on('click',function(){trainingProgramsList.setHeadAlert()})});trainingProgramsList.getTrainingProgramsList();trainingProgramsList.getAnnualTarget();$(".amend-annual-target").click(function(){$(this).hide();$(".annual-target-span").hide();$(".annual-target-inf").show();$(".save-annual-target").show();$(".save-annual-target").click(function(){trainingProgramsList.saveAnnualTarget();$(this).hide();$(".amend-annual-target").show();$(".annual-target-span").show();$(".annual-target-inf").hide();trainingProgramsList.getAnnualTarget()})});$('.search-btn').click(function(){trainingProgramsList.getTrainingProgramsList()});var treeAllPersonal=trainingProgramsList.getTreeAllPersonnel();if(treeAllPersonal!=null){$.each(treeAllPersonal,function(i,n){if(n.type==3){$(".project-director").append('<option value="'+n.textName+'" types=2 realName="'+n.text+'">'+n.text+'</option>');$(".teacher-head").append('<option value="'+n.textName+'" types=3 >'+n.text+'</option>');$(".project-assistant").append('<option value="'+n.textName+'" types=4 >'+n.text+'</option>')}})}$(".project-director,.teacher-head,.project-assistant").niceSelect()},getTreeAllPersonnel:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsers",data:{},async:false,success:function(data){list=data.data||[]}});return list},getTrainingProgramsList:function(){$yt_baseElement.showLoading();var selectParam=$(".selectParam").val();var years=$(".chose-year").val();$('.train-page').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"project/lookForAllByTrainClass",type:"post",data:{selectParam:selectParam,years:years},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.list-table .train-tbody');var htmlTr='';var projectType="";if(data.data.rows.length>0){$(htmlTbody).empty();$.each(data.data.rows,function(i,v){if(v.projectType==1){projectType="计划"}else if(v.projectType==2){projectType="委托"}else if(v.projectType==3){projectType="选学"}else if(v.projectType==4){projectType="调训"}htmlTr='<tr><td class="project-code-list"><input type="hidden" value="'+v.pkId+'" class="pkId">'+v.projectCode+'</td><td style="text-align: left;"><a href="#" class="real-name-inf" style=" color:#3c4687">'+v.projectName+'</a></td><td class="projectType"><input type="hidden" value="'+v.projectType+'" class="hid-project-type">'+projectType+'</td><td>'+v.startDate+'</td><td style="text-align: right;">'+v.trainDateCount+'</td><td style="text-align: left;">'+v.projectSell+'</td><td style="text-align: left;" class="project-head-text">'+v.projectHead+'</td><td style="text-align: right;">'+v.traineeCount+'</td><td><input type="hidden" value="'+v.projectStates+'" class="project-state-step">'+(v.projectStates==4?"已立项":(v.projectStates==5?"培训中":(v.projectStates==6?"未结项":"已结项")))+'</td></tr>';$(".train-page").show();htmlTbody.append($(htmlTr).data("legalData",v))})}else{$(".train-page").hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading();$yt_alert_Model.prompt("查询失败")}},isSelPageNum:true })},setHeadAlert:function(){$yt_baseElement.showLoading();var projectCode=$('.yt-table-active').data("legalData").projectCode;var userList="";var userListArr=[];var array=[];$(".set-principal-alert .set-principal-alert-select").each(function(i,n){types=$(n).find("select.types option:selected").attr("types");typesData=$(n).find("select.types option:selected").val();var arrUserList={types:types,typesData:typesData};userListArr.push(arrUserList)});var userList=JSON.stringify(userListArr);$.ajax({type:"post",url:$yt_option.base_path+"project/updateProjectPrincipal",data:{projectCode:projectCode,userList:userList},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading();$yt_alert_Model.prompt("操作成功");trainingProgramsList.getTrainingProgramsList();$('.train-page').pageInfo("refresh");$(".set-principal-alert").hide()}else{$yt_baseElement.hideLoading();$yt_alert_Model.prompt("操作失败");$('.train-page').pageInfo("refresh");$(".set-principal-alert").hide()}}})},setPrincipal:function(){$(".set-principal-alert").show();$yt_alert_Model.getDivPosition($(".set-principal-alert"));$yt_alert_Model.setFiexBoxHeight($(".cont-edit-test"));$yt_model_drag.modelDragEvent($(".set-principal-alert .yt-edit-alert-title"));$('.set-principal-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".set-principal-alert").hide();$("#pop-modle-alert").hide()})},getAnnualTarget:function(){var yearData=$(".chose-year").val();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTrainPlanByTear",data:{yearData:yearData},success:function(data){if(data.flag==0){$(".annual-target").setDatas(data.data);$(".annual-target-span").text(data.data.trainCount)}else{$yt_alert_Model.prompt("本年度班次目标操作失败")}}})},saveAnnualTarget:function(){var yearData=$(".chose-year").val();var trainCount=$(".annual-target-inf").val();$.ajax({type:"post",async:false,url:$yt_option.base_path+"class/trainee/updateTrainPlanByTear",data:{yearData:yearData,trainCount:trainCount},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("本年度班次目标保存成功")}else{$yt_alert_Model.prompt("本年度班次目标保存失败")}}})}};$(function(){trainingProgramsList.init()});