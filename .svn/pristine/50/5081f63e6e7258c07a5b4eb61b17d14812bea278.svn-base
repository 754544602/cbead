(function($,window){var serveFunds={saveData:{},beforeCostList:[],addressList:"",selUsersName:"",selUsersCode:"",usersInfoList:"",usersInfoJson:"",costType:"",riskExcMark:"../../../../../resources-sasac/images/common/war-red.png",riskWarImg:"../../../../../resources-sasac/images/common/risk-war.png",riskViaImg:"../../../../../resources-sasac/images/common/risk-via.png",parCode:'',init:function(){$("#payeeBankAlert").hide();$("#offAccountsAlert").hide();$("#bankNameAlert").hide();$("#offOpenBankAlert").hide();$(".paid-amount-input").hide();var ts=this;var pid=$yt_common.GetQueryString('appId');if(pid){ts.getExpenditureAppInfoByAppId(pid)}else{ts.getCostTypeList();ts.setBudgetItme();ts.showTrainFun();$("#advanceApplicationTd").show();$("#advanceApplicationTd label").html('<span class="not-null">*</span>预算项目：');$(".prior-approval").attr('validform','{isNull:true,msg:\'请选择预算项目\',changeFlag:true}');$("#budgetProjectTd").hide()}ts.start();ts.events();ts.uploadFile();sysCommon.getLoginUserInfo();serveFunds.parCode=$yt_common.user_info.posiCode;sysCommon.getApproveFlowData("SZ_EXPENDITURE_APP",'','{posCode:"'+serveFunds.parCode+'"}');$('#applicantUser').val($yt_common.user_info.userName);ts.getDictInfoByTypeCode();ts.getBusiTripUsersList('');ts.getArrearsAmount();ts.getAllPaymentReceivablesUnitList($("#companyPram").val());$("#userRadio").val($yt_common.user_info.userName);$(".pe-rank").text($yt_common.user_info.positionName==""?"--":$yt_common.user_info.positionName);$(".user-radio-label").change(function(){var userCode=$(this).find("input").val();$('#payeeName option[value="'+userCode+'"]').prop("selected","selected");serveFunds.setPayeeNameSelect(userCode);var jobLevelName=$('#payeeName option[value="'+userCode+'"]').attr("jobLevelName");var deptName=$('#payeeName option[value="'+userCode+'"]').attr("deptName");$(".pe-department").text(deptName);$(".display-rank,.dis-r").show();$(".pe-rank").text($("#jobName").text());$("input.where-company").removeAttr("validform");if(userCode==$("#userRadio").val()){ts.getPaymentReceivablesPersonalByUserCode(userCode,'')}setTimeout(function(){$("label.user-radio-label").hide().removeClass("check");$("label.user-radio-label input").prop("checked",false)},200)});$(".budget-item-one").change(function(){var codeValue=$('.budget-item-one option:selected').val();if(codeValue=='402'){$("#budgetaryBalance").hide()}else{$("#budgetaryBalance").show()}})},start:function(){$yt_baseElement.numberInput($(".yt-numberInput-box"));$('select:not(.busi-addres-sel)').niceSelect()},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},rmoney:function(str){return $yt_baseElement.rmoney(str||'0')},getAllPaymentReceivablesUnitList:function(keyword){$.ajax({type:"post",url:'sz/expenditureApp/getAllPaymentReceivablesUnit',async:true,data:{unitName:keyword},success:function(data){serveFunds.payeeCompanyList=data.data.paymentReceivablesUnitList}})},getPaymentReceivablesPersonalByUserCode:function(userCode,username){$.ajax({type:"post",url:"sz/loanApp/getPaymentReceivablesPersonalByUserCode",async:true,data:{userCode:userCode,username:username},success:function(data){if(data.data!=null){$("#idCarkno").val(data.data.idCarkno);$("#phoneNum").val(data.data.phoneNum);$("#personalUnit").val(data.data.personalUnit)}else{$("#bankName").val('');$("#payeeBank").val('');$("#offOpenBank").val('');$("#offAccounts").val('');$("#idCarkno").val('');$("#phoneNum").val('');$("#personalUnit").val('')}}})},getChoiceLoanList:function(code){var userCode=$('#payeeName option:selected').val();if(userCode==''||userCode==undefined||userCode==null||userCode=='external'){userCode=$yt_common.user_info.userName}$.ajax({type:"post",url:"sz/loanApp/getLoanAppInfoListToPageByParams",async:true,data:{queryParams:'',userCode:userCode,pageIndex:1,pageNum:99999},success:function(data){var list=data.data.rows||[];var opts='<option value="">请选择</option>';$.each(list,function(i,n){opts+='<option '+(code==n.loanAppId?'selected="selected"':'')+' arrearsAmount="'+n.arrearsAmount+'" value="'+n.loanAppId+'">'+n.loanAppNum+'</option>';if(code==n.loanAppId){$('.arrears-money').text(serveFunds.fmMoney(n.loanAmount))}});$('.choice-loan').html(opts).niceSelect()}})},getArrearsAmount:function(){var me=this;$('#personalTotal').on('blur',function(){var form=$(this).parents('.personal');serveFunds.calculatePaymentAlertPerson(form)});$(".choice-loan").change(function(){var code=$('.receipt-alert ul li.tab-check').attr('code');var form=$(this).parents('.'+code);serveFunds.calculatePaymentAlertPerson(form)});$("#witeOffPersonal").change(function(){var thischange=$("#witeOffPersonal").find("option:selected").val();if(thischange=='LOAN_REVERSE'){$(".display-loan").show()}else{$(".display-loan").hide();$('.arrears-money,.the-reverse-money').text('0.00');$('.the-reverse-money').text('0.00');$('.personal-writeoff-money').text($('#personalTotal').val())}me.getChoiceLoanList()});$("#witeOffCompany").change(function(){var thischange=$("#witeOffCompany").find("option:selected").val();if(thischange=='BORROWING_ORDER_REVERSAL'){$(".display-loan").show()}else{$(".display-loan").hide();}me.getChoiceLoanList()});$("#witeOffOther").change(function(){var thischange=$("#witeOffOther").find("option:selected").val();if(thischange=='BORROWING_ORDER_REVERSAL'){$(".display-loan").show()}else{$(".display-loan").hide();}me.getChoiceLoanList()});$('#companyMoney').blur(function(){if($('#witeOffCompany option:selected').val()=='BORROWING_ORDER_REVERSAL'){var form=$('.company');var total=$yt_baseElement.rmoney(form.find('.receivable-money').val());var arrearsAmount=$yt_baseElement.rmoney(form.find(".arrears-money").text()||0);var outWriteAmount=total<=arrearsAmount?total:arrearsAmount;form.find('.the-reverse-money').text($yt_baseElement.fmMoney(outWriteAmount));var companyMoney=$yt_baseElement.rmoney($('#companyMoney').val())-$yt_baseElement.rmoney(form.find('.the-reverse-money').text());$('.actual-money').text($yt_baseElement.fmMoney(companyMoney))}else{var companyMoneyNo=$('#companyMoney').val();$('.actual-money').text(companyMoneyNo)}});$('#otherAllMoney').blur(function(){if($('#witeOffOther option:selected').val()=='BORROWING_ORDER_REVERSAL'){var form=$('.other');var total=$yt_baseElement.rmoney(form.find('.receivable-money').val());var arrearsAmount=$yt_baseElement.rmoney(form.find(".arrears-money").text()||0);var outWriteAmount=total<=arrearsAmount?total:arrearsAmount;form.find('.the-reverse-money').text($yt_baseElement.fmMoney(outWriteAmount));var companyMoney=$yt_baseElement.rmoney($('#otherAllMoney').val())-$yt_baseElement.rmoney(form.find('.the-reverse-money').text());$('.actual-money').text($yt_baseElement.fmMoney(companyMoney))}else{var companyMoneyNo=$('#otherAllMoney').val();$('.actual-money').text(companyMoneyNo)}});$("#payeeName").change(function(){var jobLevelName=$("#payeeName").find("option:selected").attr("jobLevelName");var deptName=$("#payeeName").find("option:selected").attr("deptName");$(".pe-department").text(deptName);$(".pe-rank").text(jobLevelName);$("#payeeName").next().find(".current").text($("#payeeName").find("option:selected").attr("username"));$("label.user-radio-label").hide().removeClass("check");$("#userRadio").prop("checked",false);var userCode=$('#payeeName option:selected').val();var isChange=$("#payeeName").find("option:selected").val();var username=$('#payeeName').next().find(".search-current").val();if(isChange=='external'||isChange=='noUser'){$(".display-rank").show();$(".pe-department").text("外部人员");$(".dis-r").hide();$(".where-company").show();$("input.where-company").attr("validform","{isNull:true,blurFlag:true,msg:'请输入收款人所在单位'}")}else{if(isChange==""){$(".display-rank").hide()}else{$(".display-rank").show();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").show()}}serveFunds.getChoiceLoanList();serveFunds.getPaymentReceivablesPersonalByUserCode(userCode,username)});$('table.payee-personal').on('click','.to-data',function(){var tr=$(this).parents('tr');$('#perPayeeName').text(tr.attr('payeename')||'--');$('#perPersonalTotal').text(tr.attr('personalTotal')||'0.00');var choiceLoan=tr.attr('choiceLoan');if(choiceLoan&&choiceLoan!='请选择'){$('.personal-payment .display-loan').show();$('#perChoiceLoan').text(tr.attr('choiceLoan')||'--');$('.per-arrears-money').text(tr.attr('arrearsmoney')||'0.00');$('.per-reverse-money').text(tr.attr('thereversemoney')||'0.00')}else{$('.personal-payment .display-loan').hide();$('#perChoiceLoan').text('');$('.per-arrears-money').text('0.00');$('.per-reverse-money').text('0.00')}$('#perWiteOffPersonal').text(tr.find('td').eq(2).text()||'无');if(tr.attr('witeOffPersonal')){$('.personal-payment .display-loan').show()}else{$('.personal-payment .display-loan').hide()}$('.per-writeoff-money').text(tr.attr('personalWriteoff')||'0.00');$('#perCash').text(tr.attr('cash')||'0.00');$('#perOfficialCard').text(tr.attr('officialCard')||'0.00');$('#perTransferAccounts').text(tr.attr('transferAccounts')||'0.00');$('#perIdCarkno').text(tr.attr('idCarkno')||'--');$('#perPayeeBank').text(tr.attr('payeeBank')||'--');$('#perBankName').text(tr.attr('bankName')||'--');$('#perPhoneNum').text(tr.attr('phoneNum')||'--');$('#perPerank').text(tr.attr('personalUnit')||'--');$('#perOffOpenBank').text(tr.attr('offOpenBank')||'--');$('#perOffAccounts').text(tr.attr('offAccounts')||'--');var payeeRadio=tr.attr('payeeRadio');$('#payeeRadio').text(payeeRadio==1?'有':'无');$('#perSpecial').text(tr.attr('personalSpecial'));$('#personalPayment').show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#personalPayment'));$('#pop-modle-alert').show();$('#personalPayment').show()});$('#personalPayment .model-bottom-btn .yt-cancel-btn').on('click',function(){$yt_baseElement.hideMongoliaLayer();$('#pop-modle-alert').hide();$('#personalPayment').hide();$('#perPayeeName').text('--');$('#perPersonalTotal').text('0.00');$('.personal-payment .display-loan').hide();$('#perChoiceLoan').text('--');$('.per-arrears-money').text('0.00');$('.per-arrears-money').text('0.00');$('#perWiteOffPersonal').text('--');$('.per-writeoff-money').text('0.00');$('#perCash').text('0.00');$('#perOfficialCard').text('0.00');$('#perTransferAccounts').text('0.00');$('#perIdCarkno').text('--');$('#perPayeeBank').text('--');$('#perBankName').text('--');$('#perPhoneNum').text('--');$('#payeeRadio').text('--');$('#perSpecial').text('')});$('.rece-msg').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();me.getTotleMoney()}})})},calculatePaymentAlertPerson:function(form){var total=$yt_baseElement.rmoney(form.find('.receivable-money').val());var arrearsAmount=form.find(".choice-loan").find("option:selected").attr("arrearsAmount")||0;form.find(".arrears-money").text($yt_baseElement.fmMoney(arrearsAmount));var outWriteAmount=total<=arrearsAmount?total:arrearsAmount;form.find('.the-reverse-money').text($yt_baseElement.fmMoney(outWriteAmount));if(form.find('.wite-select option:selected').val()=='BORROWING_ORDER_REVERSAL'){var companyMoney=$yt_baseElement.rmoney(form.find('.receivable-money').val())-$yt_baseElement.rmoney(form.find('.the-reverse-money').text());form.find('.actual-money').text($yt_baseElement.fmMoney(companyMoney||0))}else{var companyMoneyNo=form.find('.receivable-money').val();form.find('.actual-money').text($yt_baseElement.fmMoney(companyMoneyNo||0))}var personalTotal=$yt_baseElement.rmoney(form.find('#personalTotal').val()||'0');var writeTotal=personalTotal-outWriteAmount;writeTotal=writeTotal>0?writeTotal:0;form.find('.personal-writeoff-money').text(serveFunds.fmMoney(writeTotal))},events:function(){var me=this;$('.file-box').on('click','.del-file',function(){var ithis=$(this);var parent=ithis.parent();$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){parent.remove()}})});$("#travelRadioInput").off().on("click",function(event){if($(this).parent().hasClass("check")){$(this).val(0).setRadioState("uncheck");$("#budgetProjectTd").hide()}else{$(this).val(1).setRadioState("check");$("#budgetProjectTd").show()}});$(".receipt-alert label.yt-radio").off().on().change(function(){var checkVal=$(this).parents('td').find(".agree-check").find('input:checked').val();if(checkVal==1){$(this).parent().parent().parent().parent().find(".paid-amount-input").show();$(this).parent().parent().parent().parent().find(".paid-amount-input").attr('validform','{isNull:true,msg:\'请输入已支付金额\',changeFlag:true}');$(this).parent().parent().parent().parent().find(".paid-amount-span").hide();$(this).parent().parent().parent().parent().find(".not-null-hidden").show()}else{$(this).parent().parent().parent().parent().find(".paid-amount-input").hide();$(this).parent().parent().parent().parent().find(".paid-amount-input").removeAttr('validform');$(this).parent().parent().parent().parent().find(".not-null-hidden").hide();$(this).parent().parent().parent().parent().find(".valid-font").hide();$(this).parent().parent().parent().parent().find(".paid-amount-span").show()}});$("#bankName,#payeeBank,#offAccounts,#offOpenBank").focus(function(){var hiddenCode=$(this).attr('hidde-code');me.bandCardQuery(hiddenCode)});$('#test').bind('click',function(e){stopPropagation(e)});$('#cash,#officialCard,#transferAccounts').on('focus',function(){if($(this).val()=='0.00'){$(this).val('')}});$('.docu-style-box').on('change','.docu-style',function(){$(".prj-name-tr").hide();var iput=$('.docu-style:checked');var code=iput.val();var fun=iput.attr('fun');if(code){me[fun]();$("#budget-item-one").setSelectVal("");$(".budget-item-two,.budget-item-three").hide();$("#deptBudgetBalanceAmount,#budgetBalanceAmount").text("--");$("#deptBudgetBalanceAmountHidden").val(0);if($('.docu-style:checked').val()=="TRAVEL_APPLY"){$("#advanceApplicationTd").show();$("#budgetProjectTd").hide()}if($('.docu-style:checked').val()=="TRAIN_APPLY"){$("#advanceApplicationTd").show();$("#advanceApplicationTd label").html('<span class="not-null">*</span>预算项目：');$(".prior-approval").attr('validform','{isNull:true,msg:\'请选择预算项目\',changeFlag:true}');$("#budgetProjectTd").hide()}else{$("#advanceApplicationTd label").html('<span class="not-null">*</span>事前申请单：');if($(".prior-approval").is(":visible")){$(".prior-approval").attr('validform','{isNull:true,msg:\'请选择事前申请单\',changeFlag:true}')}else{$(".prior-approval").removeAttr('validform')}}$('.prior-approval').val('');$('#advanceAppBalance').text('0.00元');$('.advance-relevance').hide();$('#advanceAppId').val('');$('.index-main-div .export-but').hide();$('.clear-prior-approval').hide();$('#reimAppName').val('');serveFunds.setBudgetItme();$('.prj-name-tr').hide();$('#prjName').val('')}else{$('.qtip-text-div').show();$('.mod-div').hide();$('.else-div').hide();$('.approve-div').hide()}});$('.special-type').change(function(){var val=$(this).val();if(val=='2'){$('.special-yes').hide();$('.special-no').show();var name=$('select.expense-type option:selected').text();$('.special-label').text(name+'余额：')}else{$('.special-yes').show();$('.special-no').hide()}});$('.clear-prior-approval').on('click',function(){$yt_alert_Model.alertOne({alertMsg:'变更事前申请单后，从事前申请单导入的数据将清空是否确定变更事前申请单？',confirmFunction:function(){$('.prior-approval').val('');$('#advanceAppBalance').text('0.00元');$('.advance-relevance').hide();$('#advanceAppId').val('');$('.index-main-div .export-but').hide();me.clearPriorApproval();$('.clear-prior-approval').hide();$('#reimAppName').val('');$('.docu-style-box input[value="NORMAL_APPLY"]').setRadioState('check');var iput=$('.docu-style:checked');var code=iput.val();var fun=iput.attr('fun');if(code){me[fun]()}serveFunds.setBudgetItme();$('.prj-name-tr').hide();$('#prjName').val('')}})});$('.money-input').on('focus',function(){var ts=$(this);if(ts.val()!=""){ts.val($yt_baseElement.rmoney(ts.val()))}});$('.money-input').on('blur',function(){var ts=$(this);if(ts.val()!=''){ts.val($yt_baseElement.fmMoney(ts.val()))}});$('.money-input').on('keyup',function(){var ts=$(this);if(ts.val()!=''){ts.val(ts.val().replace(/[^\d.]/g,''))}});$('.amount-table .money-input').on('blur',function(){var body=$('.amount-table');var official=Number(me.rmoney(body.find('.official').val()||'0'));var cash=Number(me.rmoney(body.find('.cash').val()||'0'));var cheque=Number(me.rmoney(body.find('.cheque').val()||'0'));var transfer=Number(me.rmoney(body.find('.transfer').val()||'0'));var total=official+cash+cheque+transfer;var replaceMoney=me.rmoney($('#replaceMoney').text());if(replaceMoney>0&&total>replaceMoney){$(this).focus();$yt_alert_Model.prompt('填写金额不能大于补领总金额')}else{var rtotal=me.fmMoney(total);body.find('.total').text(rtotal).attr('num',total)}});$("#reimAppName").on("change",function(){var value=$(this).val();if(value){$("#prjName").val(value);$("#regionDesignation").val(value)}});me.paymentListEvent();me.priorApprovalEvent();me.borrowListEvent();me.specialListEvent();me.generalListEvent();me.exportDataEvent();me.updataReceivables();me.updataPersonal();me.updataOther();$(".receipt-alert .cost-type-tab li").click(function(){serveFunds.clearAlert($(".model-content"));$("label.user-radio-label").show();$(".display-rank").hide();$('#cash,#officialCard,#transferAccounts').val('0.00');$('.arrears-money').text('0.00');$('.the-reverse-money').text('0.00');$('.pe-department,.pe-rank').text('');$('.receipt-alert .display-loan').hide();serveFunds.setPayeeNameSelect();$(this).addClass("tab-check").siblings().removeClass("tab-check");var tabIndex=$(this).index();$(".receipt-alert .tab-info").hide().eq(tabIndex).show();$yt_alert_Model.getDivPosition($('#cost-apply-model'))});serveFunds.alertClearReceivables();sysCommon.costDetailModelTabEvent();$('.yt-table tbody').on('click','tr',function(){var ts=$(this);var trs=ts.siblings();trs.removeClass('yt-table-active');ts.addClass('yt-table-active')});$("#cancelBtn").off().on('click',function(){window.history.back(-1)});$("#companyName").on("keyup",function(){$("#companyNameList ul").empty();$("#openBank").val('');$("#accountNumber").val('');var companyName=$("#companyName");var text='';var html='';text=companyName.val();var arr=serveFunds.payeeCompanyList;var map={},dest=[];for(var i=0;i<arr.length;i+=1){var ai=arr[i];if(!map[ai.unitName]){dest.push({unitName:ai.unitName,openBank:ai.openBank,accounts:ai.accounts});map[ai.unitName]=ai}else{for(var j=0;j<dest.length;j+=1){var dj=dest[j];if(dj.unitName==ai.unitName){break}}}};$.each(dest,function(i,n){if(n.unitName.indexOf(text)!=-1){html+='<li unitName="'+n.unitName+'" openBank="'+n.openBank+'" accounts="'+n.accounts+'">'+n.unitName+'</li>'}});$("#companyNameList ul").append(html);$("#companyNameList").show();$("#companyNameList ul li").off().on("click",function(){var companyName=$(this).text();var openBank=$(this).attr('openBank');var accounts=$(this).attr('accounts');$("#companyName").val(companyName).attr({'openBank':openBank,'accounts':accounts});$("#openBank").val(openBank);$("#accountNumber").val(accounts);$("#companyNameList").hide()})});me.setSubmitEvent();me.setSaveEvent()},setSubmitEvent:function(){var me=this;$('#submitPayment').on('click',function(){var thisBtn=$(this);var tableVerigfy=me.verifySubmitTableLenght();var code=$('.docu-style:checked').val();var data=me.getSubData();var validForm=$yt_valid.validForm($('.base-info-form-modle'));if(code=='SPECIAL_DEDUCTION'){validForm=$yt_valid.validForm($('.base-info-form-modle'))&&tableVerigfy}if(code!='LABOUR_UNION_FUNDS'&&code!='PARTY_BUILDING_FUNDS'&&code!='CURRENT_ACCOUNT'){var budgetMoney="";var validMsg="";if(validForm){if(code=='NORMAL_APPLY'||code=='MEDICAL_EXPENSES'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'||code=='CURRENT_ACCOUNT'){var replaceMoney=function(){return(serveFunds.rmoney($('table.payee-unit .payee-unit-total .payee-unit-money').text())+serveFunds.rmoney($('table.payee-personal .payee-personal-total .payee-personal-money').text())+serveFunds.rmoney($('table.payee-other .payee-other-total .payee-other-total-money').text()))+serveFunds.rmoney($('#taxAmount').text())};var total=serveFunds.rmoney($('#applyTotalMoney').text());var code=$('.docu-style:checked').val();if(serveFunds.fmMoney(total)==serveFunds.fmMoney(replaceMoney())){var data=me.getSubData();me.submitExpenditureAppInfo(data,thisBtn);}else{$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:"所有收款方收款金额合计必须等于申请支出总金额",cancelFunction:function(){}})}}else if(code=='SOCIAL_SECURITY_FEE'||code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'){me.submitExpenditureAppInfo(data,thisBtn);}else{var replaceMoney=function(){return(serveFunds.rmoney($('table.payee-unit .payee-unit-total .payee-unit-money').text())+serveFunds.rmoney($('table.payee-personal .payee-personal-total .payee-personal-money').text())+serveFunds.rmoney($('table.payee-other .payee-other-total .payee-other-total-money').text()))+serveFunds.rmoney($('#taxAmount').text())};var total='';var code=$('.docu-style:checked').val();if(code=='TRAIN_APPLY'){total=serveFunds.rmoney($('#applyTotalMoney').text());}else{total=serveFunds.rmoney($('#applyTotalMoney').text())}if(serveFunds.fmMoney(total)==serveFunds.fmMoney(replaceMoney())){var data=me.getSubData();if($('#advanceAppBalance').text()==""){var advan=undefined}else{var advan=serveFunds.rmoney($('#advanceAppBalance').text().replace('元',''))}var total=serveFunds.rmoney($('#applyTotalMoney').text());if(advan==undefined){me.submitExpenditureAppInfo(data,thisBtn)}else{if(total>advan){$yt_alert_Model.prompt('申请支出总金额不能大于事前申请单可用余额')}else{me.submitExpenditureAppInfo(data,thisBtn)}}}else{$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:"所有收款方收款金额合计必须等于申请支出总金额",cancelFunction:function(){}})}}}else{sysCommon.pageToScroll($("body .valid-font"))}}else{if(validForm){if(code=='SOCIAL_SECURITY_FEE'||code=='ACCRUED_TAX'||code=='CURRENT_ACCOUNT'||code=="MEETING_APPLY"||code=="BH_APPLY"||code=="TRAVEL_APPLY"||code=="TRAIN_APPLY"){var advan=serveFunds.rmoney($('#advanceAppBalance').text().replace('元',''));var total=serveFunds.rmoney($('#applyTotalMoney').text());if(total>advan){$yt_alert_Model.prompt('申请支出总金额不能大于事前申请单可用余额')}else{me.submitExpenditureAppInfo(data,thisBtn)}}else if(code=='SPECIAL_DEDUCTION'){me.submitExpenditureAppInfo(data,thisBtn)}else{var replaceMoney=function(){return(serveFunds.rmoney($('table.payee-unit .payee-unit-total .payee-unit-money').text())+serveFunds.rmoney($('table.payee-personal .payee-personal-total .payee-personal-money').text())+serveFunds.rmoney($('table.payee-other .payee-other-total .payee-other-total-money').text()))+serveFunds.rmoney($('#taxAmount').text())};var total='';var code=$('.docu-style:checked').val();if(code=='TRAIN_APPLY'){total=serveFunds.rmoney($('#applyTotalMoney').text());}else{total=serveFunds.rmoney($('#applyTotalMoney').text())}if(serveFunds.fmMoney(total)==serveFunds.fmMoney(replaceMoney())){var data=me.getSubData();var advan=serveFunds.rmoney($('#advanceAppBalance').text().replace('元',''));var total=serveFunds.rmoney($('#applyTotalMoney').text());if(total>advan){$yt_alert_Model.prompt('申请支出总金额不能大于事前申请单可用余额')}else{me.submitExpenditureAppInfo(data,thisBtn)}}else{$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:"所有收款方收款金额合计必须等于申请支出总金额",cancelFunction:function(){}})}}}else{sysCommon.pageToScroll($("body .valid-font"))}}})},setSaveEvent:function(){var me=this;$('#savePayment').on('click',function(){var thisBtn=$(this);thisBtn.off();var data=me.getSubData();me.submitExpenditureAppInfoToDrafts(data,thisBtn)})},bandCardQuery:function(hiddenCode){var userCode=$("#payeeName").val();var userName=$("#payeeName").next().find(".search-current").val();$.ajax({type:"post",url:$yt_option.base_path+"sz/expenditureApp/getBankNumber",data:{userCode:userCode,userName:userName,hiddenCode:hiddenCode},success:function(data){if(data.flag==0){if(data.data.hiddenCode==1){$("#bankNameAlert").show();$("#bankNameAlert").text(data.data.opeBank);$("#bankNameAlert").click(function(){$("#bankName").val(data.data.opeBank);$("#payeeBank").val(data.data.accounts);$(this).hide()});$("body").off("click").on("click",function(event){$yt_baseElement.eventStopPageaction();if(!$(event.target).hasClass("user-name")&&!$(event.target).hasClass("nice_select")){$("#bankNameAlert").hide()}})}if(data.data.hiddenCode==2){$("#payeeBankAlert").show();$("#payeeBankAlert").text(data.data.accounts);$("#payeeBankAlert").click(function(){$("#bankName").val(data.data.opeBank);$("#payeeBank").val(data.data.accounts);$(this).hide()});$("body").off("click").on("click",function(event){$yt_baseElement.eventStopPageaction();if(!$(event.target).hasClass("user-name")&&!$(event.target).hasClass("nice_select")){$("#payeeBankAlert").hide()}})}if(data.data.hiddenCode==3){$("#offOpenBankAlert").show();$("#offOpenBankAlert").text(data.data.offOpeBank);$("#offOpenBankAlert").on('click',function(){$("#offOpenBank").val(data.data.offOpeBank);$("#offAccounts").val(data.data.offAccounts);$(this).hide()});$("body").off("click").on("click",function(event){$yt_baseElement.eventStopPageaction();if(!$(event.target).hasClass("user-name")&&!$(event.target).hasClass("nice_select")){$("#offOpenBankAlert").hide()}})}if(data.data.hiddenCode==4){$("#offAccountsAlert").show();$("#offAccountsAlert").text(data.data.offAccounts);$("#offAccountsAlert").click(function(){$("#offOpenBank").val(data.data.offOpeBank);$("#offAccounts").val(data.data.offAccounts);$(this).hide()});$("body").off("click").on("click",function(event){$yt_baseElement.eventStopPageaction();if(!$(event.target).hasClass("user-name")&&!$(event.target).hasClass("nice_select")){$("#offAccountsAlert").hide()}})}}else{}}})},uploadFile:function(){$(".file-up-div").off().on('change','.cont-file',function(obj){var fileElementId=this.id;var ithisParent=$('#attIdStr');var url=$yt_option.base_path+"fileUpDownload/upload?ajax=1&modelCode=REIM_APP";var imgUlr='';$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:fileElementId,success:function(data,textStatus){if(data.flag==0){var attaElement=$('<div fId="'+data.data.pkId+'" class="li-div"><span>'+data.data.naming+'</span><span class="del-file">x</span></div>');ithisParent.append(attaElement)}else{$yt_alert_Model.prompt(data.message)}$('#attIdStr .file-pv img').showImg();$('#attIdStr').val("")},error:function(data,status,e){$yt_alert_Model.prompt(data.message)}})});},verifyCostTypeExport:function(){var costType=$('.docu-style-box .check input').val();var beforType=$('.prior-approval').attr('costType');return costType==beforType},exportDataEvent:function(){var me=this},paymentListEvent:function(){var me=this;$('#addProcuList').on('click',function(){me.showPaymentAlert();$('#paymentAddBtn').off().on('click',function(){me.appendPaymentList()})});$('#paymentList').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();me.getTotleMoney()}})});$('#paymentList').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var budgetProject=$('#budgetProject option[value="'+tr.attr('budgetcode')+'"]').attr('selected',true);var applyDate=$('#applyDate').val(tr.attr('applyDate'));var siteVal=$('#siteVal').val(tr.attr('siteVal'));var costBreakdown=$('#costBreakdown option[value="'+tr.attr('costcode')+'"]').attr('selected',true);var standardMoney=$('#standardMoney').val(tr.attr('standardMoney'));var budgetMoney=$('#budgetMoney').val(tr.attr('budgetMoney'));var accompanyNum=$('#accompanyNum').val(tr.attr('accompanyNum'));$('#budgetProject,#costBreakdown').niceSelect();me.showPaymentAlert();$('#paymentAddBtn').off().on('click',function(){me.appendPaymentList(tr)})});$('#paymentCanelBtn').on('click',function(){me.hidePaymentAlert();me.clearAlert($('#createDetali'))})},showPaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hidePaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.hideMongoliaLayer();alert.hide();$('#pop-modle-alert').hide()},appendPaymentList:function(tr){var me=this;var budgetProject=$('#budgetProject option:selected').text();var budgetCode=$('#budgetProject option:selected').val();var applyDate=$('#applyDate').val();var siteVal=$('#siteVal').val();var costBreakdown=$('#costBreakdown option:selected').text();var costCode=$('#costBreakdown option:selected').val();var standardMoney='';var stanMoney=$yt_baseElement.rmoney(standardMoney);var budgetMoney=$('#budgetMoney').val();var numMoney=$yt_baseElement.rmoney(budgetMoney);var accompanyNum=$('#accompanyNum').val();var html='<tr pkId="" budgetCode="'+budgetCode+'" costCode="'+costCode+'" budgetProject="'+budgetProject+'" applyDate="'+applyDate+'" siteVal="'+siteVal+'" costBreakdown="'+costBreakdown+'" standardMoney="'+standardMoney+'" budgetMoney="'+budgetMoney+'" accompanyNum="'+accompanyNum+'"><td><span class="">'+budgetProject+'</span></td><td><span class="act-date">'+applyDate+'</span></td><td><span class="place-name">'+siteVal+'</span></td><td><span>'+costBreakdown+'</span></td>'+'<td style="text-align: right;"><div class="money" money='+numMoney+'>'+budgetMoney+'</div></td><td><span class="people-num">'+accompanyNum+'</span></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(budgetProject&&applyDate&&siteVal&&costBreakdown&&budgetMoney&&accompanyNum){if(tr){tr.replaceWith(html);me.hidePaymentAlert()}else{$('#paymentList tbody .last').before(html);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}me.clearAlert($('#createDetali'));me.getTotleMoney()}else{$yt_alert_Model.prompt('请完整填写数据')}},getTotleMoney:function(){var unitCount=0;$('table.payee-unit tbody tr:not(.payee-unit-total)').each(function(){unitCount+=serveFunds.rmoney($(this).find('.unitTotal').text())});$('table.payee-unit .payee-unit-money').text(serveFunds.fmMoney(unitCount));var perCount=0;$('table.payee-personal tbody tr:not(.payee-personal-total)').each(function(){perCount+=serveFunds.rmoney($(this).find('.personalTotal').text())});$('table.payee-personal .payee-personal-money').text(serveFunds.fmMoney(perCount));var perCount=0;$('table.payee-other tbody tr:not(.payee-other-total)').each(function(){perCount+=serveFunds.rmoney($(this).find('.otherTotal').text())});$('table.payee-other .payee-other-total-money').text(serveFunds.fmMoney(perCount));},setReimFundMoney:function(){var total=0;var outstandingBalance=serveFunds.rmoney($('#outstandingBalance').text());var writeOffAmount=total>=outstandingBalance?outstandingBalance:total;$('#writeOffAmount,#outWriteAmount').text(serveFunds.fmMoney(writeOffAmount));var replaceMoney=total>=outstandingBalance?total-writeOffAmount:0;$('#replaceMoney').text(serveFunds.fmMoney(replaceMoney));$('#balanceMoney').text(serveFunds.fmMoney(total<outstandingBalance?outstandingBalance-total:'0'))},updatePaymentList:function(tr){},priorApprovalEvent:function(){var me=this;var inputFlag="";$('.prior-approval,.budget-project').click(function(){if($(this).hasClass("prior-approval")){var typeId="EXPENDITURE_APP";var urlName="";if($('.docu-style:checked').val()=="TRAIN_APPLY"){urlName="sz/advanceApp/getTrainAdvanceAppListToPageByParams"}else{urlName="sz/advanceApp/getAdvanceAppListToPageByParams"}var costType=$(".docu-style-box .check input").val();me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","prior-approval")}else if($(this).hasClass("budget-project")){var typeId="FINAL_APP";var urlName="sz/advanceApp/getProjectFinalAccountsListToPageByParams";var costType="TRAIN_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","budget-project")}else{$(".prior-alert").attr("advance-type","")}$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('.prior-alert'));$('#pop-modle-alert').show();$('.prior-alert').show();inputFlag=$(this)});$('.prior-common').click(function(){var advanceType=$(".prior-alert").attr("advance-type");if(advanceType=="budget-project"){$("#hiddenBudgetProject").val($(".yt-table-active .hidden-advanceAppId").val())}else{$("#advanceAppId").val($(".yt-table-active .hidden-advanceAppId").val())}var tr=$('.prior-approval-list .yt-table-active');var code=tr.attr('code');var name=tr.find('.sname').text();var id=tr.attr('pid');var types=tr.attr('type');var balance=tr.find('.balance').val();var thisVal=$(inputFlag).val();if(thisVal&&thisVal!=code&&$(inputFlag).hasClass("prior-approval")){$yt_alert_Model.alertOne({alertMsg:"变更事前申请单后，从事前申请单导入的数据将清空是否确定变更事前申请单？",confirmFunction:function(){if(code){me.clearPriorApproval();me.getAdvanceAppInfoDetailByAdvanceAppId(id);$(inputFlag).val(code).attr('costType',types).removeClass('valid-hint').nextAll().find('.valid-font').text('');$('#advanceAppBalance').text(balance?serveFunds.fmMoney(balance)+'元':'--');if(types=="TRAIN_APPLY"){$("#noContain").show()}else{$("#noContain").hide()}$('.advance-relevance').show();$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide();$('.clear-prior-approval').show();$('.index-main-div .export-but').show()}else{$yt_alert_Model.prompt('请选择一条数据')}}})}else{if(code&&$(inputFlag).hasClass("prior-approval")){me.clearPriorApproval();me.getAdvanceAppInfoDetailByAdvanceAppId(id);$(inputFlag).val(code).attr('costType',types).removeClass('valid-hint').nextAll().find('.valid-font').text('');$('#advanceAppBalance').text(balance?serveFunds.fmMoney(balance)+'元':'--');if(types=="TRAIN_APPLY"){$("#noContain").show()}else{$("#noContain").hide()}$('.advance-relevance').show();$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide();$('.clear-prior-approval').show();$('.index-main-div .export-but').show();$(".prior-approval").parent().find(".valid-font").text('')}else if($(inputFlag).hasClass("budget-project")){$(inputFlag).val(code).attr('costType',types).removeClass('valid-hint').nextAll().find('.valid-font').text('');$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()}else{$yt_alert_Model.prompt('请选择一条数据')}}});$('.prior-cancel,.prior-alert .closed-span').click(function(){$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide();$('.prior-approval-val').val('');});$('#personalPayment .closed-span').click(function(){$yt_baseElement.hideMongoliaLayer();$('#personalPayment').hide();$('#pop-modle-alert').hide();$('.prior-approval-val').val('');});$('.prior-approval-search').click(function(){if($(this).parent().parent().parent().hasClass("prior-approval")){var typeId="EXPENDITURE_APP";var urlName="";if($('.docu-style:checked').val()=="TRAIN_APPLY"){urlName="sz/advanceApp/getTrainAdvanceAppListToPageByParams"}else{urlName="sz/advanceApp/getAdvanceAppListToPageByParams"}var costType="TRAVEL_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","prior-approval")}else if($(this).parent().parent().parent().hasClass("budget-project")){var typeId="FINAL_APP";var urlName="sz/advanceApp/getProjectFinalAccountsListToPageByParams";var costType="TRAIN_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","budget-project")}else{$(".prior-alert").attr("advance-type","")}});$('.prior-approval-reset').click(function(){$('.prior-approval-val').val('');if($(this).parent().parent().parent().hasClass("prior-approval")){var typeId="EXPENDITURE_APP";var urlName="";if($('.docu-style:checked').val()=="TRAIN_APPLY"){urlName="sz/advanceApp/getTrainAdvanceAppListToPageByParams"}else{urlName="sz/advanceApp/getAdvanceAppListToPageByParams"}var costType="TRAVEL_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","prior-approval")}else if($(this).parent().parent().parent().hasClass("budget-project")){var typeId="FINAL_APP";var urlName="sz/advanceApp/getProjectFinalAccountsListToPageByParams";var costType="TRAIN_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","budget-project")}else{$(".prior-alert").attr("advance-type","")}})},advanceDataFilling:function(){var me=this;var d=serveFunds.beforeCostList;if($('.prior-approval').val()){var pid=$yt_common.GetQueryString('appId');if(pid==null){$('#reimAppName').val(d.advanceAppName)}$('.docu-style-box input[value="'+d.advanceCostType+'"]').setRadioState('check');var specialCodeArr=d.specialCode.split('-');var specialNameArr=d.specialName.split('-');serveFunds.setBudgetItme(specialCodeArr);if(d.prjName&&d.specialName!=''){$('.prj-name-tr').show();if($('.docu-style:checked').val()=="TRAIN_APPLY"){$('#budgetProjectTd').hide();$(".input-budget-app-id").removeAttr('validform')}else{$('#budgetProjectTd').show();$(".input-budget-app-id").attr('validform','{isNull:true,msg:\'请选择预算项目\',changeFlag:true}')}$('#prjName').val(d.prjName)}else{$('.prj-name-tr').hide();$('#budgetProjectTd').hide();$(".input-budget-app-id").removeAttr('validform');$('#prjName').val('')}}},msgListEvent:function(){var me=this;$('.add-msg').click(function(){me.showMsgAlert();$('.msg-common').off().on('click',function(){me.appendMsgList()})});$('.msg-cancel').click(function(){me.hideMsgAlert();me.clearAlert($('.msg-alert'))});$('.msg-list').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();me.resetNum($('.msg-list'))}})});$('.msg-list').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var nameVal=$('#nameVal').val(tr.attr('nameVal'));var dutyVal=$('#dutyVal').val(tr.attr('dutyVal'));var deptVal=$('#deptVal').val(tr.attr('deptVal'));me.showMsgAlert();$('.msg-common').off().on('click',function(){me.appendMsgList(tr)})})},appendMsgList:function(tr){var me=this;var nameVal=$('#nameVal').val();var dutyVal=$('#dutyVal').val();var deptVal=$('#deptVal').val();var html='<tr pkId="" class="" nameVal="'+nameVal+'" dutyVal="'+dutyVal+'" deptVal="'+deptVal+'"><td><span class="num">1</span></td><td><span class="name-text">'+nameVal+'</span></td><td><span class="job-text">'+dutyVal+'</span></td><td><span class="unit-text">'+deptVal+'</span></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(nameVal!=''&&dutyVal!=''&&deptVal!=''){if(tr){tr.replaceWith(html);me.hideMsgAlert()}else{$('.msg-list').append(html);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}me.clearAlert($('.msg-alert'));me.resetNum($('.msg-list'))}else{$yt_alert_Model.prompt('请完整填写数据')}},updateMsgList:function(tr){},resetNum:function(obj){var trs=obj.find('tbody tr');$.each(trs,function(i,n){$(n).find('.num').text(i+1)})},showMsgAlert:function(){var alert=$('.msg-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideMsgAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.msg-alert').hide();$('#pop-modle-alert').hide()},generalListEvent:function(){var me=this;$('.add-general').click(function(){me.showGeneralAlert();$('.general-common').off().on('click',function(){me.appendGeneralList()})});$('.general-cancel').click(function(){me.hideGeneralAlert();me.clearAlert($('.general-alert'))});$('.general-list').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})});$('.general-list').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var cont=$('#generalCostContent').val(tr.attr('cont'));var sum=$('#generalSum').val(tr.attr('num'));me.showGeneralAlert();$('.general-common').off().on('click',function(){me.appendGeneralList(tr)}).text('确定')})},showGeneralAlert:function(){var alert=$('.general-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideGeneralAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.general-alert').hide();$('#pop-modle-alert').hide()},appendGeneralList:function(tr){var me=this;var cont=$('#generalCostContent').val();var sum=$('#generalSum').val();if(cont&&sum){var num=$yt_baseElement.rmoney(sum);var html='<tr cont="'+cont+'" sum="'+num+'"  class=""><td style="text-align:left;" class="">'+cont+'</td><td style="text-align: right;" class="">'+sum+'</td><td></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span> <span class="operate-del" style=""><img src="../../../../../resources-sasac/images/common/del-icon.png"></span> </td> </tr>';if(tr){tr.replaceWith(html)}else{$('#generalList tbody .last').before(html)}me.hideGeneralAlert();me.clearAlert($('.general-alert'))}else{$yt_alert_Model.prompt('请填写完整数据')}},costApplyAlertEvent:function(){},showSubsidiesAlert:function(){var me=this;var alert=$('#subdisyInfoAlert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideSubsidiesAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#subdisyInfoAlert').hide();$('#pop-modle-alert').hide()},showTripAlert:function(){var me=this;var alert=$('#busiPlanEditModel');me.setAddress();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideTripAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#busiPlanEditModel').hide();$('#pop-modle-alert').hide()},showCostApplyAlert:function(){var me=this;var alert=$('#costApplyAlert');me.setModelUsers();me.setAddress();me.getPlanBusiAddress($("#fromcity"));me.getPlanBusiAddress($("#tocity"));$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideCostApplyAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#costApplyAlert').hide();$('#pop-modle-alert').hide()},appendTripList:function(tr){var me=this;var planModel=$("#busiPlanEditModel");var modelBusiType=$('#modelBusiType option:selected');var name=modelBusiType.text();var code=modelBusiType.val();var tdStartDate=$('#tdStartDate').val();var tdEndDate=$('#tdEndDate').val();var dateFrom=new Date(tdStartDate);var dateTo=new Date(tdEndDate);var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24));var day=diff_day+1;var modelBusiAddres=$('#modelBusiAddres option:selected').val();var budiAddName=$('#modelBusiAddres').next().find('.search-current').val();var busiUsersName=$("#modelBusiUser").val();var busiUsersCode=$("#modelUserCodes").val();var busiNum=$(".model-user-num-show .users-num").text();var receptionMoney="";var receptionMoneyCode="";if(planModel.find(".check-label.check").length>0){planModel.find(".check-label.check").each(function(i,n){receptionMoney+=$(n).find("span").text()+"、";receptionMoneyCode+=$(n).find("input").val()+","});receptionMoney=receptionMoney.substring(0,receptionMoney.length-1);receptionMoneyCode=receptionMoneyCode.substring(0,receptionMoneyCode.length-1)}else{receptionMoney="--"}var html='<tr busicode="'+code+'" usercode="'+busiUsersCode+'" rececode="'+receptionMoneyCode+'" ><td><input type="hidden" class="hid-user-code" value="'+busiUsersCode+'" /> <span class="name">'+name+'</span></td><td class="sdate">'+tdStartDate+'</td><td class="edate">'+tdEndDate+'</td><td class="day">'+day+'</td><td class="address" val="'+modelBusiAddres+'">'+budiAddName+'</td><td class="uname">'+busiUsersName+'</td><td class="numof">'+busiNum+'</td><td class="reception">'+receptionMoney+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del" style=""><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if($yt_valid.validForm($('#busiPlanEditModel'))){if(tr){tr.replaceWith(html);me.hideTripAlert()}else{$('#tripList tbody').append(html);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}$("#busiUserInfo ul li").removeClass("tr-check");$("#busiUserInfo").removeClass("check");me.selUsersName="";me.selUsersCode="";$('.auto-font').show();$('.model-user-num-show').hide();me.clearAlert($('#busiPlanEditModel'));$('#modelBusiAddres').html('<option value="">请选择</option>');me.setSubsidyList();me.setAddress()}},setTripAlertData:function(tr){var planModel=$("#busiPlanEditModel");var modelBusiType=$('#modelBusiType option[value="'+tr.attr('busicode')+'"]').attr('selected',true);$('#modelBusiType').niceSelect();var tdStartDate=$('#tdStartDate').val(tr.find('.sdate').text());var tdEndDate=$('#tdEndDate').val(tr.find('.edate').text());var modelBusiAddres=$('#modelBusiAddres').html('<option value="'+tr.find('.address').attr('val')+'">'+tr.find('.address').text()+'</option>');var busiUsersName=$("#modelBusiUser").val(tr.find('.uname').text());var busiUsersCode=$("#modelUserCodes").val(tr.attr('usercode'));var busiNum=$(".model-user-num-show .users-num").text(tr.find('.numof').text());var rececode=tr.attr('rececode');var receList=rececode.split(',');$.each(receList,function(i,n){if(n){planModel.find('.check-label input[value="'+n+'"]').setCheckBoxState('check')}});serveFunds.getPlanBusiAddress($("#modelBusiAddres"))},appendCostApplyList:function(tabFlag,tr){var me=this;if(tabFlag==0){me.getTrafficCostFormInfo(tr)}if(tabFlag==1){me.getHotelFormInfo(tr)}if(tabFlag==2){me.getOtherCostFormInfo(tr)}},getTrafficCostFormInfo:function(tr){var me=this;var trabfficObj=$(".traffic-form");sysCommon.createSumTr(0);var tripUser=trabfficObj.find("#model-trip-user option:selected").text();var userCode=trabfficObj.find("#model-trip-user option:selected").val();var level=trabfficObj.find("#model-trip-user option:selected").attr("data-level");var levelCode=trabfficObj.find("#model-trip-user option:selected").attr("data-level-code");var trafficStartTime=$('#traffic-start-time').val();var trafficEndTime=$('#traffic-end-time').val();var fromcityName=$('#fromcity').next().find('.search-current').val();var fromcity=$('#fromcity option:selected').val();var tocityName=$('#tocity option:selected').text();var tocity=$('#tocity option:selected').val();var specialRemark=$('#special-remark').val();var vehicle="";var vehicleCode="";vehicleCode=trabfficObj.find(".vehicle-sel").val();var vehicleChildCode="";vehicleChildCode=(trabfficObj.find(".vehicle-two-sel").val()==null?"":trabfficObj.find(".vehicle-two-sel").val());if($(".vehicle-two-sel").val()!=""&&$(".vehicle-two-sel").val()!=null){vehicle=trabfficObj.find(".vehicle-sel option:selected").text()+trabfficObj.find(".vehicle-two-sel option:selected").text()}else{vehicle=trabfficObj.find(".vehicle-sel option:selected").text()}var cityMoney=trabfficObj.find(".city-cost-input").val();var trafficCostStr='<tr><td><span>'+tripUser+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+userCode+'" risk-code-val="trafficBusiUsers"/></td><td><span>'+level+'</span><input type="hidden" class="hid-level-code" value="'+levelCode+'" risk-code-val="trafficBusiUsersLevel"/></td><td data-text="goTime"><span risk-code-val="traExpStartDate">'+trafficStartTime+'</span></td><td><input data-val="goAddress" type="hidden" value="'+fromcity+'"><span data-text="goAddressName">'+fromcityName+'</span></td><td data-text="arrivalTime"><span  risk-code-val="traExpEndDate">'+trafficEndTime+'</span></td><td><input data-val="arrivalAddress" type="hidden" value="'+tocity+'"> <span data-text="arrivalAddressName">'+tocityName+'</span></td><td><span data-text="vehicle">'+vehicle+'</span><input type="hidden" class="hid-vehicle" value="'+vehicleCode+'" risk-code-val="vehicleParent"/><input type="hidden" class="hid-child-code" value="'+vehicleChildCode+'"  risk-code-val="vehicleChild"/></td><td class="font-right money-td" data-text="crafare" risk-code-val="cityTrafficCost">'+(cityMoney==''?"--":$yt_baseElement.fmMoney(cityMoney))+'</td><td class="text-overflow-sty" data-text="remarks" title="'+specialRemark+'">'+(specialRemark==""?"--":specialRemark)+'</td><td><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(trafficCostStr);me.hideCostApplyAlert()}else{$("#traffic-list-info tbody .total-last-tr").before(trafficCostStr);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}me.updateMoneySum(0);me.clearFormData();},setFormInfo:function(thisTr){var me=this;var costType=$(thisTr).find(".hid-cost-type").val();if(costType==0){var busiUser=$(thisTr).find("td:eq(0) .hid-traf-users").val();var startDate=$(thisTr).find("td:eq(2)").text();var startAddre=$(thisTr).find("td:eq(3)").text();var startVal=$(thisTr).find("td:eq(3)").attr('val');var endDate=$(thisTr).find("td:eq(4)").text();var endAddre=$(thisTr).find("td:eq(5)").text();var endVal=$(thisTr).find("td:eq(5)").attr('val');var vehicles=0;if($(thisTr).find("td:eq(6) input:eq(0)").val().indexOf(".")!=-1){vehicles=$(thisTr).find("td:eq(6) input:eq(0)").val().split(".")}var vehicle="";var vehicleChildCode="";if(vehicles.length>0){vehicle=vehicles[1];vehicleChildCode=vehicles[2]}else{vehicle=$(thisTr).find("td:eq(6) input:eq(0)").val();vehicleChildCode=$(thisTr).find("td:eq(6) .hid-child-code").val()}var cityMoney=$(thisTr).find("td:eq(7)").text();var cityMsg=$(thisTr).find("td:eq(8)").text();$('#model-trip-user option[value="'+busiUser+'"]').attr("selected","selected");$("#traffic-start-time").val(startDate);$("#traffic-end-time").val(endDate);$("#fromcity").html('<option value="'+startVal+'">'+startAddre+'</option>');$("#tocity").html('<option value="'+endVal+'">'+endAddre+'</option>');$('.traffic-form .vehicle-sel option[value="'+vehicle+'"]').attr("selected","selected");if(vehicleChildCode!=""){$("#vehicleTwoDiv").css('display','inline-block');sysCommon.vechicleChildData(vehicle);$('.traffic-form .vehicle-two-sel option[value="'+vehicleChildCode+'"]').attr("selected","selected")}$(".traffic-form .city-cost-input").val(cityMoney);$("#special-remark").val((cityMsg=="--"?"":cityMsg));$('#model-trip-user,.traffic-form .vehicle-sel,.traffic-form .vehicle-two-sel').niceSelect();me.getPlanBusiAddress($("#fromcity"));me.getPlanBusiAddress($("#tocity"));if(vehicle!=""||vehicleChildCode!=""){$(".vehicle-sel").parents("td").find(".risk-img").attr("src",me.riskViaImg)}}if(costType==1){var busiUser=$(thisTr).find("td:eq(0) input").val();var dayMoney=$(thisTr).find("td:eq(2)").text();var hotelDay=$(thisTr).find("td:eq(5)").text();var hotelMoney=$(thisTr).find("td:eq(6)").text();var hotelAddress=$(thisTr).find("td:eq(7) input").val();var sDate=$(thisTr).find('.sdate').text();$('.hotel-form #hotelDate').val(sDate);var eDate=$(thisTr).find('.edate').text();$('.hotel-form #leaveDate').val(eDate);hotelAddress=hotelAddress.split("-");var hotelAddressName=$(thisTr).find('td:eq(7) span').text().split('-');var textareMsg=$(thisTr).find("td:eq(8)").text();$('#hotel-trip-user').val(busiUser);$(".hotel-form .hotel-num").text(hotelDay);if(hotelAddress.length==3){$('#hotelParentAddress').html('<option value="'+hotelAddress[0]+'">'+hotelAddressName[0]+'</option>');$('#hotelTwoAddres').html('<option value="'+hotelAddress[1]+'">'+hotelAddressName[1]+'</option>');$('#hotelChildAddres').html('<option value="'+hotelAddress[2]+'">'+hotelAddressName[2]+'</option>');}else if(hotelAddress.length==2){$('#hotelChildAddres').html('<option value="'+hotelAddress[1]+'">'+hotelAddressName[1]+'</option>');}$(".hotel-form .hotel-money").val(hotelMoney);$("#peoDayMoney").text(dayMoney);$(".hotel-form .hotel-msg").val((textareMsg=="--"?"":textareMsg));me.setAddress();$('#hotel-trip-user').niceSelect();me.hotelChildDisa(hotelAddress[0],"CITY");me.hotelChildDisa(hotelAddress[1],"AREA")}if(costType==2){var costType=$(thisTr).find("td:eq(0) input").val();var costMoney=$(thisTr).find("td:eq(1)").text();var textareMsg=$(thisTr).find("td:eq(2)").text();$('#cost-type option[value="'+costType+'"]').attr("selected","selected");$(".other-form .other-money").val(costMoney);$(".other-form .other-msg").val((textareMsg=="--"?"":textareMsg));$('#cost-type').niceSelect()}},getHotelFormInfo:function(tr){var me=this;var hotelObj=$(".hotel-form");sysCommon.createSumTr(1);var tripUser=hotelObj.find("select.hotel-trip-user-sel option:selected").text();var level=hotelObj.find("select.hotel-trip-user-sel option:selected").attr("data-level");var levelCode=hotelObj.find("select.hotel-trip-user-sel option:selected").attr("data-level-code");var hotelAddress="";var hotelAdressCode="";var hotelParentAdres=hotelObj.find("#hotelParentAddress").next().find('.search-current').val();var hotelTwoAdres=hotelObj.find("#hotelTwoAddres").next().find('.search-current').val();var hotelChildAdres=hotelObj.find("#hotelChildAddres").next().find('.search-current').val();if(hotelTwoAdres==""||hotelTwoAdres=="请选择"){hotelAddress=hotelParentAdres;hotelAdressCode=hotelObj.find("#hotelParentAddress").val()}else{hotelAddress=hotelParentAdres+"-"+hotelTwoAdres+"-"+hotelChildAdres;hotelAdressCode=hotelObj.find("#hotelParentAddress").val()+"-"+hotelObj.find("#hotelTwoAddres").val()+"-"+hotelObj.find("#hotelChildAddres").val()}var hotelCheckInDate=$("#hotelDate").val();var leaveDate=$("#leaveDate").val();var hotelCostStr='<tr><td><span>'+tripUser+'</span><input type="hidden" data-val="travelPersonnel" value="'+hotelObj.find("select.hotel-trip-user-sel").val()+'" risk-code-val="hotelBusiUsers"/></td><td><span>'+level+'</span><input type="hidden" value="'+levelCode+'" risk-code-val="hotelBusiUsersLevel"/></td><td class="font-right"  risk-code-val="costDetailHotelCost"><span>'+$("#peoDayMoney").html()+'</span></td><td  risk-code-val="hotelCheckInDate" class="check-in-date"><span data-text="hotelTime" class="sdate">'+hotelCheckInDate+'</span></td><td class="leave-date"><span data-text="leaveTime" class="edate">'+leaveDate+'</span></td><td data-text="hotelDays">'+hotelObj.find(".hotel-num").text()+'</td><td class="font-right money-td" data-text="hotelExpense"  risk-code-val="hotelCost"><span>'+$yt_baseElement.fmMoney(hotelObj.find(".cost-detail-money").val()||'0')+'</span></td><td><span data-text="hotelAddressName">'+hotelAddress+'</span><input type="hidden" data-val="hotelAddress" value="'+hotelAdressCode+'"/><input type="hidden" risk-code-val="hotelProvinceAddress" value="'+hotelObj.find("#hotelParentAddress").val()+'"/><input type="hidden" risk-code-val="hotelCityAddress" value="'+hotelObj.find("#hotelTwoAddres").val()+'"/><input type="hidden" risk-code-val="hotelHaidianAddress" value="'+hotelObj.find("#hotelChildAddres").val()+'"/></td><td class="text-overflow-sty" data-text="remarks" title="'+hotelObj.find(".hotel-msg").val()+'">'+(hotelObj.find(".hotel-msg").val()==""?"":hotelObj.find(".hotel-msg").val())+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(hotelCostStr);me.hideCostApplyAlert()}else{$("#hotel-list-info tbody .total-last-tr").before(hotelCostStr);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}me.updateMoneySum(1);me.clearFormData();},getOtherCostFormInfo:function(tr){var me=this;var otherObj=$(".other-form");sysCommon.createSumTr(2);var costType=otherObj.find("#cost-type option:selected").text();var otherCostStr='<tr><td><span>'+costType+'</span><input type="hidden" data-val="costType" risk-code-val="otherCostType" value="'+otherObj.find("#cost-type").val()+'"/></td><td class="font-right money-td" data-text="reimAmount" risk-code-val="otherCostReimPrice">'+$yt_baseElement.fmMoney(otherObj.find(".other-money").val()||'0')+'</td><td class="text-overflow-sty" data-text="remarks" title="'+otherObj.find(".other-msg").val()+'">'+(otherObj.find(".other-msg").val()==""?"--":otherObj.find(".other-msg").val())+'</td><td><input type="hidden" class="hid-cost-type" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(otherCostStr);me.hideCostApplyAlert()}else{$("#other-list-info tbody .total-last-tr").before(otherCostStr);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}me.updateMoneySum(2);me.clearFormData();},borrowListEvent:function(){var me=this;$('.borrow-money').click(function(){me.getBorrowList();me.showBorrowAlert()});$('.borrow-common').click(function(){var code=$('.borrow-list .yt-table-active').attr('code');if(code){$('.borrow-money').val(code);$('#loanAppId').val($('.borrow-list .yt-table-active').attr('pid'));var loanMoney=serveFunds.rmoney($('.borrow-list .yt-table-active').find(".loanApp-balance").text());$("#outstandingBalance").text(serveFunds.fmMoney(loanMoney));var total=serveFunds.rmoney($('#applyTotalMoney').text());var outWriteAmount=total<=loanMoney?total:loanMoney;$('#outWriteAmount').text(serveFunds.fmMoney(outWriteAmount));var outstandingBalance=loanMoney;var writeOffAmount=total>=outstandingBalance?outstandingBalance:total;$('#writeOffAmount,#outWriteAmount').text(serveFunds.fmMoney(writeOffAmount));var replaceMoney=total>=outstandingBalance?total-writeOffAmount:0;$('#replaceMoney').text(serveFunds.fmMoney(replaceMoney));$('#balanceMoney').text(serveFunds.fmMoney(total<outstandingBalance?outstandingBalance-total:'0'));me.hideBorrowAlert()}else{$yt_alert_Model.prompt('请选择一条数据')}});$('.borrow-cancel').click(function(){me.hideBorrowAlert();$('.borrow-val').val('');});$('.borrow-search').click(function(){if($(this).parent().parent().parent().hasClass("prior-approval")){var typeId="EXPENDITURE_APP";var urlName="";if($('.docu-style:checked').val()=="TRAIN_APPLY"){urlName="sz/advanceApp/getTrainAdvanceAppListToPageByParams"}else{urlName="sz/advanceApp/getAdvanceAppListToPageByParams"}var costType="TRAVEL_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","prior-approval")}else if($(this).parent().parent().parent().hasClass("budget-project")){var typeId="FINAL_APP";var urlName="sz/advanceApp/getProjectFinalAccountsListToPageByParams";var costType="TRAIN_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","budget-project")}else{$(".prior-alert").attr("advance-type","")}});$('.borrow-reset').click(function(){$('.borrow-val').val('');if($(this).parent().parent().parent().hasClass("prior-approval")){var typeId="EXPENDITURE_APP";var urlName="";if($('.docu-style:checked').val()=="TRAIN_APPLY"){urlName="sz/advanceApp/getTrainAdvanceAppListToPageByParams"}else{urlName="sz/advanceApp/getAdvanceAppListToPageByParams"}var costType="TRAVEL_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","prior-approval")}else if($(this).parent().parent().parent().hasClass("budget-project")){var typeId="FINAL_APP";var urlName="sz/advanceApp/getProjectFinalAccountsListToPageByParams";var costType="TRAIN_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","budget-project")}else{$(".prior-alert").attr("advance-type","")}})},showBorrowAlert:function(){var alert=$('.borrow-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideBorrowAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.borrow-alert').hide();$('#pop-modle-alert').hide()},specialListEvent:function(){var me=this;$('.special-name').click(function(){me.showSpecialAlert()});$('.special-common').click(function(){var code=$('.special-list .yt-table-active').attr('code');if(code){$('.special-name').val(code);me.hideSpecialAlert()}else{$yt_alert_Model.prompt('请选择一条数据')}});$('.special-cancel').click(function(){me.hideSpecialAlert();$('.special-val').val('');});$('.special-search').click(function(){if($(this).parent().parent().parent().hasClass("prior-approval")){var typeId="EXPENDITURE_APP";var urlName="";if($('.docu-style:checked').val()=="TRAIN_APPLY"){urlName="sz/advanceApp/getTrainAdvanceAppListToPageByParams"}else{urlName="sz/advanceApp/getAdvanceAppListToPageByParams"}var costType="TRAVEL_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","prior-approval")}else if($(this).parent().parent().parent().hasClass("budget-project")){var typeId="FINAL_APP";var urlName="sz/advanceApp/getProjectFinalAccountsListToPageByParams";var costType="TRAIN_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","budget-project")}else{$(".prior-alert").attr("advance-type","")}});$('.special-reset').click(function(){$('.special-val').val('');if($(this).parent().parent().parent().hasClass("prior-approval")){var typeId="EXPENDITURE_APP";var urlName="";if($('.docu-style:checked').val()=="TRAIN_APPLY"){urlName="sz/advanceApp/getTrainAdvanceAppListToPageByParams"}else{urlName="sz/advanceApp/getAdvanceAppListToPageByParams"}var costType="TRAVEL_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","prior-approval")}else if($(this).parent().parent().parent().hasClass("budget-project")){var typeId="FINAL_APP";var urlName="sz/advanceApp/getProjectFinalAccountsListToPageByParams";var costType="TRAIN_APPLY";me.getPriorApprovalList(typeId,urlName,costType);$(".prior-alert").attr("advance-type","budget-project")}else{$(".prior-alert").attr("advance-type","")}})},showSpecialAlert:function(){var alert=$('.special-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideSpecialAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.special-alert').hide();$('#pop-modle-alert').hide()},getPriorApprovalList:function(typeId,urlName,costType){var tbody=$('.prior-approval-list tbody');var queryParams=$('.prior-approval-val').val();var pageDiv=$('.prior-page');$('.prior-page').pageInfo({pageIndex:1,pageNum:5,pageSize:3,url:urlName,objName:'data',data:{type:typeId,queryParams:queryParams,costType:costType},success:function(data){tbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){pageDiv.show();$.each(data.data.rows,function(i,n){trStr+='<tr pid="'+n.advanceAppId+'" code="'+n.advanceAppNum+'" type="'+n.advanceCostType+'"><td><input type="hidden" class="hidden-advanceAppId" value="'+n.advanceAppId+'" />'+n.advanceAppNum+'<input type="hidden" class="balance" value="'+n.advanceAppBalance+'" /></td><td>'+n.applicantUserName+'</td><td>'+n.applicantUserDeptName+'</td><td>'+n.advanceAppName+'</td><td>'+n.advanceCostTypeName+'</td><td>'+n.applicantTime+'</td>'+'</tr>'});tbody.append(trStr)}else{pageDiv.hide();var noTr='<tr class="model-no-data-tr"><td colspan="7"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';tbody.append(noTr)}}}})},getBorrowList:function(){var tbody=$('.borrow-list tbody');var pageDiv=$('.borrow-page');var queryParams=$('.borrow-val').val();$('.borrow-page').pageInfo({pageIndex:1,pageNum:5,pageSize:3,url:"sz/loanApp/getUserLoanAppInfoListToPageByParams",objName:'data',data:{queryParams:queryParams},success:function(data){tbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){pageDiv.show();$.each(data.data.rows,function(i,n){trStr+='<tr pid="'+n.loanAppId+'" code="'+n.loanAppNum+'"><td>'+n.loanAppNum+'</td><td>'+n.applicantUserName+'</td><td>'+n.applicantUserDeptName+'</td><td>'+n.loanAppName+'</td><td>'+n.applicantTime+'</td><td style="text-align: right;"><span class="loanApp-balance">'+($yt_baseElement.fmMoney(n.arrearsAmount||'0'))+'</span></td></tr>'});tbody.append(trStr)}else{pageDiv.hide();var noTr='<tr class="model-no-data-tr"><td colspan="6"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';tbody.append(noTr)}}}})},getSpecialList:function(){var tbody=$('.special-list tbody');var pageDiv=$('.special-page');var quertStr=$('.special-val').val();$('.special-page').pageInfo({pageIndex:1,pageNum:5,pageSize:3,url:"sz/advanceApp/getAdvanceAppListToPageByParams",objName:'data',data:{},success:function(data){tbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){pageDiv.show();$.each(data.data.rows,function(i,n){trStr+='<tr code="ZX201804011"><td>ZX201804011</td><td>人工智能研发</td><td style="text-align:right;">10,000.00</td><td>8,500.00</td></tr>'});tbody.append(trStr)}else{pageDiv.hide();var noTr='<tr class="model-no-data-tr"><td colspan="4"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';tbody.append(noTr)}}}})},getCostTypeList:function(code){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByFormCode",async:true,data:{formAppCode:'EXPENDITURE_APP'},success:function(data){var list=data.data||[];var opts='';$.each(list,function(i,n){opts+='<label';if(n.costCode=='SOCIAL_SECURITY_FEE'||n.costCode=='ACCRUED_TAX'||n.costCode=='LABOUR_UNION_FUNDS'||n.costCode=='PARTY_BUILDING_FUNDS'||n.costCode=='SPECIAL_DEDUCTION'||n.costCode=='CURRENT_ACCOUNT'){opts+=' acl-code="'+n.jsFun+'"'}opts+=' class="check-label yt-radio"><input id="" fun="'+n.jsFun+'" class="docu-style" name="style" value="'+n.costCode+'" type="radio">'+n.costName+'</label>'});$('.docu-style-box').append(opts);$('.docu-style-box .check-label input').eq(0).setRadioState('check');if(code){$('.docu-style-box input[value="'+code+'"]').setRadioState('check')}var parentObj=window.parent.document.getElementById("system-menu");var iJquery=window.parent.jQuery;var $mydata=iJquery($(parentObj).find(".two-menu.child-check .menu-element"));var menuInfo=$mydata.data('menuData');if(menuInfo==undefined||menuInfo==null){var menuEle=$(parentObj).find('.menu-element[menuurl="view/system-sasac/expensesReim/module/reimApply/expenseAccount.html"]');var $mydata=iJquery(menuEle);menuInfo=$mydata.data("menuData")}$left_menu.accessControlFun(menuInfo.systemId,menuInfo.pkId)}})},getDictInfoByTypeCode:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:true,data:{dictTypeCode:'ACTIVITY_PRO,SPECIFIC_COST_TYPE,TRAVEL_TYPE,VEHICIE_CODE,HOTEL_ADDRESS,COST_TYPE,OTHER_UNIT_REC_TYPE,PERSONAL_REC_TYPE'},success:function(data){var list=data.data||[];var start='<option value="">请选择</option>',optone=start,opttwo=start,travelType=start,vehicieCode=start,hotel=start,reverse='<option value="">无</option>',reverseUser='<option value="">无</option>',cost=start;$.each(list,function(i,n){if(n.dictTypeCode=='ACTIVITY_PRO'){optone+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='SPECIFIC_COST_TYPE'){opttwo+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='TRAVEL_TYPE'){travelType+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='VEHICIE_CODE'){vehicieCode+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='HOTEL_ADDRESS'){hotel+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='COST_TYPE'){cost+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='OTHER_UNIT_REC_TYPE'){reverse+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='PERSONAL_REC_TYPE'){reverseUser+='<option value="'+n.value+'">'+n.disvalue+'</option>'}});$('#witeOffCompany,#witeOffOther').html(reverse).niceSelect();$('#witeOffPersonal').html(reverseUser).niceSelect();$('#budgetProject').html(optone).niceSelect();$('#costBreakdown').html(opttwo).niceSelect();$('#modelBusiType').html(travelType).niceSelect();$('select.vehicle-sel').html(vehicieCode).on("change",function(){var selVal=$(this).val();sysCommon.vechicleChildData(selVal)}).niceSelect();$('select.cost-type-sel').html(cost).niceSelect()}})},clearAlert:function(obj){var selects=obj.find('select');$.each(selects,function(i,n){$(n).find('option:eq(0)').attr('selected',true)});selects.niceSelect();var inputs=obj.find('input:not(input[type="radio"],input[type="checkbox"])');inputs.val('');var checks=obj.find('input[type="checkbox"]');$.each(checks,function(i,n){$(n).setCheckBoxState('uncheck')});var textareas=obj.find('textarea');obj.find('.valid-font').text('');obj.find('.valid-hint').removeClass('valid-hint');textareas.val('')},submitExpenditureAppInfo:function(subData,thisBtn){var me=this;thisBtn.off();$.ajax({type:"post",url:"sz/expenditureApp/submitExpenditureAppInfo",async:true,data:subData,success:function(data){if(data.flag==0){subData.appId=data.data;var code=$('.docu-style:checked').val();if(code!='SPECIAL_DEDUCTION'){var workflowCode=$("#workflowCode").val();if($("#workflowCode").val()){me.submitWorkFlowByCode({appId:data.data,businessCode:workflowCode,parameters:'{posCode:"'+serveFunds.parCode+'"}',dealingWithPeople:subData.dealingWithPeople,opintion:subData.opintion,processInstanceId:subData.processInstanceId,nextCode:subData.nextCode },thisBtn)}else{me.submitWorkFlow({appId:data.data,parameters:'{posCode:"'+serveFunds.parCode+'"}',dealingWithPeople:subData.dealingWithPeople,opintion:subData.opintion,processInstanceId:subData.processInstanceId,nextCode:subData.nextCode },thisBtn)}}var menUrl='view/system-sasac/expensesReim/module/approval/myApplyList.html';if(window.frames.length==parent.frames.length){$yt_baseElement.openNewPage(1,menUrl,menUrl);window.close()}else{$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:menUrl }})}}else{me.setSubmitEvent()}},error:function(e){me.setSubmitEvent()}})},submitWorkFlow:function(subData,thisBtn){$.ajax({type:"post",url:"sz/expenditureApp/submitWorkFlow",async:false,data:subData,success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){var pageUrl="view/system-sasac/expensesReim/module/print/InvoicePasting.html?appId="+subData.appId;$yt_baseElement.openNewPage(2,pageUrl)}else{me.setSubmitEvent()}},error:function(e){me.setSubmitEvent()}})},submitWorkFlowByCode:function(subData,thisBtn){var me=this;$.ajax({type:"post",url:"sz/expenditureApp/submitWorkFlowByBusinessCode",async:false,data:subData,success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){var pageUrl="view/system-sasac/expensesReim/module/print/InvoicePasting.html?appId="+subData.appId;$yt_baseElement.openNewPage(2,pageUrl)}else{me.setSubmitEvent()}},error:function(e){me.setSubmitEvent()}})},submitExpenditureAppInfoToDrafts:function(subData,thisBtn){$.ajax({type:"post",url:"sz/expenditureApp/submitExpenditureAppInfoToDrafts",data:subData,success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/expensesReim/module/approval/draftsList.html'}})}else{serveFunds.setSaveEvent()}}})},getExpenditureAppInfoByAppId:function(expenditureAppId){var me=this;$.ajax({type:"post",url:"sz/expenditureApp/getExpenditureAppInfoByAppId",async:true,data:{expenditureAppId:expenditureAppId},success:function(data){if(data.data.budgetAppId!=''){$("#travelRadio .check-label").addClass("check");$("#budgetProjectTd").show();$(".budget-project").val(data.data.budgetAdvanceAppNum);$("#hiddenBudgetProject").val(data.data.budgetAppId)}var d=data.data;serveFunds.costType=d.costType;if(d.taskKey=='activitiStartTask'){$('#savePayment').remove()}me.showDetail(d);if(d.specialCode.split("-")[0]=='SC_394'){$('.prj-name-tr').hide()}}})},getCostAppInfoDetailByParams:function(appId,costType){var me=this;$.ajax({type:"post",url:"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{appId:appId,costType:costType},success:function(data){me.showCostDetail(data.data)}})},getReimPreviewDetailByReimAppId:function(reimAppId,previewFalg,qrCodeContext){var me=this;$.ajax({type:"post",url:"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{reimAppId:reimAppId,previewFalg:previewFalg,qrCodeContext:qrCodeContext},success:function(data){}})},getSubData:function(){var me=this;var costData=function(){return JSON.stringify({costReceptionistList:me.costReceptionistList(),costDetailsList:me.costDetailsList(),travelRouteList:me.tripPlanList(),costCarfareList:me.carfareList(),costHotelList:me.hotelList(),costOtherList:me.otherList(),costSubsidyList:me.costSubsidyList(),trainApplyInfoList:me.trainApplyInfoList(),teacherApplyInfoList:me.teacherApplyInfoList(),costTrainApplyInfoList:me.costTrainApplyInfoList(),costTeachersFoodApplyInfoList:me.costTeachersFoodApplyInfoList(),costTeachersLectureApplyInfoList:me.costTeachersLectureApplyInfoList(),costTeachersTravelApplyInfoList:me.costTeachersTravelApplyInfoList(),costTeachersHotelApplyInfoList:me.costTeachersHotelApplyInfoList(),costNormalList:me.costNormalList(),costSpecialList:me.costSpecialList(),meetingList:me.meetingList(),meetingCostList:me.meetingCostList()})};var payReceivablesData=function(){return JSON.stringify({gatheringUnitList:me.gatheringUnitList(),gatheringPersonList:me.gatheringPersonList(),gatheringOtherList:me.gatheringOtherList()})};var rMoney=$yt_baseElement.rmoney;var specialCode=function(){var code='';$('select.budget-item-one,select.budget-item-two,select.budget-item-three').each(function(i,n){var val=$(this).find('option:selected').val();if(val){code+=val+'-'}});code=(code.substring(code.length-1)=='-')?code.substring(0,code.length-1):code;return code};var code=$('.docu-style:checked').val();var deductBudgetTotalMoney=0;var totalAmount=0;if(code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'||code=='SOCIAL_SECURITY_FEE'){deductBudgetTotalMoney=$yt_baseElement.rmoney($('#deductBudgetTotalMoney').text());totalAmount=$yt_baseElement.rmoney($('#applyTotalMoney').text())}else if(code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'){deductBudgetTotalMoney=0;totalAmount=$yt_baseElement.rmoney($('#applyTotalMoney').text())}else if(code=='TRAIN_APPLY'){var costTotal=$yt_baseElement.rmoney($("#lectureFeeTable .costTotal").text());var costTotalAfter=$yt_baseElement.rmoney($("#lectureFeeTable .costTotal-after").text());var taxAmount=Number(costTotal-costTotalAfter);var applyAmount=$yt_baseElement.rmoney($("#applyTotalMoney").text());var endAmount=applyAmount-taxAmount;deductBudgetTotalMoney=endAmount;totalAmount=$yt_baseElement.rmoney($('#applyTotalMoney').text())}else{totalAmount=$yt_baseElement.rmoney($('#applyTotalMoney').text());deductBudgetTotalMoney=totalAmount}return{budgetAppId:$('#hiddenBudgetProject').val(),advanceAppId:$('#advanceAppId').val(),loanAppId:$('#loanAppId').val(),expenditureAppId:$('#reimAppId').val(),reimAppNum:$('#reimAppNum').val(),expenditureAppName:$('#reimAppName').val(),costType:$('.docu-style-box .check input').val(),specialCode:specialCode(),prjCode:'',prjName:$('#prjName').val(),invoiceNum:$('#invoiceNum').val(),totalAmount:totalAmount,deductBudgetAmount:deductBudgetTotalMoney,writeOffAmount:serveFunds.rmoney($('#writeOffAmount').text()),officialCard:rMoney($('.amount-table .official').val()||'0'),cash:rMoney($('.amount-table .cash').val()||'0'),cheque:rMoney($('.amount-table .cheque').val()||'0'),transfer:0,attIdStr:me.getFileList(),paymentDate:'',paymentAmount:0,cmTotalAmount:0,cmWriteOffAmount:0,cmOfficialCard:0,cmCash:0,cmCheque:0,cmTransfer:0,applicantUser:$('#applicantUser').val(),parameters:'{posCode:"'+serveFunds.parCode+'"}',dealingWithPeople:$("#approve-users option:selected").val(),opintion:$('#opintion').val(),processInstanceId:$('#processInstanceId').val(),nextCode:$('#operate-flow option:selected').val(),costData:costData(),billingVoucherJson:'',payReceivablesData:payReceivablesData()}},getFileList:function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length-1?',':'')});return str},costReceptionistList:function(){var list=[];var trs=$('.msg-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costReceptionistId:tr.attr('pkId'),name:tr.find('.name-text').text(),jobName:tr.find('.job-text').text(),unitName:tr.find('.unit-text').text(),})});return list},costDetailsList:function(){var list=[];var trs=$('#paymentList tbody tr:not(.last)');var tr=null;var setMethod=$('#paymentList').next().find('.check-label.check input').val();$.each(trs,function(i,n){tr=$(n);list.push({publicServiceProCode:tr.attr('budgetcode'),activityDate:tr.find('.act-date').text(),placeName:tr.find('.place-name').text(),costType:tr.attr('costcode'),activityAmount:serveFunds.rmoney(tr.find('.money').text()||'0'),peopleNum:tr.find('.people-num').text(),setMethod:setMethod })});return list},tripPlanList:function(){var list=[];var trs=$('#tripList tbody tr:not(.last)');var tr=null;var setMethod=$('#tripList').next().find('.check-label.check input').val();$.each(trs,function(i,n){tr=$(n);list.push({travelType:tr.attr('busicode'),travelAddress:tr.find('.address').attr('val'),travelAddressName:tr.find('.address').text(),startTime:tr.find('.sdate').text(),endTime:tr.find('.edate').text(),travelPersonnels:tr.attr('usercode'),receptionCostItem:tr.attr('rececode'),setMethod:setMethod })});return list},carfareList:function(){var costCarfareList=[];var costCarfareJson="";var cityDatas;var setMethod=$('#traffic-list-info').next().find('.check-label.check input').val();if($("#traffic-list-info tbody tr:not(.total-last-tr)").length>0){$("#traffic-list-info tbody tr:not(.total-last-tr)").each(function(i,n){cityDatas=$(this).getDatas();cityDatas.crafare=serveFunds.rmoney(cityDatas.crafare);cityDatas.setMethod=setMethod;if($(this).find(".hid-child-code").val()=="null"||$(this).find(".hid-child-code").val()==""){cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."}else{cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."+$(this).find(".hid-child-code").val()+"."}costCarfareList.push(cityDatas)})}return costCarfareList},hotelList:function(){var costHotelList=[];var costHotelJson="";var hotelDatas;var setMethod=$('#hotel-list-info').next().find('.check-label.check input').val();if($("#hotel-list-info tbody tr:not(.total-last-tr)").length>0){$("#hotel-list-info tbody tr:not(.total-last-tr)").each(function(i,n){hotelDatas=$(this).getDatas();hotelDatas.hotelExpense=serveFunds.rmoney(hotelDatas.hotelExpense);hotelDatas.setMethod=setMethod;costHotelList.push(hotelDatas)});if(costHotelList.length>0){costHotelJson=JSON.stringify(costHotelList)}}return costHotelList},otherList:function(){var costOtherList=[];var costOtherJson="";var otherDatas;var setMethod=$('#other-list-info').next().find('.check-label.check input').val();if($("#other-list-info tbody tr:not(.total-last-tr)").length>0){$("#other-list-info tbody tr:not(.total-last-tr)").each(function(i,n){otherDatas=$(this).getDatas();otherDatas.reimAmount=serveFunds.rmoney(otherDatas.reimAmount);otherDatas.setMethod=setMethod;costOtherList.push(otherDatas)});if(costOtherList.length>0){costOtherJson=JSON.stringify(costOtherList)}}return costOtherList},costSubsidyList:function(){var list=[];var trs=$('#subsidy-list-info tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelPersonnel:tr.find('.user').attr('code'),subsidyDays:tr.find('.subsidy-num').text(),subsidyFoodAmount:serveFunds.rmoney(tr.find('.food').text()),carfare:serveFunds.rmoney(tr.find('.traffic').text()),setMethod:''})});return list},trainApplyInfoList:function(){var costType=$('.docu-style-box .check input').val();var list=costType=='TRAIN_APPLY'?[{trainType:$('#meetingClassification option:selected').val(),regionDesignation:$('#regionDesignation').val(),regionName:$('#regionName').val(),reportTime:$('#startTimeTop').val(),endTime:$('#endTimeTop').val(),trainDays: +$('#calculationSession').text()||'0',trainOfNum:$('#trainOfNum').val(),workerNum:$('#workerNum').val(),approvaNum:$('#approvaNum').val(),chargeStandard:$('#chargeStandard').val()}]:[];return list},teacherApplyInfoList:function(){var list=[];var trs=$('#lecturerTable tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val()})});return list},costTrainApplyInfoList:function(){var list=[];var trs=$('#trainingFeeTable tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({trainType:tr.attr('costnameval'),standard:$yt_baseElement.rmoney(tr.find('.standard-money').text()),trainDays:tr.find('.day-num').text(),trainOfNum:tr.find('.people-num').text(),averageMoney:$yt_baseElement.rmoney(tr.find('.smallplan-money').text()),remark:tr.find('.special-instruct').text()})});return list},costTeachersFoodApplyInfoList:function(){var list=[];var trs=$('#dietFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),averageMoney:serveFunds.rmoney(tr.find('.avg').text()),foodOfDays:tr.find('.day').text(),foodAmount:serveFunds.rmoney(tr.find('.sum-pay').text()),remarks:tr.find('.dec').text()==''?'':tr.find('.dec').text(),setMethod:''})});return list},costTeachersLectureApplyInfoList:function(){var list=[];var trs=$('#lectureFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),courseName:tr.find('.cname').text(),teachingHours:tr.find('.hour').text(),perTaxAmount:serveFunds.rmoney(tr.find('.sum-pay').text()),afterTaxAmount:serveFunds.rmoney(tr.find('.after').text()),averageMoney:serveFunds.rmoney(tr.find('.avg').text()),remarks:tr.find('.lectureId').val(),setMethod:''})});return list},costTeachersTravelApplyInfoList:function(){var list=[];var trs=$('#carFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),goTime:tr.find('.sdate').text(),arrivalTime:tr.find('.edate').text(),goAddress:tr.find('.scode').val(),goAddressName:tr.find('.sadd').text(),arrivalAddress:tr.find('.ecode').val(),arrivalAddressName:tr.find('.eadd').text(),vehicle:tr.find('.tool').val(),carfare:serveFunds.rmoney(tr.find('.sum-pay').text()),remarks:tr.find('.dec').text()==''?'':tr.find('.dec').text(),setMethod:'',})});return list},costTeachersHotelApplyInfoList:function(){var list=[];var trs=$('#hotelFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),startTime:tr.find('.sdate').text(),endTime:tr.find('.edate').text(),hotelDays:tr.find('.day').text(),hotelAddress:'',hotelAddressName:'',hotelExpense:serveFunds.rmoney(tr.find('.sum-pay').text()),averageMoney:serveFunds.rmoney(tr.find('.avg').text()),remarks:tr.find('.dec').text()==''?'':tr.find('.dec').text(),setMethod:''})});return list},costNormalList:function(){var list=[];var tr=null;var trs=$('.ordinary-approval #costList tbody tr:not(.last)');;$.each(trs,function(i,n){tr=$(n);list.push({normalId:'',normalName:tr.find(".reimContent").text(),normalAmount:$yt_baseElement.rmoney(tr.find(".reimAmount").text()),remarks:tr.find('.reimInstructions').text()==''?'':tr.find('.reimInstructions').text()})});return list},costSpecialList:function(){var list=[];var tr=null;var trs=$('.ordinary-approval #specialCostList tbody tr:not(.last)');;$.each(trs,function(i,n){tr=$(n);list.push({specialId:'',specialName:tr.find(".specialContent").text(),specialCode:tr.find(".specialContent").attr('code'),specialAmount:$yt_baseElement.rmoney(tr.find(".specialAmount").text()),deductBudgetAmount:$yt_baseElement.rmoney(tr.find(".deductBudgetAmount").text()),remarks:tr.find('.specialinstructions').text()==''?'':tr.find('.specialinstructions').text()})});return list},meetingList:function(){var costType=$(".docu-style-box .check input").val();var list=costType=='MEETING_APPLY'?[{meetType:$('#meetingClassification option:selected').val(),meetName:$('#meetName').val(),meetAddress:$('#meetAddress').val(),meetStartTime:$('#startTime').val(),meetEndTime:$('#endTime').val(),meetDays: +$('#calculationSession').text()||'0',meetOfNum:$('#meetOfNum').val(),meetWorkerNum:$('#meetWorkerNum').val(),}]:[];return list},meetingCostList:function(){var costType=$(".docu-style-box .check input").val();var list=costType=='MEETING_APPLY'?[{meetHotel:$yt_baseElement.rmoney($('#meetHotel').val()),meetFood:$yt_baseElement.rmoney($('#meetFood').val()),meetOther:$yt_baseElement.rmoney($('#meetOther').val()),meetAmount:$yt_baseElement.rmoney($('#costTotal').text()),meetAverage:$yt_baseElement.rmoney($('#dailyAverageConsumption').text()),}]:[];return list},gatheringUnitList:function(){var list=[];var trs=$('table.payee-unit tbody tr:not(.payee-unit-total)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({unitName:tr.attr('companyname'),openBank:tr.attr('openbank'),accounts:tr.attr('accountnumber'),amount:$yt_baseElement.rmoney(tr.attr('companymoney')),isContract:tr.attr('contractradio'),isSettlement:tr.attr('settlementradio'),reverseTheWay:tr.attr('witeoffcompany'),actualCollectionAmount:$yt_baseElement.rmoney(tr.attr('actualmoney')),reverseLoanAmount:$yt_baseElement.rmoney(tr.attr('thereversemoney')),loanAppId:tr.attr('choiceLoanDataValue')||null,paidAmount:tr.attr('companyPaidAmount')=='--'?'0':$yt_baseElement.rmoney(tr.attr('companyPaidAmount')),reverseTheWayName:tr.find('td').eq(2).text(),remarks:tr.attr('companyspecial')==''?'':tr.attr('companyspecial'),})});return list},setHeringUnitList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="payee-unit-tr" pkid="" choiceLoanDataValue="'+n.loanAppId+'" witeoffcompany="'+n.reverseTheWay+'" theReverseMoney="'+$yt_baseElement.rmoney(n.reverseLoanAmount)+'" actualMoney="'+$yt_baseElement.rmoney(n.actualCollectionAmount)+'" companyPaidAmount="'+n.paidAmount+'" companyname="'+n.unitName+'" openbank="'+n.openBank+'" accountnumber="'+n.accounts+'" companymoney="'+n.amount+'" contractradio="'+n.isContract+'" settlementradio="'+n.isSettlement+'" companyspecial="'+n.remarks+'"><td class="com" value="Company">'+n.unitName+'</td><td style="text-align: right;" class="unitTotal">'+($yt_baseElement.fmMoney(n.amount))+'</td><td>'+(n.reverseTheWayName||'无')+'</td><td class="loan-go">'+n.reverseLoanAmount+'</td><td>'+n.actualCollectionAmount+'</td><td>'+n.openBank+'</td><td>'+n.accounts+'</td><td value="1">'+(n.isContract==1?'有':'无')+'</td><td value="1">'+(n.isSettlement==1?'汇款':'支票')+'</td><td class="companyPaidAmount-td" style="text-align:right;">'+(n.paidAmount==''?"0.00":$yt_baseElement.fmMoney(n.paidAmount))+'</td><td>'+(n.remarks?n.remarks:'')+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.amount});$('table.payee-unit .payee-unit-total').before(html).find('.payee-unit-money').text($yt_baseElement.fmMoney(total))},gatheringPersonList:function(){var list=[];var trs=$('table.payee-personal tbody tr:not(.payee-personal-total)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({personalType:2,personalCode:tr.attr('payeeval'),personalName:tr.attr('payeename'),personalUnit:tr.attr('perank'),idCard:tr.attr('idcarkno'),phoneNum:tr.attr('phonenum'),openBank:tr.attr('bankname'),accounts:tr.attr('payeebank'),writeOffAmount:$yt_baseElement.rmoney(tr.attr('theReverseMoney')),offOpenBank:tr.attr('offOpenBank'),offAccounts:tr.attr('offAccounts'),amount:$yt_baseElement.rmoney(tr.attr('personaltotal')),loanAppId:tr.attr('choiceloanval')||null,replaceAmount:$yt_baseElement.rmoney(tr.attr('personalwriteoff')),cash:$yt_baseElement.rmoney(tr.attr('cash')),officialCard:$yt_baseElement.rmoney(tr.attr('officialcard')),transfer:$yt_baseElement.rmoney(tr.attr('transferaccounts')),isContract:tr.attr('payeeradio'),reverseTheWay:tr.attr('witeoffpersonal'),paidAmount:tr.attr('payeePaidAmount')=='0'?'':$yt_baseElement.rmoney(tr.attr('payeePaidAmount')),remarks:tr.attr('personalspecial')==''?'':tr.attr('personalspecial'),})});return list},setHeringPersonList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="payee-personal-tr" payeePaidAmount="'+n.paidAmount+'" theReverseMoney="'+$yt_baseElement.rmoney(n.writeOffAmount)+'" actualMoney="'+$yt_baseElement.rmoney(n.replaceAmount)+'" choiceLoanDataValue="'+n.loanAppId+'" pkid="" payeeval="'+n.personalCode+'" payeename="'+n.personalName+'" personalUnit="'+n.personalUnit+'" pedepartment="'+n.personalDept+'" perank="'+n.personalJobLevelName+'" personaltotal="'+n.amount+'" witeoffpersonal="'+n.reverseTheWay+'" personalwriteoff="'+n.replaceAmount+'" cash="'+n.cash+'" officialcard="'+n.officialCard+'" transferaccounts="'+n.transfer+'" payeeradio="'+n.isContract+'" personalspecial="'+n.remarks+'" idcarkno="'+n.idCard+'" payeebank="'+n.accounts+'" bankname="'+n.openBank+'" phonenum="'+n.phoneNum+'" choiceloan="'+n.loanAppNum+'" choiceloanval="'+n.loanAppId+'" arrearsmoney="'+n.loanAppArrearsAmount+'" theReverseMoney="'+n.writeOffAmount+'" offOpenBank="'+n.offOpenBank+'" offAccounts="'+n.offAccounts+'"><td class="per" value="personal">'+n.personalName+'</td><td style="text-align: right;" class="personalTotal">'+serveFunds.fmMoney(n.amount)+'</td><td>'+(n.reverseTheWayName||'无')+'</td><td style="text-align: right;" class="loan-go">'+(serveFunds.fmMoney(n.writeOffAmount))+'</td><td style="text-align: right;">'+(serveFunds.fmMoney(n.replaceAmount))+'</td><td style="text-align: right;">'+(serveFunds.fmMoney(n.cash))+'</td><td style="text-align: right;">'+(serveFunds.fmMoney(n.officialCard))+'</td><td style="text-align: right;">'+(serveFunds.fmMoney(n.transfer))+'</td><td><a class="yt-link to-data">详情</a></td><td>'+(n.isContract==1?'有':'无')+'</td><td class="payeePaidAmount-td" style="text-align:right;">'+(n.paidAmount==''?"0.00":$yt_baseElement.fmMoney(n.paidAmount))+'</td><td>'+(n.remarks?n.remarks:'无')+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.amount});$('table.payee-personal .payee-personal-total').before(html).find('.payee-personal-money').text($yt_baseElement.fmMoney(total))},gatheringOtherList:function(){var list=[];var trs=$('table.payee-other tbody tr:not(.payee-other-total)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({otherName:tr.attr('othermoney'),amount:$yt_baseElement.rmoney(tr.attr('otherallmoney')),isContract:tr.attr('otherradio'),reverseTheWay:tr.attr('witeoffother'),actualCollectionAmount:$yt_baseElement.rmoney(tr.attr('actualmoney')),reverseLoanAmount:$yt_baseElement.rmoney(tr.attr('thereversemoney')),loanAppId:tr.attr('choiceLoanDataValue')||null,paidAmount:tr.attr('otherPaidAmount')=='0'?'':$yt_baseElement.rmoney(tr.attr('otherPaidAmount')),remarks:tr.attr('otherspecial')==''?'':tr.attr('otherspecial')})});return list},setHeringOtherList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="payee-other-tr" otherPaidAmount="'+n.paidAmount+'" theReverseMoney="'+$yt_baseElement.rmoney(n.reverseLoanAmount)+'" actualMoney="'+$yt_baseElement.rmoney(n.actualCollectionAmount)+'" choiceLoanDataValue="'+n.loanAppId+'" pkid="" witeoffother="'+n.reverseTheWay+'" othermoney="'+n.otherName+'" otherallmoney="'+n.amount+'" otherradio="'+n.isContract+'" otherspecial="'+n.remarks+'"><td class="oth" value="Other">'+n.otherName+'</td><td style="text-align: right;" class="otherTotal">'+serveFunds.fmMoney(n.amount)+'</td><td>'+(n.reverseTheWayName||'无')+'</td><td class="loan-go">'+n.reverseLoanAmount+'</td><td>'+n.actualCollectionAmount+'</td><td>'+(n.isContract==1?'有':'无')+'</td><td class="otherPaidAmount-td" style="text-align:right;">'+(n.paidAmount==''?"0.00":$yt_baseElement.fmMoney(n.paidAmount))+'</td><td>'+(n.remarks?n.remarks:'')+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.amount});$('table.payee-other .payee-other-total').before(html).find('.payee-other-total-money').text($yt_baseElement.fmMoney(total))},showDetail:function(d){var me=this;var fmMoney=$yt_baseElement.fmMoney;if(d.jsFun){me[d.jsFun]()}serveFunds.saveData.advanceAppId=d.advanceAppId;serveFunds.saveData.expenditureAppId=d.expenditureAppId;if(d.advanceAppNum){$('.index-main-div .export-but').show();serveFunds.getAdvanceAppInfoDetailByAdvanceAppId(serveFunds.saveData.advanceAppId||'',true)}$('#advanceAppId').val(d.advanceAppId);$('.prior-approval').val(d.advanceAppNum).attr('costtype',d.costType);;if(d.advanceAppNum){$('#advanceAppBalance').text(d.advanceAppBalance?serveFunds.fmMoney(d.advanceAppBalance)+'元':'无');$('.advance-relevance').show()}$('#loanAppId').val(d.loanAppId);$('.borrow-money').val(d.loanAppNum);$('#outstandingBalance').text(fmMoney(d.loanAmount||'0'));$('#reimAppId').val(d.expenditureAppId);$('#reimAppNum').val(d.expenditureAppNum);$('#formNum').text(d.expenditureAppNum);$('#reimAppName').val(d.expenditureAppName);me.getCostTypeList(d.costType);var specialCodeArr=d.specialCode.split('-');var specialNameArr=d.specialName.split('-');me.setBudgetItme(specialCodeArr);if(d.prjName&&d.specialName!=''){$('.prj-name-tr').show();$('#prjName').val(d.prjName)}$('#invoiceNum').val(d.invoiceNum);$('#outstandingBalance').text(serveFunds.fmMoney(d.arrearsAmount));var outWriteAmount=d.totalAmount<=d.arrearsAmount?d.totalAmount:d.arrearsAmount;$('#outWriteAmount').text(serveFunds.fmMoney(outWriteAmount));$('#applyTotalMoney').text(fmMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$('#amountTotalMoney').text(fmMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$('#paymentList .total-money').text(fmMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$('#TotalMoneyUpper').text(arabiaToChinese(d.totalAmount+''));$('#writeOffAmount,#outWriteAmount').text(fmMoney(d.writeOffAmount||'0')).attr('num',d.writeOffAmount);$('#balanceMoney').text(serveFunds.fmMoney(d.totalAmount<d.arrearsAmount?d.arrearsAmount-d.totalAmount:'0'));$('#officialCard').val(fmMoney(d.officialCard||'0')).attr('num',d.officialCard);$('input.cash').val(fmMoney(d.cash||'0')).attr('num',d.cash);$('input.cheque').val(fmMoney(d.cheque||'0')).attr('num',d.cheque);var total= +d.officialCard+ +d.cash+ +d.cheque;var replaceMoney=total;$('#replaceMoney').text(serveFunds.fmMoney(replaceMoney));$('.amount-table .total').text(fmMoney(total||'0')).attr('num',total);$('#applicantTime').text(d.applicantTime);$('#operate-flow option[value="'+d.nodeNowState+'"]').attr('selected',true);$('#processInstanceId').val(d.processInstanceId);$('#approve-users option[value="'+d.currentAssignee+'"]').attr('selected',true);$('#operate-flow,#approve-users').niceSelect();me.showFileList(d.attList);me.showCostDetail(d.costData);me.setHeringUnitList(d.payReceivablesData.gatheringUnitList);me.setHeringPersonList(d.payReceivablesData.gatheringPersonList);me.setHeringOtherList(d.payReceivablesData.gatheringOtherList);},showCostDetail:function(data){var me=this;var costReceptionistList=data.costReceptionistList;me.setCostReceptionistList(costReceptionistList);var costDetailsList=data.costDetailsList;me.setCostDetailsList(costDetailsList);var tripPlanList=data.travelRouteList;me.setTravelRouteList(tripPlanList);var costCarfareList=data.costCarfareList;me.setCostCarfareList(costCarfareList);var costHotelList=data.costHotelList;me.setCostHotelList(costHotelList);var costOtherList=data.costOtherList;me.setCostOtherList(costOtherList);var costSubsidyList=data.costSubsidyList;me.setCostSubsidyList(costSubsidyList);me.setTrainApplyInfoList(data.trainApplyInfoList);me.setTeacherApplyInfoList(data.teacherApplyInfoList);me.setCostTrainApplyInfoList(data.costTrainApplyInfoList);me.setCostTeachersFoodApplyInfoList(data.costTeachersFoodApplyInfoList);me.setCostTeachersLectureApplyInfoList(data.costTeachersLectureApplyInfoList);me.setCostTeachersTravelApplyInfoList(data.costTeachersTravelApplyInfoList);me.setCostTeachersHotelApplyInfoList(data.costTeachersHotelApplyInfoList);me.setCostNormalList(data.costNormalList);me.setCostSpecialList(data.costSpecialList);me.setMeetingList(data.meetingList);me.setMeetingCostList(data.meetingCostList)},showFileList:function(list){var ls='';$.each(list,function(i,n){ls+='<div fId="'+n.attId+'" class="li-div"><span>'+n.attName+'</span><span class="del-file">x</span></div>'});$('#attIdStr').html(ls)},showBusinessFun:function(){var me=this;$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/hospitalitySpending.html');if($('.prior-approval').val()){$('.index-main-div .advance-relevance').show();serveFunds.getAdvanceAppInfoDetailByAdvanceAppId(serveFunds.saveData.advanceAppId||'')}$('.checkbox-div').show();$('#exportMst').on('click',function(){if(me.verifyCostTypeExport()){var costReceptionistList=me.beforeCostList.costData.costReceptionistList;me.setCostReceptionistList(costReceptionistList,true)}else{$yt_alert_Model.prompt('事前申请单单据样式不符，无法导入')}});$('#exportPayment').on('click',function(){if(me.verifyCostTypeExport()){var costDetailsList=me.beforeCostList.costData.costDetailsList;me.setCostDetailsList(costDetailsList,true);hospitalitySpending.getTotleMoney()}else{$yt_alert_Model.prompt('事前申请单单据样式不符，无法导入')}});$('.count-val-num,#amountTotalMoney').text('0.00');$('#TotalMoneyUpper').text('--');serveFunds.setReimFundMoney();$("#payTaxesDiv").hide();$("#payTeacherAllDiv").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").hide();$("#advanceApplication").show();$("#payeeInformation").show();$("#approveDiv").show();$("#submitPayment").text("提交并打印单据粘贴单");$(".budget-items").show();sysCommon.getApproveFlowData("SZ_EXPENDITURE_APP",'','{posCode:"'+serveFunds.parCode+'"}');$("#budget-item-one").attr('validform','{isNull:true,msg:\'请选择所属预算项目\',changeFlag:true}')},showGeneralFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$('.business-div .msg-list tbody').empty();$('.business-div #paymentList tbody tr:not(.last)').remove();$('.business-div #paymentList tbody .total-money').text('0.00');$('.travel-div #tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num,#amountTotalMoney').text('0.00');$('#TotalMoneyUpper').text('--');serveFunds.setReimFundMoney();$("#payTaxesDiv").hide();$("#payTeacherAllDiv").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").hide();$("#advanceApplication").hide();$(".advance-file-div").hide();$("#costSpending").show();$("#socialSecurity").hide();$("#payeeInformation").show();$("#approveDiv").show();$("#submitPayment").text("提交并打印单据粘贴单");$(".budget-items").show();sysCommon.getApproveFlowData("SZ_EXPENDITURE_APP",'','{posCode:"'+serveFunds.parCode+'"}');$("#budget-item-one").attr('validform','{isNull:true,msg:\'请选择所属预算项目\',changeFlag:true}');$(".prior-approval").removeAttr('validform')},showTravelFun:function(){var me=this;$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/travelSpending.html');if($('.prior-approval').val()){$('.index-main-div .advance-relevance').show();serveFunds.getAdvanceAppInfoDetailByAdvanceAppId(serveFunds.saveData.advanceAppId||'')}$('.checkbox-div').show();$('#exportTrip').on('click',function(){if(me.verifyCostTypeExport()){var list=me.beforeCostList.costData.travelRouteList;me.setTravelRouteList(list,true)}else{$yt_alert_Model.prompt('事前申请单单据样式不符，无法导入')}});$('#exportTravel').on('click',function(){if(me.verifyCostTypeExport()){var costCarfareList=me.beforeCostList.costData.costCarfareList;me.setCostCarfareList(costCarfareList,true);var costHotelList=me.beforeCostList.costData.costHotelList;me.setCostHotelList(costHotelList,true);var costOtherList=me.beforeCostList.costData.costOtherList;me.setCostOtherList(costOtherList,true);var costSubsidyList=me.beforeCostList.costData.costSubsidyList;me.setCostSubsidyList(costSubsidyList,true);me.updateApplyMeonySum()}else{$yt_alert_Model.prompt('事前申请单单据样式不符，无法导入')}});$('.business-div .msg-list tbody').empty();$('.business-div #paymentList tbody tr:not(.last)').remove();$('.business-div #paymentList tbody .total-money').text('0.00');$('.count-val-num,#amountTotalMoney').text('0.00');$('#TotalMoneyUpper').text('--');serveFunds.setReimFundMoney();$("#payTaxesDiv").hide();$("#payTeacherAllDiv").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").hide();$("#advanceApplication").show();$("#payeeInformation").show();$("#approveDiv").show();$("#submitPayment").text("提交并打印单据粘贴单");$(".budget-items").show();sysCommon.getApproveFlowData("SZ_EXPENDITURE_APP",'','{posCode:"'+serveFunds.parCode+'"}');$("#budget-item-one").attr('validform','{isNull:true,msg:\'请选择所属预算项目\',changeFlag:true}');$(".prior-approval").attr('validform','{isNull:true,msg:\'请选择事前申请单\',changeFlag:true}')},showTrainFun:function(){var me=this;$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/beforehand/trainingFeeApply.html');$("#predictCostDiv").hide();$("#preTaxDiv").hide();$("#payTeacherAllDiv").show();if($('.prior-approval').val()){$('.index-main-div .export-but').show();serveFunds.getAdvanceAppInfoDetailByAdvanceAppId(serveFunds.saveData.advanceAppId||'')}me.getTrainingTypeOption();$('#trainDetails').click(function(){if(me.verifyCostTypeExport()){var list=me.beforeCostList.costData.trainApplyInfoList;me.setTrainApplyInfoList(list,true)}else{$yt_alert_Model.prompt('事前申请单单据样式不符，无法导入')}});$('#exportLecturer').click(function(){if(me.verifyCostTypeExport()){var list=me.beforeCostList.costData.teacherApplyInfoList;me.setTeacherApplyInfoList(list,true)}else{$yt_alert_Model.prompt('事前申请单单据样式不符，无法导入')}});$('#exportCostApp').click(function(){if(me.verifyCostTypeExport()){var data=me.beforeCostList.costData;me.setTeacherApplyInfoList(data.teacherApplyInfoList);me.setCostTeachersFoodApplyInfoList(data.costTeachersFoodApplyInfoList,true);me.setCostTeachersLectureApplyInfoList(data.costTeachersLectureApplyInfoList,true);me.setCostTeachersTravelApplyInfoList(data.costTeachersTravelApplyInfoList,true);me.setCostTeachersHotelApplyInfoList(data.costTeachersHotelApplyInfoList,true);personnelFunds.updateTotalNum();}else{$yt_alert_Model.prompt('事前申请单单据样式不符，无法导入')}});$('#importTrainingOther').click(function(){if(me.verifyCostTypeExport()){var data=me.beforeCostList.costData;me.setCostTrainApplyInfoList(data.costTrainApplyInfoList,true);personnelFunds.updateTotalNum()}else{$yt_alert_Model.prompt('事前申请单单据样式不符，无法导入')}});$("#travelRadio").hide();$("#budgetProjectTd").hide();$('.business-div .msg-list tbody').empty();$('.business-div #paymentList tbody tr:not(.last)').remove();$('.business-div #paymentList tbody .total-money').text('0.00');$('.travel-div #tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num,#amountTotalMoney').text('0.00');$('#TotalMoneyUpper').text('--');serveFunds.setReimFundMoney();$("#predictCostAlert").hide();$("#payTaxesDiv").show();$("#predictSpan").hide();$("#doAdvanceBox").show();$("#deductBudgetDiv").hide();$("#advanceApplication").show();$("#payeeInformation").show();$("#approveDiv").show();$("#submitPayment").text("提交并打印单据粘贴单");$(".budget-items").show();sysCommon.getApproveFlowData("SZ_EXPENDITURE_APP",'','{posCode:"'+serveFunds.parCode+'"}');$("#budget-item-one").attr('validform','{isNull:true,msg:\'请选择所属预算项目\',changeFlag:true}');$(".prior-approval").attr('validform','{isNull:true,msg:\'请选择事前申请单\',changeFlag:true}')},showMettingFun:function(){var me=this;$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/beforehand/meetingCostApply.html');if($('.prior-approval').val()){$('.index-main-div .export-but').show();serveFunds.getAdvanceAppInfoDetailByAdvanceAppId(serveFunds.saveData.advanceAppId||'')}me.getMeetingTypeCode();$('#exportMeetDeta').on('click',function(){if(me.verifyCostTypeExport()){var list=me.beforeCostList.costData.meetingList;me.setMeetingList(list,true)}else{$yt_alert_Model.prompt('事前申请单单据样式不符，无法导入')}});$('#exportMeetCost').on('click',function(){if(me.verifyCostTypeExport()){var list=me.beforeCostList.costData.meetingCostList;me.setMeetingCostList(list,true)}else{$yt_alert_Model.prompt('事前申请单单据样式不符，无法导入')}});$("#travelRadio").hide();$("#payTaxesDiv").hide();$("#payTeacherAllDiv").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").hide();$("#advanceApplication").show();$("#payeeInformation").show();$("#approveDiv").show();$("#submitPayment").text("提交并打印单据粘贴单");$(".budget-items").show();sysCommon.getApproveFlowData("SZ_EXPENDITURE_APP",'','{posCode:"'+serveFunds.parCode+'"}');$("#budget-item-one").attr('validform','{isNull:true,msg:\'请选择所属预算项目\',changeFlag:true}');$(".prior-approval").attr('validform','{isNull:true,msg:\'请选择事前申请单\',changeFlag:true}')},showSheBaoFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$('.business-div .msg-list tbody').empty();$('.business-div #paymentList tbody tr:not(.last)').remove();$('.business-div #paymentList tbody .total-money').text('0.00');$('.travel-div #tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num,#amountTotalMoney').text('0.00');$('#TotalMoneyUpper').text('--');serveFunds.setReimFundMoney();$("#payTaxesDiv").hide();$("#travelRadio").hide();$("#payTeacherAllDiv").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$("#payeeInformation").hide();$("#approveDiv").show();$("#submitPayment").text("提交");$(".budget-items").show();serveFunds.setBudgetItme();$('.budget-item-three').empty();$('#prjName').val('');$('.prj-name-tr').hide();$("#workflowCode").val("SBJF_APP_FLOW");sysCommon.getApproveFlowData("SZ_SBJF_APP",'','{posCode:"'+serveFunds.parCode+'"}');$("#budget-item-one").attr('validform','{isNull:true,msg:\'请选择所属预算项目\',changeFlag:true}');$(".prior-approval").removeAttr('validform')},showWithMoneyFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$('.business-div .msg-list tbody').empty();$('.business-div #paymentList tbody tr:not(.last)').remove();$('.business-div #paymentList tbody .total-money').text('0.00');$('.travel-div #tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num,#amountTotalMoney').text('0.00');$('#TotalMoneyUpper').text('--');serveFunds.setReimFundMoney();$("#payTaxesDiv").hide();$("#travelRadio").hide();$("#payTeacherAllDiv").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").hide();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$("#payeeInformation").show();$(".deductBudgetAmountTr").hide();$("#approveDiv").show();$("#submitPayment").text("提交并打印单据粘贴单");$(".budget-items").hide();serveFunds.setBudgetItme();$('.budget-item-three').empty();$('#prjName').val('');$('.prj-name-tr').hide();$("#workflowCode").val("WLKX_APP_FLOW");sysCommon.getApproveFlowData("SZ_WLKX_APP",'','{posCode:"'+serveFunds.parCode+'"}');$("#budget-item-one").removeAttr('validform');$(".prior-approval").removeAttr('validform')},showYingJiaoFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$('.business-div .msg-list tbody').empty();$('.business-div #paymentList tbody tr:not(.last)').remove();$('.business-div #paymentList tbody .total-money').text('0.00');$('.travel-div #tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num,#amountTotalMoney').text('0.00');$('#TotalMoneyUpper').text('--');serveFunds.setReimFundMoney();$("#payTaxesDiv").hide();$("#payTeacherAllDiv").hide();$("#travelRadio").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$("#payeeInformation").hide();$("#approveDiv").show();$("#submitPayment").text("提交");$(".budget-items").show();$("#workflowCode").val("YJSF_APP_FLOW");sysCommon.getApproveFlowData("SZ_YJSF_APP",'','{posCode:"'+serveFunds.parCode+'"}');$("#budget-item-one").attr('validform','{isNull:true,msg:\'请选择所属预算项目\',changeFlag:true}');$(".prior-approval").removeAttr('validform')},showYiLiaoFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$('.business-div .msg-list tbody').empty();$('.business-div #paymentList tbody tr:not(.last)').remove();$('.business-div #paymentList tbody .total-money').text('0.00');$('.travel-div #tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num,#amountTotalMoney').text('0.00');$('#TotalMoneyUpper').text('--');serveFunds.setReimFundMoney();$("#payTaxesDiv").hide();$("#payTeacherAllDiv").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").hide();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$("#payeeInformation").show();$("#approveDiv").show();$("#submitPayment").text("提交并打印单据粘贴单");$("#workflowCode").val("YYF_APP_FLOW");sysCommon.getApproveFlowData("SZ_YYF_APP",'','{posCode:"'+serveFunds.parCode+'"}');$("#budget-item-one").attr('validform','{isNull:true,msg:\'请选择所属预算项目\',changeFlag:true}');$(".prior-approval").removeAttr('validform')},showGongHuiFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$('.business-div .msg-list tbody').empty();$('.business-div #paymentList tbody tr:not(.last)').remove();$('.business-div #paymentList tbody .total-money').text('0.00');$('.travel-div #tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num,#amountTotalMoney').text('0.00');$('#TotalMoneyUpper').text('--');serveFunds.setReimFundMoney();$("#payTaxesDiv").hide();$("#payTeacherAllDiv").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").hide();$(".advance-file-div").hide();$(".deductBudgetAmountTr").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$("#payeeInformation").show();$("#approveDiv").show();$("#submitPayment").text("提交并打印单据粘贴单");$(".budget-items").hide();serveFunds.setBudgetItme();$('.budget-item-three').empty();$('#prjName').val('');$('.prj-name-tr').hide();$("#workflowCode").val("GHJF_APP_FLOW");sysCommon.getApproveFlowData("SZ_GHJF_APP",'','{posCode:"'+serveFunds.parCode+'"}');$("#budget-item-one").removeAttr('validform');$(".prior-approval").removeAttr('validform')},showDangJianFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$('.business-div .msg-list tbody').empty();$('.business-div #paymentList tbody tr:not(.last)').remove();$('.business-div #paymentList tbody .total-money').text('0.00');$('.travel-div #tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num,#amountTotalMoney').text('0.00');$('#TotalMoneyUpper').text('--');serveFunds.setReimFundMoney();$("#payTaxesDiv").hide();$(".deductBudgetAmountTr").hide();$("#payTeacherAllDiv").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").hide();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$("#payeeInformation").show();$("#approveDiv").show();$("#submitPayment").text("提交并打印单据粘贴单");$(".budget-items").hide();serveFunds.setBudgetItme();$('.budget-item-three').empty();$('#prjName').val('');$('.prj-name-tr').hide();$("#workflowCode").val("DJJF_APP_FLOW");sysCommon.getApproveFlowData("SZ_DJJF_APP",'','{posCode:"'+serveFunds.parCode+'"}');$("#budget-item-one").removeAttr('validform');$(".prior-approval").removeAttr('validform')},showKouChuFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/reimApply/costDetail.html');$('.business-div .msg-list tbody').empty();$('.business-div #paymentList tbody tr:not(.last)').remove();$('.business-div #paymentList tbody .total-money').text('0.00');$('.travel-div #tripList tbody').empty();$('#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody').empty();$('.count-val-num,#amountTotalMoney').text('0.00');$('#TotalMoneyUpper').text('--');serveFunds.setReimFundMoney();$("#payTaxesDiv").hide();$("#payTeacherAllDiv").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$("#payeeInformation").hide();$("#approveDiv").hide();$("#submitPayment").text("提交");$(".budget-items").show();$("#budget-item-one").attr('validform','{isNull:true,msg:\'请选择所属预算项目\',changeFlag:true}');$(".prior-approval").removeAttr('validform')},busiTripUserModelEvent:function(busiInputObj,autoFontObj,userNumObj,clickFlag){var me=this;var busiTripUserModel=$("#busiTripUserModel");$("#searchUser").off().on("click",function(){me.getBusiTripUsersList($("#userPram").val())});$("#userPram").on("keyup",function(){me.getBusiTripUsersList($(this).val())});$("#busiUserInfo ul li").off("click").on("click",function(){var usersDatas="";if($(this).hasClass("tr-check")){$(this).removeClass("tr-check");me.selUsersName="";me.selUsersCode="";$("#busiUserInfo ul li.tr-check").each(function(i,n){usersDatas=$(this).data("userData");me.selUsersName+=usersDatas.userName+"、";me.selUsersCode+=usersDatas.userItcode+","})}else{$(this).addClass("tr-check");usersDatas=$(this).data("userData");me.selUsersName+=usersDatas.userName+"、";me.selUsersCode+=usersDatas.userItcode+",";var checkUsersCodes="";$("#tripList tbody .hid-user-code").each(function(){checkUsersCodes+=$(this).val()+","});var selUsersCode=","+usersDatas.userItcode+",";if(checkUsersCodes!=""&&checkUsersCodes!=undefined){checkUsersCodes=","+checkUsersCodes}if(checkUsersCodes.indexOf(selUsersCode)<0){var userLevel=usersDatas.jobLevelName=="--"?"":usersDatas.jobLevelName;me.usersInfoList=me.usersInfoList+'{"userItcode":"'+usersDatas.userItcode+'","jobLevelName":"'+usersDatas.jobLevelName+'","userName":"'+usersDatas.userName+'"},'}}var selTr=$("#busiUserInfo ul li.tr-check");if(selTr!=""&&selTr.length>0){var selUser="";var userCode="";selUser=me.selUsersName.substring(0,me.selUsersName.length-1);userCode=me.selUsersCode.substring(0,me.selUsersCode.length-1);$(busiInputObj).val(selUser);$(busiInputObj).prev("input[type=hidden]").val(userCode);$(autoFontObj).hide();$(userNumObj).show();var userNums=selUser.split("、");$(userNumObj).find(".users-num").text(userNums.length);sysCommon.clearValidInfo(busiInputObj);$("#clearUser").show()}else{$(busiInputObj).val('');$(busiInputObj).prev("input[type=hidden]").val('');$(autoFontObj).show();$(userNumObj).hide();$(userNumObj).find(".users-num").text(0);$(busiInputObj).next(".valid-font").text("请选择出差人");$(busiInputObj).addClass("valid-hint");me.selUsersName="";me.selUsersCode="";me.usersInfoList="";me.usersInfoJson="";var optionText='<option value="">请选择</option>';$("#clearUser").hide()}});$("#clearUser").click(function(){$(busiInputObj).val('');$(busiInputObj).prev("input[type=hidden]").val('');$(autoFontObj).show();$(userNumObj).hide();$(userNumObj).find(".users-num").text(0);$(busiInputObj).next(".valid-font").text("请选择出差人");$(busiInputObj).addClass("valid-hint");me.selUsersName="";me.selUsersCode="";me.usersInfoList="";me.usersInfoJson="";var optionText='<option value="">请选择</option>';$("#busiUserInfo ul li").removeClass("tr-check")});$("#busiUserInfo").mouseleave(function(){$(this).hide();$(this).addClass("check")})},getBusiTripUsersList:function(keyword){var me=this;$.ajax({type:"post",url:'user/userInfo/getAllUserInfoToPage',async:true,data:{params:keyword,pageIndex:1,pageNum:99999},success:function(data){if(data.flag==0){$("#busiUserInfo ul").empty();var liStr="";var opts='';if(data.data.rows.length>0){serveFunds.payeeUserList=data.data.rows;$.each(data.data.rows,function(i,n){liStr=$('<li>'+n.userName+'/'+n.deptName+'</li>');opts+='<option value="'+n.userItcode+'">'+n.userName+'</option>';liStr.data("userData",n);$("#busiUserInfo ul").append(liStr)});if($("#modelUserCodes").val()){var usersCodes=$("#modelUserCodes").val().split(",");$("#busiUserInfo ul li").each(function(i,t){$.each(usersCodes,function(i,l){if($(t).data("userData").userItcode==l){$(t).addClass("tr-check")}})})}me.busiTripUserModelEvent($("#modelBusiUser"),$("#busiPlanEditModel .auto-font"),$(".model-user-num-show"),1);me.setPayeeNameSelect()}else{$("#busiUserInfo ul").append('<li style="text-align: center;">暂无数据</li>')}}}})},setPayeeNameSelect:function(code){var me=this;var payeeName=$('#payeeName');payeeName.attr('validform','{isNull:true,blurFlag:true,msg:\'请输入收款人姓名\'}');payeeName.html('<option value="">请选择</option>');$.each(serveFunds.payeeUserList,function(i,n){payeeName.append('<option userName="'+n.userName+'" jobLevelName="'+n.jobLevelName+'" deptName="'+n.deptName+'" value="'+n.userItcode+'">'+n.userName+'/'+n.deptName+'/'+n.jobName+'</option>')});payeeName.append('<option userName="" value="external">外部人员</option>');if(code){payeeName.find('option[value="'+code+'"]').attr('selected','selected');payeeName.next().find(".current").text($('#payeeName option[value="'+code+'"]').attr("username"));payeeName.next().find(".search-current").val($('#payeeName option:selected').attr("username")==undefined?"请选择":$('#payeeName option:selected').attr("username"))}me.payeeKeyText='';payeeName.niceSelect({search:true,backFunction:function(text){payeeName.html('');if(text==""){payeeName.html('<option value="">请选择</option>')}else{payeeName.parent().find('.valid-font').text('');me.payeeKeyText=text}$.each(serveFunds.payeeUserList,function(i,n){if(n.userName.indexOf(text)!=-1){payeeName.append('<option userName="'+n.userName+'" jobLevelName="'+n.jobLevelName+'" deptName="'+n.deptName+'" value="'+n.userItcode+'">'+n.userName+'/'+n.deptName+'/'+n.jobName+'</option>')}else{}});payeeName.append('<option  userName="" value="external">外部人员</option>');if(payeeName.find('option').length==1&&$('payeeName option[value="external"]')){payeeName.html('<option value="noUser" disabled="disabled">没有找到匹配的单位内部人员</option><option  userName="" value="external">外部人员</option>')}if(payeeName.find('option').length==2&&$('payeeName option[value="noUser"]')){}},optionCallBcak:function(opt){if(opt.attr('data-value')=='external'){payeeName.next().find('.search-current').val(me.payeeKeyText);payeeName.attr('validform','{}');$('.busi-card-tr').hide()}else{payeeName.attr('validform','{isNull:true,blurFlag:true,msg:\'请输入收款人姓名\'}');payeeName.next().find(".current").text($('#payeeName option:selected').attr("username"));payeeName.next().find(".search-current").val($('#payeeName option:selected').attr("username")==undefined?"请选择":$('#payeeName option:selected').attr("username"));$('.busi-card-tr').show()}}});payeeName.next().find(".current").text($('#payeeName option:selected').attr("username"));payeeName.next().find(".search-current").val($('#payeeName option:selected').attr("username")==undefined?"请选择":$('#payeeName option:selected').attr("username"))},hotelAddressChild:function(addressCode,addressLevel){var me=this;$("#hotelTwoAddres").niceSelect({search:true,backFunction:function(text){$("#hotelTwoAddres option").remove();if(text==""){$("#hotelTwoAddres").append('<option value="">请选择</option>')}$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1&&n.parentCode==addressCode&&addressLevel=="CITY"){$("#hotelTwoAddres").append('<option value="'+n.regionCode+'">'+n.regionName+'</option>')}})}});},hotelAddressArea:function(addressCode,addressLevel){var me=this;$("#hotelChildAddres").niceSelect({search:true,backFunction:function(text){$("#hotelChildAddres option").remove();if(text==""){$("#hotelChildAddres").append('<option value="">请选择</option>')}$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1&&n.parentCode==addressCode&&addressLevel=="AREA"){$("#hotelChildAddres").append('<option value="'+n.regionCode+'">'+n.regionName+'</option>')}})}});},setAddress:function(){var me=this;$.ajax({type:"get",url:$yt_option.websit_path+'resources-sasac/js/system/expensesReim/module/reimApply/regionList.json',async:false,success:function(data){me.addressList=data;me.setAddressSelect()}})},setAddressSelect:function(){var me=this;$("#hotelParentAddress").niceSelect({search:true,backFunction:function(text){$("#hotelParentAddress option").remove();if(text==""){$("#hotelParentAddress").append('<option value="">请选择</option>')}$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1&&n.regionLevel=='PROVINCE'){$("#hotelParentAddress").append('<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" >'+n.regionName+'</option>')}})}});$("#hotelParentAddress").off("change").on("change",function(){var thisSel=$(this);$("#hotelTwoAddres,#hotelChildAddres").html('').append('<option value="">请选择</option>');me.hotelAddressChild(thisSel.val(),"CITY")});$("#hotelTwoAddres").off("change").on("change",function(){var thisSel=$(this);$("#hotelChildAddres").html('').append('<option value="">请选择</option>');me.hotelAddressArea(thisSel.val(),"AREA")});me.getPlanBusiAddress($("#modelBusiAddres"))},hotelChildDisa:function(addressCode,addressLevel){var me=this;if(addressLevel=="CITY"){var disaFlag=true;if($("#hotelTwoAddres option").length<1){$("#hotelTwoAddres,#hotelChildAddres").prop("disabled","disabled");$("#hotelTwoAddres,#hotelChildAddres").removeAttr("validform");sysCommon.clearValidInfo($("div.hotel-child-addres,div.hotel-two-addres,#hotelTwoAddres,#hotelChildAddres"))}else{$("#hotelTwoAddres,#hotelChildAddres").prop("disabled","");$("#hotelTwoAddres").attr("validform","{isNull:true,changeFlag:true,msg:'请选择市'}");$("#hotelChildAddres").attr("validform","{isNull:true,changeFlag:true,msg:'请选择区'}");disaFlag=false}me.hotelAddressChild(addressCode,addressLevel);me.hotelAddressArea(addressCode,addressLevel);if(disaFlag){$("div.hotel-child-addres,div.hotel-two-addres").css("background-color","#D0D0D0")}}else if(addressLevel=="AREA"){var disaFlag=true;if($("#hotelChildAddres option").length<1){$("#hotelChildAddres").prop("disabled","disabled")}else{$("#hotelChildAddres").prop("disabled","");disaFlag=false}me.hotelAddressArea(addressCode,addressLevel);if(disaFlag){$("div.hotel-child-addres").css("background-color","#D0D0D0")}}},getModelUsersInfo:function(){var me=this;if(me.usersInfoList!=""&&me.usersInfoList!=null){me.usersInfoJson="["+me.usersInfoList+"]";me.usersInfoJson=me.usersInfoJson.substr(0,me.usersInfoJson.length-2);me.usersInfoJson+="]"}var optionText='<option value="">请选择</option>';$("#model-trip-user,#hotel-trip-user").empty().append(optionText);if(me.usersInfoJson!=""&&me.usersInfoJson.length>0){var list=eval("("+me.usersInfoJson+")");$.each(list,function(i,n){optionText='<option value="'+n.userItcode+'" data-level="'+n.jobLevelName+'" data-level-code="'+n.jobLevelCode+'">'+n.userName+'</option>';$("#model-trip-user,#hotel-trip-user").append(optionText)})}$("#model-trip-user,#hotel-trip-user").niceSelect()},setModelUsers:function(){var userStr='';var trs=$('#tripList tbody tr');trs.each(function(i,n){var ls=$(n).attr('usercode').split(',');$.each(ls,function(j,m){if(userStr.indexOf(m)<0){userStr+=m+','}})});userStr=(userStr.substring(userStr.length-1)==',')?userStr.substring(0,userStr.length-1):userStr;if(userStr){var userList=sysCommon.getUserAllInfo('',userStr,'');var opts='<option value="">请选择</option>';$.each(userList,function(i,n){opts+='<option value="'+n.userItcode+'" data-level="'+n.jobLevelName+'"  data-level-code="'+n.jobLevelCode+'">'+n.userName+'</option>'});$("#model-trip-user,#hotel-trip-user").html(opts).niceSelect()}},updateApplyMeonySum:function(){var sumMoney=0;$(".cost-list-model table .money-sum").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});$(".cost-list-model table .city-money-td").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});$('#subsidy-list-info tbody tr:not(.last)').each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).find('.food').text());sumMoney+=$yt_baseElement.rmoney($(n).find('.traffic').text())});var rMoney=$yt_baseElement.fmMoney(sumMoney);$("#applyTotalMoney").text(rMoney).attr('num',sumMoney);if($("body").find("#reimPrice")){$("#reimPrice").text(rMoney);var loanPrice=$("#loanCost").text();var replPrice=sumMoney-parseFloat(loanPrice);replPrice=$yt_baseElement.fmMoney(replPrice);$("#givePrice").text(replPrice)}if(sumMoney!=null&&sumMoney!=undefined&&sumMoney>0){var sumMoneyLower=arabiaToChinese(rMoney+'');$("#TotalMoneyUpper").text(sumMoneyLower)}else{$("#applyTotalMoney").text("0.00")}$('#amountTotalMoney').text(rMoney).attr('num',sumMoney);var outstandingBalance=serveFunds.rmoney($('#outstandingBalance').text());var writeOffAmount=sumMoney>=outstandingBalance?outstandingBalance:sumMoney;$('#writeOffAmount,#outWriteAmount').text(serveFunds.fmMoney(writeOffAmount));var replaceMoney=sumMoney>=outstandingBalance?sumMoney-writeOffAmount:'0';$('#replaceMoney').text(serveFunds.fmMoney(replaceMoney));$('#balanceMoney').text(serveFunds.fmMoney(sumMoney<outstandingBalance?outstandingBalance-sumMoney:'0'))},updateMoneySum:function(thisTab){var me=this;var moenySum=0.00;if(thisTab==0){$("#traffic-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#traffic-list-info tbody .money-sum").text(moenySum)}else{$("#traffic-list-info tbody .money-sum").text("0.00")}}if(thisTab==1){$("#hotel-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#hotel-list-info tbody .money-sum").text(moenySum)}else{$("#hotel-list-info tbody .money-sum").text("0.00")}}if(thisTab==2){$("#other-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#other-list-info tbody .money-sum").text(moenySum)}else{$("#other-list-info tbody .money-sum").text("0.00")}}if(thisTab==3){$("#subsidy-list-info tbody .food-money").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#subsidy-list-info tbody .money-sum").text(moenySum)}else{$("#subsidy-list-info tbody .money-sum").text("0.00")}var cityMoneySum=0.00;$("#subsidy-list-info tbody .city-money").each(function(i,n){cityMoneySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});cityMoneySum=$yt_baseElement.fmMoney(cityMoneySum);if(cityMoneySum!=undefined&&$yt_baseElement.rmoney(cityMoneySum)>0){$("#subsidy-list-info tbody .city-money-td").text(cityMoneySum)}else{$("#subsidy-list-info tbody .city-money-td").text("0.00")}}me.updateApplyMeonySum()},setSubsidyList:function(){var me=this;var userStr='';var trs=$('#tripList tbody tr');trs.each(function(i,n){var ls=$(n).attr('usercode').split(',');$.each(ls,function(j,m){if(userStr.indexOf(m)<0){userStr+=m+','}})});userStr=(userStr.substring(userStr.length-1)==',')?userStr.substring(0,userStr.length-1):userStr;var userList=sysCommon.getUserAllInfo('',userStr,'');var html='';$.each(userList,function(i,n){html+='<tr class="'+n.userItcode+'" code="'+n.userItcode+'"><td><div class="user" code="'+n.userItcode+'">'+n.userName+'</div></td><td><div class="lv">'+n.jobLevelName+'</div></td><td><div class="subsidy-num">0</div></td><td><div style="text-align:right;" class="food">0.00</div></td><td><div  style="text-align:right;" class="traffic">0.00</div></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});html+='<tr class="last"><td>合计</td><td></td><td></td><td class="total-food"  style="text-align:right;">0.00</td><td class="total-traffic"  style="text-align:right;">0.00</td><td></td></tr>';var jqHtml=$(html);var code='',tr=[],jqTr=[],day=0,totalFood=0,totalTraffic=0;$.each(trs,function(i,n){tr=$(n);codeList=tr.attr('usercode').length>0?tr.attr('usercode').split(','):[];day= +tr.find('.day').text();$.each(codeList,function(j,m){jqTr=jqHtml.siblings('[code="'+m+'"]');if(jqTr.length>0){var d= +(jqTr.find('.subsidy-num').text())+day;jqTr.find('.subsidy-num').text(d);jqTr.find('.food').text($yt_baseElement.fmMoney(d*100)).attr('num',d*100);jqTr.find('.traffic').text($yt_baseElement.fmMoney(d*80)).attr('num',d*80)}})});jqHtml.find('.total-food').text($yt_baseElement.fmMoney(totalFood)).attr('num',totalFood);jqHtml.find('.total-traffic').text($yt_baseElement.fmMoney(totalTraffic)).attr('num',totalTraffic);$('#subsidy-list-info tbody').html(jqHtml);me.setSubsidyTotal();me.updateMoneySum()},appendSubdisyList:function(tr){var me=this;var subsidyBusinUser=$('#subsidyBusinUser').text();var subsidyBusinLevel=$('#subsidyBusinLevel').text();var subsidiesDays=$('#subsidiesDays').val();var subsidiesFood=$('#subsidiesFood').val();var subsidiesTraffic=$('#subsidiesTraffic').val();tr.find('.subsidy-num').text(subsidiesDays);tr.find('.food').text(subsidiesFood);tr.find('.traffic').text(subsidiesTraffic);me.setSubsidyTotal();me.updateMoneySum();me.hideSubsidiesAlert()},setSubsidyTotal:function(){var trs=$('#subsidy-list-info tbody tr:not(.last)');var totalFood=0,totalTraffic=0,tr=[];$.each(trs,function(i,n){tr=$(n);totalFood+= +(serveFunds.rmoney(tr.find('.food').text()));totalTraffic+= +(serveFunds.rmoney(tr.find('.traffic').text()))});$('#subsidy-list-info tbody .total-food').text($yt_baseElement.fmMoney(totalFood)).attr('num',totalFood);$('#subsidy-list-info tbody .total-traffic').text($yt_baseElement.fmMoney(totalTraffic)).attr('num',totalTraffic)},clearFormData:function(){var me=this;var modelObj=$("#costApplyAlert");$(".traffic-form input:not(.hid-risk-code),.hotel-form input:not(.hid-risk-code),.other-form input:not(.hid-risk-code)").val('');modelObj.find("textarea").val('');modelObj.find("select").each(function(i,n){$(n).find("option:eq(0)").attr("selected","selected")});$("#vehicleTwoDiv").hide();modelObj.find("#hotelParentAddress,#hotelTwoAddres,#hotelChildAddres,#fromcity,#tocity").html('<option value="">请选择</option>');modelObj.find("select").niceSelect();modelObj.find(".hotel-num").text("自动计算").css("color","#999999");modelObj.find("#peoDayMoney").text("0.00");modelObj.find("#hotelDay").text("*");$("#costApplyAlert .cost-type-tab ul li").removeClass("tab-check");$("#costApplyAlert .cost-type-tab ul li:eq(0)").addClass("tab-check");$(".traffic-form").show();$(".hotel-form,.other-form").hide();$("#model-add-list-btn").show();$("#model-sure-btn").hide();modelObj.find(".valid-font").text("");modelObj.find(".valid-hint").removeClass("valid-hint");serveFunds.setAddress();me.getPlanBusiAddress($("#fromcity"));me.getPlanBusiAddress($("#tocity"))},getPlanBusiAddress:function(labelObj){var me=this;$(labelObj).niceSelect({search:true,backFunction:function(text){$(labelObj).find("option").remove();var opt='';if(text==""){$.each(me.addressList,function(i,n){if(n.regionLevel=="PROVINCE"){opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'</option>'}})}else{$.each(me.addressList,function(i,n){if(n.regionName.indexOf(text)!=-1){opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'/'+n.regionMergerName.substr(3)+'</option>'}if(n.regionNamePinYin.indexOf(text)!=-1){opt+='<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" data-name="'+n.regionName+'">'+n.regionName+'/'+n.regionMergerName.substr(3)+'</option>'}})}$(labelObj).append(opt)}})},getAdvanceAppInfoDetailByAdvanceAppId:function(id,upDate){$.ajax({type:"post",url:"sz/advanceApp/getAdvanceExpenditureAppInfoDetail",async:true,data:{advanceAppId:id},success:function(data){if(data.flag==0){serveFunds.beforeCostList=data.data;serveFunds.advanceDataFilling();serveFunds.exportBeforeFiles(data.data.attList)}}})},exportBeforeFiles:function(files){if(files.length>0){var ls='';var src='';$.each(files,function(i,n){var imgType=n.attName.split('.');if(imgType.length>1&&(imgType[1]=='png'||imgType[1]=='jpeg'||imgType[1]=='bmp'||imgType[1]=='jpg')){src=$yt_option.base_path+'fileUpDownload/download?pkId='+n.attId+'&isDownload=false';ls+='<div fid="'+n.attId+'" class="li-div export"><span class="file-name" >'+n.attName+'</span><label class="file-pv">预览<img src="'+src+'" ></label><label class="file-dw">下载</label></div>'}else{ls+='<div fid="'+n.attId+'" class="li-div export"><span class="file-name" >'+n.attName+'</span><label class="file-pvno">预览</label><label class="file-dw">下载</label></div>'}});$('#advanceIdStr').html(ls);$('#advanceIdStr .file-dw').off().on('click',function(){var id=$(this).parent().attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'});$('#advanceIdStr .file-pv img').showImg()}else{$('#advanceIdStr').html('<div class="li-div"><span>暂无附件</span></div>')}},setCostReceptionistList:function(costReceptionistList,exports){var me=this;var receHtml='';$.each(costReceptionistList,function(i,n){receHtml+='<tr pkId="'+n.costReceptionistId+'" class="'+(exports?'exports':'')+'" applyname="'+n.name+'" duties="'+n.jobName+'" unit="'+n.unitName+'"><td><span class="num">1</span></td><td><span class="name-text">'+n.name+'</span></td><td><span class="job-text">'+n.jobName+'</span></td><td><span class="unit-text">'+n.unitName+'</span></td><td><span class="receive-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="receive-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('.msg-list tbody').append(receHtml);me.resetNum($('.msg-list'))},setCostDetailsList:function(costDetailsList,exports){var detaHtml='';var fmTotal=0;$.each(costDetailsList,function(i,n){fmTotal+=n.activityAmount;detaHtml+='<tr class="'+(exports?'exports':'')+'" pkId="'+n.costDetailsId+'" budgetCode="'+n.publicServiceProCode+'" costCode="'+n.costType+'" budgetProject="'+n.publicServiceProName+'" applyDate="'+n.activityDate+'" siteVal="'+n.placeName+'" costBreakdown="'+n.costTypeName+'" standardMoney="'+n.standardAmount+'" budgetMoney="'+n.activityAmount+'" accompanyNum="'+n.peopleNum+'"><td><span class="">'+n.publicServiceProName+'</span></td><td><span class="act-date">'+n.activityDate+'</span></td><td><span class="place-name">'+n.placeName+'</span></td><td><span>'+n.costTypeName+'</span></td>'+'<td style="text-align: right;"><div class="money" money='+n.activityAmount+'>'+$yt_baseElement.fmMoney(n.activityAmount||'0')+'</div></td><td><span class="people-num">'+n.peopleNum+'</span></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#paymentList tbody .last').before(detaHtml);$('#paymentList tbody .total-money').text(serveFunds.fmMoney(fmTotal))},setTravelRouteList:function(tripPlanList,exports){var me=this;var tripHtml='';var travelPersonnelsList=[];var getUserNames=function(list){var str='';$.each(list,function(i,n){str+=n.travelPersonnelName+(i<list.length-1?'、':'')});return str};var costItem=function(str){switch(str){case '1':return '住宿费';break;case '2':return '伙食费';break;case '3':return '市内交通费';break;default:return '';break}};var getCostItemName=function(str){var txt='';if(str){var list=str.split(',');$.each(list,function(i,n){if(n){txt+=costItem(n)+(i<list.length-1?'、':'')}});return txt}return ''};var clearRepetitionUser=function(list,str){var checkUsersCodes=me.usersInfoList;var srtList=str.split(',');$.each(srtList,function(i,n){if(checkUsersCodes.indexOf(n)<0){me.usersInfoList=me.usersInfoList+'{"userItcode":"'+n+'","jobLevelName":"'+list[i].travelPersonnelsJobLevelName+'","userName":"'+list[i].travelPersonnelName+'"},'}})};$.each(tripPlanList,function(i,n){var dateFrom=new Date(n.startTime);var dateTo=new Date(n.endTime);var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24))+1;tripHtml+='<tr class="'+(exports?'exports':'')+'" busicode="'+n.travelType+'" usercode="'+n.travelPersonnels+'" rececode="'+n.receptionCostItem+'" ><td><input type="hidden" class="hid-user-code" value="'+n.travelPersonnels+'" /> <span class="name">'+n.travelTypeName+'</span></td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="day">'+diff_day+'</td><td class="address" val="'+n.travelAddress+'">'+n.travelAddressName+'</td><td class="uname">'+getUserNames(n.travelPersonnelsList)+'</td><td class="numof">'+n.travelPersonnelsList.length+'</td><td class="reception">'+getCostItemName(n.receptionCostItem)+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';clearRepetitionUser(n.travelPersonnelsList,n.travelPersonnels)});$('#tripList tbody').append(tripHtml);if(exports){me.setSubsidyList();me.updateApplyMeonySum()}},setCostCarfareList:function(costCarfareList,exports){var carHtml='';var costCarfareClose=$('#traffic-list-info').next().find('.check-label input');var vehicle=[];$.each(costCarfareList,function(i,n){vehicle=n.vehicle.substr(1).substr(0,n.vehicle.length-2).split('.');carHtml+='<tr class="'+(exports?'exports':'')+'"><td><span>'+n.travelPersonnelName+'</span><input type="hidden" risk-code-val="trafficBusiUsers" data-val="travelPersonnel" class="hid-traf-users" value="'+n.travelPersonnel+'"/></td><td><span>'+n.travelPersonnelsJobLevelName+'</span><input type="hidden" risk-code-val="trafficBusiUsersLevel" value="'+n.travelPersonnelsJobLevelCode+'"/></td><td data-text="goTime">'+n.goTime+'</td><td><input data-val="goAddress" type="hidden" value="'+n.goAddress+'"><span data-text="goAddressName">'+n.goAddressName+'</span></td><td data-text="arrivalTime">'+n.arrivalTime+'</td><td><input data-val="arrivalAddress" type="hidden" value="'+n.arrivalAddress+'"><span data-text="arrivalAddressName">'+n.arrivalAddressName+'</span></td><td><span data-text="vehicle">'+n.vehicleName+'</span><input type="hidden" class="hid-vehicle"  risk-code-val="vehicleParent" value="'+vehicle[0]+'"/><input type="hidden" class="hid-child-code" risk-code-val="vehicleChild" value="'+(vehicle.length>1?vehicle[1]:'')+'"/></td><td class="font-right money-td" data-text="crafare">'+(n.crafare==""?"--":$yt_baseElement.fmMoney(n.crafare||'0'))+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"":n.remarks)+'</td><td><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costCarfareClose.length>0&&n.setMethod){costCarfareClose.setCheckBoxState('check')}});carHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$('#traffic-list-info tbody').html(carHtml);sysCommon.updateMoneySum(0)},setCostHotelList:function(costHotelList,exports){var hotelHtml='';var costHotelClose=$('#hotel-list-info').next().find('.check-label input');var addresCdoe=[];$.each(costHotelList,function(i,n){addresCdoe=n.hotelAddress.split('-');var avg=n.hotelDays>0?$yt_baseElement.fmMoney((+n.hotelExpense/ +n.hotelDays)||'0'):n.hotelExpense;hotelHtml+='<tr class="'+(exports?'exports':'')+'"><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" risk-code-val="hotelBusiUsers" value="'+n.travelPersonnel+'"/></td><td><span>'+n.travelPersonnelsJobLevelName+'</span><input type="hidden" risk-code-val="hotelBusiUsersLevel" value="'+n.travelPersonnelsJobLevelCode+'"/></td><td  risk-code-val="costDetailHotelCost" class="font-right"><span>'+avg+'<span></td><td risk-code-val="hotelCheckInDate" class="check-in-date"><span data-text="hotelTime" class="sdate">'+n.hotelTime+'</span></td><td class="leave-date"><span data-text="leaveTime" class="edate">'+n.leaveTime+'</span></td><td data-text="hotelDays">'+n.hotelDays+'</td><td class="font-right money-td" data-text="hotelExpense"  risk-code-val="hotelCost">'+$yt_baseElement.fmMoney(n.hotelExpense||'0')+'</td><td><span data-text="hotelAddressName">'+n.hotelAddressName+'</span><input type="hidden" data-val="hotelAddress" value="'+n.hotelAddress+'"/><input type="hidden" risk-code-val="hotelProvinceAddress" value="'+addresCdoe[0]+'"><input type="hidden" risk-code-val="hotelCityAddress" value="'+addresCdoe[1]+'"><input type="hidden" risk-code-val="hotelHaidianAddress" value="'+addresCdoe[2]+'"></td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"":n.remarks)+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costHotelClose.length>0&&n.setMethod){costHotelClose.setCheckBoxState('check')}});hotelHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td><td></td></tr>';$('#hotel-list-info tbody').html(hotelHtml);sysCommon.updateMoneySum(1)},setCostOtherList:function(costOtherList,exports){var otherHtml='';var costOtherClose=$('#other-list-info').next().find('.check-label input');$.each(costOtherList,function(i,n){otherHtml+='<tr class="'+(exports?'exports':'')+'"><td><span>'+n.costType+'</span><input type="hidden" data-val="costType" risk-code-val="otherCostType"  value="'+n.costType+'"/></td><td class="font-right money-td" data-text="reimAmount"  risk-code-val="otherCostReimPrice">'+$yt_baseElement.fmMoney(n.reimAmount||'0')+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"":n.remarks)+'</td><td><input type="hidden" class="hid-cost-type" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costOtherClose.length>0&&n.setMethod){costOtherClose.setCheckBoxState('check')}});otherHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$('#other-list-info tbody').html(otherHtml);sysCommon.updateMoneySum(2)},setCostSubsidyList:function(costSubsidyList,exports){var subHtml='';var totalFood=0;var totalTraffic=0;$.each(costSubsidyList,function(i,n){subHtml+='<tr class="'+n.travelPersonnel+' '+(exports?'exports':'')+'" code="'+n.travelPersonnel+'"><td><div class="user" code="'+n.travelPersonnel+'">'+n.travelPersonnelName+'</div></td><td><div class="lv">'+n.travelPersonnelsDept+'</div></td><td><div class="subsidy-num">'+n.subsidyDays+'</div></td><td><div style="text-align:right;" class="food">'+$yt_baseElement.fmMoney(n.subsidyFoodAmount||'0')+'</div></td><td><div  style="text-align:right;" class="traffic">'+$yt_baseElement.fmMoney(n.carfare||'0')+'</div></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';totalFood+= +n.subsidyFoodAmount;totalTraffic+= +n.carfare});subHtml+='<tr class="last"><td>合计</td><td></td><td></td><td class="total-food"  style="text-align:right;">'+$yt_baseElement.fmMoney(totalFood||'0')+'</td><td class="total-traffic"  style="text-align:right;">'+$yt_baseElement.fmMoney(totalTraffic||'0')+'</td><td></td></tr>';$('#subsidy-list-info tbody').html(subHtml)},setTrainApplyInfoList:function(list,exports){var html='';$.each(list,function(i,n){serveFunds.getTrainingTypeOption(n.trainType);$('#meetingClassification').niceSelect();$('#regionDesignation').val(n.regionDesignation);$('#regionName').val(n.regionName);$('#startTimeTop').val(n.reportTime);$('#endTimeTop').val(n.endTime);$('#calculationSession').text(n.trainDays);$('#trainOfNum').val(n.trainOfNum);$('#workerNum').val(n.workerNum);$('#approvaNum').val(n.approvaNum);$('#chargeStandard').val(n.chargeStandard);if(exports){$('#meetingClassification,#regionDesignation,#regionName,#startTimeTop,#endTimeTop,#calculationSession,#trainOfNum,#workerNum').addClass('exports')}});$('#trainingPopTable tbody').html(html)},setTeacherApplyInfoList:function(list,exports){var html='';$.each(list,function(i,n){html+='<tr class="'+(exports?'exports':'')+'"><td class="lecturerName"><input type="hidden" class="lectureId" value="'+n.lecturerId+'"><span>'+n.lecturerName+'</span></td><td class="professional">'+(n.lecturerTitleName==''?'--':n.lecturerTitleName)+'</td><td class="level">'+(n.lecturerLevelName==''?'--':n.lecturerLevelName)+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#lecturerTable tbody').html(html)},setCostTrainApplyInfoList:function(list,exports){var html='';var total=0;$.each(list,function(i,n){if(n.trainTypeName=='差旅费'){html+=''}else{html+='<tr class="'+(exports?'exports':'')+'" costnameval="'+n.trainType+'" pid=""><td class="cost-name">'+n.trainTypeName+'</td><td class="moneyText standard-money">'+($yt_baseElement.fmMoney(n.standard))+'</td><td class="people-num">'+n.trainOfNum+'</td><td class="day-num">'+n.trainDays+'</td><td class="moneyText smallplan-money">'+serveFunds.fmMoney(n.averageMoney)+'</td><td class="special-instruct">'+n.remark+'</td><td><input type="hidden" class="popM" value="4"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.averageMoney}});$('#trainingFeeTable tbody tr.last').before(html).find('.costTotal').text(serveFunds.fmMoney(total))},setCostTeachersFoodApplyInfoList:function(list,exports){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="'+(exports?'exports':'')+'" pid="'+n.foodId+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="moneyText avg">'+serveFunds.fmMoney(n.averageMoney)+'</td><td class="day">'+n.foodOfDays+'</td><td class="moneyText sum-pay">'+serveFunds.fmMoney(n.foodAmount)+'</td><td style="text-align: left !important;" class="dec">'+(n.remarks||'')+'</td><td><input type="hidden" class="popM" value="3"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';});$('#dietFeeTable tbody .end-tr').before(html);$('#dietFeeTable tbody tr:not(.end-tr)').each(function(){total+=serveFunds.rmoney($(this).find('.sum-pay').text())});$('#dietFeeTable tbody .costTotal').text(serveFunds.fmMoney(total))},setCostTeachersLectureApplyInfoList:function(list,exports){var html='';var total=0;var costTotal=0;$.each(list,function(i,n){html+='<tr class="'+(exports?'exports':'')+'" pid="'+n.teachersLectureId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="holder">'+(n.lecturerTitleName||'--')+'</td><td class="hour">'+n.teachingHours+'</td><td class="cname">'+(n.courseName||'--')+'</td><td class="moneyText sum-pay">'+serveFunds.fmMoney(n.perTaxAmount)+'</td><td class="moneyText after">'+serveFunds.fmMoney(n.afterTaxAmount)+'</td><td class="moneyText avg">'+serveFunds.fmMoney(n.averageMoney)+'</td><td><input type="hidden" class="popM" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';});$('#lectureFeeTable tbody .end-tr').before(html);$('#lectureFeeTable tbody tr:not(.end-tr)').each(function(){total+=serveFunds.rmoney($(this).find('.after').text())});$('#lectureFeeTable tbody .costTotal-after').text(serveFunds.fmMoney(total));$('#lectureFeeTable tbody tr:not(.end-tr)').each(function(){costTotal+=serveFunds.rmoney($(this).find('.sum-pay').text())});$('#lectureFeeTable tbody .costTotal').text(serveFunds.fmMoney(costTotal));var taxAmount=Number(costTotal-total);var applyAmount=$yt_baseElement.rmoney($("#applyTotalMoney").text());var endAmount=applyAmount-taxAmount;$("#taxAmount").text(serveFunds.fmMoney(taxAmount));$("#payTeacherAll").text(serveFunds.fmMoney(taxAmount))},setCostTeachersTravelApplyInfoList:function(list,exports){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="'+(exports?'exports':'')+'" pid="'+n.teachersTravelId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="ulv">'+(n.lecturerLevelName||'--')+'</td><td class="sdate">'+n.goTime+'</td><td class="edate">'+n.arrivalTime+'</td><td class="sadd"><input type="hidden" class="scode" value="'+n.goAddress+'">'+n.goAddressName+'</td><td class="eadd"><input type="hidden" class="ecode" value="'+n.arrivalAddress+'">'+n.arrivalAddressName+'</td><td class="tname"><input type="hidden" class="tool" value="'+n.vehicle+'">'+n.vehicleName+'</td><td class="moneyText sum-pay">'+serveFunds.fmMoney(n.carfare)+'</td><td style="text-align: left !important;" class="dec">'+(n.remarks||'')+'</td><td><input type="hidden" class="popM" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';});$('#carFeeTable tbody .end-tr').before(html);$('#carFeeTable tbody tr:not(.end-tr)').each(function(){total+=serveFunds.rmoney($(this).find('.sum-pay').text())});$('#carFeeTable tbody .costTotal').text(serveFunds.fmMoney(total))},setCostTeachersHotelApplyInfoList:function(list,exports){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="'+(exports?'exports':'')+'" pid="'+n.teachersHotelId+'" level="'+n.lecturerLevelName+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="moneyText avg">'+serveFunds.fmMoney(n.averageMoney)+'</td><td class="day">'+n.hotelDays+'</td><td class="moneyText sum-pay">'+serveFunds.fmMoney(n.hotelExpense)+'</td><td style="text-align: left !important;" class="dec">'+(n.remarks||'')+'</td><td><input type="hidden" class="popM" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';});$('#hotelFeeTable tbody .end-tr').before(html);$('#hotelFeeTable tbody tr:not(.end-tr)').each(function(){total+=serveFunds.rmoney($(this).find('.sum-pay').text())});$('#hotelFeeTable tbody .costTotal').text(serveFunds.fmMoney(total))},setCostNormalList:function(list,exports){var html='';var total=0;$.each(list,function(i,n){html+='<tr class="yt-tab-row '+(exports?'exports':'')+'"> <td style="text-align:center;" class="reimContent">'+n.normalName+'</td> <td style="text-align: right;" class="reimAmount">'+($yt_baseElement.fmMoney(n.normalAmount))+'</td> <td class="reimInstructions"> '+(n.remarks||'')+'</td> <td> <span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span> <span class="operate-del" style=""><img src="../../../../../resources-sasac/images/common/del-icon.png"></span> </td> </tr>';total+= +n.normalAmount});$('.ordinary-approval #costList tbody .last').before(html);$('.ordinary-approval #costList tbody #reimAmountlSum').text($yt_baseElement.fmMoney(total))},setCostSpecialList:function(list,exports){var html='';var specialAmountSum=0;var deductBudgetAmountSum=0;var code=serveFunds.costType;if(code=='MEDICAL_EXPENSES'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'||code=='CURRENT_ACCOUNT'){$.each(list,function(i,n){html+='<tr class="yt-tab-row '+(exports?'':'')+'"><td  class="specialContent" code="'+n.specialCode+'" >'+n.specialName+'</td><td style="text-align: right;" class="specialAmount">'+($yt_baseElement.fmMoney(n.specialAmount))+'</td><td class="specialinstructions"> '+(n.remarks||'')+'</td><td  class="operation"> <span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span> <span class="operate-del" style=""><img src="../../../../../resources-sasac/images/common/del-icon.png"></span> </td> </tr>';specialAmountSum+= +n.specialAmount});$('.ordinary-approval #specialCostList tbody .last').before(html);$('.ordinary-approval #specialCostList tbody #specialAmountSum').text($yt_baseElement.fmMoney(specialAmountSum))}else if(code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'||code=='SOCIAL_SECURITY_FEE'){$.each(list,function(i,n){html+='<tr class="yt-tab-row '+(exports?'':'')+'"><td  class="specialContent" code="'+n.specialCode+'" >'+n.specialName+'</td><td style="text-align: right;" class="specialAmount">'+($yt_baseElement.fmMoney(n.specialAmount))+'</td><td style="text-align: right;" class="deductBudgetAmount">'+($yt_baseElement.fmMoney(n.deductBudgetAmount))+'</td><td class="specialinstructions"> '+(n.remarks||'')+'</td><td  class="operation"> <span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span> <span class="operate-del" style=""><img src="../../../../../resources-sasac/images/common/del-icon.png"></span> </td> </tr>';specialAmountSum+= +n.specialAmount;deductBudgetAmountSum+= +n.deductBudgetAmount});$('.ordinary-approval #specialCostList tbody .last').before(html);$('.ordinary-approval #specialCostList tbody #specialAmountSum').text($yt_baseElement.fmMoney(specialAmountSum));$('.ordinary-approval #specialCostList tbody #deductBudgetAmountSum').text($yt_baseElement.fmMoney(deductBudgetAmountSum))}},setMeetingList:function(list,exports){$.each(list,function(i,n){serveFunds.getMeetingTypeCode(n.meetType);$('#meetName').val(n.meetName);$('#meetAddress').val(n.meetAddress);$('#startTime').val(n.meetStartTime);$('#endTime').val(n.meetEndTime);if(n.meetDays){$('#calculationSession').val(n.meetDays).css('color','#333').removeClass('calculation-Identification');}$('#meetOfNum').val(n.meetOfNum);$('#meetWorkerNum').val(n.meetWorkerNum);if(exports){$('#meetName,#meetAddress,#startTime,#endTime,#calculationSession,#meetOfNum,#meetWorkerNum').addClass('exports')}})},setMeetingCostList:function(list,exports){$.each(list,function(i,n){$('#meetHotel').val($yt_baseElement.fmMoney(n.meetHotel));$('#meetFood').val($yt_baseElement.fmMoney(n.meetFood));$('#meetOther').val($yt_baseElement.fmMoney(n.meetOther));$('#costTotal,#applyTotalMoney').text($yt_baseElement.fmMoney(n.meetAmount)).css('color','#333');$('#TotalMoneyUpper').text(arabiaToChinese(n.meetAmount));$('#dailyAverageConsumption').text($yt_baseElement.fmMoney(n.meetAverage)).css('color','#333');if(exports){$('#meetHotel,#meetFood,#meetOther,#costTotal,#dailyAverageConsumption').addClass('exports')}})},priorApprovalNon:function(){},setBudgetItme:function(arr){var me=this;var codeArr=arr?arr:[];var budgetOne=$('.budget-item-one');var budgetTwo=$('.budget-item-two');var budgetThree=$('.budget-item-three');var getBudgetCode=function(){$('select.budget-item-one,select.budget-item-two,select.budget-item-three').each(function(){})};$('div.budget-item-two').hide();$('div.budget-item-three').hide();},getBudgetBalanceAmount:function(specialCodeSeq){$.ajax({type:"post",url:"budget/main/getBudgetOtherBalanceAmount",async:true,data:{specialCodeSeq:specialCodeSeq},success:function(data){if(data.flag==0){var deptBudgetBalanceAmount=data.data.deptBudgetBalanceAmount;$('#deptBudgetBalanceAmount').text(deptBudgetBalanceAmount?serveFunds.fmMoney(deptBudgetBalanceAmount<0?"0":deptBudgetBalanceAmount)+'万元':'--');$("#deptBudgetBalanceAmountHidden").val(data.data.deptBudgetBalanceAmount);var budgetBalanceAmount=data.data.budgetBalanceAmount;$('#budgetBalanceAmount').text(budgetBalanceAmount?serveFunds.fmMoney(budgetBalanceAmount)+'万元':'--');}}})},verifyBudgetExpendSum:function(){var expend=serveFunds.rmoney($('#applyTotalMoney').text());var budget=serveFunds.rmoney($('#deptBudgetBalanceAmount').text().replace('万元',''))*10000;if(budget<expend){$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:"部门预算可用余额小于当前申请的金额，请调整申请内容，或先保存页面信息，待部门预算调整后再重新提交申请。",cancelFunction:function(){}});return false}return true},getPaymentTermTotal:function(){var cash=serveFunds.rmoney($('#cash').val());var offic=serveFunds.rmoney($('#officialCard').val());var trans=serveFunds.rmoney($('#transferAccounts').val());return cash+offic+trans},alertClearReceivables:function(){$('#cash,#officialCard,#transferAccounts').on('blur',function(){var writeoff=serveFunds.rmoney($('.personal-writeoff-money').text());var total=serveFunds.getPaymentTermTotal();if(total>writeoff){$(this).focus();$yt_alert_Model.prompt('金额不能大于冲销后补领总金额');return false}});$('#addExpense').click(function(){var code='company';$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();$('#cash,#officialCard,#transferAccounts').val('0.00');$("label.user-radio-label").show();$('#appendPaymentInfo').off().on('click',function(){serveFunds.raceAddList()}).text('保存')});$("#modelCanelBtn,#cost-apply-model .closed-span").click(function(){$('.payee-unit tr,.payee-personal tr,.payee-other tr').removeClass('update-tr');sysCommon.closeModel($("#cost-apply-model"));serveFunds.clearAlert($(".model-content"));$("#payeeRadio-no,#contractRadio-no,#otherRadio-no").parent().addClass("check");$("#payeeRadio-no,#contractRadio-no,#otherRadio-no").attr('checked','checked');$("#payeeRadio-yes,#contractRadio-yes,#otherRadio-yes").parent().removeClass("check");$('.arrears-money').text('0.00');$('.the-reverse-money').text('0.00');$('.pe-department,.pe-rank').text('');$('.personal-writeoff-money').text('0.00');$('#cash,#officialCard,#transferAccounts').val('0.00');serveFunds.setPayeeNameSelect();$('.receipt-alert .display-loan').hide();$(".display-rank").hide();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").hide();$(".busi-card-tr").show();$("#payeeRadio-no").parent().addClass("check");$(".paid-amount-input").hide();$(".paid-amount-span").show();$("#payeeRadio-yes").parent().removeClass("check");$("label.user-radio-label").hide().removeClass("check");$("#userRadio").prop("checked",false);$(".actual-money").text('0.00')});},raceAddList:function(tr){var code=$('.receipt-alert ul li.tab-check').attr('code');var form=$('.receipt-alert .model-content[code="'+code+'"]');var is=$yt_valid.validForm(form);if(is){var companyName=form.find('#companyName').val();var personalUnit=form.find('#personalUnit').val();var witeOffCompany=form.find('#witeOffCompany option:selected').text();var witeOffCompanyCode=form.find('#witeOffCompany option:selected').val();var choiceLoan=form.find('.choice-loan option:selected').val();var theReverseMoney=form.find('.the-reverse-money').text();var actualMoney=form.find('.actual-money').text();var openBank=form.find('#openBank').val()||'--';var accountNumber=form.find('#accountNumber').val()||'--';var companyMoney=form.find('#companyMoney').val();var contractRadio=form.find('.check .contractRadio').val();var contractRadioText='';var companyPaidAmount='';if(contractRadio==1){contractRadioText='有';if(form.find("#companyPaidAmount").val()!=''){companyPaidAmount=form.find("#companyPaidAmount").val()}else{companyPaidAmount="0.00"}}else{contractRadioText='无';companyPaidAmount="--"}var settlementRadio=form.find('.check .settlementRadio').val();var settlementRadioText='';if(settlementRadio==1){settlementRadioText='汇款'}else{settlementRadioText='支票'}var companySpecial=form.find('#companySpecial').val();var payeeName=form.find('#payeeName option:selected').attr('username');var payeeVal=form.find('#payeeName option:selected').val();var peDepartment=form.find('.pe-department').text();var peRank=form.find('.pe-rank').text();if(payeeVal=='external'||!($('input.where-company').is(":hidden"))){peRank=form.find('input.where-company').val();$(".display-rank").show();$(".pe-department").text("外部人员");$(".dis-r").hide();$(".where-company").show();$("input.where-company").attr("validform","{isNull:true,blurFlag:true,msg:'请输入收款人所在单位'}");payeeName=$('#payeeName').next().find('.search-current').val();payeeName=payeeName=='请选择'?'':payeeName;payeeVal='external'}else{$(".display-rank").show();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").show()}var verifyName=function(){if(payeeName){return true;$('#payeeName').parent().find('.valid-font').text('')}else{$('#payeeName').parent().find('.valid-font').text('请填写外部人员名称');return false}};var personalTotal=form.find('#personalTotal').val();var witeOffPersonal=form.find("#witeOffPersonal option:selected").text()||'无';var witeOffPersonalVal=form.find("#witeOffPersonal option:selected").val();var choiceLoan=form.find('.choice-loan option:selected').text();var choiceLoanDataValue=form.find('.choice-loan option:selected').val();var choiceLoanVal=form.find('.choice-loan option:selected').val();var arrearsMoney=form.find('.arrears-money').text();var theReverseMoney=form.find('.the-reverse-money').text();var personalWriteoff=form.find('.personal-writeoff-money').text();var cash=form.find('#cash').val();var officialCard=form.find('#officialCard').val()||'0.00';var transferAccounts=form.find('#transferAccounts').val()||'0.00';var payeeRadio=form.find('.check .payeeRadio').val()||'0.00';var payeeRadioText='';var payeePaidAmount='';if(payeeRadio==1){payeeRadioText='有';if($("#payeePaidAmount").val()!=''){payeePaidAmount=form.find("#payeePaidAmount").val()}else{payeePaidAmount="0.00"}}else{payeeRadioText='无';payeePaidAmount="--"}var personalSpecial=form.find('#personalSpecial').val();personalSpecial=personalSpecial?personalSpecial:'';var idCarkno=form.find('#idCarkno').val();var payeeBank=form.find('#payeeBank').val();var bankName=form.find('#bankName').val();var phoneNum=form.find('#phoneNum').val();var offOpenBank=form.find('#offOpenBank').val();var offAccounts=form.find('#offAccounts').val();var otherMoney=form.find('#otherMoney').val();var witeOffOther=form.find('#witeOffOther option:selected').text();var witeOffOtherVal=form.find('#witeOffOther option:selected').val();var otherAllMoney=form.find('#otherAllMoney').val();var otherRadio=form.find('.check .otherRadio').val();var otherRadioText='';var otherPaidAmount='';if(otherRadio==1){otherRadioText='有';if($("#otherPaidAmount").val()!=''){otherPaidAmount=form.find("#otherPaidAmount").val()}else{otherPaidAmount="0.00"}}else{otherRadioText='无';otherPaidAmount="--"}var otherSpecial=form.find('#otherSpecial').val();otherSpecial=otherSpecial?otherSpecial:'';var trHtml='';var pamTotal=serveFunds.getPaymentTermTotal();var writeOffNum=serveFunds.rmoney(personalWriteoff);if(pamTotal==writeOffNum){var receMoney=serveFunds.getReceMsgMoney(tr)+serveFunds.rmoney(otherAllMoney)+serveFunds.rmoney(personalWriteoff)+serveFunds.rmoney(companyMoney);var sumMoney=serveFunds.rmoney($('#applyTotalMoney').text());console.log('count:'+receMoney,'total：'+sumMoney);if(tr){tr.find('.loan-go').text('0')}var loanTotal=0;var loanFalse=false;$('#companyList .yt-tbody tr:not(:last),.payee-personal .yt-tbody tr:not(:last),.payee-other .yt-tbody tr:not(:last)').each(function(i,n){if($(this).attr('choiceLoan')==choiceLoan){loanTotal+=$yt_baseElement.rmoney($(this).find('.loan-go').text())}if($(this).hasClass('update-tr')){loanFalse=true}else{loanFalse=false}});if($('#companyList .yt-tbody tr:not(:last),.payee-personal .yt-tbody tr:not(:last),.payee-other .yt-tbody tr:not(:last)').length!=0){if(code=='company'){loanTotal+=$yt_baseElement.rmoney(companyMoney)}else if(code=='personal'){loanTotal+=$yt_baseElement.rmoney(personalTotal)}else if(code=='other'){loanTotal+=$yt_baseElement.rmoney(otherAllMoney)}}if(loanFalse&&$('#companyList .yt-tbody tr:not(:last),.payee-personal .yt-tbody tr:not(:last),.payee-other .yt-tbody tr:not(:last)').length==1){loanTotal=0}if(form.find('.wite-select option:selected').val()=='BORROWING_ORDER_REVERSAL'||form.find('.wite-select option:selected').val()=='LOAN_REVERSE'){if(loanTotal<=$yt_baseElement.rmoney(form.find('.arrears-money').text())){switch(code){case 'company':trHtml='<tr  pkid="" class="payee-unit-tr" choiceLoanDataValue="'+choiceLoanDataValue+'" choiceLoan="'+choiceLoan+'" witeOffCompany="'+witeOffCompanyCode+'" theReverseMoney="'+$yt_baseElement.rmoney(theReverseMoney)+'" actualMoney="'+$yt_baseElement.rmoney(actualMoney)+'" companyPaidAmount="'+companyPaidAmount+'" companyName="'+companyName+'" openBank="'+openBank+'" accountNumber="'+accountNumber+'" companyMoney="'+companyMoney+'" contractRadio="'+contractRadio+'" settlementRadio="'+settlementRadio+'" companySpecial="'+companySpecial+'"><td class="com" value="Company">'+companyName+'</td><td style="text-align: right;" class="unitTotal">'+($yt_baseElement.fmMoney(companyMoney))+'</td><td>'+witeOffCompany+'</td><td class="loan-go">'+theReverseMoney+'</td><td>'+actualMoney+'</td><td>'+openBank+'</td><td>'+accountNumber+'</td><td value="'+contractRadio+'">'+contractRadioText+'</td><td value="'+settlementRadio+'">'+settlementRadioText+'</td><td class="companyPaidAmount-td" style="text-align:right;">'+(companyPaidAmount=="--"?"--":$yt_baseElement.fmMoney(companyPaidAmount))+'</td><td>'+companySpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(trHtml);serveFunds.clearAlterTable()}else{$('.rece-msg table[code="'+code+'"] tbody .payee-unit-total').before(trHtml);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}serveFunds.companyTotal();break;case 'personal':if(verifyName()){trHtml='<tr class="payee-personal-tr" pkid="" choiceLoanDataValue="'+choiceLoanDataValue+'" payeeVal="'+payeeVal+'" choiceLoan="'+choiceLoan+'" payeePaidAmount="'+payeePaidAmount+'" payeeName="'+payeeName+'" personalUnit="'+personalUnit+'" peDepartment="'+peDepartment+'" peRank="'+peRank+'" personalTotal="'+personalTotal+'" witeOffPersonal="'+witeOffPersonalVal+'" personalWriteoff="'+personalWriteoff+'" cash="'+cash+'" officialCard="'+officialCard+'" transferAccounts="'+transferAccounts+'" payeeRadio="'+payeeRadio+'" personalSpecial="'+personalSpecial+'" idCarkno="'+idCarkno+'" payeeBank="'+payeeBank+'" bankName="'+bankName+'" phoneNum="'+phoneNum+'" choiceLoan="'+choiceLoan+'" choiceLoanVal="'+choiceLoanVal+'" arrearsMoney="'+arrearsMoney+'" theReverseMoney="'+theReverseMoney+'" offOpenBank="'+offOpenBank+'" offAccounts="'+offAccounts+'"><td class="per" value="personal">'+payeeName+'</td><td style="text-align: right;" class="personalTotal">'+($yt_baseElement.fmMoney(personalTotal))+'</td><td>'+witeOffPersonal+'</td><td style="text-align: right;" class="loan-go">'+theReverseMoney+'</td><td style="text-align: right;">'+personalWriteoff+'</td><td style="text-align: right;">'+cash+'</td><td style="text-align: right;">'+officialCard+'</td><td style="text-align: right;">'+transferAccounts+'</td><td><a class="yt-link to-data">详情</a></td><td>'+payeeRadioText+'</td><td class="payeePaidAmount-td" style="text-align:right;">'+(payeePaidAmount=="--"?"--":$yt_baseElement.fmMoney(payeePaidAmount))+'</td><td>'+personalSpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(trHtml);serveFunds.clearAlterTable()}else{$('.rece-msg table[code="'+code+'"] tbody .payee-personal-total').before(trHtml);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}serveFunds.personalTotal()}break;case 'other':trHtml='<tr class="payee-other-tr"  pkid="" choiceLoanDataValue="'+choiceLoanDataValue+'" choiceLoan="'+choiceLoan+'" witeOffOther="'+witeOffOtherVal+'" theReverseMoney="'+theReverseMoney+'" actualMoney="'+actualMoney+'" otherPaidAmount="'+otherPaidAmount+'" otherMoney="'+otherMoney+'" otherAllMoney="'+otherAllMoney+'" otherRadio="'+otherRadio+'" otherSpecial="'+otherSpecial+'"><td class="oth" value="Other">'+otherMoney+'</td><td style="text-align: right;" class="otherTotal">'+($yt_baseElement.fmMoney(otherAllMoney))+'</td><td>'+witeOffOther+'</td><td class="loan-go">'+theReverseMoney+'</td><td>'+actualMoney+'</td><td>'+otherRadioText+'</td><td class="otherPaidAmount-td" style="text-align:right;">'+(otherPaidAmount=="--"?"--":$yt_baseElement.fmMoney(otherPaidAmount))+'</td><td>'+otherSpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(trHtml);serveFunds.clearAlterTable()}else{$('.rece-msg table[code="'+code+'"] tbody .payee-other-total').before(trHtml);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}serveFunds.otherTotal();break;default:break}serveFunds.clearAlert($(".model-content"));serveFunds.setPayeeNameSelect();$yt_baseElement.tableRowActive();$('.receipt-alert .display-loan').hide();$('.pe-department,.pe-rank').text('');$('.personal-writeoff-money').text('0.00');$('#cash,#officialCard,#transferAccounts').val('0.00');$(".display-rank").hide();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").hide();$("label.user-radio-label").hide().removeClass("check");$("#userRadio").prop("checked",false);$(".actual-money").text('0.00');$('.payee-unit tr,.payee-personal tr,.payee-other tr').removeClass('update-tr')}else{$yt_alert_Model.alertOne({leftBtnName:"确定",rightBtnName:"",cancelFunction:"",alertMsg:"同一借款单在本次支出申请中的冲销金额合计超出欠款金额，请修改后重新保存",confirmFunction:function(){},})}}else{switch(code){case 'company':trHtml='<tr  pkid="" class="payee-unit-tr" choiceLoan="'+choiceLoan+'" witeOffCompany="'+witeOffCompanyCode+'" theReverseMoney="'+theReverseMoney+'" actualMoney="'+actualMoney+'" companyPaidAmount="'+companyPaidAmount+'" companyName="'+companyName+'" openBank="'+openBank+'" accountNumber="'+accountNumber+'" companyMoney="'+companyMoney+'" contractRadio="'+contractRadio+'" settlementRadio="'+settlementRadio+'" companySpecial="'+companySpecial+'"><td class="com" value="Company">'+companyName+'</td><td style="text-align: right;" class="unitTotal loan-go">'+($yt_baseElement.fmMoney(companyMoney))+'</td><td>'+witeOffCompany+'</td><td class="loan-go">'+theReverseMoney+'</td><td>'+actualMoney+'</td><td>'+openBank+'</td><td>'+accountNumber+'</td><td value="'+contractRadio+'">'+contractRadioText+'</td><td value="'+settlementRadio+'">'+settlementRadioText+'</td><td class="companyPaidAmount-td" style="text-align:right;">'+(companyPaidAmount=="--"?"--":$yt_baseElement.fmMoney(companyPaidAmount))+'</td><td>'+companySpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(trHtml);serveFunds.clearAlterTable()}else{$('.rece-msg table[code="'+code+'"] tbody .payee-unit-total').before(trHtml);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}serveFunds.companyTotal();break;case 'personal':if(verifyName()){trHtml='<tr class="payee-personal-tr" pkid="" payeeVal="'+payeeVal+'" choiceLoan="'+choiceLoan+'" payeePaidAmount="'+payeePaidAmount+'" payeeName="'+payeeName+'" personalUnit="'+personalUnit+'" peDepartment="'+peDepartment+'" peRank="'+peRank+'" personalTotal="'+personalTotal+'" witeOffPersonal="'+witeOffPersonalVal+'" personalWriteoff="'+personalWriteoff+'" cash="'+cash+'" officialCard="'+officialCard+'" transferAccounts="'+transferAccounts+'" payeeRadio="'+payeeRadio+'" personalSpecial="'+personalSpecial+'" idCarkno="'+idCarkno+'" payeeBank="'+payeeBank+'" bankName="'+bankName+'" phoneNum="'+phoneNum+'" choiceLoan="'+choiceLoan+'" choiceLoanVal="'+choiceLoanVal+'" arrearsMoney="'+arrearsMoney+'" theReverseMoney="'+theReverseMoney+'" offOpenBank="'+offOpenBank+'" offAccounts="'+offAccounts+'"><td class="per" value="personal">'+payeeName+'</td><td style="text-align: right;" class="personalTotal loan-go">'+($yt_baseElement.fmMoney(personalTotal))+'</td><td>'+witeOffPersonal+'</td><td style="text-align: right;" class="loan-go">'+theReverseMoney+'</td><td style="text-align: right;">'+personalWriteoff+'</td><td style="text-align: right;">'+cash+'</td><td style="text-align: right;">'+officialCard+'</td><td style="text-align: right;">'+transferAccounts+'</td><td><a class="yt-link to-data">详情</a></td><td>'+payeeRadioText+'</td><td class="payeePaidAmount-td" style="text-align:right;">'+(payeePaidAmount=="--"?"--":$yt_baseElement.fmMoney(payeePaidAmount))+'</td><td>'+personalSpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(trHtml);serveFunds.clearAlterTable()}else{$('.rece-msg table[code="'+code+'"] tbody .payee-personal-total').before(trHtml);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}serveFunds.personalTotal()}break;case 'other':trHtml='<tr class="payee-other-tr"  pkid="" choiceLoan="'+choiceLoan+'" witeOffOther="'+witeOffOtherVal+'" theReverseMoney="'+theReverseMoney+'" actualMoney="'+actualMoney+'" otherPaidAmount="'+otherPaidAmount+'" otherMoney="'+otherMoney+'" otherAllMoney="'+otherAllMoney+'" otherRadio="'+otherRadio+'" otherSpecial="'+otherSpecial+'"><td class="oth" value="Other">'+otherMoney+'</td><td style="text-align: right;" class="otherTotal loan-go">'+($yt_baseElement.fmMoney(otherAllMoney))+'</td><td>'+witeOffOther+'</td><td class="loan-go">'+theReverseMoney+'</td><td>'+actualMoney+'</td><td>'+otherRadioText+'</td><td class="otherPaidAmount-td" style="text-align:right;">'+(otherPaidAmount=="--"?"--":$yt_baseElement.fmMoney(otherPaidAmount))+'</td><td>'+otherSpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(trHtml);serveFunds.clearAlterTable()}else{$('.rece-msg table[code="'+code+'"] tbody .payee-other-total').before(trHtml);$yt_alert_Model.prompt('填写的信息已成功加入到列表')}serveFunds.otherTotal();break;default:break}serveFunds.clearAlert($(".model-content"));serveFunds.setPayeeNameSelect();$yt_baseElement.tableRowActive();$('.receipt-alert .display-loan').hide();$('.pe-department,.pe-rank').text('');$('.personal-writeoff-money').text('0.00');$('#cash,#officialCard,#transferAccounts').val('0.00');$(".display-rank").hide();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").hide();$("label.user-radio-label").hide().removeClass("check");$("#userRadio").prop("checked",false);$(".actual-money").text('0.00');}}else{$yt_alert_Model.prompt('收款方式金额合计必须等于个人应收款总金额')}}},alertReceivables:function(){$("#appendPaymentInfo").click(function(){serveFunds.raceAddList()})},updataPersonal:function(){$(".payee-unit tbody").on("click",".operate-update",function(){var ithis=$(this);var tr=ithis.parents('tr');var table=ithis.parents('table');var code=table.attr('code');tr.addClass('update-tr');$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();$('#companyMoney').val(tr.attr('companyMoney'));$('#witeOffCompany').val(tr.attr('witeOffCompany')).niceSelect();if(tr.attr('witeOffCompany')=='BORROWING_ORDER_REVERSAL'){$('.display-loan').show()}$('.choice-loan').val(tr.attr('choiceloandatavalue')).niceSelect();serveFunds.calculatePaymentAlertPerson($('.company'));$('#companyName').val(tr.attr('companyName'));$('#openBank').val(tr.attr('openBank')=='--'?'':tr.attr('openBank'));$('#accountNumber').val(tr.attr('accountNumber')=='--'?'':tr.attr('accountNumber'));var contractRadio=tr.attr('contractRadio');$('.companyCheck .check-label input[value="'+contractRadio+'"]').setRadioState('check');var settlementRadio=tr.attr('settlementradio');$('.settlementCheck .check-label input[value="'+settlementRadio+'"]').setRadioState('check');var checkVal=$(".company-form").find('input:checked').val();if(checkVal==1){$(".company-form .paid-amount-input").show();$(".company-form .paid-amount-span").hide()}else{$(".company-form .paid-amount-input").hide();$(".company-form .paid-amount-span").show()}if(tr.attr('companyPaidAmount')!=''&&tr.attr('companyPaidAmount')!='--'){$('#companyPaidAmount').val($yt_baseElement.fmMoney($(this).parent().parent().find('.companyPaidAmount-td').text()));$("#companyPaidAmount").attr('validform','{isNull:true,msg:\'请输入已支付金额\',changeFlag:true}');$("#companyPaidAmount").parent().find(".not-null-hidden").show()}else{$('#companyPaidAmount').val($yt_baseElement.fmMoney(0));$("#companyPaidAmount").removeAttr('validform');$("#companyPaidAmount").parent().find(".not-null-hidden").hide()}var companySpecial=tr.attr('companySpecial');$('#companySpecial').val(companySpecial=='无'?'':companySpecial);$('#appendPaymentInfo').off().on('click',function(){serveFunds.raceAddList(tr)}).text('确定')})},updataReceivables:function(){$(".payee-personal tbody").on("click",".operate-update",function(){var ithis=$(this);var tr=ithis.parents('tr');tr.addClass('update-tr');serveFunds.clearAlert($(".model-content"));$('.arrears-money').text('0.00');$('.the-reverse-money').text('0.00');$('.pe-department,.pe-rank').text('');$('.personal-writeoff-money').text('0.00');$('#cash,#officialCard,#transferAccounts').val('0.00');serveFunds.setPayeeNameSelect();$('.receipt-alert .display-loan').hide();$(".display-rank").hide();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").hide();$(".busi-card-tr").show();$("#payeeRadio-no").parent().addClass("check");$(".paid-amount-input").hide();$(".paid-amount-span").show();$("#payeeRadio-yes").parent().removeClass("check");$("label.user-radio-label").hide().removeClass("check");$("#userRadio").prop("checked",false);$("#appendPaymentInfo").text('确定');var ithis=$(this);var tr=ithis.parents('tr');var table=ithis.parents('table');var code=table.attr('code');$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();var payee=tr.attr('payeeVal');serveFunds.setPayeeNameSelect(payee);$('.pe-department').text(tr.attr('pedepartment'));$('.pe-rank').text(tr.attr('perank'));if(payee=='external'){$('input.where-company').val(tr.attr('perank'));$(".display-rank").show();$(".pe-department").text("外部人员");$(".dis-r").hide();$(".where-company").show();$("input.where-company").attr("validform","{isNull:true,blurFlag:true,msg:'请输入收款人所在单位'}");$('#payeeName').attr('validform','{}').next().find('.search-current').val(tr.attr('payeeName'));$('#personalUnit').val(tr.attr('personalUnit'))}else{$(".display-rank").show();$(".where-company").hide();$(".where-company").removeAttr("validform");$(".display-rank .valid-font").text("");$(".dis-r").show();$('#payeeName').attr('validform','{isNull:true,blurFlag:true,msg:\'请输入收款人姓名\'}')}$('#personalTotal').val(tr.attr('personalTotal'));var choiceLoan=tr.attr('choiceLoan');if(choiceLoan&&choiceLoan!='请选择'){$('.receipt-alert .display-loan').show();serveFunds.getChoiceLoanList(tr.attr('choiceLoanVal'));$('.the-reverse-money').text(tr.attr('thereversemoney'))}else{$('.receipt-alert .display-loan').hide();$('.choice-loan').val('').niceSelect();$('.arrears-money').text('0.00');$('.the-reverse-money').text('0.00')}$('#witeOffPersonal').val(tr.attr('witeOffPersonal')).niceSelect();$('.personal-writeoff-money').text(tr.attr('personalwriteoff'));$('#cash').val(tr.attr('cash')||'0.00');$('#officialCard').val(tr.attr('officialCard')||'0.00');$('#transferAccounts').val(tr.attr('transferAccounts')||'0.00');$('#idCarkno').val(tr.attr('idCarkno'));$('#payeeBank').val(tr.attr('payeeBank'));$('#bankName').val(tr.attr('bankName'));$('#phoneNum').val(tr.attr('phoneNum'));$('#offOpenBank').val(tr.attr('offOpenBank'));$('#offAccounts').val(tr.attr('offAccounts'));var payeeRadio=tr.attr('payeeRadio');$('.personalCheck .check-label input[value="'+payeeRadio+'"]').setRadioState('check');var checkVal=$(".personal-form").find('input:checked').val();if(checkVal==1){$(".personal-form .paid-amount-input").show();$(".personal-form .paid-amount-span").hide()}else{$(".personal-form .paid-amount-input").hide();$(".personal-form .paid-amount-span").show()}if(tr.attr('payeePaidAmount')!=''&&tr.attr('payeePaidAmount')!='--'){$('#payeePaidAmount').val($yt_baseElement.fmMoney($(this).parent().parent().find('.payeePaidAmount-td').text()));$("#payeePaidAmount").attr('validform','{isNull:true,msg:\'请输入已支付金额\',changeFlag:true}');$("#payeePaidAmount").parent().find(".not-null-hidden").show()}else{$('#payeePaidAmount').val($yt_baseElement.fmMoney(0));$("#payeePaidAmount").attr('validform','{isNull:true,msg:\'请输入已支付金额\',changeFlag:true}');$("#payeePaidAmount").parent().find(".not-null-hidden").show()}var personalSpecial=tr.attr('personalSpecial');$('#personalSpecial').val(personalSpecial==''?'':personalSpecial);$('#appendPaymentInfo').off().on('click',function(){serveFunds.raceAddList(tr)})})},updataOther:function(){$(".payee-other tbody").on("click",".operate-update",function(){$("#appendPaymentInfo").text('确定');var ithis=$(this);var tr=ithis.parents('tr');var table=ithis.parents('table');var code=table.attr('code');tr.addClass('update-tr');$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();$('#otherMoney').val(tr.attr('otherMoney'));$('#otherAllMoney').val(tr.attr('otherAllMoney'));$('#witeOffOther').val(tr.attr('witeOffOther')).niceSelect();if(tr.attr('witeOffOther')=='BORROWING_ORDER_REVERSAL'){$('.display-loan').show()}$('.choice-loan').val(tr.attr('choiceloandatavalue')).niceSelect();serveFunds.calculatePaymentAlertPerson($('.other'));var otherRadio=tr.attr('otherRadio');$('.otherCheck .check-label input[value="'+otherRadio+'"]').setRadioState('check');var checkVal=$(".traffic-form").find('input:checked').val();if(checkVal==1){$(".traffic-form .paid-amount-input").show();$(".traffic-form .paid-amount-span").hide()}else{$(".traffic-form .paid-amount-input").hide();$(".traffic-form .paid-amount-span").show()}if(tr.attr('otherPaidAmount')!=''&&tr.attr('otherPaidAmount')!='--'){$('#otherPaidAmount').val($yt_baseElement.fmMoney($(this).parent().parent().find('.otherPaidAmount-td').text()));$("#otherPaidAmount").attr('validform','{isNull:true,msg:\'请输入已支付金额\',changeFlag:true}');$("#otherPaidAmount").parent().find(".not-null-hidden").show()}else{$('#otherPaidAmount').val($yt_baseElement.fmMoney(0));$("#otherPaidAmount").attr('validform','{isNull:true,msg:\'请输入已支付金额\',changeFlag:true}');$("#otherPaidAmount").parent().find(".not-null-hidden").show()}var otherSpecial=tr.attr('otherSpecial');$('#otherSpecial').val(otherSpecial==''?'':otherSpecial);$('#appendPaymentInfo').off().on('click',function(){serveFunds.raceAddList(tr)}).text('确定')})},clearAlterTable:function(){sysCommon.closeModel($("#cost-apply-model"));serveFunds.clearAlert($(".model-content"));serveFunds.setPayeeNameSelect()},getReceMsgMoney:function(tr){var total=0;var unit=0;$('table.payee-unit tbody tr:not(.payee-unit-total)').not(tr).each(function(){unit+=serveFunds.rmoney($(this).find('.unitTotal').text())});var us=0;$('table.payee-personal tbody tr:not(.payee-personal-total)').not(tr).each(function(){other+=serveFunds.rmoney($(this).find('.personalTotal').text())});var other=0;$('table.payee-other tbody tr:not(.payee-other-total)').not(tr).each(function(){other+=serveFunds.rmoney($(this).find('.otherTotal').text())});total=unit+us+other;return total},companyTotal:function(){var tds=$('.payee-unit tbody .unitTotal');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('.payee-unit tbody .payee-unit-money').text(fmTotal))},personalTotal:function(){var tds=$('.payee-personal tbody tr:not(.payee-personal-total)');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).find('.personalTotal').text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('.payee-personal tbody .payee-personal-money').text(fmTotal))},otherTotal:function(){var tds=$('.payee-other tbody .otherTotal');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('.payee-other tbody .payee-other-total-money').text(fmTotal))},clearPriorApproval:function(){var costType=$('.docu-style-box input:checked').val();$('#indexMainDiv table tr.exports').remove();switch(costType){case 'PERSONNEL_APPLY':break;case 'TRAVEL_APPLY':travelSpending.updateMoneySum(0);travelSpending.updateMoneySum(1);travelSpending.updateMoneySum(2);travelSpending.setSubsidyTotal();travelSpending.updateMoneySum();break;case 'TRAIN_APPLY':$('#meetingClassification.exports option:first-child').attr('selected','selected');$('#meetingClassification.exports').removeClass('exports').niceSelect();$('#regionDesignation.exports,#regionName.exports,#startTimeTop.exports,#endTimeTop.exports,#calculationSession.exports,#trainOfNum.exports,#workerNum.exports').val('').removeClass('exports');var lectureSum=0;$("#lectureFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);lectureSum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#lectureFeeTable .costTotal").text($yt_baseElement.fmMoney(lectureSum));var hotelSum=0;$("#hotelFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);hotelSum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#hotelFeeTable .costTotal").text($yt_baseElement.fmMoney(hotelSum));var dietSum=0;$("#dietFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);dietSum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#dietFeeTable .costTotal").text($yt_baseElement.fmMoney(dietSum));var carSum=0;$("#carFeeTable tbody tr:not(.end-tr)").each(function(){var thisObj=$(this);carSum+=$yt_baseElement.rmoney(thisObj.find(".sum-pay").text())});$("#carFeeTable .costTotal").text($yt_baseElement.fmMoney(carSum));var totalAmount=0;$('#trainingFeeTable tbody .smallplan-money').each(function(){totalAmount+=$yt_baseElement.rmoney($(this).text())});$('#trainingFeeTable tbody .costTotal').text($yt_baseElement.fmMoney(totalAmount));personnelFunds.updateTotalNum();break;case 'MEETING_APPLY':$('#meetingClassification.exports option:first-child').attr('selected','selected');$('#meetingClassification.exports').removeClass('exports').niceSelect();$('#meetName.exports,#meetAddress.exports,#startTime.exports,#endTime.exports,#calculationSession.exports,#meetOfNum.exports,#meetWorkerNum.exports,#meetHotel.exports,#meetFood.exports,#dailyAverageConsumption.exports').val('').removeClass('exports');$('#costTotal').text('住宿费+伙食费+其他费用').css('color','#999').removeClass('exports');$('#dailyAverageConsumption').text('费用合计/【(参会人数+工作人员数量）*会期】').css('color','#999').removeClass('exports');var accommodation=$yt_baseElement.rmoney($(".get-accommodation").val()||'0');var food=$yt_baseElement.rmoney($(".get-food").val()||'0');var other=$yt_baseElement.rmoney($(".get-other").val()||'0');var total=accommodation+food+other;$(".count-val-num").css("color","#333333").text($yt_baseElement.fmMoney(total));if(total!==0){}break;case 'BH_APPLY':var payTotal=0;$('#paymentList tbody tr:not(.last)').each(function(){payTotal+=serveFunds.rmoney($(this).find('.money').text())});$('#paymentList tbody tr.last .total-money').text(serveFunds.fmMoney(payTotal));hospitalitySpending.getTotleMoney();break;default:break}},getTrainingTypeOption:function(code){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:false,data:{dictTypeCode:'TRAIN_TYPE'},success:function(data){var list=data.data||[];var start='<option value="">请选择</option>',optone=start,opttwo=start,travelType=start,vehicle=start;$.each(list,function(i,n){travelType+='<option '+(code==n.value?'selected="selected"':'')+' value="'+n.value+'">'+n.disvalue+'</option>'});$('#meetingClassification').html(travelType);$("select#meetingClassification option").each(function(){if($(this).val()=='TRAIN_TYPE_3'){$(this).attr("selected",true)}});$('#meetingClassification').niceSelect()}})},getMeetingTypeCode:function(code){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:true,data:{dictTypeCode:'MEET_CODE'},success:function(data){var list=data.data||[];var start='<option value="">请选择</option>';$.each(list,function(i,n){start+='<option '+(code==n.value?'selected="selected"':'')+' value="'+n.value+'">'+n.disvalue+'</option>'});$('#meetingClassification').html(start).niceSelect()}})},getPayeeNameList:function(code){$.ajax({type:"post",url:"user/userInfo/getAllUserInfoToPage",async:true,data:{params:'',pageIndex:1,pageNum:99999},success:function(data){var list=data.data.rows||[];var opts='<option value="">请选择</option>';$.each(list,function(i,n){if(code&&code==n.userItcode){opts+='<option selected="selected" userName="'+n.userName+'" jobLevelName="'+n.jobLevelName+'" deptName="'+n.deptName+'" value="'+n.userItcode+'">'+n.userName+'/'+n.deptName+'/'+n.jobName+'</option>'}else{opts+='<option userName="'+n.userName+'" jobLevelName="'+n.jobLevelName+'" deptName="'+n.deptName+'" value="'+n.userItcode+'">'+n.userName+'/'+n.deptName+'/'+n.jobName+'</option>'}});$('#payeeName').html(opts);$("select#payeeName").niceSelect({search:true,backFunction:function(text){$("select#payeeName option").remove();if(text==""){$("select#payeeName").append('<option value="">请选择</option>')}$.each(list,function(i,n){if(n.userName.indexOf(text)!=-1){$("select#payeeName").append('<option userName="'+n.userName+'" jobLevelName="'+n.jobLevelName+'" deptName="'+n.deptName+'" value="'+n.userItcode+'">'+n.userName+'/'+n.deptName+'/'+n.jobName+'</option>')}})},optionCallBcak:function(opt){console.log(opt)}})}})},verifySubmitTableLenght:function(){var costType=$('.docu-style-box .check input').val();var verify=true;if(costType=='TRAVEL_APPLY'){if($('#tripList tbody tr').length<=0){$yt_alert_Model.prompt('行程详情不能为空');verify=false}if($('.prior-approval').val()==undefined){verify=true}else{if($('.prior-approval').val().length<=0){$yt_alert_Model.prompt('请选择事前申请单');verify=false}}}else if(costType=='BH_APPLY'){if($('table.msg-list tbody tr').length<=0){$yt_alert_Model.prompt('接待对象信息列表不能为空');verify=false}}return verify}};$(function(){serveFunds.init();validRiskInfoEvent()});function validRiskInfoEvent(){$("button.valid-risk-btn").click(function(){var appSceneCode=$("body div").attr("riskPageCode");var valiRiskJson="";var valiRiskList=[];var validRiskObj={};var trValiFieldList=[];var trValiFieldObj={};var riskDataInfo="";var valiFieldCode="";var valiFieldValue="";var valiFieldCodeTwo="";var valiFieldValueTwo="";var tag=null;$("body input.hid-risk-code").each(function(i,n){riskDataInfo=$(n).data("riskData");var valiFieldList=[];var valiFieldObj={};var lableType="";if(riskDataInfo&&riskDataInfo.valiFieldList!=undefined&&riskDataInfo.valiFieldList!=""&&riskDataInfo.valiFieldList.length){if(riskDataInfo.proofRule=="LIST"){var tabObj=$('table[risk-code-val="'+riskDataInfo.hintFieldCode+'"]');$(tabObj).find("tbody tr:not(.total-last-tr)").each(function(trIndex,t){trValiFieldList=[];$.each(riskDataInfo.valiFieldList,function(i,r){trValiFieldObj={};lableType="";tag=$(t).find('[risk-code-val="'+r.valiFieldCode+'"]');if(tag&&tag!=undefined){lableType=$(tag)[0].tagName;if(lableType=="SELECT"||lableType=="INPUT"||lableType=="TEXTAREA"){valiFieldValue=$(tag).val()}else{if($(tag).attr("risk-code-val").indexOf("Date")>-1){var timeNew=new Date($(tag).text().replace(/-/g,"/"));var monthVal=parseInt(timeNew.getMonth()+1);valiFieldValue=monthVal}else{valiFieldValue=$(tag).text()}}valiFieldCode=$(tag).attr("risk-code-val")}if(r.valiFieldCodeTwo!=undefined&&r.valiFieldCodeTwo!=""&&r.valiFieldCodeTwo!=null){tag=$(t).find('[risk-code-val="'+r.valiFieldCodeTwo+'"]');if(tag&&tag!=undefined){lableType=$(tag)[0].tagName;if(lableType=="SELECT"||lableType=="INPUT"||lableType=="TEXTAREA"){valiFieldValueTwo=$(tag).val()}else{if($(tag).attr("risk-code-val").indexOf("Date")>-1){var timeNew=new Date($(tag).text().replace(/-/g,"/"));var monthVal=parseInt(timeNew.getMonth()+1);valiFieldValueTwo=monthVal}else{valiFieldValueTwo=$(tag).text()}}valiFieldCodeTwo=$(tag).attr("risk-code-val")}}trValiFieldObj={valiFieldCode:valiFieldCode,valiFieldValue:valiFieldValue,valiFieldCodeTwo:valiFieldCodeTwo,valiFieldValueTwo:valiFieldValueTwo };trValiFieldList.push(trValiFieldObj)});valiFieldObj={trNum:trIndex,valiFieldList:trValiFieldList };valiFieldList.push(valiFieldObj)})}else{$.each(riskDataInfo.valiFieldList,function(i,v){var thisTag=$('[risk-code-val="'+v.valiFieldCode+'"]');if(thisTag&&thisTag!=undefined){lableType=$(thisTag)[0].tagName;if(lableType=="SELECT"||lableType=="INPUT"||lableType=="TEXTAREA"){valiFieldValue=$(thisTag).val()}else{valiFieldValue=$(thisTag).text()}valiFieldCode=$(thisTag).attr("risk-code-val")}if(v.valiFieldCodeTwo!=""&&v.valiFieldCodeTwo!=undefined&&v.valiFieldCodeTwo!=null){thisTag=$('[risk-code-val="'+v.valiFieldCodeTwo+'"]');lableType=$(thisTag)[0].tagName;if(lableType=="SELECT"||lableType=="INPUT"||lableType=="TEXTAREA"){valiFieldValueTwo=$(thisTag).val()}else{valiFieldValueTwo=$(thisTag).text()}valiFieldCodeTwo=$(thisTag).attr("risk-code-val")}valiFieldObj={valiFieldCode:valiFieldCode,valiFieldValue:valiFieldValue,valiFieldCodeTwo:valiFieldCodeTwo,valiFieldValueTwo:valiFieldValueTwo };valiFieldList.push(valiFieldObj)})}validRiskObj={hintFieldCode:riskDataInfo.hintFieldCode,valiFieldList:valiFieldList };valiRiskList.push(validRiskObj)}});if(valiRiskList.length>0&&valiRiskList!=null){valiRiskJson=JSON.stringify(valiRiskList)}$.ajax({type:"post",url:"basicconfig/risk/valiRiskPageField",async:false,data:{appSceneCode:appSceneCode,valiRiskJson:valiRiskJson},success:function(data){if(data.flag==0){if(data.data.length>0){$.each(data.data,function(i,n){var riskFontLabel=$('body input.hid-risk-code[value="'+n.hintFieldCode+'"]');if(riskFontLabel&&riskFontLabel!=undefined&&riskFontLabel!=""){if(n.valiFalg=="1"){$(riskFontLabel).next("img.risk-img").attr("src",sysCommon.riskViaImg)}else{$(riskFontLabel).next("img.risk-img").attr("src",sysCommon.riskWarImg);$.each(n.valiFieldList,function(i,v){if(v.trNum!=undefined&&v.trNum!=null){var tabObj=$('table[risk-code-val="'+n.hintFieldCode+'"]');if(v.valiFalg=="2"){$(tabObj).find('tbody tr:eq("'+v.trNum+'") td').css("color","red")}}})}}})}$yt_alert_Model.prompt("验证成功!");var scrollTopVal=0;var spanObj=$("body span.risk-model:visible:eq(0)");if($(window).scrollTop()&&($(spanObj).offset().top<$(window).scrollTop()||$(spanObj).offset().top>$(window).height())){scrollTopVal=$(spanObj).offset().top-50;$(window).scrollTop(scrollTopVal)}}else{$yt_alert_Model.prompt("验证失败!")}}})})}})(jQuery,window);