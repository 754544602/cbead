var caList={init:function(){caList.getOneListInfo();$('select').niceSelect();$('.page-return-btn').off().on("click",function(){var projectCode=$('.projectCode').val();var pageNum=$yt_common.GetQueryString("pageNum");if(pageNum==2){window.location.href="lookForByBacklogList.html"}else{window.location.href="newList.html"}});var nextPersonList=caList.getNextOperatePerson();if(nextPersonList!=null){$.each(nextPersonList,function(i,n){$("#dealingWithPeople").append($('<option value="'+n.userCode+'">'+n.userName+'</option>').data("classData",n))})};$("input[type='radio']").change(function(){var rad=$(this).val();if(rad=="completed"){if($('#tast-key').val()!="activitiEndTask"){$('.hid-input').show()}else{$('.hid-input').hide()}}else{$('.hid-input').hide()}});$("#dealingWithPeople").niceSelect();$('.yt-model-sure-btn').click(function(){caList.newsUpdateApply();caList.init()});$('.yt-model-canel-btn').click(function(){var pageNum=$yt_common.GetQueryString("pageNum");if(pageNum==2){window.location.href="lookForByBacklogList.html"}else{window.location.href="newList.html"}})},getNextOperatePerson:function(){var list=[];var dataObj;var processInstanceId=$('#processInstanceId').val();var user=null;$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"news",processInstanceId:processInstanceId},async:false,success:function(data){if(data.flag==0){$.each(data.data,function(i,n){for(var k in n){user=n[k]}})}}});return user},getOneListInfo:function(){var pkId=$yt_common.GetQueryString("pkId");var processInstanceId;$.ajax({type:"post",url:$yt_option.base_path+"class/news/getBeanById",async:false,data:{pkId:pkId},objName:'data',success:function(data){processInstanceId=data.data.processInstanceId;$('#processInstanceId').val(processInstanceId);if(data.flag==0){$('#projectCode').text(data.data.projectName);$('#projectUserName').text(data.data.projectUserName);$('#title').text(data.data.title);$('#issueDayeString').text(data.data.issueDayeString);$('#details').html(data.data.details);var flowLog=data.data.flowLog;var middleStepHtml;var length=flowLog.length;var order;var flowLog=data.data.flowLog;var deleteReason=flowLog[0].deleteReason;var tastKey=flowLog[0].tastKey;$('#tast-key').val(tastKey);if(tastKey=="activitiEndTask"){$('.hid-input').hide();$('#dealingWithPeople').setSelectVal("")}$.each(flowLog,function(i,v){if(i==0){$('.last-step-order').text(length);$('.last-step-operate-person-userName').text(v.userName);$('.last-step-operationState').text(v.operationState);$('.last-step-commentTime').text(v.commentTime)};if(i==length-1){$('.first-step-order').text(1);$('.first-step-operate-person-userName').text(v.userName);$('.first-step-taskName').text(v.operationState);$('.first-step-commentTime').text(v.commentTime)};if(i!=0&&i!=length-1){order=length-i;middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+v.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+v.operationState+'</span></li><li class="view-time-li middle-step-commentTime" >'+v.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment" style="padding-left: 10px;">'+v.comment+'</div></li></ul></div></div>';$('.last-step').append(middleStepHtml)}})}}})},newsUpdateApply:function(){var pkId=$yt_common.GetQueryString("pkId");var dealingWithPeople=$('#dealingWithPeople').val();var opintion=$('#opintion').val();var processInstanceId=$('#processInstanceId').val();var tastKey=$('#tast-key').val();var nextCode=$("input:checked").val();if(nextCode=="returnedSubmit"||tastKey=="activitiEndTask"){dealingWithPeople=""};if(dealingWithPeople=="no"){$yt_alert_Model.prompt("请选择下一步操作人！",3000)}else{$.ajax({type:"post",url:$yt_option.base_path+"class/news/updateApply",async:false,data:{pkId:pkId,businessCode:"news",dealingWithPeople:dealingWithPeople,opintion:opintion,processInstanceId:processInstanceId,nextCode:nextCode},objName:'data',success:function(data){if(data.flag==0){$yt_alert_Model.prompt("提交成功")}else{$yt_alert_Model.prompt("提交失败")}window.location.href="lookForByBacklogList.html"}})}}};$(function(){caList.init()});