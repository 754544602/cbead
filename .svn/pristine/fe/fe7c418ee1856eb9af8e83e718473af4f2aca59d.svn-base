var ticketOpenInfo = {
	//初始化方法
	init: function() {
		ticketOpenInfo.getClassInfo();
		//页签跳转
		$(".tab-title-list button").click(function() {
			$(this).addClass("active").siblings().removeClass("active");
			operate = $(this).text();
			if(operate == "• 项目开票") {
				//显示项目开票
				$('.bill-div').show();
				//隐藏班级信息
				$('.class-div').hide();
				ticketOpenInfo.getPlanListInfo();
				ticketOpenInfo.getPersonListInfo();
			};
			if(operate == "• 班级信息") {
				//显示班级信息
				$('.class-div').show();
				//隐藏项目开票
				$('.bill-div').hide();
				ticketOpenInfo.getClassInfo();
			};

		});
		//返回按钮
		$('.page-return-btn').on('click', function() {
			window.location.href = "ticketOpenList.html";
		});
		//班级信息模糊查询
		$(".search-btn").click(function(){
			ticketOpenInfo.getPlanListInfo();
		});
		
		//点击修改开票信息
		$('.edit-bill-info').click(function(){
			//初始化开票弹窗
			ticketOpenInfo.clearBillInfoAlert()
			ticketOpenInfo.trainOrcompanyIsCheck();
			$('#project-states').niceSelect();
			//获取标识是否有选中行的标识数据----隐藏数据
			var checkTrueOrFalse = $('.hid-project-code').val();
			if(checkTrueOrFalse != ""){//不为空有选中行
				var allCheck;//选中行对象
				var projectCode = $('.hid-project-code').val();
				var types = $('.hid-types').val();
				if(types == 1){//操作的是单位列表
					allCheck = $('.company-list tbody').find('.check')
				}else{//操作的是个人信息列表
					allCheck = $('.trainee-bill-table tbody').find('.check');
				}
				if(allCheck.length == 1){
					var traineeOrGroupId = $('.hid-trainee-or-group-id').val();
					//调用查询单位/个人开票信息方法
					ticketOpenInfo.getCompanyInfo(projectCode,types,traineeOrGroupId);
					//调用弹窗
					ticketOpenInfo.billingInfoAlert();
				}else{//选中的是多行数据进行操作的
					$yt_alert_Model.prompt("请选中一行数据进行操作", 2000);
				}
			}else{//没有被选中行的表格
				$yt_alert_Model.prompt("请选中一行数据进行操作", 2000);
			}
		});
		//开具发票点击按钮
		$('.write-bill-btn').click(function(){
			ticketOpenInfo.trainOrcompanyIsCheck();
			//调用初始化开具发票弹窗
			ticketOpenInfo.clearWriteBillAlert();
			//初始化下拉框
			$('.duty-invoiceOrder-type').niceSelect();
			var checkTrueOrFalse = $('.hid-project-code').val();
			var types = $('.hid-types').val();
			if(checkTrueOrFalse != ""){//不为空有选中行
				var allCheck;
				if(types == 1){//操作的是单位列表
					allCheck = $('.company-list tbody').find('.check')
				}else{//操作的是个人信息列表
					allCheck = $('.trainee-bill-table tbody').find('.check');
				};
				if(allCheck.length == 1){
					//调用弹窗
					ticketOpenInfo.writeBillingAlert();
					$('#project-states').niceSelect();
				}else{//是多行数据进行操作的
					$yt_alert_Model.prompt("请选中一行数据进行操作", 2000);
				}
			}else{//没有被选中行的表格
				$yt_alert_Model.prompt("请选中一行数据进行操作", 2000);
			}
		});
		//开具发票确定按钮
		$('.duty-sure-btn-table ').on('click','.duty-sure-btn',function(){
			var projectCode = $('.hid-project-code').val();
			var types = $('.hid-types').val();
			var traineeOrGroupId = $('.hid-trainee-or-group-id').val();
			var orderNum = $('.hid-order-num').val();
			ticketOpenInfo.addDutyInfo(projectCode,types,traineeOrGroupId,orderNum);
		});
		
		//数量输入框失去焦点事件
		$('.iduty-invoice-number').blur(function(){
			//数量
			var count = $('.iduty-invoice-number').val();
			//单价
			var price = $('.iduty-invoice-unit-price').val();
			if(count != "" && price != ""){//数量和单价都不为0才会调用计算税额的方法
				ticketOpenInfo.getTaxRate();
			}
		});
		//价格输入框失去焦点事件
		$('.iduty-invoice-unit-price').blur(function(){
			//数量
			var count = $('.iduty-invoice-number').val();
			//单价
			var price = $('.iduty-invoice-unit-price').val();
			if(count != "" && price != ""){//数量和单价都不为0才会调用计算税额的方法
				ticketOpenInfo.getTaxRate();
			}
		});
		//总金额输入框失去焦点
		$('.iduty-tuition').blur(function(){
			//总金额
			var tuition = $('.iduty-tuition').val();
			if(tuition != ""){//总金额输入框不为空才调用计算总税额方法
				ticketOpenInfo.getTaxRate();
			}
		});
		//选择开具发票选择服务类型
		$('.duty-invoiceOrder-type').change(function(){
			ticketOpenInfo.getTaxRate();
		});
		
		//点击合并开票
		$('.merge-bill-btn').click(function(){
			//合并标识
			var btnType = $(this).find('.hid-merge').val();
			ticketOpenInfo.mergeBillFn(btnType);
		});
		//点击取消开票
		$('.separate-bill-btn').click(function(){
			//取消标识
			var btnType = $(this).find('.hid-separate').val();
			ticketOpenInfo.mergeBillFn(btnType);
		});
		//点击修改备注
		$('.edit-remark-btn').click(function(){
			ticketOpenInfo.trainOrcompanyIsCheck();
			var types = $('.hid-types').val();
			var allCheck;
			if(types == 1){//操作的是单位列表
				allCheck = $('.company-list tbody').find('.check')
			}else{//操作的是个人信息列表
				allCheck = $('.trainee-bill-table tbody').find('.check');
			};
			if(allCheck.length == 1){
				var remark = allCheck.parent().parent().find('.orderReamrks ');
				$('.edit-remark .remark-text').val(remark.text());
				//调用弹窗
				ticketOpenInfo.editRemarkAlert();
			}else{//是多行数据进行操作的
				$yt_alert_Model.prompt("请选中一行数据进行操作", 2000);
			}
			
		});
		//修改备注确定按钮
		$('.remark-btn-box').on('click','.remark-sure-btn',function(){
			ticketOpenInfo.invoiceRemarksFn();
			ticketOpenInfo.getPersonListInfo();
		});
		//查看单位开票信息详情
		$('.company-list').on('click','.look-info',function(){
			var projectCode = $yt_common.GetQueryString("projectCode");
			var types = $(this).parent().parent().find('.types').val();
			var traineeOrGroupId = $(this).parent().parent().find('.trainee-or-group-id').val();
			ticketOpenInfo.lookBiilInfo(projectCode,types,traineeOrGroupId);
			ticketOpenInfo.lookBillingInfoAlert();
		});
		//查看个人开票信息详情
		$('.trainee-bill-table').off().on('click','.look',function(){
			debugger
			var projectCode = $yt_common.GetQueryString("projectCode");
			var types = $(this).parent().parent().find('.types').val();
			var traineeOrGroupId = $(this).parent().parent().find('.trainee-or-group-id').val();
			ticketOpenInfo.lookBiilInfo(projectCode,types,traineeOrGroupId);
			ticketOpenInfo.lookBillingInfoAlert();
		});
		//点击导出  
		$(".disableList").click(function (){
			assetsList.getExportAssets();
		});
		
		//点击学员姓名查看详情
		$('.trainee-bill-table').off().on('click','.invoice-org-href',function(){
			var traineeId=$(this).parent().parent().find('.trainee-or-group-id').val();
			var headImg=new Image();
			//获取班级编号
			 var projectCode = $yt_common.GetQueryString("projectCode");
			 //显示整体框架loading的方法
			 $yt_baseElement.showLoading();
			 $.ajax({
			 	type:"post",
			 	url:$yt_option.base_path + "finance/projectInvoice/getTraineeDetails",
			 	data:{
			 		traineeId:traineeId,
			 		projectId:projectCode
			 	},
			 	async:true,
			 	success:function(data){
			 		
			 		var htmlBody=$('.student-details-form .student-details-train-record tbody');
		 			var htmlTrs='';
		 			htmlBody.empty();
			 		if(data.flag==0){
			 			detailsMsg=data.data;
			 			detailsMsg.checkInDate=detailsMsg.checkInDate.split(" ")[0];
			 			//性别
			 			if(detailsMsg.gender==1){
			 				detailsMsg.gender="男";
			 			}else{
			 				detailsMsg.gender="女";
			 			}
			 			//发票类型
			 			if(detailsMsg.invoiceType==0){
			 				detailsMsg.invoiceType="暂不开票";
			 			}else if(detailsMsg.invoiceType==1){
			 				detailsMsg.invoiceType="普通发票";
			 			}else{
			 				detailsMsg.invoiceType="增值税发票";
			 			}
			 			//报到状态
			 			if(detailsMsg.checkInState==0){
			 				detailsMsg.checkInState="未报到";
			 			}else{
			 				detailsMsg.checkInState="已报到";
			 			}
			 			//缴费状态
			 			if(detailsMsg.paymentState==0){
			 				detailsMsg.paymentState="未缴费";
			 			}else{
			 				detailsMsg.paymentState="已缴费";
			 			}
			 			//开票状态
			 			if(detailsMsg.isOrderNum==0){
			 				detailsMsg.isOrderNum="未开票";
			 			}else{
			 				detailsMsg.isOrderNum="已开票";
			 			}
			 			$('.student-details-form .cont-edit-test').setDatas(detailsMsg);
			 			if(detailsMsg.headPortrait!=""){
			 				headImg.src=detailsMsg.headPortraitUrl;
				 			headImg.onload=function(){
				 					$('.student-details-img').attr('src',headImg.src);
								$('.student-details-img').jqthumb({  
								    width: 89,  
								    height: 130
								});
							};
			 			}else{
			 				$('.student-details-img').attr('src','../../resources/images/classStudent/student-picture.png');
			 				$('.student-details-img').jqthumb({  
								    width: 89,  
								    height: 130
								});
			 			}
			 			//隐藏整体框架loading的方法
			 			$yt_baseElement.hideLoading();
			 		}
			 		//隐藏整体框架loading的方法
			 			$yt_baseElement.hideLoading();
			 	}
			 });
			/** 
	         * 显示编辑弹出框和显示顶部隐藏蒙层 
	         */  
	        $(".student-details-form").show();  
	        /** 
	         * 调用算取div显示位置方法 
	         */  
	        $yt_alert_Model.setFiexBoxHeight($(".student-details-form .yt-edit-alert-main"));
	        $yt_alert_Model.getDivPosition($(".student-details-form"));  
	        /* 
	         * 调用支持拖拽的方法 
	         */  
	        $yt_model_drag.modelDragEvent($(".student-details-form .yt-edit-alert-title"));  
	        /** 
	         * 点击取消方法 
	         */  
	        $('.student-details-form .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click", function() {  
	            //隐藏页面中自定义的表单内容  
	            $(".student-details-form").hide();  
	        });  
		});
		
		
	},
	//导出功能
	getExportAssets:function(){
		var selectParam = $('#keyword').val();
		var aText;
		var assetsCodes = "";
		$('.select-assets-alert-checkbox input[class="select-assets-pkId"]:checked').each(function(i,n) {
			aText = $(n).parent().parent().parent().eq(0).find('.assetsCode');
			if(assetsCodes == "") {
				assetsCodes = aText.text();
			} else {
				assetsCodes += "," + aText.text();
			}
		});
		alertNmae=$('.types').val();
		$.ajaxDownloadFile({
			url:$yt_option.base_path+"administrator/assets/exportAssets",
			data:{
				selectParam:selectParam,
				obtainDateStart:"",
				obtainDateEnd:"",
				typeId:"",
				directionUse:"",
				useStatus:"",
				assetsCodes:assetsCodes,
				fileName:"资产导出数据"
			}
		});
	},
	//获取单位开票信息详情
	lookBiilInfo:function(projectCode,types,traineeOrGroupId){
		$.ajax({
			type: "post", //ajax访问方式 默认 "post"  
			url: $yt_option.base_path + "finance/projectInvoice/getInvoice", //ajax访问路径  
			data: {
				projectCode:projectCode,
				types:types,
				traineeOrGroupId:traineeOrGroupId
			}, //ajax查询访问参数
			success: function(data) {
				if(data.flag == 0) {
					if(data.data.length>0){
						$('.look-bill-info-table .invoice-model-info').text(data.data.invoiceModel);
						$('.look-bill-info-table .org-name-info').text(ata.data.orgName);
						$('.look-bill-info-table .tax-number-info').text(ata.data.taxNumber);
						$('.look-bill-info-table .address-info').text(ata.data.address);
						$('.look-bill-info-table .telephone-info').text(ata.data.telephone);
						$('.look-bill-info-table .registered-bank-info').text(ata.data.registeredBank);
						$('.look-bill-info-table .account-info').text(ata.data.account);
					}
					$yt_baseElement.hideLoading();

				} else {
					$yt_baseElement.hideLoading();
				}
			}
		});
	},
	
	//修改备注
	invoiceRemarksFn:function(){
		var projectCode = $yt_common.GetQueryString("projectCode");
		var types = $('.hid-types').val();
		var traineeOrGroupIds = $('.hid-trainee-or-group-id').val();
		var invoiceRemarks = $('.edit-remark .remark-text').val();
		$yt_baseElement.showLoading();
		$.ajax({
			type: "post", //ajax访问方式 默认 "post"  
			url: $yt_option.base_path + "finance/projectInvoice/updateInvoiceRemarks", //ajax访问路径  
			data: {
				projectCode:projectCode,
				types:types,
				traineeOrGroupId:traineeOrGroupIds,
				invoiceRemarks:invoiceRemarks
			}, //ajax查询访问参数
			success: function(data) {
				if(data.flag == 0) {
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading();
				}
			}
		});
	},
	
	
	//合并开票
	mergeBillFn:function(btnType){
		ticketOpenInfo.trainOrcompanyIsCheck()
		var projectCode = $yt_common.GetQueryString("projectCode");
		var types = $('.hid-types').val();
		var traineeOrGroupIds = $('.hid-trainee-or-group-id').val();
		$yt_baseElement.showLoading();
		$.ajax({
			type: "post", //ajax访问方式 默认 "post"  
			url: $yt_option.base_path + "finance/projectInvoice/updateInvoiceOrderNum", //ajax访问路径  
			data: {
				projectCode:projectCode,
				types:types,
				traineeOrGroupIds:traineeOrGroupIds,
				orderNumType:btnType
			}, //ajax查询访问参数
			success: function(data) {
				if(data.flag == 0) {
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading();
				}
			}
		});
	},
	//初始化开票弹窗信息
	clearBillInfoAlert:function(){
		$('#project-states').val("");
		$('.orgName').val("");
		$('.taxNumber').val();
		$('.address').val("");
		$('.telephone').val();
		$('.registeredBank').val("");
		$('.account').val("");
	},
	
	//初始化开具发票
	clearWriteBillAlert:function(){
		$('.duty-org-name').val("");
		$('.duty-tax-number').val("");
		$('.duty-telephone').val("");
		$('.duty-address').val("");
		$('.duty-registered-bank').val("");
		$('.duty-account').val("");
		$('.iduty-specification-model').val("");
		$('.iduty-invoice-group').val("");
		$('.iduty-invoice-number').val("");
		$('.iduty-invoice-unit-price').val("");
		$('.iduty-tuition').val("");
		$('.taxt-rat').text("");
		$('.taxt-rat-money').text("");
		
	},
	
	//计算费用
	getTaxRate:function(){
		//类型
		var invoiceOrderType = $('.duty-invoiceOrder-type').val();
		//数量
		var count = $('.iduty-invoice-number').val();
		//单价
		var price = $('.iduty-invoice-unit-price').val();
		//总金额
		var tuition = $('.iduty-tuition').val();
		
		
		if((count != "" && price != "") || tuition !=""){//价格和单价部位空或者总金额不为空
			if(tuition == ""){//总金额不为空，计算总金额
				$('.iduty-tuition').val(count*price);
				tuition = $('.iduty-tuition').val()
			}
			//总税额
			var ratMoney = $('.taxt-rat-money');
			if(invoiceOrderType == 1){//培训费
				//税率
				$('.taxt-rat').text("3%");
				//税额
				$('.taxt-rat-money').text((0.03*tuition).toFixed(2));
			}else if(invoiceOrderType == 2){//住宿费
				//税率
				$('.taxt-rat').text("6%");
				//税额
				$('.taxt-rat-money').text((0.06*tuition).toFixed(2));
			}else if(invoiceOrderType == 3){//餐费
				//税率
				$('.taxt-rat').text("6%");
				//税额
				$('.taxt-rat-money').text((0.06*tuition).toFixed(2));
			}else if(invoiceOrderType == 4){//咨询服务费
				//税率
				$('.taxt-rat').text("3%");
				//税额
				$('.taxt-rat-money').text((0.03*tuition).toFixed(2));
			}else if(invoiceOrderType == 5){//培训服务费
				//税率
				$('.taxt-rat').text("3%");
				//税额
				$('.taxt-rat-money').text((0.03*tuition).toFixed(2));
			}else{//会议费
				//税率
				$('.taxt-rat').text("6%");
				//税额
				$('.taxt-rat-money').text((0.06*tuition).toFixed(2));
			}
		
		}
		
	},
	//点击操作按钮时判断当前选中行是哪个表
	trainOrcompanyIsCheck:function(){
		//标识是否有选中行
		var checkTrueOrFalse = "";
		//接收被选中行对象
		var check;
		//单位列表选中行
		var company = $('.company-list tbody tr').find('.check');
		//学员类表选中行
		var trainee = $('.trainee-bill-table tbody tr').find('.check');
		var companyLen = company.length;
		var traineeLen = trainee.length;
		if(companyLen > 0){//当前选中行是单位列表
			checkTrueOrFalse = 1;
			check = company;
		}else if(traineeLen > 0){//当前选中行是学员列表
			checkTrueOrFalse = 1;
			check = trainee;
		}else if(companyLen > 0 && traineeLen > 0){//单位列表和学员列表都有被选中行
			$yt_alert_Model.prompt("请选中一行数据进行操作", 3000);
		}else{//都没单位列表和学员列表都没有选中行
			$yt_alert_Model.prompt("请选中一行数据进行操作", 3000);
		}
		if (check != undefined) {
			//项目code
			var projectCode = $yt_common.GetQueryString("projectCode");
			var types = check.parent().find('.types').val();
			var orderNum = check.parent().find('.order-num').val();
			//学员/单位id
			var traineeOrGroupId ="";
			$.each(check,function(i,v){
				if(traineeOrGroupId == ""){
					traineeOrGroupId = $(v).parent().find('.trainee-or-group-id').val();
				}else{
					traineeOrGroupId += ','+$(v).parent().find('.trainee-or-group-id').val();
				}
			});
			//把值放到隐藏标签里
			$('.hid-project-code').val(projectCode);
			$('.hid-types').val(types);
			$('.hid-order-num').val(orderNum);
			$('.hid-trainee-or-group-id').val(traineeOrGroupId);
			$('.hid-check-true-or-false').val(checkTrueOrFalse);
		}
	},
	//开具发票
	addDutyInfo:function(projectCode,types,traineeOrGroupId,orderNum){
		var invoiceType = $('.write-bill-table .invoice-type-td').find('.check').children().val();
		var invoiceModel = $('.write-bill-table .invoice-model-td').find('.check').children().val();
		var orgName = $('.duty-org-name').val();
		var taxNumber = $('.duty-tax-number').val();
		var telephone = $('.duty-telephone').val();
		var address = $('.duty-address').val();
		var registeredBank = $('.duty-registered-bank').val();
		var account = $('.duty-account').val();
		var invoiceOrderType = 	$('.duty-invoiceOrder-type').val();
		var invoiceSpecificationModel = $('.iduty-specification-model').val();
		var invoiceGroup = 	$('.iduty-invoice-group').val();
		var invoiceNumber = $('.iduty-invoice-number').val();
		var invoiceUnitPrice = $('.iduty-invoice-unit-price').val();
		var tuition = $('.iduty-tuition').val();
		var orderReamrks = "";
		$yt_baseElement.showLoading();
		$.ajax({
			type: "post", //ajax访问方式 默认 "post"  
			url: $yt_option.base_path + "finance/projectInvoice/addInvoice", //ajax访问路径  
			data: {
				projectCode:projectCode,
				types:types,
				traineeOrGroupId:traineeOrGroupId,
				orderNum:orderNum,
				invoiceType:invoiceType,
				invoiceType:invoiceType,
				orgName:orgName,
				taxNumber:taxNumber,
				telephone:telephone,
				address:address,
				registeredBank:registeredBank,
				account:account,
				invoiceOrderType:invoiceOrderType,
				invoiceSpecificationModel:invoiceSpecificationModel,
				invoiceGroup:invoiceGroup,
				invoiceNumber:invoiceNumber,
				invoiceUnitPrice:invoiceUnitPrice,
				tuition:tuition,
				orderReamrks:orderReamrks
			}, //ajax查询访问参数
			success: function(data) {
				if(data.flag == 0) {
					
					$yt_baseElement.hideLoading();

				} else {
					$yt_baseElement.hideLoading();
				}
			}
		});
		
	},
	//开具发票弹出框
	writeBillingAlert: function() {
		/** 
		 * 显示编辑弹出框和显示顶部隐藏蒙层 
		 */
		$(".write-billing-alert").show();
		/** 
		 * 调用算取div显示位置方法
		 */
		$yt_alert_Model.setFiexBoxHeight($(".write-billing-alert .alert-form"));
		$yt_alert_Model.getDivPosition($(".write-billing-alert"));
		/* 
		 * 调用支持拖拽的方法 
		 */
		$yt_model_drag.modelDragEvent($(".write-billing-alert .yt-edit-alert-title"));
		/** 
		 * 点击取消方法 
		 */
		$('.write-billing-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
			//隐藏页面中自定义的表单内容  
			$(".write-billing-alert").hide();
			//隐藏蒙层  
			$("#pop-modle-alert").hide();
		});
		/** 
		 * 点击取消方法 
		 */
		$('.write-billing-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click", function() {
			//隐藏页面中自定义的表单内容  
			$(".write-billing-alert").hide();
			//隐藏蒙层  
			$("#pop-modle-alert").hide();
		});
	},
	
	//获取单位开票信息
	getCompanyInfo:function(projectCode,types,traineeOrGroupId){
		$.ajax({
			type: "post", //ajax访问方式 默认 "post"  
			url: $yt_option.base_path + "finance/projectInvoice/getInvoice", //ajax访问路径  
			data: {
				projectCode:projectCode,
				types:types,
				traineeOrGroupId:traineeOrGroupId
			}, //ajax查询访问参数
			success: function(data) {
				
				if(data.flag == 0) {
					if(data.data.length>0){
						$('.class-info-centent .invoiceModel').setSelectVal(data.data.invoiceModel);
						$('.class-info-centent .orgName').val(ata.data.orgName);
						$('.class-info-centent .taxNumber').val(ata.data.taxNumber);
						$('.class-info-centent .address').val(ata.data.address);
						$('.class-info-centent .telephone').val(ata.data.telephone);
						$('.class-info-centent .registeredBank').val(ata.data.registeredBank);
						$('.class-info-centent .account').val(ata.data.account);
						$('.class-info-centent .types').val(ata.data.types);
						$('.class-info-centent .trainee-or-groupId').val(ata.data.traineeOrGroupId);
						$('.class-info-centent .invoice-id').val(ata.data.invoiceId);
					}
					$yt_baseElement.hideLoading();

				} else {
					$yt_baseElement.hideLoading();
				}
			}
		});
	},
	//开票信息保存
	savebillingInf: function() {
			$yt_baseElement.showLoading();
			var projectCode = $yt_common.GetQueryString("projectCode");
			var invoiceModel = $('.class-info-centent .invoiceModel').val();
			var orgName = $('.class-info-centent .orgName').val();
			var taxNumber = $('.class-info-centent .taxNumber').val();
			var address = $('.class-info-centent .address').val();
			var telephone = $('.class-info-centent .telephone').val();
			var registeredBank = $('.class-info-centent .registeredBank').val();
			var account = $('.class-info-centent .account').val();
			var types = $('.class-info-centent .types').val();
			var traineeOrGroupId = $('.class-info-centent .trainee-or-groupId').val();
			var invoiceId = $('.class-info-centent .invoice-id').val();
		$.ajax({
			type: "post", //ajax访问方式 默认 "post"  
			url: $yt_option.base_path + "finance/projectInvoice/updateInvoice", //ajax访问路径  
			data: {
				projectCode: projectCode,
				types: types,
				traineeOrGroupId: traineeOrGroupId,
				invoiceId:invoiceId,
				
				invoiceModel:invoiceModel,
				orgName:orgName,
				taxNumber:taxNumber,
				address:address,
				telephone:telephone,
				registeredBank:registeredBank,
				account:account,
			}, //ajax查询访问参数
			success: function(data) {
				if(data.flag == 0) {
					$yt_alert_Model.prompt("保存成功");
					$yt_baseElement.hideLoading();

				} else {
					$yt_alert_Model.prompt("保存失败");
					$yt_baseElement.hideLoading();
				}
			}
		});
	},
	
	//修改备注弹窗
	editRemarkAlert: function() {
		/** 
		 * 显示编辑弹出框和显示顶部隐藏蒙层 
		 */
		$(".edit-remark-alert").show();
		/** 
		 * 调用算取div显示位置方法
		 */
		$yt_alert_Model.setFiexBoxHeight($(".edit-remark-alert .alert-form"));
		$yt_alert_Model.getDivPosition($(".edit-remark-alert"));
		/* 
		 * 调用支持拖拽的方法 
		 */
		$yt_model_drag.modelDragEvent($(".edit-remark-alert .yt-edit-alert-title"));
		/** 
		 * 点击取消方法 
		 */
		$('.edit-remark-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
			//隐藏页面中自定义的表单内容  
			$(".edit-remark-alert").hide();
			//隐藏蒙层  
			$("#pop-modle-alert").hide();
		});
		/** 
		 * 点击取消方法 
		 */
		$('.edit-remark-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click", function() {
			//隐藏页面中自定义的表单内容  
			$(".edit-remark-alert").hide();
			//隐藏蒙层  
			$("#pop-modle-alert").hide();
		});
	},
	//开票信息详情弹出框
	lookBillingInfoAlert: function() {
		/** 
		 * 显示编辑弹出框和显示顶部隐藏蒙层 
		 */
		$(".look-billing-inf-alert").show();
		/** 
		 * 调用算取div显示位置方法
		 */
		$yt_alert_Model.setFiexBoxHeight($(".look-billing-inf-alert .alert-form"));
		$yt_alert_Model.getDivPosition($(".look-billing-inf-alert"));
		/* 
		 * 调用支持拖拽的方法 
		 */
		$yt_model_drag.modelDragEvent($(".look-billing-inf-alert .yt-edit-alert-title"));
		/** 
		 * 点击取消方法 
		 */
		$('.look-billing-inf-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
			//隐藏页面中自定义的表单内容  
			$(".look-billing-inf-alert").hide();
			//隐藏蒙层  
			$("#pop-modle-alert").hide();
		});
		/** 
		 * 点击取消方法 
		 */
		$('.look-billing-inf-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click", function() {
			//隐藏页面中自定义的表单内容  
			$(".look-billing-inf-alert").hide();
			//隐藏蒙层  
			$("#pop-modle-alert").hide();
		});
	},
	//开票信息弹出框
	billingInfoAlert: function() {
		/** 
		 * 显示编辑弹出框和显示顶部隐藏蒙层 
		 */
		$(".billing-inf-alert").show();
		/** 
		 * 调用算取div显示位置方法
		 */
		$yt_alert_Model.setFiexBoxHeight($(".billing-inf-alert .alert-form"));
		$yt_alert_Model.getDivPosition($(".billing-inf-alert"));
		/* 
		 * 调用支持拖拽的方法 
		 */
		$yt_model_drag.modelDragEvent($(".billing-inf-alert .yt-edit-alert-title"));
		/** 
		 * 点击取消方法 
		 */
		$('.billing-inf-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
			//隐藏页面中自定义的表单内容  
			$(".billing-inf-alert").hide();
			//隐藏蒙层  
			$("#pop-modle-alert").hide();
		});
		/** 
		 * 点击取消方法 
		 */
		$('.billing-inf-alert .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click", function() {
			//隐藏页面中自定义的表单内容  
			$(".billing-inf-alert").hide();
			//隐藏蒙层  
			$("#pop-modle-alert").hide();
		});
	},
	
	//项目开票，单位列表
	getPlanListInfo: function() {
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			async: true,
			url: $yt_option.base_path + "finance/projectInvoice/getInvoiceToGroup", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			before: function() {
				//showLoading方法
				$yt_baseElement.showLoading();
			},
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.ticket-open-tbody');
					var htmlTr = '';
					var projectType;
					if(data.data != "") {
						$(htmlTbody).empty()
						$.each(data.data, function(i, v) {
							if (v.invoiceStates == 1) {
								v.invoiceStates = "未开票";
							}else{
								v.invoiceStates = "已开票";
							}
							if (v.isAdmission == 0) {
								v.isAdmission = "未确认"
							} else{
								v.isAdmission = "已确认";
							}
							htmlTr += '<tr>' +
								'<td>'+
									'<input type="hidden" class="types" value="1"/>' + 
									'<input type="hidden" class="order-num" value="'+v.orderNum+'"/>' + 
									'<input type="hidden" class="trainee-or-group-id" value="'+v.groupId+'"/>' + 
									'<label class="check-label yt-checkbox label-list">'+
										'<input type="checkbox" name="test" class=""/>'+
									'</label>' + 
								'</td>' +
								'<td class="groupName" style="text-align:left"><a style="color: #4169E1;" class="project-code-href">' + v.groupName + '</a></td>' +
								'<td class="trainingExpenseNegotiatedPrice list-td" style="text-align:right;">' + v.trainingExpenseNegotiatedPrice + '</td>' +
								'<td class="list-td"><a style="color: #4169E1;" class="look-info look-stu-info look">查看</a></td>' +
								'<td class="isAdmission">' + v.isAdmission + '</td>' +
								'<td class="invoiceStates list-td">' + v.invoiceStates + '</td>' +
								'<td class="orderReamrks list-td">' + v.orderReamrks + '</td>' +
								'</tr>';
							
						});
					}else {
						$(htmlTbody).empty()
						htmlTr = '<tr style="border:0px;background-color:#fff !important;" >' +
							'<td colspan="7" align="center" style="border:0px;">' +
							'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
							'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
							'</div>' +
							'</td>' +
							'</tr>';
					}
					htmlTbody.append(htmlTr);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			//isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	/**
	 * 项目开票详情页面获取个人信息
	 */
	getPersonListInfo: function() {
		var projectCode = $yt_common.GetQueryString("projectCode");
		$('.class-page').pageInfo({
			async: true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "finance/projectInvoice/getInvoiceToTrainee", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode
			}, //ajax查询访问参数
			before: function() {
				$yt_baseElement.showLoading();
			},
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.class-tbody');
					var htmlTr = '';
					var num = 1;
					var invoiceType;
					if(data.data.rows.length > 0) {
						$(htmlTbody).empty()
						$.each(data.data.rows, function(i, v) {
							htmlTr += '<tr>' +
								'<td>'+
									'<input type="hidden" class="types" value="2"/>' +
									'<input type="hidden" class="trainee-or-group-id" value="' + v.traineeId + '"/>' +
									'<input type="hidden" class="order-num" value="' + v.orderNum + '"/>' +
									'<input type="hidden" class="project-code" value="' + v.projectCode + '"/>' +
									'<label class="check-label yt-checkbox label-list" style="margin-left:7px">'+
										'<input type="checkbox" name="test"/>'+
									'</label>'+
								'</td>' +
								'<td class = "group-num"><input type="hidden" class="types" value="2"/>' + v.groupNum + '</td>' +
								'<td class="real-name"><a style="color: #4169E1;" class="invoice-org-href">' + v.realName + '</a></td>' +
								'<td class="room-number">' + v.roomNumber + '</td>' +
								'<td class="phone" >' + v.phone + '</td>' +
								'<td class="group-name" style="text-align:left">' + v.groupName + '</td>' +
								'<td class="group-org-name" style="text-align:left">' + v.groupOrgName + '</td>' +
								'<td><a style="color: #4169E1;" class="look-info">查看</a></td>' +
								'<td class="checkIn-state">' + v.checkInState + '</td>' +
								'<td class="is-admission">' + v.isAdmission + '</td>' +
								'<td class="invoice-states">' + v.invoiceStates + '</td>' +
								'<td class="invoice-remarks" style="text-align:right">' + v.invoiceRemarks + '</td>' +
								'</tr>';
							
						});
					}else {
						$(htmlTbody).empty()
						htmlTr += '<tr style="border:0px;background-color:#fff !important;" >' +
							'<td colspan="12" align="center" style="border:0px;">' +
							'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
							'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
							'</div>' +
							'</td>' +
							'</tr>';
					}
					htmlTbody.append(htmlTr);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	//判空
	isNotEmpty:function(){
		var invoiceNumber=$('.invoice-number').val();
		var invoiceValue=$('.invoice-value').val();
		if (invoiceNumber==""&&invoiceValue=="") {
			$yt_valid.validForm($(".edit-bill-info-table"));
		}else{
			
		}
		
	},
//班级信息-------------------------------------------------------------------	
	/**
	 * 获取班级信息
	 */      
	getClassInfo:function() {
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type: "post",
			url: $yt_option.base_path + "class/getBeanByProjectCode",
			async: true,
			data: {
				projectCode: projectCode
			},
			objName: 'data',
			success: function(data) {
				if(data.flag == 0) {
					
					if(data.data.projectType==1){
						data.data.projectType="计划";
					}else if(data.data.projectType==2){
						data.data.projectType="委托";
					}else if(data.data.projectType==3){
						data.data.projectType="选学";
					}else if(data.data.projectType==4){
						data.data.projectType="调训";
					}
					$('.project-code').text(data.data.projectCode);
					$('.project-name').text(data.data.projectName);
					$('.project-type').text(data.data.projectType);
					$('.project-sell').text(data.data.projectSell);
					$('.start-date').text(data.data.startDate);
					$('.end-date').text(data.data.endDate);
					$('.train-date').text(data.data.trainDate);
					$('.customer-unit').text(data.data.customerUnit);
					$('.customer-dept').text(data.data.customerDept);
					$('.customer-linkman').text(data.data.customerLinkman);
					$('.customer-linkman-position').text(data.data.customerLinkmanPosition);
					$('.customer-linkman-phone').text(data.data.customerLinkmanPhone);
					$('.customer-linkman-cellphone').text(data.data.customerLinkmanCellphone);
					$('.customer-linkman-fax').text(data.data.customerLinkmanFax);
					$('.customer-linkman-email').text(data.data.customerLinkmanEmail);
					$('.customer-trainee-position').text(data.data.customerTraineePosition);
					$('.customer-trainee-sum').text(data.data.customerTraineeSum);
					$('.customer-trainee-age-structure').text(data.data.customerTraineeAgeStructure);
					$('.customer-target-demand').text(data.data.customerTargetDemand);
					$('.project-head').text(data.data.projectHead);
					$('.class-teacher').text(data.data.classTeacher);
					$('.project-aid').text(data.data.projectAid);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}
			}
		});
	}
	
};

$(function() {
	//初始化方法
	ticketOpenInfo.init();

});