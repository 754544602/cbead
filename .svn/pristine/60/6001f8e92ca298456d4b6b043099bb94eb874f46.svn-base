var mouldList={init:function(){mouldList.getTeachMouldInfo();$(".operate-file-box").undelegate().delegate("input","change",function(){var addFile=$(this).attr("id");var fileName=$(this).val().split('\\');var fm=fileName[fileName.length-1];var type=$(this)[0].files[0].type;var url=$yt_option.acl_path+"api/tAscPortraitInfo/addFile?modelCode=caFile";if(type=="application/vnd.openxmlformats-officedocument.wordprocessingml.document"){$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:addFile,success:function(data,textStatus){var resultData=$.parseJSON(data);var fileId=resultData.obj.pkId;if(resultData.success==0){$yt_alert_Model.prompt("附件上传成功");fileList=[resultData.obj.naming,fileId];$(".add-lecture-tb tbody").empty();var lineTrHtml='<tr class="file-tr-border-style"><input type="hidden" class="fileURL" value="'+$yt_option.acl_path+'api/tAscPortraitInfo/download?isDownload=true&pkId='+fileId+'"><td style="padding-left:10px;" class="fileName"><input type="hidden" class="file-span-id" value="'+fileId+'" ><input type="hidden" class="file-name" value="'+resultData.obj.naming+'" >'+resultData.obj.naming+'</td><td style="display:none;" class="lecture-tds"><img class="ioc-img" src="../../resources/images/open/yulan.png" /></td><td style="width: 40px;display:none;">预览</td><td class="lecture-tds" style="text-align:center;width:70px"><span style="cursor: pointer;" class="down-file"><img class="ioc-img" src="../../resources/images/open/xiazai2.png" />下载</span></td></tr>';$(".add-lecture-tb tbody").append(lineTrHtml)}else{$yt_alert_Model.prompt("附件上传失败")}$("#"+addFile).val("")},error:function(data,status,e){$yt_alert_Model.prompt("附件上传失败!");$("#"+addFile).val("")}})}else{$yt_alert_Model.prompt("请上传word类型的文档",3000)}});$('.down-files tbody').on('click',".down-file",function(){var filePkId=$(this).parent().parent().find('.file-span-id').val();var fileURL=$(this).parent().parent().find('.fileURL').val();$.ajaxDownloadFile({url:fileURL})});},addFile:function(){var trHtml=$(".add-lecture-tb tbody tr");var teachingPlantemplatId=$('.teaching-plantemplat-id').val();var fileId=trHtml.find('.file-span-id').val();var fileName=trHtml.find('.file-name').val();var fileUrl=trHtml.find('.fileURL').val();var filesJson={teachingPlantemplatId:teachingPlantemplatId,fileId:fileId,fileName:fileName,fileUrl:fileUrl};var files=JSON.stringify(filesJson);var remark=$('.remark').val();$.ajax({type:"post",url:$yt_option.base_path+"class/teachingTemplate/getTemplate",data:{files:files,remarks:remark,templateId:teachingPlantemplatId},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作失败")})}}})},getTeachMouldInfo:function(){$yt_baseElement.showLoading();var templateId=$yt_common.GetQueryString("templateId");$.ajax({type:"post",url:$yt_option.base_path+"class/teachingTemplate/getTemplate",data:{templateId:templateId},success:function(data){if(data.flag==0){if(data.data.length>0){var v=data.data.files;$(".add-lecture-tb tbody").empty();var lineTrHtml='<tr class="file-tr-border-style"><input type="hidden" class="fileURL" value="'+v.fileUrl+'"><td style="padding-left:10px;" class="fileName"><input type="hidden" class="file-span-id" value="'+v.fileId+'" ><input type="hidden" class="file-name" value="'+v.fileName+'" >'+v.fileName+'</td><td style="display:none;" class="lecture-tds"><img class="ioc-img" src="../../resources/images/open/yulan.png" /></td><td style="width: 40px;display:none;">预览</td><td class="lecture-tds" style="text-align:center;width:70px"><span style="cursor: pointer;" class="down-file"><img class="ioc-img" src="../../resources/images/open/xiazai2.png" />下载</span></td></tr>';$(".add-lecture-tb tbody").append(lineTrHtml);$('.remark').val(data.data.remarks);$('.teaching-plantemplat-id').val(v.teachingPlantemplatId)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})}};$(function(){mouldList.init()});