var adjustPrintObj={getDataList:[],init:function(){var appId=$yt_common.GetQueryString('expenditureAppId');var costType=$yt_common.GetQueryString('costType');adjustPrintObj.events();adjustPrintObj.downloadFileAppId(appId);switch(costType){case 'TRAIN_APPLY':adjustPrintObj.getPrintTrainInfo(appId);break;case 'MEETING_APPLY':break;case 'BH_APPLY':break;case 'NORMAL_APPLY':break};$("input.code-inpu").startListen({letter:true,check:false,show:function(code){if(code!=""&&code&&code!=undefined&&code!=null){var subStr=code.substring(0,7);if(subStr=="http://"){window.open(code)}else{$yt_alert_Model.prompt("二维码识别不成功,请联系管理员!")}}else{$yt_alert_Model.prompt("二维码识别不成功,请联系管理员!")}}})},events:function(){$("#printBtn").off().on("click",function(){adjustPrintObj.doPrint()});$("#closeBtn").off().on("click",function(){if(window.top==window.self){window.close()}else{parent.closeWindow()}});if($('.before-cause,.train-name').innerHeight()>50){$('.before-cause,.train-name').css('padding','0px')};if($('.before-cause,.train-name').innerHeight()>55){$('.before-cause,.train-name').css('font-size','12px')}},printFormBaseInfo:function(expenditureAppId){$.ajax({type:"post",url:"sz/expenditureApp/printSpendingFormDetailsByExpenditureAppId",async:true,data:{expenditureAppId:expenditureAppId},success:function(data){var datas=data.data;if(data.flag==0){adjustPrintObj.printInvoice(datas)}}})},getPrintTrainInfo:function(advanceAppId){$.ajax({type:"post",url:"sz/advanceAppUpdate/printTrainFormDetailsByAdvanceAppIdUpdate",async:true,data:{advanceAppId:advanceAppId},success:function(data){var datas=data.data;if(data.flag==0){adjustPrintObj.getDataList=datas;adjustPrintObj.printInvoiceTrain(datas);var afterTaxAllMoney='';$.each(datas.applicationFee.predictCostList,function(i,n){afterTaxAllMoney+=n.amount});$(".surcharge").text($yt_baseElement.fmMoney(afterTaxAllMoney*0.03*0.12));$(".added-tax-value").text($yt_baseElement.fmMoney(afterTaxAllMoney*0.03))}}})},downloadFileAppId:function(expenditureAppId){var imgSrc='';$.ajax({type:"post",url:"fileUpDownload/createQrCode",async:true,data:{context:$yt_option.websit_path+'barCode/adjustDetail.html?appId='+expenditureAppId},success:function(data){imgSrc=data.data;$('.qr-code').attr('src',$yt_option.base_path+'fileUpDownload/downloadFile?storePath='+imgSrc+'&isDownload=false')}})},printInvoiceBh:function(data){var html='';var total=0;$('.recipients-number').text(data.receptionDetailsData.receptionTotalNum);var list=data.receptionDetailsData.receptionList;$.each(list,function(i,n){html+='<tr><td>'+n.publicServiceProName+'</td><td>'+n.activityDate+'</td><td>'+n.costTypeName+'</td><td>'+$yt_baseElement.fmMoney(n.activityAmount)+'</td><td>'+n.peopleNum+'</td></tr>'});var len=list.length+2;$('.expenditure-receivables-detailed').attr("rowspan",len);$('.reception-table tbody').append(html)},printInvoice:function(data){var me=this;$(".bill-cause").text(data.expenditureAppName);$(".apply-user").text(data.applicantUserName);$(".apply-department").text(data.applicantUserDeptName);$(".post-apply").text(data.applicantUserJobLevelName);$(".apply-phone").text(data.applicantUserPhone);$("#costTypeName").text(data.costTypeName);$("#specialName").text(data.specialName);$(".pay-money").text('￥'+$yt_baseElement.fmMoney(data.expTotalAmount));$(".normal-total-amount").text('￥'+$yt_baseElement.fmMoney(data.totalAmount));$(".year").text(data.printYear);$(".month").text(data.printMonth);$(".day").text(data.printDay);$("#expenditureAppNum").text(data.expenditureAppNum);me.setExpReceivablesListList(data.expReceivablesList);me.setNormalDetailsListList(data.normalDetailsList);me.setRecordOfApprovalListList(data.recordOfApprovalList)},printInvoiceTrain:function(data){var me=this;$(".year").text(data.printYear);$(".month").text(data.printMonth);$(".day").text(data.printDay);$("#expenditureAppNum").text(data.advanceAppNum);$(".before-cause").text(data.advanceAppName);$(".apply-date").text(data.applicantTime);$(".apply-users").text(data.applicantUserName);$(".users-job").text(data.applicantUserPositionName);$(".users-dept").text(data.applicantUserDeptName);$(".users-tel").text(data.applicantUserPhone);$(".cost-type").text(data.advanceCostTypeName);$(".apply-money").text($yt_baseElement.fmMoney(data.advanceAmount));$(".apply-money-upper").text(arabiaToChinese(data.advanceAmount));$(".by-budget-prj").text(data.specialName+(data.prjName?'-'+data.prjName:data.prjName));$(".dept-money").text($yt_baseElement.fmMoney(data.deptBudgetBalanceAmount));$(".unit-money").text($yt_baseElement.fmMoney(data.budgetBalanceAmount));$(".prj-name").text(data.applicationMatters.regionDesignation);$(".address-info").text(data.applicationMatters.regionName);$(".train-approva-num").text(data.applicationMatters.approvaNum);$(".train-charge-standard").text($yt_baseElement.fmMoney(data.applicationMatters.chargeStandard));$(".start-date").text(data.applicationMatters.reportTime);$(".end-date").text(data.applicationMatters.endTime);$(".stu-num").text(data.applicationMatters.trainOfNum);$(".work-num").text(data.applicationMatters.workerNum);$(".advance-amount").text($yt_baseElement.fmMoney(data.advanceAmount));$(".teachers-amount").text($yt_baseElement.fmMoney(data.applicationFee.teachersAmount));$(".train-other-amount").text($yt_baseElement.fmMoney(data.applicationFee.trainOtherAmount));$(".train-name").text(data.applicationFee.regionDesignation);$(".train-sum-money").text($yt_baseElement.fmMoney(data.advanceAmount));$(".adj-before").text($yt_baseElement.fmMoney(data.taxChangeData.changeBeforeAmount));$(".adj-after").text($yt_baseElement.fmMoney(data.taxChangeData.changeAfterAmount));$("#taxAmount").text($yt_baseElement.fmMoney(data.taxChangeData.changeAmount));me.setTeachersCostList(data.applicationFee.teachersCostList);me.setTrainOtherList(data.applicationFee.trainOtherList);me.setRecordOfApprovalListList(data.recordOfApprovalList);me.setChangeList(data.changeList);me.setPredictCostList(data.applicationFee.predictCostList)},setPredictCostList:function(list){var me=this;var predictHtml='';$.each(list,function(i,n){predictHtml+='<td class="font-bold">预计收费情况</td><td>'+$yt_baseElement.fmMoney(n.predictStandardMoney)+'</td><td>'+n.predictPeopleNum+'</td><td></td><td style="text-align: right;" class="font-bold"><span>'+$yt_baseElement.fmMoney(n.amount)+'</span></td><td><div class="yt-table-br">收费标准*预计学员人数/(1+3%)</div></td>'});$('#teachersCostList tbody .predict-tr').before(predictHtml)},setChangeList:function(list){var me=this;var receHtml='';var total=0;$.each(list,function(i,n){receHtml+='<tr><td>'+n.changeProject+'</td><td style="text-align: right;"><span>'+$yt_baseElement.fmMoney(n.changeBeforeAmount)+'</span></td><td style="text-align: right;"><span>'+$yt_baseElement.fmMoney(n.changeAfterAmount)+'</span></td><td style="text-align: right;"><span>'+$yt_baseElement.fmMoney(n.changeAmount)+'</span></td><td><div class="yt-table-br">'+n.changeReason+'</div></td></tr>';total+=n.changeAmount});var len=list.length+3;$('.remunera-money').text(total?$yt_baseElement.fmMoney(total):$yt_baseElement.fmMoney(0));$('.adjustment-tby').attr("rowspan",len);$('.adjustment-table tbody .last').before(receHtml)},setTeachersCostList:function(list){var me=this;var receHtml='';$.each(list,function(i,n){var amount='0.00';if(n.amount){amount=$yt_baseElement.fmMoney(n.amount)}receHtml+='<tr class="small-td"><td>'+n.costTypeName+'</td><td></td><td></td><td></td><td style="text-align: right;"><span>'+amount+'</span></td><td></td></tr>'});$('#teachersCostList tbody .train-other-tr').before(receHtml)},setTrainOtherList:function(list){var me=this;var receHtml='';$.each(list,function(i,n){var standard='';var trainOfNum='';var trainDays='';var amount='0.00';if(n.standard!='0.00'){standard=$yt_baseElement.fmMoney(n.standard)}if(n.trainOfNum!='0'){trainOfNum=n.trainOfNum}if(n.trainDays!='0'){trainDays=n.trainDays}if(n.amount!='0.00'){amount=$yt_baseElement.fmMoney(n.amount)}receHtml+='<tr class="small-td"><td>'+n.costTypeName+'</td><td style="text-align: right;"><span>'+standard+'</span></td><td>'+trainOfNum+'</td><td>'+trainDays+'</td><td style="text-align: right;"><span>'+amount+'</span></td><td style="text-align: left;">'+n.remark+'</td></tr>'});receHtml+='<tr><td class="font-bold">应缴附加费</td><td style="text-align: right;"><span>12%</span></td><td></td><td></td><td style="text-align: right;" class="font-bold"><span class="surcharge">'+$yt_baseElement.fmMoney(adjustPrintObj.incomeTotal*0.03*0.12)+'</span></td><td style="text-align: left;"></td></tr>';var len=0;var rowspan= +$('.detail-tby').attr("rowspan");if(adjustPrintObj.getDataList.applicationFee.hasOwnProperty('predictCostList')&&adjustPrintObj.getDataList.applicationFee.predictCostList.length>0){len=list.length+rowspan+1}else{len=list.length+rowspan}$('.detail-tby').attr("rowspan",len);$('#teachersCostList tbody .added-tax-value').text($yt_baseElement.fmMoney(adjustPrintObj.incomeTotal*0.03));$('#teachersCostList tbody .train-sum-tr').before(receHtml)},setRecordOfApprovalListList:function(list){var html='';var total=0;var i=0;$.each(list,function(i,n){html+='<tr><td>'+(i+1)+'</td><td style="text-align: left;"><span class="nodeName">【'+n.nodeName+'】</span>——<span class="nodeUserName">'+n.nodeUserName+'</span></td><td class="" style="text-align: left;padding-left: 15px;">';$.each(n.approvaInfoList,function(v,j){html+='<div style="'+(v==n.approvaInfoList.length-1?'font-weight: bold;':'')+'"><span class="approvaDate">'+j.approvaDate+'</span><span class="approvaState" style="padding-left: 10px;">'+j.approvaState+'</span>，意见：<span class="approvaRemarks">'+(j.approvaRemarks||'无')+'</span></div>'});html+='</td></tr>'});var len=list.length+1;$('.approval-record').attr("rowspan",len);$('.approval-record-table tbody').append(html)},doPrint:function(){bdhtml=window.document.body.innerHTML;startInvoicePasting="<!--startInvoicePasting-->";endInvoicePasting="<!--endInvoicePasting-->";prnhtml=bdhtml.substr(bdhtml.indexOf(startInvoicePasting));prnhtml=prnhtml.substring(0,prnhtml.indexOf(endInvoicePasting));window.document.body.innerHTML=prnhtml;window.focus();if(adjustPrintObj.isIE()){document.body.className+=' ext-ie';document.execCommand('print',false,null)}else{window.print()}window.document.body.innerHTML=bdhtml;window.location.reload()},isIE:function(){if(!!window.ActiveXObject||"ActiveXObject"in window){return true}else{return false}}};$(function(){adjustPrintObj.init()});