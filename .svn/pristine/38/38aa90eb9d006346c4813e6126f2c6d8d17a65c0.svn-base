var executeQueryObj={init:function(){$("select").niceSelect();$("#executeQuery").css("min-height",$(window).height()-55+"px");executeQueryObj.getQueryParamData()},getQueryParamData:function(){$.ajax({type:"post",url:"budget/main/getBudgetYear",async:true,success:function(data){if(data.flag==0){$("select.budget-year-sel").empty();var optionStr='';$.each(data.data,function(i,n){optionStr+='<option value="'+(i+1)+'">'+n.budgetYear+'</option>'});$("select.budget-year-sel").append(optionStr);$("select.budget-year-sel").niceSelect();executeQueryObj.getBudgetDataInfo($("select.budget-year-sel option:selected").text());$("select.budget-year-sel").change(function(){var thisYear=$(this).find("option:selected").text();executeQueryObj.getBudgetDataInfo(thisYear,$("select.unit-sel").val())})}}});$.ajax({type:"post",url:"user/userInfo/getAllDeptsInfo",async:true,success:function(data){if(data.flag==0){var list=data.data||[];$("select.unit-sel").empty();var optionStr='<option value="">全部</option>';if(list.length>0){$.each(list,function(i,n){if(n.type=="2"){optionStr+='<option value="'+n.id+'">'+n.text+'</option>'}})}$("select.unit-sel").append(optionStr).niceSelect();executeQueryObj.getBudgetDataInfo($("select.budget-year-sel option:selected").text());$("select.unit-sel").change(function(){var thisUnit=$(this).val();executeQueryObj.getBudgetDataInfo($("select.budget-year-sel option:selected").text(),thisUnit)})}}})},getBudgetDataInfo:function(yearVal,unitVal){yearVal=(yearVal==undefined?"":yearVal);unitVal=(unitVal==undefined?"":unitVal);$.ajax({type:"post",url:"budget/main/getBudgetExecuteTableDataInfo",async:true,data:{budgetYear:yearVal,deptId:unitVal},success:function(data){if(data.flag==0){var datas=executeQueryObj.getTreeData(data.data,'-1',"specialCode","parentCode");$('#budgetTab').treegrid("loadData",datas)}else{$yt_alert_Model.prompt(data.message)}}})},getTreeData:function(data,parentId,code,parentCode){code=code?code:'id';parentCode=parentCode?parentCode:'parentId';var me=this;var result=[],temp;for(var i in data){if(data[i][parentCode]==parentId){result.push(data[i]);temp=me.getTreeData(data,data[i][code],code,parentCode);if(temp.length>0){data[i].children=temp}}}return result},eventInit:function(){}};$(function(){executeQueryObj.init();$('#budgetTab').treegrid({idField:'specialCode',treeField:'specialName',columns:[[{title:'预算科目',field:'specialName',width:'25%',align:'center'},{title:'预算额(万元)',field:'totalAmount',width:'15%',align:'center',formatter:function(value,row,index,num){return '<span style="float: right;display: inline;">'+(value==""?"0.00":$yt_baseElement.fmMoney(value))+'</span>'}},{title:'已执行预算额(万元)',field:'executeAmount',width:'15%',align:'center',formatter:function(value,row,index,num){return '<span style="float: right;display: inline;">'+(value==""?"0.00":$yt_baseElement.fmMoney(value))+'</span>'}},{title:'预算与已执行的差额(万元)',field:'differenceAmount',width:'15%',align:'center',formatter:function(value,row,index,num){return '<span style="float: right;display: inline;">'+(value==""?"0.00":$yt_baseElement.fmMoney(value))+'</span>'}},{title:'待执行预算额(万元)',field:'unExecuteAmount',width:'15%',align:'center',formatter:function(value,row,index,num){return '<span style="float: right;display: inline;">'+(value==""?"0.00":$yt_baseElement.fmMoney(value))+'</span>'}},{title:'执行进度',field:'percentExecute',width:'16%',align:'center',formatter:function(value,row,index,num){var planStr='<div class="plan-div" style="background: #c2c1c1;width: 100%;"><div class="plan-div percentExecute" style="background: blue;width:'+row.percentExecute+'"></div><div class="plan-div percentUnExecute" style="background: orange;width:'+row.percentUnExecute+'"></div></div>';return planStr}}]]})});