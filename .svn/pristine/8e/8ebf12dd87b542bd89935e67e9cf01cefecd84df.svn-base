var curriculumList={init:function(){var me=this;$("select").niceSelect();$("#txtDate").calendar({speed:200,complement:true,readonly:true,lowerLimit:"2010/01/01",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){me.teachingShare($("#txtDate").val())}});$(".change-week span").click(function(){var current=$("#txtDate").val();if($(this).index()==0){current=ytDate.prevWeek(current)}else if($(this).index()==1){current=ytDate.formatDate(new Date())}else{current=ytDate.nextWeek(current)}$("#txtDate").val(current);me.teachingShare(current)});$(".course-date-start").calendar({controlId:"startDate",nowData:false,upperLimit:$(".course-date-end")});$(".course-date-end").calendar({controlId:"endDate",nowData:false,lowerLimit:$(".course-date-start")});$(".tab-title-list button").click(function(){$(this).addClass("active").siblings().removeClass("active");$(".box-list .content-box").hide().eq($(this).index()).show();if($(this).index()==0){this.teachingShare($("#txtDate").val())}else if($(this).index()==1){curriculumList.getCurriculumListInfo()}});$('.page-return-btn').off().on('click',function(){window.location.href="classMg.html"});var clickNumber=0;$('.search-more').click(function(){if(clickNumber%2==0){$('.search-box').show();$('.search-put').addClass('flipy')}else{$('.search-box').hide();$('.course-date-start').val("");$('.course-date-end').val("");$('.project-code').val("");$('.project-name').val("");$('.course-name').val("");$('.project-state-box').each(function(){$(this).find("option:eq(0)").prop("selected","selected")});$('.teacher-name').val("");$('.grade-start').val("");$('.grade-end').val("");$('.project-user-name').val("")}clickNumber+=1});$('.yt-model-reset-btn').click(function(){$('.course-date-start').val("");$('.course-date-end').val("");$('.project-code').val("");$('.project-name').val("");$('.course-name').val("");$(".course-type-code").setSelectVal("");$('.teacher-name').val("");$('.grade-start').val("");$('.grade-end').val("");$('.project-user-name').val("")});$('.search-box .yt-model-sure-btn').click(function(){var projectCode=$('.search-box .project-code').val();var projectName=$('.search-box .project-name').val();var courseName=$('.search-box .course-name').val();var teacherName=$('.search-box .teacher-name').val();curriculumList.getCurriculumListInfo(projectCode,projectName,courseName,teacherName)});$('.search-btn').click(function(){curriculumList.getCurriculumListInfo()});me.teachingShare($("#txtDate").val())},getCurriculumListInfo:function(projectCode,projectName,courseName,teacherName){$yt_baseElement.showLoading();var projectUserName=$('.search-box .project-user-name').val();var courseDateStart=$('.search-box .course-date-start').val();var courseDateEnd=$('.search-box .course-date-end').val();var courseTypeCode=$('.search-box .course-type-code').val();var gradeStart=$('.search-box .grade-start').val();var gradeEnd=$('.search-box .grade-end').val();var slectParam=$('.keyword').val();$('.curriculum-page').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/course/lookForCourseAll",type:"post",data:{courseDateStart:courseDateStart,courseDateEnd:courseDateEnd,projectCode:projectCode,projectName:projectName,courseName:courseName,courseTypeCode:courseTypeCode,teacherName:teacherName,gradeStart:gradeStart,gradeEnd:gradeEnd,slectParam:slectParam,projectUserName:projectUserName},objName:'data',success:function(data){$yt_baseElement.showLoading();if(data.flag==0){var htmlTbody=$('.curriculum-tbody');var htmlTr='';var num=1;if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){htmlTr+='<tr><td>'+num++ +'</td><td>'+v.projectCode+'</td><td style="text-align: left;">'+v.projectName+'</td><td>'+v.courseDate+'</td><td class="text-overflow" style="text-align: left;">'+v.courseName+'</td><td class="text-overflow" style="text-align: left;">'+v.courseTypeName+'</td><td style="text-align: left;">'+v.teacherName+'</td><td style="text-align: left;">'+v.projectUserName+'</td><td style="text-align: right;">'+v.grade+'</td></tr>'})}else{$(".curriculum-page").hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},setWeekHead:function(){var me=this;var currentDate=$("#txtDate").val();var weekList=ytDate.startStop(currentDate);$(".state-day").remove();$(".programme thead tr").append('<th class="state-day"><div>星期一<span>'+(new Date(weekList[0]).getDate())+'日</div></span></th>');$(".programme thead tr").append('<th class="state-day"><div>星期二<span>'+(new Date(weekList[1]).getDate())+'日</div></span></th>');$(".programme thead tr").append('<th class="state-day"><div>星期三<span>'+(new Date(weekList[2]).getDate())+'日</div></span></th>');$(".programme thead tr").append('<th class="state-day"><div>星期四<span>'+(new Date(weekList[3]).getDate())+'日</div></span></th>');$(".programme thead tr").append('<th class="state-day"><div>星期五<span>'+(new Date(weekList[4]).getDate())+'日</div></span></th>');$(".programme thead tr").append('<th class="state-day"><div>星期六<span>'+(new Date(weekList[5]).getDate())+'日</div></span></th>');$(".programme thead tr").append('<th class="state-day"><div>星期日<span>'+(new Date(weekList[6]).getDate())+'日</div></span></th>');return weekList},teachingShare:function(currentDate){var weekList=this.setWeekHead();$yt_baseElement.showLoading();$.ajax({type:"post",url:"class/teachingShare/lookForAll",async:true,data:{selectDate:currentDate,selectWeek:0,dateTypes:'1,2,3'},success:function(data){if(data.flag==0){var programmeList=$(".programme tbody").empty();if(data.data.length>0){var weekDoc='<td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td>';var programme='';var arrIndex,stateObj;$.each(data.data,function(i,n){programme='<tr class="morning"><td rowspan="3">'+n.projectName+'</td><td class="tc">上午</td>'+weekDoc+'</tr><tr class="afternoon"><td class="tc">下午</td>'+weekDoc+'</tr><tr class="night"><td class="tc">晚上</td>'+weekDoc+'</tr>';programme=$(programme).data("classInfo",n);$.each(n.courseData,function(j,m){arrIndex=$.inArray(m.courseDate,weekList);if(arrIndex!=-1){stateObj=programme.eq(parseInt(m.dateType)-1).find(".state-day").eq(arrIndex).data("arrIndex",arrIndex);stateObj.addClass("have-couse").append('<div class="teacher-name">'+m.teacherName+'</div>').attr("colspan",1).data("teacherId",n.teacherId).append($('<div class="tool-info"></div>').data("courseData",m))}});programmeList.append(programme)});var haveCouseDoc,colspan,courseData,currentData;$(".have-couse").each(function(i,n){if($(n).prev().hasClass('have-couse')&&$(n).prev().find("div.tool-info").data("courseData").teacherId==$(n).find("div.tool-info").data("courseData").teacherId){colspan=$(this).prev().attr("colspan");colspan=parseInt(colspan)+1;if($(this).prev().find(".tool-box").length==0){$(this).prev().append($('<div class="tool-box"></div>').append($(this).prev().find(".tool-info")))}$(this).prev().attr("colspan",colspan).find(".tool-box").append($(this).find("div"));$(this).remove()}else{$(this).append($('<div class="tool-box"></div>').append($(this).find(".tool-info")))}});$(".tool-box .teacher-name").remove();$('.have-couse div.tool-info').tooltip({position:'bottom',content:function(){var courseData=$(this).data("courseData");var showBox='<div class="tip-box" style="width:264px"><table class="tip-table"><tr><td class="tip-lable" width="72px">课程主题：</td><td>'+courseData.courseName+'</td></tr><tr><td class="tip-lable">授课教师：</td><td>'+courseData.teacherName+'</td></tr><tr><td class="tip-lable">单位职称：</td><td>'+courseData.classroomNames+'</td></tr><tr><td class="tip-lable">工作单位：</td><td>'+courseData.org+'</td></tr><tr><td class="tip-lable">上课时间：</td><td>'+courseData.courseTime+'</td></tr><tr><td class="tip-lable">课程教室：</td><td>'+courseData.classroomNames+'</td></tr><tr><td class="tip-lable">项目主任：</td><td>'+courseData.projectHead+'</td></tr><tr><td class="tip-lable">班主任：</td><td>'+courseData.classTeacher+'</td></tr></table></div>';return showBox},onShow:function(){$(this).tooltip('tip').css({backgroundColor:'#666',borderColor:'#666'})}})}else{var htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';programmeList.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作失败,请稍后重试")})}},error:function(data){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("网络出现问题,请稍后重试")})}})}};var ytDate={formatDate:function(date){var myyear=date.getFullYear();var mymonth=date.getMonth()+1;var myweekday=date.getDate();if(mymonth<10){mymonth="0"+mymonth}if(myweekday<10){myweekday="0"+myweekday}return(myyear+"-"+mymonth+"-"+myweekday)},startStop:function(obj){var me=this;var startStop=[];var currentDate=new Date(obj);var weekday=currentDate.getDay()||7;currentDate.setDate(currentDate.getDate()-weekday);for(var i=0;i<7;i+=1){currentDate.setDate(currentDate.getDate()+1);startStop.push(me.formatDate(currentDate))}return startStop},nextWeek:function(obj){var me=this;var currentDate=new Date(obj);currentDate.setDate(currentDate.getDate()+7);return me.formatDate(currentDate)},prevWeek:function(obj){var me=this;var currentDate=new Date(obj);currentDate.setDate(currentDate.getDate()-7);return me.formatDate(currentDate)}};$(function(){curriculumList.init()});