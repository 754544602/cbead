var projectList={init:function(){projectList.getOneListInfo();var type=$yt_common.GetQueryString("type");$('.back-btn').click(function(){if(type==1){window.location.href="reimburseExamination.html"}else{window.location.href="reimbursementList.html"}});$(".check-label input[type='radio']").change(function(){var rad=$(this).val();if(rad=="completed"){$('.hid-input').show()};if(rad=="returnedSubmit"){$('#nextPeople').val("");$('.hid-input').hide()}});$('#last-submit').click(function(){var pkId=$yt_common.GetQueryString('pkId');var processInstanceId=$('.processInstanceId').val();var dealingWithPeople=$('#nextPeople').val();var tastKey=$('#tastKey').val();if(tastKey=="activitiEndTask"){dealingWithPeople=""}var opintion=$('#opintion').val();var nextCode=$('input[name="radioType"]:checked ').val();if(nextCode=="returnedSubmit"){dealingWithPeople=""}$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/updateApplyClassExpense",async:false,data:{pkId:pkId,businessCode:"classExpense",dealingWithPeople:dealingWithPeople,opintion:opintion,processInstanceId:processInstanceId,nextCode:nextCode},objName:'data',success:function(data){if(data.flag==0){}}});window.location.href="reimburseExamination.html"});$('#last-cancel').click(function(){window.location.href="reimburseExamination.html"});var getAllNextPeople=projectList.getListSelectDealingWithPeople();if(getAllNextPeople!=null){$.each(getAllNextPeople,function(i,n){$("#nextPeople").append('<option value="'+n.userCode+'">'+n.userName+'</option>')})};$("#nextPeople").niceSelect()},getListSelectDealingWithPeople:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"project",processInstanceId:"",parameters:"",versionNum:""},async:false,success:function(data){$.each(data.data,function(i,n){for(var k in n){console.log('k',k);console.log("n[k]",n[k]);list=n[k]}})}});return list},getOneListInfo:function(){var me=this;$yt_baseElement.showLoading();var pkId=$yt_common.GetQueryString("pkId");var projectCode;$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/getBeanByIdTravel",async:false,data:{pkId:pkId},objName:'data',success:function(data){if(data.flag==0){$('.processInstanceId').val(data.data.processInstanceId);projectCode=data.data.projectCode;$('#projectName').text(data.data.projectName);$('#projectCode').text(projectCode);$('#flowNumber').text(data.data.flowNumber);$('#projectHead').text(data.data.projectHead);$('#createUser').text(data.data.createUser);$('#createTimeString').text(data.data.createTimeString);$('.state-type').text(data.data.workFlawState);$('#missionId').text(data.data.remarks);$('#cheque-number').text(data.data.chequeNumber);$('#amount-money').text(data.data.chequeNumberMoney);$('#budgetId').text('部门培训费');$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/getTeacherTrainDetails",async:false,data:{projectCode:projectCode},success:function(data){if(data.flag==0){me.getList=data.data;var htmlTbody=$('.class-tbody');var htmlTr='';htmlTbody.empty();if(data.data.length>0){var num=0;var allTravelmoney=0;var salesPriceSum=0;var refundSigningFeeSum=0;var expenseMoneySum=0;var checksalesPriceSum=0;var checkrefundSigningFeeSum=0;var checkexpenseMoneySum=0;$.each(data.data,function(i,v){allTravelmoney=parseInt(v.salesPrice)+parseInt(v.insurance)+parseInt(v.refundSigningFee);salesPriceSum+=parseInt(v.salesPrice);refundSigningFeeSum+=parseInt(v.refundSigningFee);expenseMoneySum+=allTravelmoney;if(v.papersType==1){v.papersTypeVel='身份证'}if(v.papersType==2){v.papersTypeVel='护照'}if(v.papersType==3){v.papersTypeVel='港澳通行证'}else{v.papersTypeVel=' '}if(v.paymentMethod==1){v.paymentMethodVel='支票';checksalesPriceSum+=parseInt(v.salesPrice);checkrefundSigningFeeSum+=parseInt(v.refundSigningFee);checkexpenseMoneySum+=allTravelmoney}if(v.paymentMethod==2){v.paymentMethodVel='电汇'}if(v.paymentMethod==3){v.paymentMethodVel='归还公务卡'}if(v.paymentMethod==4){v.paymentMethodVel='现金'}if(v.paymentMethod==5){v.paymentMethodVel='核销借款'}if(v.flighttrainNumber==undefined){v.flighttrainNumber=''}num=i+1;var bookingRecord='';$.each(v.bookingRecord,function(x,y){bookingRecord+='<div teacherStatementDetailsId="'+y.teacherStatementDetailsId+'">'+y.teacherStatementDetails+'</div>'});htmlTr='<tr  class="rows tr'+i+' row'+i+'" teacherId="'+v.teacherId+'">'+'<td style="text-align:center">'+num+'</td>'+'<td style="text-align:center">'+v.teacherName+'</td>'+'<td style="text-align:center">'+v.flighttrainNumber+'</td>'+'<td>'+v.placeDeparture+'</td>'+'<td>'+v.bourn+'</td>'+'<td>'+v.startEndTime+'</td>'+'<td style="text-align:right" class="salesPriceTd">'+v.salesPrice+'</td>'+'<td style="text-align:right" class="insurance">'+v.insurance+'</td>'+'<td style="text-align:right" class="refundSigningFeeTd">'+v.refundSigningFee+'</td>'+'<td class="allTravelmoney" style="text-align:right">'+allTravelmoney+'</td>'+'<td style="text-align:center"><span class="paymentMethod">'+v.paymentMethodVel+'</span></td > '+'<td style="text-align:center" class="bookingRecord">'+bookingRecord+'</td></tr>';htmlTbody.append(htmlTr);v.num=i;console.log(v);$('.tr'+i).data('trData',v);if($('.tr'+i).find('.select-hide').val()==2){var data=$('.tr'+i).data('trData');var all=$('.tr'+i).find('.allTravelmoney').text();me.addTwoInfo(data,all);addAll()}});var numb=num+1;htmlTr='<tr><td class="numb" style="display:none;">'+numb+'</td><td colspan="6" style="text-align:center">合计：</td><td class="salesPriceSum"  style="text-align:right;font-weight:bold">'+salesPriceSum+'</td><td></td><td id="refundSigningFeeSum" style="text-align:right;font-weight:bold">'+refundSigningFeeSum+'</td><td id="expenseMoneySum" style="text-align:right;font-weight:bold">'+expenseMoneySum+'</td><td></td><td></td></tr><tr><td class="numb" style="display:none;">'+numb+'</td><td colspan="6" style="text-align:center">支票合计：</td><td class="checksalesPriceSum"  style="text-align:right;font-weight:bold">'+checksalesPriceSum+'</td><td></td><td id="checkrefundSigningFeeSum" style="text-align:right;font-weight:bold">'+checkrefundSigningFeeSum+'</td><td id="checkexpenseMoneySum" style="text-align:right;font-weight:bold">'+checkexpenseMoneySum+'</td><td></td><td></td></tr>';htmlTbody.append(htmlTr)}else{htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="11" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$('select').niceSelect();$('.select-hide').hide();$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}projectList.getProjectSurplusBudget()},isSelPageNum:true });$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/getTeacherTrainDetails",async:false,data:{selectParam:"",projectCode:projectCode},success:function(data){$("#surplusId").text(data.data.projectSurplusBudget)}});if(data.data.flowLog!=""){$(".approve-title").show();$(".approve-box").show();var flowLog=JSON.parse(data.data.flowLog);var middleStepHtml;var length=flowLog.length;$.each(flowLog,function(i,v){$('#tastKey').val(v.tastKey);if(v.tastKey=="activitiEndTask"){$('.next-operate-person-tr').hide()}if(i==0){$('.last-step-order').text(length);$('.last-step-operate-person-userName').text(v.userName);$('.last-step-operationState').text(v.taskName);$('.last-step-commentTime').text(v.commentTime)};if(i==length-1){$('.first-step-order').text(1);$('.first-step-operate-person-userName').text(v.userName);$('.first-step-taskName').text(v.taskName);$('.first-step-commentTime').text(v.commentTime);$('.first-step-comment').text(v.comment)};if(i!=0&&i!=length-1){var order=length-i;middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+v.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+v.taskName+'</span></li><li class="view-time-li middle-step-commentTime" style="width:200px;right:3%;left:auto">'+v.commentTime+'</li><li class="operate-view-box-li" style="width:97%"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment">'+v.comment+'</div></li></ul></div></div>';$('.last-step').append(middleStepHtml)}})}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},addTwoInfo:function(data,all){var htmlBody=$('#two-table');var htmlTr='';htmlBody.empty();data.papersNumber==undefined?data.papersNumber='':data.papersNumber=data.papersNumber;htmlTr='<tr class="twoTr twoTr'+data.num+'"><td style="text-align:center">'+(data.num+1)+'</td><td style="text-align:center">'+data.teacherName+'</td><td style="text-align:center">'+data.papersTypeVel+'</td><td>'+data.papersNumber+'</td><td>'+data.registeredBank+'</td><td>'+data.account+'</td><td style="text-align:center">电汇</td><td style="text-align:right" class="twotablemoney" >'+all+'</td></tr>';htmlBody.append(htmlTr)}};$(function(){projectList.init()});