var carList={init:function(){var back=$yt_common.GetQueryString("back");if(back==1){var searchUrl=window.location.href;var hrefData=searchUrl.split("=");$('#keyword').val(decodeURI(hrefData[3]))}carList.getPlanListInfo();$('.key-word').off().on('click','.search-btn',function(){carList.getPlanListInfo()});$(".merge").click(function(){var traineeId="";if($('.select-assets-alert-checkbox input[class="select-assets-trainee-id"]:checked').length>2){$yt_alert_Model.prompt("请选中两条记录进行操作",3000);return false}$('.select-assets-alert-checkbox input[class="select-assets-trainee-id"]:checked').each(function(){if(traineeId==""){traineeId=$(this).val()}else{traineeId+=","+$(this).val()}});if(traineeId==""){$yt_alert_Model.prompt("请选中两条记录进行操作",3000)}else{$yt_alert_Model.alertOne({alertMsg:"合并后无法恢复，学员的基本信息将以最新的为准，是否合并？",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"trainee/updateTraineMergeEvisitingRecords",data:{pkIds:traineeId},async:false,success:function(data){$yt_alert_Model.prompt("合并成功！",2000);carList.getPlanListInfo()}})}})}});$('.list-table').on('click','.trainee-name',function(){var keyword=$('#keyword').val();var traineeId=$(this).parent().find(".trainee-id").text();var pageNum=$('.num-text.change-btn.active').text();sessionStorage.setItem("searchParams",$('#keyword').val());sessionStorage.setItem("pageIndexs",$('.num-text.active').text());window.location.href=encodeURI("traineeInfo.html?traineeId="+traineeId+"&pageNum="+pageNum+"&keyword="+keyword);});$("input.check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck");$(".class-tbody").find("td").removeClass("yt-table-active");$(".class-tbody").find("tr").removeClass("yt-table-active")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check");$(".class-tbody").find("td").addClass("yt-table-active")}});$(".check-all-tab tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody tr").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find("input.check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find("input.check-all").setCheckBoxState("check")}})},getPlanListInfo:function(){var pageIndexs=$yt_common.GetQueryString("pageNum");if(pageIndexs){pageIndexs=pageIndexs}else{pageIndexs=1}$yt_baseElement.showLoading();sessionStorage.getItem("searchParams")?$('#keyword').val(sessionStorage.getItem("searchParams")):'';var keyword=$('#keyword').val();$('.page-info').pageInfo({pageIndexs:pageIndexs,pageNum:15,pageSize:10,url:$yt_option.base_path+"trainee/getTraineeList",type:"post",after:function(){$(".class-tbody tr").unbind().bind("click",function(){if($(this).find("input[type='checkbox']")[0].checked==true){$(this).find("input[type='checkbox']").setCheckBoxState("uncheck");$(this).find("td").removeClass("yt-table-active")}else{$(this).find("input[type='checkbox']").setCheckBoxState("check");$(this).find("td").addClass("yt-table-active")}if($(".class-tbody input:checkbox").not("input:checked").length>0){$(".check-all").setCheckBoxState("uncheck")}else{$(".check-all").setCheckBoxState("check")}})},data:{selectParam:keyword},objName:'data',success:function(data){sessionStorage.clear();var carStates="";if(data.flag==0){var htmlTbody=$('.list-table .yt-tbody');var htmlTr='';var num=1;var gender;if(data.data.rows.length>0){$(htmlTbody).empty();$.each(data.data.rows,function(i,v){i=i+1;if(v.gender==1){gender="男"};if(v.gender==2){gender="女"}if(v.gender==""){gender=""}htmlTr='<tr><td style="width:33px;position:relative;"><div style="position: absolute;top: 5px;z-index:100;width: 30px;height: 30px;opacity: 0;"></div><label class="check-label yt-checkbox select-assets-alert-checkbox" style="margin-left: 9px;"><input type="checkbox" name="test" class="select-assets-trainee-id" value="'+v.traineeId+'"/></label></td><td class="th-center">'+i+'</td><td style="display:none;" class="trainee-id">'+v.traineeId+'</td><td class="td-left trainee-name" ><a style="color:#3c4687;" class="yt-link" style="text-decoration: none;">'+v.traineeName+'</a></td><td class="th-center">'+gender+'</td><td class="td-left">'+v.groupName+'</td><td class="td-left">'+v.orgName+'</td><td class="th-center">'+v.deptPosition+'</td><td class="th-center">'+v.firstDate+'</td><td class="th-center">'+v.endDate+'</td><td class="td-right" style="text-align:right;">'+v.timesNumber+'</td><td class="td-right" style="width:33px;text-align:right;">'+v.trainNumber+'</td></tr>';htmlTbody.append(htmlTr)});$('.page-info').show()}else{$(htmlTbody).empty();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr);$('.page-info').hide()}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},delCarList:function(){var pkId=$('.yt-table-active .pkId').val();$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复，确认删除吗？",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"administrator/car/removeBeanById",data:{pkId:pkId},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("删除成功");$('.page-info').pageInfo("refresh")}else{$yt_alert_Model.prompt("删除失败");}}})}})}};$(function(){carList.init()});