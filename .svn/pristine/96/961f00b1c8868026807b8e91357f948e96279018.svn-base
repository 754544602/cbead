var pay={fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},rmoney:function(str){return $yt_baseElement.rmoney(str||'0')},showBusinessFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();$('.business-div').show()},showGeneralFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();$('.index-main-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/payment/ordinaryPaymentApplyApproval.html')},showTravelFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();$('.travel-div').show()},showTrainFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();$('.index-main-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/busiTripApply/trainApproval.html')},showMettingFun:function(){$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();},alertpay:function(){var me=this;$('#payAddBtn').click(function(){me.showMsgAlert();$('#LpaymentAddBtn').off().on('click',function(){$yt_alert_Model.alertOne({alertMsg:"确定已支付后不可修改，确定所填写的支付明细并提交吗？",confirmFunction:function(){var isNull=$yt_valid.validForm($("#addObjInfo"));if(isNull){me.appendMsgList();me.hideMsgAlert()}}})}).text('确定已支付')})},alerttally:function(){var me=this;$('#tallyAddBtn').click(function(){me.showtallyAlert();$('#paymentAddBtn').off().on('click',function(){$yt_valid.validForm($("#AddAppDetails"));var isNull=$yt_valid.validForm($("#AddAppDetails"));if(isNull){me.appendtallyList();me.hidetallyAlert()}}).text('添加到列表')})},submitPaymentAppInfo:function(subData){$.ajax({type:'post',url:'sz/payApp/submitPaymentAppInfo',data:subData,success:function(data){if(data.flag==0){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/expensesReim/module/approval/paymentApprovalList.html'}})}$yt_alert_Model.prompt(data.message)}})},getSaveData:function(){var d=pay.saveData,costData={},costData=d.costData,payReceivablesData=d.payReceivablesData;d.opintion=$("#opintion").val();d.nextCode=$("#operate-flow option:selected").val();d.dealingWithPeople=$("#approve-users option:selected").val();d.attIdStr=pay.getFileList();d.attList='';d.costData=typeof(costData)=='string'?costData:JSON.stringify(costData);d.payReceivablesData=typeof(payReceivablesData)=='string'?payReceivablesData:JSON.stringify(payReceivablesData);d.parameters='';d.billingVoucherList='';delete d.applicantTime;d.payDetailList=pay.payDetailList();return d},getFileList:function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length-1?',':'')});return str},submitPayment:function(){$("#submitPayment").off().on("click",function(){if($yt_valid.validForm($(".operation"))){var data=pay.getSaveData();pay.submitPaymentAppInfo(data)}})},showMsgAlert:function(){$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#createDetali'));$('#pop-modle-alert').show();$('#createDetali').show()},showtallyAlert:function(){$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#createExpense'));$('#pop-modle-alert').show();$('#createExpense').show()},appendMsgList:function(tr){var me=this;var type=$('#firstSelect option:selected').text();var budgetProject=$('#budgetProject option:selected').text();var pid=$('#budgetProject option:selected').val();var payDate=$('#payDate').val();var Unit=$('#Unit').val();var html='<tr pid="'+pid+'" type="'+type+'" payee="'+budgetProject+'" payment="'+payDate+'" paymentmoney="'+Unit+'"> <td class="payee" style="width: 100px;">'+budgetProject+'</td> <td class="payment" style="width: 100px;">'+payDate+'</td> <td class="paymentmoney" style="text-align: right;">'+Unit+'</td></tr>';if(tr){tr.replaceWith(html)}else{$('.pay-detail-tabel tbody .pay-detail-tabel-total').before(html)}me.hideMsgAlert();me.clearAlert($('.create-detali'));var tds=$('.pay-detail-tabel tbody .paymentmoney');var total=0;$.each(tds,function(i,n){total+=pay.rmoney($(n).text())});var fmTotal=pay.fmMoney(total);$('.pay-detail-tabel tbody .payee-other-total-money').text(fmTotal);$('#alreadyMoney').text(fmTotal);var mustMoney=pay.rmoney($('#mustMoney').text());$('#alreadyMoney').text(pay.fmMoney(mustMoney-total));},companyTotal:function(){var tds=$('.payee-unit tbody .unitTotal');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('.payee-unit tbody .payee-unit-money').text(fmTotal))},personalTotal:function(){var tds=$('.payee-personal tbody .personalTotal');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('.payee-personal tbody .payee-personal-money').text(fmTotal))},otherTotal:function(){var tds=$('.payee-other tbody .otherTotal');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('.payee-other tbody .payee-other-total-money').text(fmTotal))},appendtallyList:function(tr){var me=this;var typeselect=$('#typeselect option:selected').text();var summary=$('#summary').val();var bursar=$('#bursar').val();var ledger=$('#ledger').val();var detail=$('#detail').val();var taMoney=$('#taMoney').val();var tallygetCode=$('#typeselect option:selected').val();var html='<tr Pcode="'+tallygetCode+'" typeselect="'+typeselect+'" summary="'+summary+'" bursar="'+bursar+'" ledger="'+ledger+'" detail="'+detail+'" taMoney="'+taMoney+'"> <td class="typeselect" style="width: 100px;">'+typeselect+'</td> <td class="summary" style="width: 100px;">'+summary+'</td> <td class="bursar" style="width: 100px;">'+bursar+'</td> <td class="ledger" style="width: 100px;">'+ledger+'</td> <td class="detail" style="width: 100px;">'+detail+'</td> <td><span class="receive-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="receive-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td> </tr>';if(tr){tr.replaceWith(html)}else{$('.tally-proof-tabel').append(html)}me.hidetallyAlert();me.clearAlert($('.create-expense'));},hideMsgAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#createDetali').hide();$('#pop-modle-alert').hide()},hidetallyAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#createExpense').hide();$('#pop-modle-alert').hide()},hidepayalert:function(){$('#paymentCanelBtn').on('click',function(){$yt_baseElement.hideMongoliaLayer();$('#createDetali').hide();$('#pop-modle-alert').hide();pay.clearAlert($('.create-detali'))})},hidetallyalert:function(){$('#GpaymentCanelBtn').on('click',function(){$yt_baseElement.hideMongoliaLayer();$('#createExpense').hide();$('#pop-modle-alert').hide();pay.clearAlert($('.create-expense'))})},clearAlert:function(obj){var selects=obj.find('select');$.each(selects,function(i,n){$(n).find('option:first-child').attr('selected',true)});selects.niceSelect();var inputs=obj.find('input');inputs.val('')},Moneyfocus:function(){$("#taMoney").on("focus",function(){if($(this).val()!=""){$(this).val($yt_baseElement.rmoney($(this).val()))}});$("#taMoney").on("blur",function(){if($(this).val()!=""){$(this).val($yt_baseElement.fmMoney($(this).val()))}})},deltally:function(){$('.tally-proof-tabel').on('click','.receive-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();var total=0;}})})},updatatally:function(){$('.tally-proof-tabel').on('click','.receive-update',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#createExpense'));$('#pop-modle-alert').show();$('#createExpense').show()})},updatatallycarry:function(){$('.tally-proof-tabel').on('click','.receive-update',function(){var me=this;var ithis=$(this);var tr=ithis.parents('tr');var typeselect=$('#typeselect option[value="'+tr.attr('pcode')+'"]').attr('selected',true);var summary=$('#summary').val(tr.attr('summary'));var bursar=$('#bursar').val(tr.attr('bursar'));var ledger=$('#ledger').val(tr.attr('ledger'));var detail=$('#detail').val(tr.attr('detail'));var taMoney=$('#taMoney').val(tr.attr('taMoney'));$('#typeselect').niceSelect();pay.showtallyAlert();$('#paymentAddBtn').off().on('click',function(){pay.appendtallyList(tr)}).text('确定')})},clearexamine:function(){$("#ClearBtn").off().on("click",function(){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/expensesReim/module/approval/paymentApprovalList.html'}})})},selectCheck:function(){$("#firstSelect").change(function(){var selvalue=$(this).val();if(selvalue=='company'){var comcod='<option value="">请选择</option>';$(".payee-unit tbody tr:not(.payee-unit-total)").each(function(x,n){var comtext=$(this).find(".com").text();var id=$(this).find(".com").attr('pid');comcod+="<option value='"+id+"'>"+comtext+"</option>"});$("#budgetProject").html(comcod).niceSelect()}else if(selvalue=='personal'){var percod='<option value="">请选择</option>';$(".payee-personal tbody tr:not(.payee-personal-total)").each(function(x,n){var pertext='';var id=$(this).find(".per").attr('pid');pertext=$(this).find(".per").text();percod+="<option value='"+id+"'>"+pertext+"</option>"});$("#budgetProject").html(percod).niceSelect()}else if(selvalue=='other'){var othcod='<option value="">请选择</option>';$(".payee-other tbody tr:not(.payee-other-total)").each(function(x,n){var othtext=$(this).find(".oth").text();var id=$(this).find(".oth").attr('pid');othcod+="<option value='"+id+"'>"+othtext+"</option>"});$("#budgetProject").html(othcod).niceSelect()}})},getInformationajax:function(data){},getInformationstring:function(data){},getLectorajax:function(data){},getLectorstring:function(data){},gettrainMoneyajax:function(data){},gettrainMoneystring:function(data){},getlectureMoneyajax:function(data){},getlectureMoneystring:function(data){},gettrafficMoneyajax:function(data){},gettrafficMoneystring:function(data){},getaccommodationMoneyajax:function(data){},getaccommodationMoneystring:function(data){},getfoodMoneyajax:function(data){},getfoodMoneystring:function(data){},getPayAppInfoByPayAppId:function(payAppId){var me=this;$.ajax({type:"post",url:"sz/payApp/getPayAppInfoByPayAppId",async:true,data:{payAppId:payAppId},success:function(data){if(data.flag==0){var d=data.data;if(d.taskKey=='activitiEndTask'){$('.pay-detail').show();$('#approve-users').attr("validform","{isNull:false,msg:'请选择审批人'}")}else{$('#submitPayment').text('提交');}pay.saveData=d;me.setFormData(d)}}})},setFormData:function(d){var me=this;if(d.jsFun){me[d.jsFun]()}sysCommon.getApproveFlowData("SZ_ADVANCE_APP",d.processInstanceId);$('#busiUsers').text(d.applicantUserName);$('#deptName').text(d.applicantUserDeptName);$('#jobName').text(d.applicantUserJobLevelName);$('#formNum').text(d.paymentAppNum);$('#fuData').text(d.applicantTime);$('.advanceAppReason').text(d.paymentAppName);$('.befor-examine').text(d.advanceAppNum);if(d.advanceAppNum){$('.advance-relevance').show();$('#advanceAppBalance').text(d.advanceAppBalance?(me.fmMoney(d.advanceAppBalance)+'元'):'--')}if(d.prjName){$('#prjName').text(d.prjName);$('.prj-name-tr').show()}$('.expense-type').text(d.costTypeName);$('#specialName').text(d.specialName).attr('val',d.specialCode);$('#budgetBalanceAmount').text(d.budgetBalanceAmount?me.fmMoney(d.budgetBalanceAmount)+'万元':'--');$('#invoiceNum').text(d.invoiceNum?d.invoiceNum:'0');$('.count-val-num,#mustMoney').text(me.fmMoney(d.totalAmount));$('.total-money-up').text(arabiaToChinese(d.totalAmount+''));me.showFileList(d.attList);me.setDataListTable(d.costData);me.setReceiptListTable(d.payReceivablesData)},showFileList:function(list){var ls='';var src='';$.each(list,function(i,n){var imgType=n.attName.split('.');if(imgType.length>1&&(imgType[1]=='png'||imgType[1]=='jpeg'||imgType[1]=='bmp'||imgType[1]=='jpg')){src=$yt_option.base_path+'fileUpDownload/download?pkId='+n.attId+'&isDownload=false';ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pv">预览<img src="'+src+'" ></label></div>'}else{ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pvno">预览</label></div>'}});$('#attIdStr').html(ls);$('#attIdStr .file-dw').on('click',function(){var id=$(this).parent().attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'});$('#attIdStr .file-pv img').showImg()},setDataListTable:function(data){var me=this;var fMoney=$yt_baseElement.fmMoney;var costReceptionistList=data.costReceptionistList;var costDetailsList=data.costDetailsList;var receHtml='';$.each(costReceptionistList,function(i,n){receHtml+='<tr pkId="'+n.receptionObjectId+'" class="" applyName="'+n.name+'" Unit="'+n.jobName+'" Duties="'+n.unitName+'"><td><span class="num">1</span></td><td><span class="name-text">'+n.name+'</span></td><td><span class="job-text">'+n.jobName+'</span></td><td><span class="unit-text">'+n.unitName+'</span></td></tr>'});$('.msg-list tbody').append(receHtml);var detaHtml='';var costDetaClose=$('#paymentList').next().find('.check-label input');$.each(costDetailsList,function(i,n){detaHtml+='<tr Tcode="'+n.budgetfeiCode+'" Pcode="'+n.costType+'" budgetProject="'+n.publicServiceProName+'" txtDate="'+n.activityDate+'" place="'+n.placeName+'" costBreakdown="'+n.costTypeName+'" bzy-span="'+n.standardAmount+'" budgetMoney="'+n.activityAmount+'" peoplenum="'+n.peopleNum+'"><td><span class="">'+n.publicServiceProName+'</span></td><td><span class="activityDate">'+n.activityDate+'</span></td><td><span class="place-name">'+n.placeName+'</span></td><td><span>'+n.costTypeName+'</span></td><td style="text-align: right;"><div class="stan-money" money='+n.standardAmount+'>'+fMoney(n.standardAmount||'0')+'</div></td><td style="text-align: right;"><div class="money" money='+n.activityAmount+'>'+fMoney(n.activityAmount||'0')+'</div></td><td><span class="people-num">'+n.peopleNum+'</span></td></tr>';if(costDetaClose.length>0&&n.setMethod){costDetaClose.setCheckBoxState('check')}});$('#paymentList tbody .last').before(detaHtml);var tripPlanList=data.travelRouteList;var tripHtml='';var travelPersonnelsList=[];var getUserNames=function(list){var str='';$.each(list,function(i,n){str+=n.travelPersonnelName+(i<list.length-1?'、':'')});return str};var costItem=function(str){switch(str){case '1':return '住宿费';break;case '2':return '伙食费';break;case '3':return '市内交通费';break;default:return '';break}};var getCostItemName=function(str){var txt='';if(str){var list=str.split(',');$.each(list,function(i,n){if(n){txt+=costItem(n)+(i<list.length-1?'、':'')}});return txt}return ''};$.each(tripPlanList,function(i,n){var dateFrom=new Date(n.startTime);var dateTo=new Date(n.endTime);var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24));tripHtml+='<tr busicode="'+n.travelType+'" usercode="'+n.travelPersonnels+'" rececode="'+n.receptionCostItem+'" ><td><input type="hidden" class="hid-user-code" value="'+n.travelPersonnels+'" /> <span class="name">'+n.travelTypeName+'</span></td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="day">'+diff_day+'</td><td class="address" val="'+n.travelAddress+'">'+n.travelAddressName+'</td><td class="uname">'+getUserNames(n.travelPersonnelsList)+'</td><td class="numof">'+n.travelPersonnelsList.length+'</td><td class="reception">'+getCostItemName(n.receptionCostItem)+'</td></tr>'});$('#tripList tbody').html(tripHtml);var costCarfareList=data.costCarfareList;var carHtml='';var costCarfareClose=$('#traffic-list-info').next().find('.check-label input');$.each(costCarfareList,function(i,n){carHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+n.travelPersonnel+'"/></td><td>'+n.travelPersonnelsDept+'</td><td data-text="goTime">'+n.goTime+'</td><td><input data-val="goAddress" type="hidden" value="'+n.goAddress+'"><span data-text="goAddressName">'+n.goAddressName+'</span></td><td data-text="arrivalTime">'+n.arrivalTime+'</td><td><input data-val="arrivalAddress" type="hidden" value="'+n.arrivalAddress+'"> <span data-text="arrivalAddressName">'+n.arrivalAddressName+'</span></td><td><span data-text="vehicle">'+n.vehicleName+'</span><input type="hidden" class="hid-vehicle" value="'+n.vehicle+'"/><input type="hidden" class="hid-child-code" value=""/></td><td class="font-right money-td" data-text="crafare">'+(n.crafare==""?"--":fMoney(n.crafare||'0'))+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"--":n.remarks)+'</td><td style="display:none;"><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costCarfareClose.length>0&&n.setMethod){costCarfareClose.setCheckBoxState('check')}});carHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td></tr>';$('#traffic-list-info tbody').html(carHtml);me.updateMoneySum(0);var costHotelList=data.costHotelList;var hotelHtml='';var costHotelClose=$('#hotel-list-info').next().find('.check-label input');$.each(costHotelList,function(i,n){hotelHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" value="'+n.travelpersonnel+'"/></td><td>'+n.travelPersonnelsDept+'</td>'+'<td class="font-right">'+fMoney((n.hotelExpense/n.hotelDays)||'0')+'</td><td data-text="hotelDays">'+n.hotelDays+'</td><td class="font-right money-td" data-text="hotelExpense">'+fMoney(n.hotelExpense||'0')+'</td><td><span data-text="hotelAddressName">'+n.hotelAddressName+'</span><input type="hidden" data-val="hotelAddress" value="'+n.hotelAddress+'"</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"--":n.remarks)+'</td><td style="display:none;"><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costHotelClose.length>0&&n.setMethod){costHotelClose.setCheckBoxState('check')}});hotelHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$('#hotel-list-info tbody').html(hotelHtml);me.updateMoneySum(1);var costOtherList=data.costOtherList;var otherHtml='';var costOtherClose=$('#other-list-info').next().find('.check-label input');$.each(costOtherList,function(i,n){otherHtml+='<tr><td><span>'+n.costTypeName+'</span><input type="hidden" data-val="costType" value="'+n.costType+'"/></td><td class="font-right money-td" data-text="reimAmount">'+fMoney(n.reimAmount||'0')+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"--":n.remarks)+'</td></tr>';if(costOtherClose.length>0&&n.setMethod){costOtherClose.setCheckBoxState('check')}});otherHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td></tr>';$('#other-list-info tbody').html(otherHtml);me.updateMoneySum(2);var costSubsidyList=data.costSubsidyList;var subHtml='';var totalFood=0;var totalTraffic=0;$.each(costSubsidyList,function(i,n){subHtml+='<tr class="'+n.travelPersonnel+'" code="'+n.travelPersonnel+'"><td><div class="user" code="'+n.travelPersonnel+'">'+n.travelPersonnelName+'</div></td><td><div class="lv">'+n.travelPersonnelsDept+'</div></td><td><div class="subsidy-num">'+n.subsidyDays+'</div></td><td><div style="text-align:right;" class="food">'+fMoney(n.subsidyFoodAmount||'0')+'</div></td><td><div  style="text-align:right;" class="traffic">'+fMoney(n.carfare||'0')+'</div></td></tr>';totalFood+= +n.subsidyFoodAmount;totalTraffic+= +n.carfare});subHtml+='<tr class="last"><td>合计</td><td></td><td></td><td class="total-food"  style="text-align:right;">'+$yt_baseElement.fmMoney(totalFood)+'</td><td class="total-traffic"  style="text-align:right;">'+$yt_baseElement.fmMoney(totalTraffic)+'</td></tr>';$('#subsidy-list-info tbody').html(subHtml);me.setTrainApplyInfoList(data.trainApplyInfoList);me.setTeacherApplyInfoList(data.teacherApplyInfoList);me.setCostTrainApplyInfoList(data.costTrainApplyInfoList);me.setCostTeachersFoodApplyInfoList(data.costTeachersFoodApplyInfoList);me.setCostTeachersLectureApplyInfoList(data.costTeachersLectureApplyInfoList);me.setCostTeachersTravelApplyInfoList(data.costTeachersTravelApplyInfoList);me.setCostTeachersHotelApplyInfoList(data.costTeachersHotelApplyInfoList);me.setCostNormalList(data.costNormalList)},setTrainApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr pid="'+n.trainAppId+'" trainType="'+n.trainType+'"><td class="trainingClasses">'+n.trainTypeName+'</td><td class="trainingAddr"><input type="hidden" class="trainingAddrVal" value="'+n.regionCode+'">'+n.regionName+'</td><td class="trainingReportDate">'+n.reportTime+'</td><td class="trainingEndingDate">'+n.endTime+'</td><td class="trainingDay">'+n.trainDays+'</td><td class="trainingPerNumber">'+n.trainOfNum+'</td><td style="display:none"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#trainingPopTable tbody').html(html)},setTeacherApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr><td class="lecturerName"><input type="hidden" class="lectureId" value="'+n.lecturerId+'"><span>'+n.lecturerName+'</span></td><td class="professional">'+n.lecturerTitleName+'</td><td class="level">'+n.lecturerLevelName+'</td><td style="display:none"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#lecturerTable tbody').html(html)},setCostTrainApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr pid="'+n.teachersTrainId+'"><td class="day">'+n.trainDays+'</td><td class="num">'+n.trainOfNum+'</td><td class="moneyText" class="avg">'+pay.fmMoney(n.averageMoney)+'</td><td class="moneyText training-total">'+pay.fmMoney(n.trainAmount)+'</td><td style="display:none"><input type="hidden" class="popM" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#trainingFeeTable tbody').html(html)},setCostTeachersFoodApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.foodId+'"><td><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="avg moneyText">'+pay.fmMoney(n.averageMoney)+'</td><td class="day">'+n.foodOfDays+'</td><td class="moneyText sum-pay">'+pay.fmMoney(n.foodAmount)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td style="display:none"><input type="hidden" class="popM" value="4"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.foodAmount});$('#dietFeeTable tbody .end-tr').before(html);$('#dietFeeTable tbody .costTotal').text(pay.fmMoney(total))},setCostTeachersLectureApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersLectureId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="holder">'+n.lecturerTitleName+'</td><td class="hour">'+n.teachingHours+'</td><td class="cname">'+n.courseName+'</td><td class="moneyText sum-pay">'+pay.fmMoney(n.perTaxAmount)+'</td><td class="moneyText after">'+pay.fmMoney(n.afterTaxAmount)+'</td><td class="moneyText avg">'+pay.fmMoney(n.averageMoney)+'</td><td style="display:none"><input type="hidden" class="popM" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.perTaxAmount});$('#lectureFeeTable tbody .end-tr').before(html);$('#lectureFeeTable tbody .costTotal').text(pay.fmMoney(total))},setCostTeachersTravelApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersTravelId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="ulv">'+n.lecturerLevelName+'</td><td class="sdate">'+n.goTime+'</td><td class="edate">'+n.arrivalTime+'</td><td class="sadd"><input type="hidden" class="scode" value="'+n.goAddress+'">'+n.goAddressName+'</td><td class="eadd"><input type="hidden" class="ecode" value="'+n.arrivalAddress+'">'+n.arrivalAddressName+'</td><td class="tname"><input type="hidden" class="tool" value="'+n.vehicle+'">'+n.vehicleName+'</td><td class="moneyText sum-pay">'+pay.fmMoney(n.carfare)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td  style="display:none"><input type="hidden" class="popM" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.carfare});$('#carFeeTable tbody .end-tr').before(html);$('#carFeeTable tbody .costTotal').text(pay.fmMoney(total))},setCostTeachersHotelApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersHotelId+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="moneyText avg">'+pay.fmMoney(n.averageMoney)+'</td><td class="day">'+n.hotelDays+'</td><td class="moneyText sum-pay">'+pay.fmMoney(n.hotelExpense)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td style="display:none"><input type="hidden" class="popM" value="3"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.hotelExpense});$('#hotelFeeTable tbody .end-tr').before(html);$('#hotelFeeTable tbody .costTotal').text(pay.fmMoney(total))},setReceiptListTable:function(data){var me=this;me.setGatheringUnitList(data.gatheringUnitList);me.setGatheringPersonList(data.gatheringPersonList);me.setGatheringOtherList(data.gatheringOtherList)},setGatheringUnitList:function(list){var html='';$.each(list,function(i,n){html+='<tr class="payee-unit-tr" companyName="'+n.unitName+'" openBank="'+n.openBank+'" accountNumber="'+n.accounts+'" companyMoney="'+n.amount+'" contractRadio="'+n.isContract+'" companySpecial="'+n.remarks+'"><td class="com" pid="'+n.unitId+'" value="Company">'+n.unitName+'</td><td style="text-align: left;">'+n.openBank+'</td><td style="text-align: left;">'+n.accounts+'</td><td style="text-align: right;" class="unitTotal">'+(pay.fmMoney(n.amount))+'</td><td value="'+n.isContract+'">'+(n.isContract=='1'?'是':'否')+'</td><td>'+n.remarks+'</td></tr>'});$('table.payee-unit tbody .payee-unit-total').before(html);pay.companyTotal()},setGatheringPersonList:function(list){var html='';$.each(list,function(i,n){html+='<tr class="payee-personal-tr" payeeName="'+n.personalName+'" idCarkno="'+n.idCard+'" payeeMoney="'+n.amount+'" payeeBank="'+n.accounts+'" bankName="'+n.openBank+'" phoneNum="'+n.phoneNum+'" payeeRadio="'+n.isContract+'" personalSpecial="'+n.remarks+'"><td class="per" pid="'+n.personalId+'" value="personal">'+n.personalName+'</td><td>'+n.idCard+'</td><td style="text-align: right;" class="personalTotal">'+(pay.fmMoney(n.amount))+'</td><td>'+n.accounts+'</td><td>'+n.openBank+'</td><td>'+n.phoneNum+'</td><td>'+(n.isContract=='1'?'是':'否')+'</td><td>'+n.remarks+'</td></tr>'});$('table.payee-personal tbody .payee-personal-total').before(html);pay.personalTotal()},setGatheringOtherList:function(list){var html='';$.each(list,function(i,n){html+='<tr class="payee-other-tr" otherMoney="'+n.otherName+'" otherAllMoney="'+n.amount+'" otherRadio="'+n.isContract+'" otherSpecial="'+n.remarks+'"><td class="oth" pid="'+n.otherId+'" value="Other">'+n.otherName+'</td><td style="text-align: right;" class="otherTotal">'+(pay.fmMoney(n.amount))+'</td><td>'+(n.isContract=='1'?'是':'否')+'</td><td>'+n.remarks+'</td></tr>'});$('table.payee-other tbody .payee-other-total').before(html);pay.otherTotal()},setCostNormalList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr><td class="ordinar-name" style="text-align: left;">'+n.normalName+'</td><td class="payDet-money" style="text-align: right;">'+($yt_baseElement.fmMoney(n.normalAmount))+'</td></tr>';total+= +n.normalAmount});$('.ordinary-payment-approval #paymentDetailedTable tbody .pay-detail-tabel-total').before(html);$('.ordinary-payment-approval #paymentDetailedTable tbody .total-money').text($yt_baseElement.fmMoney(total))},updateMoneySum:function(thisTab){var me=this;var moenySum=0.00;if(thisTab==0){$("#traffic-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#traffic-list-info tbody .money-sum").text(moenySum)}else{$("#traffic-list-info tbody .money-sum").text("0.00")}}if(thisTab==1){$("#hotel-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#hotel-list-info tbody .money-sum").text(moenySum)}else{$("#hotel-list-info tbody .money-sum").text("0.00")}}if(thisTab==2){$("#other-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#other-list-info tbody .money-sum").text(moenySum)}else{$("#other-list-info tbody .money-sum").text("0.00")}}if(thisTab==3){$("#subsidy-list-info tbody .food-money").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#subsidy-list-info tbody .money-sum").text(moenySum)}else{$("#subsidy-list-info tbody .money-sum").text("0.00")}var cityMoneySum=0.00;$("#subsidy-list-info tbody .city-money").each(function(i,n){cityMoneySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});cityMoneySum=$yt_baseElement.fmMoney(cityMoneySum);if(cityMoneySum!=undefined&&$yt_baseElement.rmoney(cityMoneySum)>0){$("#subsidy-list-info tbody .city-money-td").text(cityMoneySum)}else{$("#subsidy-list-info tbody .city-money-td").text("0.00")}}},updateApplyMeonySum:function(){var sumMoney=0;$(".cost-list-model table .money-sum").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});$(".cost-list-model table .city-money-td").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});sumMoney=$yt_baseElement.fmMoney(sumMoney);$(".count-val-num").text(sumMoney).attr('num',sumMoney);if($("body").find("#reimPrice")){$("#reimPrice").text(sumMoney);var loanPrice=$("#loanCost").text();var replPrice=$yt_baseElement.rmoney(sumMoney)-parseFloat(loanPrice);replPrice=$yt_baseElement.fmMoney(replPrice);$("#givePrice").text(replPrice)}if(sumMoney!=null&&sumMoney!=undefined&&$yt_baseElement.rmoney(sumMoney)>0){var sumMoneyLower=arabiaToChinese(sumMoney);$(".count-val").text(sumMoneyLower)}else{$(".count-val-num").text("0.00")}},payDetailList:function(){var list=[];var tr=[];$('table.pay-detail-tabel tbody tr:not(.pay-detail-tabel-total)').each(function(i,n){tr=$(n);list.push({receivablesId:tr.attr('pid'),receivablesType:tr.attr('type'),receivablesType:tr.attr('payment'),receivablesType:pay.rmoney(tr.attr('paymentmoney')),})});return JSON.stringify(list)},getCommentByProcessInstanceId:function(){var requerParameter=$yt_common.GetRequest();var processInstanceId=requerParameter.processInstanceId;$.ajax({type:"post",url:"basicconfig/workFlow/getWorkFlowLog",async:false,data:{processInstanceId:processInstanceId},success:function(data){var txt='';if(!!data&&data.flag=='0'){var list=data.data||[];var imgUrl="";for(var i=0,len=list.length;i<len;i+=1){if(i==0){imgUrl="../../../../../resources-sasac/images/common/log-border-color.png"}else{imgUrl="../../../../../resources-sasac/images/common/log-info-border.jpg"}txt+='<div class="log-info">'+(i==list.length-1?'':'<div class="log-icon-border"></div>')+'<div class="log-icon"><img src="'+(list.length==1?'../../../../../resources-sasac/images/common/num-icon-one.png':(i==0?'../../../../../resources-sasac/images/common/log-num-first.png':'../../../../../resources-sasac/images/common/log-num.png'))+'" /><div class="log-icon-num" '+(i==0?'style="top: 7px;"':'')+'>'+(list.length-i)+'<div></div></div></div><div class="log-details '+(i==0?"log-shadow-sty":"")+'" '+((list[i].commment==undefined||list[i].commment==null||list[i].commment=="")?'style="padding-bottom: 30px;"':'')+'><label class="log-name">'+list[i].userName+'</label><img style="'+(i==0?"left: -9px;":"left:-8px;")+'" src="'+imgUrl+'"/><div><p><label class="log-title">操作状态：</label><span class="log-state">'+list[i].taskName+'</span></p>'+((list[i].commment==undefined||list[i].commment==null||list[i].commment=="")?'':('<p class="log-ideap"><label class="log-title">操作意见：</label><label class="log-idea">'+list[i].commment+'</label></p>'))+'</div></div><label class="log-time">'+list[i].commentTime+'</label></div>'}$('.flow-div').html(txt)}else{$(".appr-flow-log").hide()}}})}};$(function(){$("#budgetProject").niceSelect();$("#typeselect").niceSelect();$("#operate-flow").niceSelect();$("#approve-users").niceSelect();$("#firstSelect").niceSelect();var pid=$yt_common.GetQueryString('payAppId');if(pid){pay.getPayAppInfoByPayAppId(pid)}pay.alertpay();pay.hidepayalert();pay.hidetallyalert();pay.alerttally();pay.submitPayment();pay.deltally();pay.updatatally();pay.updatatallycarry();pay.clearexamine();pay.selectCheck();pay.getInformationajax();pay.getLectorajax();pay.gettrainMoneyajax();pay.getlectureMoneyajax();pay.gettrafficMoneyajax();pay.getaccommodationMoneyajax();pay.getfoodMoneyajax();$("#closeBtn").click(function(){parent.closeWindow()});pay.getCommentByProcessInstanceId()});