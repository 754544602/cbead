var addProjectList = {
	//初始化方法
	init: function() {
		var judgeList = $yt_common.GetQueryString('judgeList');
		if(judgeList == 1){
			$("option[value='3']").remove();
			$("option[value='4']").remove();
			$("option[value='']").remove();
		}
		if(judgeList == 2){
			$("option[value='2']").remove();
		}
		//初始化下拉列表
		$(".yt-select").niceSelect();
		//初始化日期控件
		$(".start-date").calendar({
			controlId: "startDate",
			nowData: false, //默认选中当前时间,默认true  
			upperLimit: $(".end-date") //开始日期最大为结束日期  
		});
		$(".end-date").calendar({
			controlId: "endDate",
			nowData: false, //默认选中当前时间,默认true  
			lowerLimit: $(".start-date") //结束日期最小为开始日期  
		});
		
		var pkId = $yt_common.GetQueryString('pkId');
		//判断当前页面是新增还是修改
		if(pkId){//修改
			//修改页面获取数据
			addProjectList.getProjectInf();
			//点击修改页面确定按钮
			$(".btn-sub").on('click',function(){
				addProjectList.amendProjectListInf();
			});
			//点击修改页面取消按钮
			$(".btn-off").on('click',function(){
				if(judgeList == 1){
					window.location.href="projectList.html";
				}
				if(judgeList == 2){
					window.location.href="/cbead/website/view/trainingPrograms/trainingProgramsList.html";
				}
			});
		}else{//新增
			//点击新增页面确定按钮
			$('.btn-sub').click(function(){
				if($yt_valid.validForm($('body'))){
					addProjectList.addProjectListInf();
				}else{
					addProjectList.pageToScroll($('body .valid-font'));
				}
			});
			//点击新增页面取消按钮
			$(".btn-off").on('click',function(){
				if(judgeList == 1){
					window.location.href="projectList.html";
				}
				if(judgeList == 2){
					window.location.href="/cbead/website/view/trainingPrograms/trainingProgramsList.html";
				}
			});
		}
		//获取集团名称
		var groupList = addProjectList.getListSelectGroup();
		if (groupList !=null){
			$.each(groupList,function (i,n){
				$(".group-id").append('<option value="'+n.groupId+'">'+n.groupName+'</option>');
			});
		}
		$(".group-id").niceSelect();
		//获取项目销售下拉列表
		var treeAllPersonal = addProjectList.getTreeAllPersonnel();
		if (treeAllPersonal !=null){
			$.each(treeAllPersonal,function (i,n){
				if(n.type==3){
					$(".project-sell").append('<option value="'+n.textName+'">'+n.text+'</option>');
				}
			});
		}
		$(".project-sell").niceSelect();
		
	},
	/**
	 * 获取所有集团,单位
	 */
	getListSelectGroup:function(){
		var list =[];
		$.ajax({
			type: "post",
			url: $yt_option.base_path+"uniform/group/getGroups",
			data:{
				isSelectGroup:'2',
				groupId:""
			},
			async: false,
			success: function(data) {
				list = data.data || [];
			}
		});
		return list;
	},
	/**
	 * 获取树形结构所有人员
	 */
	getTreeAllPersonnel:function(){
		var list =[];
		$.ajax({
			type: "post",
			url: $yt_option.base_path+"uniform/user/getUsers",
			data:{
				
			},
			async: false,
			success: function(data) {
				list = data.data || [];
			}
		});
		return list;
	},	
	//新增
	addProjectListInf: function() {
		$yt_baseElement.showLoading();
		var projectName = $(".project-name").val();
		var projectType = $(".project-type").val();
		var projectSell = $(".project-sell").val();
		var startDate = $(".start-date").val();
		var endDate = $(".end-date").val();
		var trainDate = $(".train-date").val();
		var details = $(".details").val();
		var groupId = $(".group-id").val();
		var customerDept = $(".customer-dept").val();
		var customerLinkman = $(".customer-linkman").val();
		var customerLinkmanPosition = $(".customer-linkman-position").val();
		var customerLinkmanPhone = $(".customer-linkman-phone").val();
		var customerLinkmanCellphone = $(".customer-linkman-cellphone").val();
		var customerLinkmanFax = $(".customer-linkman-fax").val();
		var customerLinkmanEmail = $(".customer-linkman-email").val();
		var customerTraineePosition = $(".customer-trainee-position").val();
		var customerTraineeSum = $(".customer-trainee-sum").val();
		var customerTraineeAgeStructure = $(".customer-trainee-age").val();
		var customerTargetDemand = $(".customer-target-demand").val();
		
		$.ajax({
			async:true,
			before:function(){
				$yt_baseElement.showLoading();
			},
			type: "post", //ajax访问方式 默认 "post"  
			url: $yt_option.base_path + "project/addOrUpdateBean", //ajax访问路径  
			data: {
				projectName:projectName,        
				projectType:projectType, 
				projectSell:projectSell,    
				startDate:startDate,    
				endDate:endDate,      
				trainDate:trainDate,  
				details:details,      
				groupId:groupId,      
				customerDept:customerDept,  
				customerLinkman:customerLinkman,    
				customerLinkmanPosition:customerLinkmanPosition,       
				customerLinkmanPhone:customerLinkmanPhone,  
				customerLinkmanCellphone:customerLinkmanCellphone,     
				customerLinkmanFax:customerLinkmanFax,       
				customerLinkmanEmail:customerLinkmanEmail,     
				customerTraineePosition:customerTraineePosition,     
				customerTraineeSum:customerTraineeSum,    
				customerTraineeAgeStructure:customerTraineeAgeStructure,  
				customerTargetDemand:customerTargetDemand
			}, //ajax查询访问参数
			success: function(data) {
				if(data.flag == 0){
				 	$yt_alert_Model.prompt("新增成功");
				 	$(".btn-all").hide();
				 	$yt_baseElement.hideLoading();
				 	var judgeList = $yt_common.GetQueryString('judgeList');
					if(judgeList == 1){
						window.location.href="projectList.html";
					}
					if(judgeList == 2){
						window.location.href="/cbead/website/view/trainingPrograms/trainingProgramsList.html";
					}
				}else{
					$yt_alert_Model.prompt("新增失败");
					$yt_baseElement.hideLoading();
				}
			} 
		});
	},
	//项目查询一条详细信息
	getProjectInf: function() {
			var pkId = $yt_common.GetQueryString('pkId');
			$.ajax({
				before:function(){
					$yt_baseElement.showLoading();
				},
				type: "post", //ajax访问方式 默认 "post"  
				url: $yt_option.base_path + "project/getBeanById", //ajax访问路径  
				data: {
					pkId:pkId
				}, //ajax查询访问参数
				success: function(data) {
					if(data.flag == 0){
						$(".get-project-inf").setDatas(data.data);
						//从返回的值里给select赋值
						$(".project-type").setSelectVal(data.data.projectType);
						$(".project-sell").setSelectVal(data.data.projectSell);
						$(".group-id").setSelectVal(data.data.groupId);
						$yt_baseElement.hideLoading();
					}else{
						$yt_alert_Model.prompt("获取失败");
						$yt_baseElement.hideLoading();
					}
				}
			});
	},
	//修改
	amendProjectListInf: function() {
		var pkId = $yt_common.GetQueryString('pkId');
		var projectName = $(".get-project-inf .project-name").val();
		var projectType = $(".get-project-inf .project-type").val();
		var projectSell = $(".get-project-inf .project-sell").val();
		var startDate = $(".get-project-inf .start-date").val();
		var endDate = $(".get-project-inf .end-date").val();
		var trainDate = $(".get-project-inf .train-date").val();
		var details = $(".get-project-inf .details").val();
		var groupId = $(".get-project-inf .group-id").val();
		var customerDept = $(".get-project-inf .customer-dept").val();
		var customerLinkman = $(".get-project-inf .customer-linkman").val();
		var customerLinkmanPosition = $(".get-project-inf .customer-linkman-position").val();
		var customerLinkmanPhone = $(".get-project-inf .customer-linkman-phone").val();
		var customerLinkmanCellphone = $(".get-project-inf .customer-linkman-cellphone").val();
		var customerLinkmanFax = $(".get-project-inf .customer-linkman-fax").val();
		var customerLinkmanEmail = $(".get-project-inf .customer-linkman-email").val();
		var customerTraineePosition = $(".get-project-inf .customer-trainee-position").val();
		var customerTraineeSum = $(".get-project-inf .customer-trainee-sum").val();
		var customerTraineeAgeStructure = $(".get-project-inf .customer-trainee-age").val();
		var customerTargetDemand = $(".get-project-inf .customer-target-demand").val();
		
		$.ajax({
			before:function(){
				$yt_baseElement.showLoading();
			},
			type: "post", //ajax访问方式 默认 "post"  
			url: $yt_option.base_path + "project/addOrUpdateBean", //ajax访问路径  
			data: {
				pkId:pkId,
				projectName:projectName,        
				projectType:projectType, 
				projectSell:projectSell,    
				startDate:startDate,    
				endDate:endDate,      
				trainDate:trainDate,  
				details:details,      
				groupId:groupId,      
				customerDept:customerDept,  
				customerLinkman:customerLinkman,    
				customerLinkmanPosition:customerLinkmanPosition,       
				customerLinkmanPhone:customerLinkmanPhone,  
				customerLinkmanCellphone:customerLinkmanCellphone,     
				customerLinkmanFax:customerLinkmanFax,       
				customerLinkmanEmail:customerLinkmanEmail,     
				customerTraineePosition:customerTraineePosition,     
				customerTraineeSum:customerTraineeSum,    
				customerTraineeAgeStructure:customerTraineeAgeStructure,  
				customerTargetDemand:customerTargetDemand
			}, //ajax查询访问参数
			success: function(data) {
				if(data.flag == 0){
				 	$yt_alert_Model.prompt("修改成功");
				 	var judgeList = $yt_common.GetQueryString('judgeList');
					if(judgeList == 1){
						window.location.href="projectList.html";
					}
					if(judgeList == 2){
						window.location.href="/cbead/website/view/trainingPrograms/trainingProgramsList.html";
					}
					$yt_baseElement.hideLoading();
				}else{
					$yt_alert_Model.prompt("修改失败");
					$yt_baseElement.hideLoading();
				}
			} 
		});
	},
	pageToScroll: function(validObj) {
		var scrollTopVal = 0;
		$(validObj).each(function() {
			if($(this).text() != "") {
				if($(window).scrollTop() && ($(this).eq(0).parent().offset().top < $(window).scrollTop() || $(this).eq(0).parent().offset().top > $(window).height())) {
					scrollTopVal = $(this).eq(0).parents().offset().top - 30;
					$(window).scrollTop(scrollTopVal);
				}
				return false;
			}
		});
	}
	
}
$(function() {
	//初始化方法
	addProjectList.init();
});