/**
 * 班级详细信息
 */
var caInfoList={init:function(){caInfoList.getPlanListInfo();var projectCode=$yt_common.GetQueryString("projectCode");$(".tab-title-list button").click(function(){debugger;var divIndex;$(this).addClass("active").siblings().removeClass("active");if($(this).index()==5){divIndex=7}else if($(this).index()==6){divIndex=8}else if($(this).index()==7){divIndex=9}else{divIndex=$(this).index()}$(".box-list .content-box").hide().eq(divIndex).show();if($(this).index()==0){caInfoList.getPlanListInfo();}else if($(this).index()==1){caInfoList.getTeacherListInfo();}else if($(this).index()==2){courseManager.getCourseList();}else if($(this).index()==3){studentList.getStudentList();studentList.getDifferentList();}else if($(this).index()==4){repeatCourtyardList.getRepeatComeList();repeatCourtyardList.doubtRepatComeList();}else if($(this).index()==5){classBulletin.getClassBulletin();}else if($(this).index()==6){}else if($(this).index()==7){studentReport.getStudentReport();studentReport.getDifferentList();}else if($(this).index()==8){}else if($(this).index()==9){}else if($(this).index()==10){}else if($(this).index()==11){}});$('.page-return-btn').off().on('click',function(){window.location.href="classMg.html"});$('.teacher-search-btn').click(function(){$(".select-teacher-div").show();caInfoList.selectTeacherListInfo();$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-teacher-div"));$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));$('.select-teacher-sure-btn').click(function(){var pkId="";$('.select-teacher-alert-checkbox input[class="select-teacher-pkId"]:checked').each(function(){if(pkId==""){pkId=$(this).val()}else{pkId+=","+$(this).val()}});if(pkId==""){$yt_alert_Model.prompt("请选中一行数据进行操作",3000)}else{caInfoList.selectTeacher(pkId)}});$('.select-teacher-canel-btn').click(function(){$('.select-teacher-div .select-teacher-tbody').empty();$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})});$('.teacher-delete-btn').click(function(){var pkId="";$('.select-teacher-checkbox input[class="select-teacher-pkId"]:checked').each(function(){if(pkId==""){pkId=$(this).val()}else{pkId+=","+$(this).val()}});if(pkId==""){$yt_alert_Model.prompt("请选中一行数据进行操作",3000)}else{$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){caInfoList.deleteTeacher(pkId)}})}});$('.teacher-ticket-btn').click(function(){$(".select-ticket-div").show();caInfoList.getTicketList();$('.select-ticket-sure-btn').click(function(){caInfoList.getTicket()});$yt_model_drag.modelDragEvent($(".select-ticket-div .yt-edit-alert-title"));$('.select-ticket-canel-btn').click(function(){$(".yt-edit-alert").hide();$("#pop-modle-alert").hide()})});$(".check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".teacher-table tbody,.select-teacher-tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}});$(".teacher-station-btn").click(function(){$(".shuttle-box").show();$yt_alert_Model.getDivPosition($(".shuttle-box"));$yt_model_drag.modelDragEvent($(".shuttle-box .yt-edit-alert-title"));$('.shuttle-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})});$(".more-tab-btn-end").click(function(){var leftVal=parseInt($(".tab-title-box").css("margin-left"))-120;console.log(leftVal);if($(".tab-title-box").parent().width()>($(".tab-title-box button").last().position().left-120)){$(".more-tab-btn-end").hide();leftVal=(120*$(".tab-title-box button").length-$(".tab-title-box").parent().width()+32)*-1}$(".tab-title-box").css("padding-left","32px").stop(true,true).animate({"margin-left":leftVal},100);$(".more-tab-btn-start").show()});$(".more-tab-btn-start").click(function(){var leftVal=parseInt($(".tab-title-box").css("margin-left"))+120;if(leftVal>=-120){$(this).hide();leftVal=0;$(".tab-title-box").css("padding-left","0")}console.log(leftVal);$(".tab-title-box").stop(true,true).animate({"margin-left":leftVal},100);$(".more-tab-btn-end").show()})},getPlanListInfo:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/getBeanByProjectCode",async:true,data:{projectCode:projectCode},objName:'data',success:function(data){if(data.flag==0){if(data.data.projectType==1){data.data.projectType="计划"}else if(data.data.projectType==2){data.data.projectType="委托"}else if(data.data.projectType==3){data.data.projectType="选学"}else if(data.data.projectType==4){data.data.projectType="调训"}$('.project-code').text(data.data.projectCode);$('.project-name').text(data.data.projectName);$('.project-type').text(data.data.projectType);$('.project-sell').text(data.data.projectSell);$('.start-date').text(data.data.startDate);$('.end-date').text(data.data.endDate);$('.train-date').text(data.data.trainDate);$('.customer-unit').text(data.data.customerUnit);$('.customer-dept').text(data.data.customerDept);$('.customer-linkman').text(data.data.customerLinkman);$('.customer-linkman-position').text(data.data.customerLinkmanPosition);$('.customer-linkman-phone').text(data.data.customerLinkmanPhone);$('.customer-linkman-cellphone').text(data.data.customerLinkmanCellphone);$('.customer-linkman-fax').text(data.data.customerLinkmanFax);$('.customer-linkman-email').text(data.data.customerLinkmanEmail);$('.customer-trainee-position').text(data.data.customerTraineePosition);$('.customer-trainee-sum').text(data.data.customerTraineeSum);$('.customer-trainee-age-structure').text(data.data.customerTraineeAgeStructure);$('.customer-target-demand').text(data.data.customerTargetDemand);$('.project-head').text(data.data.projectHead);$('.class-teacher').text(data.data.classTeacher);$('.project-aid').text(data.data.projectAid);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},getTeacherListInfo:function(){var projectCode=$yt_common.GetQueryString("projectCode");var searchParameters="";$('.page-info').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/teacher/lookForAll",type:"post",data:{searchParameters:searchParameters,projectCode:projectCode},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.teacher-div .teacher-table .yt-tbody');var htmlTr='';if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){htmlTr+='<tr class="teacher-tr"><td><label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test" class="select-teacher-pkId" value="'+v.pkId+'"/></label></td><td><div><a class="realName">'+v.realName+'</a></div></td><td>'+(v.gender==1?"男":"女")+'</td><td class="teacher-phone">'+v.phone+'</td><td>'+v.org+'</td><td>'+v.title+'</td><td>'+v.researchArea+'</td><td class="tr">'+v.dollarsStandardHalf+'</td><td class="tr">'+v.dollarsStandardOne+'</td><td>'+(v.teacherStates==1?"可用":"已用")+'</td></tr>'})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},selectTeacherListInfo:function(){$yt_baseElement.showLoading();var projectCode=$yt_common.GetQueryString("projectCode");var searchParameters=$('.select-teacher-search-btn').val();$('.teacher-page').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/teacher/getTeachers",type:"post",data:{searchParameters:searchParameters,projectCode:projectCode},before:function(){$yt_baseElement.showLoading()},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.select-teacher-table .yt-tbody');var htmlTr='';if(data.data.rows.length>0){$('.teacher-page').show();$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else{v.gender="女"}if(v.teacherStates==1){v.teacherStates="可用"}else{v.teacherStates="已用"}htmlTr='<tr><td><label class="check-label yt-checkbox select-teacher-alert-checkbox"><input type="checkbox" name="test" class="select-teacher-pkId" value="'+v.pkId+'"/></label></td><input type="hidden" value="'+v.pkId+'" class="pkid"><td><div><a>'+v.realName+'</a></div></td><td>'+v.gender+'</td><td>'+v.phone+'</td><td>'+v.org+'</td><td>'+v.title+'</td><td>'+v.researchArea+'</td><td>'+v.dollarsStandardHalf+'</td><td>'+v.dollarsStandardOne+'</td><td>'+v.grade+'</td><td>'+v.teacherStates+'</td></tr>';htmlTbody.append(htmlTr)});$yt_baseElement.hideLoading()}else{$('.teacher-page').hide();htmlTr='<tr><td colspan="11" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr);$yt_baseElement.hideLoading()}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},selectTeacher:function(pkId){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/teacher/addTeachers",async:false,data:{projectCode:projectCode,pkId:pkId},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("添加教师成功");$(".yt-edit-alert,#heard-nav-bak").hide();$('.page-info').pageInfo("refresh");caInfoList.getTeacherListInfo()}else{$yt_alert_Model.prompt("添加教师失败")}}})},deleteTeacher:function(pkId){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/teacher/deleteTeachers",async:false,data:{projectCode:projectCode,pkId:pkId},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("移除教师成功");caInfoList.getTeacherListInfo()}else{$yt_alert_Model.prompt("移除教师失败")}}})},getTeacherTicket:function(){var teacherLength=$('.teacher-list-tbody tr').length;var htmlTbody=$('.ticket-teacher-table .yt-tbody');var htmlTr='';var i=0;while(i<teacherLength){htmlTr+='<tr><td rowspan="2" class="teacherName"></td><td rowspan="2" class="phone"></td><td><input type="hidden" class="routeType" value="1" />来院</td><td><input type="hidden" class="types" value="1" />订票</td><td><input type="text" class="flightTrainNumber" value="" /></td><td><input type="text" class="placeDeparture" value="" /></td><td><input id="txtDate-hh" class="calendar-input goOff" style="width: 155px;" value="" placeholder="请选择日期" type="text" /> </td><td><input type="text" class="bourn" value="" /></td><td><input id="txtDate-hh" class="calendar-input arrivalTime" style="width: 155px;" value="" placeholder="请选择日期" type="text" /></td><td><input type="text" class="fares" value="" /></td><td><input type="text" class="changeFeeRefund" value="" /></td><td><input type="hidden" class="states" value="1" />未删除</td></tr><tr><td><input type="hidden" class="routeType" value="2" />返程</td><td><input type="hidden" class="types" value="1" />订票</td><td><input type="text" class="flightTrainNumber" value="" /></td><td><input type="text" class="placeDeparture" value="" /></td><td><input id="txtDate-hh" class="calendar-input goOffTwo" style="width: 155px;" value="" placeholder="请选择日期" type="text" /> </td><td><input type="text" class="bourn" value="" /></td><td><input id="txtDate-hh" class="calendar-input arrivalTime arrivalTimeTwo" style="width: 155px;" value="" placeholder="请选择日期" type="text" /> </td><td><input type="text" class="fares" value="" /></td><td><input type="text" class="changeFeeRefund" value="" /></td><td><input type="hidden" class="states" value="1" />未删除</td></tr>';var teacherName=$('.realName').text();$(i).find('.teacherName').html(teacherName);var phone=$('.teacher-phone').text();$('.phone').html(phone);i+=1}htmlTbody.html(htmlTr)},getTicket:function(){debugger;var projectCode=$yt_common.GetQueryString("projectCode");var teachersReseveArr=[];$(".ticket-teacher-tbody tr").each(function(i,n){var teacherName=$(n).find('.teacherName').text();var phone=$(n).find('.phone').text();var routeType=$(n).find('.routeType').val();var types=$(n).find('.types').val();var flightTrainNumber=$(n).find('.flightTrainNumber').val();var placeDeparture=$(n).find('.placeDeparture').val();var goOff=$(n).find('.goOff').val();var bourn=$(n).find('.bourn').val();var arrivalTime=$(n).find('.arrivalTime').val();var changeFeeRefund=$(n).find('.changeFeeRefund').val();var states=$(n).find('.states').val();var teachersReseveList={teacherName:teacherName,phone:phone,routeType:routeType,types:types,flightTrainNumber:flightTrainNumber,placeDeparture:placeDeparture,goOff:goOff,bourn:bourn,arrivalTime:arrivalTime,changeFeeRefund:changeFeeRefund,states:states};teachersReseveArr.push(teachersReseveList)});var teachersReseve=JSON.stringify(teachersReseveArr);$.ajax({url:$yt_option.base_path+"class/teacher/addTeachersReseve",type:"post",data:{projectCode:projectCode,teachersReseve:teachersReseve},success:function(data){if(data.flag==0){console.log(data);$yt_alert_Model.prompt("订票成功")}else{$yt_alert_Model.prompt("订票失败")}}})},getTicketList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({url:$yt_option.base_path+"class/teacher/getTeachersReseve",type:"post",data:{projectCode:projectCode},success:function(data){if(data.flag==0){console.log(data);var teachersReseve=$.parseJSON(data.data.teachersReseve);var htmlTbody=$('.select-ticket-div .ticket-teacher-tbody');var htmlTr='';htmlTbody.empty();$.each(teachersReseve,function(i,v){htmlTr='<tr><td rowspan="2" class="teacherName">'+v.teacherName+'</td><td rowspan="2" class="phone">'+v.phone+'</td><td><input type="hidden" class="routeType" value="'+v.routeType+'" />来院</td><td><input type="hidden" class="types" value="'+v.types+'" />订票</td><td><input type="text" class="flightTrainNumber" value="'+v.flightTrainNumber+'" /></td><td><input type="text" class="placeDeparture" value="'+v.placeDeparture+'" /></td><td><input id="txtDate-hh" class="calendar-input goOff" style="width: 155px;" value="'+v.goOff+'" placeholder="请选择日期" type="text" /></td><td><input type="text" class="bourn" value="'+v.bourn+'" /></td><td><input id="txtDate-hh" class="calendar-input arrivalTime" style="width: 155px;" value="'+v.arrivalTime+'" placeholder="请选择日期" type="text" /></td><td><input type="text" class="fares" value="'+v.fares+'" /></td><td><input type="text" class="changeFeeRefund" value="'+v.changeFeeRefund+'" /></td></tr><tr><td><input type="hidden" class="routeType" value="'+v.routeType+'" />返程</td><td><input type="hidden" class="types" value="'+v.types+'" />订票</td><td><input type="text" class="flightTrainNumber" value="'+v.flightTrainNumber+'" /></td><td><input type="text" class="placeDeparture" value="'+v.placeDeparture+'" /></td><td><input id="txtDate-hh" class="calendar-input goOffTwo" style="width: 155px;" value="'+v.goOff+'" placeholder="请选择日期" type="text" /></td><td><input type="text" class="bourn" value="'+v.bourn+'" /></td><td><input id="txtDate-hh" class="calendar-input arrivalTime arrivalTimeTwo" style="width: 155px;" value="'+v.arrivalTime+'" placeholder="请选择日期" type="text" /></td><td><input type="text" class="fares" value="'+v.fares+'" /></td><td><input type="text" class="changeFeeRefund" value="'+v.changeFeeRefund+'" /></td></tr>';htmlTbody.append(htmlTr)});$(".goOff").calendar({speed:'slow',dateFmt:"yyyy-MM-dd HH:mm",nowData:false});$(".arrivalTime").calendar({speed:200,dateFmt:"yyyy-MM-dd HH:mm",nowData:false});$(".goOffTwo").calendar({speed:200,dateFmt:"yyyy-MM-dd HH:mm",nowData:false});$(".arrivalTimeTwo").calendar({speed:200,dateFmt:"yyyy-MM-dd HH:mm",nowData:false});$yt_alert_Model.setFiexBoxHeight($(".select-ticket-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-ticket-div"))}}})}};var courseManager={init:function(){var me=this;me.getCourseType();$(".course-date").calendar({controlId:"courseDate",speed:200,complement:true,readonly:true,lowerLimit:"2010/01/01",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$("select.couse-type").change(function(){$(".add-course-box .couse-type1,.add-course-box .couse-type2,.add-course-box .couse-type3").hide();if($(this).val()=="openingCeremony"||$(this).val()=="windingUp"){$(".add-course-box .couse-type1").show()}else if($(this).val()=="teachingActivities"){$(".add-course-box .couse-type3").show()}else{$(".add-course-box .couse-type2").show()}});$(".add-couse-btn").click(function(){$(".add-course-box .yt-edit-alert-title-msg").text("新增课程");$("[name='giveType']:eq(0)").setRadioState("check");$(".add-course-box .start-time").timespinner('setValue',"08:30");$(".add-course-box .end-time").timespinner('setValue',"11:30");var openingCeremony=$("select.couse-type option:eq(0)").val();$(".couse-type").setSelectVal(openingCeremony);$(".couse-type2").hide();$(".couse-type1").show();$(".valid-font").text("");$(".valid-hint").removeClass("valid-hint");$(".select-file-btn").css("visibility","visible");$(".upload-file-btn").css("visibility","hidden").prev().css("visibility","hidden");$("[name='fileType']:eq(0)").setRadioState("check");$("[name='isNeedGroupPhoto']:eq(0)").setRadioState("check");$(".upload-file-btn").val("").removeData("fileInfo");$("input[name='courseName']").val("");me.getTeacherList();$(".add-course-box").show();$yt_alert_Model.getDivPosition($(".add-course-box"));$yt_model_drag.modelDragEvent($(".add-course-box .yt-edit-alert-title"));$('.add-course-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".add-course-box").hide()});$(".add-course-box .yt-model-sure-btn").off().on("click",function(){me.editCouseInfo();me.getCourseList()})});$(".upload-file-box").undelegate().delegate("input.upload-file-btn","change",function(){var addFile=$(this).attr("id");$yt_baseElement.showLoading();var url=$yt_option.acl_path+"api/tAscPortraitInfo/addFile?modelCode=couseFile";$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:addFile,success:function(data,textStatus){var resultData=$.parseJSON(data);if(resultData.success==0){$yt_baseElement.hideLoading(function(){$("#"+addFile).prev().val(resultData.obj.naming).data("fileInfo",resultData.obj);$yt_alert_Model.prompt("附件上传成功")})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传失败")})}},error:function(data,status,e){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传失败")})}})});$("input[name='fileType']").change(function(){$(this).parent().nextAll().css("visibility","visible");$(this).parents("table").find("input[name='fileType']:not(:checked)").parent().nextAll().css("visibility","hidden")});$(".add-course-box input[name='giveType']").change(function(){var startTime="";var endTime="";if($(this).val()=="1"){startTime="08:30";endTime="11:30"}else if($(this).val()=="2"){startTime="14:00";endTime="17:00"}else{startTime="18:00";endTime="21:00"}$(".add-course-box .start-time").timespinner('setValue',startTime);$(".add-course-box .end-time").timespinner('setValue',endTime)});$(".update-couse-btn").click(function(){if($("input[name='couseCheck']:checked").length!=1){$yt_alert_Model.prompt("请选择一条数据进行修改")}else{$(".add-course-box .yt-edit-alert-title-msg").text("修改课程");var couseInfo=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");console.log(couseInfo);$("[name='giveType'][value='"+couseInfo.giveType+"']").setRadioState("check");var giveTime=couseInfo.courseTime;$(".add-course-box .start-time").timespinner('setValue',giveTime.split("-")[0]);$(".add-course-box .end-time").timespinner('setValue',giveTime.split("-")[1]);var openingCeremony=couseInfo.courseTypeCode;$(".couse-type").setSelectVal(openingCeremony);$(".add-course-box .couse-type1,.add-course-box .couse-type2,.add-course-box .couse-type3").hide();if(openingCeremony=="openingCeremony"||openingCeremony=="windingUp"){$(".add-course-box .couse-type1").show()}else if(openingCeremony=="teachingActivities"){$(".add-course-box .couse-type3").show()}else{$(".add-course-box .couse-type2").show()}$("input[name='courseName']").val(couseInfo.courseName);$(".valid-font").text("");$(".valid-hint").removeClass("valid-hint");var types=couseInfo.types;if(couseInfo.files!=""){var filesArr=$.parseJSON(couseInfo.files);$(".upload-file-btn").val("").removeData("fileInfo");if(types==1){$(".add-course-box [name='fileType']:eq(0)").setRadioState("check");$(".select-file-btn").css("visibility","visible").val("");$(".upload-file-btn").css("visibility","hidden").prev().css("visibility","hidden").val("");if(filesArr.length>0){$(".select-file-btn").val(filesArr[0].fileName).data("fileInfo",{pkId:filesArr[0].fileId,naming:filesArr[0].fileName})}}else{$(".add-course-box [name='fileType']:eq(1)").setRadioState("check");$(".select-file-btn").css("visibility","hidden").val("");$(".upload-file-btn").css("visibility","visible").prev().css("visibility","visible").val("");if(filesArr.length>0){$(".upload-file-btn").prev().val(filesArr[0].fileName).data("fileInfo",{pkId:filesArr[0].fileId,naming:filesArr[0].fileName})}}}me.getTeacherList();$("select.teacher-list-selt").setSelectVal(couseInfo.teacherId);$(".add-course-box").show();$yt_alert_Model.getDivPosition($(".add-course-box"));$yt_model_drag.modelDragEvent($(".add-course-box .yt-edit-alert-title"));$('.add-course-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".add-course-box").hide()});$(".add-course-box .yt-model-sure-btn").off().on("click",function(){me.editCouseInfo(couseInfo.pkId)})}});$(".delete-couse-btn").click(function(){if($(".course-list-tbody .yt-table-active").length!=1){$yt_alert_Model.prompt("请选择一条数据进行操作");return false}$yt_alert_Model.alertOne({leftBtnName:"确定",rightBtnName:"取消",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){var pkId=$(".course-list-tbody .yt-table-active").data("couseInfo").pkId;me.deleteCouse(pkId)}})});$(".select-file-btn").click(function(){var oldBox=$(this).parents(".yt-pop-model");$yt_baseElement.showLoading();var teacherId="";if($(this).parents(".add-course-box").length==0){teacherId=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo").teacherId}else{teacherId=$(".add-course-box select[name='teacherId']").val()}$.ajax({type:"post",url:$yt_option.base_path+"class/course/getTeacherUploadFiles",async:true,data:{teacherId:teacherId},success:function(data){if(data.flag==0){var htmlTbody=$(".select-file-div tbody").empty();var htmlTr='';if(data.data.length>0){$.each(data.data,function(i,n){htmlTr=$('<tr><td>'+(i+1)+'</td><td>'+n.fileName+'</td></tr>').data("fileInfo",n);htmlTbody.append(htmlTr)});htmlTbody.find("tr").click(function(){$(this).addClass("yt-table-active").siblings().removeClass("yt-table-active")})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询教师附件失败")})}},error:function(data){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询教师附件失败")})}});oldBox.hide();$(".select-file-div").show();$yt_alert_Model.getDivPosition($(".select-file-div"));$yt_model_drag.modelDragEvent($(".select-file-div .yt-edit-alert-title"));$('.select-file-div .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".select-file-div").hide();oldBox.show()});$('.select-file-div .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){if($(".select-file-div tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择附件");return false}var fileInfo=$(".select-file-div tr.yt-table-active").data("fileInfo");oldBox.find(".select-file-btn").val(fileInfo.fileName).data("fileInfo",{pkId:fileInfo.fileId,naming:fileInfo.fileName});$(".select-file-div").hide();oldBox.show()})});$(".course-list-tbody").on('click','.file-name',function(){var fileUrl=$(this).attr("fileUrl");$.ajaxDownloadFile({url:fileUrl})});$(".couse-file-btn").click(function(){if($("input[name='couseCheck']:checked").length!=1){$yt_alert_Model.prompt("请选择一条数据进行修改")}else{var couseInfo=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");if(couseInfo.courseTypeCode!="openingCeremony"&&couseInfo.courseTypeCode!="windingUp"&&couseInfo.courseTypeCode!="teachingActivities"){$(".couse-file-box table tr:eq(0) td:eq(1)").text(couseInfo.teacherName);$(".couse-file-box table tr:eq(1) td:eq(1)").text(couseInfo.courseName);var types=couseInfo.types;var filesArr=$.parseJSON(couseInfo.files);if(filesArr!=""){if(types==1){$(".couse-file-box [name='fileType']:eq(0)").setRadioState("check");$(".select-file-btn").css("visibility","visible").val("");$(".upload-file-btn").css("visibility","hidden").prev().css("visibility","hidden").val("");if(filesArr.length>0){$(".select-file-btn").val(filesArr[0].fileName).data("fileInfo",{pkId:filesArr[0].fileId,naming:filesArr[0].fileName})}}else{$(".couse-file-box [name='fileType']:eq(1)").setRadioState("check");$(".select-file-btn").css("visibility","hidden").val("");$(".upload-file-btn").css("visibility","visible").prev().css("visibility","visible").val("");if(filesArr.length>0){$(".upload-file-btn").prev().val(filesArr[0].fileName).data("fileInfo",{pkId:filesArr[0].fileId,naming:filesArr[0].fileName})}}}$(".couse-file-box").show();$yt_alert_Model.getDivPosition($(".couse-file-box"));$yt_model_drag.modelDragEvent($(".couse-file-box .yt-edit-alert-title"));$('.couse-file-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".couse-file-box").hide()});$(".couse-file-box .yt-model-sure-btn").off().on("click",function(){me.uploadFiles()})}else{$yt_alert_Model.prompt("选择的课程类型不需要上传课件")}}});$(".select-room").click(function(){if($("input[name='couseCheck']:checked").length!=1){$yt_alert_Model.prompt("请选择一条数据进行修改")}else{$("select.address-type").niceSelect();me.getClassRooms();var couseInfo=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");$.ajax({type:"post",url:$yt_option.base_path+"class/course/getClassRoomConfig",async:true,data:{courseId:couseInfo.pkId},success:function(data){if(data.flag==0){$(".select-room-box").show();$yt_model_drag.modelDragEvent($(".select-room-box .yt-edit-alert-title"));if(data.data){$("select[name='courseType']").setSelectVal(data.data.courseType);if(data.data.courseType==1){$(".external-address").hide();$(".internal-address").show()}else{$(".internal-address").hide();$(".external-address").show();positionMap.ac.setInputValue(data.data.address);var longitude=parseFloat(data.data.longitude);var latitude=parseFloat(data.data.latitude);positionMap.mapObj.clearOverlays();var point=new BMap.Point(latitude,longitude);var myIcon=new BMap.Icon($yt_option.websit_path+"resources/images/img/blank.png",new BMap.Size(23,25),{offset:new BMap.Size(10,25),});positionMap.marker=new BMap.Marker(point,{icon:myIcon});positionMap.mapObj.addOverlay(positionMap.marker);positionMap.marker.enableDragging();setTimeout(function(){positionMap.mapObj.setCenter(point)},200);$(".external-address [name='placeSign'][value='"+data.data.placeSign+"']").setRadioState("check")}}$('.select-room-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".select-room-box").hide()});$(".select-room-box .yt-model-sure-btn").off().on("click",function(){var couseFile={};couseFile.courseType=$("select[name='courseType']").val();couseFile.projectCode=$yt_common.GetQueryString("projectCode");couseFile.courseId=couseInfo.pkId;if(couseFile.courseType==1){couseFile.placeSign=2;if($(".select-room-box tbody input[type='checkbox']:checked").length==0){$yt_alert_Model.prompt("请选择教室");return false}else{couseFile.classroomIds="";$(".select-room-box tbody input[type='checkbox']:checked").each(function(i,n){if(couseFile.classroomIds==""){couseFile.classroomIds=$(n).val()}else{couseFile.classroomIds+=","+$(n).val()}})}}else{couseFile.address=$("#suggestId").val();var optionInfo=positionMap.getPosition();if(optionInfo==null){$yt_alert_Model.prompt("请在地图中选择签到地点");return false}couseFile.longitude=optionInfo.lat;couseFile.latitude=optionInfo.lng;couseFile.placeSign=$(".select-room-box [name='placeSign']:checked").val()}$yt_baseElement.showLoading();$.ajax({type:"post",url:"class/course/updateClassRoom",data:couseFile,async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("上课地点修改成功");$(".select-room-box").hide();courseManager.getCourseList()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作失败，请稍后重试")})}},error:function(data){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("网络出现问题，请稍后重试")})}})})}},error:function(data){}})}});$('.print-couse').click(function(){$(".print-couse-form").show();var projectCode=$yt_common.GetQueryString("projectCode");var fileType=1;$('.print-couse-form tbody').empty();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/getPrinting",data:{projectCode:projectCode,fileType:fileType},async:true,success:function(data){if(data.flag==0){console.log(data.data);var htmlBody=$('.print-couse-form tbody');var htmlStr='';$.each(data.data,function(c,v){var states="";if(v.states==2){states='已完成'}else if(v.states==3){states='打印中'}else if(v.states==4){states='已作废'}else{states='未打印'}htmlStr='<tr class="print-tr"><td style="padding-left:20px"><label class="check-label yt-checkbox"><input class="print-check" type="checkbox" name="test" value="1"/></label></td><td class="curse-file-name" style="text-align: left;padding-left: 10px;"><input type="hidden" class="curse-file-id" value="'+v.fileId+'"/>'+v.fileName+'</td><td>'+v.teacherName+'</td><td><input class="yt-input print-count print-states'+v.states+'" type="number" value="'+v.printerCount+'" /></td><td class="print-states">'+states+'</td><input type="hidden" class="curse-id" value="'+v.courseId+'"</tr>';htmlBody.append(htmlStr);if(states!="未打印"){htmlBody.find('label.check-label').remove();htmlBody.find('.print-count').attr("disabled","disabled");htmlBody.find('.print-count').removeClass("print-counts")}else{htmlBody.find('.print-states5').removeAttr("disabled");htmlBody.find('.print-states5').addClass("print-counts")}});$yt_baseElement.hideLoading()}}});$yt_alert_Model.getDivPosition($(".print-couse-form"));$yt_model_drag.modelDragEvent($(".print-couse-form .yt-edit-alert-title"));$('.print-couse-form .yt-model-sure-btn').off().on('click',function(){var printData=[];var printList="";var printerCount;var checklength=$('.print-check:checked').length;$('.print-check:checked').parent().parent().parent().each(function(a,b){var fileId=$(b).find('.curse-file-id').val();var courseId=$(b).find('.curse-id').val();var fileName=$(b).find('.curse-file-name').text();printerCount=$(b).find('.print-count').val();var states=$(b).find('.print-states').text();if(states=="未打印"){printList={projectCode:projectCode,courseId:courseId,fileId:fileId,fileName:fileName,printerCount:printerCount,fileType:1,states:3};printData.push(printList)}});console.log("printerCount",printerCount);var pringingData=JSON.stringify(printData);if(checklength!=0){if(printerCount!=''){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/addPrinting",data:{pringingData:pringingData},async:true,success:function(data){if(data.flag==0){console.log("成功");$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交成功");$(".print-couse-form").hide()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交失败")})}}})}else{$yt_alert_Model.prompt("请填写打印数量")}}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("请选择需要打印的附件")})}});$('.print-couse-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".print-couse-form").hide();$("#pop-modle-alert").hide()})});$('.merge-score-couse').click(function(){var projectCode=$yt_common.GetQueryString("projectCode");var htmlBody=$('.merge-score-form tbody:eq(0)');var htmlHistory=$('.merge-score-form tbody:eq(1)');htmlBody.empty();htmlHistory.empty();$('.merge-couse-name').val("");var histCourseId='';$("input[name='couseCheck']:checked").parents("tr").each(function(c,d){var couseInfo=$(d).data("couseInfo");console.log(couseInfo);htmlStr='<tr class="print-tr"><input class="merge-course-id" type="hidden" value="'+couseInfo.pkId+'"/><td >'+couseInfo.courseDate+'</td><td style="text-align:center;">'+couseInfo.courseTime+'</td><td style="text-align:center;">'+couseInfo.courseTypeName+'</td><td style="text-align:center;">'+couseInfo.teacherName+'</td><td style="text-align:center;">'+couseInfo.courseName+'</td></tr>';htmlBody.append(htmlStr)});$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/getCourseMerge",data:{projectCode:projectCode},async:true,success:function(data){var rowNmu=1;var mergeTitle;var lastNum;if(data.flag==0){$yt_baseElement.hideLoading();console.log("查询历史记录成功",data.data);$.each(data.data,function(g,h){var htmlStr='';debugger;if(histCourseId==""){histCourseId+=h.pkId}else{histCourseId+=","+h.pkId}htmlStr+='<tr><input class="" type="hidden" value="'+h.pkId+'"/><input class="course-merge-code" type="hidden" value="'+h.mergeCode+'"/><td >'+h.courseDate+'</td><td style="text-align:center;">'+h.courseTime+'</td><td style="text-align:center;">'+h.courseTypeName+'</td><td style="text-align:center;">'+h.teacherName+'</td><td style="text-align:center;">'+h.courseName+'</td>';if(mergeTitle!=h.mergeTitle){$('.merge-record tbody tr').eq(lastNum).find('td').eq(5).attr('rowspan',rowNmu);$('.merge-record tbody tr').eq(lastNum).find('td').eq(6).attr('rowspan',rowNmu);mergeTitle=h.mergeTitle;lastNum=g;rowNmu=1;htmlStr+='<td rowspan="" style="text-align:center;">'+h.mergeTitle+'</td><td class="cancel-merge-btn">取消合并</td>'}else{rowNmu+=1}$('.merge-record tbody tr').eq(lastNum).find('td').eq(5).attr('rowspan',rowNmu);$('.merge-record tbody tr').eq(lastNum).find('td').eq(6).attr('rowspan',rowNmu);htmlStr+='</tr>';htmlHistory.append(htmlStr)})}}});$(".merge-score-form").show();$yt_alert_Model.getDivPosition($(".merge-score-form"));$yt_model_drag.modelDragEvent($(".merge-score-form .yt-edit-alert-title"));$('.merge-score-form .yt-model-sure-btn:eq(0)').off().on('click',function(){$yt_baseElement.showLoading();var mergeCourseId="";var tipCourseName="";$('.merge-course-id').each(function(){var checkCourseId=$(this).val();if(mergeCourseId==""){mergeCourseId+=checkCourseId}else{mergeCourseId+=','+checkCourseId}if(histCourseId.indexOf(checkCourseId)!=-1){if(tipCourseName==""){tipCourseName+=$(this).parent().find('td:eq(4)').text()}else{tipCourseName+=","+$(this).parent().find('td:eq(4)').text()}}});var courseName=$('.merge-couse-name').val();if(tipCourseName==""){$.ajax({type:"post",url:$yt_option.base_path+"class/course/updateCourseMerge",data:{mergeCourseId:mergeCourseId,courseName:courseName,projectCode:projectCode},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("合并成功")});$(".merge-score-form").hide()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("合并失败")})}}})}else{$yt_baseElement.hideLoading();var msg='';var couseArray=tipCourseName.split(',');for(var i=0;i<couseArray.length;i+=1){msg+='《'+couseArray[i]+'》课程已合并,请重新选择</br>'}$('.merge-score-form').hide();$yt_alert_Model.alertOne({haveCloseIcon:false,leftBtnName:"取消",alertMsg:msg,cancelFunction:function(){$('.merge-score-form').show()}})}});$('.merge-score-form').off().on('click','.cancel-merge-btn',function(){var courseIds=$(this).parent().find('input:eq(0)').val();var projectCode=$yt_common.GetQueryString("projectCode");var mergeCode=$(this).parent().find('.course-merge-code').val();$.ajax({type:"post",url:$yt_option.base_path+"class/course/updateCancelCourseMerge",data:{mergeCode:mergeCode,courseId:courseIds,projectCode:projectCode},async:true,success:function(data){debugger;if(data.flag==0){$yt_alert_Model.prompt("取消合并成功");$(this).parent().remove()}else{$yt_alert_Model.prompt("取消合并失败")}}})});$('.merge-score-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".merge-score-form").hide();$("#pop-modle-alert").hide()})});$('.apply-car-couse').click(function(){$('.apply-car-form .course-type').text("");$('.apply-car-form .course-time').text("");$('.apply-car-form .course-theme').text("");$('.apply-car-form .course-teacher').text("");$('.bus-num').val("");$('.course-place').val("");var couseInfo=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");console.log(couseInfo);var couseInfoLength=$("input[name='couseCheck']:checked").parents("tr").length;console.log("couseInfo",couseInfoLength+couseInfo);if(couseInfoLength==1&&couseInfo!=null){$('.apply-car-form .course-type').text(couseInfo.courseTypeName);$('.apply-car-form .course-time').text(couseInfo.courseDate+' '+couseInfo.courseTime);$('.apply-car-form .course-theme').text(couseInfo.courseTypeName);$('.apply-car-form .course-teacher').text(couseInfo.courseTypeName)}var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/getClassCourseCarList",data:{projectCode:projectCode},async:true,success:function(data){if(data.flag==0){var htmlBody=$('.apply-car-form table:eq(1) tbody');htmlBody.empty();var htmlStr='';$.each(data.data,function(j,k){if(k.sendCarType==1){k.sendCarType="派车中"}else{k.sendCarType="已派车"}htmlStr='<tr><input class="apply-course-id" type="hidden" value="'+k.courseId+'"/><td>'+k.courseTypeName+'</td><td>'+k.courseDate+'</td><td><a class="yt-link course-name">'+k.courseName+'</a></td><td style="text-align:right;padding-right:65px;">'+k.userCount+'</td><td style="text-align:left;">'+k.address+'</td><td>'+k.sendCarType+'</td></tr>';htmlBody.append(htmlStr)});$yt_baseElement.hideLoading()}}});var user='';var dataObj='';$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"courseCar",processInstanceId:"",parameters:"",versionNum:""},async:true,success:function(data){if(data.flag==0){console.log(data.data);$.each(data.data,function(i,n){console.log(n);console.log(i);for(var k in n){console.log('k',k);console.log("n[k]",n[k]);user=n[k][0].userCode;console.log(user);dataObj=eval("("+k+")");console.log(dataObj);console.log(dataObj.nextCode)}})}}});$(".apply-car-form .yt-model-sure-btn").off().on('click',function(){var userCount=$('.bus-num').val();var address=$('.course-place').val();if(couseInfoLength==1&&couseInfo!=null){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/addCourseUseCar",data:{projectCode:projectCode,courseId:couseInfo.pkId,userCount:userCount,address:address,businessCode:"courseCar",dealingWithPeople:user,opintion:"",processInstanceId:"",nextCode:dataObj.nextCode},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("新增用车成功")})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("新增用车失败")})}}})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("请选中一行数据进行新增")})}});$('.apply-car-form').on('click','.cancel-car',function(){});$('.apply-car-form').on('click','.course-name',function(){var courseId=$('.apply-course-id').val();var types="";$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/getCourseUseCar",data:{projectCode:projectCode,courseId:courseId},async:true,success:function(data){if(data.flag==0){if(data.data.sendCarType!=2){$('.details-tab').hide()}else{$('.details-tab').show()}$('.apply-car-details-form .course-type-details').text(data.data.types);$('.apply-car-details-form .course-time-details').text(data.data.courseTime);$('.apply-car-details-form .course-theme-details').text(data.data.courseName);$('.apply-car-details-form .course-teacher-details').text(data.data.teacherName);$('.apply-car-details-form .bus-num-details').text(data.data.userCount);$('.apply-car-details-form .course-place-details').text(data.data.address);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}});$(".apply-car-form").hide();$(".apply-car-details-form").show();$yt_alert_Model.getDivPosition($(".apply-car-details-form"));$yt_model_drag.modelDragEvent($(".apply-car-details-form .yt-edit-alert-title"));$('.apply-car-details-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".apply-car-details-form").hide();$(".apply-car-form").show();})});$(".apply-car-form").show();$yt_alert_Model.getDivPosition($(".apply-car-form"));$yt_model_drag.modelDragEvent($(".apply-car-form .yt-edit-alert-title"));$('.apply-car-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".apply-car-form").hide();$("#pop-modle-alert").hide()})});$(".address-type").change(function(){if($(this).val()=="1"){$(".external-address").hide();$(".internal-address").show()}else{$(".internal-address").hide();$(".external-address").show()}$yt_alert_Model.setFiexBoxHeight($(".select-room-box .yt-edit-alert-main"))});$(".select-room-box .key-word .search-btn").click(function(){me.getClassRooms()})},getCourseList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({async:true,url:$yt_option.base_path+"class/course/lookForAll",type:"post",data:{projectCode:projectCode},success:function(data){if(data.flag==0){var htmlTbody=$('.course-list-tbody').empty();var htmlTr='';if(data.data.rows.length>0){var rowSpanNum=1;var rowSpanStr='';var lastTr;$.each(data.data.rows,function(i,n){var fileName='';var fileUrl='';if(n.files!=''&&$.parseJSON(n.files).length>0){fileUrl=$.parseJSON(n.files)[0].fileUrl;fileName='<span class="file-name" fileUrl="'+fileUrl+'">'+$.parseJSON(n.files)[0].fileName+'</span>'}htmlTr='<tr>';if(rowSpanStr!=n.courseDate){$('.course-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan",rowSpanNum);lastTr=i;rowSpanStr=n.courseDate;htmlTr+='<td class="bgn">'+n.courseDate+'</td>';rowSpanNum=1}else{rowSpanNum+=1}htmlTr+='<td> <label class="check-label yt-checkbox"><input type="checkbox" name="couseCheck" value="1"/>'+n.courseTime+'</label><div class="checkbox-top"></div></td><td>'+(n.courseTypeCode=='teachingActivities'?n.courseTypeDetails:n.courseTypeName)+'</td><td>'+n.teacherName+'</td><td>'+n.courseName+'</td><td>'+fileName+'</td><td>'+(n.classroomNames==""?n.address:n.classroomNames)+'</td></tr>';htmlTr=$(htmlTr).data("couseInfo",n);htmlTbody.append(htmlTr)});$('.course-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan",rowSpanNum);$(".course-list-tbody tr").unbind().bind("click",function(){if($(this).find("input[type='checkbox']")[0].checked==true){$(this).find("input[type='checkbox']").setCheckBoxState("uncheck");$(this).removeClass("yt-table-active")}else{$(this).find("input[type='checkbox']").setCheckBoxState("check");$(this).addClass("yt-table-active")}})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},getTeacherList:function(){$("select.teacher-list-selt").empty();$.ajax({type:"post",url:$yt_option.base_path+"class/course/getTeacherAll",async:false,success:function(data){if(data.flag==0){$.each(data.data,function(i,n){$("select.teacher-list-selt").append('<option value="'+n.teacherId+'">'+n.teacherName+'</option>')});$("select.teacher-list-selt").niceSelect()}},error:function(data){}})},getCourseType:function(){$.ajax({type:"post",url:"class/course/getCourseType",data:{courseTypeName:""},async:false,success:function(data){if(data.flag==0){$("select.couse-type").empty();$.each(data.data,function(i,n){$("select.couse-type").append('<option value="'+n.courseTypeCode+'">'+n.courseTypeName+'</option>')})}else{$yt_alert_Model.prompt("课程类型查询失败")}},error:function(data){$yt_alert_Model.prompt("课程类型查询失败")}});$("select.couse-type").niceSelect()},deleteCouse:function(pkId){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/deleteCourse",data:{pkId:pkId},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("课程删除成功");courseManager.getCourseList()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("课程删除失败")})}},error:function(data){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("课程删除失败")})}})},editCouseInfo:function(pkId){var postState=true;var courseTypeCode=$(".couse-type").val();var formData={};var projectCode=$yt_common.GetQueryString("projectCode");if(courseTypeCode=="openingCeremony"||courseTypeCode=="windingUp"){if($yt_valid.validFont($(".add-course-box input[name='courseName']"))){var formData=$(".add-course-box").getDatas();formData.projectCode=projectCode;formData.giveType=$(".add-course-box [name='giveType']:checked").val();formData.isNeedGroupPhoto=$(".add-course-box [name='isNeedGroupPhoto']:checked").val()}else{postState=false}}else if(courseTypeCode=="teachingActivities"){if($yt_valid.validFont($(".add-course-box input[name='courseName']"))){var formData=$(".add-course-box").getDatas();formData.projectCode=projectCode;formData.giveType=$(".add-course-box [name='giveType']:checked").val();formData.courseTypeDetails=$(".add-course-box [name='courseTypeDetails']").val()}else{postState=false}}else{if($yt_valid.validFont($(".add-course-box input[name='courseName']"))){var formData=$(".add-course-box").getDatas();formData.projectCode=projectCode;formData.giveType=$(".add-course-box [name='giveType']:checked").val();formData.teacherId=$(".add-course-box [name='teacherId']").val();formData.types=$(".add-course-box [name='fileType']:checked").val();var fileId=$(".add-course-box [name='fileType']:checked").parent().next().data("fileInfo").pkId;var fileName=$(".add-course-box [name='fileType']:checked").parent().next().data("fileInfo").naming;formData.files=JSON.stringify([{fileId:fileId,fileName:fileName,fileTypes:2}])}else{postState=false}}if(postState){if(pkId){formData.pkId=pkId}$yt_baseElement.showLoading();$.ajax({type:"post",url:"class/course/addOrUpdateCourse",async:true,data:formData,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作成功");courseManager.getCourseList()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作失败")})}},error:function(data){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作失败")})}})}},uploadFiles:function(){var couseInfo=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");var projectCode=$yt_common.GetQueryString("projectCode");var teacherId=couseInfo.teacherId;var pkId=couseInfo.pkId;var fileId=$(".couse-file-box input[name='fileType']:checked").parent().next().data("fileInfo").pkId;var fileName=$(".couse-file-box input[name='fileType']:checked").parent().next().data("fileInfo").naming;var types=$(".couse-file-box input[name='fileType']:checked").val();var files=JSON.stringify([{fileId:fileId,fileName:fileName,types:types,fileTypes:2}]);$yt_baseElement.showLoading();$.ajax({type:"post",url:"class/course/uploadFiles",data:{projectCode:projectCode,teacherId:teacherId,files:files,pkId:pkId},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传成功");courseManager.getCourseList();$(".couse-file-box").hide()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作异常")})}},error:function(data){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("网络出现异常，请稍后重试")})}})},getClassRooms:function(){var courseDate=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");var classroomIds=courseDate.classsroomIds;console.log(classroomIds);var projectCode=$yt_common.GetQueryString("projectCode");var classroomName=$(".select-room-box .key-word input").val();$(".rooms-page").pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/course/getClassRooms",type:"post",data:{classroomName:classroomName,projectCode:projectCode},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.rooms-tbody').empty();var htmlTr='';var courseDate=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo").courseDate;var weekList=ytDate.startStop(courseDate);$(".sun-head").nextAll().remove();$(".sun-head").remove();var th='';var day=0;var className='';$.each(weekList,function(i,n){day=new Date(n).getDate();if(i==0){className='sun-head'}else if(i==6){className='sat-head'}else{className=''}th='<th width="18px" class="state-day '+className+'" currentDay="'+n+'">'+day+'</th>';$(".select-room-box table thead tr").append(th)});var arrIndex=0;var stateObj=null;if(data.data.rows.length>0){var stateDay='<td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td>';$.each(data.data.rows,function(i,n){htmlTr='<tr><td rowspan="3" class="tc"><label class="check-label yt-checkbox"><input class="check-box"  type="checkbox" value="'+n.pkId+'"/></label></td><td rowspan="3" class="room-name"><span>'+n.classroomName+'</span></td><td rowspan="3">'+n.types+'</td><td rowspan="3" class="tr">'+n.galleryful+'</td><td>上午</td>'+stateDay+'</tr><tr><td>下午</td>'+stateDay+'</tr><tr><td>晚上</td>'+stateDay+'</tr>';htmlTr=$(htmlTr).data("roomInfo",n);$.each(n.classroomStates,function(j,m){arrIndex=$.inArray(m.classroomDate,weekList);if(arrIndex!=-1){stateObj=htmlTr.eq(parseInt(m.dataType)-1).find(".state-day").eq(arrIndex).data("arrIndex",arrIndex);stateObj.addClass(m.classroomStates==0?"all-use":"sub-use")}});htmlTbody.append(htmlTr)});$(".rooms-tbody .state-day").each(function(i,n){if($(n).hasClass("all-use")||$(n).hasClass("sub-use")){if(i%7==0){$(n).addClass("start-state")}else if((i+1)%7==0){$(n).addClass("end-state")}else{var lastDay=$(".rooms-tbody .state-day").eq(i-1);var nextDay=$(".rooms-tbody .state-day").eq(i+1);if(!lastDay.hasClass("all-use")&&!lastDay.hasClass("sub-use")){$(n).addClass("start-state")}if(!nextDay.hasClass("all-use")&&!nextDay.hasClass("sub-use")){$(n).addClass("end-state")}}}})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading();$('.room-name span').tooltip({position:'right',content:function(){var roomInfo=$(this).parent().parent().data("roomInfo");roomInfo.infrastructure=roomInfo.infrastructure.replace("1","白板").replace("2","投影").replace("3","扩音器").replace("4",roomInfo.infrastructureOther);var showBox='<table class="tip-table"><tr><td class="tip-lable">教室序号：</td><td>A303</td></tr><tr><td class="tip-lable">类型：</td><td>'+roomInfo.types+'</td></tr><tr><td class="tip-lable">可容纳人数：</td><td>'+roomInfo.galleryful+'人</td></tr><tr><td class="tip-lable">基础设施：</td><td>'+roomInfo.infrastructure+'</td></tr><tr><td class="tip-lable">备注：</td><td>'+roomInfo.remarks+'</td></tr></table>';return showBox},onShow:function(){$(this).tooltip('tip').css({backgroundColor:'#666',borderColor:'#666'})}});$yt_alert_Model.setFiexBoxHeight($(".select-room-box .yt-edit-alert-main"))}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}$yt_alert_Model.getDivPosition($(".select-room-box"))}})}};var studentList={init:function(){$('.org-type').niceSelect();var traineeId;$('.class-student-stration-form .group-id-elementary').change(function(){groupId=$(this).val();var companyList=studentReport.getCompanyList(groupId);if(companyList!=""){$('.org-id').empty();$('.org-id').append(' <option value="">请选择</option>');$.each(companyList,function(i,o){$('.org-id').append(' <option value="'+o.orgId+'">'+o.orgName+'</option>')});$('.org-id').niceSelect()}else{$('.org-id').empty();$('.org-id').append(' <option value="">请选择</option>')}});$('.box-list').on('click','.real-name-inf',function(){var studentList=$('.yt-table-active').data('studentList');var traineeId=studentList.traineeId;var headImg=new Image();var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeDetails",data:{traineeId:traineeId,projectId:projectCode},async:true,success:function(data){var htmlBody=$('.student-details-form .student-details-train-record tbody');var htmlTrs='';htmlBody.empty();if(data.flag==0){detailsMsg=data.data;detailsMsg.checkInDate=detailsMsg.checkInDate.split(" ")[0];if(detailsMsg.gender==1){detailsMsg.gender="男"}else{detailsMsg.gender="女"}if(detailsMsg.invoiceType==0){detailsMsg.invoiceType="暂不开票"}else if(detailsMsg.invoiceType==1){detailsMsg.invoiceType="普通发票"}else{detailsMsg.invoiceType="增值税发票"}if(detailsMsg.checkInState==0){detailsMsg.checkInState="未报到"}else{detailsMsg.checkInState="已报到"}if(detailsMsg.paymentState==0){detailsMsg.paymentState="未缴费"}else{detailsMsg.paymentState="已缴费"}if(detailsMsg.isOrderNum==0){detailsMsg.isOrderNum="未开票"}else{detailsMsg.isOrderNum="已开票"}$('.student-details-form .cont-edit-test').setDatas(detailsMsg);console.log("学员头像",detailsMsg.headPortraitUrl);if(detailsMsg.headPortrait!=""){headImg.src=detailsMsg.headPortraitUrl;headImg.onload=function(){$('.student-details-img').attr('src',headImg.src);$('.student-details-img').jqthumb({width:89,height:130})}}else{$('.student-details-img').attr('src','../../resources/images/classStudent/student-picture.png');$('.student-details-img').jqthumb({width:89,height:130})}$.each(detailsMsg.trainList,function(i,b){htmlTrs='<tr><td>'+b.projectCode+'</td><td>'+b.projectName+'</td><td>'+b.startDate+'</td><td>'+b.projectHead+'</td><td>'+b.certificateNo+'</td></tr>';htmlBody.append(htmlTrs)});$yt_baseElement.hideLoading()}}});$(".student-details-form").show();$yt_alert_Model.setFiexBoxHeight($(".student-details-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".student-details-form"));$yt_model_drag.modelDragEvent($(".student-details-form .yt-edit-alert-title"));$('.student-details-form .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){$(".student-details-form").hide()})});$('.class-set-committee-btn').on('click',function(){if($('.student-div tbody label input[type="checkbox"]:checked').length==1){var committee='';var committeeName=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').realName;$('.class-student-set-committee-from .need-set-group').text(committeeName);$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeCommittee",data:{committee:committee},async:true,success:function(data){var htmlBody=$('.class-student-set-committee-from .set-group-lable');var htmlTr='';htmlBody.empty();if(data.flag==0){$.each(data.data,function(i,v){htmlTr='<label class="check-label yt-radio "><input  type="radio" name="test"  value="'+v.classCommitteeId+'"/>'+v.classCommitteeName+'</label>';htmlBody.append(htmlTr)})}}});$(".class-student-set-committee-from").show();$yt_alert_Model.getDivPosition($(".class-student-set-committee-from"));$yt_model_drag.modelDragEvent($(".class-student-set-committee-from .yt-edit-alert-title"));$('.class-student-set-committee-from .yt-model-sure-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var traineeId=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').traineeId;var classCommitteeId=$('.class-student-set-committee-from .set-group-lable input[name="test"]:checked').val();console.log(classCommitteeId);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/updateTraineeCommittee",data:{projectCode:projectCode,traineeId:traineeId,classCommitteeId:classCommitteeId},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("设置班委成功");$(".class-student-set-committee-from").hide();studentList.getStudentList();studentList.getDifferentList()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("设置班委失败")})}}})});$('.class-student-set-committee-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-set-committee-from").hide()})}else{$yt_alert_Model.prompt("请选择一行设置班委")}});$('.class-set-group-post-btn').on('click',function(){if($('.student-div tbody label input[type="checkbox"]:checked').length==1){var setName=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').realName;$('.class-student-set-group-post-from .need-set-group').text(setName);$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').hide();var setRadioVal=$('.class-student-set-group-post-from .set-group-lable input[name="test"]');var groupPositionType;setRadioVal.change(function(){debugger;groupPositionType=$(this).val();if($(this).val()==1||$(this).val()==2){$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').hide()}else{$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').show()}});$(".class-student-set-group-post-from").show();$yt_alert_Model.getDivPosition($(".class-student-set-group-post-from"));$yt_model_drag.modelDragEvent($(".class-student-set-group-post-from .yt-edit-alert-title"));$('.class-student-set-group-post-from .yt-model-sure-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var traineeId=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').traineeId;var groupPositionData=$('.class-student-set-group-post-from .set-group-custom-input').val();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/updateTraineeGroupPosition",data:{projectCode:projectCode,traineeId:traineeId,groupPositionType:groupPositionType,groupPositionData:groupPositionData},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("分组职务设置成功");$(".class-student-set-group-post-from").hide()});studentList.getStudentList();studentList.getDifferentList()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("分组职务设置失败")})}}})});$('.class-student-set-group-post-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-set-group-post-from").hide()})}else{$yt_alert_Model.prompt("请选择一行添加职务")}});$('.class-set-group-btn').on('click',function(){$('.class-student-set-group-from .set-group-num').val("");var traineeIds='';var traineeNames='';if($('.student-div tbody label input[type="checkbox"]:checked').length!=0){$('.class-student-set-group-from .set-group-selected-length').text($('.student-div tbody label input[type="checkbox"]:checked').length);$('.student-div tbody label input[type="checkbox"]:checked').each(function(){if(traineeIds==''){traineeIds+=$(this).parent().parent().parent().data('studentList').traineeId;traineeNames+=$(this).parent().parent().parent().data('studentList').realName}else{traineeIds+=', '+$(this).parent().parent().parent().data('studentList').traineeId;traineeNames+=', '+$(this).parent().parent().parent().data('studentList').realName}});console.log(traineeNames);console.log(traineeIds);$('.class-student-set-group-from .set-group-list').text(traineeNames);$(".class-student-set-group-from").show();$yt_alert_Model.getDivPosition($(".class-student-set-group-from"));$yt_model_drag.modelDragEvent($(".class-student-set-group-from .yt-edit-alert-title"));$('.class-student-set-group-from .yt-model-sure-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var groupNum=$('.class-student-set-group-from .set-group-num').val();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/updateTraineeGroup",data:{projectCode:projectCode,groupNum:groupNum,traineeIds:traineeIds},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("分组设置成功");$(".class-student-set-group-from").hide()});studentList.getStudentList();studentList.getDifferentList()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("分组设置失败")})}}})});$('.class-student-set-group-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-set-group-from").hide()})}else{$yt_alert_Model.prompt("请选择数据进行分组")}});$('.class-reserve-room-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam="";var gender="";var phone="";var groupId="";var orgId="";var deptPosition="";var isFirstTraining="";var classCommitteeId="";var signUpState="";var checkInState="";var sort="";var orderType="";$('.class-reserve-room-from .page-info').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/trainee/getClassTrainee",type:"post",data:{projectCode:projectCode,selectParam:selectParam,gender:gender,phone:phone,groupId:groupId,orgId:orgId,deptPosition:deptPosition,isFirstTraining:isFirstTraining,classCommitteeId:classCommitteeId,signUpState:signUpState,checkInState:checkInState,sort:sort,orderType:orderType},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.class-reserve-room-from .list-tbody');var htmlTr='';$(htmlTbody).empty();if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}htmlTr='<tr><input type="hidden" class="reserve-room-trainee-id" value="'+v.traineeId+'"/><td style="text-align: left;padding-left: 20px;">'+v.realName+'</td><td style="text-align: center;">'+v.gender+'</td><td style="text-align: center;">'+v.phone+'</td><td>'+v.groupOrgName+'</td><td>'+v.deptName+'</td><td><input class="yt-input room-number" value="'+v.roomNumber+'"/></td></tr>';htmlTr=$(htmlTr).data('reserveList',v);htmlTbody.append(htmlTr)})}else{htmlTr='<tr class="class-tr"><td colspan="6" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true });$(".class-reserve-room-from").show();$yt_alert_Model.getDivPosition($(".class-reserve-room-from"));$yt_model_drag.modelDragEvent($(".class-reserve-room-from .yt-edit-alert-title"));$('.class-reserve-room-from .yt-model-sure-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var list=[];$('.class-reserve-room-from .list-tbody .room-number').each(function(){if($(this).val()!=""){var traineeId=$(this).parent().parent().find('.reserve-room-trainee-id').val();var roomNumber=$(this).val();var reserveList={traineeId:traineeId,roomNumber:roomNumber};list.push(reserveList)}});console.log(list);var traineeIdRoomNumber=JSON.stringify(list);console.log(traineeIdRoomNumber);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/updateTraineeRoomNumber",data:{projectCode:projectCode,traineeIdRoomNumber:traineeIdRoomNumber},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("预定成功")})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("预定失败")})}}})});$('.class-reserve-room-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-reserve-room-from").hide()})});$('.batch-import-form .download-template').click(function(){var fileName="学员列表.xls";$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/downloadTraineeByClass",data:{fileName:fileName}})});$('.batch-import-form .yt-model-sure-btn').off().on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var file=$('.batch-import-form .import-file-name').val();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/leadingTraineeByClass",data:{projectCode:projectCode,file:file},async:true,success:function(data){if(data.flag==0){$yt_alert_Model.prompt("导入成功")}else{$yt_alert_Model.prompt("导入失败")}}})});$(".batch-import-form").undelegate().delegate("input[type='file']","change",function(){console.log($(this)[0].files[0].name);$('.batch-import-form .import-file-name').val($(this)[0].files[0].name)});$('.student-import-btn').on('click',function(){$(".batch-import-form").show();$yt_alert_Model.getDivPosition($(".batch-import-form"));$yt_model_drag.modelDragEvent($(".batch-import-form .yt-edit-alert-title"));$('.batch-import-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".batch-import-form").hide();$("#pop-modle-alert").hide()})});$('.student-upload-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var exportName=$('.project-name:eq(0)').text()+"学员列表.xls";var gender="";var phone="";var groupId="";var orgId="";var deptPosition="";var isFirstTraining="";var classCommitteeId="";var signUpState="";$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/exportTraineeByClass",data:{projectCode:projectCode,exportName:exportName,gender:gender,phone:phone,groupId:groupId,orgId:orgId,deptPosition:deptPosition,isFirstTraining:isFirstTraining,classCommitteeId:classCommitteeId,signUpState:signUpState}})});$('.student-delete-btn').on('click',function(){debugger;var traineeIds='';if($('.student-div label input[type="checkbox"]:checked').length!=0){$('.student-div label input[type="checkbox"]:checked').each(function(){if(traineeIds==''){traineeIds+=$(this).parent().parent().parent().data('studentList').traineeId}else{traineeIds+=','+$(this).parent().parent().parent().data('studentList').traineeId}});console.log(traineeIds);var projectCode=$yt_common.GetQueryString("projectCode");$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"./resources/images/icons/x.png",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/deleteTrainee",data:{projectCode:projectCode,traineeIds:traineeIds},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除成功")});studentList.getStudentList();studentList.getDifferentList()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除失败")});studentList.getStudentList();studentList.getDifferentList()}}})}})}else{$yt_alert_Model.prompt("请选择数据进行删除")}});$('.student-add-btn').on('click',function(){traineeId="";$('.class-student-stration-form .yt-edit-alert-title-msg').text("新增学员");$('.class-student-stration-form .class-student-name').val("");$('.class-student-stration-form .class-student-group-num').val("");;$('.class-student-stration-form .class-student-name').parent().nextAll().find('input[type="radio"][value="1"]').setRadioState("check");$('.class-student-stration-form .student-nation').setSelectVal("");$('.class-student-stration-form .class-student-phone').val("");$('.class-student-stration-form .card-type').setSelectVal("");$('.class-student-stration-form .id-number').val("");$('.class-student-stration-form .group-id-elementary').setSelectVal("");$('.class-student-stration-form .org-id').setSelectVal("");$('.class-student-stration-form .student-msg .dept-name').val("");var positionName="";$('.class-student-stration-form .student-link-man').val("");$('.class-student-stration-form .student-link-man-phone').val("");$('.class-student-stration-form .student-link-man-telephone').val("");$('.class-student-stration-form .student-link-man-fax').val("");$('.class-student-stration-form .student-link-man-email').val("");$('.class-student-stration-form .student-link-man-address-email').val("");$('.class-student-stration-form .date-birth').val();$('.class-student-stration-form .org-type').setSelectVal("");$('.class-student-stration-form .mailing-address').val("");$('.class-student-stration-form .postal-code').val("");$('.class-student-stration-form .class-student-fax').val("");$('.class-student-stration-form .party-date').val();$('.class-student-stration-form .education-time').val("");$('.class-student-stration-form .education-time-class').val("");$('.class-student-stration-form .service-time').val("");$('.class-student-stration-form .service-time-class').val("");$('.class-student-stration-form .telephone-project').val("");$('.class-student-stration-form .class-student-email').val("");$('.class-student-stration-form .work-time').val("");$(".class-student-stration-form").show();$yt_alert_Model.setFiexBoxHeight($(".class-student-stration-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".class-student-stration-form"));$yt_model_drag.modelDragEvent($(".class-student-stration-form .yt-edit-alert-title"));$('.class-student-stration-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-stration-form").hide();$("#pop-modle-alert").hide()})});$('.student-update-btn').on('click',function(){var studenList=$('.student-div .yt-table-active').data('studentList');console.log('studentList',studenList);if(studenList!=null){var studentDetailedMsg=studentList.getStudentDetailedMsg();$('.class-student-form .yt-edit-alert-title-msg').text("修改学员");traineeId=studenList.traineeId;$('.student-list-for').setDatas(studentDetailedMsg);if(studenList.gender=="男"){studenList.gender=1}else if(studenList.gender=="女"){studenList.gender=2}var gender=$('.class-student-stration-form .class-student-name').parent().nextAll().find('input[type="radio"][value="'+studenList.gender+'"]').setRadioState("check");$('.class-student-stration-form .student-nation').setSelectVal(studentDetailedMsg.nationId);$('.class-student-stration-form .card-type').setSelectVal(studentDetailedMsg.idType);$('.class-student-stration-form .group-id-elementary').setSelectVal(studentDetailedMsg.groupId);groupId=studentDetailedMsg.groupId;var companyList=studentReport.getCompanyList(groupId);if(companyList!=""){$('.org-id').empty();$('.org-id').append(' <option value="">请选择</option>');$.each(companyList,function(i,o){$('.org-id').append(' <option value="'+o.orgId+'">'+o.orgName+'</option>')});$('.org-id').niceSelect()}else{$('.org-id').empty();$('.org-id').append(' <option value="">请选择</option>')}$('.class-student-stration-form .org-id').setSelectVal(studentDetailedMsg.groupOrgId);$(".class-student-stration-form").show();$yt_alert_Model.setFiexBoxHeight($(".class-student-stration-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".class-student-stration-form"));$yt_model_drag.modelDragEvent($(".class-student-stration-form .yt-edit-alert-title"));$('.class-student-stration-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-stration-form").hide();$("#pop-modle-alert").hide()})}else{$yt_alert_Model.prompt("请选择一行进行修改")}});$(".class-student-stration-form .yt-model-sure-btn").on('click',function(){debugger;var projectCode=$yt_common.GetQueryString("projectCode");var realName=$('.class-student-stration-form .class-student-name').val();var groupNum=$('.class-student-stration-form .class-student-group-num').val();;var gender=$('.class-student-stration-form .class-student-name').parent().nextAll().find('input[type="radio"]:checked').val();var nationId=$('.class-student-stration-form .student-nation').val();var phone=$('.class-student-stration-form .class-student-phone').val();var idType=$('.class-student-stration-form .card-type').val();var idNumber=$('.class-student-stration-form .id-number').val();var groupId=$('.class-student-stration-form .group-id-elementary').val();var orgId=$('.class-student-stration-form .org-id').val();var deptName=$('.class-student-stration-form .student-msg .dept-name').val();var positionName="";var linkman=$('.class-student-stration-form .student-link-man').val();var linkmanPhone=$('.class-student-stration-form .student-link-man-phone').val();var linkmanTelephone=$('.class-student-stration-form .student-link-man-telephone').val();var linkmanFax=$('.class-student-stration-form .student-link-man-fax').val();var linkmanEmail=$('.class-student-stration-form .student-link-man-email').val();var linkmanAddressEmail=$('.class-student-stration-form .student-link-man-address-email').val();var dateBirth=$('.class-student-stration-form .date-birth').val();var orgType=$('.class-student-stration-form .org-type').val();var mailingAddress=$('.class-student-stration-form .mailing-address').val();var postalCode=$('.class-student-stration-form .postal-code').val();var fax=$('.class-student-stration-form .class-student-fax').val();var partyDate=$('.class-student-stration-form .party-date').val();var educationTime=$('.class-student-stration-form .education-time').val();var educationTimeClass=$('.class-student-stration-form .education-time-class').val();var serviceTime=$('.class-student-stration-form .service-time').val();var serviceTimeClass=$('.class-student-stration-form .service-time-class').val();var telephone=$('.class-student-stration-form .telephone-project').val();var email=$('.class-student-stration-form .class-student-email').val();var workTime=$('.class-student-stration-form .work-time').val();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/addOrUpdateTrainee",data:{traineeId:traineeId,projectCode:projectCode,realName:realName,groupNum:groupNum,gender:gender,nationId:nationId,phone:phone,idNumber:idNumber,groupId:groupId,orgId:orgId,deptName:deptName,positionName:positionName,linkman:linkman,linkmanPhone:linkmanPhone,linkmanTelephone:linkmanTelephone,linkmanFax:linkmanFax,linkmanEmail:linkmanEmail,linkmanAddressEmail:linkmanAddressEmail,idType:idType,dateBirth:dateBirth,orgType:orgType,mailingAddress:mailingAddress,postalCode:postalCode,fax:fax,partyDate:partyDate,educationTime:educationTime,educationTimeClass:educationTimeClass,serviceTime:serviceTime,serviceTimeClass:serviceTimeClass,telephone:telephone,email:email,workTime:workTime},async:true,success:function(data){if(data.flag==0){console.log("traineeId",traineeId);$yt_baseElement.hideLoading(function(){if(traineeId==""){$yt_alert_Model.prompt("添加成功")}else{$yt_alert_Model.prompt("修改成功")}studentList.getStudentList();$(".class-student-stration-form").hide()})}else{$yt_baseElement.hideLoading(function(){if(traineeId==""){$yt_alert_Model.prompt("添加失败")}else{$yt_alert_Model.prompt("修改失败")}studentList.getStudentList();$(".class-student-stration-form").hide()})}}})})},getStudentDetailedMsg:function(){debugger;var studentList=$('.student-div .yt-table-active').data('studentList');var traineeId=studentList.traineeId;var studentDetailedMsg;var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeDetails",data:{traineeId:traineeId,projectId:projectCode},async:false,success:function(data){if(data.flag==0){studentDetailedMsg=data.data}}});return studentDetailedMsg},getStudentList:function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.student-div .keyword').val();var gender="";var phone="";var groupId="";var orgId="";var deptPosition="";var isFirstTraining="";var classCommitteeId="";var signUpState="";var checkInState="";var sort="";var orderType="";$('.student-div .page-info').eq(0).pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/trainee/getClassTrainee",type:"post",data:{projectCode:projectCode,selectParam:selectParam,gender:gender,phone:phone,groupId:groupId,orgId:orgId,deptPosition:deptPosition,isFirstTraining:isFirstTraining,classCommitteeId:classCommitteeId,signUpState:signUpState,checkInState:checkInState,sort:sort,orderType:orderType},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.student-div .student-list-tbody');var htmlTr='';var num=1;$(htmlTbody).empty();if(data.data.rows.length>0){$('.student-div .page-info').show();$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}if(v.isFirstTraining==0){v.isFirstTraining="否"}else{v.isFirstTraining="是"}if(v.checkInState==0){v.checkInState="未报到"}else{v.checkInState="已报到"}htmlTr='<tr><td><label class="check-label yt-checkbox"><input class="check-box" type="checkbox"/></label></td><td style="text-align: center;"><input type="hidden" value="'+v.pkId+'" class="pkId">'+v.groupNum+'</td><td><a href="#" class="real-name-inf" style=" color:blue;word-break: break-all;">'+v.realName+'</a></td><td style="text-align: center;">'+v.gender+'</td><td style="text-align: center;">'+v.phone+'</td><td>'+v.groupName+'</td><td>'+v.orgName+'</td><td>'+v.deptName+'</td><td>'+v.classCommitteeName+'</td><td style="text-align: center;">'+v.isFirstTraining+'</td><td style="text-align: center;">'+v.checkInState+'</td></tr>';htmlTr=$(htmlTr).data('studentList',v);htmlTbody.append(htmlTr)});$yt_baseElement.hideLoading()}else{$('.student-div .page-info').hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="11" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr);$yt_baseElement.hideLoading()}}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getDifferentList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getHotelTraineeToClassTrainee",data:{projectCod:projectCode},async:true,success:function(data){var htmlBody=$('.student-div .different-student-list tbody ');var htmlTr='';var num=1;if(data.flag==0){if(data.data.length>0){htmlBody.parent().parent().show();$.each(data.data,function(k,b){htmlTr='<tr><td>'+num++ +'</td><td>'+b.traineeName+'</td><td>'+b.gender+'</td><td>'+b.idNumber+'</td><td>'+b.roomNumber+'</td><td>'+b.createTimeString+'</td><td>'+b.reason+'</td></tr>';htmlBody.append(htmlTr)})}else{htmlBody.parent().parent().hide()}}else{$yt_alert_Model.prompt("查询失败")}}})}};var repeatCourtyardList={init:function(){var sortNum='';$('.repeat-come-div thead th').eq(1).click(function(){if(sortNum==''){var orderType="ASC";repeatCourtyardList.getRepeatComeList(orderType);sortNum=1}else{var orderType="DESC";repeatCourtyardList.getRepeatComeList(orderType);sortNum=''}});$('.repeat-come-div .export-repeat-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.repeat-come-div .keyword').val();var gender="";var phone="";var orgId="";var deptPosition="";var startTimeStart="";var startTimeEnd="";var endTimeStart="";var endTimeEnd="";$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/exportRepeatClassTrainee",data:{projectCode:projectCode,gender:gender,phone:phone,orgId:orgId,deptPosition:deptPosition,startTimeStart:startTimeStart,startTimeEnd:startTimeEnd,endTimeStart:endTimeStart,endTimeEnd:endTimeEnd}})});$('.repeat-come-div .export-doubt-repeat-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.repeat-come-div .doubt-keyword').val();var gender="";var phone="";var orgId="";var deptPosition="";var startTimeStart="";var startTimeEnd="";var endTimeStart="";var endTimeEnd="";$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/exportRepeatClassDoubtfulTrainee",data:{projectCode:projectCode,gender:gender,phone:phone,orgId:orgId,deptPosition:deptPosition,startTimeStart:startTimeStart,startTimeEnd:startTimeEnd,endTimeStart:endTimeStart,endTimeEnd:endTimeEnd}})})},getRepeatComeList:function(orderType){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.repeat-come-div .keyword').val();var gender="";var phone="";var orgId="";var deptPosition="";var startTimeStart="";var startTimeEnd="";var endTimeStart="";var endTimeEnd="";var sort="";$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getRepeatClassTrainee",data:{projectCode:projectCode,selectParam:selectParam,gender:gender,phone:phone,orgId:orgId,deptPosition:deptPosition,startTimeStart:startTimeStart,startTimeEnd:startTimeEnd,endTimeStart:endTimeStart,endTimeEnd:endTimeEnd,sort:sort,orderType:orderType},async:true,success:function(data){var htmlBody=$('.repeat-come-div .repeat-list-tbody');var htmlTr="";var num=1;htmlBody.empty();if(data.flag==0){var rowSpanNum=1;var mergeName='';var mergePhone='';var lastTr;$.each(data.data.rows,function(i,n){htmlTr='<tr>';if(mergeName!=(n.realName+"----"+n.phone)){$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan",rowSpanNum);$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(1).attr("rowSpan",rowSpanNum);$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(2).attr("rowSpan",rowSpanNum);$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(3).attr("rowSpan",rowSpanNum);lastTr=i;mergeName=n.realName+"----"+n.phone;if(n.gender==1){n.gender="男"}else{n.gender="女"}htmlTr+='<td>'+num++ +'</td><td><a class="real-name-inf" style=" word-break: break-all;">'+n.realName+'</a></td><td>'+n.gender+'</td><td>'+n.phone+'</td>';rowSpanNum=1}else{rowSpanNum+=1}htmlTr+='<td>'+n.projectCode+'</td><td>'+n.projectName+'</td><td>'+n.startTime+'</td><td>'+n.endTime+'</td><td>'+n.orgName+'</td><td>'+n.deptPosition+'</td></tr>';htmlBody.append(htmlTr)});$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan",rowSpanNum);$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(1).attr("rowSpan",rowSpanNum);$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(2).attr("rowSpan",rowSpanNum);$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(3).attr("rowSpan",rowSpanNum);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt('查询失败')})}}})},doubtRepatComeList:function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.repeat-come-div .doubt-keyword').val();var gender="";var phone="";var orgId="";var deptPosition="";var startTimeStart="";var startTimeEnd="";var endTimeStart="";var endTimeEnd="";var sort="";$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getRepeatClassDoubtfulTrainee",data:{projectCode:projectCode,selectParam:selectParam,gender:gender,phone:phone,orgId:orgId,deptPosition:deptPosition,startTimeStart:startTimeStart,startTimeEnd:startTimeEnd,endTimeStart:endTimeStart,endTimeEnd:endTimeEnd},async:true,success:function(data){var htmlBody=$('.repeat-come-div .doubt-repeat-list-tbody');var htmlTr="";var num=1;htmlBody.empty();if(data.flag==0){var rowSpanNum=1;var mergeName='';var mergePhone='';var lastTr;$.each(data.data,function(i,n){if(n.gender==1){n.gender="男"}else{n.gender="女"}htmlTr='<tr>';if(mergeName!=n.realName&&mergePhone!=n.phone){$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan",rowSpanNum);$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(1).attr("rowSpan",rowSpanNum);lastTr=i;mergeName=n.realName;mergePhone=n.phone;htmlTr+='<td>'+num++ +'</td><td><a class="real-name-inf" style=" word-break: break-all;">'+n.realName+'</a></td>';rowSpanNum=1}else{rowSpanNum+=1}htmlTr+='<td>'+n.gender+'</td><td>'+n.phone+'</td><td>'+n.projectCode+'</td><td>'+n.projectName+'</td><td>'+n.startTime+'</td><td>'+n.endTime+'</td><td>'+n.orgName+'</td><td>'+n.deptPosition+'</td></tr>';htmlBody.append(htmlTr)});$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan",rowSpanNum);$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(1).attr("rowSpan",rowSpanNum);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt('查询失败')})}}})}};var studentManual={ue:null,init:function(){studentManual.ue=UE.getEditor('container',{toolbars:[['undo','redo','|','bold','italic','underline','forecolor','|','justifyleft','justifycenter','justifyright','justifyjustify','|','simpleupload','attachment']],autoHeightEnabled:true,elementPathEnabled:false,enableAutoSave:false,autoFloatEnabled:false,maximumWords:1000,saveInterval:0});$('.student-manual-div .student-manual-btn').click(function(){console.log($(this).index());$(this).addClass('change-page-sign').siblings().removeClass('change-page-sign');$('.student-manual-div .manual-div').hide().eq($(this).index()).show()});$(".student-manual-div").undelegate().delegate("input[type='file']","change",function(){console.log($(this)[0].files[0]);var type=$(this)[0].files[0].type;var size=$(this)[0].files[0].size;console.log(type);if(size<=307200&&type=='image/jpeg'||size<=307200&&type=='image/png'){var url=$yt_option.acl_path+"api/tAscPortraitInfo/addFile";$yt_baseElement.showLoading();$.ajaxFileUpload({url:url,type:"post",data:{file:name,modelCode:'or-codesss',uploadType:1,type:'PC'},dataType:'json',fileElementId:"uploadOrCode",success:function(data,textStatus){var resultData=$.parseJSON(data);if(resultData.success==0){console.log(resultData.obj.pkId);$('.student-manual-div .upload-or-code-img').attr('src',$yt_option.acl_path+'api/tAscPortraitInfo/download?pkId='+resultData.obj.pkId+'&isDownload=false');$('.qr-code-id').val(resultData.obj.pkId);$('.qr-code-name').val(resultData.obj.naming);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传失败")})}},error:function(data,status,e){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传失败")})}})}else{$yt_alert_Model.prompt("请选择正确格式")}});$('.manual-main-div .save-btn').on('click',function(){console.log("imgFileId",imgFileId,"imgFileName",imgFileName);var imgFileId=$('.qr-code-id').val();var imgFileName=$('.qr-code-name').val();studentManual.manualOperation(imgFileId,imgFileName)});$('.manual-main-div .yt-model-canel-btn').on('click',function(){$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"./resources/images/icons/x.png",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"确定取消当前页面的所有操作吗?",confirmFunction:function(){studentManual.getPageDataList()}})});$('.entrust-company .add-student-manual').on('click',function(){var htmlTr='<tr><td><input class="yt-input entrust-name" style="width: 101px;" type="text"/></td><td><input class="yt-input entrust-dept" type="text"/></td><td><input class="yt-input entrust-room-num" type="text"/></td><td><input class="yt-input entrust-phone" type="text"/></td><td style="text-align: center;"><img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td></tr>';$(this).prev().find('tbody').append(htmlTr);$('.college-project-post').niceSelect()});$('.college-project .add-student-manual').on('click',function(){var htmlTr='<tr><td><input class="yt-input college-project-name" style="width: 101px;" type="text"/></td><td><input class="yt-input college-project-dept" type="text"/></td><td><select class="yt-select college-project-post"><option value="1">带班院领导</option><option value="2">项目组组长</option><option value="3">夜间值班室</option></select></td><td><input class="yt-input college-project-phone" type="text"/></td><td style="text-align: center;"><img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td></tr>';$(this).prev().find('tbody').append(htmlTr);$('.college-project-post').niceSelect()});$('.manual-main-div').on('click','.entrust-delete',function(){$(this).addClass('cho-btn');$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"./resources/images/icons/x.png",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:function(){$('.manual-main-div .entrust-delete').removeClass('cho-btn')},alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$('.manual-main-div .entrust-delete.cho-btn').parents("tr").remove()}})})},getPageDataList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/studentHandbook/getStudentHandbook",data:{projectCode:projectCode},async:true,success:function(data){var htmlPrev=$('.entrust-company tbody');var htmlTr='';var htmlProTeam=$('.college-project tbody');var htmlTb='';htmlPrev.empty();htmlProTeam.empty();if(data.flag==0){if(data.data!=null){var studentManual=data.data;console.log("获取手册数据成功",studentManual.pkId);$('.template-pkid').val(studentManual.pkId);$('.weixin-group-name').val(studentManual.weixnGroupName);$('.weixin-details').val(studentManual.weixnGroupDetails);$('.qr-code-id').val(studentManual.weixinQrCodeId);$('.qr-code-name').val(studentManual.weixinQrCodeName);$('.student-manual-div .upload-or-code-img').attr('src',$yt_option.acl_path+'api/tAscPortraitInfo/download?pkId='+studentManual.weixinQrCodeId+'&isDownload=false');var studentHandbookEntrust=$.parseJSON(studentManual.studentHandbookEntrust);var datastudentHandbookGroup=$.parseJSON(studentManual.studentHandbookGroup);var ueName=$.parseJSON(studentManual.templateData).details;console.log("studentManual.templateData",ueName);var ue=UE.getEditor('container');ue.ready(function(){ue.setContent(ueName)});$.each(studentHandbookEntrust,function(i,v){htmlTr='<tr><td><input class="yt-input entrust-name" style="width: 101px;" value="'+v.userName+'" type="text"/></td><td><input class="yt-input entrust-dept" value="'+v.deptName+'" type="text"/></td><td><input class="yt-input entrust-room-num" value="'+v.roomNumber+'" type="text"/></td><td><input class="yt-input entrust-phone" value="'+v.phone+'" type="text"/></td><td style="text-align: center;"><img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td></tr>';htmlPrev.append(htmlTr)});$.each(datastudentHandbookGroup,function(i,k){htmlTb='<tr><td><input class="yt-input college-project-name" style="width: 101px;" value="'+k.userName+'" type="text"/></td><td><input class="yt-input college-project-dept" value="'+k.deptName+'"  type="text"/></td><td><select class="yt-select college-project-post"><option value="1">带班院领导</option><option value="2">项目组组长</option><option value="3">夜间值班室</option></select></td><td><input class="yt-input college-project-phone" value="'+k.phone+'"  type="text"/></td><td style="text-align: center;"><img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td></tr>';htmlProTeam.append(htmlTb);$('.college-project-post').setSelectVal(k.positionId);$('.college-project-post').niceSelect()});$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading()}}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询学员手册失败")})}}})},manualOperation:function(weixinQrCode,weixinQrName){var projectCode=$yt_common.GetQueryString("projectCode");var templateId=studentManual.getTemplateList();;var pkId=$('.template-pkid').val();var details=studentManual.ue.getContentTxt();var templateData={templateId:templateId,details:details};templateData=JSON.stringify(templateData);var weixnGroupName=$('.weixin-group-name').val();var weixnGroupDetails=$('.weixin-details').val();var weixinQrCode={weixinQrCode:weixinQrCode,weixinQrName:weixinQrName};weixinQrCode=JSON.stringify(weixinQrCode);var studentHandbookEntrust=[];$('.entrust-company tbody tr').each(function(i,q){var userName=$(q).find('.entrust-name').val();var deptName=$(q).find('.entrust-dept').val();var roomNumber=$(q).find('.entrust-room-num').val();var phone=$(q).find('.entrust-phone').val();var entrustList={userName:userName,deptName:deptName,roomNumber:roomNumber,phone:phone};studentHandbookEntrust.push(entrustList)});studentHandbookEntrust=JSON.stringify(studentHandbookEntrust);var studentHandbookGroup=[];$('.college-project tbody tr').each(function(i,p){var userName=$(p).find('.college-project-name').val();var deptName=$(p).find('.college-project-dept').val();var positionId=$(p).find('.college-project-post').val();var phone=$(p).find('.college-project-phone').val();var collegeList={userName:userName,deptName:deptName,positionId:positionId,phone:phone};studentHandbookGroup.push(collegeList);studentHandbookGroup=JSON.stringify(studentHandbookGroup)});$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/studentHandbook/addOrUpdateStudentHandbook",data:{projectCode:projectCode,pkId:pkId,templateData:templateData,weixnGroupName:weixnGroupName,weixnGroupDetails:weixnGroupDetails,weixinQrCode:weixinQrCode,studentHandbookEntrust:studentHandbookEntrust,studentHandbookGroup:studentHandbookGroup},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交成功")});studentManual.getPageDataList()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交失败")})}}})},getTemplateList:function(){var templateId='';$.ajax({type:"post",url:$yt_option.base_path+"class/traineeTemplate/lookForAll",data:{templateId:1,types:3},async:false,success:function(data){if(data.flag==0){console.log("模板查询成功");$.each(data.data,function(i,q){console.log("模板id",q.pkId);if(q.modelCode=='TEACHINGDETAILS'){templateId=q.pkId}})}}});return templateId}};var classBulletin={ue:null,init:function(){classBulletin.ue=UE.getEditor('manual',{toolbars:[['undo','redo','|','bold','italic','underline','forecolor','|','justifyleft','justifycenter','justifyright','justifyjustify','|','simpleupload','attachment']],autoHeightEnabled:true,elementPathEnabled:false,enableAutoSave:false,saveInterval:0});$('.class-bulletin-div .list-tbody').on('click','.bulletin-delete',function(){var pkId=$(this).parent().parent().find('.bulletin-id').val();$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"./resources/images/icons/x.png",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/notice/deleteClassNotice",data:{pkId:pkId},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除成功");classBulletin.getClassBulletin()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除失败");classBulletin.getClassBulletin()})}}})}})});var pkId;var projectCode=$yt_common.GetQueryString("projectCode");$('.class-bulletin-div .list-tbody').on('click','.bulletin-update',function(){$('.class-bulletin-form .yt-edit-alert-title-msg').text("修改公告");pkId=$(this).parent().parent().find('.bulletin-id').val();var noticeDescribe=$(this).parent().parent().data('bulletin').noticeDescribe;classBulletin.ue.ready(function(){classBulletin.ue.setContent(noticeDescribe)});var noticeTitle=$(this).parent().parent().data('bulletin').noticeTitle;$('.class-bulletin-input').val(noticeTitle);console.log(noticeDescribe);$(".class-bulletin-form").show();$yt_alert_Model.getDivPosition($(".class-bulletin-form"));$yt_model_drag.modelDragEvent($(".class-bulletin-form .yt-edit-alert-title"));});$('.class-bulletin-add-btn').click(function(){pkId="";$(".class-bulletin-input").val("");classBulletin.ue.execCommand('cleardoc');$(".class-bulletin-form").show();$yt_alert_Model.getDivPosition($(".class-bulletin-form"));$yt_model_drag.modelDragEvent($(".class-bulletin-form .yt-edit-alert-title"))});$('.class-bulletin-form .yt-model-sure-btn').off().on('click',function(){var noticeDescribe=classBulletin.ue.getContent();var noticeTitle=$(".class-bulletin-input").val();console.log(noticeDescribe);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/notice/addOrUpdateNotice",data:{pkId:pkId,projectCode:projectCode,noticeTitle:noticeTitle,noticeDescribe:noticeDescribe,dateStates:1},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("发布成功");$(".class-bulletin-form").hide();classBulletin.getClassBulletin()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("发布失败");$(".class-bulletin-form").hide();classBulletin.getClassBulletin()})}}});console.log(noticeDescribe)});$('.class-bulletin-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){var noticeDescribe=classBulletin.ue.getContent();var noticeTitle=$(".class-bulletin-input").val();console.log(noticeTitle);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/notice/addOrUpdateNotice",data:{pkId:pkId,projectCode:projectCode,noticeTitle:noticeTitle,noticeDescribe:noticeDescribe,dateStates:0},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("暂存成功");$(".class-bulletin-form").hide();classBulletin.getClassBulletin()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("暂存成功");$(".class-bulletin-form").hide();classBulletin.getClassBulletin()})}}})})},getClassBulletin:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$('.class-bulletin-div .page-info').pageInfo({async:true,pageIndexs:1,pageNum:15,url:$yt_option.base_path+"class/notice/getClassNoticeList",type:"post",before:function(){$yt_baseElement.showLoading()},data:{projectCode:projectCode},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.class-bulletin-div .list-tbody');var htmlTr='';var num=1;$(htmlTbody).empty();if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){$('.class-bulletin-div .page-info').show();htmlTr='<tr><input class="bulletin-id" type="hidden" value="'+v.pkId+'"/><td  style="text-align: center;">'+num++ +'</td><td class="pro-desc">'+v.noticeTitle+'</td><td  style="text-align: center;">'+v.createTimeString.split(" ")[0]+'</td><td  style="text-align: center;">'+v.createUserName+'</td><td  style="text-align: center;"><img class="bulletin-update" src="../../resources/images/icons/amend.png"/><div style="width: 1px;height: 15px;margin:0px 10px;display:inline-block;background: #e6e6e6;"></div><img class="bulletin-delete" src="../../resources/images/icons/t-del.png"/></td></tr>';htmlTr=$(htmlTr).data('bulletin',v);htmlTbody.append(htmlTr)})}else{$('.class-bulletin-div .page-info').hide();htmlTr='<tr class="class-tr"><td colspan="5" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })}};var classQrCode={init:function(){classQrCode.getClassOrCode();$('.qr-img-download').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var baseName='check_in_qr';var fileRealName=$('.project-name').eq(0).text()+'学员报到二维码.jpg';window.location.href=$yt_option.base_path+"class/getQrcode?projectCode="+projectCode+"&&isDownload="+true+"&&fileRealName="+fileRealName+"&&baseName="+baseName});$('.qr-img-print').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var baseName='check_in_qr';var url=$yt_option.base_path+"class/getQrcode?projectCode="+projectCode+"&baseName="+baseName;var html='<img style="margin:14px;width:160px;height:155px;" src="'+url+'"/>';classQrCode.printImg(html)})},getClassOrCode:function(){var projectCode=$yt_common.GetQueryString("projectCode");var baseName='check_in_qr';var url=$yt_option.base_path+"class/getQrcode?projectCode="+projectCode+"&baseName="+baseName;var htmlBody=$('.class-qr-code-div .teacher-list-div .report-qr-code');htmlBody.before('<img style="margin:10px 0px 3px 10px;width:160px;height:154px;" src="'+url+'"/>')},printImg:function(html){$("#project-main").hide();$("#project-main").after($('<div class="body-print-box">'+html+'</div>'));window.print();$("#project-main").show();$(".body-print-box").remove();return false}};var studentReport={init:function(){var traineeId;$('.student-nation').niceSelect();$('.student-invoice-type').niceSelect();$('.card-type').niceSelect();$('.group-id-elementary').niceSelect();$('.org-id').niceSelect();$(".date-birth").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".party-date").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".work-time").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});var groupList=studentReport.getGroupList();var nationList=studentReport.getNationList();if(nationList!=null){$.each(nationList,function(q,e){$('.student-nation').append(' <option value="'+e.nationId+'">'+e.nationName+'</option>')});$('.student-nation').niceSelect()}if(groupList!=null){$.each(groupList,function(q,e){$('.group-id-elementary').append(' <option value="'+e.groupId+'">'+e.groupName+'</option>')});$('.group-id-elementary').niceSelect()}$('.export-class-student-btn').on('click',function(){debugger;var projectCode=$yt_common.GetQueryString("projectCode");var exportName=$('.project-name:eq(0)').text()+"学员列表.xls";var gender="";var phone="";var groupId="";var orgId="";var deptPosition="";var isFirstTraining="";var classCommitteeId="";var signUpState="";$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/exportTraineeByClass",data:{projectCode:projectCode,exportName:exportName,gender:gender,phone:phone,groupId:groupId,orgId:orgId,deptPosition:deptPosition,isFirstTraining:isFirstTraining,classCommitteeId:classCommitteeId,signUpState:signUpState}})});$('.upload-class-student-btn').on('click',function(){$('.class-student-upload-img').empty();$('.img-url-name-length').text(0);$(".class-student-upload-form").show();$yt_alert_Model.getDivPosition($(".class-student-upload-form"));$yt_model_drag.modelDragEvent($(".class-student-upload-form .yt-edit-alert-title"));$(".class-student-upload-form .yt-model-sure-btn").off().on('click',function(){var headPortraits=[];$('.class-student-upload-img .exceed').each(function(i,e){var headPortrait=$(e).find('input').val();var headPortraitName=$(e).find('span').text();var exceedName={headPortrait:headPortrait,headPortraitName:headPortraitName};headPortraits.push(exceedName)});headPortraits=JSON.stringify(headPortraits);console.log("headPortraits",headPortraits);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCheck/updateTraineeHeadPortrait",data:{headPortraits:headPortraits},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("上传成功")})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("上传失败")})}}})});$('.class-student-upload-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-upload-form").hide()})});$(".class-student-upload-form").undelegate().delegate("input[type='file']","change",function(){console.log($(this)[0].files);var imgName=$(this)[0].files;var exceedName='';var repeatName='';for(var i=0;i<imgName.length;i+=1){if(imgName[i].size>3145728){if(exceedName==""){exceedName+=imgName[i].name}else{exceedName+=","+imgName[i].name}}}console.log(imgName.length);console.log(exceedName);var url=$yt_option.acl_path+"api/tAscPortraitInfo/addMultipartFiles?modelCode=headPortraits";if(exceedName==""){$yt_baseElement.showLoading();$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:"fileNames",success:function(data,textStatus){var resultData=$.parseJSON(data);console.log("resultData",resultData.length);$("#fileNames").val("");if(resultData.success==0){$.each(resultData.obj,function(q,e){$('.exceed[fileName="'+e.naming+'"]').remove();$('.class-student-upload-img').append('<span class="exceed" fileName="'+e.naming+'"><input  type="hidden" value="'+e.pkId+'"/><span class="exceed-name">'+e.naming+'</span>，</span>');});$yt_baseElement.hideLoading();$('.img-url-name-length').text($('.class-student-upload-img .exceed').length)}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传失败")})}},error:function(data,status,e){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传失败")})}})}else{$("#pop-modle-alert").css("z-index",103);$yt_alert_Model.alertOne({haveCloseIcon:false,leftBtnName:"关闭",cancelFunction:"",alertMsg:'<div class="word-break: break-all;">'+exceedName+'</div>大小超过3M',cancelFunction:function(){$("#pop-modle-alert").css("z-index",100).show()}})}});$('.mail-list-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var sort='';var orderType='';$yt_baseElement.showLoading();$('.class-student-mail-form .page-info').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/traineeCheck/getClassTrainee",type:"post",data:{projectCode:projectCode,sort:sort,orderType:orderType},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.class-student-mail-form .student-msg tbody');var htmlTr='';var num=1;$(htmlTbody).empty();if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){debugger;if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}htmlTr='<tr><td >'+v.realName+'</td><td style="text-align: center;">'+v.gender+'</td><td>'+v.phone+'</td><td>'+v.groupName+'</td><td>'+v.deptPosition+'</td><td>'+v.headPortraitName+'</td></tr>';htmlTbody.append(htmlTr)})}else{htmlTr='<tr class="class-tr"><td colspan="6" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true });$(".class-student-mail-form").show();$yt_alert_Model.getDivPosition($(".class-student-mail-form"));$yt_model_drag.modelDragEvent($(".class-student-mail-form .yt-edit-alert-title"));$('.class-student-mail-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-mail-form").hide()})});var clickNum=1;$('.class-student-mail-form .yt-model-sure-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");if(clickNum==1){$('.pring-list').hide();$('.print-opera').show();$('.print-opera span').eq(0).hide();$('.print-opera .print-file-name').hide();$('.again-print-btn').hide()}else{$('.again-print-btn').show();$('.print-opera span').eq(0).show();$('.pring-list').show();$('.print-opera').hide()}$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCheck/getTraineeCheck",data:{projectCode:projectCode,fileType:2},async:true,success:function(data){var htmlBody=$('.class-student-print-form .pring-list tbody');var htmlr='';htmlBody.empty();if(data.flag==0){$.each(data.data,function(i,p){htmlr='<tr><td>'+p.createTimeString+'</td><td>'+p.createUser+'</td><td>'+p.fileName+'</td><td>'+p.printerCount+'</td><td>'+p.states+'</td></tr>';htmlBody.append(htmlr)})}else{}}});$('.class-student-print-form .again-print-btn').on('click',function(){$('.print-opera').show()});$('.print-opera .generate-excel-btn').on('click',function(){$('.print-opera .print-file-name').show();var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCheck/getPrintingExcel",data:{projectCode:projectCode},async:true,success:function(data){if(data.flag==0){$('.print-opera .file-id').val(data.data.fileId);$('.print-opera .print-file-name a').text(data.data.fileName);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("生成excel失败")})}}})});$('.class-student-print-form .yt-eidt-model-bottom .yt-model-sure-btn').on('click',function(){clickNum=2;var projectCode=$yt_common.GetQueryString("projectCode");var fileId=$('.print-opera .file-id').val();var fileName=$('.print-opera .print-file-name a').text();var printerCount=$('.print-opera .print-count-num').val();var fileType=2;var states=3;var pringingData={projectCode:projectCode,fileId:fileId,fileName:fileName,printerCount:printerCount,fileType:fileType,states:states};pringingData=JSON.stringify(pringingData);console.log(pringingData);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCheck/addPrinting",data:{pringingData:pringingData},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("打印成功");$(".class-student-print-form").hide()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("打印失败")})}}})});$(".class-student-mail-form").hide();$(".class-student-print-form").show();$yt_alert_Model.getDivPosition($(".class-student-print-form"));$yt_model_drag.modelDragEvent($(".class-student-print-form .yt-edit-alert-title"));$('.class-student-print-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-print-form").hide();$(".class-student-mail-form").show()})});$('.report-class-student-btn').off().on('click',function(){var studentList=$('.student-report-div .yt-table-active').data('studentList');if(studentList!=null){var checkInState=1;studentReport.reportInterface(checkInState)}else{$yt_alert_Model.prompt("请选择一条进行操作")}});$('.no-report-class-student-btn').off().on('click',function(){var studentList=$('.student-report-div .yt-table-active').data('studentList');if(studentList!=null){var checkInState=0;studentReport.reportInterface(checkInState)}else{$yt_alert_Model.prompt("请选择一条进行操作")}});$('.class-student-form .group-id-elementary').change(function(){groupId=$(this).val();var companyList=studentReport.getCompanyList(groupId);if(companyList!=""){$('.org-id').empty();$('.org-id').append(' <option value="">请选择</option>');$.each(companyList,function(i,o){$('.org-id').append(' <option value="'+o.orgId+'">'+o.orgName+'</option>')});$('.org-id').niceSelect()}else{$('.org-id').empty();$('.org-id').append(' <option value="">请选择</option>')}});$('.add-class-student-btn').on('click',function(){traineeId="";$('.class-student-form .yt-edit-alert-title-msg').text("新增学员");$('.class-student-form .class-student-name').val("");$('.class-student-form .class-student-group-num').val("");;$('.class-student-form .class-student-name').parent().parent().nextAll().find('input[type="radio"]:checked').val();$('.class-student-form .student-nation').setSelectVal("");$('.class-student-form .class-student-phone').val("");$('.class-student-form .card-type').setSelectVal("");$('.class-student-form .id-number').val("");$('.class-student-form .group-id-elementary').setSelectVal("");$('.class-student-form .org-id').setSelectVal("");$('.class-student-form .student-msg .dept-name').val("");var positionName="";$('.class-student-form .student-invoice-type').setSelectVal("");$('.class-student-form .student-invoice-name').val("");$('.class-student-form .student-invoice-duty').val("");$('.class-student-form .student-invoice-address').val("");$('.class-student-form .student-invoice-phone').val("");$('.class-student-form .student-invoice-open-bank').val("");$('.class-student-form .student-invoice-acc').val("");$('.class-student-form .date-birth').val();$('.class-student-form .org-type').setSelectVal("");$('.class-student-form .mailing-address').val("");$('.class-student-form .postal-code').val("");$('.class-student-form .class-student-fax').val("");$('.class-student-form .party-date').val();$('.class-student-form .education-time').val("");$('.class-student-form .education-time-class').val("");$('.class-student-form .service-time').val("");$('.class-student-form .service-time-class').val("");$('.class-student-form .telephone-project').val("");$('.class-student-form .class-student-email').val("");$('.class-student-form .work-time').val("");$(".class-student-form").show();$yt_alert_Model.setFiexBoxHeight($(".class-student-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".class-student-form"));$yt_model_drag.modelDragEvent($(".class-student-form .yt-edit-alert-title"));$('.class-student-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-form").hide();$("#pop-modle-alert").hide()})});$('.update-class-student-btn').on('click',function(){var studentList=$('.student-report-div .yt-table-active').data('studentList');var studentDetailedmsg=studentReport.getStudentDetailedMsg();console.log('studentList',studentList);console.log('studentDetailedmsg',studentDetailedmsg);if(studentList!=null){$('.class-student-form .yt-edit-alert-title-msg').text("修改学员");$('.student-list-for').setDatas(studentDetailedmsg);$('.class-student-form .student-nation').setSelectVal(studentDetailedmsg.nationId);$('.class-student-form .card-type').setSelectVal(studentDetailedmsg.idType);$('.class-student-form .group-id-elementary').setSelectVal(studentDetailedmsg.groupId);groupId=studentDetailedmsg.groupId;var companyList=studentReport.getCompanyList(groupId);if(companyList!=""){$('.org-id').empty();$('.org-id').append(' <option value="">请选择</option>');$.each(companyList,function(i,o){$('.org-id').append(' <option value="'+o.orgId+'">'+o.orgName+'</option>')});$('.org-id').niceSelect()}else{$('.org-id').empty();$('.org-id').append(' <option value="">请选择</option>')}$('.class-student-form .org-id').setSelectVal(studentDetailedmsg.groupOrgId);$('.class-student-form .student-invoice-type').setSelectVal(studentDetailedmsg.invoiceType);$('.class-student-form .org-type').setSelectVal(studentDetailedmsg.orgType);$(".class-student-form").show();$yt_alert_Model.setFiexBoxHeight($(".class-student-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".class-student-form"));$yt_model_drag.modelDragEvent($(".class-student-form .yt-edit-alert-title"));$('.class-student-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-form").hide();$("#pop-modle-alert").hide()})}else{$yt_alert_Model.prompt("请选择一行进行修改")}});$(".class-student-form .yt-model-sure-btn").on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var realName=$('.class-student-form .class-student-name').val();var groupNum=$('.class-student-form .class-student-group-num').val();;var gender=$('.class-student-form .class-student-name').parent().parent().nextAll().find('input[type="radio"]:checked').val();var nationId=$('.class-student-form .student-nation').val();var phone=$('.class-student-form .class-student-phone').val();var idType=$('.class-student-form .card-type').val();var idNumber=$('.class-student-form .id-number').val();var groupId=$('.class-student-form .group-id-elementary').val();var orgId=$('.class-student-form .org-id').val();var deptName=$('.class-student-form .student-msg .dept-name').val();var positionName="";var invoiceType=$('.class-student-form .student-invoice-type').val();var orgName=$('.class-student-form .student-invoice-name').val();var taxNumber=$('.class-student-form .student-invoice-duty').val();var address=$('.class-student-form .student-invoice-address').val();var telephoneProject=$('.class-student-form .student-invoice-phone').val();var registeredBank=$('.class-student-form .student-invoice-open-bank').val();var account=$('.class-student-form .student-invoice-acc').val();var dateBirth=$('.class-student-form .date-birth').val();var orgType=$('.class-student-form .org-type').val();var mailingAddress=$('.class-student-form .mailing-address').val();var postalCode=$('.class-student-form .postal-code').val();var fax=$('.class-student-form .class-student-fax').val();var partyDate=$('.class-student-form .party-date').val();var educationTime=$('.class-student-form .education-time').val();var educationTimeClass=$('.class-student-form .education-time-class').val();var serviceTime=$('.class-student-form .service-time').val();var serviceTimeClass=$('.class-student-form .service-time-class').val();var telephone=$('.class-student-form .telephone-project').val();var email=$('.class-student-form .class-student-email').val();var workTime=$('.class-student-form .work-time').val();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/addOrUpdateTrainee",data:{traineeId:traineeId,projectCode:projectCode,realName:realName,groupNum:groupNum,gender:gender,nationId:nationId,phone:phone,idNumber:idNumber,groupId:groupId,orgId:orgId,deptName:deptName,positionName:positionName,invoiceType:invoiceType,orgName:orgName,taxNumber:taxNumber,address:address,telephoneProject:telephoneProject,registeredBank:registeredBank,account:account,idType:idType,dateBirth:dateBirth,orgType:orgType,mailingAddress:mailingAddress,postalCode:postalCode,fax:fax,partyDate:partyDate,educationTime:educationTime,educationTimeClass:educationTimeClass,serviceTime:serviceTime,serviceTimeClass:serviceTimeClass,telephone:telephone,email:email,workTime:workTime},async:true,success:function(data){if(data.flag==0){console.log("traineeId",traineeId);$yt_baseElement.hideLoading(function(){if(traineeId==""){$yt_alert_Model.prompt("添加成功")}else{$yt_alert_Model.prompt("修改成功")}studentReport.getStudentReport();$(".class-student-form").hide()})}else{$yt_baseElement.hideLoading(function(){if(traineeId==""){$yt_alert_Model.prompt("添加失败")}else{$yt_alert_Model.prompt("修改失败")}studentReport.getStudentReport();$(".class-student-form").hide()})}}})})},getStudentDetailedMsg:function(){debugger;var studentList=$('.student-report-div .yt-table-active').data('studentList');var traineeId=studentList.pkId;var studentDetailedMsg;var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeDetails",data:{traineeId:traineeId,projectId:projectCode},async:false,success:function(data){if(data.flag==0){studentDetailedMsg=data.data}}});return studentDetailedMsg},reportInterface:function(checkInState){var projectCode=$yt_common.GetQueryString("projectCode");var studentList=$('.student-report-div .yt-table-active').data('studentList');var traineeId=studentList.traineeId;$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCheck/updateCheckState",data:{projectCode:projectCode,traineeId:traineeId,checkInState:checkInState},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("设置成功");studentReport.getStudentReport()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("设置失败");studentReport.getStudentReport()})}}})},getNationList:function(){var nationList=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/getNations",data:{searchParameters:""},async:false,success:function(data){if(data.flag==0){console.log("成功");$.each(data.data,function(a,b){nationList.push(b)})}}});return nationList},getGroupList:function(){var groupList=[];$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getGroups",data:{groupName:""},async:false,success:function(data){if(data.flag==0){console.log("成功");$.each(data.data,function(a,b){groupList.push(b)})}}});return groupList},getCompanyList:function(groupId){var companyList=[];$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getOrgs",data:{orgName:"",groupId:groupId},async:false,success:function(data){if(data.flag==0){console.log("成功");$.each(data.data,function(a,b){companyList.push(b)})}}});return companyList},getStudentReport:function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.student-report-div .keyword').val();var gender="";var phone="";var groupId="";var orgId="";var deptPosition="";var isFirstTraining="";var classCommitteeId="";var signUpState="";var checkInState="";var sort="";var orderType="";$('.student-report-div .page-info').eq(0).pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/trainee/getClassTrainee",type:"post",data:{projectCode:projectCode,selectParam:selectParam,gender:gender,phone:phone,groupId:groupId,orgId:orgId,deptPosition:deptPosition,isFirstTraining:isFirstTraining,classCommitteeId:classCommitteeId,signUpState:signUpState,checkInState:checkInState,sort:sort,orderType:orderType},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.student-report-div .list-tbody');var htmlTr='';var num=1;$(htmlTbody).empty();if(data.data.rows.length>0){$('.student-report-div .page-info').show();$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}if(v.isFirstTraining==0){v.isFirstTraining="不是"}else{v.isFirstTraining="是"}if(v.checkInState==0){v.checkInState="未报到"}else{v.checkInState="已报到"}htmlTr='<tr><td style="text-align: center;"><input type="hidden" value="'+v.pkId+'" class="pkId">'+v.groupNum+'</td><td><a href="#" class="real-name-inf" style=" color:blue;word-break: break-all;">'+v.realName+'</a></td><td style="text-align: center;">'+v.gender+'</td><td style="text-align: center;">'+v.phone+'</td><td>'+v.groupName+'</td><td>'+v.groupOrgName+'</td><td>'+v.deptName+'</td><td>'+v.classCommitteeName+'</td><td style="text-align: center;">'+v.isFirstTraining+'</td><td style="text-align: center;">'+v.checkInState+'</td></tr>';htmlTr=$(htmlTr).data('studentList',v);htmlTbody.append(htmlTr)})}else{$('.student-report-div .page-info').hide();htmlTr='<tr class="class-tr"><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getDifferentList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getHotelTraineeToClassTrainee",data:{projectCod:projectCode},async:true,success:function(data){var htmlBody=$('.different-student-list tbody ');var htmlTr='';var num=1;if(data.flag==0){if(data.data.length>0){htmlBody.parent().parent().show();$.each(data.data,function(k,b){htmlTr='<tr><td>'+num++ +'</td><td>'+b.traineeName+'</td><td>'+b.gender+'</td><td>'+b.idNumber+'</td><td>'+b.roomNumber+'</td><td>'+b.createTimeString+'</td><td>'+b.reason+'</td></tr>';htmlBody.append(htmlTr)})}else{htmlBody.parent().parent().hide()}}else{$yt_alert_Model.prompt("查询失败")}}})}};var ytDate={formatDate:function(date){var myyear=date.getFullYear();var mymonth=date.getMonth()+1;var myweekday=date.getDate();if(mymonth<10){mymonth="0"+mymonth}if(myweekday<10){myweekday="0"+myweekday}return(myyear+"-"+mymonth+"-"+myweekday)},startStop:function(obj){var me=this;var startStop=[];var currentDate=new Date(obj);var weekday=currentDate.getDay()||7;currentDate.setDate(currentDate.getDate()-weekday-1);for(var i=0;i<7;i+=1){currentDate.setDate(currentDate.getDate()+1);startStop.push(me.formatDate(currentDate))}return startStop}};var positionMap={ac:null,myValue:null,addMarkerState:true,mapObj:null,init:function(configData){$("#l-map").empty();this.mapObj=new BMap.Map("l-map");this.mapObj.centerAndZoom("大连市甘井子区中国大连高级经理学院",14);this.mapObj.enableScrollWheelZoom();this.mapObj.enableContinuousZoom();this.ac=new BMap.Autocomplete({"input":"suggestId","location":this.mapObj});this.eventFun()},eventFun:function(){var me=this;me.ac.addEventListener("onhighlight",function(e){var str="";var _value=e.fromitem.value;var value="";if(e.fromitem.index>-1){value=_value.province+_value.city+_value.district+_value.street+_value.business}str="FromItem<br />index = "+e.fromitem.index+"<br />value = "+value;value="";if(e.toitem.index>-1){_value=e.toitem.value;value=_value.province+_value.city+_value.district+_value.street+_value.business}str+="<br />ToItem<br />index = "+e.toitem.index+"<br />value = "+value;me.G("searchResultPanel").innerHTML=str});me.ac.addEventListener("onconfirm",function(e){var _value=e.item.value;myValue=_value.province+_value.city+_value.district+_value.street+_value.business;me.G("searchResultPanel").innerHTML="onconfirm<br />index = "+e.item.index+"<br />myValue = "+myValue;me.setPlace()});},G:function(id){return document.getElementById(id)},setPlace:function(){var me=this;me.mapObj.clearOverlays();function myFun(){var pp=local.getResults().getPoi(0).point;me.mapObj.centerAndZoom(pp,18);var myIcon=new BMap.Icon($yt_option.websit_path+"resources/images/img/blank.png",new BMap.Size(23,25),{offset:new BMap.Size(10,25),});me.marker=new BMap.Marker(pp,{icon:myIcon});me.mapObj.addOverlay(me.marker);me.marker.enableDragging()}var local=new BMap.LocalSearch(me.mapObj,{onSearchComplete:myFun});local.search(myValue)},getPosition:function(){return this.marker==undefined?null:this.marker.getPosition()}};$(function(){caInfoList.init();courseManager.init();studentList.init();repeatCourtyardList.init();classBulletin.init();classQrCode.init();studentReport.init();positionMap.init()});