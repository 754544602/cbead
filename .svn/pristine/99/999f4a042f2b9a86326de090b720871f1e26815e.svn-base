var summPreviewObj={tableId:"",budgetStage:"",configData:[],init:function(){var requerParameter=$yt_common.GetRequest();if(requerParameter!=null&&requerParameter!=""){summPreviewObj.tableId=requerParameter.tableId;summPreviewObj.budgetStage=requerParameter.budgetStage;summPreviewObj.getBudgetTableDetail()}summPreviewObj.events()},events:function(){$("button.close-btn").click(function(){window.close()})},getBudgetTableDetail:function(){$.ajax({type:'post',url:'budget/main/getTotalBudgetTableDetailInfo',async:false,data:{tableId:summPreviewObj.tableId,budgetStage:summPreviewObj.budgetStage},success:function(data){var dataObj=data.data||{};var tableStyle=dataObj.tableStyle;var budgetData=dataObj.budgetData;$(".table-name").text(tableStyle.tableName);$(".stage").text(tableStyle.budgetStageName);$(".label-msg").text(tableStyle.tagging);$('#createConfigTableDiv').html('').newRuleTable({theads:tableStyle.theads,tbodys:tableStyle.tbodys,propertyList:tableStyle.propertyList,eventCheck:false,serialNumber:false});var propertyList=tableStyle.propertyList;for(var i=0,len=propertyList.length;i<len;i+=1){var proper=propertyList[i];var index=proper.crNum.replace(proper.type,'');if(proper.type=='c'){$('.rule-table .yt-tbody tr').each(function(){$(this).find('td').eq(index-1).addClass('disable-sty')})}else if(proper.type=='r'){$('.rule-table .yt-tbody tr').eq(index-1).find('td,th').addClass('disable-sty')}}$('.rule-table').data('tableData',tableStyle);$('.rule-table tbody tr').each(function(i){$(this).attr('fieldflag','r'+(i+1)).addClass('r'+(i+1)).find('td').each(function(j){$(this).attr('fieldflag','c'+(j+1)).addClass('c'+(j+1))})});$('.rule-table tbody tr td:not(.disable-sty)').each(function(){var html=$(this).html();html='<span class="money-text">'+html+'</span>';$(this).html(html)});var rNum="";var cNum="";for(var r=1;r<=tableStyle.theadRowsNum;r+=1){rNum="r"+r;for(var c=1;c<=tableStyle.totalColsNum;c+=1){cNum="c"+c;var state=tableStyle.tbodys[rNum][cNum].submitState;if(state=="2"||state==2){var tdData=$(".rule-table").find("tr."+rNum+" td."+cNum);$(tdData).addClass("subBak")}}}var disLen=$('.rule-table thead th.dis').length;var width=parseInt($(window).width())/(tableStyle.totalColsNum);width=width>130?130:parseInt(width);$('.rule-table thead th:not(.dis)').css("min-width",(width-15)+"px");summPreviewObj.getConfigInfo();summPreviewObj.getTableInfoList(budgetData)}})},getConfigInfo:function(){summPreviewObj.configData=[];$.ajax({type:"post",url:'budget/confg/getTableAllCongfigByTableId',async:false,data:{tableId:summPreviewObj.tableId},success:function(data){var crNums="";if(data.flag==0){if(data.data.length>0){summPreviewObj.configData=data.data;$.each(data.data,function(i,n){if(n.type=="cr"){crNums=n.crNum.split("-");$(".rule-table tbody tr").each(function(i,r){if(crNums[1]==$(this).attr("fieldFlag")){if(n.calcItem&&n.calcItem=="2"){$(r).find("input.money-input").addClass("character-inpu")}$.each($(r).find("td"),function(i,c){if(crNums[0]==$(c).attr("fieldFlag")){if(n.calcItem=="1"||n.calcItem=="4"){$(c).addClass("disable-sty")}$(c).data("configData",n)}})}})}else{$(".rule-table tbody tr").each(function(i,r){if(n.crNum==$(this).attr("fieldFlag")){if(n.calcItem=="1"||n.calcItem=="4"){$(this).addClass("disable-sty").find('td').addClass("disable-sty")}if(n.calcItem=="2"){$(this).find("input.money-input").addClass("character-inpu")}$(this).data("configData",n)}});$(".rule-table tbody tr td").each(function(v,c){if(n.crNum==$(this).attr("fieldFlag")){if(n.calcItem=="1"||n.calcItem=="4"){$(this).addClass("disable-sty")}$(this).data("configData",n)}})}})}}else{$yt_alert_Model.prompt(data.message,2000)}}})},getTableInfoList:function(budgetData){if(budgetData!=undefined&&budgetData!=null&&budgetData.length>0){var tbody=$('.rule-table .yt-tbody');$.each(budgetData,function(i,n){$(".rule-table .yt-tbody tr").each(function(i,v){if($(v).attr("fieldFlag")==n.rowNum){$(v).find("td").each(function(t,c){if($(c).attr("fieldFlag")==n.cellNum){$(c).attr("budgetMainId",n.budgetMainId);if(n.crValue!=""&&n.crValue!=null&&n.crValue!=undefined){if(!isNaN(n.crValue)){n.crValue=$yt_baseElement.fmMoney(n.crValue)}if(!$(c).hasClass("subBak")){$(c).find(".money-text").html(n.crValue);$(c).find(".money-input").val(n.crValue)}}$(c).data("cellData",n)}})}})})}}};$(function(){summPreviewObj.init()});