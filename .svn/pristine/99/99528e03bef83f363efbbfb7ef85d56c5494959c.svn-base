var projectList={init:function(){projectList.getPlanListInfo();$('.list-table').on("click",".class-name",function(){var pkId=$(this).parents("tr").find('.pkId').text();var expenseType=$(this).parents("tr").find('.expenseType').text();if(expenseType==1){window.location.href="reimbursementLook.html?pkId="+pkId}if(expenseType==2){window.location.href="reimburseTravelDetailsLook.html?pkId="+pkId}});$('.delete-class').click(function(){var workFlawState=$("tr.yt-table-active").find(".work-flaw-state").text();if(workFlawState!="审批中"){projectList.deleteReimbursement()}else{$yt_alert_Model.prompt("无法删除审批中的数据!")}});$('.add-class').click(function(){window.location.href="reimbursementAdd.html?projectCode="});$('.update-class').click(function(){var workFlawState=$("tr.yt-table-active").find(".work-flaw-state").text();if(workFlawState!="审批中"){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}else{var pkId=$(".yt-table-active .pkId").text();var expenseType=$(".yt-table-active .expenseType").text();var projectCode=$(".yt-table-active .projectCode").text();if(expenseType==1){window.location.href="reimbursementAdd.html?pkId="+pkId+"&projectCode="+projectCode}if(expenseType==2){window.location.href="travelAdd.html?pkId="+pkId+"&projectCode="+projectCode}}}else{$yt_alert_Model.prompt("无法修改审批中的数据!")}});$('.ticketOpen-class').on('click',function(){var pkId=$('.yt-table-active .pkId').text();if(pkId==''){$yt_alert_Model.prompt("请选择需要开票的数据")}else{projectList.cheques(pkId)}});$('.search-btn').click(function(){projectList.getPlanListInfo()})},getPlanListInfo:function(){$yt_baseElement.showLoading();var queryParams=$('#keyword').val();$('.page-info').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/teacherExpense/lookForAll",type:"post",data:{selectParam:queryParams,createTimeStart:"",createTimeEnd:"",teacherCountStart:"",teacherCountEnd:"",expenseMoneyStart:"",expenseMoneyEnd:"",expenseType:"",workFlawState:""},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.open-class-tbody');var htmlTr='';if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){var expenseType=Number(v.expenseType);if(expenseType==1){expenseType='教师课酬报销'}if(expenseType==2){expenseType='教师差旅报销'}htmlTr+='<tr class="td-list"><td class="pkId" style="display:none;"><input type="hidden" class="project-code" value="'+v.projectCode+'" />'+v.pkId+'</td><td style="text-align:center;"><a class="class-name"style="color: #3c4687;">'+v.flowNumber+'</a></td><td class="expenseType" style="display:none;">'+v.expenseType+'</td><td>'+expenseType+'</td><td class="projectCode">'+v.projectCode+'</td><td style="text-align:left !important;">'+v.projectName+'</td><td>'+v.projectHead+'</td><td>'+v.createTime+'</td><td style="text-align:right !important;">'+v.teacherCount+'</td><td>'+v.expenseMoney+'</td><td class="work-flaw-state">'+v.workFlawState+'</td></tr>'})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="8" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},deleteReimbursement:function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}var pkId=$(".yt-table-active .pkId").text();var downUrl=$yt_option.base_path+"finance/teacherExpense/removeBeanByIdTravel";$yt_baseElement.showLoading();$.ajax({type:"post",url:downUrl,async:true,data:{pkId:pkId,isDownload:true},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除成功")});projectList.refreshEffective()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除失败")})}}})},refreshEffective:function(){$('.page-info').pageInfo("refresh")},cheques:function(pkId){$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/updateOpenedCheques",async:true,data:{pkId:pkId},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("开票成功")}else{$yt_alert_Model.prompt("开票失败")}}})}};$(function(){projectList.init()});