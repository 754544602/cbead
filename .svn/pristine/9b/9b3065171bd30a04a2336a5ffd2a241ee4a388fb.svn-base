var costInfo={init:function(){costInfo.getcostInfo();$('.page-return-btn').on('click',function(){window.location.href="myApproveList.html"});$('#last-submit').click(function(){var dealingWithPeople=$('#next-people').val();var pkId=$yt_common.GetQueryString("pkId");var processInstanceId=$('.hid-process-instance-id').val();var opintion=$('#opintion').val();var nextCode=$('input[name="radioType"]:checked ').val();var tastKey=$('.hid-tast-key').val();if(nextCode=="returnedSubmit"||tastKey=="activitiEndTask"){dealingWithPeople=""}if(dealingWithPeople=="no"){$yt_alert_Model.prompt("请选择下一步操作人！",3000)}else{$.ajax({type:"post",url:$yt_option.base_path+"finance/reduction/updateApply",async:false,data:{pkId:pkId,businessCode:"reduction",processInstanceId:processInstanceId,dealingWithPeople:dealingWithPeople,opintion:opintion,nextCode:nextCode},success:function(data){if(data.flag==0){costInfo.getcostInfo()}}});window.location.href="myApproveList.html"}});$('#last-cancel').click(function(){window.location.href="myApproveList.html"});costInfo.getNextOperatePerson();$("#next-people").niceSelect();$(".check-label input[type='radio']").change(function(){var rad=$(this).val();var tastKey=$('.hid-tast-key').val();if(rad=="completed"){if(tastKey=="activitiEndTask"){$('.hid-input').hide()}else{$('.hid-input').show()}};if(rad=="returnedSubmit"){$('#next-people').setSelectVal("");$('.hid-input').hide()}})},getNextOperatePerson:function(){var getAllNextPeople=costInfo.getworkFlowOperate();if(getAllNextPeople.data.length!=0){var data=getAllNextPeople.data[0]['{"taskId":"activitiStartTask","nextCode":"submited","parameters":"","nextName":"提交【NEXT_CODE】"}'];if(data!=null){$.each(data,function(i,n){$("#next-people").append('<option value="'+n.userCode+'">'+n.userName+'</option>')})}}},getworkFlowOperate:function(){var processInstanceId=$('.hid-process-instance-id').val();var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"openHonorsStart"},async:false,success:function(data){list=data||[]}});return list},getcostInfo:function(){var pkId=$yt_common.GetQueryString("pkId");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"finance/reduction/getBeanById",async:true,data:{pkId:pkId},objName:'data',success:function(data){$('.hid-process-instance-id').val(data.data.processInstanceId);$yt_baseElement.hideLoading();if(data.flag==0){var v=data.data;$('.create-user').text(v.createUser);$('.dept-name').text(v.deptName);$('.create-time-string').text(v.createTimeString);$('.post-remission-money').text(v.postRemissionMoney);$('.remission-cause').text(v.remissionCause);$('.project-code').text(v.projectCode);$('.project-name').text(v.projectName);$('.project-type').text(v.projectType);$('.project-head').text(v.projectHead);$('.class-teacher').text(v.classTeacher);$('.start-date').text(v.startDate);$('.end-date').text(v.endDate);$('.work-flaw-state').text(v.workFlawState);var reductionDetailsJSON=$.parseJSON(v.reductionDetails);var htmlTr="";var htmlTbody=$(".project-tbody");htmlTbody.html("");if(reductionDetailsJSON.length>0){$.each(reductionDetailsJSON,function(i,n){htmlTr='<tr><td style="text-align:center" class="types-td"><input class="types-input" style="display: none;" value="'+n.types+'"/>'+costInfo.costTypeInfo(n.types)+'</td><td style="text-align:center" class="reduction-exemption-td">'+n.reductionExemption+'</td><td style="text-align:center" class="pre-relief-standard-td">'+n.preReliefStandard+'</td><td style="text-align:center" class="post-remission-standard-td">'+n.postRemissionStandard+'</td><td style="text-align:center" class="post-remission-money-td">'+n.postRemissionMoney+'</td><td style="text-align:center" class="remarks-td">'+n.remarks+'</td></tr>';htmlTbody.append(htmlTr)})}else{htmlTr='<tr class="null" style="border:0px;background-color:#fff !important;" ><td colspan="6" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}var flowLog=JSON.parse(v.flowLog);var middleStepHtml;var length=flowLog.length;$.each(flowLog,function(i,v){if(i==0){if(v.tastKey=="activitiEndTask"){$('.hid-tast-key').val(v.tastKey);$('.next-operate-person-tr').hide()}$('.last-step-order').text(length);$('.last-step-operate-person-userName').text(v.userName);$('.last-step-operationState').text(v.operationState);$('.last-step-commentTime').text(v.commentTime)};if(i==length-1){$('.first-step-order').text(1);$('.first-step-operate-person-userName').text(v.userName);$('.first-step-taskName').text(v.operationState);$('.first-step-commentTime').text(v.commentTime)};if(i!=0&&i<length-1){var order=length-i;middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+v.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+v.operationState+'</span></li><li class="view-time-li middle-step-commentTime" >'+v.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment">'+v.comment+'</div></li></ul></div></div>';$('.last-step').append(middleStepHtml);$yt_baseElement.hideLoading()}})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}var operationState=$('.operation-state').text();if(operationState==""){$('.operationState').text("操作状态")};var remissionCause=$('.remission-cause').text();if(remissionCause==""){$('.remission-cause-div').css("float","none")}}})},costTypeInfo:function(code){if(code==1){return "培训费"}else if(code==2){return "课程费"}else if(code==3){return "住宿费"}else if(code==4){return "餐费"}else if(code==5){return "杂费"}else if(code==6){return "场地使用费"}else if(code==7){return "会务费"}else if(code==8){return "其他"}else{return ''}}};$(function(){costInfo.init()});