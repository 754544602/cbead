var priorApproval={init:function(){$('#flowApproveDiv').html(sysCommon.createFlowApproveMode());priorApproval.getInitFunDatas();var requerParameter=$yt_common.GetRequest();priorApproval.reimId=requerParameter.advanceId;var fun=$yt_common.GetQueryString('fun');priorApproval.loanMoneyEvent();priorApproval.funOperationEvent();$("#priorApproval").css("min-height",$(window).height()-12);priorApproval.events();this.getAdvanceAppInfoDetailByAdvanceAppId(priorApproval.reimId);$("#printBeforeForm").click(function(){var pageUrl="view/projectManagement-sasac/expensesReim/module/print/beforeApplyDetailMain.html?expenditureAppId="+priorApproval.reimId+'&costType='+$("#advanceCostType").val();var goPageUrl="view/projectManagement-sasac/expensesReim/module/approval/beforehandApproveList.html";$yt_baseElement.openNewPage(2,pageUrl)})},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},rmoney:function(str){return $yt_baseElement.rmoney(str||'0')},events:function(){var me=this;$('.refund-tab-inp').on('focus',function(){var ts=$(this);if(ts.val()!=""){ts.val($yt_baseElement.rmoney(ts.val()))}});$('.refund-tab-inp').on('blur',function(){var ts=$(this);if(ts.val()!=''){ts.val($yt_baseElement.fmMoney(ts.val()))}});$('.refund-tab-inp').on('keyup',function(){var ts=$(this);if(ts.val()!=''){ts.val(ts.val().replace(/[^\d.]/g,''))}});$('.refund-tab-inp').blur(function(){var body=$('.amount-table');var refundCash=0;var refundCheck=0;var refundTransfer=0;if(body.find('#refundCash').val()!=''){refundCash=parseFloat($yt_baseElement.rmoney(body.find('#refundCash').val()))}if(body.find('#refundCheck').val()!=''){refundCheck=parseFloat($yt_baseElement.rmoney(body.find('#refundCheck').val()))}if(body.find('#refundTransfer').val()!=''){refundTransfer=parseFloat($yt_baseElement.rmoney(body.find('#refundTransfer').val()))}var total=refundCash+refundCheck+refundTransfer;body.find('.total').text($yt_baseElement.fmMoney(total))});$('.yt-table tbody').on('click','tr',function(){var ts=$(this);var trs=ts.siblings();trs.removeClass('yt-table-active');ts.addClass('yt-table-active')})},initData:function(){$.ajax({type:"post",url:"sz/advanceApp/saveAdvanceAppInfoToDrafts",async:false,data:{dictTypeCode:"AMOUNT_NATURE"},success:function(data){if(data.flag==0){var optionText='<option value="">请选择</option>';if(data.data.length>0){$.each(data.data,function(i,n){if(n.dictTypeCode=="AMOUNT_NATURE"){optionText='<option value="'+n.value+'">'+n.disvalue+'</option>';$("#moneyQuality").append(optionText);$("#moneyQuality").niceSelect();$("#moneyQuality").on("change",function(){priorApproval.getProjectInfoList($("#prjKeyWord").val(),$(this).val())})}});$("#moneyQuality").niceSelect()}}}})},getInitFunDatas:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:false,data:{dictTypeCode:"AMOUNT_NATURE"},success:function(data){if(data.flag==0){var optionText='<option value="">请选择</option>';if(data.data.length>0){$.each(data.data,function(i,n){if(n.dictTypeCode=="AMOUNT_NATURE"){optionText='<option value="'+n.value+'">'+n.disvalue+'</option>';$("#moneyQuality").append(optionText);$("#moneyQuality").niceSelect();$("#moneyQuality").on("change",function(){priorApproval.getProjectInfoList($("#prjKeyWord").val(),$(this).val())})}});$("#moneyQuality").niceSelect()}}}})},funOperationEvent:function(){$('#approveCanelBtn').on("click",function(){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/projectManagement-sasac/expensesReim/module/approval/beforehandApproveList.html'}})});$('.base-form-info input[name="special"]').on("click",function(){if($(this).val()=="2"){$("#projectNum").hide();$("#ppsProject").removeAttr("validform");$("#ppsProject").removeClass("valid-hint").next(".valid-font").html('');$("#hidPrjId").val('')}else{$("#projectNum").show();$("#ppsProject").attr("validform","{isNull:true,msg:\'请选择项目编号\'}")}});$("#approveSubBtn").off().on("click",function(){var thisBtn=$(this);thisBtn.attr('disabled',true).addClass('btn-disabled');var btnFlag;var validFlag=$yt_valid.validForm($("#flowApproveDiv"));if(validFlag){var d=priorApproval.getSaveData();priorApproval.submitWorkFlow(d,thisBtn)}else{sysCommon.pageToScroll($("#priorApproval .valid-font"));thisBtn.attr('disabled',false).removeClass('btn-disabled')}})},getLoanFormData:function(){return{loanAppId:"",loanAppNum:"",isSpecial:$(".isSpecial.yt-radio.check input").val(),loanAppName:$("#loanReason").val(),travelAppId:$('#hidApplyId').val(),prjId:$('#hidPrjId').val(),loanAmount:$yt_baseElement.rmoney($("#loanMoney").val()),paymentMethod:$(".radio-group .yt-radio.check input").val(),loanTerm:$("#loanTerm").val(),expectRepaymentTime:$("#returnDate").val(),applicantUser:$yt_common.user_info.userName,parameters:"",nextCode:$("#operate-flow").val(),dealingWithPeople:$("#approve-users").val(),opintion:$("#opintion").val(),processInstanceId:""}},clearPageData:function(){$("#priorApproval input:not(.radio-inpu,.hid-risk-code),#priorApproval textarea").val('');$("#loanMoney").val('');$("#radio1").setRadioState("check");$("#moneyLower").text('--');$("#approve-users,#operate-flow,#lifeOfLoan").each(function(i,n){$(this).find("option:eq(0)").attr("selected","selected")});$("#priorApproval select").each(function(i,n){$(this).find("option:eq(0)").attr("selected","selected")});$("#priorApproval select").niceSelect();$("#priorApproval .risk-img").attr("src",priorApproval.riskExcMark)},getProjectInfoList:function(keyWord,moneyQuality){var fromPrjTbody=$("#fromPrjModel .appro-list-model table tbody");$('.prj-page').pageInfo({pageIndex:1,pageNum:10,pageSize:2,url:$yt_option.websit_path+'resources-sasac/js/testJsonData/projectData.json',type:"get",async:false,data:{keyWord:keyWord,moneyQuality:moneyQuality},objName:'data',success:function(data){fromPrjTbody.empty();if(data.flag==0){var prjStr="";if(data.data.rows.length>0){$('.prj-page').show();$.each(data.data.rows,function(i,n){prjStr='<tr><td>'+n.prjNum+'<input type="hidden" class="hid-prj-id" value="'+n.prjId+'"/><input type="hidden" class="hid-dept" value="'+n.deptSource+'"/></td><td>'+n.prjName+'</td><td style="text-align: right;">'+(n.budgetPrice==""?"--":$yt_baseElement.fmMoney(n.budgetPrice))+'</td><td style="text-align: right;">'+(n.availablePrice==""?"--":$yt_baseElement.fmMoney(n.availablePrice))+'</td></tr>';fromPrjTbody.append(prjStr)})}else{$('.prj-page').hide();var noTr='<tr class="model-no-data-tr"><td colspan="4"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';fromPrjTbody.append(noTr)}}}})},getBeforeApplyFormList:function(keyWord){var beforeApplyTbody=$("#beforeApplyFormModel .appro-list-model table tbody");$('.before-page').pageInfo({pageIndex:1,pageNum:5,pageSize:2,url:"sz/travelApp/getUserTravelAppListByParams",type:"post",async:false,data:{queryParams:keyWord},objName:'data',success:function(data){beforeApplyTbody.empty();if(data.flag==0){var applyStr="";if(data.data.rows.length>0){$('.before-page').show();$.each(data.data.rows,function(i,n){applyStr='<tr><td>'+n.travelAppNum+'<input type="hidden" class="hid-apply-id" value="'+n.travelAppId+'"/></td><td>'+n.travelAppName+'</td><td style="text-align: right;">'+(n.totalAmount==""?"--":$yt_baseElement.fmMoney(n.totalAmount))+'</td></tr>';beforeApplyTbody.append(applyStr)})}else{$('.before-page').hide();var noTr='<tr class="model-no-data-tr"><td colspan="4"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';beforeApplyTbody.append(noTr)}}}});var costData=function(){return JSON.stringify({costReceptionistList:costReceptionistList(),costDetailsList:costDetailsList()})}},loanMoneyEvent:function(){$("#loanMoney").on("focus",function(){if($(this).val()!=""&&$(this).val()!=null){$(this).val($yt_baseElement.rmoney($(this).val()));$(this).select()}});$("#loanMoney").on("blur",function(){if($(this).val()!=""&&$(this).val()!=null){var fmMoney=$yt_baseElement.fmMoney($(this).val());$(this).val(fmMoney);var lowerMoney=arabiaToChinese($(this).val());$("#moneyLower").text(lowerMoney)}})},setexaminedata:function(d){$("#advanceCostType").val(d.advanceCostType);$('#advanceAppId').text(d.advanceAppId);$('#advanceAppNum').text(d.advanceAppNum);$("#formNum").text(d.advanceAppNum);$("#fuData").text(d.applicantTime);$('#busiUsers').text(d.applicantUserName);$('#deptName').text(d.applicantUserDeptName);$('#jobName').text(d.applicantUserPositionName==""?"--":d.applicantUserPositionName);$("#telPhone").text(d.applicantUserPhone==""?"--":d.applicantUserPhone);$('.advanceAppReason').text(d.advanceAppName);$('.expense-type').text(d.advanceCostTypeName);$('#specialName').text(d.specialName);$('#budgetBalanceAmount').text(d.budgetBalanceAmount?$yt_baseElement.fmMoney(d.budgetBalanceAmount)+'万元':'--');$('#deptBudgetBalanceAmount').text(d.deptBudgetBalanceAmount?$yt_baseElement.fmMoney(d.deptBudgetBalanceAmount)+'万元':'--');if(d.isSpecial!=''&&d.isSpecial=='1'){$(".yesSpecial").show();$(".notSpecial").hide()}else{$(".yesSpecial").hide();$(".notSpecial").show()}$('#money4,#applySumMoney').text($yt_baseElement.fmMoney(d.advanceAmount||'0'));$('#applySumMoneyCap').text(arabiaToChinese(d.advanceAmount+''));$('#doAdvanceAmount').text($yt_baseElement.fmMoney(d.doAdvanceAmount||'0'));$('#taxAmount').text($yt_baseElement.fmMoney(d.taxAmount||'0'));if(d.prjName){$('#prjName').text(d.prjName);$('.prj-name-tr').show()}if(d.advanceCostType=='TRAIN_APPLY'){$(".adjustment-module").show();$(".adjustment-frequency").text((d.changeInfo.changeNum||'0'));$(".end-updete-date").text((d.changeInfo.advanceTime||'--'));}else{$(".adjustment-module").hide();}if(d.advanceCostType=='TRAVEL_APPLY'){$("#preTaxDiv").hide()}priorApproval.showCostDetail(d.costData);priorApproval.showCost(d.attList)},showCostDetail:function(data){var me=this;var fMoney=$yt_baseElement.fmMoney;var costReceptionistList=data.costReceptionistList;var costDetailsList=data.costDetailsList;var receHtml='';$.each(costReceptionistList,function(i,n){receHtml+='<tr pkId="'+n.receptionObjectId+'" class="" applyName="'+n.name+'" Unit="'+n.jobName+'" Duties="'+n.unitName+'"><td><span class="num">'+(i+1)+'</span></td><td><span class="name-text">'+n.name+'</span></td><td><span class="job-text">'+n.jobName+'</span></td><td><span class="unit-text">'+n.unitName+'</span></td></tr>'});$('.msg-list tbody').append(receHtml);if(data.costReceptionistList.length==0){}if(data.costDetailsList.length==0){}var detaHtml='';var costDetaClose=$('#paymentList').next().find('.check-label input');var thisTotal=0;$.each(costDetailsList,function(i,n){detaHtml+='<tr Tcode="'+n.budgetfeiCode+'" Pcode="'+n.costType+'" budgetProject="'+n.publicServiceProName+'" txtDate="'+n.activityDate+'" place="'+n.placeName+'" costBreakdown="'+n.costTypeName+'" bzy-span="'+n.standardAmount+'" budgetMoney="'+n.activityAmount+'" peoplenum="'+n.peopleNum+'"><td><span class="">'+n.publicServiceProName+'</span></td><td><span class="activityDate">'+n.activityDate+'</span></td><td><span class="place-name">'+n.placeName+'</span></td><td><span>'+n.costTypeName+'</span></td><td style="text-align: right;"><div class="money" money='+n.activityAmount+'>'+fMoney(n.activityAmount||'0')+'</div></td><td><span class="people-num">'+n.peopleNum+'</span></td></tr>';thisTotal+= +n.activityAmount;if(costDetaClose.length>0&&n.setMethod){costDetaClose.setCheckBoxState('check')}});detaHtml+='<tr><td>合计</td><td></td><td></td><td></td><td style="text-align: right;" class="total-money">'+$yt_baseElement.fmMoney(thisTotal)+'</td><td></td></tr>';$('#paymentList .yt-tbody').html(detaHtml);var tripPlanList=data.travelRouteList;var tripHtml='';var travelPersonnelsList=[];var getUserNames=function(list){var str='';$.each(list,function(i,n){str+=n.travelPersonnelName+(i<list.length-1?'、':'')});return str};var costItem=function(str){switch(str){case '1':return '住宿费';break;case '2':return '伙食费';break;case '3':return '市内交通费';break;default:return '';break}};var getCostItemName=function(str){var txt='';if(str){var list=str.split(',');$.each(list,function(i,n){if(n){txt+=costItem(n)+(i<list.length-1?'、':'')}});return txt}return '--'};$.each(tripPlanList,function(i,n){var dateFrom=new Date(n.startTime);var dateTo=new Date(n.endTime);var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24))+1;tripHtml+='<tr busicode="'+n.travelType+'" usercode="'+n.travelPersonnels+'" rececode="'+n.receptionCostItem+'" ><td><input type="hidden" class="hid-user-code" value="'+n.travelPersonnels+'" /> <span class="name">'+n.travelTypeName+'</span></td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="day">'+diff_day+'</td><td class="address" val="'+n.travelAddress+'">'+n.travelAddressName+'</td><td class="uname">'+getUserNames(n.travelPersonnelsList)+'</td><td class="numof">'+n.travelPersonnelsList.length+'</td><td class="reception">'+(getCostItemName(n.receptionCostItem)==''?'--':getCostItemName(n.receptionCostItem))+'</td></tr>'});$('#tripList tbody').html(tripHtml);var costCarfareList=data.costCarfareList;var carHtml='';var costCarfareClose=$('#traffic-list-info').next().find('.check-label input');$.each(costCarfareList,function(i,n){carHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+n.travelPersonnel+'"/></td><td>'+n.travelPersonnelsDept+'</td><td data-text="goTime">'+n.goTime+'</td><td><input data-val="goAddress" type="hidden" value="'+n.goAddress+'"><span data-text="goAddressName">'+n.goAddressName+'</span></td><td data-text="arrivalTime">'+n.arrivalTime+'</td><td><input data-val="arrivalAddress" type="hidden" value="'+n.arrivalAddress+'"> <span data-text="arrivalAddressName">'+n.arrivalAddressName+'</span></td><td><span data-text="vehicle">'+n.vehicleName+'</span><input type="hidden" class="hid-vehicle" value="'+n.vehicle+'"/><input type="hidden" class="hid-child-code" value=""/></td><td class="font-right money-td" data-text="crafare">'+(n.crafare==""?"--":fMoney(n.crafare||'0'))+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks||"无")+'</td><td style="display:none;"><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costCarfareClose.length>0&&n.setMethod){costCarfareClose.setCheckBoxState('check')}});if(costCarfareList.length==0){$('.traffic-cost-div').hide()}carHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td></tr>';$('#traffic-list-info tbody').html(carHtml);me.updateMoneySum(0);var costHotelList=data.costHotelList;var hotelHtml='';var costHotelClose=$('#hotel-list-info').next().find('.check-label input');$.each(costHotelList,function(i,n){var avg=n.hotelDays>0?fMoney((+n.hotelExpense/ +n.hotelDays)||'0'):n.hotelExpense;hotelHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" value="'+n.travelpersonnel+'"/></td><td>'+n.travelPersonnelsJobLevelName+'</td>'+'<td class="font-right">'+avg+'</td><td risk-code-val="hotelCheckInDate" class="check-in-date"><span class="sdate">'+n.hotelTime+'</span></td><td class="leave-date"><span class="edate">'+n.leaveTime+'</span></td><td data-text="hotelDays">'+n.hotelDays+'</td><td class="font-right money-td" data-text="hotelExpense">'+fMoney(n.hotelExpense||'0')+'</td><td><span data-text="hotelAddressName">'+n.hotelAddressName+'</span><input type="hidden" data-val="hotelAddress" value="'+n.hotelAddress+'"</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks||"无")+'</td><td style="display:none;"><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(costHotelClose.length>0&&n.setMethod){costHotelClose.setCheckBoxState('check')}});if(costHotelList.length==0){$(".hotel-list-model").hide()}hotelHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$('#hotel-list-info tbody').html(hotelHtml);me.updateMoneySum(1);var costOtherList=data.costOtherList;var otherHtml='';var costOtherClose=$('#other-list-info').next().find('.check-label input');$.each(costOtherList,function(i,n){otherHtml+='<tr><td><span>'+n.costTypeName+'</span><input type="hidden" data-val="costType" value="'+n.costType+'"/></td><td class="font-right money-td" data-text="reimAmount">'+fMoney(n.reimAmount||'0')+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks||"无")+'</td></tr>';if(costOtherClose.length>0&&n.setMethod){costOtherClose.setCheckBoxState('check')}});if(costOtherList.length==0){$('.other-cost-model').hide()}otherHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td></tr>';$('#other-list-info tbody').html(otherHtml);me.updateMoneySum(2);var costSubsidyList=data.costSubsidyList;var subHtml='';var totalFood=0;var totalTraffic=0;$.each(costSubsidyList,function(i,n){subHtml+='<tr class="'+n.travelPersonnel+'" code="'+n.travelPersonnel+'"><td><div class="user" code="'+n.travelPersonnel+'">'+n.travelPersonnelName+'</div></td><td><div class="lv">'+n.travelPersonnelsDept+'</div></td><td><div class="subsidy-num">'+n.subsidyDays+'</div></td><td><div style="text-align:right;" class="food">'+fMoney(n.subsidyFoodAmount||'0')+'</div></td><td><div  style="text-align:right;" class="traffic">'+fMoney(n.carfare||'0')+'</div></td></tr>';totalFood+= +n.subsidyFoodAmount;totalTraffic+= +n.carfare});subHtml+='<tr class="last"><td>合计</td><td></td><td></td><td class="total-food"  style="text-align:right;">'+$yt_baseElement.fmMoney(totalFood)+'</td><td class="total-traffic"  style="text-align:right;">'+$yt_baseElement.fmMoney(totalTraffic)+'</td></tr>';$('#subsidy-list-info tbody').html(subHtml);if(costSubsidyList.length==0){$(".subsidy-model").hide()}var meetingList=data.meetingList;$.each(meetingList,function(i,n){$("#meetTypeName").text(n.meetTypeName);$("#meetName").text(n.meetName);$("#meetAddress").text(n.meetAddress);$("#meetStartTime").text(n.meetStartTime);$("#meetEndTime").text(n.meetEndTime);$("#meetDays").text(n.meetDays);$("#meetOfNum").text(n.meetOfNum);$("#meetWorkerNum").text(n.meetWorkerNum)});var meetingCostList=data.meetingCostList;$.each(meetingCostList,function(i,n){$("#meetHotel").text($yt_baseElement.fmMoney((n.meetHotel||0)));$("#meetFood").text($yt_baseElement.fmMoney((n.meetFood||0)));$("#meetOther").text($yt_baseElement.fmMoney((n.meetOther||0)));$("#meetAmount").text($yt_baseElement.fmMoney((n.meetAmount||0)));$("#meetAverage").text($yt_baseElement.fmMoney((n.meetAverage||0)))});me.setTrainApplyInfoList(data.trainApplyInfoList);me.setCostList(data.projectBudgetList);},showCost:function(list){var me=this;if(list.length>0){var receHtml='';var src='';$.each(list,function(i,n){var imgType=n.attName.split('.');if(imgType.length>1&&(imgType[1]=='png'||imgType[1]=='jpeg'||imgType[1]=='bmp'||imgType[1]=='jpg')){src=$yt_option.base_path+'fileUpDownload/download?pkId='+n.attId+'&isDownload=false';receHtml+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pv">预览<img src="'+src+'" ></label></div>'}else{receHtml+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pvno">预览</label></div>'}});$('#receHtml').append(receHtml);$('#receHtml .file-dw').on('click',function(){var id=$(this).parent().attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'});$('#receHtml .file-pv img').showImg()}else{$('#receHtml').html('<div fid="" class="li-div"><span class="file-name">暂无附件</span></div>')}},getAdvanceAppInfoDetailByAdvanceAppId:function(advanceAppId){var me=this;$.ajax({type:"post",url:"sz/advanceApp/getAdvanceAppInfoDetailByAdvanceAppId",async:true,data:{advanceAppId:advanceAppId},success:function(data){if(data.flag==0){var d=data.data;if(d.taskKey=='activitiEndTask'){$('#approveSubBtn').text('流程结束');$('#approve-users').attr("validform","{isNull:false,msg:'请选择审批人'}")}else{$('#approveSubBtn').text('提交');}priorApproval.saveData=d;if(d.jsFun){me[d.jsFun]();}sysCommon.getApproveFlowData("SZ_ADVANCE_APP",d.processInstanceId);priorApproval.setexaminedata(d);var costTotalNum=$yt_baseElement.rmoney($("#predictCostTable .costTotal").text());var advanceAmountNum=parseFloat(d.advanceAmount);var afterTaxAllMoneyNum=$yt_baseElement.rmoney($("#afterTaxAllMoney").text());$("#vatSalesTax").text($yt_baseElement.fmMoney(afterTaxAllMoneyNum*0.03));$("#surtax").text($yt_baseElement.fmMoney(afterTaxAllMoneyNum*0.03*0.12));if(data.data.validateType=="UNIT"){$("#deptBudgetBalanceAmount").hide();$("#deptBudgetBalanceAmount").prev().hide();$("#deptBudgetBalanceAmount").next().hide()}if(data.data.validateType=="DEPT"){$("#budgetBalanceAmount").hide();$("#budgetBalanceAmount").prev().hide()}}}})},getSaveData:function(){var d=priorApproval.saveData,costData={};costData=d.costData;d.opintion=$("#opintion").val();d.nextCode=$("#operate-flow option:selected").val();d.dealingWithPeople=$("#approve-users option:selected").val();d.advanceAttIdStr=priorApproval.getFileList();d.costData=typeof(costData)=='string'?costData:JSON.stringify(costData);d.advanceAppReason=d.advanceAppName;d.costType=d.advanceCostType;d.appId=d.advanceAppId;return d},getFileList:function(){var str='';var list=$('#receHtml .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length-1?',':'')});return str},submitWorkFlow:function(d,thisBtn){$.ajax({type:"post",url:"sz/advanceApp/submitWorkFlow",async:true,data:d,success:function(data){if(data.flag==0){window.location.href=$yt_option.websit_path+'view/projectManagement-sasac/expensesReim/module/approval/beforehandApproveList.html?state=1'}$yt_alert_Model.prompt(data.message);thisBtn.attr('disabled',false).removeClass('btn-disabled')}})},showBusinessFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();$('#doAdvanceBox').hide();sysCommon.loadingWord('view/projectManagement-sasac/expensesReim/module/reimApply/hospitalitySpendingDetail.html')},showGeneralFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();$('.general-div').show();$('#doAdvanceBox').hide()},showTravelFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();$('.index-main-div').show();$('#doAdvanceBox').hide();sysCommon.loadingWord('view/projectManagement-sasac/expensesReim/module/reimApply/travelSpendingDetails.html')},showTrainFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();$('.index-main-div').show();$('#doAdvanceBox').show();sysCommon.loadingWord('view/projectManagement-sasac/expensesReim/module/busiTripApply/trainApproval.html')},showMettingFun:function(){$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div').show();$('.grod-div').show();$('#doAdvanceBox').hide();sysCommon.loadingWord('view/projectManagement-sasac/expensesReim/module/beforehand/meetingCostApplyDetails.html')},updateMoneySum:function(thisTab){var me=this;var moenySum=0.00;if(thisTab==0){$("#traffic-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#traffic-list-info tbody .money-sum").text(moenySum)}else{$("#traffic-list-info tbody .money-sum").text("0.00")}}if(thisTab==1){$("#hotel-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#hotel-list-info tbody .money-sum").text(moenySum)}else{$("#hotel-list-info tbody .money-sum").text("0.00")}}if(thisTab==2){$("#other-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#other-list-info tbody .money-sum").text(moenySum)}else{$("#other-list-info tbody .money-sum").text("0.00")}}if(thisTab==3){$("#subsidy-list-info tbody .food-money").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#subsidy-list-info tbody .money-sum").text(moenySum)}else{$("#subsidy-list-info tbody .money-sum").text("0.00")}var cityMoneySum=0.00;$("#subsidy-list-info tbody .city-money").each(function(i,n){cityMoneySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});cityMoneySum=$yt_baseElement.fmMoney(cityMoneySum);if(cityMoneySum!=undefined&&$yt_baseElement.rmoney(cityMoneySum)>0){$("#subsidy-list-info tbody .city-money-td").text(cityMoneySum)}else{$("#subsidy-list-info tbody .city-money-td").text("0.00")}}},updateApplyMeonySum:function(){var sumMoney=0;$(".cost-list-model table .money-sum").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});$(".cost-list-model table .city-money-td").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});sumMoney=$yt_baseElement.fmMoney(sumMoney);$(".count-val-num").text(sumMoney).attr('num',sumMoney);if($("body").find("#reimPrice")){$("#reimPrice").text(sumMoney);var loanPrice=$("#loanCost").text();var replPrice=$yt_baseElement.rmoney(sumMoney)-parseFloat(loanPrice);replPrice=$yt_baseElement.fmMoney(replPrice);$("#givePrice").text(replPrice)}if(sumMoney!=null&&sumMoney!=undefined&&$yt_baseElement.rmoney(sumMoney)>0){var sumMoneyLower=arabiaToChinese(sumMoney);$(".count-val").text(sumMoneyLower)}else{$(".count-val-num").text("0.00")}},setTrainApplyInfoList:function(list){var me=this;if(list.length>0){$("#regionDesignation").text(list[0].regionDesignation);list[0].isOffSiteTraining=='1'?list[0].isOffSiteTrainingVal='是':'';list[0].isOffSiteTraining=='0'?list[0].isOffSiteTrainingVal='否':'';list[0].costStandard=='1'?list[0].costStandardVal='基本标准':'';list[0].costStandard=='2'?list[0].costStandardVal='高成本标准':'';$('.expenditure-matter-basic-information').setDatas(list[0]);me.initProjectSelect(list[0].projectCode,list[0].projectId);$('.trainOfNum').text(list[0].budgetTraineeSum)}},setCostList:function(list){var html='';$('#TeachFeeTable tbody').empty();$('#trainingFeeTable tbody').empty();$.each(list,function(i,n){html='<tr><td align="right"><input type="hidden" value="'+n.costCode+'" class="cost-code"><span>'+n.costName+'</span></td><td><span>'+$yt_baseElement.fmMoney(n.budgetCost)+'</span></td><td style="text-align:left;"><p>'+n.accordingInstructions+'</p></td></tr>';if(n.costType==1){$('#TeachFeeTable').append(html)}if(n.costType==2){$('#trainingFeeTable').append(html)}})},setCostPredictInfoList:function(list){var html='';var costTotal=0;var costTotalAfter=0;$.each(list,function(i,n){html+='<tr  pid=""><td class="cost-name">'+n.predictName+'</td><td class="moneyText predict-standard-money">'+($yt_baseElement.fmMoney(n.predictStandardMoney))+'</td><td class="predict-people-num">'+n.predictPeopleNum+'</td><td class="moneyText predict-smallplan-money">'+($yt_baseElement.fmMoney(n.averageMoney))+'</td><td class="special-instruct">'+n.remark+'</td></tr>';costTotal+=n.predictStandardMoney*n.predictPeopleNum;costTotalAfter+=n.averageMoney});html+='<tr class="last"><td>合计</td><td></td><td></td><td class="moneyText costTotal">'+$yt_baseElement.fmMoney(costTotalAfter)+'</td><td></td></tr>';$('#predictCostTable tbody').html(html);$("#preTaxAllMoney").text($yt_baseElement.fmMoney(costTotal));$("#afterTaxAllMoney").text($yt_baseElement.fmMoney(costTotalAfter));if(list.length==0){$('#predictCostTable,.other-title-train').hide()}},setTeacherApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr><td class="lecturerName"><input type="hidden" class="lectureId" value="'+n.lecturerId+'"><span>'+n.lecturerName+'</span></td><td class="professional">'+(n.lecturerTitleName||'--')+'</td><td class="level">'+(n.lecturerLevelName||'--')+'</td><td style="display:none"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#lecturerTable tbody').html(html)},setCostTrainApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){var standard='';var trainOfNum='';var trainDays='';if(n.standard!='0'){standard=$yt_baseElement.fmMoney(n.standard)}if(n.trainOfNum!='0'){trainOfNum=n.trainOfNum}if(n.trainDays!='0'){trainDays=n.trainDays}html+='<tr><td>'+n.trainTypeName+'</td><td class="moneyText">'+standard+'</td><td>'+trainOfNum+'</td><td>'+trainDays+'</td><td class="moneyText">'+$yt_baseElement.fmMoney(n.averageMoney)+'</td><td>'+(n.remark||"无")+'</td></tr>';total+= +n.averageMoney});html+='<tr class="last"><td>合计</td><td></td><td></td><td></td><td class="moneyText costTotal">'+$yt_baseElement.fmMoney(total)+'</td><td></td></tr>';$('#trainingFeeTable tbody').html(html);if(list.length==0){$('.train-money').hide();$('.train-money').parent().hide();$('#trainingFeeTable,.other-title-train').hide()}},setCostTeachersFoodApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.foodId+'"><td><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="avg moneyText">'+priorApproval.fmMoney(n.averageMoney)+'</td><td class="day">'+n.foodOfDays+'</td><td class="moneyText sum-pay">'+priorApproval.fmMoney(n.foodAmount)+'</td><td class="dec">'+(n.remarks||"无")+'</td><td style="display:none"><input type="hidden" class="popM" value="4"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.foodAmount});$('#dietFeeTable tbody .end-tr').before(html);$('#dietFeeTable tbody .costTotal').text(priorApproval.fmMoney(total));if(list.length==0){$('.food-money').hide();$('.food-money').parent().hide();$('#dietFeeTable').hide()}},setCostTeachersLectureApplyInfoList:function(list){var html='';var total=0;var totalAfter=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersLectureId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="holder">'+(n.lecturerTitleName||'--')+'</td><td class="hour">'+n.teachingHours+'</td><td class="cname">'+(n.courseName||'--')+'</td><td class="moneyText sum-pay">'+priorApproval.fmMoney(n.perTaxAmount)+'</td><td class="moneyText after">'+priorApproval.fmMoney(n.afterTaxAmount)+'</td><td class="moneyText avg">'+priorApproval.fmMoney(n.averageMoney)+'</td><td style="display:none"><input type="hidden" class="popM" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.perTaxAmount;totalAfter+= +n.afterTaxAmount});$('#lectureFeeTable tbody .end-tr').before(html);$('#lectureFeeTable tbody .costTotal').text(priorApproval.fmMoney(total));$('#lectureFeeTable tbody .costTotal-after').text(priorApproval.fmMoney(totalAfter));if(list.length==0){$('.lecture-money').hide();$('.lecture-money').parent().hide();$('#lectureFeeTable').hide()}},setCostTeachersTravelApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersTravelId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="ulv">'+(n.lecturerLevelName||'--')+'</td><td class="sdate">'+n.goTime+'</td><td class="edate">'+n.arrivalTime+'</td><td class="sadd"><input type="hidden" class="scode" value="'+n.goAddress+'">'+n.goAddressName+'</td><td class="eadd"><input type="hidden" class="ecode" value="'+n.arrivalAddress+'">'+n.arrivalAddressName+'</td><td class="tname"><input type="hidden" class="tool" value="'+n.vehicle+'">'+n.vehicleName+'</td><td class="moneyText sum-pay">'+priorApproval.fmMoney(n.carfare)+'</td><td class="dec">'+(n.remarks||"无")+'</td><td  style="display:none"><input type="hidden" class="popM" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.carfare});$('#carFeeTable tbody .end-tr').before(html);$('#carFeeTable tbody .costTotal').text(priorApproval.fmMoney(total));if(list.length==0){$('.traffic-money').hide();$('.traffic-money').parent().hide();$('#carFeeTable').hide()}},setCostTeachersHotelApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersHotelId+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="moneyText avg">'+priorApproval.fmMoney(n.averageMoney)+'</td><td class="day">'+n.hotelDays+'</td><td class="moneyText sum-pay">'+priorApproval.fmMoney(n.hotelExpense)+'</td><td class="dec">'+(n.remarks||"无")+'</td><td style="display:none"><input type="hidden" class="popM" value="3"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.hotelExpense});$('#hotelFeeTable tbody .end-tr').before(html);$('#hotelFeeTable tbody .costTotal').text(priorApproval.fmMoney(total));if(list.length==0){$('.accommodation-money').hide();$('.accommodation-money').parent().hide();$('#hotelFeeTable').hide()}},setCostNormalList:function(list){},initProjectSelect:function(projectCode,projectId){if(projectCode){$.ajax({type:"post",url:"finance/budget/lookForProjectListBudget",async:false,data:{projectCode:projectCode,projectId:projectId},beforeSend:function(){},success:function(data){if(data.flag==0){var datas=data.data[0];datas.projectTypeName=$yt_baseElement.setProjectTypeName(datas.projectType);$('.expenditure-matter-basic-information').setDatas(datas)}},error:function(){$yt_alert_Model.prompt('网络异常')}})}}};$(function(){priorApproval.init()});