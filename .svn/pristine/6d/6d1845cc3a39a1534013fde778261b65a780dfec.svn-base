var carList={init:function(){carList.getPlanListInfo();$('.page-return-btn').click(function(){window.location.href="traineeList.html"});$('.add-btn').click(function(){carList.clearAddAlert();carList.addShowAlert()});var pkId="";$('.records-list').on('click','.records-edit',function(){carList.clearAddAlert();carList.addShowAlert();var tbTr=$(this).parents('tbody');pkId=tbTr.find('.pk-id').text();var visitDate=tbTr.find('.visit-date').text();var cause=tbTr.find('.cause').text();var chargePerson=tbTr.find('.charge-person').text();var receptionForm=tbTr.find('.reception-form').text();var receptionArrangement=tbTr.find('.reception-arrangement').text();var diningArrangements=tbTr.find('.dining-arrangements').text();var attendees=tbTr.find('.attendees').text();var giftGive=tbTr.find('.gift-give').text();var courtyardReturn=tbTr.find('.courtyard-return').text();var remarks=tbTr.find('.remarks').text();$('#visit-date').val(visitDate);$('.add-cause').setSelectVal(cause);$('.add-charge-person').setSelectVal(chargePerson);$('.add-reception-form').setSelectVal(receptionForm);$('.add-reception-arrangement').setSelectVal(receptionArrangement);$('.add-dining-arrangements').val(diningArrangements);$('.add-attendees').val(attendees);$('.add-gift-give').val(giftGive);$('.add-courtyard-return').val(courtyardReturn);$('.add-remarks').val(remarks);$('.add-shuttle-box select').niceSelect()});$('.records-list').on('click','.records-delete',function(){var tbTr=$(this).parent().parent().parent();var tabHtml=tbTr.parent().parent();pkId=$(tbTr).find('.pk-id').text();$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"trainee/deleteTraineEvisitingRecords",data:{pkId:pkId},async:false,success:function(data){if(data.flag==0){tabHtml.remove()}}})}})});carList.getworkFlowPerson();$("#visit-date").calendar({speed:200,complement:true,readonly:true,lowerLimit:"2010/01/01",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$('.select-teacher-btn-div').on('click','#submit',function(){carList.addInfo(pkId)});$('.train-list').on('click','.lookInfo',function(){var traineeId=$yt_common.GetQueryString("traineeId");var projectId=$($(this).parent()).find('.project-code').text();var headImg=new Image();var gender="";$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeDetails",data:{traineeId:traineeId,projectId:projectId},async:false,success:function(data){if(data.flag==0){if(data.data.headPortraitUrl!=""){headImg.src=data.data.headPortraitUrl;headImg.onload=function(){$('.look-student-details-img').attr('src',headImg.src);$('.look-student-details-img').jqthumb({width:85,height:122})}}else{$('.look-student-details-img').attr('src','../../resources/images/classStudent/student-picture.png');$('.look-student-details-img').jqthumb({width:85,height:122})};if(data.data.gender==1){gender="男"}else{gender="女"}$('#look-real-name').text(data.data.realName);$('#look-group-name').text(data.data.groupNum);$('#look-gender').text(gender);$('#look-nation-name').text(data.data.nationName);$('#look-id-type').text(data.data.idType);$('#look-id-number').text(data.data.idNumber);$('#look-phone').text(data.data.phone);$('#look-date-birth').text(data.data.dateBirth);$('#look-group-name').text(data.data.groupName);$('#look-group-org-name').text(data.data.groupOrgName);$('#look-org-type').text(data.data.orgType);$('#look-position-name').text(data.data.positionName);$('#look-mailing-address').text(data.data.mailingAddress);$('#look-postal-code').text(data.data.postalCode);$('#look-telephone').text(data.data.telephone);$('#look-fax').text(data.data.fax);$('#look-email').text(data.data.email);$('#look-party-date').text(data.data.partyDate);$('#look-work-time').text(data.data.workTime);$('#look-education-time').text(data.data.educationTime);$('#look-education-time-class').text(data.data.educationTimeClass);$('#look-service-time').text(data.data.serviceTime);$('.invoice-type').text(data.data.serviceTime);$('.org-name').text(data.data.serviceTime);$('.tax-number').text(data.data.serviceTime);$('.address').text(data.data.serviceTime);$('.telephone-roject').text(data.data.serviceTime);$('.registered-bank').text(data.data.serviceTime);$('.account').text(data.data.serviceTime);$('.linkman').text(data.data.serviceTime);$('.linkman-phone').text(data.data.serviceTime);$('.linkman-telephone').text(data.data.serviceTime);$('.linkman-fax').text(data.data.serviceTime);$('.linkman-email').text(data.data.serviceTime);$('.linkman-address-email').text(data.data.serviceTime)}}});carList.lookInfoAlert()})},getworkFlowPerson:function(){$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsers",data:{compId:""},async:false,success:function(data){if(data.data.length>0){var globalUserList=data.data;$.each(data.data,function(i,p){if(p.type==3){$(".add-charge-person").append('<option value="'+p.id+'">'+p.text+'</option>')}}),$(".add-charge-person").niceSelect({search:true,backFunction:function(text){$("select.add-charge-person option").remove();if(text==""){$("select.add-charge-person").append('<option value="">请选择</option>')}$.each(globalUserList,function(i,n){console.log(text);if(n.text.indexOf(text)!=-1){if(n.type==3){$("select.add-charge-person").append('<option value="'+n.id+'">'+n.text+'</option>')}}})}})}}})},hedImg:function(){$('#head-portrait-url').jqthumb({width:115,height:130,after:function(imgObj){}})},getPlanListInfo:function(){$yt_baseElement.showLoading();var traineeId=$yt_common.GetQueryString("traineeId");var headImg=new Image();var gender="";$.ajax({url:$yt_option.base_path+"trainee/getTraineeDetails",type:"post",data:{traineeId:traineeId},success:function(data){if(data.flag==0){var datas=data.data;if(datas.headPortraitUrl!=""){headImg.src=datas.headPortraitUrl;headImg.onload=function(){$('.student-details-img').attr('src',headImg.src);$('.student-details-img').jqthumb({width:85,height:122})}}else{$('.student-details-img').attr('src','../../resources/images/classStudent/student-picture.png');$('.student-details-img').jqthumb({width:85,height:122})};if(datas.gender==1){gender="男"}else{gender="女"}$('#real-name span').text(datas.realName);$('#gender').text(gender);$('#nation-name').text(datas.nationName);$('#id-type').text(datas.idType);$('#id-number').text(datas.idNumber);$('#phone').text(datas.phone);$('#date-birth').text(datas.dateBirth);$('#group-name').text(datas.groupName);$('#group-org-name').text(datas.groupOrgName);$('#org-type').text(datas.orgType);$('#position-name').text(datas.positionName);$('#mailing-address').text(datas.mailingAddress);$('#postal-code').text(datas.postalCode);$('#telephone').text(datas.telephone);$('#fax').text(datas.fax);$('#email').text(datas.email);$('#party-date').text(datas.partyDate);$('#work-time').text(datas.workTime);$('#education-time').text(datas.educationTime);$('#education-time-class').text(datas.educationTimeClass);$('#service-time').text(datas.serviceTime);$('#service-time-class').text(datas.serviceTimeClass);var invoiceHmlTbody=$('.invoice-list .yt-tbody');var invoiceHtmlTr='';if(datas.invoiceList.length>0&&datas.invoiceList[0]!=null){$(invoiceHmlTbody).empty();$.each(datas.invoiceList,function(i,v){i=i+1;invoiceHtmlTr='<tr><td style="text-align:center;">'+i+'</td><td class="org-name">'+v.orgName+'</td><td class="tax-number" style="text-align:center;">'+v.taxNumber+'</td><td class="address">'+v.address+'</td><td class="telephone-project" style="text-align:center;">'+v.telephoneProject+'</td><td class="registered-bank" style="text-align:center;">'+v.registeredBank+'</td><td class="account" style="text-align:center;">'+v.account+'</td></tr>';invoiceHmlTbody.append(invoiceHtmlTr)})}else{$(invoiceHmlTbody).empty();invoiceHtmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';invoiceHmlTbody.append(invoiceHtmlTr)}var trainListHmlTbody=$('.train-list .yt-tbody');var trainHtmlTr='';var traineeScore="";if(datas.trainList.length>0){$(trainListHmlTbody).empty();var checkInState;$.each(datas.trainList,function(i,v){i=i+1;if(v.checkInState==0){checkInState="不通过"};if(v.checkInState==1){checkInState="通过"};if(v.traineeScore==""){traineeScore=""}else if(v.traineeScore==undefined){traineeScore=""}else{traineeScore=v.traineeScore};trainHtmlTr='<tr><td class="pkid" style="text-align:center;">'+i+'</td><td class="project-date" style="text-align:center;">'+v.projectDate+'</td><td class="project-code" style="text-align:center;">'+v.projectCode+'</td><td class="project-name">'+v.projectName+'</td><td class="project-head" style="text-align:center;">'+v.projectHead+'</td><td class="org-name" style="text-align:center;">'+v.orgName+'</td><td class="dept-position-name" style="text-align:center;">'+v.deptName+v.positionName+'</td><td class="check-in-state" style="text-align:center;">'+checkInState+'</td><td class="trainee-committee" style="text-align:center;">'+v.traineeCommittee+'</td><td class="trainee-score" style="text-align:right;">'+traineeScore+'</td><td class="lookInfo" style="text-align:center;cursor: pointer;">查看</td></tr>';trainListHmlTbody.append(trainHtmlTr)})}else{$(trainListHmlTbody).empty();trainHtmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';trainListHmlTbody.append(trainHtmlTr)}var recordsDiv=$('.records-list');var recordsTab='';if(datas.traineeVisitingRecordsList.length>0){$(recordsDiv).empty();var cause;var receptionForm;var receptionArrangement;$.each(datas.traineeVisitingRecordsList,function(i,v){i=i+1;if(v.cause==1){cause="来访"}if(v.cause==2){cause="电话联络"}if(v.cause==3){cause="走访"}if(v.receptionForm==1){receptionForm="公务接待"}if(v.receptionForm==2){receptionForm="对方付费"}if(v.receptionArrangement==1){receptionArrangement="用餐"}if(v.receptionArrangement==2){receptionArrangement="市内参观"}if(v.receptionArrangement==3){receptionArrangement="旅顺参观"}if(v.receptionArrangement==4){receptionArrangement="其他"}recordsTab='<table class="yt-table records-tab-list" style="margin:10px auto;"><tbody class="tbody-records"><tr><td class="pk-id" style="display:none;">'+v.pkId+'</td><td colspan="7" style="height:35px;position: relative;"><span style="position: absolute;text-align:center;line-height:33px; width:33px;height:33px;">'+i+'</span><img src="../../resources/images/open/traineeRecords.png" style="float:left; width:33px;height:33px;" ><div style="border-bottom:1px solid #DE595A;height:32px;width:200px;margin-left:16px;"><p class="records-edit" style="cursor: pointer;float:left;margin:6px 35px;">编辑<p><p class="records-delete" style="cursor: pointer;float:left;margin-top:6px">删除<p></div></td></tr><tr><td rowspan="6" style="width: 60px;text-align: center;"></td><td class="td-rights" style="width: 90px;">洽谈日期：</td><td class="visit-date">'+v.visitDate+'</td><td class="td-rights" style="width: 70px;">事由：</td><td style="display:none" class="cause">'+v.cause+'</td><td>'+cause+'</td><td class="td-rights" style="width: 120px;">对接扶负责人：</td><td style="display:none" class="charge-person">'+v.chargePerson+'</td><td>'+v.chargePersonName+'</td></tr><tr><td class="td-rights">接待形式：</td><td style="display:none" class="reception-form">'+v.receptionForm+'</td><td>'+receptionForm+'</td><td class="td-rights" style="width: 70px;">接待安排：</td><td style="display:none" class="reception-arrangement">'+v.receptionArrangement+'</td><td>'+receptionArrangement+'</td><td class="td-rights">用餐安排：</td><td class="dining-arrangements">'+v.diningArrangements+'</td></tr><tr><td class="td-rights">出席人员：</td><td class="attendees" colspan="5">'+v.attendees+'</td></tr><tr><td class="td-rights">对方反馈：</td><td class="gift-give" colspan="5">'+v.giftGive+'</td></tr><tr><td class="td-rights">我院反馈：</td><td class="courtyard-return" colspan="5">'+v.courtyardReturn+'</td></tr><tr><td class="td-rights">备注：</td><td class="remarks" colspan="5" style="width:960px;">'+v.remarks+'</td></tr></tbody></table>';recordsDiv.append(recordsTab)})}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},clearAddAlert:function(){$('#visit-date').val("");$('.add-cause').setSelectVal("");$('.add-charge-person').setSelectVal("");$('.add-reception-form').setSelectVal("");$('.add-reception-arrangement').setSelectVal("");$('.add-dining-arrangements').val("");$('.add-attendees').val("");$('.add-gift-give').val("");$('.add-courtyard-return').val("");$('.add-remarks').val("")},addInfo:function(pkId){var traineeId=$yt_common.GetQueryString("traineeId");var visitDate=$('#visit-date').val();var cause=$('.add-cause').val();var chargePerson=$('.add-charge-person').val();var receptionForm=$('.add-reception-form').val();var receptionArrangement=$('.add-reception-arrangement').val();var diningArrangements=$('.add-dining-arrangements').val();var attendees=$('.add-attendees').val();var giftGive=$('.add-gift-give').val();var courtyardReturn=$('.add-courtyard-return').val();var remarks=$('.add-remarks').text();$.ajax({type:"post",url:$yt_option.base_path+"trainee/addOrupdateTraineEvisitingRecords",data:{pkId:pkId,traineeId:traineeId,visitDate:visitDate,cause:cause,chargePerson:chargePerson,receptionForm:receptionForm,receptionArrangement:receptionArrangement,diningArrangements:diningArrangements,attendees:attendees,giftGive:giftGive,courtyardReturn:courtyardReturn,remarks:remarks},async:false,success:function(data){}})},addShowAlert:function(){$(".add-shuttle-box").show();$yt_alert_Model.getDivPosition($(".add-shuttle-box"));$yt_model_drag.modelDragEvent($(".add-shuttle-box .yt-edit-alert-title"));$('.add-shuttle-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$('.add-shuttle-box .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},lookInfoAlert:function(){$(".look-info").show();$yt_alert_Model.getDivPosition($(".look-info"));$yt_model_drag.modelDragEvent($(".look-info .yt-edit-alert-title"));$('.look-info .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})}};$(function(){carList.init();debugger});