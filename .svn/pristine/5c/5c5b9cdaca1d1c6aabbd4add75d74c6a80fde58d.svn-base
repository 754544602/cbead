var beforeApproList={searchInput:function(){$('.search').on('keydown',function(){if($(this).val()!=''){$('.clearImg').show()}});$('.clearImg').on('click',function(){$('.search').val('');$(this).hide();beforeApproList.searchList()});$("#resetBtn").off().on("click",function(){$('.search').val('');$(".clearImg").hide();beforeApproList.searchList()});$("#heardSearchBtn").off().on("click",function(){beforeApproList.searchList()});$(".end-table").on('click','.process-state',function(){var processInstanceId=$(this).parents("tr").find(".processInstanceId").val();sysCommon.processStatePop(processInstanceId)});$('.screen input').change(function(){var stateCode="WF_PASS_QUERY_SQL_PARAMS";var signState=function(){var states=$('.screen .check');if($(states).length>=2||$(states).length<=0){return '2'}else if($(states).length<2){return $(states).find('input').val()}return ''};var sta='';if($(this).parent().hasClass('check')){$(this).setCheckBoxState("uncheck");sta=signState()}else{$(this).setCheckBoxState("check");sta=signState()}beforeApproList.getProcessingAndFinishList(stateCode,sta)});var check=true;$('.all-checked').click(function(){if(check){$('.end-table tbody').setCheckBoxState("checkAll");$('.end-table tbody tr').addClass('yt-table-active')}else{$('.end-table tbody').setCheckBoxState("unCheckAll");$('.end-table tbody tr').removeClass('yt-table-active')}check=!check});$('.already-printed').click(function(){var ids='';$('.end-table tbody .check').each(function(i,n){ids+=$(n).find('input').val()+(i<$('.end-table tbody .check').length-1?',':'')});if(ids){beforeApproList.updateAdvanceIsPrintStateYes(ids);check=true}else{$yt_alert_Model.prompt('请选择数据进行操作')}});$('.non-printing').click(function(){var ids='';$('.end-table tbody .check').each(function(i,n){ids+=$(n).find('input').val()+(i<$('.end-table tbody .check').length-1?',':'')});if(ids){beforeApproList.updateAdvanceIsPrintStateNo(ids);check=true}else{$yt_alert_Model.prompt('请选择数据进行操作')}});beforeApproList.printBtnEvent();$(".end-table .yt-tbody").on('change','input[type=checkbox]',function(){if($(this)[0].checked){$(this).parents('tr').addClass('yt-table-active')}else{$(this).parents('tr').removeClass('yt-table-active')}return false});$(".end-table .yt-tbody").on('click','tr',function(){if($(this).hasClass('yt-table-active')){$(this).removeClass('yt-table-active');$(this).find('input[type=checkbox]').setCheckBoxState('uncheck')}else{$(this).addClass('yt-table-active');$(this).find('input[type=checkbox]').setCheckBoxState('check')}return false})},updateAdvanceIsPrintStateYes:function(ids){$.ajax({type:"post",url:"sz/advanceApp/updateAdvanceIsPrintStateYes",async:false,data:{ids:ids},success:function(data){if(data.flag==0){$yt_alert_Model.prompt(data.message);beforeApproList.searchList()}else{$yt_alert_Model.prompt(data.message)}}})},updateAdvanceIsPrintStateNo:function(ids){$.ajax({type:"post",url:"sz/advanceApp/updateAdvanceIsPrintStateNo",async:false,data:{ids:ids},success:function(data){if(data.flag==0){$yt_alert_Model.prompt(data.message);beforeApproList.searchList()}else{$yt_alert_Model.prompt(data.message)}}})},printBtnEvent:function(){$("#printBeforBtn").click(function(){var selTrLen=$(".tab-div .tab-content:visible tbody tr.yt-table-active").length;var thisTrData=$(".tab-div .tab-content:visible tbody tr.yt-table-active").data("dataStr");if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作")}else{var pageUrl="view/projectManagement-sasac/expensesReim/module/print/beforeApplyDetailMain.html?expenditureAppId="+thisTrData.advanceAppId+'&costType='+thisTrData.advanceCostType;$yt_baseElement.openNewPage(2,pageUrl)}})},searchList:function(){beforeApproList.getProcessingAndFinishList('WF_PASS_QUERY_SQL_PARAMS','2')},toDetails:function(){$('.yt-link.to-detail').off("click").on('click',function(){$yt_baseElement.eventStopPageaction();var processInstanceId=$(this).parents('tr').find('.processInstanceId').val();var advanceId=$(this).parents('tr').find('.hid-advance-id').val();var fun=$(this).attr('fun');var pageUrl="view/projectManagement-sasac/expensesReim/module/beforehand/beforeApplyDetail.html?processInstanceId="+processInstanceId+"&advanceId="+advanceId+"&fun="+fun;$yt_baseElement.openNewPage(2,pageUrl)})},getProcessingAndFinishList:function(stateCode,printState){var keyWord=$('.search').val();$('.page2').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:'sz/advanceApp/getUserAdvanceAppInfoBusinessListToPageByParams',data:{queryStateParams:stateCode,queryParams:keyWord,printState:printState,formType:"project"},objName:'data',success:function(data){var datas=data.data.rows;var htmlTbody=$('.end-table .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){if(datas.length>0){$('.page2').show();$.each(datas,function(i,n){trStr+='<tr><td><label class="check-label yt-checkbox"><input type="checkbox" name="test" value="'+n.advanceAppId+'"/></label></td><td><a class="yt-link to-detail">'+n.advanceAppNum+'</a><input type="hidden" class="hid-advance-id" value="'+n.advanceAppId+'"/><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/></td><td class="tl">'+(n.advanceAppName==""?"--":n.advanceAppName)+'</td><td style="text-align: right;">'+(n.advanceAmount==""?"--":$yt_baseElement.fmMoney(n.advanceAmount))+'</td>'+'<td>'+n.applicantUserName+'</td><td><span>'+n.applicantDept+'</span></td>';if(stateCode=='WF_PASS_QUERY_SQL_PARAMS'){$(".applicant-time-th").show();trStr+='<td>'+n.applicantTime+'</td>'}else{$(".applicant-time-th").hide()}if(stateCode=='WF_SOLVED_QUERY_SQL_PARAMS'){$(".process-state-th").show();trStr+='<td style="text-align:left;"><span class="yt-link process-state">'+n.nodeNowState+'</span></td>'}else{$(".process-state-th").hide()}trStr+='<td class="app-state-td"><span class="">'+(n.changeState==0?'未修改':'已修改')+'</span></td><td class="print-state" style="color: '+(n.isPrint==0?'#333333':'#417095')+';">'+(n.isPrint==0?'未打印':'已打印')+'</td><td><a class="yt-link log-mod">日志</a></td></tr>';trStr=$(trStr).data("dataStr",n);htmlTbody.append(trStr)});beforeApproList.goApprovePage();sysCommon.initQtip($(".log-mod"));beforeApproList.toDetails()}else{$('.page2').hide();htmlTbody.append(sysCommon.noDataTrStr(8))}}},isSelPageNum:true })},goApprovePage:function(){$(".apprv-btn").off().click(function(){var advanceId=$(this).parents("tr").find(".hid-advance-id").val();var state=$(this).attr('taskKey');var fun=$(this).attr('fun');var pageUrl='';if(state=='activitiStartTask'){pageUrl='view/system-sasac/expensesReim/module/busiTripApply/serveApply.html?advanceId='+advanceId}else{pageUrl='view/system-sasac/expensesReim/module/busiTripApply/priorApproval.html?advanceId='+advanceId+'&fun='+fun}parent.parent.$yt_baseElement.showLoading();window.location.href=$yt_option.websit_path+pageUrl})}};$(function(){beforeApproList.searchInput();beforeApproList.searchList();$("#reimApproList").css("min-height",$(window).height()-12)});