var caList={init:function(){caList.getPlanListInfo();$('.add-btn').off().on("click",function(){window.location.href="addPage.html"});$("#issueDayeString").calendar({speed:200,complement:true,readonly:true,lowerLimit:"2010/01/01",nowData:true,dateFmt:"yyyy-MM-dd HH:mm",callback:function(){}});$('.publish-btn').off().on("click",function(){var issueDayeString=$('.yt-table-active .issueDayeString').text();var title=$('.yt-table-active .td-title').find('.title').text();var states=$('.yt-table-active .states').text();$('#issueDayeString').val(issueDayeString);$('#title').val(title);if(issueDayeString==""||title==""){$yt_alert_Model.prompt("请选择要发布的新闻稿")}else if(states!="已通过"){$yt_alert_Model.prompt("该新闻稿审批未通过，不能发布")}else{caList.legalAdd()}});$('.suer-publish-btn').off().on("click",function(){caList.publish()});$('.search-btn').off().on("click",function(){caList.getPlanListInfo()});$('.title').off().on("click",function(){var $tr=$(this).parent().parent();var states=$tr.find('.states').text();var pkId=$tr.find('.pkId').val();if(states=="草稿"||states=="未通过"){window.location.href="addUpdatePage.html?pkId="+pkId}else{window.location.href="lookInfoPage.html?pkId="+pkId}})},publish:function(){var pkId=$('.yt-table-active .pkId').val();var issueDayeString=$('.yt-table-active .issueDayeString').text();caList.legalAdd();$.ajax({type:"post",url:$yt_option.base_path+"class/news/updateIssueDaye",data:{pkId:pkId,issueDayeString:issueDayeString},async:false,success:function(data){if(data.flag==0){$yt_alert_Model.prompt("发布成功");$(".yt-edit-alert,#heard-nav-bak").hide();caList.init()}else{$yt_alert_Model.prompt("发布失败");$(".yt-edit-alert,#heard-nav-bak").hide();caList.init()}}})},legalAdd:function(){$(".alert-index").show();$yt_alert_Model.getDivPosition($(".alert-index"));$yt_model_drag.modelDragEvent($(".lawyer-opinion-box .yt-edit-alert-title"));$('.alert-index .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".alert-index").hide();$("#pop-modle-alert").hide()})},getPlanListInfo:function(){$yt_baseElement.showLoading();var searchParameters=$('#keyword').val();$('.list-page').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/news/lookForAll",type:"post",data:{searchParameters:searchParameters},objName:'data',success:function(data){$yt_baseElement.showLoading();if(data.flag==0){var htmlTbody=$('.class-tbody');var htmlTr='';var sequenceNumber;if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){sequenceNumber=i+1;htmlTr+='<tr><input type="hidden" value="'+v.pkId+'" class="pkId"><td style="text-align:center;">'+sequenceNumber+'</td><td class="text-overflow td-title"><a class="title">'+v.title+'</a></td><td class="projectName">'+v.projectName+'</td><td style="text-align:center;" class="createTimeString">'+v.createTimeString+'</td><td style="text-align:center;" class="text-overflow">'+v.createUserName+'</td><td style="text-align:center;" class="text-overflow issueDayeString">'+v.issueDayeString+'</td><td style="text-align:center;" class="states">'+v.states+'</td></tr>'})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},addnewsInfo:function(dataStates){$yt_baseElement.showLoading();var projectCode=$('#projectCode').val();var title=$('#title').val();var details=$('#details').val();var issueDayeString=$('#issueDayeString').val();var dealingWithPeople=$('#dealingWithPeople').val();$.ajax({type:"post",url:$yt_option.base_path+"class/news/addOrUpdateBean",data:{pkId:"",projectCode:projectCode,title:title,details:details,issueDayeString:issueDayeString,businessCode:"news",dealingWithPeople:dealingWithPeople,dataStates:dataStates,nextCode:"submited"},success:function(data){$yt_baseElement.showLoading();if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("添加成功");$(".yt-edit-alert,#heard-nav-bak").hide()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("添加失败");$(".yt-edit-alert,#heard-nav-bak").hide()})}caList.init()}})}};$(function(){caList.init()});