var elementaryStudentList={init:function(){$("select").niceSelect();$(".chose-year").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy",callback:function(){}});$(".date-birth").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".party-date").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".work-time").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".addList").on('click',function(){elementaryStudentList.addElementaryStudentAlert();$(".yt-model-sure-btn").click(function(){elementaryStudentList.addElementaryStudentList()})});$(".updateList").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要修改的数据");return false}elementaryStudentList.addElementaryStudentAlert();$(".yt-model-sure-btn").click(function(){elementaryStudentList.amendElementaryStudentList()})});$(".delList").on('click',function(){var pkId="";$('.select-elementary-checkbox input[class="select-elementary-pkId"]:checked').each(function(){if(pkId==""){pkId=$(this).val()}else{pkId+=","+$(this).val()}});if(pkId==""){$yt_alert_Model.prompt("请选中一行数据进行操作",3000)}else{elementaryStudentList.delElementaryStudentList(pkId)}});$(".train-tbody").on('click',".real-name-inf",function(){window.location.href=$yt_option.base_path+"website/view/project/projectDetails.html?pkId="+$('.yt-table-active .pkId').val()});var classList=elementaryStudentList.getListSelectClass();if(classList!=null){$.each(classList,function(i,n){$(".project-code").append('<option value="'+n.projectCode+'" className="'+n.className+'">'+n.projectCode+'</option>')})}$(".project-code").niceSelect();var nationsList=elementaryStudentList.getListSelectNations();if(nationsList!=null){$.each(nationsList,function(i,n){$(".nation-id").append('<option value="'+n.nationId+'">'+n.nationName+'</option>')})}$(".nation-id").niceSelect();$("select.project-code").change(function(){var className=$("select.project-code option:selected").attr("className");$(".class-name").text(className)});$(".btn-effective").click(function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要修改的数据");return false}var remarks="有效";elementaryStudentList.effectiveInvalidElementaryList(remarks)});$(".btn-invalid").click(function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要修改的数据");return false}var remarks="无效";elementaryStudentList.effectiveInvalidElementaryList(remarks)});$(".export-student-btn").on("click",function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}var selectParam=$('.selectParam').val();var years=$('.chose-year').val();var downUrl=$yt_option.base_path+"class/trainee/downloadTraineeByYear";$.ajaxDownloadFile({url:downUrl,data:{selectParam:selectParam,years:years,isDownload:true}})});$(".check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".elementary-tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}});elementaryStudentList.getElementaryStudentList()},getListSelectClass:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/getClasslist",data:{searchParameters:"",types:'4'},async:false,success:function(data){list=data.data||[]}});return list},getListSelectNations:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/getNations",data:{searchParameters:""},async:false,success:function(data){list=data.data||[]}});return list},getElementaryStudentList:function(){var selectParam=$(".selectParam").val();var years=$(".chose-year").val();$('.elementary-page').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/trainee/getClassTraineeByYear",type:"post",data:{selectParam:selectParam,years:years},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.list-table .elementary-tbody');var htmlTr='';var num=1;if(data.data.rows.length>0){$(htmlTbody).empty();$.each(data.data.rows,function(i,v){if(v.deptPosition==null){v.deptPosition=""}htmlTr='<tr><td><label class="check-label yt-checkbox select-elementary-checkbox"><input type="checkbox" name="test" class="select-elementary-pkId" value="'+v.pkId+'"/></label></td><td><input type="hidden" class="trainee-id" value="'+v.traineeId+'"/>'+num++ +'</td><td class="project-code">'+v.projectCode+'</a></td><td>'+v.groupName+'</td><td>'+v.realName+'</td><td>'+v.gender+'</td><td>'+v.orgName+'</td><td>'+v.types+'</td><td>'+v.deptPosition+'</td><td>'+v.remarks+'</td><td>'+v.linkman+'</td><td>'+v.linkmanPhone+'</td><td>'+v.checkInState+'</td><td>'+v.projectStates+'</td></tr>';htmlTbody.append($(htmlTr).data("legalData",v))})}}else{$yt_alert_Model.prompt("查询失败")}},isSelPageNum:true })},addElementaryStudentList:function(){var validFlag=$yt_valid.validForm($(".valid-tab"));if(validFlag){}else{}var projectCode=$(".add-elementary-student select.project-code").val();var realName=$(".add-elementary-student .real-name").val();var gender=$(".add-elementary-student .gender").val();var nationId=$(".add-elementary-student .nation-id").val();var phone=$(".add-elementary-student .phone").val();var idType=$(".add-elementary-student .id-type").val();var idNumber=$(".add-elementary-student .id-number").val();var dateBirth=$(".add-elementary-student .date-birth").val();var groupId=$(".add-elementary-student .group-id-elementary").val();var orgId=$(".add-elementary-student .org-id").val();var orgType=$(".add-elementary-student .org-type").val();var deptName=$(".add-elementary-student .dept-name").val();var mailingAddress=$(".add-elementary-student .mailing-address").val();var postalCode=$(".add-elementary-student .postal-code").val();var telephoneProject=$(".add-elementary-student .telephone-project").val();var fax=$(".add-elementary-student .fax").val();var email=$(".add-elementary-student .email").val();var partyDate=$(".add-elementary-student .party-date").val();var workTime=$(".add-elementary-student .work-time").val();var educationTime=$(".add-elementary-student .education-time").val();var educationTimeClass=$(".add-elementary-student .education-time-class").val();var serviceTime=$(".add-elementary-student .service-time").val();var serviceTimeClass=$(".add-elementary-student .service-time-class").val();var linkman=$(".add-elementary-student .linkman").val();var linkmanPhone=$(".add-elementary-student .linkman-phone").val();var linkmanTelephone=$(".add-elementary-student .linkman-telephone").val();var linkmanFax=$(".add-elementary-student .linkman-fax").val();var linkmanEmail=$(".add-elementary-student .linkman-email").val();var linkmanAddressEmail=$(".add-elementary-student .linkman-address-email").val();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/addOrUpdateTrainee",data:{projectCode:projectCode,realName:realName,gender:gender,nationId:nationId,phone:phone,idType:idType,idNumber:idNumber,dateBirth:dateBirth,groupId:groupId,orgId:orgId,orgType:orgType,deptName:deptName,mailingAddress:mailingAddress,postalCode:postalCode,telephoneProject:telephoneProject,fax:fax,email:email,partyDate:partyDate,workTime:workTime,educationTime:educationTime,educationTimeClass:educationTimeClass,serviceTime:serviceTime,serviceTimeClass:serviceTimeClass,linkman:linkman,linkmanPhone:linkmanPhone,linkmanTelephone:linkmanTelephone,linkmanFax:linkmanFax,linkmanEmail:linkmanEmail,linkmanAddressEmail:linkmanAddressEmail,traineeId:"",groupNum:"",positionName:"",invoiceType:"",taxNumber:"",address:"",registeredBank:"",account:"",telephone:"",orgName:""},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("新增成功");$('.elementary-page').pageInfo("refresh");$(".yt-edit-alert").hide()}else{$yt_alert_Model.prompt("新增失败")}}})},addElementaryStudentAlert:function(){$(".add-elementary-student").show();$yt_alert_Model.getDivPosition($(".add-elementary-student"));$yt_alert_Model.setFiexBoxHeight($(".add-elementary-student .alert-form"));$yt_model_drag.modelDragEvent($(".add-elementary-student .yt-edit-alert-title"));$('.add-elementary-student .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".add-elementary-student").hide();$("#pop-modle-alert").hide()})},delElementaryStudentList:function(){var projectCode=$('.yt-table-active .project-code').text();var traineeId=$('.yt-table-active .trainee-id').val();$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/deleteTrainee",data:{projectCode:projectCode,traineeId:traineeId,projectId:""},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("删除成功");$('.elementary-page').pageInfo("refresh")}else{$yt_alert_Model.prompt("不能删除")}}})}})},effectiveInvalidElementaryList:function(remarks){var projectCode=$('.yt-table-active .project-code').text();var traineeId=$('.yt-table-active .trainee-id').val();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/updateClassTraineeRemarks",data:{projectCode:projectCode,traineeId:traineeId,remarks:remarks},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("操作成功");$('.elementary-page').pageInfo("refresh")}else{$yt_alert_Model.prompt("操作失败")}}})}};$(function(){elementaryStudentList.init()});