var paymentApply={saveData:{payAppId:'',paymentAppNum:'',specialCode:'',applicantUser:'',processInstanceId:''},events:function(){var me=this;$('#getvalue').change(function(){var fun=$(this).find('option:selected').attr('fun');if(fun){me[fun]()}else{$('.index-main-div').html('');$('.qtip-text-div').show();$('.mod-div,.dottom-div,.grod-div').hide()}});$('#attIdStr').on('click','.del-file',function(){var ithis=$(this);var parent=ithis.parent();$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){parent.remove()}})});$("#cancelBtn").off().on('click',function(){window.history.back(-1)});$('.money-input').on('focus',function(){var ts=$(this);if(ts.val()!=""){ts.val($yt_baseElement.rmoney(ts.val()))}});$('.money-input').on('blur',function(){var ts=$(this);if(ts.val()!=''){ts.val($yt_baseElement.fmMoney(ts.val()))}});$('.money-input').on('keyup',function(){var ts=$(this);if(ts.val()!=''){ts.val(ts.val().replace(/[^\d.]/g,''))}});},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},rmoney:function(str){return $yt_baseElement.rmoney(str||'0')},start:function(){$('#applyDate').calendar({speed:0,nowData:false})},payeeAppenddix:function(){$(".file-up-div").off().on('change','.cont-file',function(obj){var fileElementId=this.id;var ithisParent=$('#attIdStr');var url=$yt_option.base_path+"/fileUpDownload/upload?ajax=1&modelCode=REIM_APP";var imgUlr='';$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:fileElementId,success:function(data,textStatus){if(data.flag==0){var attaElement=$('<div fId="'+data.data.pkId+'" class="li-div"><span>'+data.data.naming+'</span><span class="del-file">x</span></div>');ithisParent.append(attaElement)}else{$yt_alert_Model.prompt(data.message)}},error:function(data,status,e){$yt_alert_Model.prompt(data.message)}})})},beforehandApply:function(){$('.prior-approval').click(function(){paymentApply.getPriorApprovalList();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('.prior-alert'));$('#pop-modle-alert').show();$('.prior-alert').show()});$('#query').click(function(){paymentApply.getPriorApprovalList()});$('#approvalReset').click(function(){$('#askinput').val('');paymentApply.getPriorApprovalList()})},getPriorApprovalList:function(){var tbody=$('table.special-list tbody');var queryParams=$('#askinput').val();var costType=$('#getvalue option:selected').val();var pageDiv=$('.prior-page');$('.prior-page').pageInfo({pageIndex:1,pageNum:5,pageSize:3,url:"sz/advanceApp/getAdvanceAppListToPageByParams",objName:'data',data:{queryParams:queryParams,costType:costType},success:function(data){tbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){pageDiv.show();$.each(data.data.rows,function(i,n){trStr+='<tr pid="'+n.advanceAppId+'" code="'+n.advanceAppNum+'" amount="'+n.advanceAmount+'"><td>'+n.advanceAppNum+'<input type="hidden" class="balance" value="'+n.advanceAppBalance+'" /></td><td>'+n.applicantUserName+'</td><td>'+n.applicantUserDeptName+'</td><td>'+n.advanceAppName+'</td><td>'+n.advanceCostTypeName+'</td><td>'+n.applicantTime+'</td>'+'</tr>'});tbody.append(trStr)}else{pageDiv.hide();var noTr='<tr class="model-no-data-tr"><td colspan="7"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';tbody.append(noTr)}}}})},befAlertok:function(){$('.prior-common').click(function(){var activeTr=$('.special-list .yt-table-active');var code=activeTr.attr('code');var codeName=activeTr.find('.sname').text();var balance=activeTr.find('.balance').val();var id=activeTr.attr('pid');if(code){paymentApply.saveData.advanceAppId=id;paymentApply.getAdvanceAppInfoDetailByAdvanceAppId(id);$('#advanceAppBalance').text(balance?$yt_baseElement.fmMoney(balance)+'元':'--');$('.prior-approval').val(code);$('.special-name').val(codeName);$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide();$('.index-main-div .export-but').show();$('.advance-relevance').show()}else{$yt_alert_Model.prompt('请选择一条数据')}})},showGeneralAlert:function(){var alert=$('.general-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},befAlertclear:function(){$('.prior-cancel').click(function(){$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide();paymentApply.clearAlert($(".prior-alert"))})},specialApply:function(){$('.special-name').click(function(){paymentApply.getPriorApprovalList();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('.prior-alert'));$('#pop-modle-alert').show();$('.prior-alert').show()})},specialAlertok:function(){$('.pecial-common').click(function(){var code=$('.special-list .yt-table-active').attr('code');var codeName=$('.special-list .yt-table-active').find('td').eq(1).text();var codeMon=$('.special-list .yt-table-active').find('td').eq(2).text();if(code){$('#codeMon').text(codeMon);$('.special-name').val(codeName);$yt_baseElement.hideMongoliaLayer();$('.pecial-name-window').hide();$('#pop-modle-alert').hide()}else{$yt_alert_Model.prompt('请选择一条数据')}})},specialAlertclear:function(){$('.pecial-cancel').click(function(){$yt_baseElement.hideMongoliaLayer();$('.pecial-name-window').hide();$('#pop-modle-alert').hide();paymentApply.clearAlert($(".pecial-name-window"))})},whetherSpecial:function(){$('.special-type').change(function(){var val=$(this).val();var yesno='';if(val=='2'){$('.special-yes').hide();$('.special-no').hide();var name=$('#getvalue option:selected').text();$('.special-label').text(name+'余额：');var yesno='否'}else{$('.special-yes').show();var priorAppr=$(".prior-approval").val();if(priorAppr){$('.special-no').hide()}else{$('.special-no').hide()}var yesno='是'}})},selectCost:function(){$('#getvalue').on('change',function(){var name=$('#getvalue option:selected').text();$('.special-label').text(name+'余额：')})},delPayment:function(){$('#paymentDetailedTable').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();paymentApply.paymentTotal()}})})},delCompany:function(){$('.payee-unit').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();paymentApply.companyTotal()}})})},delPersonal:function(){$('.payee-personal').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();paymentApply.personalTotal()}})})},delOther:function(){$('.payee-other').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();paymentApply.otherTotal()}})})},alertClearReceivables:function(){$('#addExpense').click(function(){var code='company';$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();$('#appendPaymentInfo').off().on('click',function(){paymentApply.raceAddList()}).text('保存')});$("#model-canel-btn").click(function(){sysCommon.closeModel($("#cost-apply-model"));paymentApply.clearAlert($(".model-content"))});$(".receipt-alert .cost-type-tab li").click(function(){$(this).addClass("tab-check").siblings().removeClass("tab-check");var tabIndex=$(this).index();$(".receipt-alert .tab-info").hide().eq(tabIndex).show();$yt_alert_Model.getDivPosition($('#cost-apply-model'))})},raceAddList:function(tr){var code=$('.receipt-alert ul li.tab-check').attr('code');var form=$('.model-content[code="'+code+'"]');var is=$yt_valid.validForm(form);if(is){var companyName=form.find('#companyName').val();var witeOffCompany=form.find('#witeOffCompany option:selected').text();var openBank=form.find('#openBank').val();var accountNumber=form.find('#accountNumber').val();var companyMoney=form.find('#companyMoney').val();var contractRadio=form.find('.check .contractRadio').val();var contractRadioText='';if(contractRadio==1){contractRadioText='有'}else{contractRadioText='无'}var companySpecial=form.find('#companySpecial').val();var payeeName=form.find('#payeeName option:selected').text();var payeeVal=form.find('#payeeName option:selected').val();var personalTotal=form.find('#personalTotal').val();var witeOffPersonal=form.find("#witeOffPersonal option:selected").text();var personalWriteoff=form.find('.personal-writeoff-money').text();var cash=form.find('#cash').val();var officialCard=form.find('#officialCard').val();var transferAccounts=form.find('#transferAccounts').val();var payeeRadio=form.find('.check .payeeRadio').val();var payeeRadioText='';if(payeeRadio==1){payeeRadioText='有'}else{payeeRadioText='无'}var personalSpecial=form.find('#personalSpecial').val();var idCarkno=form.find('#idCarkno').val();var payeeBank=form.find('#payeeBank').val();var bankName=form.find('#bankName').val();var phoneNum=form.find('#phoneNum').val();var otherMoney=form.find('#otherMoney').val();var witeOffOther=form.find('#witeOffOther option:selected').text();var otherAllMoney=form.find('#otherAllMoney').val();var otherRadio=form.find('.check .otherRadio').val();var otherRadioText='';if(otherRadio==1){otherRadioText='有'}else{otherRadioText='无'}var otherSpecial=form.find('#otherSpecial').val();var trHtml='';var receMoney=paymentApply.getReceMsgMoney();var totalReceMoney=receMoney+paymentApply.rmoney(companyMoney)+paymentApply.rmoney(otherAllMoney);var sumMoney=paymentApply.rmoney($('#applySumMoney').text());if(totalReceMoney<=sumMoney){switch(code){case 'company':trHtml='<tr class="payee-unit-tr" witeOffCompany="'+witeOffCompany+'" companyName="'+companyName+'" openBank="'+openBank+'" accountNumber="'+accountNumber+'" companyMoney="'+companyMoney+'" contractRadio="'+contractRadio+'" companySpecial="'+companySpecial+'"><td class="com" value="Company">'+companyName+'</td><td>'+witeOffCompany+'</td><td style="text-align: right;" class="unitTotal">'+($yt_baseElement.fmMoney(companyMoney))+'</td><td>'+openBank+'</td><td>'+accountNumber+'</td><td value="'+contractRadio+'">'+contractRadioText+'</td><td>'+companySpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(trHtml)}else{$('.rece-msg table[code="'+code+'"] tbody .payee-unit-total').before(trHtml)}paymentApply.companyTotal();break;case 'personal':trHtml='<tr class="payee-personal-tr" payeeVal="'+payeeVal+'" payeeName="'+payeeName+'" personalTotal="'+personalTotal+'" witeOffPersonal="'+witeOffPersonal+'" personalWriteoff="'+personalWriteoff+'" cash="'+cash+'" officialCard="'+officialCard+'" transferAccounts="'+transferAccounts+'" payeeRadio="'+payeeRadio+'" personalSpecial="'+personalSpecial+'" idCarkno="'+idCarkno+'" payeeBank="'+payeeBank+'" bankName="'+bankName+'" phoneNum="'+phoneNum+'"><td class="per" value="personal">'+payeeName+'</td><td style="text-align: right;" class="personalTotal">'+($yt_baseElement.fmMoney(personalTotal))+'</td><td>'+witeOffPersonal+'</td><td style="text-align: right;">'+personalWriteoff+'</td><td style="text-align: right;">'+cash+'</td><td style="text-align: right;">'+officialCard+'</td><td style="text-align: right;">'+transferAccounts+'</td><td><a class="yt-link">详情</a></td><td>'+payeeRadioText+'</td><td>'+personalSpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';if(tr){tr.replaceWith(trHtml)}else{$('.rece-msg table[code="'+code+'"] tbody .payee-personal-total').before(trHtml)}paymentApply.personalTotal();break;case 'other':trHtml='<tr class="payee-other-tr" witeOffOther="'+witeOffOther+'" otherMoney="'+otherMoney+'" otherAllMoney="'+otherAllMoney+'" otherRadio="'+otherRadio+'" otherSpecial="'+otherSpecial+'"><td class="oth" value="Other">'+otherMoney+'</td><td>'+witeOffOther+'</td><td style="text-align: right;" class="otherTotal">'+($yt_baseElement.fmMoney(otherAllMoney))+'</td><td>'+otherRadioText+'</td><td>'+otherSpecial+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(trHtml)}else{$('.rece-msg table[code="'+code+'"] tbody .payee-other-total').before(trHtml)}paymentApply.otherTotal();break;default:break}paymentApply.clearAlterTable();$yt_baseElement.tableRowActive()}else{$yt_alert_Model.prompt('金额不能大于申请付款总金额')}}},alertReceivables:function(){$("#appendPaymentInfo").click(function(){paymentApply.raceAddList();})},updataPersonal:function(){$(".payee-unit tbody").on("click",".operate-update",function(){var ithis=$(this);var tr=ithis.parents('tr');var table=ithis.parents('table');var code=table.attr('code');$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();$('#witeOffCompany').val(tr.attr('witeOffCompany'));$('#companyName').val(tr.attr('companyName'));$('#openBank').val(tr.attr('openBank'));$('#accountNumber').val(tr.attr('accountNumber'));$('#companyMoney').val(tr.attr('companyMoney'));var contractRadio=tr.attr('contractRadio');$('.companyCheck .check-label input[value="'+contractRadio+'"]').setRadioState('check');$('#companySpecial').val(tr.attr('companySpecial'));paymentApply.alertClearReceivables();$('#appendPaymentInfo').off().on('click',function(){paymentApply.raceAddList(tr)}).text('确定')})},updataReceivables:function(){$(".payee-personal tbody").on("click",".operate-update",function(){$("#appendPaymentInfo").text('确定');var ithis=$(this);var tr=ithis.parents('tr');var table=ithis.parents('table');var code=table.attr('code');$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();paymentApply.getPayeeNameList(tr.attr('payeeVal'));$('#personalTotal').val(tr.attr('personalTotal'));$('#witeOffPersonal').val(tr.attr('witeOffPersonal'));$('.personal-writeoff-money').val(tr.attr('personalWriteoff'));$('#cash').val(tr.attr('cash'));$('#officialCard').val(tr.attr('officialCard'));$('#transferAccounts').val(tr.attr('transferAccounts'));$('#idCarkno').val(tr.attr('idCarkno'));$('#payeeBank').val(tr.attr('payeeBank'));$('#bankName').val(tr.attr('bankName'));$('#phoneNum').val(tr.attr('phoneNum'));var payeeRadio=tr.attr('payeeRadio');$('.personalCheck .check-label input[value="'+payeeRadio+'"]').setRadioState('check');$('#personalSpecial').val(tr.attr('personalSpecial'));paymentApply.alertClearReceivables();$('#appendPaymentInfo').off().on('click',function(){paymentApply.raceAddList(tr)})})},updataOther:function(){$(".payee-other tbody").on("click",".operate-update",function(){$("#appendPaymentInfo").text('确定');var ithis=$(this);var tr=ithis.parents('tr');var table=ithis.parents('table');var code=table.attr('code');$(".receipt-alert .cost-type-tab ul li").removeClass("tab-check");$('.receipt-alert .cost-type-tab ul li[code="'+code+'"]').addClass('tab-check');$('.receipt-alert .tab-info').hide();$('.model-content[code="'+code+'"]').parent().show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#cost-apply-model'));$('#pop-modle-alert').show();$('#cost-apply-model').show();$('#otherMoney').val(tr.attr('otherMoney'));$('#witeOffOther').val(tr.attr('witeOffOther'));$('#otherAllMoney').val(tr.attr('otherAllMoney'));var otherRadio=tr.attr('otherRadio');$('.otherCheck .check-label input[value="'+otherRadio+'"]').setRadioState('check');$('#otherSpecial').val(tr.attr('otherSpecial'));paymentApply.alertClearReceivables();$('#appendPaymentInfo').off().on('click',function(){paymentApply.raceAddList(tr)}).text('确定')})},clearAlterTable:function(){sysCommon.closeModel($("#cost-apply-model"));paymentApply.clearAlert($(".model-content"))},appendGeneralList:function(tr){var me=this;var MoneyUse=$('#MoneyUse').val();var addMoney=$('#addMoney').val();if(MoneyUse&&addMoney){var num=$yt_baseElement.rmoney(addMoney);var html='<tr MoneyUse="'+MoneyUse+'" num="'+num+'"  class=""> <td class="" style="text-align: left;">'+MoneyUse+'</td> <td class="paydet-money" style="text-align: right;" class="">'+($yt_baseElement.fmMoney(addMoney))+'</td> <td> <span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span> <span class="operate-del" style=""><img src="../../../../../resources-sasac/images/common/del-icon.png"></span> </td> </tr>';if(tr){tr.replaceWith(html)}else{$('#paymentDetailedTable tbody .pay-detail-tabel-total').before(html)}paymentApply.paymentTotal();me.hideGeneralAlert();me.clearAlert($('.general-alert'))}else{$yt_alert_Model.prompt('请填写完整数据')}},paymentTotal:function(){var tds=$('#paymentDetailedTable tbody .paydet-money');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$('#applySumMoney').text(fmTotal);$('#applyMoneyLower').text(arabiaToChinese(fmTotal));$yt_baseElement.fmMoney($('#paymentDetailedTable tbody .total-money').text(fmTotal))},companyTotal:function(){var tds=$('.payee-unit tbody .unitTotal');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('.payee-unit tbody .payee-unit-money').text(fmTotal))},personalTotal:function(){var tds=$('.payee-personal tbody .personalTotal');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);},otherTotal:function(){var tds=$('.payee-other tbody .otherTotal');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('.payee-other tbody .payee-other-total-money').text(fmTotal))},addListEvent:function(){var me=this;$('#addPayment').click(function(){me.showGeneralAlert();$('.general-common').off().on('click',function(){me.appendGeneralList()}).text('添加到列表')});$('.general-cancel').click(function(){me.hideGeneralAlert();me.clearAlert($('.general-alert'))});$('#paymentDetailedTable').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var cont=$('#MoneyUse').val(tr.attr('MoneyUse'));var sum=$('#addMoney').val(tr.attr('num'));me.showGeneralAlert();$('.general-common').off().on('click',function(){me.appendGeneralList(tr)}).text('确定')})},hideGeneralAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.general-alert').hide();$('#pop-modle-alert').hide()},resetBtn:function(){$('#special-resetting').click(function(){paymentApply.clearAlert($(".pecial-name-window"))});$('#approval-resetting').click(function(){paymentApply.clearAlert($(".prior-alert"))})},clearAlert:function(obj){var inputs=obj.find('input:not(.notClearRadio)');var textbig=obj.find('textarea');var valid=obj.find('.valid-font');$('.general-alert input').removeClass('valid-hint');$('.model-content input').removeClass('valid-hint');valid.text('');inputs.val('');textbig.val('');$('#contractRadio-yes').setRadioState('check');$('#payeeRadio-yes').setRadioState('check');$('#otherRadio-yes').setRadioState('check');var selects=obj.find('select');$.each(selects,function(i,n){$(n).find('option:first-child').attr('selected',true)});selects.niceSelect()},moneyFormat:function(){$("#companyMoney,#payeeMoney,#otherAllMoney,#addMoney,#personalTotal,#cash,#officialCard,#transferAccounts").on("focus",function(){if($(this).val()!=""){$(this).val($yt_baseElement.rmoney($(this).val()))}});$("#companyMoney,#payeeMoney,#otherAllMoney,#addMoney,#personalTotal,#cash,#officialCard,#transferAccounts").on("blur",function(){if($(this).val()!=""){$(this).val($yt_baseElement.fmMoney($(this).val()))}})},submitPayment:function(){$('#submitPayment').off().on("click",function(){var thisBtn=$(this);$(this).attr('disabled',true).addClass('btn-disabled');var validFlag=$yt_valid.validForm($('.base-info-form-modle,.payee-appenddix'));if(validFlag){var receMoney=paymentApply.getReceMsgMoney();var sumMoney=paymentApply.rmoney($('#applySumMoney').text());if(receMoney>sumMoney){$('.rece-msg-text').show()}else{$('.rece-msg-text').hide();var data=paymentApply.getSubData();paymentApply.submitPaymentAppInfo(data,thisBtn)}}else{sysCommon.pageToScroll($(".ordinary-div .valid-font"));$(this).attr('disabled',false).removeClass('btn-disabled')}})},savePayment:function(){$('#savePayment').off().on("click",function(){var thisBtn=$(this);$(this).attr('disabled',true).addClass('btn-disabled');var data=paymentApply.getSubData();paymentApply.savePayAppInfoToDrafts(data,thisBtn)})},submitPaymentAppInfo:function(subData,thisBtn){$.ajax({type:'post',url:'sz/payApp/submitPaymentAppInfo',data:subData,success:function(data){if(data.flag==0){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/expensesReim/module/approval/myApplyList.html'}})};$yt_alert_Model.prompt(data.message);thisBtn.attr('disabled',false).removeClass('btn-disabled')}})},savePayAppInfoToDrafts:function(subData,thisBtn){$.ajax({type:'post',url:'sz/payApp/savePayAppInfoToDrafts',data:subData,success:function(data){if(data.flag==0){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/expensesReim/module/approval/draftsList.html'}})}$yt_alert_Model.prompt(data.message);$(this).attr('disabled',false).removeClass('btn-disabled')}})},getPayAppInfoByPayAppId:function(payAppId){var me=this;$.ajax({type:"post",url:"sz/payApp/getPayAppInfoByPayAppId",async:true,data:{payAppId:payAppId},success:function(data){if(data.flag==0){var d=data.data;if(d.taskKey=='activitiStartTask'){$('#savePayment').remove()}me.setFormData(d)}}})},showBusinessFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();$('.business-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/payment/ordinaryPaymentApply.html')},showGeneralFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/payment/ordinaryPaymentApply.html')},showTravelFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();$('.travel-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/payment/ordinaryPaymentApply.html')},showTrainFun:function(){var me=this;$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/beforehand/trainingFeeApply.html');if($('.prior-approval').val()){$('.index-main-div .export-but').show();paymentApply.getAdvanceAppInfoDetailByAdvanceAppId(paymentApply.saveData.advanceAppId||'',true)}$('#exportTraining').click(function(){var list=me.beforeCostList.costData.trainApplyInfoList;me.setTrainApplyInfoList(list)});$('#exportLecturer').click(function(){var list=me.beforeCostList.costData.teacherApplyInfoList;me.setTeacherApplyInfoList(list)});$('#exportCostApp').click(function(){var data=me.beforeCostList.costData;me.setCostTrainApplyInfoList(data.costTrainApplyInfoList);me.setCostTeachersFoodApplyInfoList(data.costTeachersFoodApplyInfoList);me.setCostTeachersLectureApplyInfoList(data.costTeachersLectureApplyInfoList);me.setCostTeachersTravelApplyInfoList(data.costTeachersTravelApplyInfoList);me.setCostTeachersHotelApplyInfoList(data.costTeachersHotelApplyInfoList);personnelFunds.updateTotalNum();})},showMettingFun:function(){$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();},getCostTypeList:function(code){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByFormCode",async:true,data:{formAppCode:'PAYMENT_APP'},success:function(data){var list=data.data||[];var opts='<option value="">请选择</option>';$.each(list,function(i,n){if(code&&code==n.costCode){opts+='<option selected="selected" fun="'+n.jsFun+'" value="'+n.costCode+'">'+n.costName+'</option>'}else{opts+='<option fun="'+n.jsFun+'" value="'+n.costCode+'">'+n.costName+'</option>'}});$('#getvalue').html(opts).niceSelect()}})},setFormData:function(d){var me=this;if(d.jsFun){me[d.jsFun]()}me.saveData.payAppId=d.payAppId;me.saveData.processInstanceId=d.processInstanceId;me.saveData.advanceAppId=d.advanceAppId;me.saveData.advanceAppNum=d.advanceAppNum;me.saveData.paymentAppNum=d.paymentAppNum;$('#form-num').text(d.paymentAppNum);$('#advanceAppReason').val(d.paymentAppName);$('.prior-approval').val(d.advanceAppNum);me.saveData.specialCode=d.specialCode;if(d.advanceAppNum){$('#advanceAppBalance').text(d.advanceAppBalance?me.fmMoney(d.advanceAppBalance)+'万元':'--');$('.advance-relevance').show()}var specialCodeArr=d.specialCode.split(',');var specialNameArr=d.specialName.split('-');me.setBudgetItme(specialCodeArr);$('#invoiceNum').val(d.invoiceNum);$('#applySumMoney').text(me.fmMoney(d.totalAmount));$('#applyMoneyLower').text(arabiaToChinese(d.totalAmount+''));$('#fuData').text(d.applicantTime);me.getCostTypeList(d.costType);me.showFileList(d.attList);me.setDataListTable(d.costData);me.setReceiptListTable(d.payReceivablesData)},showFileList:function(list){var ls='';$.each(list,function(i,n){ls+='<div fId="'+n.attId+'" class="li-div"><span>'+n.attName+'</span><span class="del-file">x</span></div>'});$('#attIdStr').html(ls)},getSubData:function(){var me=this;var saveData=me.saveData;var rMoney=$yt_baseElement.rmoney;var specialCode=function(){var code='';$('select.budget-item-one,select.budget-item-two,select.budget-item-three').each(function(i,n){var val=$(this).find('option:selected').val();if(val){code+=val+','}});code=(code.substring(code.length-1)==',')?code.substring(0,code.length-1):code;return code};return{payAppId:saveData.payAppId||'',paymentAppNum:saveData.paymentAppNum||'',paymentAppName:$('#advanceAppReason').val(),advanceAppId:me.saveData.advanceAppId,advanceAppNum:saveData.advanceAppNum,costType:$('#getvalue option:selected').val(),specialCode:saveData.specialCode||'',prjCode:'',prjName:$('#prjName').val(),specialCode:specialCode(),invoiceNum:$('#invoiceNum').val(),totalAmount:me.rmoney($('#applySumMoney').text()),attIdStr:me.getFileList(),applicantUser:saveData.applicantUser||'',parameters:'',dealingWithPeople:$('#approve-users option:selected').val(),opintion:$('#opintion').val(),processInstanceId:saveData.processInstanceId||'',nextCode:$('#operate-flow').val(),costData:me.getCostDataJson(),payReceivablesData:me.payReceivablesData(),billingVoucherList:me.billingVoucherList(),payDetailList:me.payDetailList()}},payReceivablesData:function(){var me=this;return JSON.stringify({gatheringUnitList:me.gatheringUnitList(),gatheringPersonList:me.gatheringPersonList(),gatheringOtherList:me.gatheringOtherList()})},gatheringUnitList:function(){var list=[];var trs=$('table.payee-unit tbody tr:not(.payee-unit-total)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({unitName:tr.attr('companyname'),openBank:tr.attr('openbank'),accounts:tr.attr('accountnumber'),amount:paymentApply.rmoney(tr.attr('companymoney')),isContract:tr.attr('contractradio'),remarks:tr.attr('companyspecial'),setMethod:''})});return list},gatheringPersonList:function(){var list=[];var trs=$('table.payee-personal tbody tr:not(.payee-personal-total)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({personalName:tr.attr('payeename'),idCard:tr.attr('idcarkno'),phoneNum:tr.attr('phonenum'),openBank:tr.attr('payeebank'),accounts:tr.attr('bankname'),amount:paymentApply.rmoney(tr.attr('payeemoney')),isContract:tr.attr('payeeradio'),remarks:tr.attr('personalspecial'),setMethod:''})});return list},gatheringOtherList:function(){var list=[];var trs=$('table.payee-other tbody tr:not(.payee-other-total)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({otherName:tr.attr('othermoney'),amount:paymentApply.rmoney(tr.attr('otherallmoney')),isContract:tr.attr('otherradio'),remarks:tr.attr('otherspecial'),setMethod:''})});return list},billingVoucherList:function(){var list=[];var trs=$('.msg-list tbody tr');var tr=null;return JSON.stringify(list)},payDetailList:function(){var list=[];var trs=$('.msg-list tbody tr');var tr=null;return JSON.stringify(list)},getCostDataJson:function(){var me=this;return JSON.stringify({costReceptionistList:me.costReceptionistList(),costDetailsList:me.costDetailsList(),travelRouteList:me.tripPlanList(),costCarfareList:me.carfareList(),costHotelList:me.hotelList(),costOtherList:me.otherList(),costSubsidyList:me.costSubsidyList(),trainApplyInfoList:me.trainApplyInfoList(),teacherApplyInfoList:me.teacherApplyInfoList(),costTrainApplyInfoList:me.costTrainApplyInfoList(),costTeachersFoodApplyInfoList:me.costTeachersFoodApplyInfoList(),costTeachersLectureApplyInfoList:me.costTeachersLectureApplyInfoList(),costTeachersTravelApplyInfoList:me.costTeachersTravelApplyInfoList(),costTeachersHotelApplyInfoList:me.costTeachersHotelApplyInfoList(),costNormalList:me.costNormalList()})},getFileList:function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length-1?',':'')});return str},costReceptionistList:function(){var list=[];var trs=$('.msg-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costReceptionistId:tr.attr('pkId'),name:tr.find('.name').text(),jobName:tr.find('.jobName').text(),unitName:tr.find('.DutiesName').text(),})});return list},costDetailsList:function(){var list=[];var trs=$('#paymentList tbody tr:not(.last)');var tr=null;var setMethod=$('#paymentList').next().find('.check-label.check input').val();$.each(trs,function(i,n){tr=$(n);list.push({publicServiceProCode:tr.attr('Pcode'),activityDate:tr.find('.activityDate').text(),placeName:tr.find('.placeName').text(),costType:tr.attr('Tcode'),standardAmount:$yt_baseElement.rmoney(tr.find('.standardAmount').text()||'0'),activityAmount:$yt_baseElement.rmoney(tr.find('.money').text()||'0'),peopleNum:tr.find('.peopleNum').text(),setMethod:setMethod })});return list},tripPlanList:function(){var list=[];var trs=$('#tripList tbody tr:not(.last)');var tr=null;var setMethod=$('#tripList').next().find('.check-label.check input').val();$.each(trs,function(i,n){tr=$(n);list.push({travelType:tr.attr('busicode'),travelAddress:tr.find('.address').attr('val'),travelAddressName:tr.find('.address').text(),startTime:tr.find('.sdate').text(),endTime:tr.find('.edate').text(),travelPersonnels:tr.attr('usercode'),receptionCostItem:tr.attr('rececode'),setMethod:setMethod })});return list},carfareList:function(){var costCarfareList=[];var costCarfareJson="";var cityDatas;var setMethod=$('#traffic-list-info').next().find('.check-label.check input').val();if($("#traffic-list-info tbody tr:not(.total-last-tr)").length>0){$("#traffic-list-info tbody tr:not(.total-last-tr)").each(function(i,n){cityDatas=$(this).getDatas();cityDatas.crafare=$yt_baseElement.rmoney(cityDatas.crafare);cityDatas.setMethod=setMethod;if($(this).find(".hid-child-code").val()=="null"||$(this).find(".hid-child-code").val()==""){cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."}else{cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."+$(this).find(".hid-child-code").val()+"."}costCarfareList.push(cityDatas)})}return costCarfareList},hotelList:function(){var costHotelList=[];var costHotelJson="";var hotelDatas;var setMethod=$('#hotel-list-info').next().find('.check-label.check input').val();if($("#hotel-list-info tbody tr:not(.total-last-tr)").length>0){$("#hotel-list-info tbody tr:not(.total-last-tr)").each(function(i,n){hotelDatas=$(this).getDatas();hotelDatas.hotelExpense=$yt_baseElement.rmoney(hotelDatas.hotelExpense);hotelDatas.setMethod=setMethod;costHotelList.push(hotelDatas)});if(costHotelList.length>0){costHotelJson=JSON.stringify(costHotelList)}}return costHotelList},otherList:function(){var costOtherList=[];var costOtherJson="";var otherDatas;var setMethod=$('#other-list-info').next().find('.check-label.check input').val();if($("#other-list-info tbody tr:not(.total-last-tr)").length>0){$("#other-list-info tbody tr:not(.total-last-tr)").each(function(i,n){otherDatas=$(this).getDatas();otherDatas.reimAmount=$yt_baseElement.rmoney(otherDatas.reimAmount);otherDatas.setMethod=setMethod;costOtherList.push(otherDatas)});if(costOtherList.length>0){costOtherJson=JSON.stringify(costOtherList)}}return costOtherList},costSubsidyList:function(){var list=[];var trs=$('#subsidy-list-info tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelPersonnel:tr.find('.user').attr('code'),subsidyDays:tr.find('.subsidy-num').text(),subsidyFoodAmount:$yt_baseElement.rmoney(tr.find('.food').text()),carfare:$yt_baseElement.rmoney(tr.find('.traffic').text()),setMethod:''})});return list},trainApplyInfoList:function(){var list=[];var trs=$('#trainingPopTable tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({trainType:tr.attr('trainType'),regionCode:tr.find('.trainingAddrVal').val(),regionName:tr.find('.trainingAddr').text(),reportTime:tr.find('.trainingReportDate').text(),endTime:tr.find('.trainingEndingDate').text(),trainDays:tr.find('.trainingDay').text(),trainOfNum:tr.find('.trainingPerNumber').text()})});return list},teacherApplyInfoList:function(){var list=[];var trs=$('#lecturerTable tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val()})});return list},costTrainApplyInfoList:function(){var list=[];var trs=$('#trainingFeeTable tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({trainAmount:paymentApply.rmoney(tr.find('.training-total').text()),trainType:'',trainDays:tr.find('.day').text(),trainOfNum:tr.find('.num').text(),averageMoney:paymentApply.rmoney(tr.find('.avg').text()),setMethod:''})});return list},costTeachersFoodApplyInfoList:function(){var list=[];var trs=$('#dietFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),averageMoney:paymentApply.rmoney(tr.find('.avg').text()),foodOfDays:tr.find('.day').text(),foodAmount:paymentApply.rmoney(tr.find('.sum-pay').text()),remarks:tr.find('.dec').text(),setMethod:''})});return list},costTeachersLectureApplyInfoList:function(){var list=[];var trs=$('#lectureFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),courseName:tr.find('.cname').text(),teachingHours:tr.find('.hour').text(),perTaxAmount:paymentApply.rmoney(tr.find('.sum-pay').text()),afterTaxAmount:paymentApply.rmoney(tr.find('.after').text()),averageMoney:paymentApply.rmoney(tr.find('.avg').text()),remarks:tr.find('.lectureId').val(),setMethod:''})});return list},costTeachersTravelApplyInfoList:function(){var list=[];var trs=$('#carFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),goTime:tr.find('.sdate').text(),arrivalTime:tr.find('.edate').text(),goAddress:tr.find('.scode').val(),goAddressName:tr.find('.sadd').text(),arrivalAddress:tr.find('.ecode').val(),arrivalAddressName:tr.find('.eadd').text(),vehicle:tr.find('.tool').val(),carfare:paymentApply.rmoney(tr.find('.sum-pay').text()),remarks:tr.find('.dec').text(),setMethod:'',})});return list},costTeachersHotelApplyInfoList:function(){var list=[];var trs=$('#hotelFeeTable tbody tr:not(.end-tr)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({lecturerId:tr.find('.lectureId').val(),startTime:tr.find('.sdate').text(),endTime:tr.find('.edate').text(),hotelDays:tr.find('.day').text(),hotelAddress:'',hotelAddressName:'',hotelExpense:paymentApply.rmoney(tr.find('.sum-pay').text()),averageMoney:paymentApply.rmoney(tr.find('.avg').text()),remarks:tr.find('.dec').text(),setMethod:''})});return list},costNormalList:function(){var list=[];var tr=null;var trs=$('.ordinary-payment #paymentDetailedTable tbody tr:not(.pay-detail-tabel-total)');;$.each(trs,function(i,n){tr=$(n);list.push({normalId:'',normalName:tr.find(".ordinar-name").text(),normalAmount:$yt_baseElement.rmoney(tr.find(".paydet-money").text())})});return list},setDataListTable:function(data){var me=this;me.setTrainApplyInfoList(data.trainApplyInfoList);me.setTeacherApplyInfoList(data.teacherApplyInfoList);me.setCostTrainApplyInfoList(data.costTrainApplyInfoList);me.setCostTeachersFoodApplyInfoList(data.costTeachersFoodApplyInfoList);me.setCostTeachersLectureApplyInfoList(data.costTeachersLectureApplyInfoList);me.setCostTeachersTravelApplyInfoList(data.costTeachersTravelApplyInfoList);me.setCostTeachersHotelApplyInfoList(data.costTeachersHotelApplyInfoList);me.setCostNormalList(data.costNormalList)},setReceiptListTable:function(data){var me=this;me.setGatheringUnitList(data.gatheringUnitList);me.setGatheringPersonList(data.gatheringPersonList);me.setGatheringOtherList(data.gatheringOtherList)},setGatheringUnitList:function(list){var html='';$.each(list,function(i,n){html+='<tr class="payee-unit-tr" companyName="'+n.unitName+'" openBank="'+n.openBank+'" accountNumber="'+n.accounts+'" companyMoney="'+n.amount+'" contractRadio="'+n.isContract+'" companySpecial="'+n.remarks+'"><td class="com" value="Company">'+n.unitName+'</td><td style="text-align: left;">'+n.openBank+'</td><td style="text-align: left;">'+n.accounts+'</td><td style="text-align: right;" class="unitTotal">'+(paymentApply.fmMoney(n.amount))+'</td><td value="'+n.isContract+'">'+(n.isContract=='1'?'是':'否')+'</td><td>'+n.remarks+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('table.payee-unit tbody .payee-unit-total').before(html);paymentApply.companyTotal()},setGatheringPersonList:function(list){var html='';$.each(list,function(i,n){html+='<tr class="payee-personal-tr" payeeName="'+n.personalName+'" idCarkno="'+n.idCard+'" payeeMoney="'+n.amount+'" payeeBank="'+n.accounts+'" bankName="'+n.openBank+'" phoneNum="'+n.phoneNum+'" payeeRadio="'+n.isContract+'" personalSpecial="'+n.remarks+'"><td class="per" value="personal">'+n.personalName+'</td><td>'+n.idCard+'</td><td style="text-align: right;" class="personalTotal">'+(paymentApply.fmMoney(n.amount))+'</td><td>'+n.accounts+'</td><td>'+n.openBank+'</td><td>'+n.phoneNum+'</td><td>'+(n.isContract=='1'?'是':'否')+'</td><td>'+n.remarks+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>'});$('table.payee-personal tbody .payee-personal-total').before(html);paymentApply.personalTotal()},setGatheringOtherList:function(list){var html='';$.each(list,function(i,n){html+='<tr class="payee-other-tr" otherMoney="'+n.otherName+'" otherAllMoney="'+n.amount+'" otherRadio="'+n.isContract+'" otherSpecial="'+n.remarks+'"><td class="oth" value="Other">'+n.otherName+'</td><td style="text-align: right;" class="otherTotal">'+(paymentApply.fmMoney(n.amount))+'</td><td>'+(n.isContract=='1'?'是':'否')+'</td><td>'+n.remarks+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('table.payee-other tbody .payee-other-total').before(html);paymentApply.otherTotal()},setTrainApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr pid="'+n.trainAppId+'" trainType="'+n.trainType+'"><td class="trainingClasses">'+n.trainTypeName+'</td><td class="trainingAddr"><input type="hidden" class="trainingAddrVal" value="'+n.regionCode+'">'+n.regionName+'</td><td class="trainingReportDate">'+n.reportTime+'</td><td class="trainingEndingDate">'+n.endTime+'</td><td class="trainingDay">'+n.trainDays+'</td><td class="trainingPerNumber">'+n.trainOfNum+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#trainingPopTable tbody').append(html)},setTeacherApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr><td class="lecturerName"><input type="hidden" class="lectureId" value="'+n.lecturerId+'"><span>'+n.lecturerName+'</span></td><td class="professional">'+n.lecturerTitleName+'</td><td class="level">'+n.lecturerLevelName+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#lecturerTable tbody').html(html)},setCostTrainApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr pid="'+n.teachersTrainId+'"><td class="day">'+n.trainDays+'</td><td class="num">'+n.trainOfNum+'</td><td class="moneyText avg">'+paymentApply.fmMoney(n.averageMoney)+'</td><td class="moneyText training-total">'+paymentApply.fmMoney(n.trainAmount)+'</td><td><input type="hidden" class="popM" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>'});$('#trainingFeeTable tbody').append(html)},setCostTeachersFoodApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.foodId+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="avg">'+paymentApply.fmMoney(n.averageMoney)+'</td><td class="day">'+n.foodOfDays+'</td><td class="moneyText sum-pay">'+paymentApply.fmMoney(n.foodAmount)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td><input type="hidden" class="popM" value="4"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.foodAmount});$('#dietFeeTable tbody .end-tr').before(html);$('#dietFeeTable tbody .costTotal').text(paymentApply.fmMoney(total))},setCostTeachersLectureApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersLectureId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="holder">'+n.lecturerTitleName+'</td><td class="hour">'+n.teachingHours+'</td><td class="cname">'+n.courseName+'</td><td class="moneyText sum-pay">'+paymentApply.fmMoney(n.perTaxAmount)+'</td><td class="moneyText after">'+paymentApply.fmMoney(n.afterTaxAmount)+'</td><td class="moneyText avg">'+paymentApply.fmMoney(n.averageMoney)+'</td><td><input type="hidden" class="popM" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.perTaxAmount});$('#lectureFeeTable tbody .end-tr').before(html);$('#lectureFeeTable tbody .costTotal').text(paymentApply.fmMoney(total))},setCostTeachersTravelApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersTravelId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="ulv">'+n.lecturerLevelName+'</td><td class="sdate">'+n.goTime+'</td><td class="edate">'+n.arrivalTime+'</td><td class="sadd"><input type="hidden" class="scode" value="'+n.goAddress+'">'+n.goAddressName+'</td><td class="eadd"><input type="hidden" class="ecode" value="'+n.arrivalAddress+'">'+n.arrivalAddressName+'</td><td class="tname"><input type="hidden" class="tool" value="'+n.vehicle+'">'+n.vehicleName+'</td><td class="moneyText sum-pay">'+paymentApply.fmMoney(n.carfare)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td><input type="hidden" class="popM" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.carfare});$('#carFeeTable tbody .end-tr').before(html);$('#carFeeTable tbody .costTotal').text(paymentApply.fmMoney(total))},setCostTeachersHotelApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersHotelId+'" level="'+n.lecturerLevelName+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="moneyText avg">'+paymentApply.fmMoney(n.averageMoney)+'</td><td class="day">'+n.hotelDays+'</td><td class="moneyText sum-pay">'+paymentApply.fmMoney(n.hotelExpense)+'</td><td style="text-align: left !important;" class="dec">'+n.remarks+'</td><td><input type="hidden" class="popM" value="3"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.hotelExpense});$('#hotelFeeTable tbody .end-tr').before(html);$('#hotelFeeTable tbody .costTotal').text(paymentApply.fmMoney(total))},setCostNormalList:function(list){var html='';var total=0;$.each(list,function(i,n){html+=' <tr class="yt-tab-row"> <td style="text-align:left;" class="ordinar-name">'+n.normalName+'</td> <td style="text-align: right;" class="paydet-money">'+($yt_baseElement.fmMoney(n.normalAmount))+'</td> <td> <span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span> <span class="operate-del" style=""><img src="../../../../../resources-sasac/images/common/del-icon.png"></span> </td> </tr>';total+= +n.normalAmount});$('.ordinary-payment #paymentDetailedTable tbody .pay-detail-tabel-total').before(html);$('.ordinary-payment #paymentDetailedTable tbody .total-money').text($yt_baseElement.fmMoney(total))},getAdvanceAppInfoDetailByAdvanceAppId:function(id,updata){$.ajax({type:"post",url:"sz/advanceApp/getAdvanceAppInfoDetailByAdvanceAppId",async:true,data:{advanceAppId:id},success:function(data){if(data.flag==0){paymentApply.beforeCostList=data.data;if(!updata){paymentApply.exportBeforeFiles(data.data.attList)}}}})},exportBeforeFiles:function(files){var ls='';var src='';$('#attIdStr .export').remove();$.each(files,function(i,n){var imgType=n.attName.split('.');if(imgType.length>1&&(imgType[1]=='png'||imgType[1]=='jpeg'||imgType[1]=='bmp'||imgType[1]=='jpg')){src=$yt_option.base_path+'fileUpDownload/download?pkId='+n.attId+'&isDownload=false';ls+='<div fid="'+n.attId+'" class="li-div export"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pv">预览<img src="'+src+'" ></label></div>'}else{ls+='<div fid="'+n.attId+'" class="li-div export"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pvno">预览</label></div>'}});$('#attIdStr').append(ls);$('#attIdStr .file-dw').on('click',function(){var id=$(this).parent().attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'});$('#attIdStr .file-pv img').showImg()},setBudgetItme:function(arr){var me=this;var codeArr=arr?arr:[];var budgetOne=$('.budget-item-one');var budgetTwo=$('.budget-item-two');var budgetThree=$('.budget-item-three');var getBudgetCode=function(){$('select.budget-item-one,select.budget-item-two,select.budget-item-three').each(function(){})};$('div.budget-item-two').hide();$('div.budget-item-three').hide();me.getSpecialDictList($('select.budget-item-one'),'',function(list){var code=$('select.budget-item-one').find('option:selected').val();if(code){me.getSpecialDictList($('select.budget-item-two'),code,function(list){if(list.length>0){var twoCode=$('select.budget-item-two').find('option:selected').val();me.getSpecialDictList($('select.budget-item-three'),twoCode,function(list){if(list.length>0){var threeCode=$('select.budget-item-three').find('option:selected').val();me.getBudgetBalanceAmount(threeCode)}else{$('div.budget-item-three').hide();me.getBudgetBalanceAmount(twoCode)}},codeArr.length>2?codeArr[2]:'')}else{$('div.budget-item-two').hide();$('div.budget-item-three').hide()}},codeArr.length>1?codeArr[1]:'')}else{$('#codeMon').text('--');$('div.budget-item-two').hide();$('div.budget-item-three').hide()}},codeArr.length>0?codeArr[0]:'');$('select.budget-item-one').on('change',function(){var code=$(this).find('option:selected').val();if(code){me.getSpecialDictList($('select.budget-item-two'),code,function(list){if(list.length>0){var twoCode=budgetTwo.find('option:selected').val();me.getSpecialDictList($('select.budget-item-three'),twoCode,function(list){if(list.length>0){var threeCode=$('select.budget-item-three').find('option:selected').val();me.getBudgetBalanceAmount(threeCode)}else{$('div.budget-item-three').hide();me.getBudgetBalanceAmount(twoCode)}})}else{$('div.budget-item-two').hide();$('div.budget-item-three').hide()}})}else{$('#codeMon').text('--');$('div.budget-item-two').hide();$('div.budget-item-three').hide()}if(code=='SC_395'){$('.prj-name-tr').show()}else{$('.prj-name-tr').hide().val('')}});$('select.budget-item-two').on('change',function(){var code=$(this).find('option:selected').val();me.getSpecialDictList($('select.budget-item-three'),code,function(list){if(list.length>0){var threeCode=$('select.budget-item-three').find('option:selected').val();me.getBudgetBalanceAmount(threeCode)}else{$('div.budget-item-three').hide();me.getBudgetBalanceAmount(code)}})});$('select.budget-item-three').on('change',function(){var threeCode=$('select.budget-item-three').find('option:selected').val();me.getBudgetBalanceAmount(threeCode)})},getSpecialDictList:function(obj,parentCode,fun,code){obj.find('option').remove();$.ajax({type:"post",url:"budget/main/getSpecialDictList",async:true,data:{parentCode:parentCode},success:function(data){var list=data.data||[];var opts='';if(obj.hasClass('budget-item-one')){opts+='<option value="">请选择</option>'}if(data.flag==0&&list.length>0){$.each(list,function(i,n){if(code&&code==n.specialCode){opts+='<option selected="selected" value="'+n.specialCode+'">'+n.specialName+'</option>'}else{opts+='<option value="'+n.specialCode+'">'+n.specialName+'</option>'}});obj.html(opts).niceSelect()}else{}if(fun){fun(list)}}})},getBudgetBalanceAmount:function(specialCodeSeq){$.ajax({type:"post",url:"budget/main/getBudgetOtherBalanceAmount",async:true,data:{specialCodeSeq:specialCodeSeq},success:function(data){var mon=data.data;$('#codeMon').text(mon?$yt_baseElement.fmMoney(mon)+'万元':'--')}})},getReceMsgMoney:function(){var total=0;var unit=paymentApply.rmoney($('.payee-unit .payee-unit-money').text());var us=paymentApply.rmoney($('.payee-personal .payee-unit-money').text());var other=paymentApply.rmoney($('.payee-other .payee-unit-money').text());total=unit+us+other;return total},msgListEvent:function(){var me=this;$('.add-msg').click(function(){me.showMsgAlert();$('.msg-common').off().on('click',function(){me.appendMsgList()}).text('添加到列表')});$('.msg-cancel').click(function(){me.hideMsgAlert();me.clearAlert($('.msg-alert'))});$('.msg-list').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();me.resetNum($('.msg-list'))}})});$('.msg-list').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var nameVal=$('#nameVal').val(tr.attr('nameVal'));var dutyVal=$('#dutyVal').val(tr.attr('dutyVal'));var deptVal=$('#deptVal').val(tr.attr('deptVal'));me.showMsgAlert();$('.msg-common').off().on('click',function(){me.appendMsgList(tr)}).text('确定')})},appendMsgList:function(tr){var me=this;var nameVal=$('#nameVal').val();var dutyVal=$('#dutyVal').val();var deptVal=$('#deptVal').val();var html='<tr pkId="" class="" nameVal="'+nameVal+'" dutyVal="'+dutyVal+'" deptVal="'+deptVal+'"><td><span class="num">1</span></td><td><span class="name-text">'+nameVal+'</span></td><td><span class="job-text">'+dutyVal+'</span></td><td><span class="unit-text">'+deptVal+'</span></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(nameVal!=''&&dutyVal!=''&&deptVal!=''){if(tr){tr.replaceWith(html)}else{$('.msg-list').append(html)}me.hideMsgAlert();me.clearAlert($('.msg-alert'));me.resetNum($('.msg-list'))}else{$yt_alert_Model.prompt('请完整填写数据')}},updateMsgList:function(tr){},resetNum:function(obj){var trs=obj.find('tbody tr');$.each(trs,function(i,n){$(n).find('.num').text(i+1)})},showMsgAlert:function(){var alert=$('.msg-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideMsgAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.msg-alert').hide();$('#pop-modle-alert').hide()},paymentListEvent:function(){var me=this;$('#addProcuList').on('click',function(){me.showPaymentAlert();$('#paymentAddBtn').off().on('click',function(){me.appendPaymentList()}).text('添加到列表')});$('#paymentList').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove();me.getTotleMoney()}})});$('#paymentList').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var budgetProject=$('#budgetProject option[value="'+tr.attr('budgetcode')+'"]').attr('selected',true);var applyDate=$('#applyDate').val(tr.attr('applyDate'));var siteVal=$('#siteVal').val(tr.attr('siteVal'));var costBreakdown=$('#costBreakdown option[value="'+tr.attr('costcode')+'"]').attr('selected',true);var standardMoney=$('#standardMoney').val(tr.attr('standardMoney'));var budgetMoney=$('#budgetMoney').val(tr.attr('budgetMoney'));var accompanyNum=$('#accompanyNum').val(tr.attr('accompanyNum'));$('#budgetProject,#costBreakdown').niceSelect();me.showPaymentAlert();$('#paymentAddBtn').off().on('click',function(){me.appendPaymentList(tr)}).text('确定')});$('#paymentCanelBtn').on('click',function(){me.hidePaymentAlert();me.clearAlert($('#createDetali'))})},showPaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hidePaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.hideMongoliaLayer();alert.hide();$('#pop-modle-alert').hide()},appendPaymentList:function(tr){var me=this;var budgetProject=$('#budgetProject option:selected').text();var budgetCode=$('#budgetProject option:selected').val();var applyDate=$('#applyDate').val();var siteVal=$('#siteVal').val();var costBreakdown=$('#costBreakdown option:selected').text();var costCode=$('#costBreakdown option:selected').val();var standardMoney='';var stanMoney=$yt_baseElement.rmoney(standardMoney);var budgetMoney=$('#budgetMoney').val();var numMoney=$yt_baseElement.rmoney(budgetMoney);var accompanyNum=$('#accompanyNum').val();var html='<tr pkId="" budgetCode="'+budgetCode+'" costCode="'+costCode+'" budgetProject="'+budgetProject+'" applyDate="'+applyDate+'" siteVal="'+siteVal+'" costBreakdown="'+costBreakdown+'" standardMoney="'+standardMoney+'" budgetMoney="'+budgetMoney+'" accompanyNum="'+accompanyNum+'"><td><span class="">'+budgetProject+'</span></td><td><span class="act-date">'+applyDate+'</span></td><td><span class="place-name">'+siteVal+'</span></td><td><span>'+costBreakdown+'</span></td>'+'<td style="text-align: right;"><div class="money" money='+numMoney+'>'+budgetMoney+'</div></td><td><span class="people-num">'+accompanyNum+'</span></td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(budgetProject&&applyDate&&siteVal&&costBreakdown&&budgetMoney&&accompanyNum){if(tr){tr.replaceWith(html)}else{$('#paymentList tbody .last').before(html)}me.hidePaymentAlert();me.clearAlert($('#createDetali'));me.getTotleMoney()}else{$yt_alert_Model.prompt('请完整填写数据')}},getTotleMoney:function(){var tds=$('#paymentList tbody .money');var total=0;$.each(tds,function(i,n){total+= +$(n).attr('money')});var fmTotal=$yt_baseElement.fmMoney(total);$('#paymentList tbody .total-money').text(fmTotal);$('#applyTotalMoney').text(fmTotal).attr('num',total);$('#amountTotalMoney').text(fmTotal).attr('num',total);$('#TotalMoneyUpper').text(arabiaToChinese(fmTotal+''));var outstandingBalance=$yt_baseElement.rmoney($('#outstandingBalance').text());var writeOffAmount=total>=outstandingBalance?outstandingBalance:total;$('#writeOffAmount,#outWriteAmount').text($yt_baseElement.fmMoney(writeOffAmount));var replaceMoney=total>=outstandingBalance?total-writeOffAmount:0;if(replaceMoney<=0){$('#officialCard,#cash,#cheque').val('0').attr('disabled',true);$('.amount-table .total').text('0')}else{$('#officialCard,#cash,#cheque').attr('disabled',false)}$('#replaceMoney').text($yt_baseElement.fmMoney(replaceMoney));$('#balanceMoney').text($yt_baseElement.fmMoney(total<outstandingBalance?outstandingBalance-total:'0'))},setReimFundMoney:function(){var total=0;var outstandingBalance=serveFunds.rmoney($('#outstandingBalance').text());var writeOffAmount=total>=outstandingBalance?outstandingBalance:total;$('#writeOffAmount,#outWriteAmount').text(serveFunds.fmMoney(writeOffAmount));var replaceMoney=total>=outstandingBalance?total-writeOffAmount:0;if(replaceMoney<=0){$('#officialCard,#cash,#cheque').val('0').attr('disabled',true);$('.amount-table .total').text('0')}else{$('#officialCard,#cash,#cheque').attr('disabled',false)}$('#replaceMoney').text(serveFunds.fmMoney(replaceMoney));$('#balanceMoney').text(serveFunds.fmMoney(total<outstandingBalance?outstandingBalance-total:'0'))},getDictInfoByTypeCode:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:true,data:{dictTypeCode:'ACTIVITY_PRO,SPECIFIC_COST_TYPE,TRAVEL_TYPE,VEHICIE_CODE,HOTEL_ADDRESS,COST_TYPE'},success:function(data){var list=data.data||[];var start='<option value="">请选择</option>',optone=start,opttwo=start,travelType=start,vehicieCode=start,hotel=start,cost=start;$.each(list,function(i,n){if(n.dictTypeCode=='ACTIVITY_PRO'){optone+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='SPECIFIC_COST_TYPE'){opttwo+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='TRAVEL_TYPE'){travelType+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='VEHICIE_CODE'){vehicieCode+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='HOTEL_ADDRESS'){hotel+='<option value="'+n.value+'">'+n.disvalue+'</option>'}else if(n.dictTypeCode=='COST_TYPE'){cost+='<option value="'+n.value+'">'+n.disvalue+'</option>'}});$('#budgetProject').html(optone).niceSelect();$('#costBreakdown').html(opttwo).niceSelect();$('#modelBusiType').html(travelType).niceSelect();$('select.vehicle-sel').html(vehicieCode).on("change",function(){var selVal=$(this).val();sysCommon.vechicleChildData(selVal)}).niceSelect();$('select.cost-type-sel').html(cost).niceSelect()}})},getChoiceLoanList:function(code){$.ajax({type:"post",url:"sz/loanApp/getUserLoanAppInfoListToPageByParams",async:true,success:function(data){var list=data.data.rows||[];var opts='<option value="">请选择</option>';$.each(list,function(i,n){opts+='<option arrearsAmount="'+n.arrearsAmount+'" value="'+n.loanAppId+'">'+n.loanAppNum+'</option>'});$('#choiceLoan').html(opts).niceSelect()}})},getPayeeNameList:function(code){$.ajax({type:"post",url:"user/userInfo/getAllUserInfoToPage",async:true,success:function(data){var list=data.data.rows||[];var opts='<option value="">请选择</option>';$.each(list,function(i,n){if(code&&code==n.userItcode){opts+='<option selected="" value="'+n.userItcode+'">'+n.userName+'</option>'}else{opts+='<option value="'+n.userItcode+'">'+n.userName+'</option>'}});$('#payeeName').html(opts).niceSelect();$("select#payeeName").niceSelect({search:true,backFunction:function(text){$("select#payeeName option").remove();if(text==""){$("select#payeeName").append('<option value="">请选择</option>')}$.each(list,function(i,n){if(n.userName.indexOf(text)!=-1){$("select#payeeName").append('<option value="'+n.userItcode+'">'+n.userName+'</option>')}})}})}})},getArrearsAmount:function(){$("#choiceLoan").change(function(){var arrearsAmount=$("#choiceLoan").find("option:selected").attr("arrearsAmount");$(".arrears-money").text($yt_baseElement.fmMoney(arrearsAmount))});$("#witeOffPersonal").change(function(){var thischange=$("#witeOffPersonal").find("option:selected").val();if(thischange==1){$(".display-loan").show()}else{$(".display-loan").hide()}})}};$(function(){var pid=$yt_common.GetQueryString('payAppId');if(pid){paymentApply.getPayAppInfoByPayAppId(pid)}else{paymentApply.getCostTypeList();paymentApply.setBudgetItme()}$("select").niceSelect();sysCommon.getLoginUserInfo();sysCommon.getApproveFlowData("SZ_PAYMENT_APP");paymentApply.saveData.applicantUser=$yt_common.user_info.userName;paymentApply.payeeAppenddix();paymentApply.beforehandApply();paymentApply.befAlertclear();paymentApply.befAlertok();paymentApply.specialAlertclear();paymentApply.specialAlertok();paymentApply.specialApply();$yt_baseElement.tableRowActive();paymentApply.whetherSpecial();paymentApply.delPayment();paymentApply.delCompany();paymentApply.delPersonal();paymentApply.delOther();paymentApply.alertClearReceivables();paymentApply.alertReceivables();paymentApply.moneyFormat();paymentApply.updataReceivables();paymentApply.updataPersonal();paymentApply.updataOther();paymentApply.addListEvent();paymentApply.resetBtn();paymentApply.selectCost();paymentApply.submitPayment();paymentApply.savePayment();paymentApply.events();paymentApply.getChoiceLoanList();paymentApply.getArrearsAmount();paymentApply.getPayeeNameList()});