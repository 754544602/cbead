(function($,window){var serveExamine={init:function(){var ts=this;$('.approve-div').html(sysCommon.createFlowApproveMode());sysCommon.loadingWord('view/projectManagement-sasac/expensesReim/module/busiTripApply/serveTrainApproval.html');var pid=$yt_common.GetQueryString('appId');var fun=$yt_common.GetQueryString('fun');ts.getAdvanceUpdateAppInfoDetailByAdvanceAppId(pid);ts.start();ts.events()},start:function(){$('select').niceSelect();},events:function(){var me=this;$('.file-box').on('click','.del-file',function(){var ithis=$(this);var parent=ithis.parent();$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){parent.remove()}})});$('.money-input').on('focus',function(){var ts=$(this);if(ts.val()!=""){ts.val($yt_baseElement.rmoney(ts.val()))}});$('.money-input').on('blur',function(){var ts=$(this);if(ts.val()!=''){ts.val($yt_baseElement.fmMoney(ts.val()))}});$('.money-input').on('keyup',function(){var ts=$(this);if(ts.val()!=''){ts.val(ts.val().replace(/[^\d.]/g,''))}});$('#printBills').on('click',function(){var type='';var urlStr='';if(type=='TRAVEL_APPLY'){urlStr=$yt_option.websit_path+'view/system-sasac/expensesReim/module/print/printTravelExpenses.html'}else{urlStr=$yt_option.websit_path+'view/system-sasac/expensesReim/module/print/printSpendingForm.html'}var pageUrl=urlStr;var goPageUrl="view/system-sasac/expensesReim/module/approval/expenApplApprList.html";window.open($yt_option.websit_path+"index.html?pageUrl="+encodeURIComponent(pageUrl)+'&goPageUrl='+goPageUrl)});$('.amount-table .money-input').blur(function(){var body=$('.payment-detail .amount-table');var official=Number($yt_baseElement.rmoney(body.find('.official').val()||'0'));var cash=Number($yt_baseElement.rmoney(body.find('.cash').val()||'0'));var cheque=Number($yt_baseElement.rmoney(body.find('.cheque').val()||'0'));var transfer=Number($yt_baseElement.rmoney(body.find('.transfer').val()||'0'));var total=official+cash+cheque+transfer;body.find('.total').text($yt_baseElement.fmMoney(total));if($('.payroll-working').is(':visible')){body=$('.payroll-working .amount-table');var cmOfficialCard=$yt_baseElement.rmoney($('#cmOfficialCard').val()||'0');var cmCash=$yt_baseElement.rmoney($('#cmCash').val()||'0');var cmCheque=$yt_baseElement.rmoney($('#cmCheque').val()||'0');var cmTotal=cmOfficialCard+cmCash+cmCheque;var replaceMoney=$yt_baseElement.rmoney($('#cmReplaceMoney').text()||'0');if(replaceMoney>0&&total>replaceMoney){$(this).focus();$yt_alert_Model.prompt('金额不能大于补领金额金额')}else{var rtotal=me.fmMoney(cmTotal);body.find('.total').text(rtotal).attr('num',cmTotal)}}});$('#submitPayment').on('click',function(){var thisBtn=$(this);thisBtn.attr('disabled',true).addClass('btn-disabled');if($yt_valid.validForm($('.approve-div'))){var d={appId:me.saveData.advanceAppId,parameters:'',processInstanceId:me.saveData.processInstanceId,};d.dealingWithPeople=$('#approve-users option:selected').val();d.opintion=$('#opintion').val();d.nextCode=$('#operate-flow option:selected').val();console.log(d);me.submitReimAppInfo(d,thisBtn)}else{thisBtn.attr('disabled',false).removeClass('btn-disabled')}});me.tallyListEvent();$('.yt-table tbody').on('click','tr',function(){var ts=$(this);var trs=ts.siblings();trs.removeClass('yt-table-active');ts.addClass('yt-table-active')});me.financialPayment()},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},rmoney:function(str){return $yt_baseElement.rmoney(str||'0')},paymentListEvent:function(){var me=this;$('#addProcuList').on('click',function(){me.showPaymentAlert()});$("#paymentAddBtn").on('click',function(){var budgetProject=$('#budgetProject option:selected').text();var budgetMoney=$('#budgetMoney').val();var specialNum=$('#specialNum').text();var html='<tr> <td>'+budgetProject+'</td> <td style="text-align: right;">'+budgetMoney+'</td> <td>'+specialNum+'</td> <td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td> </tr>';$('#paymentList tbody').append(html);me.hidePaymentAlert()});$('#paymentList').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})});$('#paymentList').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');me.showPaymentAlert()});$('#paymentCanelBtn').on('click',function(){me.hidePaymentAlert()})},showPaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hidePaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.hideMongoliaLayer();alert.hide();$('#pop-modle-alert').hide()},serveExamineEvent:function(){$('.prior-approval').click(function(){$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('.prior-alert'));$('#pop-modle-alert').show();$('.prior-alert').show()});$('.prior-common').click(function(){var code=$('.prior-approval-list .yt-table-active').attr('code');if(code){$('.prior-approval').val(code);$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()}else{$yt_alert_Model.prompt('请选择一条数据')}});$('.prior-cancel').click(function(){$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()})},tallyListEvent:function(){var me=this;$('.add-tally').click(function(){me.showMsgAlert();$('.tally-common').off().on('click',function(){me.appendMsgList()}).text('添加到列表')});$('.tally-cancel').click(function(){me.hideMsgAlert();me.clearAlert($('.msg-alert'))});$('.tally-list').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})});$('.tally-list').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var loanType=$('#loanType option[value="'+tr.attr('loanCode')+'"]').attr('selected',true);var abstract=$('#abstract').val(tr.attr('abstract'));var totalSubject=$('#totalSubject').val(tr.attr('totalSubject'));var detailSubject=$('#detailSubject').val(tr.attr('detailSubject'));var tallyMoney=$('#tallyMoney').val(tr.attr('tallyMoney'));$('#loanType').niceSelect();me.showMsgAlert();$('.tally-common').off().on('click',function(){me.appendMsgList(tr)}).text('确定')})},appendMsgList:function(tr){var me=this;if($yt_valid.validForm($('.tally-alert'))){var loanType=$('#loanType option:selected').text();var loanCode=$('#loanType option:selected').val();var abstract=$('#abstract').val();var totalSubject=$('#totalSubject').val();var detailSubject=$('#detailSubject').val();var tallyMoney=$('#tallyMoney').val();var totalText='';var detailText='';if(loanType=='DEBIT_ENTRY'){totalText=tallyMoney}else{detailText=tallyMoney}var html='<tr pid="" class="" loanCode="'+loanCode+'" loanType="'+loanType+'" abstract="'+abstract+'" totalSubject="'+totalSubject+'" detailSubject="'+detailSubject+'" tallyMoney="'+tallyMoney+'"><td>'+abstract+'</td><td>'+totalSubject+'</td><td>'+detailSubject+'</td><td>'+totalText+'</td><td>'+detailText+'</td><td><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(html)}else{$('.tally-list').append(html)}me.hideMsgAlert();me.clearAlert($('.tally-alert'))}else{}},showMsgAlert:function(){var alert=$('.tally-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideMsgAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.tally-alert').hide();$('#pop-modle-alert').hide()},clearAlert:function(obj){var selects=obj.find('select');$.each(selects,function(i,n){$(n).find('option:first-child').attr('selected',true)});selects.niceSelect();var inputs=obj.find('input');inputs.val('')},getAdvanceUpdateAppInfoDetailByAdvanceAppId:function(advanceAppId){var me=this;$.ajax({type:"post",url:"sz/advanceAppUpdate/getAdvanceUpdateAppInfoDetailByAdvanceAppId",async:true,data:{advanceAppId:advanceAppId},success:function(data){var d=data.data;me.saveData=d;me.showDetail(d);if(d.taskKey=='activitiEndTask'){$('.payroll-working').show();$('#approve-users').attr("validform","{isNull:false,msg:'请选择审批人'}")}else{$('.payroll-working').hide();$('#submitPayment').text('提交');}$('.check-label').off('click');$('.check-label input').attr('disabled',true).off('click')}})},getCostAppInfoDetailByParams:function(appId,costType){var me=this;$.ajax({type:"post",url:"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{appId:appId,costType:costType},success:function(data){me.showCostDetail(data.data)}})},getReimPreviewDetailByReimAppId:function(reimAppId,previewFalg,qrCodeContext){var me=this;$.ajax({type:"post",url:"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{reimAppId:reimAppId,previewFalg:previewFalg,qrCodeContext:qrCodeContext},success:function(data){}})},getSubData:function(){var getFileList=function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length?',':'')});return str};var costReceptionistList=function(){var list=[];var trs=$('.msg-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costReceptionistId:tr.attr('pkId'),name:tr.find('.name-text').text(),jobName:tr.find('.job-text').text(),unitName:tr.find('.unit-text').text(),})});return list};var costDetailsList=function(){var list=[];var trs=$('#paymentList tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costDetailsId:tr.attr('pkId'),publicServiceProCode:tr.attr('budgetcode'),activityDate:tr.find('.act-date').text(),placeName:tr.find('.place-name').text(),costType:tr.attr('costcode'),standardAmount:tr.find('.stan-money').attr('money'),activityAmount:tr.find('.money').attr('money'),peopleNum:tr.find('.people-num').text(),setMethod:''})});return list};var tripPlanList=function(){var list=[];var trs=$('#tripList tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelType:tr.attr('busicode'),travelAddress:tr.find('.address').attr('val'),travelAddressName:tr.find('.address').text(),startTime:tr.find('.sdate').text(),endTime:tr.find('.edate').text(),travelPersonnels:tr.attr('usercode'),receptionCostItem:tr.attr('rececode'),setMethod:''})});return list};var carfareList=function(){var costCarfareList=[];var costCarfareJson="";var cityDatas;if($("#traffic-list-info tbody tr:not(.total-last-tr)").length>0){$("#traffic-list-info tbody tr:not(.total-last-tr)").each(function(i,n){cityDatas=$(this).getDatas();cityDatas.crafare=$yt_baseElement.rmoney(cityDatas.crafare);cityDatas.setMethod='';if($(this).find(".hid-child-code").val()=="null"||$(this).find(".hid-child-code").val()==""){cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."}else{cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."+$(this).find(".hid-child-code").val()+"."}costCarfareList.push(cityDatas)})}return costCarfareList};var hotelList=function(){var costHotelList=[];var costHotelJson="";var hotelDatas;if($("#hotel-list-info tbody tr:not(.total-last-tr)").length>0){$("#hotel-list-info tbody tr:not(.total-last-tr)").each(function(i,n){hotelDatas=$(this).getDatas();hotelDatas.hotelExpense=$yt_baseElement.rmoney(hotelDatas.hotelExpense);hotelDatas.setMethod='';costHotelList.push(hotelDatas)});if(costHotelList.length>0){costHotelJson=JSON.stringify(costHotelList)}}return costHotelList};var otherList=function(){var costOtherList=[];var costOtherJson="";var otherDatas;if($("#other-list-info tbody tr:not(.total-last-tr)").length>0){$("#other-list-info tbody tr:not(.total-last-tr)").each(function(i,n){otherDatas=$(this).getDatas();otherDatas.reimAmount=$yt_baseElement.rmoney(otherDatas.reimAmount);otherDatas.setMethod='';costOtherList.push(otherDatas)});if(costOtherList.length>0){costOtherJson=JSON.stringify(costOtherList)}}return costOtherList};var costSubsidyList=function(){var list=[];var trs=$('#subsidy-list-info tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelPersonnel:tr.find('.user').attr('code'),subsidyDays:tr.find('.subsidy-num').text(),subsidyFoodAmount:tr.find('.food').attr('num'),carfare:tr.find('.traffic').attr('num'),setMethod:''})});return list};var costData=function(){return JSON.stringify({costReceptionistList:costReceptionistList(),costDetailsList:costDetailsList(),travelRouteList:tripPlanList(),costCarfareList:carfareList(),costHotelList:hotelList(),costOtherList:otherList(),costSubsidyList:costSubsidyList()})};var billingVoucherJson=function(){var list=[];var trs=$('#tally-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({billingVoucherId:tr.attr('pid'),toLoanType:tr.attr('loancode'),abstracts:tr.attr('abstract'),ledger:tr.attr('totalsubject'),detailed:tr.attr('detailsubject'),amount:tr.attr('tallymoney')})});return JSON.stringify(list)};return{advanceAppId:$('#advanceAppId').val(),loanAppId:$('#loanAppId').val(),reimAppId:$('#reimAppId').val(),reimAppNum:$('#reimAppNum').val(),reimAppName:$('#reimAppName').attr('val'),costType:$('#costTypeName').attr('val'),specialCode:$('#specialName').attr('val'),invoiceNum:$('#invoiceNum').text(),totalAmount:$('#totalAmount').attr('num'),writeOffAmount:$yt_baseElement.rmoney($('#writeOffAmount').text()),officialCard:$yt_baseElement.rmoney($('#officialCard').text()),cash:$yt_baseElement.rmoney($('#cash').text()),cheque:$yt_baseElement.rmoney($('#cheque').text()),transfer:0,attIdStr:getFileList(),paymentDate:$('#paymentDate').val(),paymentAmount:$yt_baseElement.rmoney($('#paymentAmount').val()||'0'),cmTotalAmount:$yt_baseElement.rmoney($('#cmTotalAmount').text()||'0'),cmWriteOffAmount:$yt_baseElement.rmoney($('#cmWriteOffAmount').text()||'0'),cmOfficialCard:$yt_baseElement.rmoney($('#cmOfficialCard').val()||'0'),cmCash:$yt_baseElement.rmoney($('#cmCash').val()||'0'),cmCheque:$yt_baseElement.rmoney($('#cmCheque').val()||'0'),cmTransfer:0,applicantUser:$('#applicantUser').val(),parameters:'',dealingWithPeople:$('#approve-users option:selected').val(),opintion:$('#opintion').val(),processInstanceId:$('#processInstanceId').val(),nextCode:$('#operate-flow option:selected').val(),costData:[],billingVoucherJson:billingVoucherJson(),}},non:function(str){return(str?str:'--')},showDetail:function(d){var me=this;$('#formNum').text(me.non(d.advanceAppNum));$('#advanceAppNum').text(me.non(d.newAdvanceAppNum));$('#advanceAppName').text(me.non(d.advanceAppName));$('#specialName').text(me.non(d.specialName));if(d.prjName){$('.prj-name-tr').show();$('#prjName').text(me.non(d.prjName));}else{$('.prj-name-tr').hide()}$(".adj-before").text(me.fmMoney(d.taxChangeData.changeBeforeAmount||'0.00'));$(".adj-after").text(me.fmMoney(d.taxChangeData.changeAfterAmount||'0.00'));$(".remuneration-tax-total").text(me.fmMoney(d.taxChangeData.changeAmount||'0.00'));$('#deptBudgetBalanceAmount').text(d.deptBudgetBalanceAmount?me.fmMoney(d.deptBudgetBalanceAmount)+'万元':'--');$('#budgetBalanceAmount').text(d.budgetBalanceAmount?me.fmMoney(d.budgetBalanceAmount)+'万元':'--');$('#advanceCostType').text(me.non(d.advanceCostTypeName));$('#totalAmount').text(me.fmMoney(d.advanceAmount));$('#totalMoneyUpper').text(arabiaToChinese(d.advanceAmount||'0'));$('#doAdvanceAmount').text(me.fmMoney(d.doAdvanceAmount));$('#taxAmount').text(me.fmMoney(d.taxAmount));$('#busiUsers').text(me.non(d.applicantUserName));$('#deptName').text(me.non(d.applicantUserDeptName));$('#jobName').text(me.non(d.applicantUserJobName));$('#telPhone').text(me.non(d.applicantUserPhone));$('#applicantTime').text(me.non(d.applicantTime));sysCommon.getApproveFlowData("SZ_CHANGEPRJ_APP",d.processInstanceId);me.showCostDetail(d.costData);me.showFileList(d.attList);$('#changeNum').text(d.changeNum||'0');me.setChangeList(d.changeList);},setChangeList:function(list){var me=this,html='',total=0;$.each(list,function(i,n){html+='<tr> <td>'+n.changeProject+'</td> <td style="text-align: right;">'+me.fmMoney(n.changeBeforeAmount)+'</td> <td style="text-align: right;">'+me.fmMoney(n.changeAfterAmount)+'</td> <td style="text-align: right;">'+me.fmMoney(n.changeAmount)+'</td> <td style="text-align: left;">'+me.non(n.changeReason)+'</td> </tr>';total+= +n.changeAmount});$('#changeList tbody .last').before(html).find('.amount-total').text(me.fmMoney(total))},showCostDetail:function(data){var me=this;var fMoney=$yt_baseElement.fmMoney;me.setTrainApplyInfoList(data.trainApplyInfoList);me.setCostList(data.projectBudgetList,1);me.setCostList(data.projectBudgetDetails,2);},setTrainApplyInfoList:function(list){var me=this;if(list.length>0){$("#regionDesignation").text(list[0].regionDesignation);list[0].isOffSiteTraining=='1'?list[0].isOffSiteTrainingVal='是':'';list[0].isOffSiteTraining=='0'?list[0].isOffSiteTrainingVal='否':'';list[0].costStandard=='1'?list[0].costStandardVal='基本标准':'';list[0].costStandard=='2'?list[0].costStandardVal='高成本标准':'';$('.expenditure-matter-basic-information').setDatas(list[0]);me.initProjectSelect(list[0].projectCode,list[0].projectId);$('.trainOfNum').text(list[0].budgetTraineeSum)}},setCostList:function(list,type){var html='';var tBody1,tBody2;if(type==1){tBody1=$('#teachBeforeTable tbody');tBody2=$('#trainingBeforeTable tbody')}else if(type==2){tBody1=$('#lectureFeeTable tbody');tBody2=$('#trainingFeeTable tbody')}tBody1.empty();tBody2.empty();$.each(list,function(i,n){html='<tr><td align="right"><input type="hidden" value="'+n.costCode+'" class="cost-code"><span>'+n.costName+'</span></td><td><span>'+$yt_baseElement.fmMoney(n.budgetCost)+'</span></td><td style="text-align:left;"><p>'+n.accordingInstructions+'</p></td></tr>';if(n.costType==1){tBody1.append(html)}if(n.costType==2){tBody2.append(html)}})},setTeacherApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr><td class="lecturerName"><input type="hidden" class="lectureId" value="'+n.lecturerId+'"><span>'+n.lecturerName+'</span></td><td class="professional">'+n.lecturerTitleName+'</td><td class="level">'+n.lecturerLevelName+'</td><td style="display:none"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';if(n.reason){$("#teacherReason").text(n.reason)}else{$(".teacher-reason").hide()}});if(!list&&list.length<=0){$(".teacher-reason").hide()}$('#lecturerTable tbody').html(html)},setCostTrainApplyInfoList:function(list){var html='';var total=0;if(list.length!=0){$.each(list,function(i,n){html+='<tr pid="'+n.trainAppId+'" trainType="'+n.trainType+'"><td class="trainTypeName">'+n.trainTypeName+'</td><td class="standard">'+serveExamine.fmMoney(n.standard)+'</td><td class="trainOfNum">'+n.trainOfNum+'</td><td class="trainDays">'+n.trainDays+'</td><td class="moneyText averageMoney">'+serveExamine.fmMoney(n.averageMoney)+'</td><td style="text-align: left" class="trainingPerNumber">'+n.trainOfNum+'</td></tr>';total+= +n.averageMoney;if(n.reason){$('#trainingReason').text(n.reason)}else{$(".other-reason").hide()}});$('#trainingFeeTable tbody .last').before(html);$('#trainingFeeTable .costTotal').text(serveExamine.fmMoney(total))}else{$(".other-title,.trainingFeeTable,.other-reason").hide()}},setCostTeachersFoodApplyInfoList:function(list){var html='';var total=0;if(list.length!=0){$.each(list,function(i,n){html+='<tr pid="'+n.foodId+'"><td><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="avg moneyText">'+serveExamine.fmMoney(n.averageMoney)+'</td><td class="day">'+n.foodOfDays+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.foodAmount)+'</td><td class="dec">'+(n.remarks||"无")+'</td><td style="display:none"><input type="hidden" class="popM" value="4"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.foodAmount;if(n.reason){$('#dietApplyReason').text(n.reason)}else{$(".food-reason").hide()}});$('#dietFeeTable tbody .end-tr').before(html);$('#dietFeeTable tbody .costTotal').text(serveExamine.fmMoney(total))}else{$(".food-title,.dietFeeTable,.food-reason").hide()}},setCostPredictInfoList:function(list){var html='';var costTotal=0;var costTotalAfter=0;$.each(list,function(i,n){html+='<tr  pid=""><td class="cost-name">'+n.predictName+'</td><td class="moneyText predict-standard-money">'+($yt_baseElement.fmMoney(n.predictStandardMoney))+'</td><td class="predict-people-num">'+n.predictPeopleNum+'</td><td class="moneyText predict-smallplan-money">'+($yt_baseElement.fmMoney(n.averageMoney))+'</td><td class="special-instruct">'+n.remark+'</td></tr>';costTotal+=n.predictStandardMoney*n.predictPeopleNum;costTotalAfter+=n.averageMoney;if(n.reason){$('#predictCostReason').text(n.reason)}else{$(".predictCost-reason").hide()}});html+='<tr class="last"><td>合计</td><td></td><td></td><td class="moneyText costTotal">'+$yt_baseElement.fmMoney(costTotalAfter)+'</td><td></td></tr>';$('#predictCostTable tbody').html(html);$("#preTaxAllMoney").text($yt_baseElement.fmMoney(costTotal));$("#afterTaxAllMoney").text($yt_baseElement.fmMoney(costTotalAfter))},setCostTeachersLectureApplyInfoList:function(list){var html='';var total=0;if(list.length!=0){$.each(list,function(i,n){html+='<tr pid="'+n.teachersLectureId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="holder">'+n.lecturerTitleName+'</td><td class="hour">'+n.teachingHours+'</td><td class="cname">'+(n.courseName||'--')+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.perTaxAmount)+'</td><td class="moneyText after">'+serveExamine.fmMoney(n.afterTaxAmount)+'</td><td class="moneyText avg">'+serveExamine.fmMoney(n.averageMoney)+'</td><td style="display:none"><input type="hidden" class="popM" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.perTaxAmount;if(n.reason){$('#costTrainApplyReason').text(n.reason)}else{$(".lecture-reason").hide()}});$('#lectureFeeTable tbody .end-tr').before(html);$('#lectureFeeTable tbody .costTotal').text(serveExamine.fmMoney(total))}else{$(".lecture-title,.lectureFeeTable,.lecture-reason").hide()}},setCostTeachersTravelApplyInfoList:function(list){var html='';var total=0;if(list.length!=0){$.each(list,function(i,n){html+='<tr pid="'+n.teachersTravelId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="ulv">'+n.lecturerLevelName+'</td><td class="sdate">'+n.goTime+'</td><td class="edate">'+n.arrivalTime+'</td><td class="sadd"><input type="hidden" class="scode" value="'+n.goAddress+'">'+n.goAddressName+'</td><td class="eadd"><input type="hidden" class="ecode" value="'+n.arrivalAddress+'">'+n.arrivalAddressName+'</td><td class="tname"><input type="hidden" class="tool" value="'+n.vehicle+'">'+n.vehicleName+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.carfare)+'</td><td class="dec">'+(n.remarks||"无")+'</td><td  style="display:none"><input type="hidden" class="popM" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.carfare;if(n.reason){$('#carApplyReason').text(n.reason)}else{$(".traffic-reason").hide()}});$('#carFeeTable tbody .end-tr').before(html);$('#carFeeTable tbody .costTotal').text(serveExamine.fmMoney(total))}else{$(".traffic-title,.carFeeTable,.traffic-reason").hide()}},setCostTeachersHotelApplyInfoList:function(list){var html='';var total=0;if(list.length!=0){$.each(list,function(i,n){html+='<tr pid="'+n.teachersHotelId+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="moneyText avg">'+serveExamine.fmMoney(n.averageMoney)+'</td><td class="day">'+n.hotelDays+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.hotelExpense)+'</td><td class="dec">'+(n.remarks||"无")+'</td><td style="display:none"><input type="hidden" class="popM" value="3"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';total+= +n.hotelExpense;if(n.reason){$('#hotelApplyReason').text(n.reason)}else{$(".accommodation-reason").hide()}});$('#hotelFeeTable tbody .end-tr').before(html);$('#hotelFeeTable tbody .costTotal').text(serveExamine.fmMoney(total))}else{$(".accommodation-title,.hotelFeeTable,.accommodation-reason").hide()}},showFileList:function(list){if(list.length>0){var ls='';var src='';$.each(list,function(i,n){var imgType=n.attName.split('.');if(imgType.length>1&&(imgType[1]=='png'||imgType[1]=='jpeg'||imgType[1]=='bmp'||imgType[1]=='jpg')){src=$yt_option.base_path+'fileUpDownload/download?pkId='+n.attId+'&isDownload=false';ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pv">预览<img src="'+src+'" ></label></div>'}else{ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pvno">预览</label></div>'}});$('#attIdStr').html(ls);$('#attIdStr .file-dw').on('click',function(){var id=$(this).parent().attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'});$('#attIdStr .file-pv img').showImg()}else{$('#attIdStr').html('暂无附件')}},showBillingVoucherList:function(list){var totalText='';var detailText='';var html='';$.each(function(i,n){if(n.toLoanType=='DEBIT_ENTRY'){totalText=n.amount}else{detailText=n.amount}html+='<tr pid="'+n.billingVoucherId+'" class="" loanCode="'+n.toLoanType+'" loanType="'+n.toLoanTypeName+'" abstract="'+n.abstracts+'" totalSubject="'+n.ledger+'" detailSubject="'+n.detailed+'" tallyMoney="'+n.amount+'"><td>'+n.abstracts+'</td><td>'+n.ledger+'</td><td>'+n.detailed+'</td><td>'+totalText+'</td><td>'+detailText+'</td></tr>'});$('.tally-list').append(html)},getDictInfoByTypeCode:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:true,data:{dictTypeCode:'TO_LOAN_TYPE'},success:function(data){var list=data.data||[];var optone='<option value="">请选择</option>';$.each(list,function(i,n){optone+='<option value="'+n.value+'">'+n.disvalue+'</option>'});$('#loanType').html(optone).niceSelect();}})},resetNum:function(obj){var trs=obj.find('tbody tr');$.each(trs,function(i,n){$(n).find('.num').text(i+1)})},submitReimAppInfo:function(subData,thisBtn){$.ajax({type:"post",url:"sz/advanceAppUpdate/submitWorkFlow",async:true,data:subData,success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){window.location.href=$yt_option.websit_path+'view/projectManagement-sasac/expensesReim/module/approval/projectBefList.html?state=1'}thisBtn.attr('disabled',false).removeClass('btn-disabled')}})},getTotleMoney:function(){var tds=$('#paymentList tbody .money');var total=0;$.each(tds,function(i,n){total+= +$(n).attr('money')});var fmTotal=$yt_baseElement.fmMoney(total||'0');$('#paymentList tbody .total-money').text(fmTotal);$('#applyTotalMoney').text(fmTotal).attr('num',total);$('#amountTotalMoney').text(fmTotal).attr('num',total);$('#TotalMoneyUpper').text(arabiaToChinese(fmTotal+''));var writeOffAmount= +($('#writeOffAmount').attr('num'));var num=total-writeOffAmount;if(num>=0){$('#replaceMoney').text($yt_baseElement.fmMoney(num))}else{$('#balanceMoney').text($yt_baseElement.fmMoney(num))}},getSaveData:function(){var me=this;var data=me.saveData;data.paymentDate=$('#paymentDate').val();data.paymentAmount=$yt_baseElement.rmoney($('#paymentAmount').val()||'0');data.cmTotalAmount=$('#cmTotalAmount').attr('num');data.cmWriteOffAmount=$('#cmWriteOffAmount').attr('num');data.cmOfficialCard=$yt_baseElement.rmoney($('#cmOfficialCard').val()||'0');data.cmCash=$yt_baseElement.rmoney($('#cmCash').val()||'0');data.cmCheque=$yt_baseElement.rmoney($('#cmCheque').val()||'0');data.costData=JSON.stringify(data.costData);data.nextCode=$('#operate-flow option:selected').val();data.dealingWithPeople=$('#approve-users option:selected').val();data.attIdStr=me.getFileList();return data},getFileList:function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length?',':'')});return str},showBusinessFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.business-div').show()},showGeneralFun:function(){},showTravelFun:function(){},showTrainFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.index-main-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/busiTripApply/trainApproval.html')},showMettingFun:function(){$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();sysCommon.loadingWord('view/system-sasac/expensesReim/module/beforehand/meetingCostApplyDetails.html')},clearexamine:function(){$("#clearBtn").off().on("click",function(){window.history.go(-1)})},financialPayment:function(){var me=this;$('#payAddBtn').click(function(){var notMoney=1;if(notMoney>0){me.showCrateDetaliAlert();$('#lpaymentAddBtn').off().on('click',function(){var notMoney=$yt_baseElement.rmoney($('#notMoney').text());var money=$yt_baseElement.rmoney($('#createDetaTotalMoney').text());var isNull=$yt_valid.validForm($("#addObjInfo"));if(money>notMoney){$yt_alert_Model.prompt('金额不能大于未付款金额')}else if(isNull){$yt_alert_Model.alertOne({alertMsg:"确定已支付后不可修改，确定所填写的支付明细并提交吗？",confirmFunction:function(){me.appendDetaliList();me.hideCrateDetaliAlert()}})}}).text('确定已支付')}else{$yt_alert_Model.prompt('已支付所有应付款金额')}});$('#paymentCanelBtn').on('click',function(){$yt_baseElement.hideMongoliaLayer();$('#createDetali').hide();$('#pop-modle-alert').hide();pay.clearAlert($('.create-detali'))})},showCrateDetaliAlert:function(){$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#createDetali'));$('#pop-modle-alert').show();$('#createDetali').show()},hideCrateDetaliAlert:function(){$yt_baseElement.hideMongoliaLayer();$('#createDetali').hide();$('#pop-modle-alert').hide()},appendDetaliList:function(tr){var me=this;var type=$('#firstSelect option:selected').text();var typeVal=$('#firstSelect option:selected').val();var budgetProject=$('#budgetProject option:selected').text();var budgetProjectCode=$('#budgetProject option:selected').val();var payDate=$('#payDate').val();var cash=$('#cash').val();var officialCard=$('#officialCard').val();var transfer=$('#transfer').val();var createDetaTotalMoney=$('#createDetaTotalMoney').val();$.ajax({type:"post",url:"sz/payDetailBillingVoucher/savePaymentDetailInfo",async:true,data:{appId:serveExamine.saveData.payAppId,appType:'PAYMENT_APP',receivablesId:budgetProjectCode,receivablesType:typeVal,paymentDate:payDate,paymentAmount:serveExamine.rmoney(createDetaTotalMoney),},success:function(data){if(data.flag==0){var d=data.data;var html='<tr pid="" type="'+typeVal+'" payee="'+budgetProjectCode+'" payment="'+payDate+'" paymentmoney="'+Unit+'"> <td class="payee" style="width: 100px;">'+budgetProject+'</td> <td class="payment" style="width: 100px;">'+payDate+'</td> <td class="paymentmoney" style="text-align: right;">'+Unit+'</td></tr>';me.hideMsgAlert();me.clearAlert($('#createDetali'));me.getPaymentAmountInfoList(d.appId)}$yt_alert_Model.prompt(data.message)}})},getPaymentAmountInfoList:function(appId){$.ajax({type:"post",url:"sz/payDetailBillingVoucher/getPaymentAmountInfoList",async:true,data:{appId:appId},success:function(data){if(data.flag==0){var d=data.data;$('#mustMoney').text(pay.fmMoney(d.totalAmount));var paymentAmount=d.paymentAmount;$('#alreadyMoney').text(pay.fmMoney(paymentAmount));var paymentBalanceAmount=d.paymentBalanceAmount;$('#notMoney').text(pay.fmMoney(paymentBalanceAmount));var payDetailList=d.payDetailList||[];serveExamine.setPayDetailList(payDetailList)}}})},setPayDetailList:function(list){var html='';var total=0;$('.pay-detail-tabel tbody tr:not(.pay-detail-tabel-total)').remove();$.each(list,function(i,n){html+='<tr pid="'+n.receivablesId+'" type="'+n.receivablesType+'" payee="'+n.receivablesId+'" payment="'+n.paymentDate+'" paymentmoney="'+n.paymentAmount+'"> <td class="payee" style="width: 100px;">'+n.receivablesName+'</td> <td class="payment" style="width: 100px;">'+n.paymentDate+'</td> <td class=""></td> <td class=""></td> <td class=""></td> <td class="paymentmoney" style="text-align: right;">'+pay.fmMoney(n.paymentAmount)+'</td></tr>';total+= +n.paymentAmount});$('.pay-detail-tabel .pay-detail-tabel-total').before(html);$('.pay-detail-tabel .payee-other-total-money').text(pay.fmMoney(total))},initProjectSelect:function(projectCode,projectId){if(projectCode){$.ajax({type:"post",url:"finance/budget/lookForProjectListBudget",async:false,data:{projectCode:projectCode,projectId:projectId},beforeSend:function(){},success:function(data){if(data.flag==0){var datas=data.data[0];datas.projectTypeName=$yt_baseElement.setProjectTypeName(datas.projectType);$('.expenditure-matter-basic-information').setDatas(datas)}},error:function(){$yt_alert_Model.prompt('网络异常')}})}}};$(function(){serveExamine.init();serveExamine.clearexamine()})})(jQuery,window);