var budgetApprovalDetails={init:function(){var pkId=$yt_common.GetQueryString('pkId');budgetApprovalDetails.getBudgetInf();$(".report-date").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd HH:mm",callback:function(){}});$(".out-hospital-date").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd HH:mm",callback:function(){}});var projectSelect=budgetApprovalDetails.getAddBudgetSelect();if(projectSelect!=null){$.each(projectSelect,function(i,n){$(".project-code").append('<option value="'+n.projectCode+'" createUserName="'+n.createUserName+'" projectType="'+n.projectType+'" classTeacher="'+n.classTeacher+'" projectHead="'+n.projectHead+'" startDate="'+n.startDate+'" endDate="'+n.endDate+'" traineeTotal="'+n.traineeTotal+'">'+n.projectName+'</option>')})}$(".project-code").niceSelect();$("select.project-code").change(function(){var createUserName=$("select.project-code option:selected").attr("createUserName");var projectType=$("select.project-code option:selected").attr("projectType");var classTeacher=$("select.project-code option:selected").attr("classTeacher");var projectHead=$("select.project-code option:selected").attr("projectHead");var startDate=$("select.project-code option:selected").attr("startDate");var endDate=$("select.project-code option:selected").attr("endDate");var traineeTotal=$("select.project-code option:selected").attr("traineeTotal");$(".create-user-name").text(createUserName);$(".project-type").text(budgetApprovalDetails.getProjectType(projectType));if(classTeacher=="null"){$(".class-teacher").text("")}else{$(".class-teacher").text(classTeacher)}if(projectHead=="null"){$(".project-head").text("")}else{$(".project-head").text(projectHead)}$(".start-date").text(startDate.split(" ")[0]);$(".end-date").text(endDate.split(" ")[0]);$(".trainee-total").text(traineeTotal)});$(".check-label input[type='radio']").change(function(){var rad=$(this).val();if(rad=="completed"){$('.hid-input').show()};if(rad=="returnedSubmit"){$('#nextPeople').val("");$('.hid-input').hide()}});$('#last-submit').click(function(){var pkId=$yt_common.GetQueryString('pkId');var processInstanceId=$('.processInstanceId').val();var dealingWithPeople=$('#nextPeople').val();var tastKey=$('#tastKey').val();if(tastKey=="activitiEndTask"){dealingWithPeople=""}var opintion=$('#opintion').val();var nextCode=$('input[name="radioType"]:checked ').val();if(nextCode=="returnedSubmit"){dealingWithPeople=""}$.ajax({type:"post",url:$yt_option.base_path+"finance/projectBudget/updateApply",data:{pkId:pkId,businessCode:"projectBudget",dealingWithPeople:dealingWithPeople,opintion:opintion,processInstanceId:processInstanceId,nextCode:nextCode},objName:'data',success:function(data){if(data.flag==0){}}});window.location.href="budgetApprovalList.html"});$('#last-cancel').click(function(){window.location.href="budgetApprovalList.html"});var getAllNextPeople=budgetApprovalDetails.getListSelectDealingWithPeople();if(getAllNextPeople!=null){$.each(getAllNextPeople,function(i,n){$("#nextPeople").append('<option value="'+n.userCode+'">'+n.userName+'</option>')})};$("#nextPeople").niceSelect();$('.back-btn').click(function(){window.location.href="budgetApprovalList.html"})},getListSelectDealingWithPeople:function(){var list=[];var processInstanceId=$('.processInstanceId').val();$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"project",processInstanceId:processInstanceId,parameters:"",versionNum:""},async:false,success:function(data){$.each(data.data,function(i,n){console.log(n);console.log(i);for(var k in n){console.log('k',k);console.log("n[k]",n[k]);list=n[k]}})}});return list},getAddBudgetSelect:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"finance/reduction/lookForAllProject",data:{searchParameters:""},async:false,success:function(data){list=data.data||[]}});return list},getBudgetInf:function(){var pkId=$yt_common.GetQueryString('pkId');$.ajax({type:"post",url:$yt_option.base_path+"finance/projectBudget/getBeanById",data:{pkId:pkId},success:function(data){if(data.flag==0){$(".processInstanceId").val(data.data.processInstanceId);$('.state-type').text(data.data.workFlawState);$(".budget-inf").setDatas(data.data);$(".project-code").setSelectVal(data.data.projectCode);if($(".project-code").val()!=""){var createUserName=$("select.project-code option:selected").attr("createUserName");var projectType=$("select.project-code option:selected").attr("projectType");var classTeacher=$("select.project-code option:selected").attr("classTeacher");var projectHead=$("select.project-code option:selected").attr("projectHead");var startDate=$("select.project-code option:selected").attr("startDate");var endDate=$("select.project-code option:selected").attr("endDate");var traineeTotal=$("select.project-code option:selected").attr("traineeTotal");$(".create-user-name").text(createUserName);$(".project-type").text(budgetApprovalDetails.getProjectType(projectType));if(classTeacher=="null"){$(".class-teacher").text("")}else{$(".class-teacher").text(classTeacher)}if(projectHead=="null"){$(".project-head").text("")}else{$(".project-head").text(projectHead)}$(".start-date").text(startDate.split(" ")[0]);$(".end-date").text(endDate.split(" ")[0]);$(".trainee-total").text(traineeTotal)}var projectBudgetDetailsArr=$.parseJSON(data.data.projectBudgetDetails);console.log(projectBudgetDetailsArr);var projectBudget='';if(projectBudgetDetailsArr!=null){$.each(projectBudgetDetailsArr,function(i,n){projectBudget=$('<tr><td align="right"><input type="hidden" value="'+n.costCode+'" class="cost-code"><span>'+n.costName+'：</span></td><td><input type="text" class="yt-input budget-cost" data-val="budgetCost" placeholder="请输入"></td><td style="width: 50px;"><span>元</span></td><td><input type="text" class="yt-input according-instructions gist" data-val="accordingInstructions" placeholder="请输入依据说明"></td></tr>');projectBudget.setDatas(n);if(n.costType==1&&n.types==1){$(".approval-change-before .teach-related-expenses-table").append(projectBudget)}if(n.costType==2&&n.types==1){$(".approval-change-before .logistics-related-expenses-table").append(projectBudget)}if(n.costType==1&&n.types==2){$(".approval-change-after").show();$(".approval-change-after .teach-related-expenses-table").append(projectBudget)}if(n.costType==2&&n.types==2){$(".approval-change-after .logistics-related-expenses-table").append(projectBudget)}})}var flowLog=data.data.flowLog;var flowLogArr=$.parseJSON(flowLog);console.log(flowLogArr);if(flowLogArr==""){$(".approval-process-module").hide()}var middleStepHtml;var length=flowLogArr.length;$.each(flowLogArr,function(i,n){$('#tastKey').val(n.tastKey);if(n.tastKey=="activitiEndTask"){$('.next-operate-person-tr').hide()}if(i==0){$('.last-step-order').text(length);$('.last-step-operate-person-userName').text(n.userName);$('.last-step-operationState').text(n.taskName);$('.last-step-commentTime').text(n.commentTime)};if(i==length-1){$('.first-step-order').text(1);$('.first-step-operate-person-userName').text(n.userName);$('.first-step-taskName').text(n.taskName);$('.first-step-commentTime').text(n.commentTime);$('.first-step-comment').text(n.comment)};if(i!=0&&i!=length-1){var order=length-i;middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+n.userName+'</span><img src="../../resources/images/open/open-sp.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+n.taskName+'</span></li><li class="view-time-li middle-step-commentTime" >'+n.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment">'+n.comment+'</div></li></ul></div></div>';$('.last-step').append(middleStepHtml)}})}else{$yt_alert_Model.prompt("获取失败")}}})},getProjectType:function(code){if(code==1){return "计划"}else if(code==2){return "委托"}else if(code==3){return "选学"}else if(code==4){return "调训"}}};$(function(){budgetApprovalDetails.init()});