var teacherList={init:function(){$("select").niceSelect();$(".startAttendClassStart").calendar({controlId:"startDate",nowData:false,upperLimit:$(".startAttendClassEnd")});$(".startAttendClassEnd").calendar({controlId:"endDate",nowData:false,lowerLimit:$(".startAttendClassStart")});$(".endAttendClassStart").calendar({controlId:"startDate",nowData:false,upperLimit:$(".end-time-end")});$(".endAttendClassEnd").calendar({controlId:"endDate",nowData:false,lowerLimit:$(".endAttendClassStart")});$(".addList").on('click',function(){$(".yt-edit-alert-title-msg").text("新增教师");$(".alert-add-teacher td>input").val("");teacherList.legalAdd();$('.alert-add-teacher .yt-model-sure-btn').off('click').on('click',function(){if($yt_valid.validForm($('body'))){teacherList.addTeacherList();$(".lawyer-opinion-box").hide()}else{teacherList.pageToScroll($('body .valid-font'));$yt_alert_Model.prompt("请将标红必填项填写完整",3000)}})});$(".updateList").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要修改的数据");return false}teacherList.getTeacherInf();$(".yt-edit-alert-title-msg").text("修改");teacherList.legalAdd();$('.alert-add-teacher .yt-model-sure-btn').off('click').on('click',function(){teacherList.amendTeacherList();$(".lawyer-opinion-box").hide()})});$(".deleteList").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要删除的数据");return false}teacherList.delTeacherList()});$(".enableList").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}teacherList.startUsing()});$(".disableList").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}teacherList.endUsing()});$(".exportList").on("click",function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}var pkId=$(".yt-table-active .pkId").val();var realName=$('.yt-table-active').data("legalData").realName;var org=$('.yt-table-active').data("legalData").org;var isFormal=$('.yt-table-active').data("legalData").isFormal;var title=$('.yt-table-active').data("legalData").title;var researchArea=$('.yt-table-active').data("legalData").researchArea;var states=$('.yt-table-active').data("legalData").states;var startAttendClassStart=$('.yt-table-active').data("legalData").startAttendClassStart;var startAttendClassEnd=$('.yt-table-active').data("legalData").startAttendClassEnd;var endAttendClassStart=$('.yt-table-active').data("legalData").endAttendClassStart;var endAttendClassEnd=$('.yt-table-active').data("legalData").endAttendClassEnd;var gradeStart=$('.yt-table-active').data("legalData").gradeStart;var gradeEnd=$('.yt-table-active').data("legalData").gradeEnd;var downUrl=$yt_option.base_path+"teacher/exportTeacher";$.ajaxDownloadFile({url:downUrl,data:{pkId:pkId,realName:realName,org:org,isFormal:isFormal,title:title,researchArea:researchArea,states:states,startAttendClassStart:startAttendClassStart,startAttendClassEnd:startAttendClassEnd,endAttendClassStart:endAttendClassStart,endAttendClassEnd:endAttendClassEnd,gradeStart:gradeStart,gradeEnd:gradeEnd,isDownload:true}})});$(".list-tbody").on('click','.real-name-inf',function(){window.location.href="teacherInf.html?pkId="+$(this).parent().parent().find('.pkId').val()});$(".btn-file").undelegate().delegate("input","change",function(){$(".btn-file").next().text("");var addFile=$(this).attr("id");$yt_baseElement.showLoading();var url=$yt_option.acl_path+"api/tAscPortraitInfo/addFile?modelCode=caFile";$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:addFile,success:function(data,textStatus){var resultData=$.parseJSON(data);if(resultData.success==0){$yt_alert_Model.prompt("附件上传成功");$(".file-id").append('<li><span class="file-name" style="margin-right: 50px;color:blue;cursor: pointer"><input type="hidden" class="file-span-id" value="'+resultData.obj.pkId+'" >'+resultData.obj.naming+'</span><span class="cancal" style="cursor: pointer;">x</span></li>')}else{$yt_alert_Model.prompt("附件上传失败")}$yt_baseElement.hideLoading()},error:function(data,status,e){$yt_alert_Model.prompt("附件上传失败");$yt_baseElement.hideLoading()}})});$(".file-id").on("click","li .file-name",function(){var pkId=$(this).find(".file-span-id").val();var downUrl=$yt_option.acl_path+"api/tAscPortraitInfo/download";$.ajaxDownloadFile({url:downUrl,data:{pkId:pkId,isDownload:true}})});$(".file-id").on("click","li .cancal",function(){$(this).parent().remove()});teacherList.getPlanListInfo();var clickNumber=0;$('.search-more').off().on('click',function(){if(clickNumber%2==0){$('.search-box').show();$('.search-put').addClass('flipy')}else{$('.search-box').hide();$('.realName').val("");$('.org').val("");$('.isFormal').setSelectVal("1");$('.title').val("");$('.researchArea').val("");$('.states').setSelectVal("1");$('.startAttendClassStart').val("");$('.startAttendClassEnd').val("");$('.endAttendClassStart').val("");$('.endAttendClassEnd').val("");$('.gradeStart').val("");$('.gradeEnd').val("");$('.search-put').removeClass('flipy')}clickNumber+=1});$('.yt-model-reset-btn').off().on("click",function(){$('.realName').val("");$('.org').val("");$('.isFormal').setSelectVal("1");$('.title').val("");$('.researchArea').val("");$('.states').setSelectVal("1");$('.startAttendClassStart').val("");$('.startAttendClassEnd').val("");$('.endAttendClassStart').val("");$('.endAttendClassEnd').val("");$('.gradeStart').val("");$('.gradeEnd').val("")});$('.search-more-button').click(function(){var realName=$('.search-box .realName').val();var org=$('.search-box .org').val();var title=$('.search-box .title').val();var researchArea=$('.search-box .researchArea').val();var states=$('.states').val();var startAttendClassStart=$('.startAttendClassStart').val();var startAttendClassEnd=$('.startAttendClassEnd').val();var endAttendClassStart=$('.endAttendClassStart').val();var endAttendClassEnd=$('.endAttendClassEnd').val();var gradeStart=$('.gradeStart').val();var gradeEnd=$('.gradeEnd').val();teacherList.getPlanListInfo('',realName,org,title,researchArea,states,startAttendClassStart,startAttendClassEnd,endAttendClassStart,endAttendClassEnd,gradeStart,gradeEnd)});$('.search-all-button').click(function(){teacherList.getPlanListInfo('')});$('.search-btn').click(function(){var selectParam=$('.keyword').val();teacherList.getPlanListInfo(selectParam)});$(".research-area").click(function(){$(this).find(".research-area-list").show()});$(".research-area").mouseleave(function(){$(this).find(".research-area-list").hide()});$(".research-area-list").on("click","li",function(){$(this).toggleClass("active");var researchAreaVal="";$(".research-area-list li.active").each(function(i,n){if(researchAreaVal==""){researchAreaVal=$(n).text()}else{researchAreaVal+=","+$(n).text()}});$(".researchArea").val(researchAreaVal)});var groupList=teacherList.getListSelectGroup();console.log(groupList);$('#textTree').createTree({controlId:'treeDiv',dataList:groupList,listConfig:{id:'pkId',pid:'parentId',name:'researchAreaName'},speed:200,readonly:true,checked:true,callback:{onCheckClick:getCheckNode },rootConfig:{id:0,pid:-1,name:"专业领域"}});function getCheckNode(checkNode){var check='';var pkId='';console.log(checkNode);$.each(checkNode,function(i,n){if(n.pid!=0){check+=n.name+',';pkId+=n.id+','}});pkId=pkId.slice(0,pkId.length-1);$('#textTree').val(check.slice(0,check.length-1));$('#textTree').data('pkId',pkId)}var treeAllPersonal=teacherList.getTreeAllPersonnel();if(treeAllPersonal!=null){$.each(treeAllPersonal,function(i,n){if(n.type==3){$(".inspecting-user-code,.intermediate-user-code").append('<option value="'+n.textName+'">'+n.text+'</option>')}})}$(".inspecting-user-code,.intermediate-user-code").niceSelect()},getListSelectGroup:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"teacher/getResearchArea",data:{},async:false,success:function(data){list=data.data||[]}});return list},getTreeAllPersonnel:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsers",data:{},async:false,success:function(data){list=data.data||[]}});return list},getPlanListInfo:function(selectParam,realName,org,title,researchArea,states,startAttendClassStart,startAttendClassEnd,endAttendClassStart,endAttendClassEnd,gradeStart,gradeEnd){$yt_baseElement.showLoading();$('.page-info').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"teacher/lookForAll",type:"post",data:{selectParam:selectParam,realName:realName,org:org,title:title,researchArea:researchArea,states:states,startAttendClassStart:startAttendClassStart,startAttendClassEnd:startAttendClassEnd,endAttendClassStart:endAttendClassStart,endAttendClassEnd:endAttendClassEnd,gradeStart:gradeStart,gradeEnd:gradeEnd},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.list-table .list-tbody');var htmlTr='';var num=1;$(htmlTbody).empty();if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){v.startAttendClass==null?v.startAttendClass='':v.startAttendClass=v.startAttendClass;v.endAttendClass==null?v.endAttendClass='':v.endAttendClass=v.endAttendClass;htmlTr='<tr><td><input type="hidden" value="'+v.pkId+'" class="pkId">'+num++ +'</td><td style="text-align: left;"><a href="#" class="real-name-inf" style=" color:#3c4687">'+v.realName+'</a></td><td style="text-align: left;">'+v.org+'</td><td style="text-align: left;">'+v.title+'</td><td>'+v.startAttendClass+'</td><td>'+v.endAttendClass+'</td><td style="text-align: right;">'+v.grade+'</td><td style="text-align: left;">'+v.researchArea+'</td><td>'+(v.states==1?"可用":(v.states==2?"已用":"停用"))+'</td></tr>';$('.page-info').show();htmlTbody.append($(htmlTr).data("legalData",v))})}else{$('.page-info').hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("查询失败");$yt_baseElement.hideLoading()}},isSelPageNum:true })},addTeacherList:function(){var validFlag=$yt_valid.validForm($(".valid-tab"));if(validFlag){}else{}var realName=$(".alert-add-teacher .realName").val();var gender=$(".alert-add-teacher input[type='radio']:checked").val();var researchArea=$('#textTree').data('pkId');var org=$(".alert-add-teacher .org").val();var applyShift=$(".alert-add-teacher .applyShift").val();var title=$(".alert-add-teacher .title").val();var clerkPhone=$(".alert-add-teacher .clerkPhone").val();var papersType=$(".alert-add-teacher .papersType").val();var clerkWorkPhone=$(".alert-add-teacher .clerkWorkPhone").val();var papersNumber=$(".alert-add-teacher .papersNumber").val();var inspectingUserCode=$(".alert-add-teacher .inspecting-user-code").val();var phone=$(".alert-add-teacher .phone").val();var intermediateUserCode=$(".alert-add-teacher .intermediate-user-code").val();var workPhone=$(".alert-add-teacher .workPhone").val();var dollarsStandardHalf=$(".alert-add-teacher .dollarsStandardHalf").val();var dollarsStandardOne=$(".alert-add-teacher .dollarsStandardOne").val();var fax=$(".alert-add-teacher .fax").val();var email=$(".alert-add-teacher .email").val();var registeredBank=$(".alert-add-teacher .registeredBank").val();var orgAddress=$(".alert-add-teacher .orgAddress").val();var account=$(".alert-add-teacher .account").val();var teacherDetails=$(".alert-add-teacher .teacherDetails").val();var fileIds="";var remarks=$(".alert-add-teacher .remarks").val();var fileIdsJsonArr=[];$(".file-id li").each(function(i,n){fileName=$(n).find(".file-name").text();fileId=$(n).find(".file-name .file-span-id").val();var fileIds={fileName:fileName,fileId:fileId};fileIdsJsonArr.push(fileIds)});var fileIdsJson=JSON.stringify(fileIdsJsonArr);$.ajax({type:"post",url:$yt_option.base_path+"teacher/addOrUpdateBean",data:{realName:realName,gender:gender,researchArea:researchArea,org:org,applyShift:applyShift,title:title,clerkPhone:clerkPhone,papersType:papersType,clerkWorkPhone:clerkWorkPhone,papersNumber:papersNumber,inspectingUserCode:inspectingUserCode,phone:phone,intermediateUserCode:intermediateUserCode,workPhone:workPhone,dollarsStandardHalf:dollarsStandardHalf,dollarsStandardOne:dollarsStandardOne,fax:fax,email:email,registeredBank:registeredBank,orgAddress:orgAddress,account:account,teacherDetails:teacherDetails,fileIds:fileIdsJson,remarks:remarks},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("新增成功");$(".yt-edit-alert").hide();$('.page-info').pageInfo("refresh")}else{$yt_alert_Model.prompt("新增失败")}}})},amendTeacherList:function(){var me=this;var pkId=$(".yt-table-active .pkId").val();var afterJson={realName:$(".alert-add-teacher .realName").val(),gender:$(".alert-add-teacher  input[type='radio']:checked").val(),researchArea:$('#textTree').data('pkId'),researchAreaText:$('#textTree').val(),org:$(".alert-add-teacher .org").val(),applyShift:$(".alert-add-teacher .applyShift").val(),title:$(".alert-add-teacher .title").val(),clerkPhone:$(".alert-add-teacher .clerkPhone").val(),papersType:$(".alert-add-teacher .papersType").val(),clerkWorkPhone:$(".alert-add-teacher .clerkWorkPhone").val(),papersNumber:$(".alert-add-teacher .papersNumber").val(),inspectingUserCode:$(".alert-add-teacher .inspecting-user-code").val(),phone:$(".alert-add-teacher .phone").val(),intermediateUserCode:$(".alert-add-teacher .intermediate-user-code").val(),workPhone:$(".alert-add-teacher .workPhone").val(),dollarsStandardHalf:$(".alert-add-teacher .dollarsStandardHalf").val(),dollarsStandardOne:$(".alert-add-teacher .dollarsStandardOne").val(),fax:$(".alert-add-teacher .fax").val(),email:$(".alert-add-teacher .email").val(),registeredBank:$(".alert-add-teacher .registeredBank").val(),orgAddress:$(".alert-add-teacher .orgAddress").val(),account:$(".alert-add-teacher .account").val(),teacherDetails:$(".alert-add-teacher .teacherDetails").val(),remarks:$(".alert-add-teacher .remarks").val(),tableValue:$(".alert-add-teacher .tableValue").val()};var fileIdsJsonArr=[];afterJson.fileIdsName=[];$(".file-id li").each(function(i,n){fileName=$(n).find(".file-name").text();fileId=$(n).find(".file-name .file-span-id").val();var fileIds={fileName:fileName,fileId:fileId};afterJson.fileIdsName.push(fileName);fileIdsJsonArr.push(fileIds)});var fileIdsJson=JSON.stringify(fileIdsJsonArr);afterJson.fileIdsName=afterJson.fileIdsName.join(',');afterJson.inspectingUserText=$('.alert-add-teacher select.inspecting-user-code option:selected').text();afterJson.intermediateUserText=$('.alert-add-teacher select.intermediate-user-code option:selected').text();afterJson.papersTypeText=$('.alert-add-teacher select.papersTypeText option:selected').text();console.log(afterJson);afterJson.gender==1?afterJson.genderVal='男':afterJson.genderVal='女';var logs='修改操作：【'+me.oldTeacherData.realName+'】，'+me.getLogInfo(me.teacherLogsName,me.oldTeacherData,afterJson);$.ajax({type:"post",url:$yt_option.base_path+"teacher/addOrUpdateBean",data:{pkId:pkId,realName:afterJson.realName,gender:afterJson.gender,researchArea:afterJson.researchArea,org:afterJson.org,applyShift:afterJson.applyShift,title:afterJson.title,isFormal:me.oldTeacherData.isFormal,clerkPhone:afterJson.clerkPhone,papersType:afterJson.papersType,clerkWorkPhone:afterJson.clerkWorkPhone,papersNumber:afterJson.papersNumber,inspectingUserCode:afterJson.inspectingUserCode,phone:afterJson.phone,intermediateUserCode:afterJson.intermediateUserCode,workPhone:afterJson.workPhone,dollarsStandardHalf:afterJson.dollarsStandardHalf,dollarsStandardOne:afterJson.dollarsStandardOne,fax:afterJson.fax,email:afterJson.email,registeredBank:afterJson.registeredBank,orgAddress:afterJson.orgAddress,account:afterJson.account,teacherDetails:afterJson.teacherDetails,fileIds:fileIdsJson,remarks:afterJson.remarks,tableValue:afterJson.tableValue,logs:logs},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("修改成功");$('.page-info').pageInfo("refresh")}else{$yt_alert_Model.prompt("修改失败")}}})},delTeacherList:function(){var pkId=$('.yt-table-active .pkId').val();$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"teacher/deleteById",data:{pkId:pkId},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("删除成功");$('.page-info').pageInfo("refresh")}else{$yt_alert_Model.prompt("不能删除")}}})}})},startUsing:function(){var pkId=$(".yt-table-active .pkId").val();$.ajax({type:"post",url:$yt_option.base_path+"teacher/updateDataStatesById",data:{pkId:pkId,dataStates:3},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("已启用");$(".yt-edit-alert").hide();$('.page-info').pageInfo("refresh")}else{$yt_alert_Model.prompt("操作失败")}}})},endUsing:function(){var pkId=$(".yt-table-active .pkId").val();$.ajax({type:"post",url:$yt_option.base_path+"teacher/updateDataStatesById",data:{pkId:pkId,dataStates:2},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("已停用");$('.page-info').pageInfo("refresh")}else{$yt_alert_Model.prompt("操作失败")}}})},oldTeacherData:{},getTeacherInf:function(){var pkId=$(".yt-table-active .pkId").val();var me=this;$.ajax({type:"post",url:$yt_option.base_path+"teacher/getBeanById",data:{pkId:pkId},beforeSend:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){me.oldTeacherData=data.data;$(".alert-add-teacher input:not(.gender)").val('');$(".alert-add-teacher textarea").val('');$('.alert-add-teacher .inspecting-user-code').val('');$('.alert-add-teacher .intermediate-user-code').val('');$(".alert-add-teacher").setDatas(data.data);var researchAreaArr=[];var researchAreapkId=[];if(data.data.researchAreaData!=''){data.data.researchAreaData=JSON.parse(data.data.researchAreaData)}$.each(data.data.researchAreaData,function(a,b){researchAreaArr.push(b.researchAreaName);researchAreapkId.push(b.pkId)});researchAreapkId=researchAreapkId.join(',');researchAreaArr=researchAreaArr.join(',');$('#textTree').data('pkId',researchAreapkId);$('#textTree').val(researchAreaArr);var teacherUl=$(".file-id");var teacherLi="";var fileIdsArr=$.parseJSON(data.data.fileIds);me.oldTeacherData.fileIdsName=[];if(fileIdsArr.length>0){$.each(fileIdsArr,function(i,v){teacherLi+='<li><span class="file-name" style="margin-right: 50px;color:blue;cursor: pointer"><input type="hidden" class="file-span-id" value="'+v.pkId+'" >'+v.fileName+'</span><span class="cancal" style="cursor: pointer;">x</span></li>';teacherUl.html(teacherLi);me.oldTeacherData.fileIdsName.push(v.fileName)})}me.oldTeacherData.fileIdsName=me.oldTeacherData.fileIdsName.join(',');$('.alert-add-teacher .gender#radio'+data.data.gender).setRadioState("check");$('.alert-add-teacher .inspecting-user-code').setSelectVal(data.data.inspectingUserCode);$('.alert-add-teacher .intermediate-user-code').setSelectVal(data.data.intermediateUserCode);me.oldTeacherData.researchAreaText=researchAreaArr;me.oldTeacherData.inspectingUserText=$('.alert-add-teacher select.inspecting-user-code option:selected').text();me.oldTeacherData.intermediateUserText=$('.alert-add-teacher select.intermediate-user-code option:selected').text();me.oldTeacherData.papersTypeText=$('.alert-add-teacher select.papersTypeText option:selected').text();me.oldTeacherData.gender==1?me.oldTeacherData.genderVal='男':me.oldTeacherData.genderVal='女';$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading();$yt_alert_Model.prompt("获取失败")}},error:function(data){$yt_baseElement.hideLoading()}})},legalAdd:function(){$(".lawyer-opinion-box").show();$yt_alert_Model.getDivPosition($(".lawyer-opinion-box"));$yt_alert_Model.setFiexBoxHeight($(".alert-add-teacher form"));$yt_model_drag.modelDragEvent($(".lawyer-opinion-box .yt-edit-alert-title"));$('.lawyer-opinion-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".lawyer-opinion-box").hide();$("#pop-modle-alert").hide()})},pageToScroll:function(validObj){var scrollTopVal=0;$(validObj).each(function(){if($(this).text()!=""){if($(window).scrollTop()&&($(this).eq(0).parent().offset().top<$(window).scrollTop()||$(this).eq(0).parent().offset().top>$(window).height())){scrollTopVal=$(this).eq(0).parents().offset().top-30;$(window).scrollTop(scrollTopVal)}return false}})},teacherLogsName:{realName:'姓名',genderVal:'性别',researchAreaText:'专业领域',org:'单位',applyShift:'适用班次',title:'职称',isFormal:'编制',clerkPhone:'秘书手机',papersTypeText:'证件类型',clerkWorkPhone:'秘书电话',papersNumber:'证件号码',inspectingUserText:'考察人',phone:'手机号',intermediateUserText:'中间联系人',workPhone:'办公电话',dollarsStandardHalf:'课酬标准-半天',dollarsStandardOne:'课酬标准-天',fax:'传真',email:'邮箱',registeredBank:'开户行',orgAddress:'单位地址',account:'银行卡号',teacherDetails:'教师简介',fileIdsName:'附件',remarks:'备注',tableValue:'标签'},getLogInfo:function(objName,obj1,obj2){var logTestArr=[];if(obj1!=null){for(var keyName in objName){if(obj1[keyName]!=undefined&&obj2[keyName]!=undefined&&obj1[keyName]!=obj2[keyName]){obj2[keyName]=='请选择'?obj2[keyName]='':obj2[keyName]=obj2[keyName];obj1[keyName]=='请选择'?obj1[keyName]='':obj1[keyName]=obj1[keyName];logTestArr.push(objName[keyName]+"：“"+obj1[keyName]+"”修改为“"+obj2[keyName]+"”")}}}else{for(var keyName in objName){logTestArr.push(objName[keyName]+"：“"+obj2[keyName]+"”")}}console.log(logTestArr.join('；')+('；'));return logTestArr.join('；')+('；')}};$(function(){teacherList.init()});