var bankBillListInfo = {

	//初始化方法
	init: function() {
		//初始化列表
		//获取列表数据
		bankBillListInfo.getAlertListInfo();
		bankBillListInfo.getBillListInfo();
		bankBillListInfo.getBankStatementDetails();
		//流水单详情查看更多按钮
		$(".bank-more-div").click(function() {
			debugger
			if($(".payment-list").hasClass("hide")) {
				$(".bank-list-table").css("min-width", "100%");
			} else {
				$(".bank-list-table").css("min-width", "3500px");
			}
			$(".bank-th-hide").show();
			$(".bank-tbody-td").attr("colspan", "29");
			$(".project-more-div").click(function() {
				$(".bank-list-table").css("min-width", "3500px");
				$(".bank-tbody-td").attr("colspan", "32");
			});
			$(".bank-more-div").hide();
		});
		//无效流水单查看更多按钮
		$(".invalid-more-div").click(function() {
			$(".invalid-hide").show();
			$(".invalid-more-div").hide();
		});
		//项目详情查看更多按钮
		$(".project-more-div").click(function() {
			$(".project-th-hide").show();
			$(".bank-tbody-td").attr("colspan", "21");
			$(".bank-list-table").css("min-width", "2300px");
			$(".bank-more-div").click(function() {
				$(".bank-list-table").css("min-width", "3500px");
				$(".bank-tbody-td").attr("colspan", "32");
			});
			$(".project-more-div").hide();
		});
		//确认入账
		$(".account-entry-sure").click(function() {
			bankBillListInfo.accountEntryInfo("1");
		})
		//取消入账
		$(".account-entry-cancel").click(function() {
			bankBillListInfo.accountEntryInfo("0");
		})
		//取消入账
		$(".update-effective-true").click(function() {
			bankBillListInfo.updateEffectiveInfo("1");
		})
		//取消入账
		$(".update-effective-cancel").click(function() {
			bankBillListInfo.updateEffectiveInfo("0");
		})
		//公布认领
		$(".update-admission").click(function() {
			bankBillListInfo.updateAdmission("1");
		})
		//复选框
		//全选  
		$(".check-all").change(function() {
			//判断自己是否被选中  
			if($(this).parent().hasClass("check")) {
				//设置反选  
				$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck");
			} else {
				//调用设置选中方法,全选  
				$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check");
			}

		});

		//修改全选按钮状态
		$(".project-tbody").on("change", "input[type='checkbox']", function() {
			if($(this).parents("table").find("tbody input[type='checkbox']").length != $(this).parents("table").find("tbody input[type='checkbox']:checked").length) {
				$(this).parents("table").find(".check-all").setCheckBoxState("uncheck");
			} else {
				$(this).parents("table").find(".check-all").setCheckBoxState("check");
			}
		});
		//弹窗样式
		$(".admission-manual").click(function() {
			//其他班级弹窗样式设置
			$(".alert-table-div").show();
			$(".alert-div-input").show();
			$("#confiscate-amount").hide();
			$("#user-name").css({
				float: "left",
				'margin': "0px 0px 0px 20px"
			});
			$("#last-amount").css({
				float: "left",
				'margin': "0px 0px 0px 100px"
			});
			$("#form-class").css({
				float: "left",
				'margin': "0px 0px 0px 70px"
			});
			$(".select-teacher-div").width("1100px");
			$(".yt-edit-alert-main").height("736px");

			//显示选择所属项目弹出框
			$(".select-teacher-div").show();
			//查询选择所属项目列表
			//计算弹出框位置
			$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));
			$yt_alert_Model.getDivPosition($(".select-teacher-div"));
			$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));
			$("select").niceSelect();
			//取消按钮
			$('.select-teacher-canel-btn').click(function() {
				$(".yt-edit-alert,#heard-nav-bak").hide();
				$("#pop-modle-alert").hide();
			});
		});
		//弹窗确定按钮
		$(".admission-sure").click(function() {
			//其他班级弹窗样式设置
			$(".alert-table-div").hide();
			$(".alert-div-input").hide();
			$("#confiscate-amount").show();
			$("#user-name").css({
				float: "none",
				'margin': "8px 48px 8px 84px"
			});
			$("#last-amount").css({
				float: "none",
				'margin': "8px 0px 8px 42px"
			});
			$("#form-class").css({
				float: "none",
				'margin': "8px 48px 8px 84px"
			});
			$(".select-teacher-div").width("auto");
			$(".yt-edit-alert-main").height("auto");

			//显示选择所属项目弹出框
			$(".select-teacher-div").show();
			//查询选择所属项目列表
			//计算弹出框位置
			$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));
			$yt_alert_Model.getDivPosition($(".select-teacher-div"));
			$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));
			$("select").niceSelect();
			//取消按钮
			$('.select-teacher-canel-btn').click(function() {
				$(".yt-edit-alert,#heard-nav-bak").hide();
				$("#pop-modle-alert").hide();
			});
		});
	},
	/*	对账单详情*/
	getBankStatementDetails: function() {
		debugger
		var pkId = $yt_common.GetQueryString("pkId");
		$.ajax({
			url: $yt_option.base_path + "finance/bankStatement/getBankStatementDetails", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				pkId: pkId
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称 
			before: function() {
				$yt_baseElement.showLoading();
			},
			success: function(data) {
				if(data.flag == 0) {
					$(".bill-info-table").setDatas(data.data);
					/*无效流水单*/
					var htmlTr = "";
					var htmlTbody = $(".invalid-tbody");
					var noEffectiveList = JSON.parse(data.data.noEffectiveList);
					htmlTbody.empty();
					$.each(noEffectiveList, function(i, v) {
						htmlTr = '<tr>' +
							'<td>' + (i + 1) + '</td>' +
							'<td>' + v.exchangeHour + '</td>' +
							'<td class="invalid-hide" style="text-align:right;display:none">' + v.draw + '</td>' +
							'<td style="text-align:right;">' + v.income + '</td>' +
							'<td class="invalid-hide" style="text-align:right;display:none"">' + v.balance + '</td>' +
							'<td class="invalid-hide" style="display:none">' + v.currency + '</td>' +
							'<td>' + v.otherPartyName + '</td>' +
							'<td>' + v.otherPartyAccounts + '</td>' +
							'<td>' + v.otherPartyGroup + '</td>' +
							'<td class="invalid-hide" style="display:none">' + v.accountDate + '</td>' +
							'<td class="invalid-hide" style="display:none">' + v.bankTradeNumber + '</td>' +
							'<td class="invalid-hide" style="display:none">' + v.enterpriseTradeNumber + '</td>' +
							'<td class="invalid-hide" style="display:none">' + v.voucherType + '</td>' +
							'<td class="invalid-hide" style="display:none">' + v.voucherNo + '</td>' +
							'<td class="invalid-hide" style="display:none">' + v.associatedAccount + '</td>' +
							'<td class="invalid-hide" style="display:none">' + v.alias + '</td>' +
							'<td>' + v.abstractData + '</td>' +
							'<td>' + v.remarks + '</td>' +
							'</tr>';
						htmlTbody.append(htmlTr);
					});
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}
			}
		})
	},
	/**
	 * 对账单信息列表
	 */
	getBillListInfo: function() {
		$yt_baseElement.showLoading();
		var keyword = $('#keyword').val();
		var pkId = $yt_common.GetQueryString("pkId");
		$('.page-info').pageInfo({
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "finance/bankStatement/getBankStatementDetailsList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				selectParam: keyword,
				pkId: pkId,
				isAdmission: "2",
				isClaimUser: "2"
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			before: function() {
				$yt_baseElement.showLoading();
			},
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.project-tbody');
					var htmlTr = '';
					htmlTbody.empty();
					if(data.data.rows.length > 0) {
						$.each(data.data.rows, function(i, v) {
							$.each(data.data.rows, function(j, n) {
								if(i == j) {
									htmlTr += '<tr>' +
										'<td style="text-align: center;">' +
										'<label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test" class="pkId" value="' + v.pkId + '"/></label>' + '</td>' +
										'<td>' + (i + 1) + '</td>' +
										'<td>' + v.exchangeHour + '</td>' +
										'<td class="bank-th-hide" style="text-align:right;display:none">' + v.draw + '</td>' +
										'<td style="text-align:right">' + v.income + '</td>' +
										'<td class="bank-th-hide" style="text-align:right;display:none">' + v.balance + '</td>' +
										'<td class="bank-th-hide" style="display:none">' + v.currency + '</td>' +
										'<td>' + v.otherPartyName + '</td>' +
										'<td class="bank-th-hide" style="display:none">' + v.otherPartyAccounts + '</td>' +
										'<td class="bank-th-hide" style="display:none">' + v.otherPartyGroup + '</td>' +
										'<td class="bank-th-hide" style="display:none">' + v.accountDate + '</td>' +
										'<td class="bank-th-hide" style="display:none">' + v.abstractData + '</td>' +
										'<td>' + v.remarks + '</td>' +
										'<td class="bank-th-hide" style="display:none">' + v.enterpriseTradeNumber + '</td>' +
										'<td class="bank-th-hide" style="display:none">' + v.voucherType + '</td>' +
										'<td class="bank-th-hide" style="display:none">' + v.voucherNo + '</td>' +
										'<td class="bank-th-hide" style="display:none">' + v.associatedAccount + '</td>' +
										'<td class="bank-th-hide" style="display:none">' + v.alias + '</td>' +
										'<td>' + v.bankTradeNumber + '</td>' +
										'<td class="payment-list" style="border-bottom: 1px #fff solid;border-top: none;background: #FFFFFF;width: 10px;"></td>' +
										'<td class="project-th-hide payment-list" style="display: none;">' + '梁斌' + '</td>' +
										'<td class="project-th-hide payment-list" style="display: none;">' + '2018-01-24' + '</td>' +
										'<td class="payment-list">' + '第二期国企深化改革专题培训班' + '</td>' +
										'<td class="payment-list">' + '12.05--05.05' + '</td>' +
										'<td class="payment-list">' + j + '</td>' +
										'<td class="project-th-hide payment-list" style="display: none;">' + '倚天机构' + '</td>' +
										'<td class="payment-list" style="text-align:right;">' + '4,000.00' + '</td>' +
										'<td class="payment-list" style="text-align:right;">' + '10,000.00' + '</td>' +
										'<td class="payment-list" style="text-align:right;">' + '10,000.00' + '</td>' +
										'<td class="payment-list" style="text-align:right;">' + '0.00' + '</td>' +
										'<td class="payment-list">' + '已确认' + '</td>' +
										'<td class="payment-list">' + '杨欣' + '</td>' +
										'</tr>'
								}
							});
						});
						htmlTbody.html(htmlTr);
						if(data.data.paymentList.length == 0) {
							$(".payment-list").addClass("hide");
							$(".bank-list-table").css("width", "100%");
						}
					}
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	/**
	 * 弹窗对账单信息列表
	 */
	getAlertListInfo: function() {
		$yt_baseElement.showLoading();
		var keyword = $('#keyword').val();
		$('.page-info').pageInfo({
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "class/lookForAllByDistribution", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				selectParam: keyword
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			before: function() {
				$yt_baseElement.showLoading();
			},
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.company-tbody');
					var htmlTbody2 = $('.person-tbody');
					var htmlTr = '';
					var htmlTr2 = '';
					var num = 1;
					htmlTbody.empty();
					htmlTbody2.empty();
					if(data.data.rows.length > 0) {
						var states;
						var projectStates;
						$.each(data.data.rows, function(i, v) {
							htmlTr = '<tr>' +
								'<td style="text-align: center;">' +
								'<label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test" class="select-teacher-pkId" value="' +
								v.projectCode + '"/></label>' + '</td>' +
								'<td style="text-align:left">' + v.distributionDate + '</td>' +
								'<td style="text-align:right">' + v.distributionDate + '</td>' +
								'<td style="text-align:right">' + v.projectHead + '</td>' +
								'<td style="text-align:right">' + v.projectHead + '</td>' +
								'</tr>';
							htmlTr2 = '<tr>' +
								'<td style="text-align: center;">' +
								'<label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test" class="select-teacher-pkId" value="' +
								v.projectCode + '"/></label>' + '</td>' +
								'<td >' + v.checkInCount + '</td>' +
								'<td >' + v.distributionUser + '</td>' +
								'<td >' + v.checkInCount + '</td>' +
								'<td style="text-align:left">' + v.distributionDate + '</td>' +
								'<td style="text-align:left">' + v.distributionDate + '</td>' +
								'<td style="text-align:right">' + v.distributionDate + '</td>' +
								'<td style="text-align:right">' + v.projectHead + '</td>' +
								'<td style="text-align:right">' + v.projectHead + '</td>' +
								'</tr>';
							htmlTbody.append(htmlTr);
							htmlTbody2.append(htmlTr2);
						});
					}
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	//确认入账&取消入账
	accountEntryInfo: function(isAdmission) {
		var pkIds = "";
		$(".project-tbody").find('label input[type="checkbox"]:checked').each(function(i, v) {
			//获取选中状态行的数据
			debugger
			var pkId = $(this).val();
			console.log(pkId)
			if(i == 0) {
				pkIds = pkId;
			} else {
				pkIds += "," + pkId
			}
			//存储数据到外部数组
		});
		if(pkIds == "") {
			$yt_alert_Model.prompt("请选中对账单进行操作");
		} else {
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "finance/bankStatement/updateAdmission",
				data: {
					pkIds: pkIds,
					isAdmission: isAdmission
				},
				success: function(data) {
					if(data.flag == 0) {
						$yt_baseElement.hideLoading(function() {
							if(isAdmission == 1) {
								$yt_alert_Model.prompt("确认入账成功");
							} else {
								$yt_alert_Model.prompt("取消入账成功");
							}
						});
						$('.page-info').pageInfo("refresh");
					} else {
						$yt_baseElement.hideLoading(function() {
							if(isAdmission == 1) {
								$yt_alert_Model.prompt("确认入账失败");
							} else {
								$yt_alert_Model.prompt("取消入账失败");
							}
						});
					}
				}
			});
		}

	},
	//确认入账&取消入账
	updateEffectiveInfo: function(isEffective) {
		var pkIds = "";
		$(".project-tbody").find('label input[type="checkbox"]:checked').each(function(i, v) {
			//获取选中状态行的数据
			debugger
			var pkId = $(this).val();
			console.log(pkId)
			if(i == 0) {
				pkIds = pkId;
			} else {
				pkIds += "," + pkId
			}
			//存储数据到外部数组
		});
		if(pkIds == "") {
			$yt_alert_Model.prompt("请选中对账单进行操作");
		} else {
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "finance/bankStatement/updateAdmission",
				data: {
					pkIds: pkIds,
					isEffective: isEffective
				},
				success: function(data) {
					if(data.flag == 0) {
						$yt_baseElement.hideLoading(function() {
							if(isEffective == 1) {
								$yt_alert_Model.prompt("标记有效成功");
							} else {
								$yt_alert_Model.prompt("标记无效成功");
							}
						});
						$('.page-info').pageInfo("refresh");
					} else {
						$yt_baseElement.hideLoading(function() {
							if(isEffective == 1) {
								$yt_alert_Model.prompt("标记有效失败");
							} else {
								$yt_alert_Model.prompt("标记无效失败");
							}
						});
					}
				}
			});
		}

	},
	//公布认领
	updateAdmission: function(isPublish) {
		var pkIds = "";
		$(".project-tbody").find('label input[type="checkbox"]:checked').each(function(i, v) {
			//获取选中状态行的数据
			debugger
			var pkId = $(this).val();
			console.log(pkId)
			if(i == 0) {
				pkIds = pkId;
			} else {
				pkIds += "," + pkId
			}
			//存储数据到外部数组
		});
		if(pkIds == "") {
			$yt_alert_Model.prompt("请选中对账单进行操作");
		} else {
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "finance/bankStatement/updateAdmission",
				data: {
					pkIds: pkIds,
					isPublish: isPublish
				},
				success: function(data) {
					if(data.flag == 0) {
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("认领成功");
						});
						$('.page-info').pageInfo("refresh");
					} else {
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("认领失败");
						});
					}
				}
			});
		}

	},
}
$(function() {
	//初始化方法
	bankBillListInfo.init();
});