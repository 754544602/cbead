var addProjectList={init:function(){var projectType=$yt_common.GetQueryString('projectType');var pkId=$yt_common.GetQueryString('pkId');$('.add-title').text('新增项目');$('.documentCodeTd').hide();var judgeList=$yt_common.GetQueryString('judgeList');if(judgeList==1){if(pkId==null){$("option[value='3']").remove();$("option[value='4']").remove();$("option[value='5']").remove();$("option[value='']").remove()}else{if(projectType==2){$("option[value='3']").remove();$("option[value='4']").remove();$("option[value='5']").remove();$("option[value='']").remove()}else{$("option[value='2']").remove();if(projectType==3){$(".add-project-entrust-hidden").hide();$('.documentCodeTd').show()}}}}if(judgeList==2){if(pkId==null){$("option[value='2']").remove();if(projectType==3){$(".add-project-entrust-hidden").hide();$('.documentCodeTd').show()}}else{if(projectType==2){$("option[value='3']").remove();$("option[value='4']").remove();$("option[value='5']").remove();$("option[value='']").remove()}else{$("option[value='2']").remove();if(projectType==3){$(".add-project-entrust-hidden").hide();$('.documentCodeTd').show()}}}}$(".yt-select").niceSelect();$('.customer-trainee-sum').blur(function(){this.value=this.value.replace(/\D/g,'')});$(".start-date").calendar({controlId:"startDate",nowData:false,upperLimit:$(".end-date"),callback:function(){var atartDate=$("input.start-date").val();if(atartDate!=""){$("input.start-date").removeClass("valid-hint");$("input.start-date").next().text("")}if($(".start-date").val()!=''&&$(".end-date").val()!=''){var endDate=new Date($(".end-date").val());var startDate=new Date($(".start-date").val());var date=endDate.getTime()-startDate;$('.train-date').val((date/1000/60/60/24)+1)}}});$(".end-date").calendar({controlId:"endDate",nowData:false,lowerLimit:$(".start-date"),callback:function(){var endDate=$("input.end-date").val();if(endDate!=""){$("input.end-date").removeClass("valid-hint");$("input.end-date").next().text("")}if($(".start-date").val()!=''&&$(".end-date").val()!=''){var endDate=new Date($(".end-date").val());var startDate=new Date($(".start-date").val());var date=endDate.getTime()-startDate;$('.train-date').val((date/1000/60/60/24)+1)}}});$(".project-type").change(function(){if($(".project-type").val()==4||$(".project-type").val()==2||$(".project-type").val()==5){$(".add-project-entrust-hidden").show();$('.documentCodeTd').hide()}else{$('.documentCodeTd').show();$(".add-project-entrust-hidden").hide()}});$(".project-sell").change(function(){$(".project-sell").removeClass("valid-hint");$("div.project-sell").next().text("")});addProjectList.getUserDataByDynamicKey();if(pkId!=null){addProjectList.getProjectInf();$(".btn-sub").on('click',function(){if(projectType==3){if($yt_valid.validForm($('.project-table'))){addProjectList.amendProjectListInf()}}else{if($yt_valid.validForm($('.class-info-table td:visible'))){addProjectList.amendProjectListInf()}}});$(".btn-off").on('click',function(){$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"是否取消保存已修改的信息！",confirmFunction:function(){window.history.back()}})})}else{$('.btn-sub').off().click(function(){var inp=$('.box-list input');$.each(inp,function(i,n){if($(this).val()==""){$(this).addClass('null-input')}else{$(this).removeClass('null-input')}});var addType=$(".project-type").val();var projectName=$(".project-name").val();var projectType=$(".project-type").val();var startDate=$(".start-date").val();var endDate=$(".end-date").val();var trainDate=$(".train-date").val();var details=$(".details").val();if(addType==3){if($yt_valid.validForm($('.project-table'))){addProjectList.addProjectListInf()}else{$(document).scrollTop(200)}}else{if($yt_valid.validForm($('.class-info-table td:visible'))){addProjectList.addProjectListInf()}else{$(document).scrollTop($(".null-input").eq(0).offset().top)}}});$(".btn-off").on('click',function(){$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"是否取消保存已修改的信息！",confirmFunction:function(){window.history.back()}})})}$('.group-td').click(function(){$('.receive-group-div').show();addProjectList.getListSelectGroup()});$('.receive-group-canel-btn').off().click(function(){$('.receive-group-div').hide()});$('.receive-group-sure-btn').off().click(function(){if($('.receive-group-div .yt-table-active')[0]){$('.group-id').val($('.receive-group-div .yt-table-active td').attr('groupId'));$('.group-name').val($('.receive-group-div .yt-table-active td').text());$('.receive-group-div').hide()}else{$yt_alert_Model.prompt('请选择集团单位')}});$('.receive-group-div .receive-group-btn-img').off().click(function(){addProjectList.getListSelectGroup()});var treeAllPersonal=addProjectList.getTreeAllPersonnel();if(treeAllPersonal!=null){$.each(treeAllPersonal,function(i,n){if(n.type==3){$(".project-sell").append('<option value="'+n.textName+'">'+n.text+'</option>')}})}$("select.project-sell").niceSelect({search:true,backFunction:function(text){$("select.project-sell option").remove();if(text==""){$("select.project-sell").append('<option value="">请选择</option>')}$.each(treeAllPersonal,function(i,n){if(n.text.indexOf(text)!=-1){if(n.type==3){$("select.project-sell").append('<option value="'+n.textName+'">'+n.text+'</option>')}}})}})},getUserDataByDynamicKey:function(){var userInfo={};var token=$yt_common.getToken();$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsersDetails",async:true,success:function(data){$(".project-sell").setSelectVal($yt_common.user_info.userName)}})},getListSelectGroup:function(){$('.receive-group-page').pageInfo({type:"post",url:$yt_option.base_path+"class/noticeReception/getGroups",async:true,pageIndexs:1,pageNum:15,before:function(){$yt_baseElement.showLoading()},data:{groupName:$('.receive-group-search').val()},success:function(data){$yt_baseElement.hideLoading();if(data.flag==0){var tr='';$('.receive-group-tbody').empty();$.each(data.data.rows,function(i,n){tr='<tr><td groupId="'+n.groupId+'">'+n.groupName+'</td></tr>';$('.receive-group-tbody').append(tr)});$yt_alert_Model.setFiexBoxHeight($(".receive-group-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".receive-group-div"));$yt_model_drag.modelDragEvent($(".receive-group-div .yt-edit-alert-title"))}else{$yt_alert_Model.prompt('查询失败')}},error:function(){$yt_baseElement.hideLoading();$yt_alert_Model.prompt('查询失败')},isSelPageNum:true })},getTreeAllPersonnel:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsers",data:{},async:false,success:function(data){list=data.data||[]}});return list},addProjectListInf:function(){$yt_baseElement.showLoading();var projectName=$(".project-name").val();var projectType=$(".project-type").val();var projectSell=$(".project-sell").val();var startDate=$(".start-date").val();var endDate=$(".end-date").val();var trainDate=$(".train-date").val();var details=$(".details").val();var groupId=$(".group-id").val();var customerDept=$(".customer-dept").val();var customerLinkman=$(".customer-linkman").val();var customerLinkmanPosition=$(".customer-linkman-position").val();var customerLinkmanPhone=$(".customer-linkman-phone").val();var customerLinkmanCellphone=$(".customer-linkman-cellphone").val();var customerLinkmanFax=$(".customer-linkman-fax").val();var customerLinkmanEmail=$(".customer-linkman-email").val();var customerTraineePosition=$(".customer-trainee-position").val();var customerTraineeSum=$(".customer-trainee-sum").val();var customerTraineeAgeStructure=$(".customer-trainee-age").val();var customerTargetDemand=$(".customer-target-demand").val();var documentCode=$('.documentCode').val();projectType==3?documentCode=documentCode:documentCode='';$.ajax({async:true,type:"post",url:$yt_option.base_path+"project/addOrUpdateBean",beforeSend:function(){$yt_baseElement.showLoading()},data:{projectName:projectName,projectType:projectType,projectSell:projectSell,startDate:startDate,endDate:endDate,trainDate:trainDate,details:details,groupId:groupId,customerDept:customerDept,customerLinkman:customerLinkman,customerLinkmanPosition:customerLinkmanPosition,customerLinkmanPhone:customerLinkmanPhone,customerLinkmanCellphone:customerLinkmanCellphone,customerLinkmanFax:customerLinkmanFax,customerLinkmanEmail:customerLinkmanEmail,customerTraineePosition:customerTraineePosition,customerTraineeSum:customerTraineeSum,customerTraineeAgeStructure:customerTraineeAgeStructure,customerTargetDemand:customerTargetDemand,documentCode:documentCode},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("新增成功");$(".btn-all").hide();$yt_baseElement.hideLoading();window.history.back()}else{$yt_alert_Model.prompt("新增失败");$yt_baseElement.hideLoading()}}})},getProjectInf:function(){var pkId=$yt_common.GetQueryString('pkId');$.ajax({type:"post",url:$yt_option.base_path+"project/getBeanById",data:{pkId:pkId},beforeSend:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$('.add-title').text('修改项目');$(".get-project-inf").setDatas(data.data);$(".project-type").setSelectVal(data.data.projectType);$(".project-sell").setSelectVal(data.data.projectSell);$(".group-id").setSelectVal(data.data.groupId);if($(".project-type").val()==4){$(".add-project-entrust-hidden").show()}if(pkId!=null){$('.projectTypeVel').text($('select.project-type option:selected').text());$('.project-type').hide()}$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("获取失败");$yt_baseElement.hideLoading()}}})},amendProjectListInf:function(){var pkId=$yt_common.GetQueryString('pkId');var projectName=$(".get-project-inf .project-name").val();var projectType=$(".get-project-inf .project-type").val();var projectSell=$(".get-project-inf .project-sell").val();var startDate=$(".get-project-inf .start-date").val();var endDate=$(".get-project-inf .end-date").val();var trainDate=$(".get-project-inf .train-date").val();var details=$(".get-project-inf .details").val();var groupId=$(".get-project-inf .group-id").val();var groupName=$(".group-id option:selected").text();var customerDept=$(".get-project-inf .customer-dept").val();var customerLinkman=$(".get-project-inf .customer-linkman").val();var customerLinkmanPosition=$(".get-project-inf .customer-linkman-position").val();var customerLinkmanPhone=$(".get-project-inf .customer-linkman-phone").val();var customerLinkmanCellphone=$(".get-project-inf .customer-linkman-cellphone").val();var customerLinkmanFax=$(".get-project-inf .customer-linkman-fax").val();var customerLinkmanEmail=$(".get-project-inf .customer-linkman-email").val();var customerTraineePosition=$(".get-project-inf .customer-trainee-position").val();var customerTraineeSum=$(".get-project-inf .customer-trainee-sum").val();var customerTraineeAgeStructure=$(".get-project-inf .customer-trainee-age").val();var customerTargetDemand=$(".get-project-inf .customer-target-demand").val();var documentCode=$('.documentCode').val();projectType==3?documentCode=documentCode:documentCode=undefined;$.ajax({type:"post",url:$yt_option.base_path+"project/addOrUpdateBean",beforeSend:function(){$yt_baseElement.showLoading()},data:{pkId:pkId,projectName:projectName,projectType:projectType,projectSell:projectSell,startDate:startDate,endDate:endDate,trainDate:trainDate,details:details,groupId:groupId,groupName:groupName,customerDept:customerDept,customerLinkman:customerLinkman,customerLinkmanPosition:customerLinkmanPosition,customerLinkmanPhone:customerLinkmanPhone,customerLinkmanCellphone:customerLinkmanCellphone,customerLinkmanFax:customerLinkmanFax,customerLinkmanEmail:customerLinkmanEmail,customerTraineePosition:customerTraineePosition,customerTraineeSum:customerTraineeSum,customerTraineeAgeStructure:customerTraineeAgeStructure,customerTargetDemand:customerTargetDemand,documentCode:documentCode},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("修改成功");window.history.back();$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("修改失败");$yt_baseElement.hideLoading()}}})},pageToScroll:function(validObj){var scrollTopVal=0;$(validObj).each(function(){if($(this).text()!=""){if($(window).scrollTop()&&($(this).eq(0).parent().offset().top<$(window).scrollTop()||$(this).eq(0).parent().offset().top>$(window).height())){scrollTopVal=$(this).eq(0).parents().offset().top-30;$(window).scrollTop(scrollTopVal)}return false}})}};$(function(){addProjectList.init()});