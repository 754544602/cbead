var projectList={init:function(){var judgeList=1;$(".add-list").on('click',function(){window.location.href="addProjectList.html?judgeList=1"});$(".update-list").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要修改的数据");return false}window.location.href="addProjectList.html?pkId="+$('.yt-table-active .pkId').val()+"&judgeList=1"});$(".project-tbody").on('click',".file-name",function(){window.location.href="projectDetails.html?pkId="+$('.yt-table-active .pkId').val()+"&tp="+1+"&projectCode="+$('.yt-table-active .projectCodeText').val()+"&projectCodeList="+$('.yt-table-active .project-code-list').text()+"&judgeList=1"});$(".delete-list").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要删除的数据");return false}projectList.delProjectList()});$(".project-application").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}var dealingWithPeople=projectList.getListSelectDealingWithPeople();if(dealingWithPeople!=null){$.each(dealingWithPeople,function(i,n){$(".dealing-with-people").append('<option value="'+n.userCode+'">'+n.userName+'</option>')})}$(".dealing-with-people").niceSelect();projectList.projectApplicationAlert();var realName=$(".yt-table-active .project-name").text();$(".real-name").text(realName);$(".project-application-alert .yt-model-sure-btn").click(function(){projectList.projectApplicationList()})});$(".cancel-list").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}else if($(".yt-table-active .project-states-text").text()=="已取消"){$yt_alert_Model.prompt("请选择未被取消的项目");return false}else{projectList.offProjectList()}});$(".regain-list").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}else if($(".yt-table-active .project-states-text").text()!="已取消"){$yt_alert_Model.prompt("请选择已取消的数据");return false}else{projectList.restoreProjectList()}});projectList.getProjectListInfo();$('.search-btn').click(function(){projectList.getProjectListInfo()})},getListSelectDealingWithPeople:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"project",processInstanceId:"",parameters:"",versionNum:""},async:false,success:function(data){$.each(data.data,function(i,n){for(var k in n){list=n[k]}})}});return list},getProjectListInfo:function(){$yt_baseElement.showLoading();var projectCode=$('#keyword').val();var projectName=$('#keyword').val();var projectSell=$('#keyword').val();var projectHead=$('#keyword').val();$('.project-page').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"project/lookForAll",type:"post",data:{projectCode:projectCode,projectName:projectName,projectType:"",projectSell:projectSell,projectHead:projectHead,projectStates:"",startTimeStart:"",startTimeEnd:"",endTimeStart:"",endTimeEnd:""},objName:'data',success:function(data){$yt_baseElement.showLoading();if(data.flag==0){var htmlTbody=$('.project-tbody');var htmlTr='';var projectCodeText="";if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){projectCodeText=v.projectCode;if(v.trainDateCount==null){v.trainDateCount=""}if(v.projectType==1){v.projectType="计划"}else if(v.projectType==2){v.projectType="委托"}else if(v.projectType==3){v.projectType="选学"}else if(v.projectType==4){v.projectType="调训"}var projectStates=v.projectStates;if(projectStates==1){projectStates='未立项'}if(projectStates==2){projectStates='审批中'}if(projectStates==3){projectStates='未通过'}if(projectStates==4){projectStates='已立项'}if(projectStates==5){projectStates='培训中'}if(projectStates==6){projectStates='未结项'}if(projectStates==7){projectStates='已结项'}if(projectStates==8){projectStates='已取消'}if(v.projectType=="委托"){if(v.projectStates<4||v.projectStates==8){v.projectCode=""}else{v.projectCode=v.projectCode}}htmlTr+='<tr><td class="project-code-list" style="word-wrap:break-word;"><input type="hidden" value="'+v.pkId+'" class="pkId">'+v.projectCode+'</td><td class="project-name" style="text-align: left;"><a class="file-name" style="color:#3c4687">'+v.projectName+'</a></td><td><input type="hidden" value="'+projectCodeText+'" class="projectCodeText">'+v.projectType+'</td><td>'+v.startDate+'</td><td style="text-align: right;">'+v.trainDateCount+'</td><td style="text-align: left;">'+v.projectSell+'</td><td style="text-align: left;">'+v.projectHead+'</td><td style="text-align: right;">'+v.traineeCount+'</td><td class="project-states-text">'+projectStates+'</td></tr>';$(".project-page").show()})}else{$(".project-page").hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},delProjectList:function(){var pkId=$('.yt-table-active .pkId').val();$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"project/deleteProject",data:{pkId:pkId},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("删除成功");$('.project-page').pageInfo("refresh")}else{$yt_alert_Model.prompt("删除失败")}}})}})},offProjectList:function(){var pkId=$('.yt-table-active .pkId').val();$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"是否取消该项目并通知项目负责人?",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"project/updateProjectDataStates",data:{pkId:pkId,type:2},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("已取消");$('.project-page').pageInfo("refresh")}else{$yt_alert_Model.prompt("操作失败")}}})}})},restoreProjectList:function(){var pkId=$('.yt-table-active .pkId').val();$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"是否恢复该项目并通知项目负责人?",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"project/updateProjectDataStates",data:{pkId:pkId,type:1},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("已恢复");$('.project-page').pageInfo("refresh")}else{$yt_alert_Model.prompt("操作失败")}}})}})},projectApplicationList:function(){var validFlag=$yt_valid.validForm($(".valid-tab"));if(validFlag){}else{}var pkId=$(".yt-table-active .pkId").val();var remarks=$(".project-application-alert .remarks").val();var dealingWithPeople=$(".project-application-alert .dealing-with-people").val();$.ajax({type:"post",url:$yt_option.base_path+"project/addOrApprovalProject",data:{pkId:pkId,remarks:remarks,businessCode:"project",dealingWithPeople:dealingWithPeople,opintion:"",processInstanceId:"",nextCode:"submited"},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("操作成功");$(".yt-edit-alert").hide();$('.project-page').pageInfo("refresh")}else{$yt_alert_Model.prompt("操作失败")}}})},projectApplicationAlert:function(){$(".lawyer-opinion-box").show();$yt_alert_Model.getDivPosition($(".lawyer-opinion-box"));$yt_model_drag.modelDragEvent($(".lawyer-opinion-box .yt-edit-alert-title"));$('.lawyer-opinion-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".lawyer-opinion-box").hide();$("#pop-modle-alert").hide()})}};$(function(){projectList.init()});