var projectDetails = {
	//初始化方法
	init: function() {
		//获取页面跳转传过来的值
		var pkId = $yt_common.GetQueryString("pkId");
		var projectCode = $yt_common.GetQueryString("projectCode");
		var projectType = $yt_common.GetQueryString("projectType");
		if(projectType==3 || projectType==2 || projectType==1){
			$(".other-income-btn").hide();
		}
		//点击返回
		$('.page-return-btn').click(function(){
			window.location.href = "projectSettlementList.html";
		});
		//调用获取列表数据方法
		projectDetails.getStudetListInfo();
		$(".settlement-tbody").on(".project-name", "click", function() {
			window.location.href = "projectSettlementList.html";
		});
		//点击学员姓名查看详情
		$('.amend-expense-list').click(function() {
			if($("tr.yt-table-active").length == 0) {
				$yt_alert_Model.prompt("请选择要修改的数据");
				return false;
			}
			/** 
			 * 显示编辑弹出框和显示顶部隐藏蒙层 
			 */
			$(".student-details-form").show();
			/** 
			 * 调用算取div显示位置方法 
			 */
			$yt_alert_Model.setFiexBoxHeight($(".student-details-form .yt-edit-alert-main"));
			$yt_alert_Model.getDivPosition($(".student-details-form"));
			/* 
			 * 调用支持拖拽的方法 
			 */
			$yt_model_drag.modelDragEvent($(".student-details-form .yt-edit-alert-title"));
			/*
			 给弹出框赋值
			 * */
			var realName = $(".yt-table-active").data('data').realName;
			var groupNum =$(".yt-table-active").data('data').groupNum;
			var gender = $(".yt-table-active").data('data').gender;
			var phone = $(".yt-table-active").data('data').phone;
			var idNumber = $(".yt-table-active").data('data').idNumber;
			var groupName = $(".yt-table-active").data('data').groupName;
			var groupOrgName = $(".yt-table-active").data('data').groupOrgName;
			var deptPosition = $(".yt-table-active").data('data').deptPosition;
			var roomNumber = $(".yt-table-active").data('data').roomNumber;
			var trainingExpenseNegotiatedPrice = $(".yt-table-active").data('data').trainingExpenseNegotiatedPrice;
			var quarterageNegotiatedPrice = $(".yt-table-active").data('data').quarterageNegotiatedPrice;
			var mealFeeNegotiatedPrice = $(".yt-table-active").data('data').mealFeeNegotiatedPrice;
			var incidental = $(".yt-table-active").data('data').incidental;
			var traineeId = $(".yt-table-active").data('data').traineeId;
			var numberDinner = Number($(".yt-table-active").data('data').breakfastFor)+Number($(".yt-table-active").data('data').numberLunch)+Number($(".yt-table-active").data('data').numberDinner);
			var otherCost = $(".yt-table-active").data('data').otherCost;
			console.log(traineeId)
			 $(".student-details-form .realName").text(realName);
			 $(".student-details-form .groupNum").text(groupNum);
			 $(".student-details-form .gender").text(gender);
			 $(".student-details-form .phone").text(phone);
			 $(".student-details-form .idNumber").text(idNumber);
			 $(".student-details-form .groupName").text(groupName);
			 $(".student-details-form .groupOrgName").text(groupOrgName);
			 $(".student-details-form .deptPosition").text(deptPosition);
			 $(".student-details-form .roomNumber").text(roomNumber);
			 $(".student-details-form .training-expense-negotiated-price-input").val(trainingExpenseNegotiatedPrice);
			 $(".student-details-form .quarterage-negotiated-price-input").val(quarterageNegotiatedPrice);
			 $(".student-details-form .meal-fee-negotiated-price-input").val(mealFeeNegotiatedPrice);
			 $(".student-details-form .incidental-input").val(incidental);
			 $(".student-details-form .traineeId-hidden-input").val(traineeId);
			 var projectType = $yt_common.GetQueryString("projectType");
				if(projectType==3 || projectType==2 ){
					$(".student-details-form .training-expense-negotiated-price-hidden-input").val(trainingExpenseNegotiatedPrice);
					$(".student-details-form .quarterage-negotiated-price-hidden-input").val(quarterageNegotiatedPrice);
					$(".student-details-form .meal-fee-negotiated-price-hidden-input").val(mealFeeNegotiatedPrice);
					$(".student-details-form .incidental-hidden-input").val(incidental);
				}else if(projectType ==4){   
					$(".student-details-form .meal-fee-negotiated-price-input").val(numberDinner);
					$(".student-details-form .incidental-input").val(otherCost);
				}
			/** 
			 * 点击确定方法
			 */
			$('.update-student-sure-btn').off().on("click", function() {
				projectDetails.amendExpenseList();
			});
			/** 
			 * 点击取消方法 
			 */
			$('.update-student-canel-btn').off().on("click", function() {
				//隐藏页面中自定义的表单内容  
				$(".student-details-form").hide();
			});
		});
		//项目支出确定按钮
		$('.expenditure-sure-btn').click(function() {
			$yt_baseElement.showLoading();
			var costCode = "";
			var spendMoney = "";
			var details = "";
			var otherCostJsonArr = [];
			//遍历获取List<Map>对象
			$(".otherCost-tbody tr").each(function(i, n) {
				costCode = $(n).find(".costCode").text();
				spendMoney = $(n).find(".spendMoney").val();
				details = $(n).find(".details").val();
				var otherCostArr = {
					costCode: costCode,
					spendMoney: spendMoney,
					details: details
				}
				otherCostJsonArr.push(otherCostArr);
			});
			var otherCost = JSON.stringify(otherCostJsonArr);
			//执行接口方法
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "finance/settlement/addExpenditure",
				data: {
					otherCost: otherCost
				},
				async: false,
				success: function(data) {
					if(data.flag == 0) {
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("添加成功");
							projectExpenditureList.getExpenditureListInf();
						});

					} else {
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("添加失败");
							projectExpenditureList.getExpenditureListInf();
						});
					}
				}
			});
		});
		//页签切换
		$(".tab-title-list button").click(function() {
			//var divIndex; 
			$(this).addClass("active").siblings().removeClass("active");
			$(".box-list .content-box").hide().eq($(this).index()).show();
			//班级信息页签
			if($(this).index() == 0) {
				projectDetails.getStudetListInfo();
				$('#project-main').css("min-width","1200px");
			} else if($(this).index() == 1) {
				if(projectType == 2 || projectType == 3){
					projectDetails.getStudentCostsList();
					projectDetails.getCheckList();
					projectDetails.getCompanyList();
					$('#project-main').css("min-width","1366px");
				}else{
					$(".project-expenses-list").hide();
					projectDetails.getStudentCostsList1();
					projectDetails.getCompanyList1();
					$('#project-main').css("min-width","1200px");
				}
				$(".project-student-tbody").on("click", ".cost-details", function() {
					//显示选择所属项目弹出框
					$(".select-teacher-div").show();
					//计算弹出框位置
					$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));
					$yt_alert_Model.getDivPosition($(".select-teacher-div"));
					$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));
					//取消按钮
					$('.select-teacher-canel-btn').click(function() {
						$(".yt-edit-alert,#heard-nav-bak").hide();
						$("#pop-modle-alert").hide();
					});
				});
			} else if($(this).index() == 2) {
				$('#project-main').css("min-width","1200px");
				if(projectType == 2 || projectType == 3){
					$(".project-income-study").show();
					$(".project-revenue training").hide();
					projectDetails.getIncomesList();
					projectDetails.getIncomeCostsList();
					projectDetails.getTotalList();
				}else{
					$(".project-income-study").hide();
					$(".project-revenue training").show();
					projectDetails.projectRevenueTraining();
				}
			} else if($(this).index() == 3) {
				$('#project-main').css("min-width","1200px");
				projectDetails.getOtherIncomeList();
			} else if($(this).index() == 4) {
				$('#project-main').css("min-width","1200px");
				projectDetails.getExpenditureListInf();
			}
		});
	},
	/**
	 * 获取班级信息
	 */
	getStudetListInfo: function() {
		var pkId = $yt_common.GetQueryString("pkId");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type: "post",
			url: $yt_option.base_path + "project/getBeanById",
			async: true,
			data: {
				pkId:pkId
			},
			objName: 'data',
			success: function(data) {
				if(data.flag == 0) {
					if(data.data.projectType == 1) {
						data.data.projectType = "计划";
					} else if(data.data.projectType == 2) {
						data.data.projectType = "委托";
					} else if(data.data.projectType == 3) {
						data.data.projectType = "选学";
						$(".projectType-2").hide();
					} else if(data.data.projectType == 4) {
						data.data.projectType = "调训";
					}
					$('.project-code').text(data.data.projectCode);
					$('.project-name').text(data.data.projectName);
					$('.project-type').text(data.data.projectType);
					$('.project-sell').text(data.data.projectSell);
					$('.start-date').text(data.data.startDate);
					$('.end-date').text(data.data.endDate);
					$('.details').text(data.data.details);
					$('.train-date').text(data.data.trainDate);
					$('.customer-unit').text(data.data.groupName);
					$('.customer-dept').text(data.data.customerDept);
					$('.customer-linkman').text(data.data.customerLinkman);
					$('.customer-linkman-position').text(data.data.customerLinkmanPosition);
					$('.customer-linkman-phone').text(data.data.customerLinkmanPhone);
					$('.customer-linkman-cellphone').text(data.data.customerLinkmanCellphone);
					$('.customer-linkman-fax').text(data.data.customerLinkmanFax);
					$('.customer-linkman-email').text(data.data.customerLinkmanEmail);
					$('.customer-trainee-position').text(data.data.customerTraineePosition);
					$('.customer-trainee-sum').text(data.data.customerTraineeSum);
					$('.customer-trainee-age-structure').text(data.data.customerTraineeAgeStructure);
					$('.customer-target-demand').text(data.data.customerTargetDemand);
					$('.project-sell').text(data.data.projectSellName);
					$('.project-head').text(data.data.projectHeadName);
					$('.class-teacher').text(data.data.projectHeadmasterName);
					$('.project-aid').text(data.data.projectAidName);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}
			}
		});
	},
	/**
	 * 项目结算清单
	 */
	getCheckList: function() {
		$yt_baseElement.showLoading();
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			async: true,
			url: $yt_option.base_path + "finance/settlement/getDetailedList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.project-check-List-tbody');
					var htmlTr = '';
					$(htmlTbody).empty()
						$.each(data.data.settlementDetailedList, function(i, v) {
							htmlTr += '<tr>' +
								'<td>' + (i + 1) + '</td>' +
								'<td style="text-align:left;">' + v.name + '</td>' +
								'<td style="text-align:right;word-wrap:break-word;">' + v.amountReceivableTotal + '</td>' +
								'<td style="text-align:right;word-wrap:break-word;">' + v.amountReceivableNoTax + '</td>' +
								'<td style="text-align:right;word-wrap:break-word;">' + v.amountReceivableTax + '</td>' +
								'<td style="text-align:right;word-wrap:break-word;">' + v.netReceiptsTotal + '</td>' +
								'<td style="text-align:right;word-wrap:break-word;">' + v.netReceiptsNoTax + '</td>' +
								'<td style="text-align:right;word-wrap:break-word;">' + v.netReceiptsTax + '</td>' +
								'<td style="text-align:right;word-wrap:break-word;">' + v.uncollectedTotal + '</td>' +
								'<td style="text-align:right;word-wrap:break-word;">' + v.uncollectedNoTax + '</td>' +
								'<td style="text-align:right;word-wrap:break-word;">' + v.uncollectedTax + '</td>' +
								'</tr>';
						});
						htmlTbody.html(htmlTr);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  

		});
	},
	/**
	 * 单位支付信息
	 */
	getCompanyList: function() {
		$yt_baseElement.showLoading();
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			async: true,
			url: $yt_option.base_path + "finance/settlement/getDetailedList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.project-company-tbody');
					var htmlTr = '';
					var htmlPlan = '';
					var amountReceivableSum = 0;
					var netReceiptsSum = 0;
					var uncollectedSum = 0;
					$(htmlTbody).empty();
						$.each(data.data.settlementGroupDetails, function(i, v) {
							htmlTr += '<tr>' +
								'<td style="text-align:left;">' + v.groupName + '</td>' +
								'<td class="should" style="text-align:right;word-wrap:break-word;">' + v.amountReceivable + '</td>' +
								'<td class="already" style="text-align:right;word-wrap:break-word;">' + v.netReceipts + '</td>' +
								'<td class="account" style="text-align:right;word-wrap:break-word;">' + v.uncollected + '</td>' +
								'</tr>';
							amountReceivableSum += v.amountReceivable;
							netReceiptsSum += v.netReceipts;
							uncollectedSum += v.uncollected;
						});
						htmlTbody.html(htmlTr);
						htmlPlan += '<tr>' +
							'<td style="font-weight: bold;">' + "小计" + '</td>' +
							'<td style="text-align:right;font-weight: bold;">' + amountReceivableSum + '</td>' +
							'<td style="text-align:right;font-weight: bold;">' + netReceiptsSum + '</td>' +
							'<td style="text-align:right;font-weight: bold;">' + uncollectedSum + '</td>' +
							'</tr>';
						htmlTbody.append(htmlPlan)
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  

		});
	},
	/**
	 * 费用清单：费用详情列表
	 */
	getStudentCostsList: function() {
		var selectParam = $('.selectParam').val();
		var projectCode = $yt_common.GetQueryString("projectCode");
		$('.project-student-page').pageInfo({
			async: true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "finance/settlement/getDetailedPersonalList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode,
				selectParam: selectParam,
				trainingExpenseStart: "",
				trainingExpenseEnd: "",
				traineeNegotiatedPriceStart: "",
				traineeNegotiatedPriceEnd: "",
				quarterageStart: "",
				quarterageEnd: "",
				mealFeeStart: "",
				mealFeeEnd: "",
				otherChargesStart: "",
				otherChargesEnd: "",
				uncollectedStart: "",
				uncollectedEnd: ""
			}, //ajax查询访问参数
			before: function() {
				$yt_baseElement.showLoading();
			},
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.project-student-tbody');
					var htmlTrSelection = '';
					var htmlTrBreak = '';
					$(htmlTbody).empty()
					if(data.data.rows.length > 0) {
						$.each(data.data.rows, function(i, v) {
							htmlTrSelection += '<tr>' +
								'<td class="groupNum"><input type="hidden" value="' + v.headPortraitUrl + '" class="headPortraitUrl">' + v.groupNum + '</td>' +
								'<td class="realName"><a class="stu-realname-look-info" style="color: #3c4687;"><input type="hidden" value="' + v.gender + '" class="gender">' + v.realName + '</a></td>' +
								'<td class="groupOrgName" style="text-align:left"><input type="hidden" value="' + v.phone + '" class="phone">' + v.groupOrgName + '</td>' +
								'<td class="roomNumber"><input type="hidden" value="' + v.idNumber + '" class="idNumber">' + v.roomNumber + '</td>' +
								'<td style="text-align:right" class="trainingExpenseNegotiatedPrice"><input type="hidden" value="' + v.idNumber + '" class="idNumber">' + v.trainingExpenseNegotiatedPrice + '</td>' +
								'<td style="text-align:right"><input type="hidden" value="' + v.deptPosition + '" class="deptPosition">' + v.traineeNegotiatedPrice + '</td>' +
								'<td style="text-align:right" class="quarterageNegotiatedPrice"><input type="hidden" value="' + v.traineeId + '" class="traineeId">' + v.quarterageNegotiatedPrice + '</td>' +
								'<td style="text-align:right" class="mealFeeNegotiatedPrice">' + v.mealFeeNegotiatedPrice + '</td>' +
								'<td style="text-align:right" class="incidental">' + v.incidental + '</td>' +
								'<td style="text-align:right">' + v.smallPlan + '</td>' +
								'<td style="text-align:right">' + v.cash + '</td>' +
								'<td style="text-align:right">' + v.creditCard + '</td>' +
								'<td style="text-align:right">' + v.wireTransfer + '</td>' +
								'<td style="text-align:right">' + v.moneyTotal + '</td>' +
								'<td style="text-align:right">' + v.uncollected + '</td>' +
								'</tr>';
								htmlTrSelection = $(htmlTrSelection).data("data",v);
								htmlTbody.append(htmlTrSelection);
						});
							$(".detailed-hide-break").hide();
							$(".detailed-hide-selection").show();
					}
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	/**
	 * 项目结算清单
	 */
	/**
	 * 单位支付信息
	 */
	getCompanyList1: function() {
		$yt_baseElement.showLoading();
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			async: true,
			url: $yt_option.base_path + "finance/settlement/getNoDetailedList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.project-company-tbody');
					var htmlTr = '';
					var htmlPlan = '';
					var amountReceivableSum = 0;
					var netReceiptsSum = 0;
					var uncollectedSum = 0;
					$(htmlTbody).empty();
						$.each(data.data, function(i, v) {
							htmlTr += '<tr>' +
								'<td style="text-align:left;">' + v.groupName + '</td>' +
								'<td class="should" style="text-align:right;word-wrap:break-word;">' + v.amountReceivable + '</td>' +
								'<td class="already" style="text-align:right;word-wrap:break-word;">' + v.netReceipts + '</td>' +
								'<td class="account" style="text-align:right;word-wrap:break-word;">' + v.uncollected + '</td>' +
								'</tr>';
							amountReceivableSum += v.amountReceivable;
							netReceiptsSum += v.netReceipts;
							uncollectedSum += v.uncollected;
						});
						htmlTbody.html(htmlTr);
						htmlPlan += '<tr>' +
							'<td style="font-weight: bold;">' + "小计" + '</td>' +
							'<td style="text-align:right;font-weight: bold;">' + amountReceivableSum + '</td>' +
							'<td style="text-align:right;font-weight: bold;">' + netReceiptsSum + '</td>' +
							'<td style="text-align:right;font-weight: bold;">' + uncollectedSum + '</td>' +
							'</tr>';
						htmlTbody.append(htmlPlan)
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  

		});
	},
	/**
	 * 费用清单：费用详情列表
	 */
	getStudentCostsList1: function() {
		var selectParam = $('.selectParam').val();
		var projectCode = $yt_common.GetQueryString("projectCode");
		$('.project-student-page').pageInfo({
			async: true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "finance/settlement/getNoDetailedPersonalList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				selectParam: selectParam,
				projectCode:projectCode,
				breakfastForStart:"",
				breakfastForEnd:"",
				numberLunchStart:"",
				numberLunchEnd:"",
				numberDinnerStart:"",
				numberDinnerEnd:"",
				otherChargesStart:"",
				otherChargesEnd:""
			}, //ajax查询访问参数
			before: function() {
				$yt_baseElement.showLoading();
			},
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.project-student-tbody');
					var htmlTrSelection = '';
					var htmlTrBreak = '';
					$(htmlTbody).empty()
					if(data.data.rows.length > 0) {
						$.each(data.data.rows, function(i, v) {
							htmlTrBreak = '<tr>' +
								'<td>' + v.groupNum + '</td>' +
								'<td><a style="color: #3c4687;">' + v.realName + '</a></td>' +
								'<td style="text-align:left">' + v.groupOrgName + '</td>' +
								'<td>' + v.roomNumber + '</td>' + 
								'<td style="text-align:right">' + v.breakfastFor + '</td>' +
								'<td style="text-align:right">' + v.numberLunch + '</td>' +
								'<td style="text-align:right">' + v.numberDinner + '</td>' +
								'<td style="text-align:right">' + v.otherCost + '</td>' +
								'<td><a style="color: #3c4687;" class="cost-details" href="#">' + "详情" + '</a></td>' +
								'</tr>';
								htmlTrBreak = $(htmlTrBreak).data('data',v);
								htmlTbody.append(htmlTrBreak);
						});
							$(".detailed-hide-selection").hide();
							$(".detailed-hide-break").show();
							
					}
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	//修改费用清单
	amendExpenseList:function(){
		var projectCode = $yt_common.GetQueryString("projectCode");
		var traineeId = $(".student-details-form .traineeId-hidden-input").val();
		var costData = "";
		var costDataArr = [];
		$(".cost-of-listing tr td").each(function (i,n){
			var costType = "";
			var costOld = "";
			var costNew = "";
			costType = $(n).find("span>input").val();
			costOld = $(n).find("input.hidden-input").val();
			costNew = $(n).find("input.yt-input").val();
				
			var arrCouncil={
				costType:costType,
				costOld:costOld,
				costNew:costNew
			}
			costDataArr.push(arrCouncil);
		});
		//var costData = JSON.stringify(costDataArr);
		
		$.ajax({
			url: $yt_option.base_path + "finance/settlement/addTraineeCost", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode,
				traineeId: traineeId,
				costData: costDataArr
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("修改成功");
						$(".student-details-form").hide();
					});
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("修改失败");
						$(".student-details-form").hide();
					});
				}

			}, //回调函数 匿名函数返回查询结果  
		});
	},
	/**
	 * 项目收入
	 */
	getIncomesList: function() {
		var selectParam = $('.selectParam').val();
		var projectCode = $yt_common.GetQueryString("projectCode");
		$('.project-student-page').pageInfo({
			async: true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "finance/settlement/getIncomeList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				selectParam: selectParam,
				projectCode:projectCode
			}, //ajax查询访问参数
			before: function() {
				$yt_baseElement.showLoading();
			},
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					$(".actual").text(data.data.amountReceivabletotal);
					$(".must").text(data.data.netReceiptsTotal);
					var htmlTbody = $('.project-income-student-tbody');
					var htmlTr = '';
					$(htmlTbody).empty();
					if(data.data.rows.length > 0) {
						$.each(data.data.rows, function(i, v) {
							htmlTr += '<tr>' +
								'<td>' + v.groupNum + '</td>' +
								'<td><a style="color: #3c4687;">' + v.realName + '</a></td>' +
								'<td style="text-align:left">' + v.groupOrgName + '</td>' +
								'<td style="text-align:right">' + v.trainingExpenseNegotiatedPrice + '</td>' +
								'<td style="text-align:right">' + v.traineeNegotiatedPrice + '</td>' +
								'<td style="text-align:right">' + v.quarterageNegotiatedPrice + '</td>' +
								'<td style="text-align:right">' + v.mealFeeNegotiatedPrice + '</td>' +
								'<td style="text-align:right">' + v.incidental + '</td>' +
								'<td style="text-align:right">' + v.smallPlan + '</td>' +
								'<td style="text-align:right">' + v.cash + '</td>' +
								'<td style="text-align:right">' + v.creditCard + '</td>' +
								'<td style="text-align:right">' + v.wireTransfer + '</td>' +
								'<td style="text-align:right">' + v.moneyTotal + '</td>' +
								'</tr>';
						});
						if(true) {
							$(".income-hide").show();
							htmlTbody.html(htmlTr);
						} else {
							$(".income-hide").hide();
						}
					}
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	/**
	 * 项目收入：费用减免情况
	 */
	getIncomeCostsList: function() {
		var selectParam = $('.selectParam').val();
		var projectCode = $yt_common.GetQueryString("projectCode");
		$('.project-income-page').pageInfo({
			async: true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "finance/settlement/getIncomeDetailsList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				selectParam: selectParam,
				projectCode:projectCode
			}, //ajax查询访问参数
			before: function() {
				$yt_baseElement.showLoading();
			},
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.project-income-cost-tbody');
					var htmlTr = '';
					$(htmlTbody).empty()
					if(data.data.rows.length > 0) {
						$.each(data.data.rows, function(i, v) {
							if(v.groupNum==null){
								v.groupNum = ""
							}
							htmlTr += '<tr>' +
								'<td>' + v.groupNum + '</td>' +
								'<td><a style="color: #3c4687;">' + v.realName + '</a></td>' +
								'<td style="text-align:left">' + v.groupOrgName + '</td>' +
								'<td style="text-align:right">' + v.rackRate + '</td>' +
								'<td style="text-align:right">' + v.negotiatedPrice + '</td>' +
								'<td style="text-align:right">' + v.checkInDate + '</td>' +
								'<td style="text-align:right">' + v.postRemissionMoney + '</td>' +
								'</tr>';
						});
					};
					htmlTbody.html(htmlTr);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	/**
	 * 总计各项减免
	 */
	getTotalList: function() {
		$yt_baseElement.showLoading();
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			async: true,
			url: $yt_option.base_path + "finance/settlement/getDetailedReduction", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.project-total-cost-tbody');
					var htmlTr = '';
					$(htmlTbody).empty()
					htmlTr = '<tr>' +
							'<td>培训费减免</td>' +
							'<td style="text-align:right;">' + data.data.trainingExpenseReduction + '</td>' +
							'<td>' +'<img style="margin-right: 2px;" src="../../resources/images/icons/amend.png">'+ '</td>' +
							'</tr>'+
							'<tr>' +
							'<td>课程费减免</td>' +
							'<td style="text-align:right;">' + data.data.traineeNegotiatedPriceReduction + '</td>' +
							'<td>' +'<img style="margin-right: 2px;" src="../../resources/images/icons/amend.png">'+ '</td>' +
							'</tr>'+
							'<tr>' +
							'<td>住宿费减免</td>' +
							'<td style="text-align:right;">' + data.data.quarterageReduction + '</td>' +
							'<td>' +'<img style="margin-right: 2px;" src="../../resources/images/icons/amend.png">'+ '</td>' +
							'</tr>'+
							'<tr>' +
							'<td>餐费减免</td>' +
							'<td style="text-align:right;">' + data.data.mealFeeReduction + '</td>' +
							'<td>' +'<img style="margin-right: 2px;" src="../../resources/images/icons/amend.png">'+ '</td>' +
							'</tr>'+
							'<tr>' +
							'<td>杂费减免</td>' +
							'<td style="text-align:right;">' + data.data.otherChargesReduction + '</td>' +
							'<td>' +'<img style="margin-right: 2px;" src="../../resources/images/icons/amend.png">'+ '</td>' +
							'</tr>';
						htmlTbody.html(htmlTr);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  

		});
	},
	//项目收入调巡
	projectRevenueTraining: function() {
		$yt_baseElement.showLoading();
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			async: true,
			url: $yt_option.base_path + "finance/settlement/getNoDetailedList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.project-revenue-training-tbody');
					var htmlTr = '';
					$(htmlTbody).empty();
						$.each(data.data, function(i, v) {
							htmlTr += '<tr>' +
								'<td style="text-align:left;">' + i + '</td>' +
								'<td class="should" style="text-align:right;word-wrap:break-word;">' + v.groupName + '</td>' +
								'<td class="already" style="text-align:right;word-wrap:break-word;">' + v.amountReceivable + '</td>' +
								'<td class="account" style="text-align:right;word-wrap:break-word;">' + v.netReceipts + '</td>' +
								'</tr>';
						});
						htmlTbody.html(htmlTr);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  

		});
	},
	/**
	 * 其他收入
	 */
	getOtherIncomeList: function() {
		var projectCode = $yt_common.GetQueryString("projectCode");
		var selectParam = $('#keyword').val();
		$('.project-student-page').pageInfo({
			async: true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "finance/settlement/getNoDetailedPersonalList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				selectParam: selectParam,
				projectCode:projectCode,
				breakfastForStart:"",
				breakfastForEnd:"",
				numberLunchStart:"",
				numberLunchEnd:"",
				numberDinnerStart:"",
				numberDinnerEnd:"",
				otherChargesStart:"",
				otherChargesEnd:""
			}, //ajax查询访问参数
			before: function() {
				$yt_baseElement.showLoading();
			},
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					$(".other-receivables").text(data.data.otherCostTotal);
					$(".other-paid-in").text(data.data.netReceiptsTotal);
					var htmlTbody = $('.project-income-other-tbody');
					var htmlTrSelection = '';
					$(htmlTbody).empty()
					if(data.data.rows.length > 0) {
						$.each(data.data.rows, function(i, v) {
							htmlTrSelection += '<tr>' +
								'<td>' + v.groupNum + '</td>' +
								'<td><a style="color: #3c4687;">' + v.realName + '</a></td>' +
								'<td style="text-align:left">' + v.groupOrgName + '</td>' +
								'<td style="text-align:right;">' + v.otherCost + '</td>' +
								'<td style="text-align:right;">' + v.netReceipts + '</td>' +
								'</tr>';
						});
						if(true) {
							$(".income-hide").show();
							htmlTbody.html(htmlTrSelection);
						} else {
							$(".income-hide").hide();
						}
					}
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	/**
	 * 获取项目支出列表数据
	 */
	getExpenditureListInf: function() {
		$yt_baseElement.showLoading();
		$.ajax({
			type: "post",
			url: $yt_option.base_path + "finance/settlement/getExpenditure",
			async: true,
			data: {},
			objName: 'data',
			success: function(data) {
				if(data.flag == 0) {
					var expenseDetails = data.data.expenseDetails;
					var expenseClassDetails = data.data.expenseClassDetails;
					var otherCost = data.data.otherCost;
					var expenseDetailsTbody = $('.expenseDetails-tbody');
					var expenseDetailsTr = '';
					var expenseClassDetailsTbody = $('.expenseClassDetails-tbody');
					var expenseClassDetailsTr = '';
					var otherCostTbody = $('.otherCost-tbody');
					var otherCostTr = '';

					var faresNum = 0;
					var changeFeeRefundNum = 0;
					var expenseMoneyNum = 0;
					$.each(expenseDetails, function(i, v) {
						expenseDetailsTr += '<tr>' +
							'<td>' + v.teacherId + '</td>' +
							'<td>' + v.teacherName + '</td>' +
							'<td>' + v.flighttrainNumber + '</td>' +
							'<td>' + v.placeDeparture + '</td>' +
							'<td>' + v.bourn + '</td>' +
							'<td>' + v.startEndTime + '</td>' +
							'<td style="text-align:right;">' + v.fares + '</td>' +
							'<td style="text-align:right;">' + v.changeFeeRefund + '</td>' +
							'<td style="text-align:right;">' + v.changeFeeRefundDetails + '</td>' +
							'<td style="text-align:right;">' + v.expenseMoney + '</td>' +
							'</tr>';
						faresNum += v.fares;
						changeFeeRefundNum += v.changeFeeRefund;
						expenseMoneyNum += v.expenseMoney;
					});
					expenseDetailsTr += '<tr>' +
						'<td>合计</td>' +
						'<td></td>' +
						'<td></td>' +
						'<td></td>' +
						'<td></td>' +
						'<td></td>' +
						'<td style="text-align:right;">' + faresNum + '</td>' +
						'<td></td>' +
						'<td style="text-align:right;">' + changeFeeRefundNum + '</td>' +
						'<td style="text-align:right;">' + expenseMoneyNum + '</td>' +
						'</tr>';
					expenseDetailsTbody.html(expenseDetailsTr);
					var afterTaxNum = 0;
					var surrenderPersonalNum = 0;
					var expenseMoneyNum = 0;
					$.each(expenseClassDetails, function(i, v) {
						i +=1;
						expenseClassDetailsTr += '<tr>' +
							'<td><input type="hidden" value="' + v.teacherId + '" class="teacherId">' + i + '</td>' +
							'<td>' + v.teacherName + '</td>' +
							'<td>' + v.papersType + '</td>' +
							'<td>' + v.papersNumber + '</td>' +
							'<td>' + v.registeredBank + '</td>' +
							'<td>' + v.account + '</td>' +
							'<td>' + v.courseDate + '</td>' +
							'<td style="text-align:right;">' + v.afterTax + '</td>' +
							'<td style="text-align:right;">' + v.surrenderPersonal + '</td>' +
							'<td style="text-align:right;">' + v.expenseMoney + '</td>' +
							'</tr>';
						afterTaxNum += v.afterTax;
						surrenderPersonalNum += v.surrenderPersonal;
						expenseMoneyNum += v.expenseMoney;
					});
					expenseClassDetailsTr += '<tr>' +
						'<td>合计</td>' +
						'<td></td>' +
						'<td></td>' +
						'<td></td>' +
						'<td></td>' +
						'<td></td>' +
						'<td></td>' +
						'<td style="text-align:right;">' + afterTaxNum + '</td>' +
						'<td style="text-align:right;">' + surrenderPersonalNum + '</td>' +
						'<td style="text-align:right;">' + expenseMoneyNum + '</td>' +
						'</tr>';
					expenseClassDetailsTbody.html(expenseClassDetailsTr);
					var spendMoneyNum = 0;
					$.each(otherCost, function(i, v) {
						otherCostTr += '<tr>' +
							'<td class="costCode">' + (i+1) + '</td>' +
							'<td>' + v.costName + '</td>' +
							'<td style="padding: 0px;"><input type="number" class="spendMoney" style="width: 99%;height: 30px;border-radius: 2px;border:1px solid #dfe6f3;" value="' + v.spendMoney + '" /></td>' +
							'<td style="padding: 0px;"><input class="details" style="width: 99%;height: 30px;border-radius: 2px;border:1px solid #dfe6f3;" value="' + v.details + '" /></td>' +
							'</tr>';
						spendMoneyNum += v.spendMoney;
					});
					otherCostTr += '<tr>' +
						'<td></td>' +
						'<td>合计</td>' +
						'<td style="text-align: left;" class = "spendMoneyTotal">' + spendMoneyNum + '</td>' +
						'<td></td>' +
						'</tr>';
					otherCostTbody.html(otherCostTr);
					//其他费用总计
					$("input.spendMoney").blur(function() {
						var firstSpendMoney = 0;
						$("input.spendMoney").each(function(i, n) {
							firstSpendMoney = firstSpendMoney + parseFloat($(n).val());
						});
						$('.spendMoneyTotal').text(firstSpendMoney);
					});
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				};
			}
		});
	}
}
$(function() {
	//初始化方法
	projectDetails.init();

});