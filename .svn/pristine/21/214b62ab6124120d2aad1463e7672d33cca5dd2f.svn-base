/**
 * 非选学班次问卷
 */
var quList={init:function(){quList.getPlanListInfo();var num="";$('.approval-select').niceSelect();$('.title-content').on('click','.content-update-name',function(){$('.update-choose').removeClass('update-choose');$(this).parent().addClass("update-choose");$(this).parent().parent().addClass("update-choose");num=1;quList.formClear();quList.showAlert5();quList.updateQuewtion()});$('.title-content').on('click','.title-update-name',function(){$(this).parent().find('.title-name-input').removeAttr('disabled')});$('.title-content').on('click','.approval-add-div',function(){num="";$('.select-choose').removeClass('select-choose');$(this).addClass("select-choose");quList.formClear();quList.showAlert5()});$('.form-bottom-btn').on('click',function(){var html='<div style="margin-left:65px;width: 615px;padding:10px 0px"><input class="yt-input delete-icon-input choose-content-input" style="float: none;"  placeholder="请输入" /><img src="../../resources/images/icons/t-del.png"/></div>';$('.form-bottom-btn').before(html)});$('.form-bottom-content').on('click','img',function(){$(this).parent().remove()});$('.page-return-btn').on('click',function(){location.href="questionMsg.html"});$('.approval-canel-bottom').on('click',function(){location.href="questionMsg.html"});$('.approval-submit').on('click',function(){quList.submitBtn()});$('.form-sure-btn').on('click',function(){if(num==""){quList.spellHtml(num)}else{quList.spellHtml(num)}});$('.approval-select').on('change',function(){quList.selectSwitch()})},submitBtn:function(){var templateData=[];var itemsDetailsJson=[];var itemDetailsSpecific=[];var remarks="";var pkId=$yt_common.GetQueryString("pkId");$('.tab-content').each(function(q,e){itemsDetailsJson=[];var states=$(e).find('div:eq(0)').find('.yt-checkbox.check input').val();var questionnaireTemplateId=$(e).find('.item-question-id').val();var itemCode=$(e).find('.item-code').val();var itemName=$(e).find('.title-name-input').val();var itemOrder=$(e).find('.item-order').val();$(e).find('.topic-div').each(function(w,r){itemDetailsSpecific=[];var queStates=$(r).find('.yt-checkbox.check input').val();var pkId=$(r).find('.quest-pk-id').val();if(pkId==null){pkId=""}var title=$(r).find('.que-title').text();var itemId=$(r).parent().parent().find('.item-pk-id').val();var types=$(r).find('.quest-type').val();$(r).find('.que-choose').each(function(a,b){var pkId=$(b).find('.option-pk-id').val();if(pkId==null){pkId=""}var itemDetailsId=$(b).parent().parent().find('.quest-pk-id').val();if(itemDetailsId==null){itemDetailsId=""}var specificValue=$(b).text();if(specificValue==null){specificValue=""}var identification=$(b).next('.option-identification').val();if(identification==null){identification=""}var contentList3={pkId:pkId,itemDetailsId:itemDetailsId,specificValue:specificValue,states:states,identification:identification};itemDetailsSpecific.push(contentList3)});var contentList2={pkId:pkId,itemId:itemId,types:types,title:title,states:queStates,itemDetailsSpecific:itemDetailsSpecific};itemsDetailsJson.push(contentList2);itemDetailsSpecific=JSON.stringify(itemDetailsSpecific)});itemsDetailsJson=JSON.stringify(itemsDetailsJson);var contentList={questionnaireTemplateId:questionnaireTemplateId,itemCode:itemCode,itemName:itemName,states:states,itemOrder:itemOrder,remarks:remarks,itemsDetailsJson:itemsDetailsJson};templateData.push(contentList)});templateData=JSON.stringify(templateData);console.log(templateData);$.ajax({type:"post",url:$yt_option.base_path+"questionnaire/updateBeanById",data:{templateData:templateData},async:true,success:function(data){if(data.flag==0){$yt_baseElement.pageLoadingShow();$yt_baseElement.pageLoadingHide();$yt_alert_Model.prompt("操作成功");setTimeout("location.href = 'questionMsg.html';",1000)}else{$yt_alert_Model.prompt("操作失败")}}})},updateQuewtion:function(){var queType=$('.radio-title-approval.update-choose').find('.que-type').text();var queTitle=$('.radio-title-approval.update-choose').find('.que-title').text();var queChoose=[];var chooseId=[];$('.radio-title-approval.update-choose').next().find('.que-choose').each(function(){var listId=$(this).find('.option-pk-id').val();var list=$(this).text();queChoose.push(list);chooseId.push(listId)});if(queType=="【单选】"){$('.choose-tr').show();$('.form-bottom-content').show();queType=2;$('.approval-select').setSelectVal(queType);$('.choose-content-input').val(queChoose[0]);$('.option-id').val(chooseId[0]);if(queChoose.length>=2){$('.radio-title-approval.update-choose').next().find('.que-choose').each(function(i,n){if(i>0){var formHtml='<div style="margin-left:65px;width: 615px;padding:10px 0px"><input class="yt-input delete-icon-input choose-content-input" style="float: none;"  value="'+$(n).text()+'" /><input type="hidden" class="option-id" value="'+($(n).find("input").val())+'"><img src="../../resources/images/icons/t-del.png"/></div>';$('.form-bottom-btn').before(formHtml)}})}}else if(queType=="【评分】"){$('.choose-tr').hide();$('.form-bottom-content').hide();queType=1;$('.approval-select').setSelectVal(queType);}else if(queType=="【多选】"){$('.choose-tr').show();$('.form-bottom-content').show();queType=3;$('.approval-select').setSelectVal(queType);$('.choose-content-input').val(queChoose[0]);if(queChoose.length>=2){$('.radio-title-approval.update-choose').next().find('.que-choose').each(function(i,n){if(i>0){var formHtml='<div style="margin-left:65px;width: 615px;padding:10px 0px"><input class="yt-input delete-icon-input choose-content-input" style="float: none;"  value="'+$(n).text()+'" /><input type="hidden" class="option-id" value="'+($(n).find("input").val())+'"><img src="../../resources/images/icons/t-del.png"/></div>';$('.form-bottom-btn').before(formHtml)}})}}else if(queType=="【开放】"){$('.choose-tr').hide();$('.form-bottom-content').hide();queType=4;$('.approval-select').setSelectVal(queType)}$('.title-content-input').val(queTitle)},formClear:function(){$('.choose-tr').hide();$('.form-bottom-content').hide();$('.approval-select').setSelectVal(1);$('.title-content-input').val("");$('.choose-content-input').val("");$('.form-bottom-content').find('img').parent().remove()},spellHtml:function(num){var typeName=$('.approval-select').val();var titleName=$('.title-content-input').val();var chooseName=[];var optionId=[];$('.choose-content-input').each(function(){var chooseNames=$(this).val();chooseName.push(chooseNames)});$('.options-pk-id').each(function(){optionId.push($(this).val())});var chooseList=$('.delete-icon-input').val();var approvalHtml='';var addInfo=$('.add-info.select-choose');var updateInfo=$('.topic-div.update-choose');if(typeName==1){typeName="评分";if(num==""){approvalHtml='<div class="topic-div"><input type="hidden" class="quest-type" value="1"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div  style="display: inline-block;"><span class="que-type" style="color: #6495BC;">【'+typeName+'】</span><span class="que-title">'+titleName+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div></div></div>'}else{approvalHtml='<input type="hidden" class="quest-type" value="1"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div  style="display: inline-block;"><span class="que-type" style="color: #6495BC;">【'+typeName+'】</span><span class="que-title">'+titleName+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div></div>'}}else if(typeName==2){typeName="单选";if(num==""){approvalHtml='<div class="topic-div"><input type="hidden" class="quest-type" value="2"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div style="display: inline-block;"><span class="que-type" style="color: #6495BC;">【'+typeName+'】</span><span class="que-title">'+titleName+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div><div class="radio-approval" style="margin-left:85px">';$('.choose-content-input').each(function(j,m){approvalHtml+='<p class="que-choose" style="width:fit-content;"><input type="hidden" class="option-pk-id"  value="'+($(m).next().val())+'"/>'+($(m).val())+'</p>'});approvalHtml+='</div></div></div>'}else{approvalHtml='<input type="hidden" class="quest-type" value="2"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div style="display: inline-block;"><span class="que-type" style="color: #6495BC;">【'+typeName+'】</span><span class="que-title">'+titleName+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div><div class="radio-approval" style="margin-left:85px">';$('.choose-content-input').each(function(j,m){approvalHtml+='<p class="que-choose" style="width:fit-content;"><input type="hidden" class="option-pk-id"  value="'+($(m).next().val())+'"/>'+($(m).val())+'</p>'});approvalHtml+='</div></div>'}}else if(typeName==3){typeName="多选";if(num==""){approvalHtml='<div class="topic-div"><input type="hidden" class="quest-type" value="3"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div style="display: inline-block;"><span class="que-type" style="color: #6495BC;">【'+typeName+'】</span><span class="que-title">'+titleName+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div><div class="radio-approval" style="margin-left:85px">';$('.choose-content-input').each(function(j,m){approvalHtml+='<p class="que-choose" style="width:fit-content;"><input type="hidden" class="option-pk-id"  value="'+($(m).next().val())+'"/>'+($(m).val())+'</p>'});approvalHtml+='</div></div></div>'}else{approvalHtml='<input type="hidden" class="quest-type" value="3"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div style="display: inline-block;"><span class="que-type" style="color: #6495BC;">【'+typeName+'】</span><span class="que-title">'+titleName+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div><div class="radio-approval" style="margin-left:85px">';$('.choose-content-input').each(function(j,m){approvalHtml+='<p class="que-choose" style="width:fit-content;"><input type="hidden" class="option-pk-id"  value="'+($(m).next().val())+'"/>'+($(m).val())+'</p>'});approvalHtml+='</div></div>'}}else if(typeName==4){typeName="开放";if(num==""){approvalHtml='<div class="topic-div"><input type="hidden" class="quest-type" value="4"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div style="display: inline-block;"><span class="que-type" style="color: #6495BC;">【'+typeName+'】</span><span class="que-title">'+titleName+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div></div></div>'}else{approvalHtml='<input type="hidden" class="quest-type" value="4"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div style="display: inline-block;"><span class="que-type" style="color: #6495BC;">【'+typeName+'】</span><span class="que-title">'+titleName+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div></div>'}}if(num==""){addInfo.before(approvalHtml);$(".yt-edit-alert,#heard-nav-bak").hide()}else{var questPkId=updateInfo.find('.quest-pk-id').length;if(questPkId!=0){updateInfo.find('.quest-pk-id').nextAll().remove()}else{updateInfo.empty()}updateInfo.append(approvalHtml);$(".yt-edit-alert,#heard-nav-bak").hide()}},selectSwitch:function(){var selectVal=$('.approval-select').val();if(selectVal==1||selectVal==4){$('.choose-tr').hide();$('.form-bottom-content').hide()}else{$('.choose-tr').show();$('.form-bottom-content').show()}},showAlert5:function(){$(".yt-edit-alert,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($(".yt-edit-alert"));$yt_model_drag.modelDragEvent($(".yt-edit-alert .yt-edit-alert-title"));$('.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},getPlanListInfo:function(){var pkId=$yt_common.GetQueryString("pkId");var itemVal="";var inputVal="";$.ajax({url:$yt_option.base_path+"questionnaire/getBeanById",type:"post",data:{pkId:pkId},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.title-content');var htmlTr='';var formList=[];if(data.data.length>0){$.each(data.data,function(i,v){formList=$.parseJSON(v.itemsDetailsJson);htmlTr='<div class="tab-content"><input type="hidden" class="item-order" value="'+v.itemOrder+'"/><input type="hidden" class="item-pk-id" value="'+v.pkId+'"/><input type="hidden" class="item-question-id" value="'+v.questionnaireTemplateId+'"/><div style="height: 36px;position: relative;width:1066px;"><span class="title-icon1-approval"></span><span class="title-icon2-approval"></span><input type="hidden" class="item-code" value="'+v.itemCode+'"/><input class="title-name-input" disabled="disabled" value="'+v.itemName+'"></input><span class="title-update-name "><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改<label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label></span><div class="title-line-approval"></div></div><div class="q-info" style="width: 775px;margin: 0px auto;"><div class="tr-add-icon add-info approval-add-div"><span>+</span><span style="font-size: 14px;">新增问卷</span></div></div></div>';htmlTr=$(htmlTr);if(v.remarks!=""){itemVal='<div class="radio-title-approval" style="height:30px" ><span>'+v.remarks+'</span></div>';htmlTr.find(".q-info .add-info").before(itemVal)}if(v.itemsDetailsJson!=null){$.each($.parseJSON(v.itemsDetailsJson),function(j,n){if(n.types==5){itemVal='<div class="topic-div"><div class="title-nam-approval" style="width: 860px;clear: both;	"><input type="hidden" class="quest-pk-id" value="'+n.pkId+'"/><input type="hidden" class="quest-type" value="5"/><input type="hidden" class="quest-item-id" value="'+n.itemId+'"/><span class="que-title" style="position: relative;top: -53px;">'+n.title+'</span></div></div>';htmlTr.find(".q-info .add-info").before(itemVal);itemVal=$('<div class="radio-approval" style="margin:0px;display:inline-block;"></div>');if(n.itemDetailsSpecific!=null){$.each($.parseJSON(n.itemDetailsSpecific),function(a,b){itemVal.append('<input type="hidden" class="option-identification"  value="'+b.identification+'"/><input type="hidden" class="option-pk-id"  value="'+b.pkId+'"/><input type="hidden" class="option-item-details-id"  value="'+b.itemDetailsId+'"/>');itemVal.append('<textarea class="yt-textarea approval-textarea que-choose" >'+b.specificValue+'</textarea>')})}htmlTr.find('.title-nam-approval .que-title').after(itemVal);if(v.itemCode=="other"){htmlTr.find('.title-nam-approval').addClass('approval-end-text');htmlTr.find('.approval-add-div').remove();htmlTr.find('.q-info').addClass('q-info-bottom');}}else if(n.types==2){itemVal='<div class="topic-div"><input type="hidden" class="quest-pk-id" value="'+n.pkId+'"/><input type="hidden" class="quest-type" value="2"/><input type="hidden" class="quest-item-id" value="'+n.itemId+'"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div style="display: inline-block;float: left;"><span class="que-type" style="color: #6495BC;">【单选】</span><span class="que-title">'+n.title+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div></div>';htmlTr.find(".q-info .add-info").before(itemVal);itemVal=$('<div class="radio-approval" style="margin-left:85px"></div>');if(n.itemDetailsSpecific!=null){$.each($.parseJSON(n.itemDetailsSpecific),function(k,m){itemVal.append('<input type="hidden" class="option-identification"  value="'+m.identification+'"/><input type="hidden" class="option-item-details-id"  value="'+m.itemDetailsId+'"/>');itemVal.append('<p class="que-choose" style="width:fit-content;"><input type="hidden" class="option-pk-id"  value="'+m.pkId+'"/>'+m.specificValue+'</p>');})}htmlTr.find(".q-info .add-info").prev().append(itemVal);}else if(n.types==1){itemVal='<div class="topic-div"><input type="hidden" class="quest-pk-id" value="'+n.pkId+'"/><input type="hidden" class="quest-type" value="1"/><input type="hidden" class="quest-item-id" value="'+n.itemId+'"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div style="display: inline-block;float: left;"><span class="que-type" style="color: #6495BC;">【评分】</span><span class="que-title">'+n.title+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div></div>';htmlTr.find(".q-info .add-info").before(itemVal);}else if(n.types==4){itemVal='<div class="topic-div"><input type="hidden" class="quest-pk-id" value="'+n.pkId+'"/><input type="hidden" class="quest-type" value="4"/><input type="hidden" class="quest-item-id" value="'+n.itemId+'"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div style="display: inline-block;float: left;"><span class="que-type" style="color: #6495BC;">【开放】</span><span class="que-title">'+n.title+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div></div>';htmlTr.find(".q-info .add-info").before(itemVal);}else if(n.types==6){itemVal='<div class="topic-div"><div class="radio-title-approval"><input type="hidden" class="quest-pk-id" value="'+n.pkId+'"/><input type="hidden" class="quest-type" value="6"/><input type="hidden" class="quest-item-id" value="'+n.itemId+'"/><div style="display: inline-block;"><span class="spe-title">'+n.title+'</span></div></div></div>';htmlTr.find(".q-info").append(itemVal);itemVal=$('<div class="radio-approval"></div>');if(n.itemDetailsSpecific!=null){$.each($.parseJSON(n.itemDetailsSpecific),function(k,m){itemVal.append('<input type="hidden" class="option-identification"  value="'+m.identification+'"/><input type="hidden" class="option-item-details-id"  value="'+m.itemDetailsId+'"/>');itemVal.append('<p class="que-choose" style="width:fit-content;"><input type="hidden" class="option-pk-id"  value="'+m.pkId+'"/>'+m.specificValue+'</p>')})}htmlTr.find(".radio-title-approval .spe-title").append(itemVal);}else if(n.type==3){itemVal='<div class="topic-div"><input type="hidden" class="quest-pk-id" value="'+n.pkId+'"/><input type="hidden" class="quest-type" value="3"/><input type="hidden" class="quest-item-id" value="'+n.itemId+'"/><label class="check-label yt-checkbox check"><input id="checkBox2" type="checkbox" name="test" value="1"/></label><div class="radio-title-approval" style="height: 20px;"><div style="display: inline-block;float: left;"><span class="que-type" style="color: #6495BC;">【多选】</span><span class="que-title">'+n.title+'</span></div><span class="content-update-name"><img style="margin-right: 2px;"src="../../resources/images/icons/amend.png" />修改</span></div></div>';htmlTr.find(".q-info .add-info").before(itemVal);itemVal=$('<div class="radio-approval" style="margin-left:85px"></div>');if(n.itemDetailsSpecific!=null){$.each($.parseJSON(n.itemDetailsSpecific),function(k,m){itemVal.append('<input type="hidden" class="option-pk-id"  value="'+m.pkId+'"/><input type="hidden" class="option-item-details-id"  value="'+m.itemDetailsId+'"/>');itemVal.append('<p class="que-choose" style="width:fit-content;"><input type="hidden" class="option-pk-id"  value="'+m.pkId+'"/>'+m.specificValue+'</p>');})}htmlTr.find(".q-info .add-info").prev().append(itemVal)}})}htmlTbody.append(htmlTr)})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="3" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}console.log(formList);$yt_baseElement.pageLoadingShow();$yt_baseElement.pageLoadingHide()}else{$yt_alert_Model.prompt("查询失败")}},isSelPageNum:true })}};$(function(){quList.init()});