var createForm={reimId:"",init:function(){createForm.heardFunBtnEvent();var requerParameter=$yt_common.GetRequest();createForm.reimId=requerParameter.reimId;$("#createFormDate").text(sysCommon.getNowDate());$("#reimFrom").css("min-height",$(window).height()-32+"px");createForm.getReimInfo()},getReimInfo:function(){var qrCodeContextUrl=$yt_option.websit_path+'view/system-sasac/expensesReim/module/reimApply/reimApprove.html?reimId='+createForm.reimId;$.ajax({type:"post",url:"sz/reimApp/getReimPreviewDetailByReimAppId",async:false,data:{reimAppId:createForm.reimId,previewFalg:false,qrCodeContext:qrCodeContextUrl},success:function(data){if(data.flag==0){if(data.data){$("#reimFormTab").setDatas(data.data);$("#travelAppNum").attr("title",data.data.travelAppNum);var loanPrice=data.data.loanAmount;$("#loanPrice").text((loanPrice==""?"":$yt_baseElement.fmMoney(data.data.loanAmount)));$("#busiTripDays").text(sysCommon.calculateDays(data.data.planGoTime,data.data.planReturnTime));var receptionCostItem=data.data.receptionCostItem.split(",");$.each(receptionCostItem,function(i,n){$('.recep-box[value="'+n+'"]').parent().addClass("check")});$(".money-span").text(data.data.reimTotalAmount==""?"":$yt_baseElement.fmMoney(data.data.reimTotalAmount));$("#reimMoneySum").text(arabiaToChinese(data.data.reimTotalAmount));var payWayPriceSum=0;$("#cash").text(data.data.cash=="0.00"?"":$yt_baseElement.fmMoney(data.data.cash));if(data.data.cash!="0.00"){$("#cash").parent().prev().addClass("check");payWayPriceSum+=data.data.cash}$("#officialCard").text(data.data.officialCard=="0.00"?"":$yt_baseElement.fmMoney(data.data.officialCard));if(data.data.officialCard!="0.00"){$("#officialCard").parent().prev().addClass("check");payWayPriceSum+=data.data.officialCard}var chargeOffPrice=0;if(data.data.loanAmount!="0.00"&&data.data.reimTotalAmount!=""){chargeOffPrice=(data.data.reimTotalAmount-data.data.loanAmount)}else{chargeOffPrice=(data.data.reimTotalAmount==""?"":data.data.reimTotalAmount)}if(chargeOffPrice!=0&&chargeOffPrice!=""){$("#chargeOff").parent().prev().addClass("check");payWayPriceSum=parseFloat((payWayPriceSum==0?"":$yt_baseElement.rmoney(payWayPriceSum))+chargeOffPrice);chargeOffPrice=(chargeOffPrice==""?"":$yt_baseElement.fmMoney(chargeOffPrice))}$("#chargeOff").text(chargeOffPrice);$("#cheque").text();$("#ableTransfer").text();payWayPriceSum=(payWayPriceSum==0?"":$yt_baseElement.fmMoney(payWayPriceSum));$("#payWayPriceSum").text(payWayPriceSum);if($(".pay-type-ul .yt-checkbox.check").length>0){$("input.pay-way-box").parent().addClass("check")}var maxRowsNum="";if(data.data.costCarfareList.length>data.data.costOtherList.length){maxRowsNum=4+data.data.costCarfareList.length}else{maxRowsNum=4+data.data.costOtherList.length}if(data.data.costCarfareList.length==0&&data.data.costOtherList.length==0){maxRowsNum=4}$("#reimDetailTd").attr("rowspan",maxRowsNum);var detailStr="";maxRowsNum=maxRowsNum-4;var crafareSum=0;var otherPriceSum=0;if(maxRowsNum>0){for(var i=0;i<maxRowsNum;i+=1){detailStr+='<tr>';if(data.data.costCarfareList!=null&&data.data.costCarfareList.length>0&&data.data.costCarfareList.length>=(i+1)){var n=data.data.costCarfareList[i];detailStr+='<td><span>'+n.goTime+'</span></td><td><span>'+n.goAddress+'</span></td><td><span>'+n.arrivalTime+'</span></td><td><span>'+n.arrivalAddress+'</span></td><td><span>'+n.vehicleName+'</span></td><td><span class="crafare">'+(n.crafare==undefined?"":$yt_baseElement.fmMoney(n.crafare))+'</span></td><td><span class="hotel-price"></span></td>';crafareSum+=n.crafare}else{detailStr+='<td><span></span></td><td><span></span></td><td><span></span></td><td><span></span></td><td><span></span></td><td><span class="other-price"></span></td><td><span></span></td>'}if(data.data.costOtherList!=null&&data.data.costOtherList.length>0&&data.data.costOtherList.length>=(i+1)){var v=data.data.costOtherList[i];detailStr+='<td><span title="'+v.costTypeName+'">'+v.costTypeName+'</span></td><td><span>'+(v.reimAmount==undefined?"":$yt_baseElement.fmMoney(v.reimAmount))+'</span></td><td><span class="remark" title="'+v.costTypeName+'">'+(v.remarks==""?"--":v.remarks)+'</span></td>';otherPriceSum+=(v.reimAmount==undefined?0:v.reimAmount)}else{detailStr+='<td><span></span></td><td><span></span></td><td><span class="remark">--</span></td>'}detailStr+='</tr>'}$(".reim-detail-tr").after(detailStr);var hotelPrice=data.data.hotelExpense==""?"":$yt_baseElement.fmMoney(data.data.hotelExpense);$(".reim-detail-tr").next("tr:eq(0)").find("td:eq(6) span").text(hotelPrice);$("#trafficPriceSum").text(crafareSum==0?"":$yt_baseElement.fmMoney(crafareSum));$("#hotelPriceSum").text(hotelPrice);$("#otherPriceSum").text(otherPriceSum==0?"":$yt_baseElement.fmMoney(otherPriceSum))}$("#twoBarCode img").attr("src",$yt_option.base_path+data.data.lookQrCode)}}}})},heardFunBtnEvent:function(){$("#printBtn").off().on("click",function(){createForm.doPrint()});$("#closeBtn").off().on("click",function(){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/expensesReim/module/reimApply/reimApproveList.html'}})})},doPrint:function(){bdhtml=window.document.body.innerHTML;sprnstr="<!--startprint-->";eprnstr="<!--endprint-->";prnhtml=bdhtml.substr(bdhtml.indexOf(sprnstr)+17);prnhtml=prnhtml.substring(0,prnhtml.indexOf(eprnstr));window.document.body.innerHTML=prnhtml;window.print();window.document.body.innerHTML=bdhtml;window.location.reload()}};$(function(){createForm.init()});function printit(){if(confirm('确定打印吗？')){wb.execwb(6,6)}}