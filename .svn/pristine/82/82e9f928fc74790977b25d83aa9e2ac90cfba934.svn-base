var addBudgetList={init:function(){var pkId=$yt_common.GetQueryString('pkId');if(pkId){addBudgetList.getBudgetInf()}else{var budgetSubsidiary=addBudgetList.getBudgetSubsidiary();if(budgetSubsidiary!=null){$.each(budgetSubsidiary,function(i,n){if(n.costType==1){$(".teach-related-expenses-table").append('<tr><td align="right"><input type="hidden" value="'+n.costCode+'" class="cost-code"><span>'+n.costName+'：</span></td><td><input type="text" class="yt-input budget-cost" data-val="budgetCost" placeholder="请输入"/></td><td style="width: 50px;"><span>元</span></td><td><input type="text" class="yt-input according-instructions gist" data-val="accordingInstructions" placeholder="请输入依据说明"/></td></tr>')}if(n.costType==2){$(".logistics-related-expenses-table").append('<tr><td align="right"><input type="hidden" value="'+n.costCode+'" class="cost-code"><span>'+n.costName+'：</span></td><td><input type="text" class="yt-input budget-cost" data-val="budgetCost" placeholder="请输入"/></td><td style="width: 50px;"><span>元</span></td><td><input type="text" class="yt-input according-instructions gist" data-val="accordingInstructions" placeholder="请输入依据说明"/></td></tr>')}})}}$(".report-date").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".out-hospital-date").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});var projectSelect=addBudgetList.getAddBudgetSelect();if(projectSelect!=null){$.each(projectSelect,function(i,n){$(".project-code").append('<option value="'+n.projectCode+'" createUserName="'+n.createUserName+'" projectType="'+n.projectType+'" classTeacher="'+n.classTeacher+'" projectHead="'+n.projectHead+'" startDate="'+n.startDate+'" endDate="'+n.endDate+'" traineeTotal="'+n.traineeTotal+'">'+n.projectName+'</option>')})}$(".project-code").niceSelect();$("select.project-code").change(function(){var createUserName=$("select.project-code option:selected").attr("createUserName");var projectType=$("select.project-code option:selected").attr("projectType");var classTeacher=$("select.project-code option:selected").attr("classTeacher");var projectHead=$("select.project-code option:selected").attr("projectHead");var startDate=$("select.project-code option:selected").attr("startDate");var endDate=$("select.project-code option:selected").attr("endDate");var traineeTotal=$("select.project-code option:selected").attr("traineeTotal");$(".create-user-name").text(createUserName);if(projectType==2){$(".project-type").text("委托")}if(projectType==3){$(".project-type").text("选学")}if(projectType==4){$(".project-type").text("调训")}if(classTeacher=="null"){$(".class-teacher").text("")}else{$(".class-teacher").text(classTeacher)}if(projectHead=="null"){$(".project-head").text("")}else{$(".project-head").text(projectHead)}$(".start-date").text(startDate);$(".end-date").text(endDate);$(".trainee-total").text(traineeTotal)});var dealingWithPeople=addBudgetList.getListSelectDealingWithPeople();if(dealingWithPeople!=null){$.each(dealingWithPeople,function(i,n){$(".dealing-with-people").append('<option value="'+n.userCode+'">'+n.userName+'</option>')})}$(".dealing-with-people").niceSelect();$(".save-budget").click(function(){var dataStates=1;addBudgetList.addBudgetListInf(dataStates);window.location.href="/cbead/website/view/projectBudget/budgetList.html"});$(".submit-budget").click(function(){var dataStates=2;addBudgetList.addBudgetListInf(dataStates);window.location.href="/cbead/website/view/projectBudget/budgetList.html"});$(".btn-off").click(function(){window.location.href="/cbead/website/view/projectBudget/budgetList.html"});$(".btn-return").click(function(){window.location.href="/cbead/website/view/projectBudget/budgetList.html"})},getListSelectDealingWithPeople:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"project",processInstanceId:"",parameters:"",versionNum:""},async:false,success:function(data){$.each(data.data,function(i,n){console.log(n);console.log(i);for(var k in n){console.log('k',k);console.log("n[k]",n[k]);list=n[k]}})}});return list},getAddBudgetSelect:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"finance/reduction/lookForAllProject",data:{searchParameters:""},async:false,success:function(data){list=data.data||[]}});return list},getBudgetSubsidiary:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"finance/projectBudget/getProjectBudgetCostBase",data:{},async:false,success:function(data){list=data.data||[]}});return list},getBudgetInf:function(){var pkId=$yt_common.GetQueryString('pkId');$.ajax({type:"post",url:$yt_option.base_path+"finance/projectBudget/getBeanById",data:{pkId:pkId},success:function(data){if(data.flag==0){$(".budget-inf").setDatas(data.data);$(".project-code").setSelectVal(data.data.projectCode);$(".dealing-with-people").setSelectVal(data.data.dealingWithPeople);if($(".project-code").val()!=""){var createUserName=$("select.project-code option:selected").attr("createUserName");var projectType=$("select.project-code option:selected").attr("projectType");var classTeacher=$("select.project-code option:selected").attr("classTeacher");var projectHead=$("select.project-code option:selected").attr("projectHead");var startDate=$("select.project-code option:selected").attr("startDate");var endDate=$("select.project-code option:selected").attr("endDate");var traineeTotal=$("select.project-code option:selected").attr("traineeTotal");$(".create-user-name").text(createUserName);$(".project-type").text(projectType);$(".class-teacher").text(classTeacher);$(".project-head").text(projectHead);$(".start-date").text(startDate);$(".end-date").text(endDate);$(".trainee-total").text(traineeTotal)}var projectBudgetDetailsArr=$.parseJSON(data.data.projectBudgetDetails);var projectBudget='';if(projectBudgetDetailsArr!=null){$.each(projectBudgetDetailsArr,function(i,n){projectBudget=$('<tr><td align="right"><input type="hidden" value="teacherFee" class="cost-code"><span>'+n.costName+'：</span></td><td><input type="text" class="yt-input budget-cost" data-val="budgetCost" placeholder="请输入"></td><td style="width: 50px;"><span>元</span></td><td><input type="text" class="yt-input according-instructions gist" data-val="accordingInstructions" placeholder="请输入依据说明"></td></tr>');console.log(n);projectBudget.setDatas(n);if(n.costType==1){$(".teach-related-expenses-table").append(projectBudget)}if(n.costType==2){$(".logistics-related-expenses-table").append(projectBudget)}})}}else{$yt_alert_Model.prompt("获取失败")}}})},addBudgetListInf:function(dataStates){debugger;var projectCode=$(".project-code").val();var reportDate=$(".report-date").val();var outHospitalDate=$(".out-hospital-date").val();var entrustOrgCount=$(".entrust-org-count").val();var isOffSiteTraining=$("input.is-off-site-training[type='radio']:checked").val();var offSiteTrainingRequirement=$(".offsite-training-requirement").val();var costStandard=$("input.cost-standard[type='radio']:checked").val();var projectBudgetDetails="";var dealingWithPeople=$(".dealing-with-people").val();var projectBudgetDetailsArr=[];$(".budget-subsidiary tr").each(function(i,n){costCode=$(n).find(".cost-code").val();budgetCost=$(n).find(".budget-cost").val();accordingInstructions=$(n).find(".according-instructions").val();var arrProjectBudgetDetails={costCode:costCode,budgetCost:budgetCost,accordingInstructions:accordingInstructions};projectBudgetDetailsArr.push(arrProjectBudgetDetails)});var projectBudgetDetails=JSON.stringify(projectBudgetDetailsArr);$.ajax({type:"post",url:$yt_option.base_path+"finance/projectBudget/addOrUpdateBean",data:{types:1,projectCode:projectCode,reportDate:reportDate,outHospitalDate:outHospitalDate,entrustOrgCount:entrustOrgCount,isOffSiteTraining:isOffSiteTraining,offSiteTrainingRequirement:offSiteTrainingRequirement,costStandard:costStandard,projectBudgetDetails:projectBudgetDetails,dataStates:dataStates,businessCode:"projectBudget",dealingWithPeople:dealingWithPeople,opintion:"",processInstanceId:"",nextCode:"submited"},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("操作成功")}else{$yt_alert_Model.prompt("操作失败")}}})}};$(function(){addBudgetList.init()});