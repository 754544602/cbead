var reimApply={addressList:"",trObject:"",riskExcMark:"../../../../../resources-sasac/images/common/war-red.png",riskWarImg:"../../../../../resources-sasac/images/common/risk-war.png",riskViaImg:"../../../../../resources-sasac/images/common/risk-via.png",init:function(){sysCommon.getLoginUserInfo();$("#reimApply select:not(.testsel)").niceSelect();reimApply.getInitFunDatas();reimApply.bodyDateInit();reimApply.localityFunBtnEvent();$yt_baseElement.numberInput($(".yt-numberInput-box"));reimApply.bottomFunBtnEvent();sysCommon.getRiskData("#reimApply");$("#reimApply").css("min-height",($(window).height()-32)+"px");reimApply.hotelRiskEvent()},hotelRiskEvent:function(){var riskData=$("#peoDayMoney").data("riskData");$("#hotel-trip-user").on("change",function(){reimApply.hotelRiskComValid(riskData)});$("#hotelDate").on("blur",function(){if($(this).val()!=""){reimApply.hotelRiskComValid(riskData)}});$("#hotelDate").calendar({controlId:"hotelTime",nowData:false,speed:0,callback:function(){reimApply.hotelRiskComValid(riskData);sysCommon.clearValidInfo($("#hotelDate"))}});$(".yt-spin").click(function(){reimApply.detalHotelHotelAvgPrice();reimApply.hotelRiskComValid(riskData)});$(".yt-numberInput").on("blur",function(){reimApply.detalHotelHotelAvgPrice();reimApply.hotelRiskComValid(riskData)});$("#hotelParentAddress,#hotelTwoAddres,#hotelChildAddres").on("change",function(){$("select.hotel-addres-sel").removeClass("check");$(this).addClass("check");reimApply.hotelRiskComValid(riskData)});$(".cost-detail-money").on("blur",function(){reimApply.detalHotelHotelAvgPrice();reimApply.hotelRiskComValid(riskData)})},hotelRiskComValid:function(riskData){var validFlag=true;var hotelTripUser=$("#hotel-trip-user").val();var hotelDates=$("#hotelDate").val();var hotelDay=$(".yt-numberInput").val();var parentAddresVal=$("#hotelParentAddress").val();var twoAddersVal=$("#hotelTwoAddres").val();var childAddresVal=$("#hotelChildAddres").val();var hotelPrice=$(".cost-detail-money").val();if(hotelTripUser!=""&&hotelDates!=""&&hotelDay!=""&&parentAddresVal!=""&&hotelPrice!=""&&hotelPrice!="0.00"){validFlag=true;}else{validFlag=false;}if(validFlag){var addressArr=eval("("+riskData.ruleFormImpl+")");var months=new Date(hotelDates.replace(/-/g,"/"));months=","+parseInt(months.getMonth()+1)+",";var userObj=sysCommon.getUserAllInfo("",$("#hotel-trip-user").val());var level=userObj[$("#hotel-trip-user").val()].jobLevelCode;var price="";var avgHotelPrice=$("#peoDayMoney").text();avgHotelPrice=$yt_baseElement.rmoney(avgHotelPrice);var addressFlag="";if($(".hotel-form select.hotel-addres-sel.check").hasClass("hotel-parent-addres")){addressFlag="province"}if($(".hotel-form select.hotel-addres-sel.check").hasClass("hotel-two-addres")){addressFlag="city"}if($(".hotel-form select.hotel-addres-sel.check").hasClass("hotel-child-addres")){addressFlag="area"}var addressParentCode="";if(addressFlag=="city"){addressParentCode=parentAddresVal}else if(addressFlag=="area"){addressParentCode=twoAddersVal}else{addressParentCode=parentAddresVal}var thisAddressCode=$(".hotel-form select.hotel-addres-sel.check").val();if(thisAddressCode!=""&&thisAddressCode!=undefined){thisAddressCode="-"+thisAddressCode+"-"}var dataObj;if(addressArr!=""&&addressArr!=null){if(parentAddresVal!=""){dataObj=addressArr[parentAddresVal];if(dataObj!=undefined&&dataObj!=null&&dataObj!=""){var isExist=getSeasonData(dataObj,thisAddressCode);if(!isExist){if(dataObj.otherArea!=null&&dataObj.otherArea!=undefined&&dataObj.otherArea!=""){if(addressFlag!=undefined&&addressFlag!=""&&addressFlag!="province"){getSeasonData(dataObj.otherArea,addressParentCode)}}}}else{$('.hid-risk-code[value="'+riskData.pageFieldCode+'"]').next(".risk-img").attr("src",sysCommon.riskWarImg)}}}function getSeasonData(dataObj,addresCodes){var existFlag=false;if(dataObj!=undefined&&dataObj!=null&&dataObj!=""){if(dataObj.lowSeason!=""&&dataObj.lowSeason.length>0&&dataObj.lowSeason!=null&&dataObj.lowSeason!=undefined){$.each(dataObj.lowSeason,function(i,n){n.city="-"+n.city+"-";if(addresCodes!=""&&n.city.indexOf(addresCodes)>-1){if(n.amount!=null&&n.amount!=undefined){price=n.amount[level];if(avgHotelPrice!=""&&avgHotelPrice!="0.00"){if(avgHotelPrice>price){$('.hid-risk-code[value="'+riskData.pageFieldCode+'"]').next(".risk-img").attr("src",sysCommon.riskWarImg)}else{$('.hid-risk-code[value="'+riskData.pageFieldCode+'"]').next(".risk-img").attr("src",sysCommon.riskViaImg)}}}existFlag=true;return false}else{if(addressFlag!=undefined&&addressFlag!=""&&addressFlag!="area"){$('.hid-risk-code[value="'+riskData.pageFieldCode+'"]').next(".risk-img").attr("src",sysCommon.riskWarImg)}}})}price="";if(dataObj.highSeason!=undefined&&dataObj.highSeason!=""&&dataObj.highSeason.length>0&&dataObj.highSeason!=null){$.each(dataObj.highSeason,function(i,n){n.city="-"+n.city+"-";if(addresCodes!=""&&n.city.indexOf(addresCodes)>-1){if(n.month!=undefined&&n.month!=null&&n.month!=""){n.month=","+n.month+",";if(n.month.indexOf(months)>-1){if(n.amount!=null&&n.amount!=undefined){price=n.amount[level];if(avgHotelPrice!=""&&avgHotelPrice!="0.00"){if(avgHotelPrice>price){$('.hid-risk-code[value="'+riskData.pageFieldCode+'"]').next(".risk-img").attr("src",sysCommon.riskWarImg)}else{$('.hid-risk-code[value="'+riskData.pageFieldCode+'"]').next(".risk-img").attr("src",sysCommon.riskViaImg)}}}}else{return false}}existFlag=true;return false}})}}else{$('.hid-risk-code[value="'+riskData.pageFieldCode+'"]').next(".risk-img").attr("src",sysCommon.riskWarImg)}return existFlag}}},getInitFunDatas:function(){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictInfoByTypeCode",async:false,data:{dictTypeCode:"VEHICIE_CODE,HOTEL_ADDRESS,COST_TYPE"},success:function(data){if(data.flag==0){var optionText='<option value="">请选择</option>';$.each(data.data,function(i,n){if(n.dictTypeCode=="VEHICIE_CODE"){optionText='<option value="'+n.value+'">'+n.disvalue+'</option>';$(".vehicle-sel").append(optionText);$(".vehicle-sel").niceSelect()}if(n.dictTypeCode=="COST_TYPE"){optionText='<option value="'+n.value+'">'+n.disvalue+'</option>';$("#cost-type").append(optionText);$("#cost-type").niceSelect();$("#cost-type").on("change",function(){if($(this).val()!=""){$(this).parent().find(".risk-img").attr("src",reimApply.riskViaImg)}else{$(this).parent().find(".risk-img").attr("src",reimApply.riskWarImg)}})}});$(".vehicle-sel").on("change",function(){var selVal=$("select.vehicle-sel").val();sysCommon.vechicleChildData(selVal)})}}});sysCommon.getApproveFlowData("SZ_REIM_APP");$.ajax({type:"get",url:$yt_option.websit_path+'resources-sasac/js/system/expensesReim/module/reimApply/regionList.json',async:false,success:function(data){var dataList=data;reimApply.addressList=data}});reimApply.getAddressList()},getAddressList:function(){$.each(reimApply.addressList,function(i,n){if(n.regionLevel=="PROVINCE"){$("#hotelParentAddress").append('<option value="'+n.regionCode+'" data-level="'+n.regionLevel+'" >'+n.regionName+'</option>')}});$("#hotelParentAddress").niceSelect();$("#hotelParentAddress").on("change",function(){var thisSel=$(this);$("#hotelTwoAddres,#hotelChildAddres").html('').append('<option value="">请选择</option>');reimApply.hotelAddressChild(thisSel.val(),"CITY")});$("#hotelTwoAddres").on("change",function(){var thisSel=$(this);$("#hotelChildAddres").html('').append('<option value="">请选择</option>');reimApply.hotelAddressChild(thisSel.val(),"AREA")})},hotelAddressChild:function(addressCode,addressLevel){$.each(reimApply.addressList,function(i,n){if(n.parentCode==addressCode){if(addressLevel=="CITY"){$("#hotelTwoAddres").append('<option value="'+n.regionCode+'">'+n.regionName+'</option>')}if(addressLevel=="AREA"){$("#hotelChildAddres").append('<option value="'+n.regionCode+'">'+n.regionName+'</option>')}}});reimApply.hotelChildDisa(addressLevel)},hotelChildDisa:function(addressLevel){if(addressLevel=="CITY"){var disaFlag=true;if($("#hotelTwoAddres option").length==1){$("#hotelTwoAddres,#hotelChildAddres").prop("disabled","disabled");$("#hotelTwoAddres,#hotelChildAddres").removeAttr("validform");sysCommon.clearValidInfo($("div.hotel-child-addres,div.hotel-two-addres,#hotelTwoAddres,#hotelChildAddres"))}else{$("#hotelTwoAddres,#hotelChildAddres").prop("disabled","");$("#hotelTwoAddres").attr("validform","{isNull:true,changeFlag:true,msg:'请选择市'}");$("#hotelChildAddres").attr("validform","{isNull:true,changeFlag:true,msg:'请选择区'}");disaFlag=false}$(".hotel-two-addres,.hotel-child-addres").niceSelect();if(disaFlag){$("div.hotel-child-addres,div.hotel-two-addres").css("background-color","#D0D0D0")}}else if(addressLevel=="AREA"){var disaFlag=true;if($("#hotelChildAddres option").length==1){$("#hotelChildAddres").prop("disabled","disabled")}else{$("#hotelChildAddres").prop("disabled","");disaFlag=false}$("#hotelChildAddres").niceSelect();if(disaFlag){$("div.hotel-child-addres").css("background-color","#D0D0D0")}}},getRiskData:function(){$.ajax({type:"post",url:'basicconfig/risk/getSystemRiskByParams',async:false,success:function(data){if(data.flag==0){var resultData=",";$.each(data.data,function(i,n){resultData+=n.pageFieldCode+','});reimApply.comRiskCodes=resultData;reimApply.riskData=data.data;var riskCodes="";$(".hid-risk-code").each(function(i,n){riskCodes=","+$(n).val()+",";if(reimApply.comRiskCodes.indexOf(riskCodes)>=0){$(n).parent().show()}});reimApply.riskClickEvent()}}})},riskClickEvent:function(){$("#reimApply .risk-model").off().on("click",function(){reimApply.showRiskMsg($(this).find(".hid-risk-code").val())})},showRiskMsg:function(riskCode){$.each(reimApply.riskData,function(i,n){if(riskCode==n.pageFieldCode){if(n.pageFieldCode=="costDetailVehicle"||n.pageFieldCode=="costDetailHotelCost"){$("#cost-apply-model").hide()}var riskMsg='<div>'+n.lawsTitle+n.riskLawsContents+'<a class="yt-link risk-link">'+n.linkKeyWord+'</a></div>';riskMsg=$(riskMsg);riskMsg.find(".risk-link").data("riskLink",n.linkContents);$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:riskMsg,cancelFunction:function(){if(n.pageFieldCode=="costDetailVehicle"||n.pageFieldCode=="costDetailHotelCost"){$("#cost-apply-model").show();$("#heard-nav-bak,#pop-modle-alert").show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($("#cost-apply-model"));$("body").css("overflow","hidden")}}})}});$(".risk-link").on("click",function(){sysCommon.riskLinkModel($(this).data("riskLink"))})},localityFunBtnEvent:function(){$("#addCostApplyBtn").off("click").on("click",function(){reimApply.showCostDetailModel()});$("#busiApproForm").off().on("click",function(){var busiAproFormModel=$("#busiAproFormModel");reimApply.getBusiTripApproveList($("#keywordInpu").val());sysCommon.showModel(busiAproFormModel);reimApply.busiApproFormModelEvent()});$("#loanFrom").off().on("click",function(){var loanFormModel=$("#loanFormModel");reimApply.getLoanFormList($("#loanKeyWord").val());sysCommon.showModel(loanFormModel);reimApply.loanFormModelEvent(loanFormModel)});$("#importDataBtn").off().on("click",function(){reimApply.getBusiTripFormData()});$("#replacementTab input").on("focus",function(){if($(this).val()!=""&&$(this).val()!=null){$(this).val($yt_baseElement.rmoney($(this).val()));$(this).select()}});$("#replacementTab input").on("blur",function(){reimApply.formartMoney($(this))});$("#replacementTab input").keyup(function(i,n){var sum=0.00;$(".repl-way-inpu").each(function(i,n){sum+=$yt_baseElement.rmoney($(n).val())});sum=$yt_baseElement.fmMoney(sum);$("#replPriceSum").text(sum)})},getBusiTripApproveList:function(keyWord){var approveFormTbody=$("#busiAproFormModel .appro-list-model table tbody");$('.approve-page').pageInfo({pageIndex:1,pageNum:5,pageSize:2,url:"sz/travelApp/getUserTravelAppListByParams",type:"get",async:false,objName:'data',data:{queryParams:keyWord},success:function(data){approveFormTbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){$('.approve-page').show();$.each(data.data.rows,function(i,n){trStr='<tr><td>'+n.travelAppNum+'<input type="hidden" class="form-id" value="'+n.travelAppId+'"/><input type="hidden" class="hid-user-codes" value="'+n.travelPersonnels+'"/></td><td>'+n.travelAppName+'<input type="hidden" class="hid-users-num" value="'+(n.travelPersonnelNum==""?"--":n.travelPersonnelNum)+'"/><input type="hidden" class="hid-rec-give" value="'+(n.receptionCostItem==""?"--":n.receptionCostItem)+'"/><input type="hidden" class="hid-prj" value="'+(n.prjName==""?"--":n.prjName)+'"/><input type="hidden" class="hid-dept" value="'+(n.prjDeptName==""?"--":n.prjDeptName)+'"/></td></tr>';approveFormTbody.append(trStr)})}else{$('.approve-page').hide();var noTr='<tr class="model-no-data-tr"><td colspan="2"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';approveFormTbody.append(noTr)}}}})},getLoanFormList:function(keyWord){var loanTbody=$("#loanFormModel .loan-list-model table tbody");$('.loan-page').pageInfo({pageIndex:1,pageNum:5,pageSize:2,url:"sz/loanApp/getUserLoanAppInfoListToPageByParams",type:"post",async:false,objName:'data',data:{queryParams:keyWord},success:function(data){loanTbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){$('.loan-page').show();$.each(data.data.rows,function(i,n){trStr='<tr><td>'+n.loanAppNum+'<input type="hidden" class="loan-id" value="'+n.loanAppId+'"/></td><td style="text-align: right;">'+(n.loanAmount==""?"--":$yt_baseElement.fmMoney(n.loanAmount))+'</td></tr>';loanTbody.append(trStr)})}else{$('.loan-page').hide();var noTr='<tr class="model-no-data-tr"><td colspan="2"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';loanTbody.append(noTr)}}}})},loanFormModelEvent:function(modelObj){$("#loanSearchBtn").off().on("click",function(){reimApply.getLoanFormList($("#loanKeyWord").val())});$("#loanResetBtn").off().on("click",function(){$("#loanKeyWord").val('');reimApply.getLoanFormList($("#loanKeyWord").val())});$('#loanFormModel tbody').on('click','tr',function(){$('#loanFormModel tbody tr').removeClass("yt-table-active");$(this).addClass("yt-table-active")});$('#loanFormModel tbody:not(.page-info table tbody)').on('dblclick','tr',function(){$("#loanFrom").val($(this).find("td:eq(0)").text());$("#loanPrice,#loanCost").text($(this).find("td:eq(1)").text());$("#hidLoanFormId").val($(this).find(".loan-id").val());var replPrice=0;var loanPrice=$("#loanCost").text();if($("#reimPrice").text()!=""&&$("#reimPrice").text()!="0.00"){replPrice=$yt_baseElement.rmoney($("#reimPrice").text())-$yt_baseElement.rmoney($(this).find("td:eq(1)").text())}replPrice=$yt_baseElement.fmMoney(replPrice);$("#givePrice").text(replPrice);$("#loanKeyWord").val('');sysCommon.closeModel(modelObj)});$("#loanSureBtn").off().on("click",function(){var thisSelTr=$('#loanFormModel tbody tr.yt-table-active');if(thisSelTr!=""&&thisSelTr.length>0){$("#loanFrom").val(thisSelTr.find("td:eq(0)").text());$("#loanPrice,#loanCost").text(thisSelTr.find("td:eq(1)").text());$("#hidLoanFormId").val(thisSelTr.find(".loan-id").val());var loanPrice=$("#loanCost").text();var replPrice=$yt_baseElement.rmoney($("#reimPrice").text())-$yt_baseElement.rmoney(thisSelTr.find("td:eq(1)").text());replPrice=$yt_baseElement.fmMoney(replPrice)}else{$("#loanFrom,#hidLoanFormId").val('');$("#loanPrice,#loanCost").text("0.00")}$("#loanKeyWord").val('');sysCommon.closeModel(modelObj)});$("#loanCanelBtn").off().on("click",function(){$("#loanKeyWord").val('');sysCommon.closeModel(modelObj)})},busiApproFormModelEvent:function(){var busiApproFormModel=$("#busiAproFormModel");$("#aproSearchBtn").off().on("click",function(){reimApply.getBusiTripApproveList($("#keywordInpu").val())});$("#aproRestBtn").off().on("click",function(){$("#keywordInpu").val('');reimApply.getBusiTripApproveList($("#keywordInpu").val())});$('#busiTripTab tbody').on('click','tr',function(){$('#busiTripTab tbody tr').removeClass("yt-table-active");$(this).addClass("yt-table-active")});$('#busiTripTab tbody:not(.page-info table tbody)').on('dblclick','tr',function(){reimApply.getBusiAppSelTrData($(this));$(".reim-detail-model").hide();$(".cost-apply-model,.flow-approve-model").show();reimApply.getTravelBusiUsersInfo($(this).find(".hid-user-codes").val())});$("#aproSureBtn").off().on("click",function(){var thisSelTr=$('#busiTripTab tbody tr.yt-table-active');if(thisSelTr!=""&&thisSelTr.length>0){reimApply.getBusiAppSelTrData(thisSelTr);$("#busiApproForm").parent().find(".risk-img").attr("src",reimApply.riskViaImg);$(".reim-detail-model").hide();$(".cost-apply-model,.flow-approve-model").show();reimApply.getTravelBusiUsersInfo(thisSelTr.find(".hid-user-codes").val())}else{$("#busiApproForm,#approId").val('');$("#busiBecause,#busiUserNum,#receptionGive").text('');$("#byPpsPrj,#deptBy").text("--");$(".base-info-form-modle .war-model").show();$("#busiApproForm").parent().find(".risk-img").attr("src",reimApply.riskWarImg);$(".reim-detail-model").show();$(".cost-apply-model,.flow-approve-model").hide();$("#model-trip-user,#hotel-trip-user").empty().append('<option value="">请选择</option>');$("#model-trip-user,#hotel-trip-user").niceSelect()}$("#keywordInpu").val('');sysCommon.closeModel(busiApproFormModel)});$("#aproCanelBtn").off().on("click",function(){$("#keywordInpu").val('');sysCommon.closeModel(busiApproFormModel)})},getTravelBusiUsersInfo:function(userCodes){$.ajax({type:"post",url:'user/userInfo/getAllUserObjectsByParams',async:false,data:{userIds:"",userCodes:userCodes,userName:""},success:function(data){if(data.flag==0){var optionText='<option value="">请选择</option>';$("#model-trip-user,#hotel-trip-user").empty().append(optionText);var usersCodesList=userCodes.split(",");if(usersCodesList.length>0){$.each(usersCodesList,function(i,n){optionText='<option value="'+data.data[n].userItcode+'" data-level="'+data.data[n].jobLevelCode+'">'+data.data[n].userName+'</option>';$("#model-trip-user,#hotel-trip-user").append(optionText)})}else{$("#model-trip-user,#hotel-trip-user").append(optionText)}$("#model-trip-user,#hotel-trip-user").niceSelect()}}})},getBusiAppSelTrData:function(thisTr){var busiApproFormModel=$("#busiAproFormModel");$("#approId").val($(thisTr).find(".form-id").val());$("#busiApproForm").val($(thisTr).find("td:eq(0)").text());$("#busiBecause").text($(thisTr).find("td:eq(1)").text());$("#busiUserNum").text($(thisTr).find(".hid-users-num").val());var reception=($(thisTr).find(".hid-rec-give").val()).split(",");var receps="";$.each(reception,function(i,n){if(n==1){receps+="住宿费、"}else if(n==2){receps+="伙食费、"}else if(n==3){receps+="市内交通费、"}else{receps="--、"}});receps=receps.substring(0,receps.length-1);$("#receptionGive").text(receps);$("#byPpsPrj").text($(thisTr).find(".hid-prj").val());$("#deptBy").text($(thisTr).find(".hid-dept").val());$(".base-info-form-modle .war-model").hide();$("#keywordInpu").val('');sysCommon.closeModel(busiApproFormModel);$("#busiApproForm").parent().find(".risk-img").attr("src","../../../../../resources-sasac/images/common/risk-via.png")},showCostDetailModel:function(){var costApplyModel=$("#cost-apply-model");sysCommon.showModel(costApplyModel);reimApply.costDetailModelEvent();sysCommon.costDetailModelTabEvent();sysCommon.riskMsgClickEvent($("#reimApply"))},getBusiTripFormData:function(){$.ajax({type:"post",url:"sz/travelApp/getTravelAppCostAppListByTravelAppId",async:false,data:{travelAppId:$("#approId").val()},success:function(data){var costDatas=data.data;if(data.flag==0){$("#traffic-list-info tbody,#hotel-list-info tbody,#other-list-info tbody,#subsidy-list-info tbody").empty();$(".cost-list-model .cost-list-title .risk-img").attr("src",reimApply.riskExcMark);if(costDatas.costCarfareList.length>0){reimApply.createSumTr(0);var trafficCostStr="";var vehicleName="";$.each(costDatas.costCarfareList,function(i,n){trafficCostStr='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+n.travelPersonnel+'"/></td><td>'+n.jobLevelName+'</td><td data-text="goTime">'+n.goTime+'</td><td data-text="goAddress">'+n.goAddress+'</td><td data-text="arrivalTime">'+n.arrivalTime+'</td><td data-text="arrivalAddress">'+n.arrivalAddress+'</td>';trafficCostStr+='<td><span>'+n.vehicleName+'</span><input type="hidden" data-val="vehicle" class="hid-vehicle" value="'+n.vehicle+'"/><input class="hid-child-code" type="hidden" value=""/></td><td class="font-right money-td" data-text="crafare">'+(n.crafare==""?"0.00":$yt_baseElement.fmMoney(n.crafare))+'</td><td class="text-overflow-sty" title="'+n.remarks+'" data-text="remarks">'+(n.remarks==""?"--":n.remarks)+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';$("#traffic-list-info tbody .total-last-tr").before(trafficCostStr)});sysCommon.updateMoneySum(0);reimApply.costApplyTabOperateEvent();$("#traffic-list-info").parent().find(".cost-list-title .risk-img").attr("src",reimApply.riskViaImg);reimApply.riskClickEvent()}if(costDatas.costHotelList.length>0){reimApply.createSumTr(1);var hotelCostStr="";var avgHotelMoney=0.00;$.each(costDatas.costHotelList,function(i,n){if(n.hotelExpense!=""){avgHotelMoney=n.hotelExpense/n.hotelDays}hotelCostStr='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" value="'+n.travelPersonnel+'"/></td><td>'+n.jobLevelName+'</td><td data-text="hotelTime">'+n.hotelTime+'</td><td class="font-right">'+($yt_baseElement.fmMoney(avgHotelMoney))+'</td><td data-text="hotelDays">'+n.hotelDays+'</td><td class="font-right money-td" data-text="hotelExpense">'+(n.hotelExpense==""?"0.00":$yt_baseElement.fmMoney(n.hotelExpense))+'</td><td><span data-text="hotelAddressName">'+n.hotelAddressName+'</span><input type="hidden" data-val="hotelAddress" value="'+n.hotelAddress+'"</td><td class="text-overflow-sty" title="'+n.remarks+'" data-text="remarks">'+(n.remarks==""?"--":n.remarks)+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';$("#hotel-list-info tbody .total-last-tr").before(hotelCostStr)});sysCommon.updateMoneySum(1);reimApply.costApplyTabOperateEvent();$("#hotel-list-info").parent().find(".cost-list-title .risk-img").attr("src",reimApply.riskViaImg);reimApply.riskClickEvent()}if(costDatas.costOtherList.length>0){reimApply.createSumTr(2);var otherCostStr="";$.each(costDatas.costOtherList,function(i,n){otherCostStr='<tr><td><span>'+n.costTypeName+'</span><input type="hidden" data-val="costType" value="'+n.costType+'"></td><td class="font-right money-td" data-text="reimAmount">'+(n.reimAmount==""?"0.00":$yt_baseElement.fmMoney(n.reimAmount))+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+n.remarks+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="2"><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span></td></tr>';$("#other-list-info tbody .total-last-tr").before(otherCostStr)});sysCommon.updateMoneySum(2);reimApply.costApplyTabOperateEvent();$("#other-list-info").parent().find(".cost-list-title .risk-img").attr("src",reimApply.riskViaImg);reimApply.riskClickEvent()}if(costDatas.costSubsidyList.length>0){reimApply.createSumTr(3);var subsidyStr="";$.each(costDatas.costSubsidyList,function(i,n){subsidyStr='<tr><td><span>'+n.travelPersonnelName+'</span><inpu type="hidden" data-val="travelPersonnel" value="'+n.travelPersonnel+'"/></td><td><span>'+n.jobLevelName+'</span></td><td><span data-text="subsidyDays">'+n.subsidyDays+'</span></td><td class="font-right"><span class="food-money" data-text="subsidyFoodAmount">'+(n.subsidyFoodAmount==""?"0.00":$yt_baseElement.fmMoney(n.subsidyFoodAmount))+'</span></td><td class="font-right"><span class="city-money" data-text="carfare">'+(n.carfare==""?"0.00":$yt_baseElement.fmMoney(n.carfare))+'</span></td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="3"/><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';$("#subsidy-list-info tbody .total-last-tr").before(subsidyStr)});sysCommon.updateMoneySum(3);reimApply.costApplyTabOperateEvent();$("#subsidy-list-info").parent().find(".cost-list-title .risk-img").attr("src",reimApply.riskViaImg);reimApply.riskClickEvent()}}}})},bottomFunBtnEvent:function(){$("#subCreateFormBtn,#applySaveBtn,#lookReimBtn").off().on("click",function(){var btnFlag;var thisBtn=$(this);var ajaxUrl="";if(thisBtn.hasClass("sub-btn")){btnFlag=0;ajaxUrl="sz/reimApp/submitReimAppInfo"}if(thisBtn.hasClass("save-btn")){btnFlag=1;ajaxUrl="sz/reimApp/saveReimAppInfoToDrafts"}if(thisBtn.hasClass("preview-btn")){btnFlag=2;ajaxUrl="sz/reimApp/saveReimAppInfoToDrafts"}var reimDatas=reimApply.getSubSaveData();var validFlag=$yt_valid.validForm($(".base-info-model"));var validFlowFlag=$yt_valid.validForm($(".flow-approve-model"));if(validFlag&&validFlowFlag){$.ajax({type:"post",url:ajaxUrl,async:false,data:reimDatas,success:function(data){if(data.flag==0){$("#hidReimId").val(data.data);if(btnFlag==0){thisBtn.attr("disabled",true);var pageUrl="view/system-sasac/expensesReim/module/reimApply/createReimForm.html?reimId="+$("#hidReimId").val();window.location.href=$yt_option.websit_path+pageUrl}else if(btnFlag==2){var pageUrl="view/system-sasac/expensesReim/module/reimApply/reimFormPreview.html?reimId="+$("#hidReimId").val();var goPageUrl="view/system-sasac/expensesReim/module/reimApply/reimApply.html";window.open($yt_option.websit_path+"index.html?pageUrl="+encodeURIComponent(pageUrl)+'&goPageUrl='+goPageUrl)}else{thisBtn.attr("disabled",true);$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/expensesReim/module/reimApply/reimApproveList.html'}})}}else{thisBtn.attr("disabled",false)}$yt_alert_Model.prompt(data.message,2000)}})}else{thisBtn.attr("disabled",false);sysCommon.pageToScroll($(".base-info-model .valid-font"))}})},getSubSaveData:function(){var trafficObjTbodyTr=$("#traffic-list-info tbody tr:not(.total-last-tr,.detail-last-tr)");var costCarfareList=[];var costCarfareJson="";var cityDatas;var replaWay=$("#traffic-list-info tbody .detail-last-tr .check-label.check input").val();replaWay=(replaWay==undefined?"":replaWay);if(trafficObjTbodyTr.length>0){trafficObjTbodyTr.each(function(i,n){cityDatas=$(this).getDatas();cityDatas.crafare=$yt_baseElement.rmoney(cityDatas.crafare);if($(this).find(".hid-child-code").val()=="null"||$(this).find(".hid-child-code").val()==""){if($(this).find(".hid-vehicle").val().indexOf(".")!=-1){cityDatas.vehicle=$(this).find(".hid-vehicle").val()}else{cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."}}else{if($(this).find(".hid-vehicle").val().indexOf(".")!=-1){cityDatas.vehicle=$(this).find(".hid-vehicle").val()}else{cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."+$(this).find(".hid-child-code").val()+"."}}cityDatas.setMethod=replaWay;costCarfareList.push(cityDatas)});if(costCarfareList.length>0){costCarfareJson=JSON.stringify(costCarfareList)}}var hotelObjTbodyTr=$("#hotel-list-info tbody tr:not(.total-last-tr,.detail-last-tr)");var costHotelList=[];var costHotelJson="";var hotelDatas;var replaWay=$("#hotel-list-info tbody .detail-last-tr .check-label.check input").val();replaWay=(replaWay==undefined?"":replaWay);if(hotelObjTbodyTr.length>0){hotelObjTbodyTr.each(function(i,n){hotelDatas=$(this).getDatas();hotelDatas.hotelExpense=$yt_baseElement.rmoney(hotelDatas.hotelExpense);hotelDatas.setMethod=replaWay;costHotelList.push(hotelDatas)});if(costHotelList.length>0){costHotelJson=JSON.stringify(costHotelList)}}var otherObjTbodyTr=$("#other-list-info tbody tr:not(.total-last-tr,.detail-last-tr)");var costOtherList=[];var costOtherJson="";var otherDatas;var replaWay=$("#other-list-info tbody .detail-last-tr .check-label.check input").val();replaWay=(replaWay==undefined?"":replaWay);if(otherObjTbodyTr.length>0){otherObjTbodyTr.each(function(i,n){otherDatas=$(this).getDatas();otherDatas.reimAmount=$yt_baseElement.rmoney(otherDatas.reimAmount);otherDatas.setMethod=replaWay;costOtherList.push(otherDatas)});if(costOtherList.length>0){costOtherJson=JSON.stringify(costOtherList)}}var subsidyObjTbodyTr=$("#subsidy-list-info tbody tr:not(.total-last-tr,.detail-last-tr)");var costSubsidyList=[];var costSubsidyJson="";if(subsidyObjTbodyTr.length>0){subsidyObjTbodyTr.each(function(i,n){costSubsidyList.push($(this).getDatas())});if(costSubsidyList.length>0){costSubsidyJson=JSON.stringify(costSubsidyList)}}var officialCard=$("#officialCard").val();officialCard=(officialCard==""?"":$yt_baseElement.rmoney(officialCard));var cashPrice=$("#cash").val();cashPrice=(cashPrice==""?"":$yt_baseElement.rmoney(cashPrice));var cheque=$("#check").val();cheque=(cheque==""?"":$yt_baseElement.rmoney(cheque));var carryOver=$("#carryOver").val();carryOver=(carryOver==""?"":$yt_baseElement.rmoney(carryOver));return{travelAppId:$("#approId").val(),loanAppId:$("#hidLoanFormId").val(),reimAppId:$("#hidReimId").val(),reimAppNum:"",reimAppName:$("#reimReason").val(),invoiceNum:$("#invoiceNum").val(),officialCard:officialCard,cash:cashPrice,cheque:cheque,transfer:carryOver,applicantUser:$yt_common.user_info.userName,parameters:"",dealingWithPeople:$("#approve-users").val(),opintion:$("#operate-msg").val(),processInstanceId:"",totalAmount:($("#applySumMoney").text()=="0.00"?"":$yt_baseElement.rmoney($("#applySumMoney").text())),nextCode:$("#operate-flow").val(),costCarfareJson:costCarfareJson,costHotelJson:costHotelJson,costOtherJson:costOtherJson,costSubsidyJson:costSubsidyJson }},getCostDetailData:function(tabFlag){if(tabFlag==0){reimApply.getTrafficCostFormInfo()}if(tabFlag==1){reimApply.getHotelFormInfo()}if(tabFlag==2){reimApply.getOtherCostFormInfo()}},getTrafficCostFormInfo:function(){var trabfficObj=$(".traffic-form");reimApply.createSumTr(0);var tripUser=trabfficObj.find("#model-trip-user option:selected").text();var level=trabfficObj.find("#model-trip-user option:selected").attr("data-level");var vehicle="";var vehicleCode="";vehicleCode=trabfficObj.find(".vehicle-sel").val();var vehicleChildCode="";vehicleChildCode=trabfficObj.find(".vehicle-two-sel").val();if($(".vehicle-two-sel").val()!=""&&$(".vehicle-two-sel").val()!=null){vehicle=trabfficObj.find(".vehicle-two-sel option:selected").text()}else{vehicle=trabfficObj.find(".vehicle-sel option:selected").text()}var cityMoney=trabfficObj.find(".city-cost-input").val();var trafficCostStr='<tr><td><span>'+tripUser+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+trabfficObj.find("#model-trip-user").val()+'"/></td><td>'+level+'</td><td data-text="goTime">'+$("#traffic-start-time").val()+'</td><td data-text="goAddress">'+$("#fromcity").val()+'</td><td data-text="arrivalTime">'+$("#traffic-end-time").val()+'</td><td data-text="arrivalAddress">'+$("#tocity").val()+'</td><td><span data-text="vehicle">'+vehicle+'</span><input type="hidden" class="hid-vehicle" value="'+vehicleCode+'"/><input type="hidden" class="hid-child-code" value="'+vehicleChildCode+'"/></td><td class="font-right money-td" data-text="crafare">'+(cityMoney==""?"--":cityMoney)+'</td><td class="text-overflow-sty" data-text="remarks" title="'+$("#special-remark").val()+'">'+($("#special-remark").val()==""?"--":$("#special-remark").val())+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';$("#traffic-list-info tbody .total-last-tr").before(trafficCostStr);sysCommon.updateMoneySum(0);reimApply.costApplyTabOperateEvent();sysCommon.clearFormData();$("#traffic-list-info").parent().find(".cost-list-title .risk-img").attr("src",reimApply.riskViaImg);reimApply.riskClickEvent()},createSumTr:function(tabObj){if(tabObj==0){if($("#traffic-list-info tbody").find(".total-last-tr").length==0){var totalRows='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr><tr  class="detail-last-tr" style="border: 0px;"><td colspan="10"><label class="check-label yt-checkbox" style="padding-left: 20px !important;"><input class="official-card" type="checkbox" name="test" value="OFFICIALCARD"/>公务卡结算</label><span class="risk-model"><input type="hidden" value="officialCard" class="hid-risk-code"/><img src="../../../../../resources-sasac/images/common/war-red.png" class="risk-img card-risk-img"/></span></td></tr>';$("#traffic-list-info tbody").append(totalRows)}}if(tabObj==1){if($("#hotel-list-info tbody").find(".total-last-tr").length==0){var totalRows='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0</span></td><td></td><td></td><td></td></tr><tr style="border: 0px;" class="detail-last-tr"><td colspan="9"><label class="check-label yt-checkbox" style="padding-left: 20px !important;"><input class="official-card" type="checkbox" name="test" value="OFFICIALCARD"/>公务卡结算</label><span class="risk-model"><input type="hidden" value="officialCard" class="hid-risk-code"/><img src="../../../../../resources-sasac/images/common/war-red.png" class="risk-img card-risk-img"/></span></td></tr>';$("#hotel-list-info tbody").append(totalRows)}}if(tabObj==2){if($("#other-list-info tbody").find(".total-last-tr").length==0){var totalRows='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td class="font-right"><span class="tab-font-blod money-sum">0</span></td><td></td><td></td></tr><tr class="detail-last-tr" style="border: 0px;"><td colspan="4"><label class="check-label yt-checkbox" style="padding-left: 20px !important;"><input class="official-card" type="checkbox" name="test" value="OFFICIALCARD"/>公务卡结算</label><span class="risk-model"><input type="hidden" value="officialCard" class="hid-risk-code"/><img src="../../../../../resources-sasac/images/common/war-red.png" class="risk-img card-risk-img"/></span></td></tr>';$("#other-list-info").append(totalRows)}}if(tabObj==3){if($("#subsidy-list-info tbody").find(".total-last-tr").length==0){var totalRows='<tr class="total-last-tr">< <td class="tab-font-blod">合计</td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0</span></td><td class="font-right tab-font-blod city-money-td"></td><td></td></tr>';$("#subsidy-list-info").append(totalRows)}}reimApply.getRiskData()},getHotelFormInfo:function(){var hotelObj=$(".hotel-form");reimApply.createSumTr(1);var tripUser=hotelObj.find("select.hotel-trip-user-sel option:selected").text();var level=hotelObj.find("select.hotel-trip-user-sel option:selected").attr("data-level");var hotelAddress="";var hotelAdressCode="";var hotelParentAdres=hotelObj.find("#hotelParentAddress option:selected").text();var hotelTwoAdres=hotelObj.find("#hotelTwoAddres option:selected").text();var hotelChildAdres=hotelObj.find("#hotelChildAddres option:selected").text();if(hotelTwoAdres==""||hotelTwoAdres=="请选择"){hotelAddress=hotelParentAdres;hotelAdressCode=hotelObj.find("#hotelParentAddress").val()}else{hotelAddress=hotelParentAdres+"-"+hotelTwoAdres+"-"+hotelChildAdres;hotelAdressCode=hotelObj.find("#hotelParentAddress").val()+"-"+hotelObj.find("#hotelTwoAddres").val()+"-"+hotelObj.find("#hotelChildAddres").val()}var hotelCostStr='<tr><td><span>'+tripUser+'</span><input type="hidden" data-val="travelPersonnel" value="'+hotelObj.find("select.hotel-trip-user-sel").val()+'"/></td><td>'+level+'</td><td data-text="hotelTime">'+$("#hotelDate").val()+'</td><td class="font-right">'+$("#peoDayMoney").html()+'</td><td data-text="hotelDays">'+hotelObj.find(".yt-numberInput").val()+'</td><td class="font-right money-td" data-text="hotelExpense">'+hotelObj.find(".cost-detail-money").val()+'</td><td><span data-text="hotelAddressName">'+hotelAddress+'</span><input type="hidden" data-val="hotelAddress" value="'+hotelAdressCode+'"</td><td class="text-overflow-sty" data-text="remarks" title="'+hotelObj.find(".hotel-msg").val()+'">'+(hotelObj.find(".hotel-msg").val()==""?"--":hotelObj.find(".hotel-msg").val())+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';$("#hotel-list-info tbody .total-last-tr").before(hotelCostStr);sysCommon.updateMoneySum(1);reimApply.costApplyTabOperateEvent();sysCommon.clearFormData();$("#hotel-list-info").parent().find(".cost-list-title .risk-img").attr("src",reimApply.riskViaImg);reimApply.riskClickEvent()},getOtherCostFormInfo:function(){var otherObj=$(".other-form");reimApply.createSumTr(2);var costType=otherObj.find("#cost-type option:selected").text();var otherCostStr='<tr><td><span>'+costType+'</span><input type="hidden" data-val="costType" value="'+otherObj.find("#cost-type").val()+'"/></td><td class="font-right money-td" data-text="reimAmount">'+otherObj.find(".other-money").val()+'</td><td class="text-overflow-sty" data-text="remarks" title="'+otherObj.find(".other-msg").val()+'">'+(otherObj.find(".other-msg").val()==""?"--":otherObj.find(".other-msg").val())+'</td><td><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="2"/><span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"/></span></td></tr>';$("#other-list-info tbody .total-last-tr").before(otherCostStr);sysCommon.updateMoneySum(2);reimApply.costApplyTabOperateEvent();sysCommon.clearFormData();$("#other-list-info").parent().find(".cost-list-title .risk-img").attr("src",reimApply.riskViaImg);reimApply.riskClickEvent()},costApplyTabOperateEvent:function(){$(".operate-update").off().on("click",function(){var thisTr=$(this).parents("tr");reimApply.trObject=thisTr;reimApply.showCostDetailModel();$("#model-add-list-btn").hide();$("#model-sure-btn").show();var costType=thisTr.find(".hid-cost-type").val();$(".cost-type-tab ul li").removeClass("tab-check");$('.cost-type-tab ul li input[value="'+costType+'"]').parent().addClass("tab-check");if(costType==0){$(".traffic-form").show();$(".traffic-form .risk-img").attr("src",reimApply.riskViaImg)}if(costType==1){$(".hotel-form").show();$(".traffic-form").hide();$(".hotel-form .risk-img").attr("src",reimApply.riskViaImg)}if(costType==2){$(".other-form").show();$(".traffic-form").hide();$(".other-form .risk-img").attr("src",reimApply.riskViaImg)}reimApply.getTrCostInfoToForm(thisTr)});$(".operate-del").off().on("click",function(){var thisObj=$(this);var tableModel=thisObj.parents("table").prev();var costType=thisObj.parent().find(".hid-cost-type").val();$yt_alert_Model.alertOne({alertMsg:"确定要删除此条数据吗?",leftBtnName:"确定",confirmFunction:function(){if(thisObj.parents("tbody").find("tr:not(.total-last-tr,.detail-last-tr)").length==1){thisObj.parents("tbody").empty();tableModel.find(".risk-img").attr("src",reimApply.riskExcMark)}thisObj.parents("tr").remove();sysCommon.updateMoneySum(costType,thisObj.parents("tr").find(".money-td").text())}})});$(".cost-list-model .yt-checkbox").off("change").on("change",function(){var officialCardSum=0.00;if($(this).hasClass("check")){$(this).parent().find(".risk-img").attr("src",reimApply.riskWarImg);$(this).parents("tr").parent().find(".hid-set-met").val('');officialCardSum=$yt_baseElement.rmoney($("#officialCard").val())-$yt_baseElement.rmoney($(this).parents("tr").parent().find(".money-sum").text())}else{$(this).parent().find(".risk-img").attr("src",reimApply.riskViaImg);$(this).parents("tr").parent().find(".hid-set-met").val($(this).find(".official-card").val());officialCardSum=$yt_baseElement.rmoney($(this).parents("tr").parent().find(".money-sum").text());$(".detail-last-tr label.check").parents("tr").parent().find(".money-sum").each(function(i,n){officialCardSum=officialCardSum+$yt_baseElement.rmoney($(this).text())})}var cash=$yt_baseElement.rmoney($("#cash").val());var check=$yt_baseElement.rmoney($("#check").val());var carryOver=$yt_baseElement.rmoney($("#carryOver").val());$("#replPriceSum").text($yt_baseElement.fmMoney(officialCardSum+cash+check+carryOver));officialCardSum=$yt_baseElement.fmMoney(officialCardSum);$("#officialCard").val(officialCardSum)})},getTrCostInfoToForm:function(thisTr){var costType=$(thisTr).find(".hid-cost-type").val();if(costType==0){var busiUser=$(thisTr).find("td:eq(0) .hid-traf-users").val();var startDate=$(thisTr).find("td:eq(2)").text();var startAddre=$(thisTr).find("td:eq(3)").text();var endDate=$(thisTr).find("td:eq(4)").text();var endAddre=$(thisTr).find("td:eq(5)").text();var vehicles=0;if($(thisTr).find("td:eq(6) input:eq(0)").val().indexOf(".")!=-1){vehicles=$(thisTr).find("td:eq(6) input:eq(0)").val().split(".")}var vehicle="";var vehicleChildCode="";if(vehicles.length>0){vehicle=vehicles[1];vehicleChildCode=vehicles[2]}else{vehicle=$(thisTr).find("td:eq(6) input:eq(0)").val();vehicleChildCode=$(thisTr).find("td:eq(6) .hid-child-code").val()}var cityMoney=$(thisTr).find("td:eq(7)").text();var cityMsg=$(thisTr).find("td:eq(8)").text();$('#model-trip-user option[value="'+busiUser+'"]').attr("selected","selected");$("#traffic-start-time").val(startDate);$("#traffic-end-time").val(endDate);$("#fromcity").val(startAddre);$("#tocity").val(endAddre);$('.traffic-form .vehicle-sel option[value="'+vehicle+'"]').attr("selected","selected");if(vehicleChildCode!=""){$("#vehicleTwoDiv").show();sysCommon.vechicleChildData(vehicle);$('.traffic-form .vehicle-two-sel option[value="'+vehicleChildCode+'"]').attr("selected","selected")}$(".traffic-form .city-cost-input").val(cityMoney);$("#special-remark").val((cityMsg=="--"?"":cityMsg));$('#model-trip-user,.traffic-form .vehicle-sel,.traffic-form .vehicle-two-sel').niceSelect();if(vehicle!=""||vehicleChildCode!=""){$(".vehicle-sel").parents("td").find(".risk-img").attr("src",reimApply.riskViaImg)}}if(costType==1){var busiUser=$(thisTr).find("td:eq(0) input").val();var dayMoney=$(thisTr).find("td:eq(3)").text();var hotelDay=$(thisTr).find("td:eq(4)").text();var hotelMoney=$(thisTr).find("td:eq(5)").text();var hotelDate=$(thisTr).find("td:eq(2)").text();var hotelAddress=$(thisTr).find("td:eq(6) input").val();hotelAddress=hotelAddress.split("-");var textareMsg=$(thisTr).find("td:eq(7)").text();$('#hotel-trip-user option[value="'+busiUser+'"]').attr("selected","selected");$(".hotel-form .yt-numberInput").val(hotelDay);if(hotelAddress.length==3){reimApply.hotelAddressChild(hotelAddress[0],"CITY");reimApply.hotelAddressChild(hotelAddress[1],"AREA")}else if(hotelAddress.length==2){reimApply.hotelAddressChild(hotelAddress[0],"CITY")}$.each(hotelAddress,function(i,n){$('.hotel-addres-sel option[value="'+n+'"]').prop("selected","selected")});$(".hotel-form .hotel-money").val(hotelMoney);$("#peoDayMoney").text(dayMoney);$("#hotelDate").val(hotelDate);$(".hotel-form .hotel-msg").val((textareMsg=="--"?"":textareMsg));$('#hotel-trip-user,.hotel-addres-sel').niceSelect();reimApply.hotelChildDisa("CITY");reimApply.hotelChildDisa("AREA")}if(costType==2){var costType=$(thisTr).find("td:eq(0) input").val();var costMoney=$(thisTr).find("td:eq(1)").text();var textareMsg=$(thisTr).find("td:eq(2)").text();$('#cost-type option[value="'+costType+'"]').attr("selected","selected");$(".other-form .other-money").val(costMoney);$(".other-form .other-msg").val((textareMsg=="--"?"":textareMsg));$('#cost-type').niceSelect()}},costDetailModelEvent:function(){var costApplyModel=$("#cost-apply-model");costApplyModel.find("#model-add-list-btn").off().on("click",function(){var tabFlag=$(".cost-type-tab li.tab-check .hid-tab").val();var validModel="";if(tabFlag==0){validModel=$(".traffic-form")}else if(tabFlag==1){validModel=$(".hotel-form")}else if(tabFlag==2){validModel=$(".other-form")}var validFlag=$yt_valid.validForm(validModel);if(validFlag){reimApply.getCostDetailData(tabFlag);sysCommon.closeModel(costApplyModel);reimApply.getRiskData()}});costApplyModel.find("#model-sure-btn").off().on("click",function(){var costType=reimApply.trObject.find(".hid-cost-type").val();var validModel="";if(costType==0){validModel=$(".traffic-form")}else if(costType==1){validModel=$(".hotel-form")}else if(costType==2){validModel=$(".other-form")}var validFlag=$yt_valid.validForm(validModel);if(validFlag){if(costType==0){var trabfficObj=$(".traffic-form");var tripUser=trabfficObj.find("#model-trip-user option:selected").text();var level=trabfficObj.find("#model-trip-user option:selected").attr("data-level");var vehicle="";if($(".vehicle-two-sel").val()!=""&&$(".vehicle-two-sel").val()!=null){vehicle=trabfficObj.find(".vehicle-two-sel option:selected").text()}else{vehicle=trabfficObj.find(".vehicle-sel option:selected").text()}var cityMoney=trabfficObj.find(".city-cost-input").val();reimApply.trObject.find("td:eq(0) span").text(tripUser);reimApply.trObject.find("td:eq(1)").text(level);reimApply.trObject.find("td:eq(0) input").val(trabfficObj.find("#model-trip-user").val());reimApply.trObject.find("td:eq(2)").text($("#traffic-start-time").val());reimApply.trObject.find("td:eq(3)").text($("#fromcity").val());reimApply.trObject.find("td:eq(4)").text($("#traffic-end-time").val());reimApply.trObject.find("td:eq(5)").text($("#tocity").val());reimApply.trObject.find("td:eq(6) span").text(vehicle);reimApply.trObject.find("td:eq(6) input:eq(0)").val(trabfficObj.find(".vehicle-sel").val());reimApply.trObject.find("td:eq(6) .hid-child-code").val($(".vehicle-two-sel").val());reimApply.trObject.find("td:eq(7)").text(cityMoney);reimApply.trObject.find("td:eq(8)").text(($("#special-remark").val()==""?"--":$("#special-remark").val()));sysCommon.updateMoneySum(0)}if(costType==1){var hotelObj=$(".hotel-form");var tripUser=hotelObj.find("select.hotel-trip-user-sel option:selected").text();var level=hotelObj.find("select.hotel-trip-user-sel option:selected").attr("data-level");var hotelAddress="";var hotelAdressCode="";var hotelParentAdres=hotelObj.find("#hotelParentAddress option:selected").text();var hotelTwoAdres=hotelObj.find("#hotelTwoAddres option:selected").text();var hotelChildAdres=hotelObj.find("#hotelChildAddres option:selected").text();if(hotelTwoAdres==""||hotelTwoAdres=="请选择"){hotelAddress=hotelParentAdres;hotelAdressCode=hotelObj.find("#hotelParentAddress").val()}else{hotelAddress=hotelParentAdres+"-"+hotelTwoAdres+"-"+hotelChildAdres;hotelAdressCode=hotelObj.find("#hotelParentAddress").val()+"-"+hotelObj.find("#hotelTwoAddres").val()+"-"+hotelObj.find("#hotelChildAddres").val()}reimApply.trObject.find("td:eq(0) span").text(tripUser);reimApply.trObject.find("td:eq(1)").text(level);reimApply.trObject.find("td:eq(2)").text($("#hotelDate").val());reimApply.trObject.find("td:eq(0) input").val(hotelObj.find("select.hotel-trip-user-sel").val());reimApply.trObject.find("td:eq(3)").text($("#peoDayMoney").text());reimApply.trObject.find("td:eq(4)").text(hotelObj.find(".yt-numberInput").val());reimApply.trObject.find("td:eq(5)").text(hotelObj.find(".hotel-money").val());reimApply.trObject.find("td:eq(6) span").text(hotelAddress);reimApply.trObject.find("td:eq(6) input").val(hotelAdressCode);reimApply.trObject.find("td:eq(7)").text((hotelObj.find(".hotel-msg").val()==""?"--":hotelObj.find(".hotel-msg").val()));sysCommon.updateMoneySum(1)}if(costType==2){var otherObj=$(".other-form");var costType=otherObj.find("#cost-type option:selected").text();reimApply.trObject.find("td:eq(0) span").text(costType);reimApply.trObject.find("td:eq(0) input").val(otherObj.find("#cost-type").val());reimApply.trObject.find("td:eq(1)").text(otherObj.find(".other-money").val());reimApply.trObject.find("td:eq(2)").text((otherObj.find(".other-msg").val()==""?"--":otherObj.find(".other-msg").val()));sysCommon.updateMoneySum(2)}sysCommon.closeModel(costApplyModel);sysCommon.clearFormData()}});costApplyModel.find("#model-canel-btn").off().on("click",function(){sysCommon.closeModel(costApplyModel);sysCommon.clearFormData()});$("#addres-icon").off().on("click",function(){var startCity=$("#fromcity").val();var endCity=$("#tocity").val();$("#tocity").val(startCity);$("#fromcity").val(endCity)});$(".yt-spin").click(function(){var hotelDay=$(".hotel-form .yt-numberInput").val();if(hotelDay<=0){hotelDay=$(".hotel-form .yt-numberInput").val(1)}reimApply.detalHotelHotelAvgPrice()});$(".yt-numberInput").on("blur",function(){var hotelMoney=$(".cost-detail-money").val();if($(this).val()==0){$(this).val(1)}reimApply.detalHotelHotelAvgPrice()});$(".city-cost-input,.cost-detail-money").on("focus",function(){if($(this).val()!=""&&$(this).val()!=null){$(this).val($yt_baseElement.rmoney($(this).val()));$(this).select()}});$(".city-cost-input,.cost-detail-money").on("blur",function(){if($(this).hasClass("cost-detail-money")){reimApply.detalHotelHotelAvgPrice()}reimApply.formartMoney($(this))})},detalHotelHotelAvgPrice:function(){var hotelPrice=$(".cost-detail-money").val();var hotelDay=$(".hotel-form .yt-numberInput").val();$("#peoDayMoney").html($yt_baseElement.fmMoney(hotelPrice/hotelDay))},bodyDateInit:function(){$("#traffic-start-time").calendar({controlId:"trafficStartTime",nowData:false,upperLimit:$("#traffic-end-time"),speed:0,callback:function(){sysCommon.clearValidInfo($("#traffic-start-time"))}});$("#traffic-end-time").calendar({controlId:"trafficEndTime",nowData:false,lowerLimit:$("#traffic-start-time"),speed:0,callback:function(){sysCommon.clearValidInfo($("#traffic-end-time"))}});$("#hotelDate").calendar({controlId:"hotelTime",nowData:false,speed:0,callback:function(){sysCommon.clearValidInfo($("#hotelDate"))}})},formartMoney:function(thisObj){if($(thisObj).val()!=""&&$(thisObj).val()!=null){$(thisObj).val($yt_baseElement.fmMoney($(thisObj).val()))}}};$(function(){reimApply.init()});