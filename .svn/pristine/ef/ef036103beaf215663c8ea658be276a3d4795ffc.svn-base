var projectList = {
	//初始化方法
	init: function() {
		
		//点击新增
		$(".add-list").on('click',function(){
			window.location.href="addProjectList.html";
		});
		//点击修改
		$(".update-list").on('click',function(){
			if($("tr.yt-table-active").length == 0){
				$yt_alert_Model.prompt("请选择要修改的数据");
				return false;
			}
			window.location.href="addProjectList.html?pkId=" + $('.yt-table-active .pkId').val();
		});
		//点击项目名称
		$(".project-tbody").on('click',".file-name",function(){
			window.location.href="projectDetails.html?pkId=" + $('.yt-table-active .pkId').val()+"&"+"tp="+1+"&"+"projectCode="+$('.yt-table-active .project-code-list').text();
		});
		//点击删除
		$(".delete-list").on('click',function(){
			if($("tr.yt-table-active").length == 0){
				$yt_alert_Model.prompt("请选择要删除的数据");
				return false;
			}
			projectList.delProjectList();
		});
		//点击立项申请
		$(".project-application").on('click',function(){
			if($("tr.yt-table-active").length == 0){
				$yt_alert_Model.prompt("请选择要操作的数据");
				return false;
			}
			//获取下一步操作人
			var dealingWithPeople = projectList.getListSelectDealingWithPeople();
			if (dealingWithPeople !=null){
				$.each(dealingWithPeople,function (i,n){
					$(".dealing-with-people").append('<option value="'+n.userCode+'">'+n.userName+'</option>');
				});
			}
			$(".dealing-with-people").niceSelect();
			//显示弹出框
			projectList.projectApplicationAlert();
			var realName = $(".yt-table-active .project-name").text();
			$(".real-name").text(realName);
			//点击提交按钮
			$(".project-application-alert .yt-model-sure-btn").click(function(){
				projectList.projectApplicationList();
			});
		});
		//点击取消
		$(".cancel-list").on('click',function(){
			if($("tr.yt-table-active").length == 0){
				$yt_alert_Model.prompt("请选择要操作的数据");
				return false;
			}
			projectList.offProjectList();
		});
		//点击恢复
		$(".regain-list").on('click',function(){
			if($("tr.yt-table-active").length == 0){
				$yt_alert_Model.prompt("请选择要操作的数据");
				return false;
			}
			projectList.restoreProjectList();
		});
		
		//调用获取列表数据方法
		projectList.getProjectListInfo();
		
		//条件搜索
		$('.search-btn').click(function() {
			
			projectList.getProjectListInfo();
		});
		
	},
	/**
	 * 获取下一步操作人
	 */
	getListSelectDealingWithPeople:function(){
		var list =[];
		$.ajax({
			type: "post",
			url: $yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",
			data:{
				businessCode:"project",
				processInstanceId:"",
				parameters:"",
				versionNum:""
			},
			async: false,
			success: function(data) {
				$.each(data.data, function(i, n) {
						console.log(n);
						console.log(i);
						for(var k in n) {
							console.log('k', k);
							console.log("n[k]", n[k]);
							list = n[k];
						}
					});
			}
		});
		return list;
	},	
	/**
	 * 获取列表数据
	 */
	getProjectListInfo: function() {
		$yt_baseElement.showLoading();
		var projectCode =$('#keyword').val();
		var projectName =$('#keyword').val();
		var projectSell =$('#keyword').val();
		var projectHead =$('#keyword').val();
		
		$('.project-page').pageInfo({
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "project/lookForAll", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode:projectCode,
				projectName:projectName,
				projectType:"",
				projectSell:projectSell,
				projectHead:projectHead,
				projectStates:"",
				startTimeStart:"",
				startTimeEnd:"",
				endTimeStart:"",
				endTimeEnd:""
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				$yt_baseElement.showLoading();
				if(data.flag == 0) {
					var htmlTbody = $('.project-tbody');
					var htmlTr = '';
					if(data.data.rows.length > 0) {
						$.each(data.data.rows, function(i, v) {
							if(v.trainDateCount==null){
								v.trainDateCount="";
							}
							if(v.projectType==1){
								v.projectType="计划";
							}else if(v.projectType==2){
								v.projectType="委托";
							}else if(v.projectType==3){
								v.projectType="选学";
							}else if(v.projectType==4){
								v.projectType="调训";
							}
							var projectStates= v.projectStates;
							if (projectStates ==1){
								projectStates='未立项';
							}
							if (projectStates ==2){
								projectStates='审批中';
							}
							if (projectStates ==3){
								projectStates='未通过';
							}
							if (projectStates ==4){
								projectStates='已立项';
							}
							if (projectStates ==5){
								projectStates='培训中';
							}
							if (projectStates ==6){
								projectStates='未结项';
							}
							if (projectStates ==7){
								projectStates='已结项';
							}
							if(v.projectType=="委托"){
								v.projectCode="";
							}
							
							htmlTr += '<tr>' +
								'<td class="project-code-list"><input type="hidden" value="' + v.pkId + '" class="pkId">' + v.projectCode + '</td>' +
								'<td class="project-name"><a class="file-name">'+v.projectName+'</a></td>' +
								'<td>' + v.projectType + '</td>' +
								'<td>' + v.startDate + '</td>' +
								'<td>' + v.trainDateCount + '</td>' +
								'<td>' + v.projectSell + '</td>' +
								'<td>' + v.projectHead + '</td>' +
								'<td>' + v.traineeCount + '</td>' +
								'<td>' + projectStates + '</td>' +
								'</tr>';
								$(".project-page").show();
						});
					} else {
						$(".project-page").hide();
						htmlTr += '<tr style="border:0px;background-color:#fff !important;" >' +
							'<td colspan="9" align="center" style="border:0px;">' +
							'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
							'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
							'</div>' +
							'</td>' +
							'</tr>';
					}
					htmlTbody.html(htmlTr);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function (){
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	//删除
    delProjectList:function() {
		var pkId = $('.yt-table-active .pkId').val();
		$yt_alert_Model.alertOne({
			haveCloseIcon: false, //是否带有关闭图标  
			closeIconUrl: "", //关闭图标路径  
			leftBtnName: "确定", //左侧按钮名称,默认确定  
			rightBtnName: "取消", //右侧按钮名称,默认取消  
			cancelFunction: "", //取消按钮操作方法*/  
			alertMsg: "数据删除将无法恢复,确认删除吗?", //提示信息  
			confirmFunction: function() { //点击确定按钮执行方法  
				$.ajax({
					type: "post",
					url: $yt_option.base_path + "project/deleteProject",
					data: {
						pkId: pkId
					},
					success: function(data) {
						if(data.flag == 0) {
							$yt_alert_Model.prompt("删除成功");
				 			$('.project-page').pageInfo("refresh");
						} else {
							$yt_alert_Model.prompt("删除失败");
						}

					}

				});

			}
		});
	},
	//取消
    offProjectList:function() {
		var pkId = $('.yt-table-active .pkId').val();
		$yt_alert_Model.alertOne({
			haveCloseIcon: false, //是否带有关闭图标  
			closeIconUrl: "", //关闭图标路径  
			leftBtnName: "确定", //左侧按钮名称,默认确定  
			rightBtnName: "取消", //右侧按钮名称,默认取消  
			cancelFunction: "", //取消按钮操作方法*/  
			alertMsg: "是否取消该项目并通知项目负责人?", //提示信息  
			confirmFunction: function() { //点击确定按钮执行方法  
				$.ajax({
					type: "post",
					url: $yt_option.base_path + "project/updateProjectDataStates",
					data: {
						pkId: pkId,
						type: 2
					},
					success: function(data) {
						if(data.flag == 0) {
							$yt_alert_Model.prompt("已取消");
				 			$('.project-page').pageInfo("refresh");
						} else {
							$yt_alert_Model.prompt("操作失败");
						}

					}

				});

			}
		});
	},
	//恢复
    restoreProjectList:function() {
		var pkId = $('.yt-table-active .pkId').val();
		$yt_alert_Model.alertOne({
			haveCloseIcon: false, //是否带有关闭图标  
			closeIconUrl: "", //关闭图标路径  
			leftBtnName: "确定", //左侧按钮名称,默认确定  
			rightBtnName: "取消", //右侧按钮名称,默认取消  
			cancelFunction: "", //取消按钮操作方法*/  
			alertMsg: "是否恢复该项目并通知项目负责人?", //提示信息  
			confirmFunction: function() { //点击确定按钮执行方法  
				$.ajax({
					type: "post",
					url: $yt_option.base_path + "project/updateProjectDataStates",
					data: {
						pkId: pkId,
						type: 1
					},
					success: function(data) {
						if(data.flag == 0) {
							$yt_alert_Model.prompt("已恢复");
				 			$('.project-page').pageInfo("refresh");
						} else {
							$yt_alert_Model.prompt("操作失败");
						}

					}

				});

			}
		});
	},
	//立项申请
	projectApplicationList: function() {
		var  validFlag = $yt_valid.validForm($(".valid-tab"));
		if(validFlag){
			
			
		}else{
			
		}
		var pkId = $(".yt-table-active .pkId").val();
		var remarks = $(".project-application-alert .remarks").val();
		var dealingWithPeople = $(".project-application-alert .dealing-with-people").val();
		
		$.ajax({
			type: "post", //ajax访问方式 默认 "post"  
			url: $yt_option.base_path + "project/addOrApprovalProject", //ajax访问路径  
			data: {
				pkId:pkId,
				remarks:remarks,        
				businessCode:"project", 
				dealingWithPeople:dealingWithPeople,    
				opintion:"",    
				processInstanceId:"",      
				nextCode:"submited"

			}, //ajax查询访问参数
			success: function(data) {
				if(data.flag == 0){
				 	$yt_alert_Model.prompt("操作成功");
				 	$(".yt-edit-alert").hide();
				}else{
					$yt_alert_Model.prompt("操作失败");
				}
			} 
		});
	},
	//立项申请弹出框
	projectApplicationAlert:function() {  
        /** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
        $(".lawyer-opinion-box").show();  
        /** 
         * 调用算取div显示位置方法 
         */  
        $yt_alert_Model.getDivPosition($(".lawyer-opinion-box"));  
        /*
               缩小窗口显示滚动条
         * */
        $yt_alert_Model.setFiexBoxHeight($(".project-application-alert form"));
        /* 
         * 调用支持拖拽的方法 
         */  
        $yt_model_drag.modelDragEvent($(".lawyer-opinion-box .yt-edit-alert-title"));  
        /** 
         * 点击取消方法 
         */  
        $('.lawyer-opinion-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".lawyer-opinion-box").hide();  
            //隐藏蒙层  
            $("#pop-modle-alert").hide();  
        });  
    }
	
}
$(function() {
	//初始化方法
	projectList.init();
	
});