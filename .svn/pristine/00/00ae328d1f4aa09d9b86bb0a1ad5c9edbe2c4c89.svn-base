var pro={init:function(){pro.searchList();pro.events()},events:function(){$('.pending').on('click','.apprv-btn',function(){var thisTr=$(this).parents("tr");var advanceAppId=thisTr.find(".advanceAppIdUpdate").val();var appId=thisTr.find('.advance-app-id').val();var taskKey=$(this).attr('taskKey');if(taskKey=='activitiStartTask'){var pageUrl="view/system-sasac/expensesReim/module/busiTripApply/projectServeApply.html?appId="+advanceAppId;window.location.href=$yt_option.websit_path+pageUrl}else{var pageUrl="view/system-sasac/expensesReim/module/busiTripApply/projectServeExamine.html?appId="+advanceAppId;window.location.href=$yt_option.websit_path+pageUrl}});$('.pending').on('click','.to-detail',function(){var thisTr=$(this).parents("tr");var advanceAppId=thisTr.find(".advance-app-id").val();var processInstanceId=thisTr.find(".processInstanceId").val();var pageUrl="view/system-sasac/expensesReim/module/beforehand/beforeApplyDetail.html?advanceId="+advanceAppId;$yt_baseElement.openNewPage(2,pageUrl)});$('.pending').on('click','.to-update-detail',function(){var thisTr=$(this).parents("tr");var advanceAppId=thisTr.find(".advanceAppIdUpdate").val();var processInstanceId=thisTr.find(".processInstanceId").val();var pageUrl="view/system-sasac/expensesReim/module/busiTripApply/projectServeDetails.html?advanceAppId="+advanceAppId;$yt_baseElement.openNewPage(2,pageUrl)});$('.search').on('keydown',function(){if($('.search').val()!=''||$('.search').val()!=null){$('.clearImg').show()}});$('.clearImg').on('click',function(){$('.search').val('');$(this).hide();pro.searchList()});$("#resetBtn").off().on("click",function(){$('.search').val('');$(".clearImg").hide();pro.searchList()});$("#searchBtn").off().on("click",function(){pro.searchList()});$(".end-table").on('click','.process-state',function(){var processInstanceId=$(this).parents("tr").find(".processInstanceId").val();sysCommon.processStatePop(processInstanceId)});$("#printUpdateBtn").click(function(){var selTrLen=$(".tab-div .tab-content:visible tbody tr.yt-table-active").length;var thisTrData=$(".tab-div .tab-content:visible tbody tr.yt-table-active").data("dataStr");if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作")}else{var pageUrl="view/projectManagement/expensesReim/module/print/bugetAdjustApplyForm.html?expenditureAppId="+thisTrData.advanceAppId+'&costType='+thisTrData.advanceCostType;$yt_baseElement.openNewPage(2,pageUrl)}});$('.screen input').change(function(){var stateCode="WF_PASS_QUERY_SQL_PARAMS";var signState=function(){var states=$('.screen .check');if($(states).length>=2||$(states).length<=0){return '2'}else if($(states).length<2){return $(states).find('input').val()}return ''};var sta='';if($(this).parent().hasClass('check')){$(this).setCheckBoxState("uncheck");sta=signState()}else{$(this).setCheckBoxState("check");sta=signState()}pro.getProcessingAndFinishList(stateCode,sta)});var check=true;$('.all-checked').click(function(){if(check){$('.end-table tbody').setCheckBoxState("checkAll");$('.end-table tbody tr').addClass('yt-table-active')}else{$('.end-table tbody').setCheckBoxState("unCheckAll");$('.end-table tbody tr').removeClass('yt-table-active')}check=!check});$('.already-printed').click(function(){var ids='';$('.end-table tbody .check').each(function(i,n){ids+=$(n).find('input').val()+(i<$('.end-table tbody .check').length-1?',':'')});if(ids){pro.updateAdvanceUpdateIsPrintStateYes(ids);check=true}else{$yt_alert_Model.prompt('请选择数据进行操作')}});$('.non-printing').click(function(){var ids='';$('.end-table tbody .check').each(function(i,n){ids+=$(n).find('input').val()+(i<$('.end-table tbody .check').length-1?',':'')});if(ids){pro.updateAdvanceUpdateIsPrintStateNo(ids);check=true}else{$yt_alert_Model.prompt('请选择数据进行操作')}});$(".end-table .yt-tbody").on('change','input[type=checkbox]',function(){if($(this)[0].checked){$(this).parents('tr').addClass('yt-table-active')}else{$(this).parents('tr').removeClass('yt-table-active')}return false});$(".end-table .yt-tbody").on('click','tr',function(){if($(this).hasClass('yt-table-active')){$(this).removeClass('yt-table-active');$(this).find('input[type=checkbox]').setCheckBoxState('uncheck')}else{$(this).addClass('yt-table-active');$(this).find('input[type=checkbox]').setCheckBoxState('check')}})},updateAdvanceUpdateIsPrintStateYes:function(ids){$.ajax({type:"post",url:"sz/advanceAppUpdate/updateAdvanceUpdateIsPrintStateYes",async:false,data:{ids:ids},success:function(data){if(data.flag==0){$yt_alert_Model.prompt(data.message);pro.searchList()}else{$yt_alert_Model.prompt(data.message)}}})},updateAdvanceUpdateIsPrintStateNo:function(ids){$.ajax({type:"post",url:"sz/advanceAppUpdate/updateAdvanceUpdateIsPrintStateNo",async:false,data:{ids:ids},success:function(data){if(data.flag==0){$yt_alert_Model.prompt(data.message);pro.searchList()}else{$yt_alert_Model.prompt(data.message)}}})},searchList:function(){pro.getProcessingAndFinishList('WF_PASS_QUERY_SQL_PARAMS','2')},getProcessingAndFinishList:function(stateCode,printState){var keyWord=$('.search').val();$('.page2').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:'sz/advanceAppUpdate/getUserAdvanceUpdateAppInfoBusinessListToPageByParams',data:{queryStateParams:stateCode,queryParams:keyWord,printState:printState},objName:'data',success:function(data){var datas=data.data.rows;var thisTbody=$('.end-table .yt-tbody');thisTbody.empty();var trStr="";if(data.flag==0){if(datas.length>0){$('.page2').show();$.each(datas,function(i,n){trStr+='<tr><td><label style="position: relative;z-index: 100;" class="check-label yt-checkbox"><input type="checkbox" name="test" value="'+n.advanceAppId+'"/></label></td><td><a class="yt-link to-update-detail">'+n.advanceAppNumUpdate+'</a><input type="hidden" class="advance-app-id" value="'+n.advanceAppIdUpdate+'"/><input type="hidden" class="advanceAppIdUpdate" value="'+n.advanceAppId+'"/><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/></td><td><a class="yt-link to-detail">'+n.advanceAppNum+'</a></td><td style="text-align:left;">'+(n.advanceAppName==""?"--":n.advanceAppName)+'</td><td style="text-align: right;">'+(n.changeAmount==""?$yt_baseElement.fmMoney(0):$yt_baseElement.fmMoney(n.changeAmount))+'</td>'+'<td>'+n.applicantUserName+'</td><td><span>'+n.applicantDept+'</span></td>';if(stateCode=='WF_PASS_QUERY_SQL_PARAMS'){$(".applicant-time-th").show();trStr+='<td>'+n.applicantTime+'</td>'}else{$(".applicant-time-th").hide();}if(stateCode=='WF_SOLVED_QUERY_SQL_PARAMS'){$(".process-state-th").show();trStr+='<td style="text-align:left;"><span class="yt-link process-state">'+n.nodeNowState+'</span></td>';}else{$(".process-state-th").hide();}trStr+='<td class="print-state" style="color: '+(n.isPrint==0?'#333333':'#417095')+';">'+(n.isPrint==0?'未打印':'已打印')+'</td><td>'+(stateCode!='WF_SUSPENDING_QUERY_SQL_PARAMS'?'':'<a class="yt-link apprv-btn" taskKey="'+n.taskKey+'">'+(n.taskKey=='activitiStartTask'?'处理':'审批')+'</a><span class="center-line">|</span>')+'<a class="yt-link log-mod">日志</a></td></tr>';trStr=$(trStr).data("dataStr",n);thisTbody.append(trStr)});sysCommon.initQtip($(".log-mod"))}else{$('.page2').hide();thisTbody.empty();thisTbody.append(pro.noDataTrStr(8))}}},isSelPageNum:false })},noDataTrStr:function(trNum){var noDataStr='<tr style="border:0px;background-color:#fff !important;"><td  colspan="'+trNum+'" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';return noDataStr}};$(function(){pro.init();$("#projectBefList").css("min-height",$(window).height()-12)});