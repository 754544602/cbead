var proCostUsageQuery={thisDate:"",init:function(){$("#proCostUsageQuery").css("min-height",$(window).height()-13);proCostUsageQuery.events();$("#startDate").calendar({controlId:"startTime",nowData:true,upperLimit:$("#endDate"),speed:0,callback:function(){}});$("#endDate").calendar({controlId:"endTime",nowData:true,lowerLimit:$("#startDate"),speed:0,callback:function(){}});proCostUsageQuery.thisDate=$("#endDate").val();$("#startDate").val(proCostUsageQuery.thisDate.substring(0,proCostUsageQuery.thisDate.length-5)+"01-01");proCostUsageQuery.tablePage();proCostUsageQuery.verifyTable()},events:function(){$(".sort-btn-list").on("click",".yt-search-btn:not(.export-excel)",function(){var thisBtn=$(this);$(".sort-btn-list .yt-search-btn").removeClass("sort-btn-style");thisBtn.addClass("sort-btn-style");proCostUsageQuery.tablePage()});$('.clearImg').on('click',function(){$('.query-text').val('');$(".query-pid").val('');$(this).hide();proCostUsageQuery.tablePage();});$("#resetBtn").click(function(){$(".query-text").val('');$(".query-pid").val('');$("#startDate").val(proCostUsageQuery.thisDate.substring(0,proCostUsageQuery.thisDate.length-5)+"01-01");$("#endDate").val(proCostUsageQuery.thisDate);$('.clearImg').hide();$(".sort-btn-list .yt-search-btn").removeClass("sort-btn-style");$(".radio-input-list input").parent("label").removeClass("check");$(".radio-input-list .yt-radio input:checked").val('');proCostUsageQuery.tablePage()});$("#heardSearchBtn").click(function(){proCostUsageQuery.tablePage()});$(".radio-input-list .yt-radio").change(function(){proCostUsageQuery.tablePage()});$('.query-text').keyup(function(){if($(this).val()){$('.clearImg').show()}else{$('.clearImg').hide()}});$(".pro-cost-table").on("click",".money-adjustment-count",function(){var thisTr=$(this).parents("tr");var advanceAppId=thisTr.find(".app-id").val();var appName=thisTr.find(".app-name").text();proCostUsageQuery.showAlert(advanceAppId,appName)});$(".pro-cost-table").on("click",".to-detail-query",function(){var thisTr=$(this).parents("tr");var advanceAppId=thisTr.find(".app-id").val();var appName=thisTr.find(".app-name").text();var appNum=thisTr.find(".app-num").val();var pageUrl="view/projectManagement-sasac/expensesReim/module/query/proCostUsageQuery.html?advanceAppId="+advanceAppId+"&appName="+appName+"&appNum="+appNum;$yt_baseElement.openNewPage(2,pageUrl)});$(".pro-cost-table").on("click",".to-detail",function(){var thisTr=$(this).parents("tr");var advanceAppId=thisTr.find(".app-id").val();var pageUrl="view/projectManagement-sasac/expensesReim/module/beforehand/beforeApplyDetail.html?advanceId="+advanceAppId;$yt_baseElement.openNewPage(2,pageUrl)});$(".adjust-number-pop .content-table").on("click",".to-detail",function(){var thisTr=$(this).parents("tr");var advanceAppId=thisTr.find(".app-id").val();var pageUrl="view/system-sasac/expensesReim/module/busiTripApply/projectServeDetails.html?advanceAppId="+advanceAppId;$yt_baseElement.openNewPage(2,pageUrl)});$(".yt-edit-alert").on("click",".pop-search",function(){});$(".yt-edit-alert").on("click",".pop-reset",function(){$(".pop-text").val("");proCostUsageQuery.tablePage()});$(".pop-sure-btn").click(function(){var selTrLen=$(".pro-pop-table tbody tr.yt-table-active").length;var thisTr=$(".pro-pop-table tbody tr.yt-table-active");var thisBtn=$(this);var Id=thisTr.find("input.tableId").val();if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作")}else{$(".query-text").val(thisTr.find("td").eq(0).text());var pid=thisTr.attr("pid");$(".query-pid").val(pid);if($(".query-text").val()!=''){$('.clearImg').show()}$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();proCostUsageQuery.tablePage()}});$('.export-excel').on('click',function(){var queryParams=$(".query-text").val();queryParams=encodeURI(encodeURI(queryParams));var inputCheck=$(".radio-input-list input:checked").val()||'';var startDate=$("#startDate").val();var endDate=$("#endDate").val();var property=$(".sort-btn-list .sort-btn-style").attr("btn-val")||'';var direction='DESC';var yitianSSODynamicKey=$yt_baseElement.getToken();var urlStr=$yt_option.base_path+'sz/advanceAppUpdate/exportTotalAdvanceAppQueryByParams?queryStateParams='+inputCheck+'&queryParams='+queryParams+'&startDate='+startDate+'&endDate='+endDate+'&property='+property+'&direction='+direction+"&yitianSSODynamicKey="+yitianSSODynamicKey+"&ajax=1";if(typeof(downloadIframe)=="undefined"){var iframe=document.createElement("iframe");downloadIframe=iframe;document.body.appendChild(downloadIframe)}downloadIframe.src=urlStr;downloadIframe.style.display="none"})},tablePage:function(){var queryParams=$(".query-text").val();var inputCheck=$(".radio-input-list input:checked").val();var startDate=$("#startDate").val();var endDate=$("#endDate").val();var property=$(".sort-btn-list .sort-btn-style").attr("btn-val");var direction='DESC';$('.payment-table-page').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:'sz/advanceAppUpdate/getTrainProjectByParams',data:{queryStateParams:inputCheck,queryParams:queryParams,startDate:startDate,endDate:endDate,property:property,direction:direction,},objName:'data',success:function(data){var htmlTbody=$('.pro-cost-table .yt-tbody.tbody-content');htmlTbody.empty();if(data.flag==0){$(".all-amount").text($yt_baseElement.fmMoney((data.data.allAmount||0)));var datas=data.data.rows;if(datas.length!=0){var trStr='';$.each(datas,function(i,n){trStr+='<tr><td><a class="yt-link to-detail"><input type="hidden" class="app-id" value="'+n.appId+'"><input type="hidden" class="app-num" value="'+n.appNum+'">'+n.appNum+'</a></td><td class="tl app-name">'+n.appName+'</td><td>'+(n.adjustmentNum==0?n.adjustmentNum:'<a class="yt-link money-adjustment-count">'+n.adjustmentNum+'</a>')+'</td><td class="tr">'+$yt_baseElement.fmMoney((n.totalAmount||0))+'</td><td class="tr">'+(n.totalAmountNow=="--"?"--":$yt_baseElement.fmMoney((n.totalAmountNow)))+'</td><td class="tr le-td">'+$yt_baseElement.fmMoney((n.adjustmentAmount||0))+'</td>'+'<td>'+n.applicantUserName+'</td><td>'+n.applicantDept+'</td><td>'+n.applicateTime+'</td><td><a class="yt-link to-detail-query">详情</a></td></tr>'});htmlTbody.html(trStr);$('.payment-table-page').show();proCostUsageQuery.verifyTable()}else{htmlTbody.html(sysCommon.noDataTrStr(11));$('.payment-table-page').hide()}}else{$yt_alert_Model.prompt(data.message);htmlTbody.html(sysCommon.noDataTrStr(11));$('.payment-table-page').hide()}},isSelPageNum:true})},verifyTable:function(){var leTdList=$(".le-td");var gtTdList=$(".gt-td");leTdList.each(function(index){if($yt_baseElement.rmoney(leTdList.eq(index).text())>0){leTdList.eq(index).addClass("red-color")}else{leTdList.eq(index).removeClass("red-color")}});gtTdList.each(function(index){if(gtTdList.eq(index).text().substring(0,gtTdList.eq(index).text().length-1)/100>1){gtTdList.eq(index).addClass("red-color")}else{gtTdList.eq(index).removeClass("red-color")}})},popTablePage:function(advanceAppId){$.ajax({type:"post",url:"sz/advanceAppUpdate/getAdjustmentAllAmountByAdvanceAppId",async:false,data:{advanceAppId:advanceAppId,},success:function(data){var htmlTbody=$('.adjust-number-pop .content-table .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){$(".adjust-number-pop .update-advance-amount").text($yt_baseElement.fmMoney((data.data.updateAdvanceAmount||0)));var datas=data.data.data;if(datas.length>0){$('.prior-page').show();$.each(datas,function(i,n){trStr+='<tr><td><a class="yt-link to-detail"><input type="hidden" class="app-id" value="'+n.appId+'"/>'+n.updateAdvanceNum+'</a></td><td class="tr">'+$yt_baseElement.fmMoney((n.updateAdvanceAmount||0))+'</td><td>'+n.updateApplicateTime+'</td></tr>'});htmlTbody.html(trStr)}else{htmlTbody.html('<tr style="border:0px;background-color:#fff !important;"><td  colspan="6" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;padding:10px"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="width: 180px;padding: 10px 0 20px;"></div></td></tr>');}}else{htmlTbody.html('<tr style="border:0px;background-color:#fff !important;"><td  colspan="6" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;padding:10px"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="width: 180px;padding: 10px 0 20px;"></div></td></tr>');$yt_alert_Model.prompt(data.message)}$yt_alert_Model.getDivPosition($(".adjust-number-pop"))},isSelPageNum:true })},showAlert:function(advanceAppId,appName){sysCommon.showModel($(".adjust-number-pop"));$(".adjust-number-pop .app-name").text(appName);proCostUsageQuery.popTablePage(advanceAppId);$('.adjust-number-pop .yt-eidt-model-bottom .yt-model-canel-btn').on("click",function(){sysCommon.closeModel($(".adjust-number-pop"))})}};$(function(){proCostUsageQuery.init()});