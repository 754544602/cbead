var caList={ue:null,init:function(){var me=this;caList.clearAlertBox();$('select').niceSelect();caList.deleteInfo();if($("#types").val()==1){$('#reimbursementTitle').text('新增教师课酬报销')}else if($("#types").val()==2){$('#reimbursementTitle').text('新增教师差旅报销')}$("#types").change(function(){if($("#types").val()==1){$('#reimbursementTitle').text('新增教师课酬报销');$yt_baseElement.showLoading();setTimeout(window.location.href='reimbursementAdd.html',500);setTimeout($yt_baseElement.hideLoading(),500)}else if($("#types").val()==2){$('#reimbursementTitle').text('新增教师差旅报销');$yt_baseElement.showLoading();setTimeout(window.location.href='travelAdd.html',500);setTimeout($yt_baseElement.hideLoading(),500)}});caList.relevance();$("#issueDayeString").calendar({speed:200,complement:true,readonly:true,lowerLimit:"2010/01/01",nowData:true,dateFmt:"yyyy-MM-dd HH:mm",callback:function(){}});caList.getClassLis();var nextPersonList=caList.getNextOperatePerson();if(nextPersonList!=null){$.each(nextPersonList,function(i,n){$("#dealingWithPeople").append($('<option value="'+n.userCode+'">'+n.userName+'</option>').data("classData",n))})};var pkId=$yt_common.GetQueryString("pkId");if(pkId!=null){caList.getListUpdate(pkId)}$("#dealingWithPeople").niceSelect();$('.page-return-btn').off().on("click",function(){caList.backNewsListPage()});$('#cancel').off().on("click",function(){caList.backNewsListPage()});$('#save').off('click').on('click',function(){caList.isNoNull(1)});$('#submit').off('click').on('click',function(){caList.isNoNull(2)});$(".tab-title-list button").click(function(){$(this).addClass("active").siblings().removeClass("active");operate=$(this).text();if(operate=="• 机票"){$('#planTable').show();$('#trainTable').hide();me.linkList(1)}if(operate=="• 火车票"){$('#planTable').hide();$('#trainTable').show();me.linkList(2)}});$('#planTable').on('change','.select-plan-checkbox input:checked',function(){var planData=$(this).parent().parent().parent().data('planData');planData.dateExit=planData.dateExit.replace('-','');planData.dateExit=planData.dateExit.replace('-','');var linkLi='';linkLi='<li class="link-li link-li'+planData.pkId+'" teacherStatementDetailsIds="'+planData.pkId+'">'+planData.dateExit+'-'+planData.passenger+'-'+planData.trainNumber+'<span class="delete-link" style="color: red;cursor: pointer;">×</span></li>';$('.link-ul').append(linkLi);$('.link-li'+planData.pkId).data('pkId',planData.pkId)});$('#planTable').on('change','.select-plan-checkbox input:not(:checked)',function(){var planData=$(this).parent().parent().parent().data('planData');$('.link-li'+planData.pkId).remove()});$('#trainTable').on('change','.select-train-checkbox input:checked',function(){var trainData=$(this).parent().parent().parent().data('trainData');trainData.dateExit=trainData.dateExit.replace('-','');trainData.dateExit=trainData.dateExit.replace('-','');var linkLi='';linkLi='<li class="link-li link-li'+trainData.pkId+'" teacherStatementDetailsIds="'+trainData.pkId+'">'+trainData.dateExit+'-'+trainData.passenger+'-'+trainData.trainNumber+'<span class="delete-link" style="color: red;cursor: pointer;">×</span></li>';$('.link-ul').append(linkLi);$('.link-li'+trainData.pkId).data('pkId',trainData.pkId)});$('#trainTable').on('change','.select-train-checkbox input:not(:checked)',function(){var trainData=$(this).parent().parent().parent().data('trainData');$('.link-li'+trainData.pkId).remove()});$("#planTable .check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck");$.each($(this).parents("table").find(".select-plan-checkbox input:not(:checked)"),function(a,b){var planData=$(b).parent().parent().parent().data('planData');$('.link-li'+planData.pkId).remove()})}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check");$.each($(this).parents("table").find(".select-plan-checkbox input:checked"),function(a,b){var planData=$(b).parent().parent().parent().data('planData');if($('.link-li').hasClass('link-li'+planData.pkId)==false){planData.dateExit=planData.dateExit.replace('-','');planData.dateExit=planData.dateExit.replace('-','');var linkLi='';linkLi='<li class="link-li link-li'+planData.pkId+'" teacherStatementDetailsIds="'+planData.pkId+'">'+planData.dateExit+'-'+planData.passenger+'-'+planData.trainNumber+'<span class="delete-link" style="color: red;cursor: pointer;">×</span></li>';$('.link-ul').append(linkLi);$('.link-li'+planData.pkId).data('pkId',planData.pkId)}})}});$("#trainTable .check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck");$.each($(this).parents("table").find(".select-train-checkbox input:not(:checked)"),function(a,b){var trainData=$(b).parent().parent().parent().data('trainData');$('.link-li'+trainData.pkId).remove()})}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check");$.each($(this).parents("table").find(".select-train-checkbox input:checked"),function(a,b){var trainData=$(b).parent().parent().parent().data('trainData');if($('.link-li').hasClass('link-li'+trainData.pkId)==false){trainData.dateExit=trainData.dateExit.replace('-','');trainData.dateExit=trainData.dateExit.replace('-','');var linkLi='';linkLi='<li class="link-li link-li'+trainData.pkId+'" teacherStatementDetailsIds="'+trainData.pkId+'">'+trainData.dateExit+'-'+trainData.passenger+'-'+trainData.trainNumber+'<span class="delete-link" style="color: red;cursor: pointer;">×</span></li>';$('.link-ul').append(linkLi);$('.link-li'+trainData.pkId).data('pkId',trainData.pkId)}})}});$('.travel-top').on('click','.delete-link',function(){var pkId=$(this).parent().data('pkId');$('.planTr'+pkId).find('.select-plan-checkbox input:checked').setCheckBoxState("uncheck");$('.trainTr'+pkId).find('.select-plan-checkbox input:checked').setCheckBoxState("uncheck");$(this).parent().remove()});$('.linkData').click(function(){$(".travel-import-form").hide();$("#pop-modle-alert").hide();var trClass=$(".travel-import-form").attr('trClass');var trClass=trClass.substring(trClass.lastIndexOf(" ")+1,trClass.length);$('.'+trClass).find('.bookingRecord').empty();$.each($('.link-li'),function(k,c){var ctext=$(c).text().replace('×','');var divList='<div teacherStatementDetailsId="'+$(c).attr('teacherstatementdetailsids')+'">'+ctext+'</div>';$('.'+trClass).find('.bookingRecord').append(divList)})})},backNewsListPage:function(){window.location.href='reimbursementList.html'},getClassLis:function(){$.ajax({type:"post",url:$yt_option.base_path+"finance/reduction/lookForAllProject",data:{},async:false,success:function(data){if(data.flag==0){var userName=caList.userInfo();var projectHeadCode;var classTeacherCode;var projectSellCode;var projectAidCode;$.each(data.data,function(i,n){projectHeadCode=n.projectHeadCode;classTeacherCode=n.classTeacherCode;projectSellCode=n.projectSellCode;projectAidCode=n.projectAidCode;if(projectHeadCode.indexOf(userName)!=-1||classTeacherCode.indexOf(userName)!=-1||projectSellCode.indexOf(userName)!=-1||projectHeadCode.indexOf(userName)!=-1||projectAidCode.indexOf(userName)!=-1){$("#projectCode").append($('<option value="'+n.projectCode+'">'+n.projectName+'</option>').data("classData",n))}});$("#projectCode").niceSelect();$('#projectCode').off().on('change',function(){var createUserName=$('#projectCode option:selected').data("classData").createUserName;createUserName==null?createUserName='':createUserName=createUserName;var projectHead=$('#projectCode option:selected').data("classData").projectHead;projectHead==null?projectHead='':projectHead=projectHead;$('#createUserName').text(createUserName);$('#projectHead').text(projectHead);$("#projectUsermoney").text($('#projectCode option:selected').data('classData').projectSurplusBudget);var projectCode=$('#projectCode option:selected').data("classData").projectCode;caList.getListAdd(projectCode)})}else{$yt_alert_Model.prompt("查询失败")}},error:function(){$yt_alert_Model.prompt("网络异常，请稍后重试")}})},userInfo:function(){var userName="";$.ajax({async:false,type:"post",url:$yt_option.base_path+"uniform/user/getUsersDetails",data:{},success:function(data){userName=data.data.userName}});return userName},isNoNull:function(dataStates){var testSelect=$("#types").val();var className=$('#projectCode option:selected').val();var dealingWithPeople=$('#dealingWithPeople').val();$yt_valid.validForm($("#valid-tab"));if(testSelect==''||className==''||dealingWithPeople==''){$yt_valid.validForm($(".valid-tab"))}else{caList.addnewsInfo(dataStates)}},getNextOperatePerson:function(){var user=null;$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"news",types:'1'},async:false,success:function(data){if(data.flag==0){$.each(data.data,function(i,n){for(var k in n){user=n[k]}})}}});return user},clearAlertBox:function(){$('#projectCode').val("");$('#projectUserName').val("");$('#types').val("");$('#dealingWithPeople').val("");$('select').niceSelect()},getList:[],getListUpdate:function(pkId){me=this;$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/getBeanByIdTravel",async:false,data:{pkId:pkId},success:function(data){if(data.flag==0){caList.ue=data.data;$("select.type-select").setSelectVal(data.data.expenseType);$("select.user-name-sel").setSelectVal(data.data.projectCode);var projectUserName=$('#projectCode option:selected').data("classData").projectUserName;var createUser=$('#projectCode option:selected').data("classData").createUser;$('#projectUserName').text(projectUserName);if(pkId!=''){}$('#createUser').text(createUser);$('.details').text(data.data.remarks);$('.remarks').val(data.data.remarks);var projectCode=$('#projectCode option:selected').data("classData").projectCode;me.getListAdd(projectCode);$('#reimbursementTitle').text('修改教师差旅报销')}}})},getListAdd:function(projectCode){var me=this;var pkId=$yt_common.GetQueryString("pkId");pkId==null?pkId='':pkId=pkId;$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/getTeacherTrainDetails",async:false,data:{projectCode:projectCode,pkId:pkId},success:function(data){if(data.flag==0){me.getList=data.data;var htmlTbody=$('.class-tbody');var htmlTr='';htmlTbody.empty();if(data.data.length>0){var num=0;var allTravelmoney=0;var salesPriceSum=0;var refundSigningFeeSum=0;var expenseMoneySum=0;var checksalesPriceSum=0;var checkrefundSigningFeeSum=0;var checkexpenseMoneySum=0;$.each(data.data,function(i,v){allTravelmoney=parseInt(v.salesPrice)+parseInt(v.insurance)+parseInt(v.refundSigningFee);salesPriceSum+=parseInt(v.salesPrice);refundSigningFeeSum+=parseInt(v.refundSigningFee);expenseMoneySum+=allTravelmoney;if(v.papersType==1){v.papersTypeVel='身份证'}if(v.papersType==2){v.papersTypeVel='护照'}if(v.papersType==3){v.papersTypeVel='港澳通行证'}else{v.papersTypeVel=' '}if(v.paymentMethod==1){v.paymentMethodVel='支票';checksalesPriceSum+=parseInt(v.salesPrice);checkrefundSigningFeeSum+=parseInt(v.refundSigningFee);checkexpenseMoneySum+=allTravelmoney}else if(v.paymentMethod==2){v.paymentMethodVel='电汇'}else if(v.paymentMethod==3){v.paymentMethodVel='归还公务卡'}else if(v.paymentMethod==4){v.paymentMethodVel='现金'}else if(v.paymentMethod==5){v.paymentMethodVel='核销借款'}else{v.paymentMethodVel=''}if(v.flighttrainNumber==undefined){v.flighttrainNumber=''}num=i+1;var bookingRecord='';if(v.bookingRecord!=undefined){$.each(v.bookingRecord,function(x,y){bookingRecord+='<div teacherStatementDetailsId="'+y.teacherStatementDetailsId+'">'+y.teacherStatementDetails+'</div>'})}htmlTr='<tr  class="rows tr'+i+' row'+i+'" teacherId="'+v.teacherId+'">'+'<td style="text-align:center" class="num">'+num+'</td>'+'<td style="text-align:center">'+v.teacherName+'</td>'+'<td style="text-align:center">'+v.flighttrainNumber+'</td>'+'<td>'+v.placeDeparture+'</td>'+'<td>'+v.bourn+'</td>'+'<td>'+v.startEndTime+'</td>'+'<td class="salesPriceTd"><input type="text" class="salesPrice" value="'+v.salesPrice+'" readonly="readonly" style="border:none;background:none;text-align:right"/></td>'+'<td style="text-align:right" class="insurance">'+v.insurance+'</td>'+'<td class="refundSigningFeeTd"><input type="text" class="refundSigningFee" value="'+v.refundSigningFee+'" readonly="readonly" style="border:none;background:none;text-align:right"/></td>'+'<td class="allTravelmoney" style="text-align:right">'+allTravelmoney+'</td>'+'<td style="text-align:center"><span class="paymentMethod">'+v.paymentMethodVel+'</span><select class="yt-select select-hide" style="width: 100%;display:none;"><option value="1">支票</option><option value="2">电汇</option><option value = "3" >归还公务卡 </option><option value="4">现金 </option><option value="5">核销借款</option></select></td > '+'<td style="text-align:center" class="bookingRecord">'+bookingRecord+'</td>'+'<td style="text-align:center"><a class="relevance-tb">关联</a><span> </span><a class="delete-tb" style="color:red;">删除</a><span> </span><a class="update-tb">编辑</a></td></tr>';htmlTbody.append(htmlTr);v.num=i;console.log(v);$('.tr'+i).data('trData',v);if($('.tr'+i).find('.select-hide').val()==2){var data=$('.tr'+i).data('trData');var all=$('.tr'+i).find('.allTravelmoney').text();me.addTwoInfo(data,all);addAll()}});var numb=num+1;htmlTr='<tr><td class="numb" style="display:none;">'+numb+'</td><td colspan="6" style="text-align:center">合计：</td><td class="salesPriceSum"  style="text-align:right;font-weight:bold">'+salesPriceSum+'</td><td></td><td id="refundSigningFeeSum" style="text-align:right;font-weight:bold">'+refundSigningFeeSum+'</td><td id="expenseMoneySum" style="text-align:right;font-weight:bold">'+expenseMoneySum+'</td><td></td><td></td><td></td></tr><tr><td class="numbs" style="display:none;">'+numb+'</td><td colspan="6" style="text-align:center">支票合计：</td><td class="checksalesPriceSum"  style="text-align:right;font-weight:bold">'+checksalesPriceSum+'</td><td></td><td id="checkrefundSigningFeeSum" style="text-align:right;font-weight:bold">'+checkrefundSigningFeeSum+'</td><td id="checkexpenseMoneySum" style="text-align:right;font-weight:bold">'+checkexpenseMoneySum+'</td><td></td><td></td><td></td></tr>';htmlTbody.append(htmlTr)}else{htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="11" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$('select').niceSelect();$('.select-hide').hide();$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},linkList:function(types){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/getTeacherRelationDetails",async:true,data:{types:types},success:function(data){var htmlTr='';if(types==1){if(data.data.length>0){$('#planTableList').empty();$('.checklabel-all').removeClass('check');$.each(data.data,function(i,n){n.pkId==undefined?n.pkId=0:n.pkId=n.pkId;htmlTr='<tr class="planTr'+n.pkId+'"><td style="text-align: center;"><label class="check-label yt-checkbox select-plan-checkbox"><input type="checkbox" name="test" class="select-teacher-pkId" value="'+n.pkId+'"/></label></td><td style="text-align:center">'+(i+1)+'</td>'+'<td style="text-align:center">'+n.dateExit+'</td>'+'<td style="text-align:center">'+n.dateDeparture+'</td>'+'<td>'+n.ticketNumber+'</td>'+'<td style="text-align:center">'+n.passenger+'</td>'+'<td style="text-align:center">'+n.trip+'</td>'+'<td style="text-align:center">'+n.trainNumber+'</td>'+'<td style="text-align:right">'+n.salesPrice+'</td>'+'<td style="text-align:right">'+n.construction+'</td>'+'<td style="text-align:right">'+n.taxation+'</td>'+'<td style="text-align:right">'+n.insurance+'</td>'+'<td style="text-align:right">'+n.totalAmount+'</td>'+'<td style="text-align:center">'+n.reservations+'</td></tr>'$('#planTableList').append(htmlTr);$('.planTr'+n.pkId).data('planData',n)})}else{htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="11" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';$('#planTableList').append(htmlTr)}}if(types==2){if(data.data.length>0){$('#trainTableList').empty();$('.checklabel-all').removeClass('check');$.each(data.data,function(i,n){htmlTr='<tr class="trainTr'+n.pkId+'"><td style="text-align: center;"><label class="check-label yt-checkbox select-train-checkbox"><input type="checkbox" name="test" class="select-teacher-pkId" value="'+n.pkId+'"/></label></td><td>'+(i+1)+'</td>'+'<td style="text-align:center">'+n.dateExit+'</td>'+'<td style="text-align:center">'+n.dateDeparture+'</td>'+'<td style="text-align:center">'+n.passenger+'</td>'+'<td style="text-align:center">'+n.trip+'</td>'+'<td style="text-align:center">'+n.trainNumber+'</td>'+'<td style="text-align:right">'+n.salesPrice+'</td>'+'<td style="text-align:right">'+n.costWork+'</td>'+'<td style="text-align:right">'+n.totalAmount+'</td>'+'<td style="text-align:center">'+n.reservations+'</td></tr>'$('#trainTableList').append(htmlTr);$('.trainTr'+n.pkId).data('trainData',n)})}else{htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="11" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';$('#planTableList').append(htmlTr)}}$.each($('.link-li'),function(x,y){var pkId=$(y).attr('teacherstatementdetailsids');$('.trainTr'+pkId).find('input[type="checkbox"]').setCheckBoxState("check");$('.planTr'+pkId).find('input[type="checkbox"]').setCheckBoxState("check")});$yt_baseElement.hideLoading()}})},addnewsInfo:function(dataStates){var me=this;$yt_baseElement.showLoading();var pkId=$yt_common.GetQueryString("pkId");var projectCode=$('#projectCode').val();var deptBudget=$('.where').val();var remarks=$('.remarks').val();var teacherCount=$('.num').length;var expenseMoney=$('#expenseMoneySum').text();var expenseDetailsjson={teacherId:'',routeType:'',salesPrice:'',insurance:'',refundSigningFee:'',expenseMoney:'',paymentMethod:'',teacherStatementDetailsIds:''};var expenseDetails=[];var dealingWithPeople=$('#dealingWithPeople').val();opintion=$('.remarks').val();var processInstanceId="";$.each($('.rows'),function(a,b){var array=[];expenseDetailsjson.teacherId=$(b).attr('teacherid');expenseDetailsjson.routeType=1;expenseDetailsjson.salesPrice=$(b).find('.salesPrice').val();expenseDetailsjson.insurance=$(b).find('.insurance').text();expenseDetailsjson.refundSigningFee=$(b).find('.refundSigningFee').val();expenseDetailsjson.expenseMoney=$(b).find('.allTravelmoney').text();expenseDetailsjson.paymentMethod=$(b).find('.select-hide').val();$.each($(b).find('.bookingRecord').find('div'),function(c,d){array.push($(d).attr('teacherStatementDetailsIds'));array=array.join(',')});expenseDetailsjson.teacherStatementDetailsIds=array;expenseDetails.push(expenseDetailsjson)});expenseDetails=JSON.stringify(expenseDetails);if(pkId!=null){$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/getBeanByIdTravel",async:false,data:{pkId:pkId},success:function(data){if(data.flag==0){processInstanceId=data.data.processInstanceId}}})}$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/addOrUpdateBeanTravel",data:{pkId:pkId,expenseType:2,projectCode:projectCode,deptBudget:1,remarks:remarks,teacherCount:teacherCount,expenseMoney:expenseMoney,expenseDetails:expenseDetails,dataStates:dataStates,businessCode:'travelExpense',dealingWithPeople:dealingWithPeople,opintion:opintion,processInstanceId:processInstanceId,nextCode:"submited"},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("添加成功");$(".yt-edit-alert,#heard-nav-bak").hide()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交失败")})}caList.backNewsListPage()}})},deleteData:[],deleteInfo:function(){var me=this;$('.list-box').on('click','.delete-tb',function(){$(this).parent().parent().remove();me.allmoney();});$('.list-box').on('click','.update-tb',function(){$(this).parents('tr').find('input').removeAttr('readonly');$(this).parents('tr').find('input').css('border','1px solid #e6e6e6');$(this).parents('tr').find('.paymentMethod').hide();$(this).parents('tr').find('.select-hide').setSelectVal($(this).parents('tr').find('.paymentMethod').text());$(this).parents('tr').find('div.select-hide').show();$(this).addClass('yes');$(this).text('确定');me.allmoney()});$('.list-box').on('click','.yes',function(){$(this).parents('tr').find('input').attr('readonly','readonly');$(this).parents('tr').find('input').css('border','none');$(this).parents('tr').find('.paymentMethod').show();$(this).parents('tr').find('div.select-hide').hide();$(this).parents('tr').find('.paymentMethod').text($(this).parents('tr').find('select.select-hide option:selected').text());$(this).parents('tr').find('.yes').text('编辑');$(this).parents('tr').find('.yes').removeClass('yes');me.allmoney()})},allmoney:function(){var me=this;$('.list-box').on('keyup','.salesPrice',function(){if($(this).val()==''){$(this).val(0)}var salesPrice=$(this).val();var refundSigningFee=$(this).parent().siblings('.refundSigningFeeTd').children('.refundSigningFee').val();var insurance=$(this).parent().siblings('.insurance').text();var all=parseInt(salesPrice)+parseInt(refundSigningFee)+parseInt(insurance);var num=$(this).parent().parent().data('trData').num;$('.twoTr'+num).children('.twotablemoney').text(all);$(this).parent().siblings('.allTravelmoney').text(all);$(this).val($(this).val().replace(/[^\d{1,}\.\d{1,}|\d{1,}]/g,''));addAll()});$('.list-box').on('keyup','.refundSigningFee',function(){if($(this).val()==''){$(this).val(0)}var refundSigningFee=$(this).val();var salesPrice=$(this).parent().siblings('.salesPriceTd').children('.salesPrice').val();var insurance=$(this).parent().siblings('.insurance').text();var all=parseInt(salesPrice)+parseInt(refundSigningFee)+parseInt(insurance);var num=$(this).parent().parent().data('trData').num;$('.twoTr'+num).children('.twotablemoney').text(all);$(this).parent().siblings('.allTravelmoney').text(all);$(this).val($(this).val().replace(/[^\d{1,}\.\d{1,}|\d{1,}]/g,''));addAll()});$(".select-hide").change(function(){if($(this).val()==2){var data=$(this).parent().parent().data('trData');var all=$(this).parent().siblings('.allTravelmoney').text();me.addTwoInfo(data,all);addAll()}else{var num=$(this).parent().parent().data('trData').num;$('.twoTr'+num).remove();if($('.twoTr').length==0){var tr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="11" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';$('#two-table').append(tr)}addAll()}});function addAll(){var allTravelmoney=0;var salesPriceSum=0;var refundSigningFeeSum=0;var checksalesPriceSum=0;var checkrefundSigningFeeSum=0;var checkexpenseMoneySum=0;$.each($('.select-hide'),function(index,model){if($(model).val()==1){checksalesPriceSum+=parseInt($(model).parent().siblings('.salesPriceTd').children('.salesPrice').val());checkrefundSigningFeeSum+=parseInt($(model).parent().siblings('.refundSigningFeeTd').children('.refundSigningFee').val());checkexpenseMoneySum+=parseInt($(model).parent().siblings('.allTravelmoney').text())}});$.each($('.salesPrice'),function(i,n){if($(n).val()!='0'){$(n).val($(n).val().replace(/\b(0+)/gi,""))}salesPriceSum+=parseInt($(n).val())});$.each($('.refundSigningFee'),function(i,n){if($(n).val()!='0'){$(n).val($(n).val().replace(/\b(0+)/gi,""))}refundSigningFeeSum+=parseInt($(n).val())});$.each($('.allTravelmoney'),function(i,n){allTravelmoney+=parseInt($(n).text())});$('.salesPriceSum').text(salesPriceSum);$('#refundSigningFeeSum').text(refundSigningFeeSum);$('#expenseMoneySum').text(allTravelmoney);$('.checksalesPriceSum').text(checksalesPriceSum);$('#checkrefundSigningFeeSum').text(checkrefundSigningFeeSum);$('#checkexpenseMoneySum').text(checkexpenseMoneySum)}addAll()},relevance:function(){var me=this;$('.class-tbody').on('click','.relevance-tb',function(){me.linkList(1);$('.link-ul').empty();$.each($(this).parent().siblings('.bookingRecord').find('div'),function(j,v){var teacherStatementDetailsId=$(v).attr('teacherStatementDetailsId');var teacherStatementDetails=$(v).text();var linkLi='<li class="link-li link-li'+teacherStatementDetailsId+'" teacherStatementDetailsIds="'+teacherStatementDetailsId+'">'+teacherStatementDetails+'<span class="delete-link" style="color: red;cursor: pointer;">×</span></li>';$('.link-ul').append(linkLi)});$(".travel-import-form").attr('trClass',$(this).parent().parent().attr('class'));$(".travel-import-form").show();$yt_alert_Model.getDivPosition($(".travel-import-form"));$yt_model_drag.modelDragEvent($(".travel-import-form .yt-edit-alert-title"));$('.travel-import-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".travel-import-form").hide();$("#pop-modle-alert").hide()})})},addTwoInfo:function(data,all){var htmlBody=$('#two-table');var htmlTr='';htmlBody.empty();data.papersNumber==undefined?data.papersNumber='':data.papersNumber=data.papersNumber;htmlTr='<tr class="twoTr twoTr'+data.num+'"><td style="text-align:center">'+(data.num+1)+'</td><td style="text-align:center">'+data.teacherName+'</td><td style="text-align:center">'+data.papersTypeVel+'</td><td>'+data.papersNumber+'</td><td>'+data.registeredBank+'</td><td>'+data.account+'</td><td style="text-align:center">电汇</td><td style="text-align:right" class="twotablemoney" >'+all+'</td></tr>';htmlBody.append(htmlTr)}};$(function(){caList.init()});