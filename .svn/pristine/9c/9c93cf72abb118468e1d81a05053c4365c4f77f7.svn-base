/**
 * 费用支付反馈列表查询
 */
var projectList={init:function(){projectList.getBlongClass();$(".yt-select").niceSelect();var time=0;var time1=0;var time2=0;$(".apply-time-start").calendar({controlId:"startDate",dateFmt:"yyyy-MM-dd HH:mm",nowData:false,upperLimit:$(".apply-time-end")});$(".apply-time-end").calendar({controlId:"endDate",dateFmt:"yyyy-MM-dd HH:mm",nowData:false,lowerLimit:$(".apply-time-start")});$(".start-time-start").calendar({controlId:"startDate",dateFmt:"yyyy-MM-dd",nowData:false,upperLimit:$(".start-time-end")});$(".start-time-end").calendar({controlId:"endDate",dateFmt:"yyyy-MM-dd",nowData:false,lowerLimit:$(".start-time-start")});$(".end-time-start").calendar({controlId:"startDate",dateFmt:"yyyy-MM-dd",nowData:false,upperLimit:$(".end-time-end")});$(".end-time-end").calendar({controlId:"endDate",dateFmt:"yyyy-MM-dd",nowData:false,lowerLimit:$(".end-time-start")});projectList.getPlanListInfo();$('.list-table').on("click",".class-name",function(){var pkId=$(this).parents("tr").find('.pkId').text();var expenseType=$(this).parents("tr").find('.expenseType').text();var workFlawState=$(this).parents("tr").find('.workFlawState').text();if(expenseType==1){if(workFlawState=='已开票'){window.location.href="reimbursementLook.html?pkId="+pkId}else{window.location.href="reimburDetailPayment.html?pkId="+pkId}}if(expenseType==2){if(workFlawState=='已开票'){window.location.href="reimburseTravelDetailsLook.html?pkId="+pkId}else{window.location.href="reimburseTravelDetailsPayment.html?pkId="+pkId}}});$('.back-btn').click(function(){window.history.back()});$('.search-btn').click(function(){projectList.getPlanListInfo()});var clickTime=0;$("button.senior-search-btn").click(function(){if(clickTime%2==0){$(".search-box").show();$(".search-put").addClass('flipy')}else{$(".search-box").hide();$(".search-put").removeClass('flipy')}clickTime+=1});$(".expense-tr input").blur(function(){$(this).val($(this).val().replace(/[^\d.]/g,""));$(this).val(Number($(this).val()))});$(".tab-title-box button").click(function(){$(this).addClass('active').siblings().removeClass('active');var thisIndex=$(this).index();$(".content-div").eq(thisIndex).show().siblings('.content-div').hide();if(thisIndex==0){$(".page-main").css('min-width','1100px');projectList.getPlanListInfo()}else{$yt_baseElement.showLoading(2000);$("div.search-form table label input[name='test']").setRadioState("uncheck");$("div.travel-div").hide();$("div.class-rem-div").hide();$("#treeDiv").hide();$("#treeDiv1").hide();$("#treeDiv2").hide();projectList.resertSearch();projectList.getTeacher();$(".page-main").css('min-width','2000px');$yt_baseElement.hideLoading()}});$("div.apply-man").click(function(){if(time%2==0){$("#treeDiv").show();$("#treeDiv1").hide();$("#treeDiv2").hide();time1=0;time2=0}else{$("#treeDiv").hide()}time+=1});$("div.project-dir").click(function(){if(time1%2==0){$("#treeDiv1").show();$("#treeDiv2").hide();$("#treeDiv").hide();time=0;time2=0}else{$("#treeDiv1").hide()}time1+=1});$("div.project-class-dir").click(function(){if(time2%2==0){$("#treeDiv2").show();$("#treeDiv").hide();$("#treeDiv1").hide();time=0;time1=0}else{$("#treeDiv2").hide()}time2+=1});$("button.senior-query-btn").click(function(){var ty=$("div.search-form table label input[name='test']:checked").val();console.log('ty',ty);if(ty==1){projectList.getTeacherTrval();$("div.travel-div").show();$("div.class-rem-div").hide()}else if(ty==2){projectList.getTeacherClass();$("div.class-rem-div").show();$("div.travel-div").hide()}else{$yt_alert_Model.prompt("请先选择报销类型")}});$("button.export-excel-btn").click(function(){var ty=$("div.search-form table label input[name='test']:checked").val();if(ty==1){$yt_baseElement.showLoading();projectList.trvalExport();$yt_baseElement.hideLoading()}else if(ty==2){$yt_baseElement.showLoading();projectList.classExport();$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("请先选择报销类型")}});$("button.resert-btn").click(function(){var ty=$("div.search-form table label input[name='test']:checked").val();projectList.resertSearch();if(ty==1){projectList.getTeacherTrval()}else if(ty==2){projectList.getTeacherClass()}});},getPlanListInfo:function(){var queryParams=$('#keyword').val();$('.list-page').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/teacherExpense/lookForAll",type:"post",data:{selectParam:queryParams,createTimeStart:"",createTimeEnd:"",teacherCountStart:"",teacherCountEnd:"",expenseMoneyStart:"",expenseMoneyEnd:"",expenseType:"",workFlawState:"已完成"},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.open-class-tbody').empty();var htmlTr='';var num=0;if(data.data.rows.length>0){$('.list-page').show();$.each(data.data.rows,function(i,v){num+=1;var expenseType=Number(v.expenseType);if(expenseType==1){expenseType='教师课酬报销'}if(expenseType==2){expenseType='教师差旅报销'}v.workFlawState=='已完成'?v.workFlawState='已通过':v.workFlawState=v.workFlawState;htmlTr='<tr class="td-list"><td class="pkId" style="display:none;">'+v.pkId+'</td><td class="paymentState" style="display:none;">'+v.paymentState+'</td><td><a class="class-name"style="color: #3c4687;">'+v.flowNumber+'</a></td><td class="expenseType" style="display:none;">'+v.expenseType+'</td><td>'+expenseType+'</td><td>'+v.projectCode+'</td><td>'+v.projectName+'</td><td>'+v.projectHead+'</td><td>'+v.createTime+'</td><td>'+v.teacherCount+'</td><td>'+$yt_baseElement.fmMoney(v.expenseMoney,2)+'</td><td class="workFlawState">'+v.workFlawState+'</td></tr>';htmlTbody.append(htmlTr)})}if(num==0){$('.list-page').hide();htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},resertSearch:function(){$("div.search-form input").val("");$(".belong-class-select").setSelectVal("");$(".class-teacher-name").setSelectVal("");$('div.yt-input').text("");$('div.yt-input').attr('textname','');projectList.treeList()},teacher:function(){var teacher={startDateStart:$(".start-time-start").val(),startDateEnd:$(".start-time-end").val(),endDateStart:$(".end-time-start").val(),endDateEnd:$(".end-time-end").val(),projectCode:$(".belong-class-select").val(),teacherName:$(".class-teacher-name").val(),createUser:$("div.apply-man").attr('textName'),projectHead:$("div.project-dir").attr('textName'),classTeacher:$("div.project-class-dir").attr('textName')};return teacher},trvalExport:function(){var teacher=projectList.teacher();$.ajaxDownloadFile({url:$yt_option.base_path+"finance/teacherExpense/downloadTeacherTravelBusiness",data:teacher})},classExport:function(){var teacher=projectList.teacher();$.ajaxDownloadFile({url:$yt_option.base_path+"finance/teacherExpense/downloadTeacherClassRemuneration",data:teacher})},getTeacherTrval:function(){var teacher=projectList.teacher();$('.travel-page').pageInfo({pageIndexs:1,pageNum:15,url:$yt_option.base_path+"finance/teacherExpense/lookForAllByTeacherTravelBusiness",type:"post",data:teacher,objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){var htmlTr='';if(data.flag==0){$(".travel-div tbody.list-tbody").empty();if(data.data.rows.length!=0){$('.travel-page').show();$.each(data.data.rows,function(i,n){var allMoey=Number(n.salesPrice)+Number(n.insurance)+Number(n.refundSigningFee);var bookingRecord=[];if(n.bookingRecord.length!=0){$.each(n.bookingRecord,function(a,b){bookingRecord.push(b.teacherStatementDetails)});bookingRecord=bookingRecord.join(",")}htmlTr='<tr><td>'+(i+1)+'</td><td>'+n.teacherName+'</td><td>'+n.papersType+'</td><td>'+n.papersNumber+'</td><td>'+n.registeredBank+'</td><td>'+n.account+'</td><td>'+n.flighttrainNumber+'</td><td>'+n.placeDeparture+'</td><td>'+n.bourn+'</td><td>'+n.startEndTime+'</td><td>'+n.salesPrice+'</td><td>'+n.insurance+'</td><td>'+n.refundSigningFee+'</td><td>'+$yt_baseElement.fmMoney(allMoey,2)+'</td>'+'<td>'+n.paymentMethod+'</td><td>'+bookingRecord+'</td><td>'+n.projectCode+'</td><td>'+n.projectName+'</td><td>'+n.projectHead+'</td><td>'+n.classTeacher+'</td><td>'+n.createUser+'</td><td>'+n.createTimeStr+'</td></tr>';$(".travel-div tbody.list-tbody").append(htmlTr)})}else{$('.travel-page').hide();htmlTr='<tr><td colspan="22" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';$(".travel-div tbody.list-tbody	").append(htmlTr)}console.log('差旅');$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getTeacherClass:function(){var teacher=projectList.teacher();$('.class-page').pageInfo({pageIndexs:1,pageNum:15,url:$yt_option.base_path+"finance/teacherExpense/lookForAllByTeacherClassRemuneration",type:"post",data:teacher,objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){var htmlTr='';if(data.flag==0){$(".class-rem-div tbody.list-tbody").empty();if(data.data.rows.length!=0){$('.class-page').show();$.each(data.data.rows,function(i,n){var courseDate=n.courseDateJson.length;if(courseDate!=0){$.each(n.courseDateJson,function(a,b){if(a==0){htmlTr='<tr><td rowspan="'+courseDate+'">'+(i+1)+'</td><td rowspan="'+courseDate+'">'+n.teacherName+'</td><td rowspan="'+courseDate+'">'+n.papersType+'</td><td rowspan="'+courseDate+'">'+n.papersNumber+'</td><td rowspan="'+courseDate+'">'+n.registeredBank+'</td><td rowspan="'+courseDate+'">'+n.account+'</td><td rowspan="">'+b.courseDate+'</td><td rowspan="'+courseDate+'">'+$yt_baseElement.fmMoney(n.expenseMoney,2)+'</td><td rowspan="'+courseDate+'">'+$yt_baseElement.fmMoney(n.surrenderPersonal,2)+'</td><td rowspan="'+courseDate+'">'+$yt_baseElement.fmMoney(n.afterTax,2)+'</td><td rowspan="'+courseDate+'">'+n.projectCode+'</td><td rowspan="'+courseDate+'">'+n.projectName+'</td><td rowspan="'+courseDate+'">'+n.projectHead+'</td><td rowspan="'+courseDate+'">'+n.classTeacher+'</td><td rowspan="'+courseDate+'">'+n.createUser+'</td><td rowspan="'+courseDate+'">'+n.createTimeStr+'</td></tr>';$(".class-rem-div tbody.list-tbody").append(htmlTr)}else{htmlTr='<tr><td>'+b.courseDate+'</td></tr>';$(".class-rem-div tbody.list-tbody").append(htmlTr)}})}else{htmlTr='<tr><td>'+(i+1)+'</td><td>'+n.teacherName+'</td><td>'+n.papersType+'</td><td>'+n.papersNumber+'</td><td>'+n.registeredBank+'</td><td>'+n.account+'</td><td></td><td>'+$yt_baseElement.fmMoney(n.expenseMoney,2)+'</td><td>'+$yt_baseElement.fmMoney(n.surrenderPersonal,2)+'</td><td>'+$yt_baseElement.fmMoney(n.afterTax,2)+'</td><td>'+n.projectCode+'</td><td>'+n.projectName+'</td><td>'+n.projectHead+'</td><td>'+n.classTeacher+'</td><td>'+n.createUser+'</td><td>'+n.createTimeStr+'</td></tr>';$(".class-rem-div tbody.list-tbody").append(htmlTr)}})}else{$('.class-page').hide();htmlTr='<tr><td colspan="16" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';$(".class-rem-div tbody.list-tbody").append(htmlTr)}console.log('课酬');$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getBlongClass:function(){var classList;$.ajax({type:"post",url:$yt_option.base_path+"finance/reduction/lookForAllProject",data:{selectParam:"",projectCode:""},async:false,success:function(data){if(data.flag==0){classList=data.data}}});$("select.belong-class-select").niceSelect({search:true,backFunction:function(text){$("select.belong-class-select").empty();if(text==""){$("select.belong-class-select").append('<option value="">请选择</option>')}$.each(classList,function(i,n){if(n.projectName.indexOf(text)!=-1){$("select.belong-class-select").append('<option value="'+n.projectCode+'">'+n.projectName+'</option>')}})}})},getTeacher:function(){var teacherList;$.ajax({type:"post",url:$yt_option.base_path+"class/course/getTeacherAll",data:{teacherName:""},async:true,success:function(data){if(data.flag==0){teacherList=data.data}}});$("select.class-teacher-name").niceSelect({search:true,backFunction:function(text){$("select.class-teacher-name").empty();if(text==""){$("select.class-teacher-name").append('<option value="">请选择</option>')}$.each(teacherList,function(i,n){if(n.teacherName.indexOf(text)!=-1){$("select.class-teacher-name").append('<option value="'+n.teacherId+'">'+n.teacherName+'</option>')}})}})},getUsers:function(){var usersList;$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsers",data:{compId:"",userName:""},async:false,success:function(data){if(data.flag==0){usersList=data.data}}});return usersList},getTreeData:function(data,parentId){var me=this;var result=[],temp;for(var i in data){if(data[i].parentId==parentId){result.push(data[i]);temp=projectList.getTreeData(data,data[i].id);if(temp.length>0){data[i].children=temp}}}return result},treeList:function(){var usersList=projectList.getUsers();$('#tt').tree({data:projectList.getTreeData(usersList,"0"),checkbox:true,animate:true,onCheck:function(node,checked){console.log(projectList.treeGetData());var check='';var textCode='';var nodes=projectList.treeGetData().nodes;$.each(nodes,function(i,n){if(n.type==3){if(check==''){check+=n.text}else{check+=","+n.text}if(textCode==''){textCode+=n.textName}else{textCode+=","+n.textName}}});$("div.apply-man").text(check);$("div.apply-man").attr('textName',textCode)}});$('#aa').tree({data:projectList.getTreeData(usersList,"0"),checkbox:true,animate:true,onCheck:function(node,checked){console.log(projectList.treeGetData());var check='';var textCode='';var node1=projectList.treeGetData().node1;$.each(node1,function(i,n){if(n.type==3){if(check==''){check+=n.text}else{check+=","+n.text}if(textCode==''){textCode+=n.textName}else{textCode+=","+n.textName}}});$("div.project-dir").text(check);$("div.project-dir").attr('textName',textCode)}});$('#cc').tree({data:projectList.getTreeData(usersList,"0"),checkbox:true,animate:true,onCheck:function(node,checked){console.log(projectList.treeGetData());var check='';var textCode='';var node2=projectList.treeGetData().node2;$.each(node2,function(i,n){if(n.type==3){if(check==''){check+=n.text}else{check+=","+n.text}if(textCode==''){textCode+=n.textName}else{textCode+=","+n.textName}}});$("div.project-class-dir").text(check);$("div.project-class-dir").attr('textName',textCode)}})},treeGetData:function(){var nodes=$('#tt').tree('getChecked');var node1=$('#aa').tree('getChecked');var node2=$('#cc').tree('getChecked');return{nodes:nodes,node1:node1,node2:node2}}};$(function(){projectList.init()});