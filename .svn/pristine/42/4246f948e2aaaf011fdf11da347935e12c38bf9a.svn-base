var loanApply={riskExcMark:"../../../../../resources-sasac/images/common/war-red.png",riskWarImg:"../../../../../resources-sasac/images/common/risk-war.png",riskViaImg:"../../../../../resources-sasac/images/common/risk-via.png",loanId:"",loanDataObj:"",init:function(){sysCommon.getLoginUserInfo();$("#loanApply select").niceSelect();var requerParameter=$yt_common.GetRequest();loanApply.loanId=requerParameter.loanId;loanApply.loanMoneyEvent();$("#loanApply").css("min-height",$(window).height()-32);loanApply.events();loanApply.fmMonList();loanApply.getLoanInfoDetail();var requerParameter=$yt_common.GetRequest();var processInstanceId=requerParameter.processInstanceId;var flowLogHtml=sysCommon.getCommentByProcessInstanceId(processInstanceId);$(".flow-log-div").html(flowLogHtml)},fmMonList:function(){$(".refund-tab-inp").attr("placeholder","0.00");var moneyInpArray=$(".refund-tab-inp");for(j=0;j<moneyInpArray.length;j+=1){if(moneyInpArray.eq(j).val()!=''){moneyInpArray.eq(j).val($yt_baseElement.fmMoney(moneyInpArray.eq(j).val()))}};var moneyTextArray=$(".moneyText");for(h=0;h<moneyTextArray.length;h+=1){if(moneyTextArray.eq(h).text()!=''){moneyTextArray.eq(h).text($yt_baseElement.fmMoney(moneyTextArray.eq(h).text()))}else{moneyTextArray.eq(h).text($yt_baseElement.fmMoney(0))}}},events:function(){$("#closeBtn").click(function(){if(window.top==window.self){window.close()}else{parent.closeWindow()}});$('.refund-tab-inp').on('focus',function(){var ts=$(this);if(ts.val()!=""){ts.val($yt_baseElement.rmoney(ts.val()))}});$('.refund-tab-inp').on('blur',function(){var ts=$(this);if(ts.val()!=''){ts.val($yt_baseElement.fmMoney(ts.val()))}});$('.refund-tab-inp').on('keyup',function(){var ts=$(this);if(ts.val()!=''){ts.val(ts.val().replace(/[^\d.]/g,''))}});$('.refund-tab-inp').blur(function(){loanApply.refundTotal()});$('.yt-table tbody').on('click','tr',function(){var ts=$(this);var trs=ts.siblings();trs.removeClass('yt-table-active');ts.addClass('yt-table-active')})},getLoanInfoDetail:function(){$.ajax({type:"post",url:"sz/loanApp/getLoanAppInfoDetailByLoanAppId",async:false,data:{loanAppId:loanApply.loanId},success:function(data){if(data.flag==0){var dataObj=data.data;loanApply.loanDataObj=dataObj;if(dataObj&&dataObj!=""&&dataObj!=undefined){$("#formNum").text(dataObj.loanAppNum);$("#applyDate").text(dataObj.applicantTime);$("#busiUsers").text(dataObj.applicantUserName);$("#deptName").text(dataObj.applicantUserDeptName);$("#jobName").text(dataObj.applicantUserJobName==""?"--":dataObj.applicantUserJobName);$("#telPhone").text(dataObj.applicantUserPhone==""?"--":dataObj.applicantUserPhone);$("#loanAppName").text(dataObj.loanAppName);$("#lonMon").text($yt_baseElement.fmMoney(dataObj.loanAmount));$("#moneyUpper").text(arabiaToChinese(dataObj.loanAmount+''));$("#loanTerm").text(dataObj.loanTerm);$("#expectRepaymentTime").text(dataObj.expectRepaymentTime||'--');var paymentMethod="";if(dataObj.paymentMethod=="1"){paymentMethod="现金"}else if(dataObj.paymentMethod=="2"){paymentMethod="支票"}$("#paymentMethod").text(paymentMethod);if(dataObj.isSettleInfo){$("#noCloseOut").text(dataObj.isSettleInfo.noCloseOut);$("#loanAppNumStr").text(dataObj.isSettleInfo.loanAppNumStr||'--')}if(dataObj.amountRecord){var money=dataObj.amountRecord.loanAmount;var frozenLoanAmount=dataObj.amountRecord.blockingAmount;var usedAmount=dataObj.amountRecord.usedAmount;var allowUseAmount=dataObj.amountRecord.allowUseAmount;$("#loanSumAmount").text(money==""?"0.00":($yt_baseElement.fmMoney(money)));$("#frozenLoanAmount").text(frozenLoanAmount==""?"0.00":($yt_baseElement.fmMoney(frozenLoanAmount)));$("#haveBeenLoanAmount").text(usedAmount==""?"0.00":($yt_baseElement.fmMoney(usedAmount)));$("#loanBillAB").text(allowUseAmount==""?"0.00":($yt_baseElement.fmMoney(allowUseAmount)))}$(".paymentHistory tbody").empty();if(dataObj.refundList&&dataObj.refundList.length>0){var trStr="";$.each(dataObj.refundList,function(i,n){trStr=$('<tr><td style="text-align: center !important;">'+n.refundTime+'</td><td style="padding-right: 5px;"style="text-align: right;"><div class="moneyText">'+(n.refundAmount==""?"0.00":($yt_baseElement.fmMoney(n.refundAmount)))+'</div></td><td style="padding-right: 5px;"><div class="moneyText">'+(n.chargeAgainst==""?"0.00":($yt_baseElement.fmMoney(n.chargeAgainst)))+'</div></td><td style="padding-right: 5px;"><div class="moneyText">'+(n.cash==""?"0.00":($yt_baseElement.fmMoney(n.cash)))+'</div></td><td style="padding-right: 5px;"><div class="moneyText">'+(n.cheque==""?"0.00":($yt_baseElement.fmMoney(n.cheque)))+'</div></td><td style="padding-right: 5px;"><div class="moneyText">'+(n.transfer==""?"0.00":($yt_baseElement.fmMoney(n.transfer)))+'</div></td></tr>');trStr.data("refundInfo",n);$(".paymentHistory tbody").append(trStr)})}else{$(".base-info-model.payment-history").hide()}}sysCommon.getApproveFlowData("SZ_LOAN_APP",dataObj.processInstanceId)}else{$yt_alert_Model.prompt(data.message,2000)}}})},refundTotal:function(){var body=$('.amount-table');var refundCash=0;var refundCheck=0;var refundTransfer=0;if(body.find('#refundCash').val()!=''){refundCash=parseFloat($yt_baseElement.rmoney(body.find('#refundCash').val()))}if(body.find('#refundCheck').val()!=''){refundCheck=parseFloat($yt_baseElement.rmoney(body.find('#refundCheck').val()))}if(body.find('#refundTransfer').val()!=''){refundTransfer=parseFloat($yt_baseElement.rmoney(body.find('#refundTransfer').val()))}var refundTotal=refundCash+refundCheck+refundTransfer;body.find('#refundTotal').text($yt_baseElement.fmMoney(refundTotal))},loanMoneyEvent:function(){$("#loanMoney").on("focus",function(){if($(this).val()!=""&&$(this).val()!=null){$(this).val($yt_baseElement.rmoney($(this).val()));$(this).select()}});$("#loanMoney").on("blur",function(){if($(this).val()!=""&&$(this).val()!=null){var fmMoney=$yt_baseElement.fmMoney($(this).val());$(this).val(fmMoney);var lowerMoney=arabiaToChinese($(this).val());$("#moneyLower").text(lowerMoney)}})}};$(function(){loanApply.init()});