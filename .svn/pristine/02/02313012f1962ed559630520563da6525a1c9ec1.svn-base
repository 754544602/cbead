var projectSelection={init:function(){projectSelection.getProjectSelectionInf();projectSelection.getCompanyList();$(".project-selection-more").click(function(){$(".student-hide").show();$(".project-student-td").attr("colspan","16")});var projectName=$yt_common.GetQueryString("projectName");debugger;$(".project-name").text(decodeURI(decodeURI(projectName)));$(".page-return-btn").click(function(){window.location.href="projectBillList.html"});$(".search-btn").click(function(){projectSelection.getProjectSelectionInf()});$('.box-list').on('click','.real-name-inf',function(){var studentList=$('.yt-table-active').data('studentList');var traineeId=studentList.traineeId;var headImg=new Image();var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeDetails",data:{traineeId:traineeId,projectId:projectCode},async:true,success:function(data){var htmlBody=$('.student-details-form .student-details-train-record tbody');var htmlTrs='';htmlBody.empty();if(data.flag==0){detailsMsg=data.data;detailsMsg.checkInDate=detailsMsg.checkInDate.split(" ")[0];if(detailsMsg.gender==1){detailsMsg.gender="男"}else{detailsMsg.gender="女"}if(detailsMsg.invoiceType==0){detailsMsg.invoiceType="暂不开票"}else if(detailsMsg.invoiceType==1){detailsMsg.invoiceType="普通发票"}else{detailsMsg.invoiceType="增值税发票"}if(detailsMsg.checkInState==0){detailsMsg.checkInState="未报到"}else{detailsMsg.checkInState="已报到"}if(detailsMsg.paymentState==0){detailsMsg.paymentState="未缴费"}else{detailsMsg.paymentState="已缴费"}if(detailsMsg.isOrderNum==0){detailsMsg.isOrderNum="未开票"}else{detailsMsg.isOrderNum="已开票"}$('.student-details-form .cont-edit-test').setDatas(detailsMsg);console.log("学员头像",detailsMsg.headPortraitUrl);if(detailsMsg.headPortrait!=""){headImg.src=detailsMsg.headPortraitUrl;headImg.onload=function(){$('.student-details-img').attr('src',headImg.src);$('.student-details-img').jqthumb({width:89,height:130})}}else{$('.student-details-img').attr('src','../../resources/images/classStudent/student-picture.png');$('.student-details-img').jqthumb({width:89,height:130})}$.each(detailsMsg.trainList,function(i,b){htmlTrs='<tr><td>'+b.projectCode+'</td><td>'+b.projectName+'</td><td>'+b.startDate+'</td><td>'+b.projectHead+'</td><td>'+b.certificateNo+'</td></tr>';htmlBody.append(htmlTrs)});$yt_baseElement.hideLoading()}}});$(".student-details-form").show();$yt_alert_Model.setFiexBoxHeight($(".student-details-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".student-details-form"));$yt_model_drag.modelDragEvent($(".student-details-form .yt-edit-alert-title"));$('.student-details-form .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){$(".student-details-form").hide()})})},getCompanyList:function(){$yt_baseElement.showLoading();var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({async:true,url:$yt_option.base_path+"finance/settlement/getDetailedList",type:"post",data:{projectCode:projectCode},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.project-company-tbody');var htmlTr='';var htmlPlan='';var should=0;var already=0;var account=0;$(htmlTbody).empty();if(data.data.length>0){$.each(data.data.settlementGroupDetails,function(i,v){htmlTr+='<tr><td>'+v.groupName+'</td><td class="should" style="text-align:right;">'+v.amountReceivable+'</td><td class="already" style="text-align:right;">'+v.netReceipts+'</td><td class="account" style="text-align:right;">'+v.uncollected+'</td><td class="account">'+(projectSelection.confirmFunc(v.reconciliationState))+'</td></tr>';should+=v.amountReceivable;already+=v.netReceipts;account+=v.uncollected});htmlTbody.html(htmlTr);htmlPlan+='<tr><td style="font-weight: bold;">小计</td><td style="text-align:right;font-weight: bold;">'+should+'</td><td style="text-align:right;font-weight: bold;">'+already+'</td><td style="text-align:right;font-weight: bold;">'+account+'</td><td class=""></td></tr>';htmlTbody.append(htmlPlan)}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="5" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getProjectSelectionInf:function(){var selectParam=$(".selectParam").val();debugger;var projectCode=$yt_common.GetQueryString("projectCode");$('.project-student-page').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/settlement/getDetailedPersonalList",type:"post",data:{projectCode:projectCode,selectParam:selectParam,trainingExpenseStart:"",trainingExpenseEnd:"",traineeNegotiatedPriceStart:"",traineeNegotiatedPriceEnd:"",quarterageStart:"",quarterageEnd:"",mealFeeStart:"",mealFeeEnd:"",otherChargesStart:"",otherChargesEnd:"",uncollectedStart:"",uncollectedEnd:""},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.project-student-tbody');var htmlTr='';if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){htmlTr+='<tr><td>'+v.groupNum+'</td><td><a style="color: #4169E1;">'+v.realName+'</a></td><td style="text-align:left">'+v.groupOrgName+'</td><td>'+v.roomNumber+'</td><td style="text-align:right">'+v.trainingExpenseNegotiatedPrice+'</td><td style="text-align:right">'+v.traineeNegotiatedPrice+'</td><td style="text-align:right">'+v.quarterageNegotiatedPrice+'</td><td style="text-align:right">'+v.mealFeeNegotiatedPrice+'</td><td style="text-align:right">'+v.incidental+'</td><td style="text-align:right">'+v.smallPlan+'</td><td style="text-align:right">'+v.cash+'</td><td style="text-align:right">'+v.creditCard+'</td><td style="text-align:right">'+v.wireTransfer+'</td><td style="text-align:right">'+v.moneyTotal+'</td><td class="student-hide"style="text-align:right;display:none">'+v.uncollected+'</td><td class="student-hide" style="display:none">'+projectSelection.confirmFunc(v.reconciliationState)+'</td></tr>'})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td class="project-student-td" colspan="14" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},projectTypeInfo:function(code){if(code==1){return "计划"}else if(code==2){return "委托"}else if(code==3){return "选学"}else if(code==4){return "调训"}else{return ''}},confirmFunc:function(confirm){if(confirm==1){return "已入账"}else if(confirm==0){return "未入账"}}};$(function(){projectSelection.init()});