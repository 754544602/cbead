var billListInfo={init:function(){billListInfo.getBillListInfo();$(".bank-more-div").off('click').on("click",function(){if($(".bank-more-div").text()=="查看更多"){$("#project-main").css("width","2350px");$('.bank-more-div').text("收起");$(".bank-th-hide").show();$(".bank-tbody-td").attr("colspan","18")}else{$("#project-main").css("width","100%");$('.bank-more-div').text("查看更多");$(".bank-th-hide").hide();$(".bank-tbody-td").attr("colspan","7")}});$(".claim-record").click(function(){var pkIds=[];$.each($('.project-tbody tr'),function(i,n){pkIds.push($(n).find('.pkId').val())});pkIds=pkIds.join(',');window.location.href="claimRecord.html?pkId="+pkIds});$(".search-btn").click(function(){billListInfo.getBillListInfo()});$(".admission-manual").click(function(){if($(".yt-table-active").length==0){$yt_alert_Model.prompt("请选择一条信息进行认领");return false}billListInfo.classAlertFunc();});$(".check-all").on("click",function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".person-tbody,.company-tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}})},classAlertFunc:function(){billListInfo.getProjectInfo();$(".check-all").setCheckBoxState("uncheck");$(".class-select").setSelectVal("0");$(".class-select").niceSelect();billListInfo.getNoDetailedList();billListInfo.getDetailedPersonalList("0","");var company=$(".company-table").attr('ishave');var parsion=$(".person-table").attr('ishave');if(company==0&&parsion==0){$(".company-table").show();$(".company-table thead").hide();$(".company-table tbody").show()}var identifications=$(".yt-table-active").find("input.identifications").val();var bankStatementDetailsIds=$(".yt-table-active").find("input.pkId").val();var projectCode="";$("select.class-select").off('change').change(function(){$(".alert-table-div").show();$(".alert-div-input").show();$("#confiscate-amount").hide();$("#user-name").css({float:"left",'margin':"0px 0px 0px 20px"});$("#last-amount").css({float:"left",'margin':"0px 0px 0px 100px"});$("#form-class").css({float:"left",'margin':"0px 0px 0px 70px"});$(".select-teacher-div").width("1100px");$(".yt-edit-alert-main").height("736px");projectCode=$(this).val();billListInfo.getNoDetailedList();billListInfo.getDetailedPersonalList(projectCode,"");$yt_alert_Model.getDivPosition($(".select-teacher-div"));$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));$("select").niceSelect();$(".search-btn").click(function(){var keyword=$("#keyword").val();billListInfo.getDetailedPersonalList(projectCode,keyword)});if($(".identifications-div").text()!=""){var identifications=$(".identifications-div").text();billListInfo.getProjectStatementByProjectCode(projectCode,identifications)}else{var identifications=$(".yt-table-active").find(".identifications").val();billListInfo.getProjectStatementByProjectCode(projectCode,identifications)}var company=$(".company-table").attr('ishave');var parsion=$(".person-table").attr('ishave');if(company==0&&parsion==0){$(".company-table").show();$(".company-table thead").hide();$(".company-table tbody").show()}$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"))});$(".select-teacher-sure-btn").off('click').on("click",function(){var paymentListAdd=[];$(".company-tbody,.person-tbody").find('label input[type="checkbox"]:checked').each(function(){if($(this).hasClass("statement-check")){}else{var paymentType="";var paymentValue=$(this).val();if($(this).parents("tr").find("td").length>6){paymentType=(Number($(this).parents('tr').data('data').traineeType)+1)}else{paymentType="1"}var paymentListAddArr={paymentType:paymentType,paymentValue:paymentValue};paymentListAdd.push(paymentListAddArr)}});var paymentListDelete=[];$(".company-tbody,.person-tbody").find('input.statement-check').not("input:checked").each(function(){var paymentType="";var paymentValue=$(this).val();if($(this).parents("tr").find("td").length>6){paymentType=(Number($(this).parents('tr').data('data').traineeType)+1)}else{paymentType="1"}var paymentListDeleteArr={paymentType:paymentType,paymentValue:paymentValue};paymentListDelete.push(paymentListDeleteArr)});var identifications=$(".yt-table-active").find(".identifications").val();;billListInfo.addNotReconciliations(projectCode,identifications,bankStatementDetailsIds,JSON.stringify(paymentListDelete),JSON.stringify(paymentListAdd),"")});$(".alert-table-div").show();$(".alert-div-input").show();$("#confiscate-amount").hide();$("#user-name").css({float:"left",'margin':"0px 0px 0px 20px"});$("#last-amount").css({float:"left",'margin':"0px 0px 0px 100px"});$("#form-class").css({float:"left",'margin':"0px 0px 0px 70px"});$(".select-teacher-div").width("1100px");$(".yt-edit-alert-main").height("736px");$(".select-teacher-div").show();$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-teacher-div"));$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));$("select").niceSelect();$('.select-teacher-canel-btn').click(function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},addNotReconciliations:function(projectCode,identifications,bankStatementDetailsIds,paymentListDelete,paymentListAdd,uncollectedTotal){$.ajax({url:$yt_option.base_path+"finance/projectStatement/addNotReconciliations",type:"post",data:{isUserClaim:'1',projectCode:projectCode,bankStatementDetailsIds:bankStatementDetailsIds,identifications:identifications,paymentListDelete:paymentListDelete,paymentListAdd:paymentListAdd,uncollectedTotal:uncollectedTotal},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("认领成功");$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();$('.page1').pageInfo("refresh")});$(".identifications-div").text(data.data)}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("认领失败")})}}})},getBillListInfo:function(){var keyword=$('.selectParam').val();$('.page1').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"project/getBankStatementList",type:"post",data:{selectParam:keyword},async:true,before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$(".num").text(data.data.total);var htmlTbody=$('.project-tbody');var htmlTr='';htmlTbody.empty();if(data.data.rows.length>0){$('.page1').show();$.each(data.data.rows,function(i,v){htmlTr+='<tr><td style=""><input type="hidden" value="'+v.pkId+'" class="pkId">'+(i+1)+'</td><td style=""><input type="hidden" class="identifications" value="'+v.identification+'"/>'+v.exchangeHour+'</td><td class="bank-th-hide" style="display:none;tex-align:right;">'+v.draw+'</td><td style="text-align:right;">'+v.income+'</td><td style="text-align:left;">'+v.otherPartyName+'</td><td style="text-align:left;">'+v.remarks+'</td><td style="">'+v.otherPartyAccounts+'</td><td class="bank-th-hide" style="display:none;">'+v.balance+'</td><td class="bank-th-hide" style="display:none;">'+v.currency+'</td><td class="bank-th-hide" style="display:none;">'+v.accountDate+'</td><td class="bank-th-hide" style="display:none;">'+v.abstractData+'</td><td class="bank-th-hide" style="display:none;">'+v.bankTradeNumber+'</td><td class="bank-th-hide enterpriseTradeNumber" style="display:none;">'+v.enterpriseTradeNumber+'</td><td class="bank-th-hide" style="display:none;">'+v.voucherType+'</td><td class="bank-th-hide" style="display:none;">'+v.voucherNo+'</td><td class="bank-th-hide" style="display:none;text-align:left;">'+v.associatedAccount+'</td><td class="bank-th-hide" style="display:none;text-align:left;">'+v.alias+'</td><td style="text-align:left;">'+v.otherPartyGroup+'</td></tr>'})}else{$('.page1').hide();htmlTbody.empty();htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.append(htmlTr);if($('.bank-more-div').text()=='收起'){$('.bank-th-hide').show()}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getNoDetailedList:function(){var projectCode=$('.class-select').val();$.ajax({url:$yt_option.base_path+"finance/settlement/getNoDetailedList",type:"post",data:{projectCode:projectCode},beforeSend:function(){$yt_baseElement.showLoading()},async:false,success:function(data){if(data.flag==0){var htmlTbody=$('.company-tbody');var htmlTr='';var num=1;htmlTbody.empty();if(data.data.length>0){$(".company-table").show();$(".company-table thead").show();$(".company-table").attr('isHave',1);console.log('company-table',$(".company-table").attr('isHave'));var states;var projectStates;$.each(data.data,function(i,v){htmlTr='<tr><td style="text-align: center;"><input type="hidden" class="states"/><label class="check-label yt-checkbox select-checkbox"><input type="checkbox" name="test" class="group-id" value="'+v.groupId+'"/></label></td><td style="text-align:left">'+v.groupName+'</td><td style="text-align:right">'+v.amountReceivable+'</td><td style="text-align:right">'+v.netReceipts+'</td><td style="text-align:right">'+v.uncollected+'</td></tr>';htmlTbody.append(htmlTr)});$(".company-tbody tr").unbind().bind("click",function(){if($(this).find("input[type='checkbox']")[0].checked==true){$(this).find("input[type='checkbox']").setCheckBoxState("uncheck");$(this).removeClass("yt-table-active")}else{$(this).find("input[type='checkbox']").setCheckBoxState("check");$(this).addClass("yt-table-active")}if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}});$(".company-table thead tr label input").off().click(function(){var thisCheck=$(this)[0].checked;console.log('thisCheck',thisCheck);if(thisCheck){$.each($('.company-tbody tr'),function(){$(this).addClass("yt-table-active");$(this).find("input[type='checkbox']").setCheckBoxState("check")})}else{$.each($('.company-tbody tr'),function(){$(this).find("input[type='checkbox']").setCheckBoxState("uncheck");$(this).removeClass("yt-table-active")})}})}else{$(".company-table").hide();$(".company-table").attr('isHave',0);htmlTbody.empty();htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="5" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';$('.person-page').hide();htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},getDetailedPersonalList:function(projectCode,keyword){$.ajax({url:$yt_option.base_path+"finance/settlement/getDetailedPersonalList",type:"post",data:{pageNum:1000000000,pageSize:10,projectCode:projectCode,selectParam:keyword,trainingExpenseStart:"",trainingExpenseEnd:"",traineeNegotiatedPriceStart:"",traineeNegotiatedPriceEnd:"",quarterageStart:"",quarterageEnd:"",mealFeeStart:"",mealFeeEnd:"",otherChargesStart:"",otherChargesEnd:"",uncollectedStart:"",uncollectedEnd:""},objName:'data',beforeSend:function(){$yt_baseElement.showLoading()},async:false,success:function(data){if(data.flag==0){var htmlTbody=$('.person-tbody');var htmlTr='';htmlTbody.empty();if(data.data.rows.length>0){$(".person-table").show();$(".person-table").attr('isHave',1);$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}htmlTr='<tr><td style="text-align: center;"><label class="check-label yt-checkbox personal-checkbox"><input type="checkbox" value="'+v.traineeId+'"/></label></td><td>'+v.groupNum+'</td><td>'+v.realName+'</td><td>'+v.gender+'</td><td style="text-align:left">'+v.groupName+'</td><td style="text-align:left">'+v.groupOrgName+'</td><td style="text-align:right">'+v.smallPlan+'</td><td style="text-align:right">'+v.moneyTotal+'</td><td style="text-align:right">'+v.uncollected+'</td></tr>';htmlTr=$(htmlTr).data('data',v);htmlTbody.append(htmlTr)});$(".person-table tbody tr").unbind().bind("click",function(){if($(this).find("input[type='checkbox']")[0].checked==true){$(this).find("input[type='checkbox']").setCheckBoxState("uncheck");$(this).removeClass("yt-table-active")}else{$(this).find("input[type='checkbox']").setCheckBoxState("check");$(this).addClass("yt-table-active")}if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}});$(".person-table thead tr label input").off().click(function(){var thisCheck=$(this)[0].checked;console.log('thisCheck',thisCheck);if(thisCheck){$.each($('.person-tbody tr'),function(){$(this).addClass("yt-table-active");$(this).find("input[type='checkbox']").setCheckBoxState("check")})}else{$.each($('.person-tbody tr'),function(){$(this).find("input[type='checkbox']").setCheckBoxState("uncheck");$(this).removeClass("yt-table-active")})}})}else{$(".person-table").hide();$(".person-table").attr('isHave',0);htmlTbody.html("");htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},getAlertListInfoPlan:function(){var projectCode=$(".class-select").val();var keyword=$('#keyword').val();$('.page-info').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/settlement/getNoDetailedPersonalList",type:"post",data:{projectCode:projectCode,selectParam:keyword},async:true,before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.person-tbody');var htmlTr='';htmlTbody.empty();if(data.data.rows.length>0){var states;var projectStates;$.each(data.data.rows,function(i,v){htmlTr+='<tr><td style="text-align: center;"><input type="hidden" class="states"/><label class="check-label yt-checkbox select-teacher-checkbox">	<input type="checkbox" name="test" class="select-trainee-pkId" value="'+v.traineeId+'"/></label></td><td style="text-align:left">'+v.realName+'</td><td style="text-align:right">'+v.gender+'</td><td style="text-align:right">'+v.groupName+'</td><td style="text-align:right">'+v.groupOrgName+'</td><td style="text-align:right">'+v.trainingExpenseNegotiatedPrice+'</td><td style="text-align:right">'+v.otherCost+'</td><td style="text-align:right">'+v.netReceipts+'</td><td style="text-align:right">0.00</td></tr>'})}else{htmlTbody.empty();htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.append(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},projectTypeInfo:function(code){if(code==1){return "计划"}else if(code==2){return "委托"}else if(code==3){return "选学"}else if(code==4){return "中组部调训"}else if(code==5){return "国资委调训"}else{return ''}},getProjectInfo:function(){var selectParam="";$.ajax({async:true,url:$yt_option.base_path+"finance/projectStatement/getProjects",type:"post",data:{selectParam:selectParam},objName:'data',beforeSend:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){if(data.data&&data.data&&data.data.length>0){$("select.class-select").empty();$.each(data.data,function(i,v){$("select.class-select").append($('<option value="'+v.projectCode+'">'+v.projectName+'</option>').data("classData",v))});$('select.class-select').niceSelect()}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败");$yt_baseElement.hideLoading()})}},})},getProjectStatementByProjectCode:function(projectCode,identifications){$.ajax({url:$yt_option.base_path+"finance/projectStatement/getProjectStatementByProjectCode",type:"post",data:{projectCode:projectCode,identifications:identifications},objName:'data',beforeSend:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$.each(data.data,function(i,v){$(".company-tbody,.person-tbody").find('input[type="checkbox"]').each(function(j,n){if($(this).parents("tr").find("td").length<6){if($(this).val()==v.paymentValue&&v.paymentType=="1"){$(this).setCheckBoxState("check");$(this).parents('tr').addClass('yt-table-active');$(this).addClass("statement-check")}}else{if($(this).val()==v.paymentValue&&v.paymentType==(Number($(this).parents('tr').data('data').traineeType)+1)){$(this).setCheckBoxState("check");$(this).parents('tr').addClass('yt-table-active');$(this).addClass("statement-check")}}})})}else{$yt_alert_Model.alertOne("查询失败")}$yt_baseElement.hideLoading()}})},};$(function(){billListInfo.init()});