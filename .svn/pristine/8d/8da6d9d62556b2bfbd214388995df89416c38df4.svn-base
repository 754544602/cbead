var budgetTableStyle={booksId:'',booksYear:'',booksObj:"",init:function(){var requerParameter=$yt_common.GetRequest();budgetTableStyle.booksId=requerParameter.booksId;if(budgetTableStyle.booksId&&budgetTableStyle.booksId!=undefined&&budgetTableStyle.booksId!=""){budgetTableStyle.getBudgetYearInfoById(budgetTableStyle.booksId)}budgetTableStyle.events();$("#budgetTableStyle").css("min-height",$(window).height()-15)},events:function(){$("#addRiskBtn,#newTabLab").click(function(){window.location.href=$yt_option.websit_path+'view/system-sasac/budget/module/expenditure/addTable.html?booksId='+budgetTableStyle.booksId});$("#tableList tbody").on("click","tr",function(){var thisObj=$(this);var trState=thisObj.find(".tr-state").text();if(trState=="启用"){$("#blockUpBtn").text("停用")}else{$("#blockUpBtn").text("启用")}});$("#blockUpBtn").click(function(){var selTrLen=$("#tableList tbody tr.yt-table-active").length;var thisTr=$("#tableList tbody tr.yt-table-active");var tableObjData=$(thisTr).data("tableObj");var thisBtn=$(this);var tableId=thisTr.find("input.tableId").val();if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作");return false}else if(tableObjData.scheduleState=="3"){$yt_alert_Model.prompt("该表格已发布");return false}else{var interfaceUrl="";if(thisBtn.text()=="启用"){interfaceUrl="budget/table/setBudgetTableStateToEnable"}else{interfaceUrl="budget/table/setBudgetTableStateToDisable"}$.ajax({type:"post",url:interfaceUrl,async:false,data:{tableId:tableId},success:function(data){$yt_alert_Model.prompt(data.message,2000);if(data.flag==0){budgetTableStyle.getBudgetList()}}})}});$(".import-btn,#importTabLab").click(function(){var importModeInitObj=$(".import-Model-init");sysCommon.showModel(importModeInitObj);importModeInitObj.find(".next-btn").click(function(){sysCommon.closeModel(importModeInitObj);budgetTableStyle.showImportTableModel();importModeInitObj.find("label.yt-radio").removeClass("check").find("input").prop("checked",false);importModeInitObj.find("label.yt-radio:eq(0) input").setRadioState("check")});importModeInitObj.find(".canel-btn").click(function(){sysCommon.closeModel(importModeInitObj);importModeInitObj.find("label.yt-radio").removeClass("check").find("input").prop("checked",false);importModeInitObj.find("label.yt-radio:eq(0) input").setRadioState("check")})});$(".fun-btn-group button.adjust").on("click",function(){var selTrLen=$("#tableList tbody tr.yt-table-active").length;var thisTr=$("#tableList tbody tr.yt-table-active");var tableObjData=$(thisTr).data("tableObj");var thisBtn=$(this);var pageUrl="";var tableId=thisTr.find("input.tableId").val();var trState=$("#tableList tbody tr.yt-table-active").find(".tr-state").text();if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作");return false}else if(trState=="停用"){$yt_alert_Model.prompt("该表格已被停用");return false}else{var btnFlag=$(this).attr("btnFlag");if(btnFlag=="0"){if(tableObjData.scheduleState=="3"){$yt_alert_Model.prompt("该表格已发布");return false}else{pageUrl='view/system-sasac/budget/module/expenditure/addTable.html?tableId='+tableId+'&booksId='+budgetTableStyle.booksId}}else if(btnFlag=="1"){pageUrl='view/system-sasac/budget/module/expenditure/configDefinition.html?tableId='+tableId}window.location.href=$yt_option.websit_path+pageUrl}});$("#releaseBtn").click(function(){window.location.href=$yt_option.websit_path+'view/system-sasac/budget/module/expenditure/publishBudgetTabList.html?booksId='+budgetTableStyle.booksId});$(".del-btn").click(function(){var selTrLen=$("#tableList tbody tr.yt-table-active").length;var thisTr=$("#tableList tbody tr.yt-table-active");if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作");return false}else if(thisTr.data("tableObj").scheduleState=="3"){$yt_alert_Model.prompt("该表格已发布");return false}else{$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){var tableId=thisTr.data("tableObj").tableId;$.ajax({type:"post",url:"budget/tm/deleteTableByTableId",async:false,data:{tableId:tableId},success:function(data){$yt_alert_Model.prompt(data.message,2000);if(data.flag==0){budgetTableStyle.getBudgetList()}}})}})}});$("#retuLab").click(function(){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system-sasac/budget/module/expenditure/budgetTableManager.html'}})})},getBudgetYearInfoById:function(booksId){$.ajax({type:'post',url:'budget/bm/getBooksInfo',data:{booksId:booksId},success:function(data){if(data.flag==0){if(data.data){budgetTableStyle.booksObj=data.data;$(".dept-year").text(data.data.booksYear)}}}})},showImportTableModel:function(){var importModelObj=$(".import-table-model");sysCommon.showModel(importModelObj);$(".parent-check").change(function(){if($(this).hasClass("check")){$("table.budget-table tbody").setCheckBoxState("unCheckAll")}else{$("table.budget-table tbody").setCheckBoxState("checkAll")}});var tableCheckLen=$("table.budget-table tbody label.yt-checkbox").length;$("table.budget-table tbody label.yt-checkbox").off().on("change",function(){if($(this).hasClass("check")){$("input.check-all").prop("checked",false).setCheckBoxState("uncheck")}else{$(this).find("input").setCheckBoxState("check");if($("table.budget-table tbody label.yt-checkbox.check").length==tableCheckLen){$("input.check-all").prop("checked",true).setCheckBoxState("check")}}});importModelObj.find(".sure-btn").click(function(){sysCommon.closeModel(importModelObj);importModelObj.find("label.yt-radio,label.yt-checkbox").removeClass("check").find("input").prop("checked",false)});importModelObj.find(".canel-btn").click(function(){sysCommon.closeModel(importModelObj);importModelObj.find("label.yt-radio,label.yt-checkbox").removeClass("check").find("input").prop("checked",false)});importModelObj.find(".retn-btn").click(function(){sysCommon.closeModel(importModelObj);sysCommon.showModel($(".import-Model-init"));importModelObj.find("label.yt-radio,label.yt-checkbox").removeClass("check").find("input").prop("checked",false)})},getBudgetList:function(){$('.budget-table-page').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:"budget/tm/getPageTableList",type:"post",data:{booksId:budgetTableStyle.booksId},objName:'data',success:function(data){var htmlTbody=$('#tableList .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data.rows;if(datas.length>0){$(".budget-table-page").show();var trDoc='';var sty1,sty2,sty2,sty3,line1,line2="";$.each(datas,function(i,n){sty1=sty2=sty3=line1=line2="";trDoc='<tr><td><input class="tableId" value="'+n.tableId+'" type="hidden">'+n.tableCode+'</td><td>'+n.budgetTypeName+'</td><td style="text-align: left;" class="text-overflow-sty"  title="'+n.tableName+'">'+n.tableName+'</td><td class="plan-td">';if(n.scheduleState==1){sty1="state-sty"}else if(n.scheduleState==2){sty1=sty2=line1="state-sty"}else if(n.scheduleState==3){sty1=sty2=sty3=line1=line2="state-sty"}trDoc+='<div class="state-plan style-plan"><div class="circle-div '+sty1+'"><div class="state-line '+line1+'"></div></div></div><div class="state-plan config-plan"><div class="circle-div '+sty2+'"><div class="state-line '+line2+'"></div></div></div><div class="state-plan release-plan"style="margin-right:0px;"><div class="circle-div '+sty3+'"></div></div>';trDoc+='<div style="clear: both;"></div><div class="state-text-model"><label>样式配置</label><label style="margin-left: 20px;">属性配置</label><label style="margin-left: 28px;">已发布</label></div>';trDoc+='</td><td>'+(n.state==1?'<span class="tr-state" style="color:#4aae62">启用</span>':'<span class="tr-state" style="color:#ff0000">停用</span>')+'</td><td>'+n.lastOperatorDateTime+'</td><td>'+n.lastOperatorUserName+'</td></tr>';trDoc=$(trDoc);trDoc.data("tableObj",n);$("#tableList tbody").append(trDoc)})}else{htmlTbody.append(budgetTableStyle.noDataTrStr(7));$(".budget-table-page").hide();budgetTableStyle.events()}}},isSelPageNum:true })},noDataTrStr:function(trNum){var noDataStr='<tr style="border:0px;background-color:#fff !important;"><td  colspan="'+trNum+'" align="center"style="border:0px;"><div class="no-data" style="font-size: 18px;margin: 0 auto;"><label>暂无预算表，请选择<a class="yt-link" id="newTabLab">创建新预算表</a>或<a class="yt-link" id="importTabLab">导入预算表</a>。</label></div></td></tr>';return noDataStr}};$(function(){budgetTableStyle.init();budgetTableStyle.getBudgetList()});