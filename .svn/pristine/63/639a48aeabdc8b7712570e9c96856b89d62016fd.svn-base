var probudget={beforeCostList:[],specialName:"",prjName:"",init:function(){probudget.even();probudget.priorApprovalEvent();probudget.approvalTotal();probudget.adjustmentTotal();probudget.adjustmentAfterTotal();sysCommon.getLoginUserInfo();sysCommon.getApproveFlowData("SZ_ADVANCE_APP")},even:function(){$(".aft-money").on("focus",function(){if($(this).val()!=""){$(this).val($yt_baseElement.rmoney($(this).val()))}});$(".aft-money").on("blur",function(){if($(this).val()!=""){$(this).val($yt_baseElement.fmMoney($(this).val()))}probudget.adjustmentTotal()})},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},getPriorApprovalList:function(){var tbody=$('.prior-approval-list tbody');var queryParams=$('.prior-approval-val').val();var pageDiv=$('.prior-page');$('.prior-page').pageInfo({pageIndex:1,pageNum:5,pageSize:3,url:"sz/advanceApp/getAdvanceAppListToPageByParams",objName:'data',data:{queryParams:queryParams},success:function(data){tbody.empty();if(data.flag==0){var trStr="";if(data.data.rows.length>0){pageDiv.show();$.each(data.data.rows,function(i,n){trStr+='<tr specialName="'+n.specialName+'" advanceAppName="'+n.advanceAppName+'" pid="'+n.advanceAppId+'" code="'+n.advanceAppNum+'"><td>'+n.advanceAppNum+'<input type="hidden" class="balance" value="'+n.advanceAppBalance+'" /></td><td>'+n.applicantUserName+'</td><td>'+n.applicantUserDeptName+'</td><td>'+n.advanceAppName+'</td><td>'+n.advanceCostTypeName+'</td><td>'+n.applicantTime+'</td>'+'</tr>'});tbody.append(trStr)}else{pageDiv.hide();var noTr='<tr class="model-no-data-tr"><td colspan="7"><div class="no-data"><img src="../../../../../resources-sasac/images/common/no-data.png" alt=""></div></td></tr>';tbody.append(noTr)}}}})},getAdvanceAppInfoDetailByAdvanceAppId:function(id,upDate){$.ajax({type:"post",url:"sz/advanceApp/getAdvanceAppInfoDetailByAdvanceAppId",async:true,data:{advanceAppId:id},success:function(data){if(data.flag==0){probudget.beforeCostList=data.data;probudget.specialName=probudget.beforeCostList.specialName;probudget.prjName=probudget.beforeCostList.prjName}}})},priorApprovalEvent:function(){var me=this;$('.prior-approval').click(function(){me.getPriorApprovalList();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('.prior-alert'));$('#pop-modle-alert').show();$('.prior-alert').show()});$('.prior-common').click(function(){var tr=$('.prior-approval-list .yt-table-active');var code=tr.attr('code');var name=tr.find('.sname').text();var id=tr.attr('pid');var balance=tr.find('.balance').val();var advanceAppName=tr.attr('advanceAppName');if(code){me.getAdvanceAppInfoDetailByAdvanceAppId(id);$('.prior-approval').val(code);$('#advanceAppName').css("color","#333").text(advanceAppName);if(probudget.prjName){$('#specialName').css("color","#333").text(probudget.prjName)}else{$('#specialName').css("color","#333").text('--')}if(probudget.specialName){$('.budget-item-one').css("color","#333").text(probudget.specialName)}else{$('.budget-item-one').css("color","#333").text('--')}$('#advanceAppBalance').css("color","#333").text(balance?probudget.fmMoney(balance)+'元':'--');$('#advanceAppId').val(id);$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()}else{$yt_alert_Model.prompt('请选择一条数据')}$("#costList").show();$(".cost-hide").hide()});$('.prior-cancel').click(function(){$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide();$('.prior-approval-val').val('');me.getPriorApprovalList()});$('.prior-approval-search').click(function(){me.getPriorApprovalList()});$('.prior-approval-reset').click(function(){$('.prior-approval-val').val('');me.getPriorApprovalList()})},approvalTotal:function(){var tds=$('#costList tbody .app-money');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('#costList tbody .approved-money').text(fmTotal))},adjustmentTotal:function(){var tds=$('#costList tbody .aft-money');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).val()||'0')});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('#costList tbody .after-money').text(fmTotal))},adjustmentAfterTotal:function(){var tds=$('#costList tbody .adj-money');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$yt_baseElement.fmMoney($('#costList tbody .adjustment-money').text(fmTotal))}};$(function(){$("select").niceSelect();probudget.init()});