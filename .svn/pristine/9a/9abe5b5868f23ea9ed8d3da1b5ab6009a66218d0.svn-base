var caList={ue:null,init:function(){caList.ue=UE.getEditor('container',{toolbars:[['undo','redo','|','bold','italic','underline','forecolor','|','justifyleft','justifycenter','justifyright','justifyjustify','|','simpleupload','attachment']],autoHeightEnabled:true,elementPathEnabled:false,enableAutoSave:false,saveInterval:0});caList.clearAlertBox();$('select').niceSelect();$("#issueDayeString").calendar({speed:200,complement:true,readonly:true,lowerLimit:"2010/01/01",nowData:true,dateFmt:"yyyy-MM-dd HH:mm",callback:function(){}});var classList=caList.getClassLis();var userRealName=caList.userInfo();if(classList!=null){var projectUser;var projectHeadmasterName;$.each(classList.data,function(i,n){projectUser=n.projectUserName;projectHeadmasterName=n.projectHeadmasterName;if(projectUser.indexOf(userRealName)!=-1||projectHeadmasterName.indexOf(userRealName)!=-1){$("#projectCode").append($('<option value="'+n.projectCode+'">'+n.className+'</option>').data("classData",n))}})};$("#projectCode").niceSelect();$('#projectCode').on('change',function(){var className=$('#projectCode option:selected').val();if(className!="请选择班级"){var projectUserName=$('#projectCode option:selected').data("classData").projectUserName;$('#projectUserName').text(projectUserName)}});var nextPersonList=caList.getNextOperatePerson();if(nextPersonList!=null){$.each(nextPersonList,function(i,n){$("#dealingWithPeople").append($('<option value="'+n.userCode+'">'+n.userName+'</option>').data("classData",n))})};$("#dealingWithPeople").niceSelect();$('.page-return-btn').off().on("click",function(){caList.backNewsListPage()});$('#cancel').off().on("click",function(){caList.backNewsListPage()});$('#save').off('click').on('click',function(){caList.isNoNull(1)});$('#submit').off('click').on('click',function(){caList.isNoNull(2)})},backNewsListPage:function(){var pageNum=$yt_common.GetQueryString("pageNum");if(pageNum==2){window.location.href="lookForByBacklogList.html"}else{window.location.href="newList.html"}},getClassLis:function(){var className=$("#projectCode").val();className="";var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/getClasslist",data:{searchParameters:className,types:"2"},async:false,success:function(data){list=data||[]}});return list},isNoNull:function(dataStates){var title=$('#title').val();var details=caList.ue.getContent();var issueDayeString=$('#issueDayeString').val();$yt_valid.validForm($("#valid-tab"));if(title==""||details==""||issueDayeString==""){$yt_valid.validForm($(".valid-tab"))}else{caList.addnewsInfo(dataStates)}},isNoNull:function(dataStates){var title=$('#title').val();var details=caList.ue.getContent();$yt_valid.validForm($("#valid-tab"));if(title==""||details==""){$yt_valid.validForm($(".valid-tab"))}else{caList.addnewsInfo(dataStates)}},getNextOperatePerson:function(){var list=[];var dataObj;var user=null;$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"news",processInstanceId:""},async:false,success:function(data){if(data.flag==0){$.each(data.data,function(i,n){for(var k in n){user=n[k]}})}}});return user},userInfo:function(){var userRealName="";$.ajax({async:false,type:"post",url:$yt_option.base_path+"uniform/user/getUsersDetails",data:{},success:function(data){userRealName=data.data.userRealName}});return userRealName},clearAlertBox:function(){$('#projectCode').val("");$('#projectUserName').val("");$('#title').val("");$('#issueDayeString').val("");$('#dealingWithPeople').val("");$('select').niceSelect()},addnewsInfo:function(dataStates){$yt_baseElement.showLoading();var pkId=$yt_common.GetQueryString("pkId");var projectCode=$('#projectCode').val();var title=$('#title').val();var details=caList.ue.getContent();var issueDayeString=$('#issueDayeString').val();var dealingWithPeople=$('#dealingWithPeople').val();$.ajax({type:"post",url:$yt_option.base_path+"class/news/addOrUpdateBean",data:{pkId:pkId,projectCode:projectCode,title:title,details:details,issueDayeString:issueDayeString,businessCode:"news",dealingWithPeople:dealingWithPeople,dataStates:dataStates,nextCode:"submited"},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("添加成功");$(".yt-edit-alert,#heard-nav-bak").hide()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交失败")})}caList.backNewsListPage()}})}};$(function(){caList.init()});