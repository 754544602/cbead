var claimRecord = {

	//初始化方法
	init: function() {
		claimRecord.getBillListInfo("2");
		//模糊查询
		$(".search-btn").click(function() {
			claimRecord.getBillListInfo("2");
		})
		//单击checkbox查询
		$(".check-box-load").on("change", function() {
			if($('.check-sure input[type="checkbox"]').is(':checked')) {
				if($('.check-cancel input[type="checkbox"]').is(':checked')) {
					claimRecord.getBillListInfo("2");
				} else {
					claimRecord.getBillListInfo("1");
				}
			} else {
				if($('.check-cancel input[type="checkbox"]').is(':checked')) {
					claimRecord.getBillListInfo("0");
				} else {
					$yt_baseElement.showLoading();
					htmlTr = '<tr style="border:0px;background-color:#fff !important;" >' +
						'<td colspan="18" align="center" style="border:0px;">' +
						'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
						'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
						'</div>' +
						'</td>' +
						'</tr>';
					$(".bank-table-left .project-tbody").html(htmlTr);
					$(".bank-table-right .project-tbody").html(htmlTr);
					$yt_baseElement.hideLoading();
				}
			}
		})
		//流水单查看更多
		$(".bank-more-div").on("click", function() {
			$yt_baseElement.showLoading();
			if($(".bank-more-div").text() == "查看更多") {
				if($(".payment-list").hasClass("hide")) {

				}
				var width = parseInt($("#project-main").css("width"));
				var leftWidth = parseInt($(".bank-table-left").css('width'));
				$("#project-main").css("width", width + 1260 + "px");
				$(".bank-table-left").css("width", leftWidth + 1260 + 'px');
				$(".bank-th-hide").show();
				$(".bank-more-div").text("收起");
				var colspan = $(".bank-tbody-td").attr("colspan");
				$(".bank-tbody-td").attr("colspan", colspan + 11);
			} else {
				var width = parseInt($("#project-main").css("width"));
				var leftWidth = parseInt($(".bank-table-left").css('width'));
				$("#project-main").css("width", width - 1260 + "px");
				$(".bank-table-left").css("width", leftWidth - 1260 + 'px');
				$(".bank-th-hide").hide();
				$(".bank-more-div").text("查看更多");
				var colspan = $(".bank-tbody-td").attr("colspan");
				$(".bank-tbody-td").attr("colspan", colspan - 11);
			}
			$yt_baseElement.hideLoading();
		});
		//项目详情查看更多按钮
		$(".project-more-div").on("click", function() {
			$yt_baseElement.showLoading();
			if($(".project-more-div").text() == "查看更多") {
				var width = parseInt($("#project-main").css("width"));
				var rightWidth = parseInt($(".bank-table-right").css('width'));
				$("#project-main").css("width", width + 360 + "px");
				$(".bank-table-right").css("width", rightWidth + 360 + 'px');
				$(".project-th-hide").show();
				$(".project-more-div").text("收起");
				var colspan = $(".bank-tbody-td").attr("colspan");
				$(".bank-tbody-td").attr("colspan", colspan + 3);
			} else {
				var width = parseInt($("#project-main").css("width"));
				var rightWidth = parseInt($(".bank-table-right").css('width'));
				$(".bank-table-right").css("width", rightWidth - 360 + 'px');
				$("#project-main").css("width", width - 360 + "px");
				$(".project-th-hide").hide();
				$(".project-more-div").text("查看更多");
				var colspan = $(".bank-tbody-td").attr("colspan");
				$(".bank-tbody-td").attr("colspan", colspan - 3);
			}
			$yt_baseElement.hideLoading();
		});
		//确认和未确认复选框
		//复选框
		//全选  
		$(".check-all").change(function() {
			//判断自己是否被选中  
			if($(this).parent().hasClass("check")) {
				//设置反选  
				$(this).parents(".bank-table-left").find("tbody input[type='checkbox']").setCheckBoxState("uncheck");
			} else {
				//调用设置选中方法,全选  
				$(this).parents(".bank-table-left").find("tbody input[type='checkbox']").setCheckBoxState("check");
			}
		});
		//修改全选按钮状态
		$(".project-tbody,.person-tbody,.company-tbody").on("change", "input[type='checkbox']", function() {
			if($(this).parents("table").find("tbody input[type='checkbox']").length != $(this).parents("table").find("tbody input[type='checkbox']:checked").length) {
				$(this).parents("table").find(".check-all").setCheckBoxState("uncheck");
			} else {
				$(this).parents("table").find(".check-all").setCheckBoxState("check");
			}
		});
	},
	/**
	 * 对账单信息列表
	 */
	getBillListInfo: function(isAdmission) {
		var me = this;
		//		$yt_baseElement.showLoading();
		var pkId = $yt_common.GetQueryString("pkId");
		$yt_baseElement.showLoading();
		$('.page-info').pageInfo({
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "finance/bankStatement/getBankStatementDetailsList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				pkId: pkId,
				//				selectParam: keyword,
				isAdmission: isAdmission,
				isClaimUser: "1",
				isUserProject: "2"
			}, //ajax查询访问参数
			success: function(data) {
				if(data.flag == 0) {
					var htmlLeftBody = $('.bank-table-left');
					var htmlRightBody = $('.bank-table-right');
					var htmlLeftTr = '';
					var htmlRightTr = '';
					var repetitionArr = [];
					var ordernum = 0;
					htmlLeftBody.find('tbody').empty();
					htmlRightBody.find('tbody').empty();
					if(data.data != null) {
						if(data.data.rows.length > 0) {
							$.each(data.data.rows, function(i, n) {
								var bool = true;
								//之前出现的判断不让其出现
								for(let j = 0; j < repetitionArr.length; j++) {
									if(i == repetitionArr[j]) {
										bool = false;
									}
								}
								if(bool == false) {
									return true
								}
								ordernum += 1;
								var leftnum = 0;
								var rightnum = 0;
								var rightbool = true;
								htmlLeftBody.append('<table class="leftTable leftTable' + i + '" width="100%"><tbody class="yt-body project-tbody"></tbody></table>')
								htmlRightBody.append('<table class="rightTable rightTable' + i + '" width="100%"><tbody class="yt-body project-tbody"></tbody></table>');
								$.each(data.data.paymentList, function(k, v) {
									if(v.identification == n.identification) {
										rightbool = false;
										rightnum += 1;
										if(rightnum == 1) {
											htmlRightTr = '<tr class="' + i + '">' +
												//项目销售
												'<td width="190px" class="project-th-hide payment-list merge-last" style="display: none;text-align:center">' + '<input class="identification-last" style="display:none;" value="' + v.identification + '">' + v.projectSell + '</td>' +
												//认领时间
												'<td width="90px" class="project-th-hide payment-list merge-last" style="display: none;text-align:center">' + v.claimDate + '</td>' +
												//项目名称
												'<td width="137px" class="payment-list merge-last" style="text-align:center">' + v.projectName + '</td>' +
												//项目周期
												'<td width="200px" class="payment-list merge-last" style="text-align:center">' + v.projectDate + '</td>' +
												//学员姓名
												'<td width="200px" class="payment-list merge-last" style="text-align:center">' + v.traineeOrGroupName + '</td>' +
												//单位
												'<td width="66px" class="project-th-hide payment-list merge-last" style="display: none;text-align:center">' + v.orgName + '</td>' +
												//未收金额
												'<td width="68px" class="payment-list merge-last" style="text-align:right;">' + v.uncollectedTotal + '</td>' +
												//对账金额
												'<td width="67px" class="payment-list merge-last rightTd' + i + '" style="text-align:right;">' + v.reconciliationsTotal + '</td>' +
												//入账金额
												'<td width="70px" class="payment-list merge-last rightTd' + i + '" style="text-align:right;">' + v.admissiontotal + '</td>' +
												//差额
												'<td width="90px" class="payment-list merge-last rightTd' + i + '" style="text-align:right;">' + v.differencetotal + '</td>' +
												//入账确认
												'<td width="60px" class="payment-list merge-last rightTd' + i + '" style="text-align:center;">' + (me.confirmFunc(v.reconciliationState)) + '</td>' +
												//入账人
												'<td width="100px" class="payment-list merge-last rightTd' + i + '" style="text-align:center;">' + v.admissionConfirmUser + '</td>' +
												'</tr>';
											$('.rightTable' + i).find('tbody').append(htmlRightTr);
										} else {
											htmlRightTr = '<tr class="' + i + '">' +
												//项目销售
												'<td width="190px" class="project-th-hide payment-list merge-last" style="display: none;text-align:center;">' + '<input class="identification-last" style="display:none;" value="' + v.identification + '">' + v.projectSell + '</td>' +
												//认领时间
												'<td width="90px" class="project-th-hide payment-list merge-last" style="display: none;text-align:center;">' + v.claimDate + '</td>' +
												//项目名称
												'<td width="137px" class="payment-list merge-last" style="text-align:center;">' + v.projectName + '</td>' +
												//项目周期
												'<td width="200px" class="payment-list merge-last" style="text-align:center;">' + v.projectDate + '</td>' +
												//学员姓名
												'<td width="200px" class="payment-list merge-last" style="text-align:center;">' + v.traineeOrGroupName + '</td>' +
												//单位
												'<td width="66px" class="project-th-hide payment-list merge-last" style="display: none;text-align:center;">' + v.orgName + '</td>' +
												//未收金额
												'<td width="68px" class="payment-list merge-last" style="text-align:right;">' + v.uncollectedTotal + '</td>' +
												'</tr>';
											$('.rightTable' + i).find('tbody').append(htmlRightTr);
										}
									}
								});
								//左
								$.each(data.data.rows, function(x, y) {
									if(n.identification == y.identification) {
										repetitionArr.push(x);
										leftnum += 1;
										if(leftnum == 1) {
											htmlLeftTr = '<tr class="' + i + '">' +
												'<td width="30px" style="text-align: center;" class="merge leftTd' + i + '">' +
												'<label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test" class="pkId" value="' + y.pkId + '"/></label>' + '</td>' +
												'<td width="31px" class="merge leftTd' + i + '" style = "text-align:center">' + '<input class="identification-last" style="display:none;" value="' + y.identification + '">' + ordernum + '</td>' +
												//交易时间
												'<td width="80px" class="merge" style = "text-align:center">' + y.exchangeHour + '</td>' +
												//借方发生额
												'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">' + y.draw + '</td>' +
												//贷方发生额
												'<td width="98px" class="merge" style="text-align:right">' + y.income + '</td>' +
												//余额
												'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">' + y.balance + '</td>' +
												//币种
												'<td width="60px" class="bank-th-hide merge" style="display:none;text-align:center">' + y.currency + '</td>' +
												//对方户名
												'<td width="131px" class="otherPartyName merge">' + y.otherPartyName + '</td>' +
												//对方账户
												'<td width="131px" class="bank-th-hide merge" style="display:none">' + '<input class="identification" style="display:none;" value="' + y.identification + '">' + y.otherPartyAccounts + '</td>' +
												//对方开户机构
												'<td width="131px" class="bank-th-hide merge" style="display:none">' + y.otherPartyGroup + '</td>' +
												//记账日期
												'<td width="80px" class="bank-th-hide merge" style="display:none;text-align:center">' + y.accountDate + '</td>' +
												//摘要
												'<td width="116px" class="bank-th-hide merge" style="display:none">' + y.abstractData + '</td>' +
												//备注
												'<td width="116px" class="merge">' + y.remarks + '</td>' +
												//账户明细编号-交易流水号
												'<td width="131px" class="merge">' + y.enterpriseTradeNumber + '</td>' +
												//企业流水号
												'<td width="116px" class="bank-th-hide merge" style="display:none">' + y.voucherType + '</td>' +
												//凭证种类
												'<td width="77px" class="bank-th-hide merge" style="display:none;text-align:center">' + y.voucherNo + '</td>' +
												//凭证号
												'<td width="131px" class="bank-th-hide merge" style="display:none;text-align:center">' + y.associatedAccount + '</td>' +
												//关联账户
												'<td width="131px" class="bank-th-hide merge" style="display:none">' + y.alias + '</td>' +
												//别名
												'<td width="60px" class="bank-th-hide merge" style="display:none">' + y.bankTradeNumber + '</td>' +
												'</tr>';
											$('.leftTable' + i).find('tbody').append(htmlLeftTr);
										} else {
											htmlLeftTr = '<tr class="' + i + '">' +
												//交易时间
												'<td width="80px" class="merge" style = "text-align:center">' + y.exchangeHour + '</td>' +
												//借方发生额
												'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">' + y.draw + '</td>' +
												//贷方发生额
												'<td width="98px" class="merge" style="text-align:right">' + y.income + '</td>' +
												//余额
												'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">' + y.balance + '</td>' +
												//币种
												'<td width="60px" class="bank-th-hide merge" style="display:none;text-align:center">' + y.currency + '</td>' +
												//对方户名
												'<td width="131px" class="otherPartyName merge">' + y.otherPartyName + '</td>' +
												//对方账户
												'<td width="131px" class="bank-th-hide merge" style="display:none">' + '<input class="identification" style="display:none;" value="' + y.identification + '">' + y.otherPartyAccounts + '</td>' +
												//对方开户机构
												'<td width="131px" class="bank-th-hide merge" style="display:none">' + y.otherPartyGroup + '</td>' +
												//记账日期
												'<td width="80px" class="bank-th-hide merge" style="display:none;text-align:center">' + y.accountDate + '</td>' +
												//摘要
												'<td width="116px" class="bank-th-hide merge" style="display:none">' + y.abstractData + '</td>' +
												//备注
												'<td width="116px" class="merge">' + y.remarks + '</td>' +
												//账户明细编号-交易流水号
												'<td width="131px" class="merge">' + y.enterpriseTradeNumber + '</td>' +
												//企业流水号
												'<td width="116px" class="bank-th-hide merge" style="display:none">' + y.voucherType + '</td>' +
												//凭证种类
												'<td width="77px" class="bank-th-hide merge" style="display:none;text-align:center">' + y.voucherNo + '</td>' +
												//凭证号
												'<td width="131px" class="bank-th-hide merge" style="display:none;text-align:center">' + y.associatedAccount + '</td>' +
												//关联账户
												'<td width="131px" class="bank-th-hide merge" style="display:none">' + y.alias + '</td>' +
												//别名
												'<td width="60px" class="bank-th-hide merge" style="display:none">' + y.bankTradeNumber + '</td>' +
												'</tr>';
											$('.leftTable' + i).find('tbody').append(htmlLeftTr);
										}

									}
								});
								if(rightbool) {
									htmlRightTr = '<tr class="' + i + '">' +
										//项目销售
										'<td width="190px" class="project-th-hide payment-list merge-last" style="display: none;"><span style="opacity:0">无</span></td>' +
										//认领时间
										'<td width="90px" class="project-th-hide payment-list merge-last" style="display: none;"><span style="opacity:0">无</span></td>' +
										//项目名称
										'<td width="137px" class="payment-list merge-last"><span style="opacity:0">无</span></td>' +
										//项目周期
										'<td width="200px" class="payment-list merge-last"><span style="opacity:0">无</span></td>' +
										//学员姓名
										'<td width="200px" class="payment-list merge-last"><span style="opacity:0">无</span></td>' +
										//单位
										'<td width="66px" class="project-th-hide payment-list merge-last" style="display: none;"><span style="opacity:0">无</span></td>' +
										//未收金额
										'<td width="68px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>' +
										//对账金额
										'<td width="67px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>' +
										//入账金额
										'<td width="70px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>' +
										//差额
										'<td width="90px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>' +
										//入账确认
										'<td width="60px" class="payment-list merge-last" style="text-align:center;"><span style="opacity:0">无</span></td>' +
										//入账人
										'<td width="100px" class="payment-list merge-last" style="text-align:center;"><span style="opacity:0">无</span></td>' +
										'</tr>';
									$('.rightTable' + i).find('tbody').append(htmlRightTr);
								}
								$('.leftTd' + i).attr('rowspan', leftnum);
								$('.rightTd' + i).attr('rowspan', rightnum);
								var tableHeight = 0;
								leftnum > rightnum ? tableHeight = $('.leftTable' + i).height() : tableHeight = $('.rightTable' + i).height();
								leftnum == rightnum ? tableHeight = $('.leftTable' + i).height() : false;
								$('.leftTable' + i).css('height', tableHeight + 'px');
								$('.rightTable' + i).css('height', tableHeight + 'px');
								var num = $(".project-tbody").find('label input[type="checkbox"]').length;
								$(".num").text(num);
							});
						} else {
							htmlTr = '<tr style="border:0px;background-color:#fff !important;" >' +
								'<td colspan="18" align="center" style="border:0px;">' +
								'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
								'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
								'</div>' +
								'</td>' +
								'</tr>';
							$(".bank-table-left .project-tbody").html(htmlTr);
							$(".bank-table-right .project-tbody").html(htmlTr);
						}
						$yt_baseElement.hideLoading();
					}
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	//入账确认
	confirmFunc: function(confirm) {
		if(confirm == 1) {
			return "已入账";
		} else if(confirm == 0) {
			return "未入账";
		}
	},
	//项目类型设置
	projectTypeInfo: function(code) {
		if(code == 1) {
			return "计划";
		} else if(code == 2) {
			return "委托";
		} else if(code == 3) {
			return "选学";
		} else if(code == 4) {
			return "调训";
		} else {
			return '';
		};
	},

}
$(function() {
	//初始化方法
	claimRecord.init();
});