var first_menu_data='';var first_menu_data_bak='';$(function(){$yt_common.ytAclCookieKey='yitianSSODynamicKey';$yt_common.getUserInfo();$yt_common.getUsersPositions();$yt_common.init();$yt_common.navFunEvent();$yt_common.heardFunEvent();var requerParameter=$yt_common.GetRequest();if(requerParameter&&requerParameter.childId!=undefined&&requerParameter.childId!=""&&requerParameter.systemId!=undefined&&requerParameter.systemId!=null){$left_menu.accessControlFun(requerParameter.systemId,requerParameter.childId)}document.onkeypress=forbidBackSpace;document.onkeydown=forbidBackSpace});var commonFuncAuth="";var $yt_common={user_info:{},getUsersPositions:{},setCookie:{},request_params:{},common_width:0,left_width:0,html_width:0,setMainWidth:function(){if($(window).width()<this.common_width){this.html_width=this.common_width}else{this.html_width=$(window).width()}var left=(this.html_width-1200)/2;if(left<0){left=0}var main_left=this.left_width+left;var main_width=this.html_width-main_left;console.log("left"+left);$(".left-nav").css("left",left);$(".main-nav").css({width:main_width,left:main_left,"min-width":main_width});$(".head-nav").css({"min-width":this.common_width})},navFunEvent:function(){$("#nav-fun-list li").mouseover(function(){var navHidVal=$(this).find(".nav-fun-hid").val();switch(navHidVal){case "index":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/index-icon2.png");break;case "address":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/address-list-icon2.png");break;case "msg":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/msg-icon2.png");break;case "set":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/set-icon2.png");break;case "out":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/logo-out-icon2.png");break;default:}$(this).addClass("nav-fun-check")});$("#nav-fun-list li").mouseout(function(){var navHidVal=$(this).find(".nav-fun-hid").val();if(!$(this).find("div").hasClass("nav-check")){switch(navHidVal){case "index":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/index-icon1.png");break;case "address":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/address-list-icon1.png");break;case "msg":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/msg-icon1.png");break;case "set":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/set-icon1.png");break;case "out":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/logo-out-icon1.png");break;default:}$("#nav-fun-list li").removeClass("nav-fun-check")}});$("#nav-fun-list li:not(.users-info-li)").off("click").click(function(){$("#nav-fun-list li div").removeClass("nav-check nav-fun-check");$(this).find("div").addClass("nav-check nav-fun-check");var navHidVal=$(this).find(".nav-fun-hid").val();switch(navHidVal){case "index":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/index-icon2.png");break;case "address":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/address-list-icon2.png");break;case "saosao":window.open($yt_option.websit_path+"barCode/barCodeBase.html");break;case "msg":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/msg-icon2.png");break;case "set":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/set-icon2.png");break;case "out":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/logo-out-icon2.png");break;default:}})},init:function(){$("body").append('<div id="pop-modle-alert"></div>');$(window).scroll(function(){$("#yt-index-head-nav").css("left",$(window).scrollLeft()*-1);$("#frame-right-model").css("left",$(window).scrollLeft()*-1+160);$(".top-button-list").css("top",$(window).scrollTop()+80);$(".peoper-list-model").css("top",$(window).scrollTop());});$(window).resize(function(){})},eventStopPageaction:function(){var e=arguments.callee.caller.arguments[0]||event;if(e&&e.stopPropagation){e.stopPropagation()}else if(window.event){window.event.cancelBubble=true}},getToken:function(){var cookies=document.cookie.split(";");var dynamicKey="";if(cookies.length>0){for(var i=0;i<cookies.length;i+=1){var cookie=cookies[i].split("=");if($.trim(cookie[0])==$yt_common.ytAclCookieKey){dynamicKey=unescape(cookie[1])}}}return dynamicKey},getUserDataByDynamicKey:function(){var userInfo={};var token=$yt_common.getToken();$.ajax({type:"post",url:$yt_option.base_path+"api/index/getUserInfoByDynamicKey",async:false,data:{dynamicKey:token},success:function(data){$yt_common.user_info=data.data;$("#nav-fun-list .logo-user-name").text(data.data.userRealName);var userPhoto="./resources/images/common/user-photo-def.png";if(data.data.userHeadPictureToCol3!=undefined&&data.data.userHeadPictureToCol3!=""){userPhoto=data.data.userHeadPictureToCol3;$("#user-photo").attr("src",userPhoto)}else{$("#user-photo").attr("src",userPhoto)}}})},getUserInfo:function(){var userInfo={};$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsersDetails",async:false,success:function(data){$yt_common.user_info=data.data;$("#nav-fun-list .logo-user-name").text(data.data.userRealName);}})},getUsersPositions:function(){},setCookie:function(key,value,t){var oDate=new Date();oDate.setDate(oDate.getDate()+t);document.cookie=key+'='+encodeURIComponent(value)+';expires='+oDate.toGMTString()+';path=/;domain=.tcsasac.com'},getParameter:function(name){return $yt_common.request_params[name]},GetQueryString:function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)");var r=window.location.search.substr(1).match(reg);if(r!=null){return unescape(r[2])}return null},GetRequest:function(){var url=location.search;var theRequest={};if(url!=""&&url!=null){if(url.indexOf("?")!=-1){var str=url.substr(1);strs=str.split("&");for(var i=0;i<strs.length;i+=1){theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}}}return theRequest},heardFunEvent:function(){$(".home-model").off().on("click",function(){window.location.href="index.html"});$(".logout-model").off().on("click",function(){$yt_common.setCookie($yt_common.ytAclCookieKey,"",1000);window.location.href=$yt_option.logoutUrl})},parentAction:function(param){if(param.url&&param.funName){var dataStr=JSON.stringify(param.data);var url=param.url+'?funName='+param.funName+'&param='+dataStr;var iframes=document.getElementById('myfarme');if(iframes){document.getElementsByTagName("body")[0].removeChild(iframes)}var iframe=document.createElement("iframe");iframe.id="myfarme";iframe.style.display='none';document.getElementsByTagName("body")[0].appendChild(iframe);document.getElementById('myfarme').src=url}}};var $left_menu={menuId:"",twoMenuId:"",init:function(){var me=this;var contentType="application/x-www-form-urlencoded; charset=utf-8";if(window.XDomainRequest){contentType="text/plain"}var systemId=$("#yt-index-head-sys select").val();var paramObj=$yt_common.GetRequest();$.ajax({type:"get",url:$yt_option.menu_path,async:true,success:function(data){var sysMenu='';var menuImgUrl="";$("#nav-resource").empty().append('<ul id="system-menu"></ul>');$.each(data.data.children,function(i,n){if(n.logoUrl==""||n.logoUrl==undefined||n.logoUrl==null){menuImgUrl=$yt_option.websit_path+"resources/images/test/menu-test.png"}else{menuImgUrl=n.logoUrl}sysMenu=$('<li class="system-menu-li"><div class="menu-fun-element"></div><div class="system-menu menu-element"><div class="system-menu-img-model"><img src="'+menuImgUrl+'"></div><div class="system-menu-name" title="'+n.menuName+'">'+n.menuName+'</div><div class="system-open"><img src="./resources/images/common/one-menu-open-icon.png" class="mCS_img_loaded"></div></div></li>');sysMenu.find(".menu-element").data("menuData",n);if(n.leaf=="false"){me.getMenuData(n.children,sysMenu)}$("#system-menu").append(sysMenu)});$(".menu-element").click(function(){var menuInfo=$(this).data("menuData");if(menuInfo.leaf=="true"){$(".menu-element,.leaf-menu").removeClass("child-check");$(this).parent().siblings().removeClass("child-check");$(this).parent().addClass("child-check");$left_menu.switchTab(menuInfo.parentId,menuInfo.menuUrl,menuInfo.pkId,menuInfo.openType,menuInfo.implateType,menuInfo.systemId)}else{$(this).parent().siblings().removeClass("child-check");$(this).parent().siblings().removeClass("system-men-check");$(this).parent().toggleClass("system-men-check")}});if(paramObj.pageUrl!=""&&paramObj.pageUrl!=null&&paramObj.pageUrl!=undefined){var goPageUrl=paramObj.goPageUrl;var menuEle=$('[menuurl="'+goPageUrl+'"]');var menuInfo=menuEle.data("menuData");menuEle.parent().siblings().removeClass("child-check");menuEle.parent().addClass("child-check");console.log(menuInfo);$left_menu.switchTab(menuInfo.parentId,decodeURIComponent(paramObj.pageUrl),menuInfo.pkId,1,menuInfo.implateType,menuInfo.systemId);$('.menu'+menuInfo.id).addClass("child-check").parents(".one-menu,.system-menu-li").addClass("system-men-check")}else if(paramObj.menuId!=""&&paramObj.menuId!=undefined&&paramObj.systemId!=""&&paramObj.systemId!=undefined&&paramObj.childId!=""&&paramObj.childId!=undefined){var menuInfo;var isCheck=false;$(".menu-element").each(function(){menuInfo=$(this).data("menuData");if(menuInfo.pkId==paramObj.childId&&menuInfo.systemId==paramObj.systemId){$left_menu.switchTab(menuInfo.parentId,menuInfo.menuUrl,menuInfo.pkId,menuInfo.openType,menuInfo.implateType,menuInfo.systemId);$('.menu'+paramObj.childId).siblings().removeClass("child-check");$("li.system-menu-li").removeClass("system-men-check");$('.menu'+paramObj.childId).addClass("child-check").parents(".one-menu,.system-menu-li").addClass("system-men-check");$("#left-menu-cnt").mCustomScrollbar({autoHideScrollbar:true,theme:"square"});var scrollTopVal=0;scrollTopVal=$('.menu'+paramObj.childId).parents(".system-menu-li").offset().top-82;$("#left-menu-cnt .mCSB_container").css("top","-"+scrollTopVal+"px");isCheck=true;return false}else{isCheck=false}if(!isCheck){if(first_menu_data==""){first_menu_data=first_menu_data_bak}$left_menu.switchTab(first_menu_data.parentId,first_menu_data.menuUrl,first_menu_data.pkId,first_menu_data.openType,first_menu_data.implateType,first_menu_data.systemId);$('.menu'+first_menu_data.id).addClass("child-check").parents(".one-menu,.system-menu-li").addClass("system-men-check")}})}else{}},error:function(data){console.log('菜单获取失败')}})},getMenuData:function(menuData,sysMenu){var me=this;var className='';var menuUl=$('<ul class="menu-list""></ul>');var menuNameClass='';var paramObj=$yt_common.GetRequest();$.each(menuData,function(i,n){menuNameClass='one-menu-text menu-element';className='one-menu no-border';if(n.leaf=="true"){className='two-menu leaf-menu menu'+n.id;menuNameClass='menu-element';if(first_menu_data==""){if(paramObj.defaultSysCode==undefined||paramObj.defaultSysCode==''){first_menu_data=n}else if(n.systemCode==paramObj.defaultSysCode){first_menu_data=n}}}if(first_menu_data_bak==""){first_menu_data_bak=n}var childMenu=$('<li class="'+className+'"><div class="menu-fun-element"></div><div class="'+menuNameClass+'" menuUrl="'+n.menuUrl+'" title="'+n.menuName+'">'+n.menuName+'</div></li>');childMenu.find(".menu-element").data("menuData",n);if(n.leaf=="false"){me.getMenuData(n.children,childMenu)}menuUl.append(childMenu)});sysMenu.append(menuUl)},switchTab:function(menuId,url,twoMenuId,openType,implateType,systemId){$("#yt-index-head-nav #nav-fun-list li div").removeClass("nav-check");$("#yt-index-head-nav #nav-fun-list li:eq(0) div img").attr("src","./resources/images/common/index-icon1.png");if(url==""||$.trim(url).length<=0||url==undefined||url==null){url=$yt_option.websit_path+"resources/images/common/develop-page.png";var iframeStr='<iframe name="right" id="rightMain" src="" frameborder="no" scrolling="auto" width="100%" height="100%" allowtransparency="true" style="display: block;"></iframe>';$("#frame-right-model").addClass("iframe-flow").html(iframeStr);$("#rightMain").contents().find("body").css("background","#FFFFFF").html('<div style="text-align: center;padding-top:150px;"><img src="'+url+'" /></div>');$left_menu.accessControlFun(systemId,twoMenuId);return false}$yt_baseElement.showLoading();$left_menu.menuId=menuId;$left_menu.twoMenuId=twoMenuId;$yt_baseElement.hideLoading();$.ajax({type:"post",url:$yt_option.base_path+"login/recordMenu",async:false,data:{menuUrl:url,menuId:menuId,systemId:systemId,childId:twoMenuId,isMenu:1},success:function(data){}});if(url.indexOf("?")>-1){url=url+"&menuId="+menuId+"&systemId="+systemId+"&childId="+twoMenuId+"&isMenu=1&CDT="+new Date().getTime()}else{url=url+"?menuId="+menuId+"&systemId="+systemId+"&childId="+twoMenuId+"&isMenu=1&CDT="+new Date().getTime()}if(url.indexOf("imgFlag")>-1){var iframeStr='<iframe name="right" id="rightMain" src="" frameborder="no" scrolling="auto" width="100%" height="100%" allowtransparency="true" style="display: block;"></iframe>';$("#frame-right-model").addClass("iframe-flow").html(iframeStr);$("#rightMain").contents().find("body").css("background","#FFFFFF").html('<div style="min-width:1280px;"><img style="width:100%" src="'+url+'" /></div>');return false}if(openType=="2"){window.open(url);return false}else if(implateType=="2"){$("#frame-right-model").addClass("iframe-flow").html('<iframe src="'+url+'" name="right" id="rightMain" src="" frameborder="no" scrolling="auto" width="100%" height="100%" allowtransparency="true" style="display: block;"></iframe>');return false}if(url.indexOf("http://")!=0){url=$yt_option.websit_path+url}$yt_common.request_params={};if(url.indexOf("?")!=-1){var str=url.substr(url.indexOf("?")+1);strs=str.split("&");for(var i=0;i<strs.length;i+=1){$yt_common.request_params[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}}else{$yt_common.request_params={}}$("#frame-right-model").html("");$.ajax({type:"get",url:url,async:false,success:function(data){data=data.replace(/YTVERSIONCODE/g,'versionCode='+$yt_option.version_code);$("#frame-right-model").removeClass("iframe-flow").html('<div id="yt-index-main-nav" style="">'+data+'</div>');$(window).scrollTop(0)}});var divMinHei=$(window).height();$(".web-criterion-model").css("min-height",divMinHei);$left_menu.accessControlFun(systemId,twoMenuId)},accessControlFun:function(systemId,menuId){var getParmaObj=$yt_common.GetRequest();if(systemId==undefined){systemId=getParmaObj.systemId}if(menuId==undefined){menuId=getParmaObj.menuId}$.ajax({type:"post",url:$yt_option.base_path+'api/index/getFuncListByMenuId',async:false,data:{"dynamicKey":$yt_common.user_info.dynamicKey,"systemId":systemId,"menuId":menuId},success:function(data){var resultData=",";$.each(data.data,function(i,n){resultData+=n.funcCode+','});commonFuncAuth=resultData;$left_menu.removeAuth()}})},locationToMenu:function(param){var url=JSON.parse(param).url;var menuEle=$('[menuurl="'+url+'"]');var menuInfo=menuEle.data("menuData");$(".child-check").removeClass("child-check");$(".system-men-check").removeClass("system-men-check");menuEle.parent().addClass("child-check").parents(".one-menu,.system-menu-li").addClass("system-men-check");$left_menu.switchTab(menuInfo.parentId,menuInfo.menuUrl+"?"+$.param(JSON.parse(param)),menuInfo.pkId,menuInfo.openType,menuInfo.implateType,menuInfo.systemId)},removeAuth:function(){$("[acl-code]").each(function(i,n){var acl_code=","+$(n).attr("acl-code")+",";if(commonFuncAuth.indexOf(acl_code)==-1){$(n).remove()}})}};function forbidBackSpace(e){var ev=e||window.event;var obj=ev.target||ev.srcElement;var t=obj.type||obj.getAttribute('type');var vReadOnly=obj.readOnly;var vDisabled=obj.disabled;vReadOnly=(vReadOnly==undefined)?false:vReadOnly;vDisabled=(vDisabled==undefined)?true:vDisabled;var flag1=ev.keyCode==8&&(t=="password"||t=="text"||t=="textarea"||t=="number")&&(vReadOnly==true||vDisabled==true);var flag2=ev.keyCode==8&&t!="password"&&t!="text"&&t!="textarea"&&t!="number";if(flag2||flag1){return false}}