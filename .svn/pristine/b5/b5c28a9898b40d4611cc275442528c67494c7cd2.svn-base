var addProjectList={init:function(){$('.add-title').text('新增项目');var judgeList=$yt_common.GetQueryString('judgeList');if(judgeList==1){$("option[value='3']").remove();$("option[value='4']").remove();$("option[value='']").remove()}if(judgeList==2){$("option[value='2']").remove();$(".add-project-entrust-hidden").hide()}$(".yt-select").niceSelect();$(".start-date").calendar({controlId:"startDate",nowData:false,upperLimit:$(".end-date")});$(".end-date").calendar({controlId:"endDate",nowData:false,lowerLimit:$(".start-date")});$(".project-type").change(function(){if($(".project-type").val()==4){$(".add-project-entrust-hidden").show()}});var pkId=$yt_common.GetQueryString('pkId');if(pkId){addProjectList.getProjectInf();$(".btn-sub").off().on('click',function(){addProjectList.amendProjectListInf()});$(".btn-off").on('click',function(){window.history.back()})}else{$('.btn-sub').off().click(function(){if($yt_valid.validForm($('.valid-tab'))){addProjectList.addProjectListInf()}else{addProjectList.pageToScroll($('body .valid-font'))}});$(".btn-off").on('click',function(){window.history.back()})}var groupList=addProjectList.getListSelectGroup();if(groupList!=null){$.each(groupList,function(i,n){$(".group-id").append('<option value="'+n.groupId+'">'+n.groupName+'</option>')})}$(".group-id").niceSelect();var treeAllPersonal=addProjectList.getTreeAllPersonnel();if(treeAllPersonal!=null){$.each(treeAllPersonal,function(i,n){if(n.type==3){$(".project-sell").append('<option value="'+n.textName+'">'+n.text+'</option>')}})}$(".project-sell").niceSelect()},getListSelectGroup:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/group/getGroups",data:{isSelectGroup:'2',groupId:""},async:false,success:function(data){list=data.data||[]}});return list},getTreeAllPersonnel:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsers",data:{},async:false,success:function(data){list=data.data||[]}});return list},addProjectListInf:function(){$yt_baseElement.showLoading();var projectName=$(".project-name").val();var projectType=$(".project-type").val();var projectSell=$(".project-sell").val();var startDate=$(".start-date").val();var endDate=$(".end-date").val();var trainDate=$(".train-date").val();var details=$(".details").val();var groupId=$(".group-id").val();var customerDept=$(".customer-dept").val();var customerLinkman=$(".customer-linkman").val();var customerLinkmanPosition=$(".customer-linkman-position").val();var customerLinkmanPhone=$(".customer-linkman-phone").val();var customerLinkmanCellphone=$(".customer-linkman-cellphone").val();var customerLinkmanFax=$(".customer-linkman-fax").val();var customerLinkmanEmail=$(".customer-linkman-email").val();var customerTraineePosition=$(".customer-trainee-position").val();var customerTraineeSum=$(".customer-trainee-sum").val();var customerTraineeAgeStructure=$(".customer-trainee-age").val();var customerTargetDemand=$(".customer-target-demand").val();$.ajax({async:true,before:function(){$yt_baseElement.showLoading()},type:"post",url:$yt_option.base_path+"project/addOrUpdateBean",data:{projectName:projectName,projectType:projectType,projectSell:projectSell,startDate:startDate,endDate:endDate,trainDate:trainDate,details:details,groupId:groupId,customerDept:customerDept,customerLinkman:customerLinkman,customerLinkmanPosition:customerLinkmanPosition,customerLinkmanPhone:customerLinkmanPhone,customerLinkmanCellphone:customerLinkmanCellphone,customerLinkmanFax:customerLinkmanFax,customerLinkmanEmail:customerLinkmanEmail,customerTraineePosition:customerTraineePosition,customerTraineeSum:customerTraineeSum,customerTraineeAgeStructure:customerTraineeAgeStructure,customerTargetDemand:customerTargetDemand},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("新增成功");$(".btn-all").hide();$yt_baseElement.hideLoading();window.history.back()}else{$yt_alert_Model.prompt("新增失败");$yt_baseElement.hideLoading()}}})},getProjectInf:function(){var pkId=$yt_common.GetQueryString('pkId');$.ajax({before:function(){$yt_baseElement.showLoading()},type:"post",url:$yt_option.base_path+"project/getBeanById",data:{pkId:pkId},success:function(data){if(data.flag==0){$('.add-title').text('修改项目');$(".get-project-inf").setDatas(data.data);$(".project-type").setSelectVal(data.data.projectType);$(".project-sell").setSelectVal(data.data.projectSell);$(".group-id").setSelectVal(data.data.groupId);if($(".project-type").val()==4){$(".add-project-entrust-hidden").show()}$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("获取失败");$yt_baseElement.hideLoading()}}})},amendProjectListInf:function(){var pkId=$yt_common.GetQueryString('pkId');var projectName=$(".get-project-inf .project-name").val();var projectType=$(".get-project-inf .project-type").val();var projectSell=$(".get-project-inf .project-sell").val();var startDate=$(".get-project-inf .start-date").val();var endDate=$(".get-project-inf .end-date").val();var trainDate=$(".get-project-inf .train-date").val();var details=$(".get-project-inf .details").val();var groupId=$(".get-project-inf .group-id").val();var customerDept=$(".get-project-inf .customer-dept").val();var customerLinkman=$(".get-project-inf .customer-linkman").val();var customerLinkmanPosition=$(".get-project-inf .customer-linkman-position").val();var customerLinkmanPhone=$(".get-project-inf .customer-linkman-phone").val();var customerLinkmanCellphone=$(".get-project-inf .customer-linkman-cellphone").val();var customerLinkmanFax=$(".get-project-inf .customer-linkman-fax").val();var customerLinkmanEmail=$(".get-project-inf .customer-linkman-email").val();var customerTraineePosition=$(".get-project-inf .customer-trainee-position").val();var customerTraineeSum=$(".get-project-inf .customer-trainee-sum").val();var customerTraineeAgeStructure=$(".get-project-inf .customer-trainee-age").val();var customerTargetDemand=$(".get-project-inf .customer-target-demand").val();$.ajax({before:function(){$yt_baseElement.showLoading()},type:"post",url:$yt_option.base_path+"project/addOrUpdateBean",data:{pkId:pkId,projectName:projectName,projectType:projectType,projectSell:projectSell,startDate:startDate,endDate:endDate,trainDate:trainDate,details:details,groupId:groupId,customerDept:customerDept,customerLinkman:customerLinkman,customerLinkmanPosition:customerLinkmanPosition,customerLinkmanPhone:customerLinkmanPhone,customerLinkmanCellphone:customerLinkmanCellphone,customerLinkmanFax:customerLinkmanFax,customerLinkmanEmail:customerLinkmanEmail,customerTraineePosition:customerTraineePosition,customerTraineeSum:customerTraineeSum,customerTraineeAgeStructure:customerTraineeAgeStructure,customerTargetDemand:customerTargetDemand},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("修改成功");window.history.back();$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("修改失败");$yt_baseElement.hideLoading()}}})},pageToScroll:function(validObj){var scrollTopVal=0;$(validObj).each(function(){if($(this).text()!=""){if($(window).scrollTop()&&($(this).eq(0).parent().offset().top<$(window).scrollTop()||$(this).eq(0).parent().offset().top>$(window).height())){scrollTopVal=$(this).eq(0).parents().offset().top-30;$(window).scrollTop(scrollTopVal)}return false}})}};$(function(){addProjectList.init()});