var beforeApproList={searchInput:function(){$('.search').on('keydown',function(){if($(this).val()!=''){$('.clearImg').show()}});$('.clearImg').on('click',function(){$('.search').val('');$(this).hide();beforeApproList.searchList()});$("#resetBtn").off().on("click",function(){$('.search').val('');$(".clearImg").hide();beforeApproList.searchList()});$("#heardSearchBtn").off().on("click",function(){beforeApproList.searchList()});$(".end-table").on('click','.process-state',function(){var processInstanceId=$(this).parents("tr").find(".processInstanceId").val();sysCommon.processStatePop(processInstanceId)});beforeApproList.printBtnEvent()},printBtnEvent:function(){$("#printBeforBtn").click(function(){var selTrLen=$(".tab-div .tab-content:visible tbody tr.yt-table-active").length;var thisTrData=$(".tab-div .tab-content:visible tbody tr.yt-table-active").data("dataStr");if(selTrLen==0){$yt_alert_Model.prompt("请选择一行数据进行操作")}else{var pageUrl="view/system-sasac/expensesReim/module/print/beforeApplyDetailMain.html?expenditureAppId="+thisTrData.advanceAppId+'&costType='+thisTrData.advanceCostType;$yt_baseElement.openNewPage(2,pageUrl)}})},searchList:function(){var status=$('.active-li input').val();if(status=='WF_SUSPENDING_QUERY_SQL_PARAMS'){beforeApproList.getPendingList(status)}else if(status=='WF_SOLVED_QUERY_SQL_PARAMS'){$(".app-date-th").text("申请日期");beforeApproList.getProcessingAndFinishList(status)}else if(status=='WF_COMPLETED_QUERY_SQL_PARAMS'){beforeApproList.getProcessingAndFinishList(status)}else if(status=='WF_DRAFTS_QUERY_SQL_PARAMS'){}},switcher:function(){$('.tab-li').off().on('click',function(){var index=$(this).index();$(this).addClass('active-li').siblings('.tab-li').removeClass('active-li');if(index==1||index==2){$('.tab-content').eq(1).css("display",'block').addClass("check").siblings('.tab-content').hide().removeClass("check")}else{$('.tab-content').eq(index).css("display",'block').addClass("check").siblings('.tab-content').hide().removeClass("check")}beforeApproList.searchList()})},getPendingList:function(stateCode){var keyWord=$('.search').val();$('.page1').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:'sz/advanceApp/getUserAdvanceAppInfoWFListToPageByParams',data:{queryStateParams:stateCode,queryParams:keyWord,formType:"expenditure"},objName:'data',success:function(data){var datas=data.data.rows;var htmlTbody=$('.wait-table .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){if(datas.length>0){$('.page1').show();$.each(datas,function(i,n){trStr+='<tr><td><a class="yt-link to-detail">'+n.advanceAppNum+'</a><input type="hidden" class="hid-advance-id" value="'+n.advanceAppId+'"/><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/></td><td class="tl"><div style="white-space: normal;word-break: break-all;word-wrap: break-word;">'+(n.advanceAppName==""?"--":n.advanceAppName)+'</div></td><td style="text-align: right;">'+(n.advanceAmount==""?"--":$yt_baseElement.fmMoney(n.advanceAmount))+'</td>'+'<td>'+n.applicantUserName+'</td><td><span>'+n.applicantDept+'</span></td><td>'+n.stagnationTime+'</td>'+'<td><a class="yt-link apprv-btn" taskKey="'+n.taskKey+'">'+(n.taskKey=='activitiStartTask'?'处理':'审批')+'</a><span class="center-line">|</span><a class="yt-link log-mod">日志</a></td></tr>';trStr=$(trStr).data("dataStr",n);htmlTbody.append(trStr)});beforeApproList.goApprovePage();sysCommon.initQtip($(".log-mod"));beforeApproList.toDetails()}else{$('.page1').hide();htmlTbody.append(sysCommon.noDataTrStr(8))}}},isSelPageNum:true })},toDetails:function(){$('.yt-link.to-detail').off("click").on('click',function(){$yt_baseElement.eventStopPageaction();var processInstanceId=$(this).parents('tr').find('.processInstanceId').val();var advanceId=$(this).parents('tr').find('.hid-advance-id').val();var fun=$(this).attr('fun');var pageUrl="view/system-sasac/expensesReim/module/beforehand/beforeApplyDetail.html?processInstanceId="+processInstanceId+"&advanceId="+advanceId+"&fun="+fun;$yt_baseElement.openNewPage(2,pageUrl)})},getProcessingAndFinishList:function(stateCode){var keyWord=$('.search').val();$('.page2').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:'sz/advanceApp/getUserAdvanceAppInfoWFListToPageByParams',data:{queryStateParams:stateCode,queryParams:keyWord},objName:'data',success:function(data){var datas=data.data.rows;var htmlTbody=$('.end-table .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){if(datas.length>0){$('.page2').show();$.each(datas,function(i,n){trStr+='<tr><td><a class="yt-link to-detail">'+n.advanceAppNum+'</a><input type="hidden" class="hid-advance-id" value="'+n.advanceAppId+'"/><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/></td><td class="tl">'+(n.advanceAppName==""?"--":n.advanceAppName)+'</td><td style="text-align: right;">'+(n.advanceAmount==""?"--":$yt_baseElement.fmMoney(n.advanceAmount))+'</td>'+'<td>'+n.applicantUserName+'</td><td><span>'+n.applicantDept+'</span></td>';if(stateCode=='WF_COMPLETED_QUERY_SQL_PARAMS'){$(".applicant-time-th").show();trStr+='<td>'+n.handleTime+'</td>'}else{$(".applicant-time-th").hide()}if(stateCode=='WF_SOLVED_QUERY_SQL_PARAMS'){$(".process-state-th").show();trStr+='<td style="text-align:left;"><span class="yt-link process-state">'+n.nodeNowState+'</span></td>'}else{$(".process-state-th").hide()}trStr+='<td class="app-state-td"><span class="">'+(n.changeState==0?'未修改':'已修改')+'</span></td><td><a class="yt-link log-mod">日志</a></td></tr>';trStr=$(trStr).data("dataStr",n);htmlTbody.append(trStr)});if(stateCode=="WF_SOLVED_QUERY_SQL_PARAMS"){$(".app-state-td,.app-state-th").hide()}else{$(".app-state-td,.app-state-th").show()}beforeApproList.goApprovePage();sysCommon.initQtip($(".log-mod"));beforeApproList.toDetails()}else{$('.page2').hide();htmlTbody.append(sysCommon.noDataTrStr(8))}}},isSelPageNum:true })},goApprovePage:function(){$(".apprv-btn").off().click(function(){var advanceId=$(this).parents("tr").find(".hid-advance-id").val();var state=$(this).attr('taskKey');var fun=$(this).attr('fun');var pageUrl='';if(state=='activitiStartTask'){pageUrl='view/system-sasac/expensesReim/module/busiTripApply/serveApply.html?advanceId='+advanceId}else{pageUrl='view/system-sasac/expensesReim/module/busiTripApply/priorApproval.html?advanceId='+advanceId+'&fun='+fun}parent.parent.$yt_baseElement.showLoading();window.location.href=$yt_option.websit_path+pageUrl})}};$(function(){beforeApproList.searchInput();beforeApproList.switcher();var state=$yt_common.GetRequest().state;if(state){$('.tab-header .tab-li').removeClass('active-li');$('.tab-header .tab-li').eq(1).addClass('active-li');$('.tab-content').eq(1).css("display",'block').siblings('.tab-content').hide()}beforeApproList.searchList();$("#reimApproList").css("min-height",$(window).height()-12)});