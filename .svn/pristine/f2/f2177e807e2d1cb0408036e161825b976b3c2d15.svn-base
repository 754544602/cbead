/**
 * 班级详细信息
 */
var caInfoList={init:function(){var index=$yt_common.GetQueryString("index");if(index==1){$(".class-info-btn").removeClass("active");$(".class-div").hide();$(".teacher-info-btn").addClass("active");$(".teacher-div-box").show();caInfoList.getTeacherListInfo();}else{caInfoList.getPlanListInfo()}var projectCode=$yt_common.GetQueryString("projectCode");$(".tab-title-list button").click(function(){$(this).addClass("active").siblings().removeClass("active");$(".box-list .content-box").hide().eq($(this).index()).show();if($(this).index()==0){caInfoList.getPlanListInfo()}else if($(this).index()==1){caInfoList.getTeacherListInfo()}else if($(this).index()==2){courseManager.getCourseType();courseManager.getCourseList()}else if($(this).index()==3){studentList.getStudentList();studentList.getDifferentList()}else if($(this).index()==4){repeatCourtyardList.getRepeatComeList();repeatCourtyardList.doubtRepatComeList()}else if($(this).index()==5){studentManual.getTemplateList();$('.student-manual-div .student-manual-btn').eq(0).addClass('change-page-sign').siblings().removeClass('change-page-sign');$('.student-manual-div .manual-div').hide().eq(0).show();studentManual.getPageDataList()}else if($(this).index()==6){receptionNotice.getReceptionList()}else if($(this).index()==7){classBulletin.getClassBulletin()}else if($(this).index()==8){}else if($(this).index()==9){studentReport.getStudentReport();studentReport.getDifferentList()}else if($(this).index()==10){payTicket.PayTicketList(2,2)}else if($(this).index()==11){leaveTube.leaveList()}else if($(this).index()==12){attendance.getSwitchBtn();attendance.getStudentSign()}else if($(this).index()==13){certificateEnd.getCertificateList()}else if($(this).index()==14){feedBack.getBackListHead();feedBack.getFeedBackList()}});$('.page-return-btn').off().on('click',function(){window.history.back()});$(".see-more-mssage").click(function(){var projectId=$(".project-pk-id").val();var projectCode=$yt_common.GetQueryString("projectCode");window.location.href="../project/projectDetails.html?projectCode="+projectCode+"&&pkId="+projectId+"&&judgeList=1&&tp=1&&projectCodeList="+projectCode});$('.teacher-div .tab-content .teacher-table').on('click','.real-name',function(){var teacherId=$(this).parents("tr").find('label .select-teacher-pkId').val();var projectCode=$yt_common.GetQueryString("projectCode");window.location.href="classTeacherInf.html?pkId="+teacherId+"&&projectCode="+projectCode});$('.teacher-search-btn').click(function(){caInfoList.selectTeacherListInfo();$(".select-teacher-div").show();$('.teacher-search-img').click(function(){caInfoList.selectTeacherListInfo()});$('.select-teacher-sure-btn').click(function(){var pkId="";$('.select-teacher-alert-checkbox input[class="select-teacher-pkId"]:checked').each(function(){if(pkId==""){pkId=$(this).val()}else{pkId+=","+$(this).val()}});if(pkId==""){$yt_alert_Model.prompt("请选中一行数据进行操作",3000)}else{caInfoList.selectTeacher(pkId)}});$('.select-teacher-canel-btn').click(function(){$('.select-teacher-div .select-teacher-tbody').empty();$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})});$('.teacher-delete-btn').click(function(){var pkId="";var courseName='';$('.select-teacher-checkbox input[class="select-teacher-pkId"]:checked').each(function(){if(pkId==""){pkId=$(this).val();courseName=$(this).parents('tr').data('courseName')}else{pkId+=","+$(this).val();courseName+=","+$(this).parents('tr').data('courseName')}});if(pkId==""){$yt_alert_Model.prompt("请勾选一行",3000)}else{if(courseName==''){$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){caInfoList.deleteTeacher(pkId)}})}else{console.log(courseName);$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:"该教师已被指定为["+courseName+"]的教师,请先取消该课程",cancelFunction:function(){}})}}});$('.teacher-ticket-btn').off('click').click(function(){caInfoList.getTicketList();$(".select-ticket-div").show();$('.select-ticket-sure-btn').off('click').click(function(){caInfoList.getTicket()});$yt_model_drag.modelDragEvent($(".select-ticket-div .yt-edit-alert-title"));$('.select-ticket-canel-btn').click(function(){$(".yt-edit-alert").hide();$("#pop-modle-alert").hide()})});$(".check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".teacher-table tbody,.select-teacher-tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}});$(".teacher-station-btn").click(function(){caInfoList.getRelayList();$(".shuttle-box").show();$yt_model_drag.modelDragEvent($(".shuttle-box .yt-edit-alert-title"));$('.shuttle-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".shuttle-box").hide()})});$(".shuttle-box .yt-model-sure-btn").off().on('click',function(){caInfoList.getNextOptPeople()});$(".more-tab-btn-end").click(function(){var leftVal=parseInt($(".tab-title-box").css("margin-left"))-120;console.log(leftVal);if($(".tab-title-box").parent().width()>($(".tab-title-box button").last().position().left-120)){$(".more-tab-btn-end").hide();leftVal=(120*$(".tab-title-box button").length-$(".tab-title-box").parent().width()+32)*-1}$(".tab-title-box").css("padding-left","32px").stop(true,true).animate({"margin-left":leftVal},100);$(".more-tab-btn-start").show()});$(".more-tab-btn-start").click(function(){var leftVal=parseInt($(".tab-title-box").css("margin-left"))+120;if(leftVal>=-120){$(this).hide();leftVal=0;$(".tab-title-box").css("padding-left","0")}console.log(leftVal);$(".tab-title-box").stop(true,true).animate({"margin-left":leftVal},100);$(".more-tab-btn-end").show()})},getTeacherReseverId:function(){var teachersReseverList=[];var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/teacher/getTeachersReseve",data:{projectCode:projectCode},async:false,success:function(data){if(data.flag==0){var teachersReseve=data.data.teachersReseve;if(teachersReseve!=""){var resever=$.parseJSON(teachersReseve);$.each(resever,function(i,g){var teacherResever={teacherReseverId:g.pkId,teacherId:g.teacherId,routeType:g.routeType};teachersReseverList.push(teacherResever)})}}}});return teachersReseverList},getNextOptPeople:function(){var user="";var dataObj="";$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"teachersFeederStation",processInstanceId:"",parameters:"",versionNum:""},async:true,success:function(data){if(data.flag==0){console.log(data.data);$.each(data.data,function(i,n){console.log(n);console.log(i);for(var k in n){console.log('k',k);console.log("n[k]",n[k]);user=n[k][0].userCode;console.log("userCode",user);dataObj=eval("("+k+")");console.log(dataObj);console.log("nextCode",dataObj.nextCode)}});caInfoList.teacherApplyCar(user,"",dataObj.nextCode)}}})},teacherApplyCar:function(dealingWithPeople,processInstanceId,nextCode){var teacherReseverList=caInfoList.getTeacherReseverId();console.log("订票Id",teacherReseverList);var projectCode=$yt_common.GetQueryString("projectCode");var teachersFeederStation=[];var checkedLength=$(".shuttle-box tbody td input[name='test']:checked").length;$(".shuttle-box tbody td input[name='test']:checked").each(function(i,b){var teacherReserveId="";var pkId=$(b).parents('tr').find('.shuttle-pk-id').val();var teacherId=$(b).parents('tr').find('.teacher-id').val();var teacherName=$(b).parents('tr').find('.teach-name').text();var phone=$(b).parents('tr').find('.teach-phone').text();var routeType=$(b).val();var flightTrainNumber=$(b).parents('tr').find('.flight-num').val();var address=$(b).parents('tr').find('.relay-address').val();var dateTime=$(b).parents('tr').find('.relay-dates').val();$.each(teacherReseverList,function(q,o){if(o.routeType==routeType&&o.teacherId==teacherId){teacherReserveId=o.teacherReseverId;return false}});var sendCarType=1;var teachersList={pkId:pkId,teacherReserveId:teacherReserveId,teacherId:teacherId,teacherName:teacherName,phone:phone,routeType:routeType,flightTrainNumber:flightTrainNumber,address:address,dateTime:dateTime,sendCarType:sendCarType};teachersFeederStation.push(teachersList)});teachersFeederStation=JSON.stringify(teachersFeederStation);console.log(teachersFeederStation);if(checkedLength!=0){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/teacher/addTeachersFeederStation",data:{projectCode:projectCode,teachersFeederStation:teachersFeederStation,businessCode:"teachersFeederStation",dealingWithPeople:dealingWithPeople,processInstanceId:processInstanceId,opintion:"",nextCode:nextCode},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("申请成功");caInfoList.getRelayList()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("申请失败")})}}})}else{$yt_alert_Model.prompt("请勾选之后再进行派车")}},getRelayList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/teacher/getTeachersFeederStation",data:{projectCode:projectCode},async:true,success:function(data){var ralayBody=$(".shuttle-box tbody");var phone='';var lasTr;var rowsNum=2;var routeType;ralayBody.empty();if(data.flag==0){if(data.data.teachersFeederStation!=""){var teachersFeederStation=$.parseJSON(data.data.teachersFeederStation);$.each(teachersFeederStation,function(i,n){var ralayHtml='';ralayHtml+='<tr>';if(phone!=n.teacherId){ralayHtml+='<td class="teach-name" style="text-align:left;">'+n.teacherName+'</td><td class="teach-phone">'+n.phone+'</td>';$(".shuttle-box tbody").find('tr').eq(lasTr).find('td').eq(0).attr('rowspan',rowsNum);$(".shuttle-box tbody").find('tr').eq(lasTr).find('td').eq(1).attr('rowspan',rowsNum);phone=n.teacherId;lasTr=i}else{}ralayHtml+='<input type="hidden" class="shuttle-pk-id" value="'+n.pkId+'"/><input type="hidden" class="teacher-id" value="'+n.teacherId+'"/>';if(n.routeType==1){ralayHtml+='<td class="routetype route-meet"><label class="check-label yt-checkbox" style="margin-left:-26px;"> <input type="checkbox" name="test" value="'+n.routeType+'"/>接</label></td>'}else{ralayHtml+='<td class="routetype route-give"><label class="check-label yt-checkbox" style="margin-left:-26px;"> <input type="checkbox" name="test" value="'+n.routeType+'"/>送</label></td>'}ralayHtml+='<td><input type="text" style="width:100px;" class="yt-input flight-num" placeholder="请输入" value="'+n.flightTrainNumber+'"/></td><td><input type="text" style="width:100px;" class="yt-input relay-address" placeholder="请输入" value="'+n.address+'"/></td><td><input class="calendar-input relay-dates" style="width: 140px;background-position: 131px 7px;" value="'+n.dates+'" placeholder="请选择日期" type="text" /></td>';if(n.sendCarType==1){ralayHtml+='<td style="color:#ff9600;">派车中</td><td style="color:#ff9600;">派车中</td></tr>'}else if(n.sendCarType==2){ralayHtml+='<td>'+n.car+'</td><td>'+n.driver+'</td></tr>'}else{ralayHtml+='<td>--</td><td>--</td></tr>'}ralayBody.append(ralayHtml);$(".shuttle-box tbody").find('tr').eq(lasTr).find('td').eq(0).attr('rowspan',rowsNum);$(".shuttle-box tbody").find('tr').eq(lasTr).find('td').eq(1).attr('rowspan',rowsNum)})}$(".relay-dates").calendar({speed:200,complement:true,readonly:true,nowData:false,dateFmt:"yyyy-MM-dd HH:mm"});$yt_alert_Model.setFiexBoxHeight($(".shuttle-box .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".shuttle-box"));console.log("接送站查询成功");$yt_baseElement.hideLoading()}else{var ralayHtml='';ralayHtml='<tr><td colspan="8" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';ralayBody.append(ralayHtml);$yt_baseElement.hideLoading()}}})},getPlanListInfo:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/getBeanByProjectCode",async:true,data:{projectCode:projectCode},objName:'data',success:function(data){if(data.flag==0){if(data.data.projectType==1){data.data.projectType="调训"}else if(data.data.projectType==2){data.data.projectType="委托"}else if(data.data.projectType==3){data.data.projectType="选学";$('.entrust-compay-div').hide();$('.tab-content.entrust-info').hide()}else if(data.data.projectType==4){data.data.projectType="调训"}$(".project-pk-id").val(data.data.projectId);$('.project-code').text(data.data.projectCode);$('.project-name').text(data.data.projectName);$('.project-type').text(data.data.projectType);$('.project-sell').text(data.data.projectSell);$('.start-date').text(data.data.startDate);$('.end-date').text(data.data.endDate);$('.details').text(data.data.details);$('.train-date').text(data.data.trainDate);$('.customer-unit').text(data.data.customerUnit);$('.customer-dept').text(data.data.customerDept);$('.customer-linkman').text(data.data.customerLinkman);$('.customer-linkman-position').text(data.data.customerLinkmanPosition);$('.customer-linkman-phone').text(data.data.customerLinkmanPhone);$('.customer-linkman-cellphone').text(data.data.customerLinkmanCellphone);$('.customer-linkman-fax').text(data.data.customerLinkmanFax);$('.customer-linkman-email').text(data.data.customerLinkmanEmail);$('.customer-trainee-position').text(data.data.customerTraineePosition);$('.customer-trainee-sum').text(data.data.customerTraineeSum);$('.customer-trainee-age-structure').text(data.data.customerTraineeAgeStructure);$('.customer-target-demand').text(data.data.customerTargetDemand);$('.project-head').text(data.data.projectHead);$('.class-teacher').text(data.data.classTeacher);$('.project-aid').text(data.data.projectAid);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},getTeacherListInfo:function(){var projectCode=$yt_common.GetQueryString("projectCode");var searchParameters="";$('.teacher-div .tab-content .teacher-table thead label input').setCheckBoxState('uncheck');$('.page-info').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/teacher/lookForAll",type:"post",data:{searchParameters:searchParameters,projectCode:projectCode},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.teacher-div .teacher-table .yt-tbody').empty();var htmlTr='';if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){htmlTr='<tr class="teacher-tr"><td><label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test" class="select-teacher-pkId" value="'+v.pkId+'"/></label></td><td style="text-align:left;"><a class="yt-link real-name" style="color:#3c4687;">'+v.realName+'</a></td><td>'+(v.gender==1?"男":"女")+'</td><td class="teacher-phone">'+v.phone+'</td><td style="text-align:left;">'+v.org+'</td><td style="text-align:left;">'+v.title+'</td><td style="text-align:left;">'+v.researchArea+'</td><td class="tr">'+v.dollarsStandardHalf+'</td><td class="tr">'+v.dollarsStandardOne+'</td><td>'+(v.teacherStates==1?"可用":"已用")+'</td></tr>';htmlTr=$(htmlTr).data('courseName',v.courseName);htmlTbody.append(htmlTr)})}else{htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},selectTeacherListInfo:function(){var projectCode=$yt_common.GetQueryString("projectCode");var searchParameters=$('.select-teacher-search-btn').val();$('.select-teacher-div thead label input').setCheckBoxState('unckeck');$('.teacher-page').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/teacher/getTeachers",type:"post",data:{searchParameters:searchParameters,projectCode:projectCode},async:true,before:function(){$yt_baseElement.showLoading()},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.select-teacher-table .yt-tbody');var htmlTr='';htmlTbody.empty();if(data.data.rows.length>0){$('.teacher-page').show();$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else{v.gender="女"}if(v.teacherStates==1){v.teacherStates="可用"}else{v.teacherStates="已用"}htmlTr='<tr><td><label class="check-label yt-checkbox select-teacher-alert-checkbox"><input type="checkbox" name="test" class="select-teacher-pkId" value="'+v.pkId+'"/></label></td><input type="hidden" value="'+v.pkId+'" class="pkid"><td><div><a class="yt-link" style="color:#3c4687;">'+v.realName+'</a></div></td><td>'+v.gender+'</td><td>'+v.phone+'</td><td style="text-align:left;">'+v.org+'</td><td style="text-align:left;">'+v.title+'</td><td style="text-align:left;">'+v.researchArea+'</td><td style="text-align:right;">'+v.dollarsStandardHalf+'</td><td style="text-align:right;">'+v.dollarsStandardOne+'</td><td style="text-align:right;">'+v.grade+'</td><td>'+v.teacherStates+'</td></tr>';htmlTbody.append(htmlTr)});$yt_baseElement.hideLoading()}else{$('.teacher-page').hide();htmlTr='<tr><td colspan="11" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr);$yt_baseElement.hideLoading()}$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-teacher-div"));$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},selectTeacher:function(pkId){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/teacher/addTeachers",async:false,data:{projectCode:projectCode,pkId:pkId},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("添加教师成功");$(".yt-edit-alert,#heard-nav-bak").hide();$('.page-info').pageInfo("refresh");caInfoList.getTeacherListInfo()}else{$yt_alert_Model.prompt("添加教师失败")}}})},deleteTeacher:function(pkId){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/teacher/deleteTeachers",async:false,data:{projectCode:projectCode,pkId:pkId},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("移除教师成功");caInfoList.getTeacherListInfo()}else{$yt_alert_Model.prompt("移除教师失败")}}})},getTicket:function(){var projectCode=$yt_common.GetQueryString("projectCode");var teachersReseveArr=[];$(".teacher-ticket-div .ticket-teacher-tbody tr").each(function(i,n){var pkId=$(n).find('.teacher-pk-id').val();if(pkId=="0"){pkId=""}var teacherId=$(n).find('.teacher-id').val();var routeType=$(n).find('.route-type').val();var flightTrainNumber=$(n).find('.flight-train-number').val();var placeDeparture=$(n).find('.place-departure').val();var goOff=$(n).find('.go-off').val();var bourn=$(n).find('.bourn').val();var arrivalTime=$(n).find('.arrival-time').val();var fares=$(n).find('.fares').val();var changeFeeRefund=$(n).find('.change-fee-refund').val();var states=1;var teachersReseveList={pkId:pkId,teacherId:teacherId,routeType:routeType,types:1,flightTrainNumber:flightTrainNumber,placeDeparture:placeDeparture,goOff:goOff,bourn:bourn,arrivalTime:arrivalTime,fares:fares,changeFeeRefund:changeFeeRefund,states:states};teachersReseveArr.push(teachersReseveList)});console.log(teachersReseveArr);var teachersReseve=JSON.stringify(teachersReseveArr);console.log("订票数据",teachersReseve);$yt_baseElement.showLoading();$.ajax({url:$yt_option.base_path+"class/teacher/addTeachersReseve",type:"post",data:{projectCode:projectCode,teachersReseve:teachersReseve},success:function(data){if(data.flag==0){console.log(data);$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("订票成功")})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("订票失败")})}}})},getTicketList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({url:$yt_option.base_path+"class/teacher/getTeachersReseve",type:"post",data:{projectCode:projectCode},success:function(data){var rowspanNum=1;var lastOr;var teacherPhone;var routeType;if(data.flag==0){console.log(data);var teachersReseve=$.parseJSON(data.data.teachersReseve);var htmlTbody=$('.select-ticket-div .ticket-teacher-tbody');htmlTbody.empty();if(teachersReseve!=null){$.each(teachersReseve,function(i,v){if(v.routeType==1){routeType="来院"}else{routeType="返程"}var htmlTr='';htmlTr+='<tr>';if(teacherPhone!=v.teacherId){$('.select-ticket-div .ticket-teacher-tbody tr').eq(lastOr).find('td').eq(0).attr('rowspan',rowspanNum);$('.select-ticket-div .ticket-teacher-tbody tr').eq(lastOr).find('td').eq(1).attr('rowspan',rowspanNum);teacherPhone=v.teacherId;lastOr=i;htmlTr+='<td class="teacherName" style="text-align:left;">'+v.teacherName+'</td><td class="phone">'+v.phone+'</td>';rowspanNum=1}else{rowspanNum+=1}$('.select-ticket-div .ticket-teacher-tbody tr').eq(lastOr).find('td').eq(0).attr('rowspan',rowspanNum);$('.select-ticket-div .ticket-teacher-tbody tr').eq(lastOr).find('td').eq(1).attr('rowspan',rowspanNum);htmlTr+='<input type="hidden" class="teacher-id" value="'+v.teacherId+'" /><input type="hidden" class="teacher-pk-id" value="'+v.pkId+'" /><input type="hidden" class="teacher-phone" value="'+v.phone+'" /><td><input type="hidden" class="route-type" value="'+v.routeType+'" />'+routeType+'</td><td><input type="hidden" class="types" value="'+v.types+'" />订票</td><td><input type="text" class="yt-input flight-train-number" value="'+v.flightTrainNumber+'" /></td><td><input type="text" class="yt-input place-departure" value="'+v.placeDeparture+'" /></td><td><input class="calendar-input go-off" style="width: 140px;background-position: 130px 7px;" value="'+v.goOff+'" placeholder="请选择日期" type="text" /></td><td><input type="text" class="yt-input bourn" value="'+v.bourn+'" /></td><td><input class="calendar-input arrival-time" style="width: 140px;background-position: 130px 7px;" value="'+v.arrivalTime+'" placeholder="请选择日期" type="text" /></td><td><input type="number" style="text-align:right" class="yt-input fares" value="'+v.fares+'" /></td><td><input type="number" style="text-align:right" class="yt-input change-fee-refund" value="'+v.changeFeeRefund+'" /></td></tr>';htmlTbody.append(htmlTr)});$(".go-off").calendar({speed:200,dateFmt:"yyyy-MM-dd HH:mm",nowData:true,complement:true});$(".arrival-time").calendar({speed:200,dateFmt:"yyyy-MM-dd HH:mm",nowData:true,complement:true});$.each(teachersReseve,function(i,v){$(".go-off").eq(i).val(v.goOff);$(".arrival-time").eq(i).val(v.arrivalTime)});$yt_alert_Model.setFiexBoxHeight($(".select-ticket-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-ticket-div"));$yt_baseElement.hideLoading()}else{htmlTr='<tr><td colspan="11" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr);$yt_alert_Model.setFiexBoxHeight($(".select-ticket-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-ticket-div"));$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("请先选择教师")})}}else{var htmlTr='';htmlTr='<tr><td colspan="11" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}}})}};var courseManager={init:function(){var me=this;$(".course-date").calendar({controlId:"courseDate",speed:200,complement:true,readonly:true,lowerLimit:"2010/01/01",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$("select.couse-type").change(function(){$(".add-course-box .couse-type1,.add-course-box .couse-type2,.add-course-box .couse-type3").hide();if($(this).val()=="openingCeremony"||$(this).val()=="windingUp"){$(".add-course-box .couse-type1").show()}else if($(this).val()=="teachingActivities"){$(".add-course-box .couse-type3").show()}else{$(".add-course-box .couse-type2").show()}});$(".add-couse-btn").click(function(){$(".sure-continue").show();$(".sure-continue").val("确定并继续");$(".add-course-box .yt-edit-alert-title-msg").text("新增课程");$("[name='giveType']:eq(0)").setRadioState("check");$(".add-course-box .start-time").timespinner('setValue',"08:30");$(".add-course-box .end-time").timespinner('setValue',"11:30");var openingCeremony=$("select.couse-type option:eq(0)").val();$(".couse-type").setSelectVal(openingCeremony);$(".couse-type2").hide();$(".couse-type1").show();$(".valid-font").text("");$(".select-file-btn").val("").removeData();$(".valid-hint").removeClass("valid-hint");$(".select-file-btn").css("visibility","visible");$(".upload-file-btn").css("visibility","hidden").prev().css("visibility","hidden");$("[name='fileType']:eq(0)").setRadioState("check");$("[name='isNeedGroupPhoto']:eq(0)").setRadioState("check");$(".upload-file-btn").val("").removeData("fileInfo");$("input[name='courseName']").val("");me.getTeacherList();$(".add-course-box").show();$yt_alert_Model.getDivPosition($(".add-course-box"));$yt_model_drag.modelDragEvent($(".add-course-box .yt-edit-alert-title"));$('.add-course-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".add-course-box").hide()});$(".add-course-box .sure-continue").off().on("click",function(){me.editCouseInfo();me.getCourseList();$("[name='giveType']:eq(0)").setRadioState("check");$(".add-course-box .start-time").timespinner('setValue',"08:30");$(".add-course-box .end-time").timespinner('setValue',"11:30");$("#courseName").val('');var openingCeremony=$("select.couse-type option:eq(0)").val();$(".couse-type").setSelectVal(openingCeremony);$(".couse-type2").hide();$(".couse-type1").show();$(".valid-font").text("");$(".select-file-btn").val("").removeData();$(".valid-hint").removeClass("valid-hint");$(".select-file-btn").css("visibility","visible");$(".upload-file-btn").css("visibility","hidden").prev().css("visibility","hidden");$("[name='fileType']:eq(0)").setRadioState("check");$("[name='isNeedGroupPhoto']:eq(0)").setRadioState("check")});$(".yt-model-bot-btn.sure-close").off().on('click',function(){me.editCouseInfo();me.getCourseList();if($("#courseName").val()!=''){$(".add-course-box").hide()}})});$(".upload-file-box").undelegate().delegate("input.upload-file-btn","change",function(){var addFile=$(this).attr("id");$yt_baseElement.showLoading();var url=$yt_option.acl_path+"api/tAscPortraitInfo/addFile?modelCode=couseFile";$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:addFile,success:function(data,textStatus){var resultData=$.parseJSON(data);if(resultData.success==0){$yt_baseElement.hideLoading(function(){$("#"+addFile).prev().val(resultData.obj.naming).data("fileInfo",resultData.obj);$yt_alert_Model.prompt("附件上传成功")})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传失败")})}},error:function(data,status,e){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传失败")})}})});$("input[name='fileType']").change(function(){$(this).parent().nextAll().css("visibility","visible");$(this).parents("table").find("input[name='fileType']:not(:checked)").parent().nextAll().css("visibility","hidden")});$(".add-course-box input[name='giveType']").change(function(){var startTime="";var endTime="";if($(this).val()=="1"){startTime="08:30";endTime="11:30"}else if($(this).val()=="2"){startTime="14:00";endTime="17:00"}else{startTime="18:00";endTime="21:00"}$(".add-course-box .start-time").timespinner('setValue',startTime);$(".add-course-box .end-time").timespinner('setValue',endTime)});$(".update-couse-btn").click(function(){if($("input[name='couseCheck']:checked").length!=1){$yt_alert_Model.prompt("请选择一条数据进行修改")}else{$(".sure-continue").hide();$('.add-course-box .yt-model-sure-btn').val("确定");$(".add-course-box .yt-edit-alert-title-msg").text("修改课程");var couseInfo=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");console.log(couseInfo);$("[name='giveType'][value='"+couseInfo.giveType+"']").setRadioState("check");var giveTime=couseInfo.courseTime;$(".add-course-box .start-time").timespinner('setValue',giveTime.split("-")[0]);$(".add-course-box .end-time").timespinner('setValue',giveTime.split("-")[1]);var openingCeremony=couseInfo.courseTypeCode;$(".couse-type").setSelectVal(openingCeremony);$(".add-course-box .couse-type1,.add-course-box .couse-type2,.add-course-box .couse-type3").hide();if(openingCeremony=="openingCeremony"||openingCeremony=="windingUp"){$(".add-course-box .couse-type1").show()}else if(openingCeremony=="teachingActivities"){$(".add-course-box .couse-type3").show()}else{$(".add-course-box .couse-type2").show()}$("input[name='courseName']").val(couseInfo.courseName);$(".valid-font").text("");$(".valid-hint").removeClass("valid-hint");var types=couseInfo.types;if(couseInfo.files!=""){var filesArr=$.parseJSON(couseInfo.files);$(".upload-file-btn").val("").removeData("fileInfo");$(".add-course-box [name='fileType']:eq(0)").setRadioState("check");$(".select-file-btn").css("visibility","visible").val("");$(".upload-file-btn").css("visibility","hidden").prev().css("visibility","hidden").val("");if(filesArr.length>0){$(".select-file-btn").val(filesArr[0].fileName).data("fileInfo",{pkId:filesArr[0].fileId,naming:filesArr[0].fileName})}}else{$(".add-course-box [name='fileType']:eq(0)").setRadioState("check");$(".select-file-btn").css("visibility","visible").val("");$(".upload-file-btn").css("visibility","hidden").prev().css("visibility","hidden").val("")}me.getTeacherList();$("select.teacher-list-selt").setSelectVal(couseInfo.teacherId);$(".add-course-box").show();$yt_alert_Model.getDivPosition($(".add-course-box"));$yt_model_drag.modelDragEvent($(".add-course-box .yt-edit-alert-title"));$('.add-course-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".add-course-box").hide()});$(".add-course-box .yt-model-sure-btn").off().on("click",function(){me.editCouseInfo(couseInfo.pkId)})}});$(".delete-couse-btn").click(function(){if($(".course-list-tbody input[type=checkbox]:checked").length!=1){$yt_alert_Model.prompt("请选择一条数据进行操作");return false}$yt_alert_Model.alertOne({leftBtnName:"确定",rightBtnName:"取消",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){var pkId=$(".course-list-tbody input[type=checkbox]:checked").parents('tr').data("couseInfo").pkId;me.deleteCouse(pkId)}})});$(".select-file-btn").click(function(){var oldBox=$(this).parents(".yt-pop-model");$yt_baseElement.showLoading();var teacherId="";if($(this).parents(".add-course-box").length==0){teacherId=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo").teacherId}else{teacherId=$(".add-course-box select[name='teacherId']").val()}$.ajax({type:"post",url:$yt_option.base_path+"class/course/getTeacherUploadFiles",async:true,data:{teacherId:teacherId},success:function(data){if(data.flag==0){var htmlTbody=$(".select-file-div tbody").empty();var htmlTr='';if(data.data.length>0){$.each(data.data,function(i,n){htmlTr=$('<tr><td>'+(i+1)+'</td><td>'+n.fileName+'</td></tr>').data("fileInfo",n);htmlTbody.append(htmlTr)});htmlTbody.find("tr").click(function(){$(this).addClass("yt-table-active").siblings().removeClass("yt-table-active")})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询教师附件失败")})}},error:function(data){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询教师附件失败")})}});oldBox.hide();$(".select-file-div").show();$yt_alert_Model.getDivPosition($(".select-file-div"));$yt_model_drag.modelDragEvent($(".select-file-div .yt-edit-alert-title"));$('.select-file-div .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".select-file-div").hide();oldBox.show()});$('.select-file-div .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){if($(".select-file-div tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择附件");return false}var fileInfo=$(".select-file-div tr.yt-table-active").data("fileInfo");oldBox.find(".select-file-btn").val(fileInfo.fileName).data("fileInfo",{pkId:fileInfo.fileId,naming:fileInfo.fileName});$(".select-file-div").hide();oldBox.show()})});$(".course-list-tbody").on('click','.file-name',function(){var fileUrl=$(this).attr("fileUrl");$.ajaxDownloadFile({url:fileUrl})});$(".couse-file-btn").click(function(){if($("input[name='couseCheck']:checked").length!=1){$yt_alert_Model.prompt("请选择一条数据进行修改")}else{var couseInfo=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");if(couseInfo.courseTypeCode!="openingCeremony"&&couseInfo.courseTypeCode!="windingUp"&&couseInfo.courseTypeCode!="teachingActivities"){$(".couse-file-box table tr:eq(0) td:eq(1)").text(couseInfo.teacherName);$(".couse-file-box table tr:eq(1) td:eq(1)").text(couseInfo.courseName);var types=couseInfo.types;var filesArr=$.parseJSON(couseInfo.files);if(filesArr!=null||filesArr!=""){if(true){$(".couse-file-box [name='fileType']:eq(0)").setRadioState("check");$(".select-file-btn").css("visibility","visible").val("");$(".upload-file-btn").css("visibility","hidden").prev().css("visibility","hidden").val("");if(filesArr&&filesArr.length>0){$(".select-file-btn").val(filesArr[0].fileName).data("fileInfo",{pkId:filesArr[0].fileId,naming:filesArr[0].fileName})}}else{$(".couse-file-box [name='fileType']:eq(1)").setRadioState("check");$(".select-file-btn").css("visibility","hidden").val("");$(".upload-file-btn").css("visibility","visible").prev().css("visibility","visible").val("");if(filesArr&&filesArr.length>0){$(".upload-file-btn").prev().val(filesArr[0].fileName).data("fileInfo",{pkId:filesArr[0].fileId,naming:filesArr[0].fileName})}}}$(".couse-file-box").show();$yt_alert_Model.getDivPosition($(".couse-file-box"));$yt_model_drag.modelDragEvent($(".couse-file-box .yt-edit-alert-title"));$('.couse-file-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".couse-file-box").hide()});$(".couse-file-box .yt-model-sure-btn").off().on("click",function(){me.uploadFiles()})}else{$yt_alert_Model.prompt("选择的课程类型不需要上传课件")}}});$(".select-room").click(function(){if($("input[name='couseCheck']:checked").length!=1){$yt_alert_Model.prompt("请选择一条数据进行修改")}else{$("select.address-type").niceSelect();me.getClassRooms();var couseInfo=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");$.ajax({type:"post",url:$yt_option.base_path+"class/course/getClassRoomConfig",async:true,data:{courseId:couseInfo.pkId},success:function(data){if(data.flag==0){$(".select-room-box").show();$yt_model_drag.modelDragEvent($(".select-room-box .yt-edit-alert-title"));$yt_alert_Model.setFiexBoxHeight($('.room-form'));if(data.data){$("select[name='courseType']").setSelectVal(data.data.courseType);if(data.data.courseType==1){$(".external-address").hide();$(".internal-address").show()}else{$(".internal-address").hide();$(".external-address").show();positionMap.ac.setInputValue(data.data.address);var longitude=parseFloat(data.data.longitude);var latitude=parseFloat(data.data.latitude);positionMap.mapObj.clearOverlays();var point=new BMap.Point(latitude,longitude);var myIcon=new BMap.Icon($yt_option.websit_path+"resources/images/img/blank.png",new BMap.Size(23,25),{offset:new BMap.Size(10,25),});positionMap.marker=new BMap.Marker(point,{icon:myIcon});positionMap.mapObj.addOverlay(positionMap.marker);positionMap.marker.enableDragging();setTimeout(function(){positionMap.mapObj.setCenter(point)},200);$(".external-address [name='placeSign'][value='"+data.data.placeSign+"']").setRadioState("check")}}$('.select-room-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".select-room-box").hide()});$(".select-room-box .yt-model-sure-btn").off().on("click",function(){var couseFile={};couseFile.courseType=$("select[name='courseType']").val();couseFile.projectCode=$yt_common.GetQueryString("projectCode");couseFile.courseId=couseInfo.pkId;if(couseFile.courseType==1){couseFile.placeSign=2;if($(".select-room-box tbody input[type='checkbox']:checked").length==0){$yt_alert_Model.prompt("请选择教室");return false}else{couseFile.classroomIds="";$(".select-room-box tbody input[type='checkbox']:checked").each(function(i,n){if(couseFile.classroomIds==""){couseFile.classroomIds=$(n).val()}else{couseFile.classroomIds+=","+$(n).val()}})}}else{couseFile.address=$("#suggestId").val();var optionInfo=positionMap.getPosition();if(optionInfo==null){$yt_alert_Model.prompt("请在地图中选择签到地点");return false}couseFile.longitude=optionInfo.lat;couseFile.latitude=optionInfo.lng;couseFile.placeSign=$(".select-room-box [name='placeSign']:checked").val()}$yt_baseElement.showLoading();$.ajax({type:"post",url:"class/course/updateClassRoom",data:couseFile,async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("上课地点修改成功");$(".select-room-box").hide();courseManager.getCourseList()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作失败，请稍后重试")})}},error:function(data){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("网络出现问题，请稍后重试")})}})})}},error:function(data){}})}});$('.print-couse').click(function(){$(".print-couse-form").show();var projectCode=$yt_common.GetQueryString("projectCode");var fileType=1;$('.print-couse-form tbody').empty();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/getPrinting",data:{projectCode:projectCode,fileType:fileType},async:true,success:function(data){if(data.flag==0){console.log(data.data);var htmlBody=$('.print-couse-form tbody');var htmlStr='';$.each(data.data,function(c,v){var states="";if(v.states==2){states='已完成'}else if(v.states==3){states='打印中'}else if(v.states==4){states='已作废'}else{states='未打印'}htmlStr='<tr class="print-tr"><td>';if(v.states==5){htmlStr+='<label class="check-label yt-checkbox" style="margin-left:12px;"><input class="print-check" type="checkbox" name="test" value="1"/></label>'}htmlStr+='</td><td class="curse-file-name" style="text-align:left;padding-left:5px;"><input type="hidden" class="curse-file-id" value="'+v.fileId+'"/>'+v.fileName+'</td><td style="text-align:left;padding-left:5px;">'+v.teacherName+'</td>';if(v.states!=5){htmlStr+='<td><input class="yt-input print-count " disabled="disabled" type="number" value="'+v.printerCount+'" /></td>'}else{htmlStr+='<td><input style="width:85px;text-align: right;" class="yt-input "  type="number" value="'+v.printerCount+'" /></td>'}htmlStr+='<td class="print-states">'+states+'</td><input type="hidden" class="curse-id" value="'+v.courseId+'"</tr>';htmlBody.append(htmlStr);});$yt_baseElement.hideLoading()}}});$yt_alert_Model.getDivPosition($(".print-couse-form"));$yt_model_drag.modelDragEvent($(".print-couse-form .yt-edit-alert-title"));$('.print-couse-form .yt-model-sure-btn').off().on('click',function(){var printData=[];var printList="";var printerCount="";var repeatNum="0";var checklength=$('.print-check:checked').length;$('.print-check:checked').parent().parent().parent().each(function(a,b){var fileId=$(b).find('.curse-file-id').val();var courseId=$(b).find('.curse-id').val();var fileName=$(b).find('.curse-file-name').text();if(printerCount==""){printerCount+=$(b).find('.yt-input').val()}else{printerCount+=","+$(b).find('.yt-input').val()}var printerCounts=$(b).find('.yt-input').val();var states=$(b).find('.print-states').text();if(states=="未打印"){printList={projectCode:projectCode,courseId:courseId,fileId:fileId,fileName:fileName,printerCount:printerCounts,fileType:1,states:3};printData.push(printList)}});console.log("printerCount",printerCount);var pringingData=JSON.stringify(printData);console.log(pringingData);if(checklength!=0){if(repeatNum.indexOf(printerCount)==-1){console.log("有打印数量");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/addPrinting",data:{pringingData:pringingData},async:true,success:function(data){if(data.flag==0){console.log("成功");$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交成功");$(".print-couse-form").hide()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交失败")})}}})}else{$yt_alert_Model.prompt("请填写打印数量")}}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("请选择需要打印的附件")})}});$('.print-couse-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".print-couse-form").hide();$("#pop-modle-alert").hide()})});$('.merge-score-couse').click(function(){var projectCode=$yt_common.GetQueryString("projectCode");var htmlBody=$('.merge-score-form tbody:eq(0)');var htmlHistory=$('.merge-score-form tbody:eq(1)');htmlBody.empty();htmlHistory.empty();$('.merge-couse-name').val("");var histCourseId='';$("input[name='couseCheck']:checked").parents("tr").each(function(c,d){var couseInfo=$(d).data("couseInfo");console.log(couseInfo);htmlStr='<tr class="print-tr"><input class="merge-course-id" type="hidden" value="'+couseInfo.pkId+'"/><td >'+couseInfo.courseDate+'</td><td style="text-align:center;">'+couseInfo.courseTime+'</td><td style="text-align:center;">'+couseInfo.courseTypeName+'</td><td style="text-align:center;">'+couseInfo.teacherName+'</td><td style="text-align:center;">'+couseInfo.courseName+'</td></tr>';htmlBody.append(htmlStr)});$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/getCourseMerge",data:{projectCode:projectCode},async:true,success:function(data){var rowNmu=1;var mergeTitle;var lastNum;if(data.flag==0){$yt_baseElement.hideLoading();console.log("查询历史记录成功",data.data);$.each(data.data,function(g,h){var htmlStr='';if(histCourseId==""){histCourseId+=h.pkId}else{histCourseId+=","+h.pkId}htmlStr+='<tr><input class="" type="hidden" value="'+h.pkId+'"/><input class="course-merge-code" type="hidden" value="'+h.mergeCode+'"/><td >'+h.courseDate+'</td><td style="text-align:center;">'+h.courseTime+'</td><td style="text-align:center;">'+h.courseTypeName+'</td><td style="text-align:center;">'+h.teacherName+'</td><td style="text-align:center;">'+h.courseName+'</td>';if(mergeTitle!=h.mergeTitle){$('.merge-record tbody tr').eq(lastNum).find('td').eq(5).attr('rowspan',rowNmu);$('.merge-record tbody tr').eq(lastNum).find('td').eq(6).attr('rowspan',rowNmu);mergeTitle=h.mergeTitle;lastNum=g;rowNmu=1;htmlStr+='<td rowspan="" style="text-align:center;">'+h.mergeTitle+'</td><td class="cancel-merge-btn">取消合并</td>'}else{rowNmu+=1}$('.merge-record tbody tr').eq(lastNum).find('td').eq(5).attr('rowspan',rowNmu);$('.merge-record tbody tr').eq(lastNum).find('td').eq(6).attr('rowspan',rowNmu);htmlStr+='</tr>';htmlHistory.append(htmlStr)})}}});$(".merge-score-form").show();$yt_alert_Model.getDivPosition($(".merge-score-form"));$yt_model_drag.modelDragEvent($(".merge-score-form .yt-edit-alert-title"));$('.merge-score-form .yt-model-sure-btn:eq(0)').off().on('click',function(){var mergeCourseId="";var tipCourseName="";$('.merge-course-id').each(function(){var checkCourseId=$(this).val();if(mergeCourseId==""){mergeCourseId+=checkCourseId}else{mergeCourseId+=','+checkCourseId}if(histCourseId.indexOf(checkCourseId)!=-1){if(tipCourseName==""){tipCourseName+=$(this).parent().find('td:eq(4)').text()}else{tipCourseName+=","+$(this).parent().find('td:eq(4)').text()}}});var courseName=$('.merge-couse-name').val();if(tipCourseName==""){if($('.merge-course-id').length>1){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/updateCourseMerge",data:{mergeCourseId:mergeCourseId,courseName:courseName,projectCode:projectCode},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("合并成功")});$(".merge-score-form").hide()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("合并失败")})}}})}else{$yt_alert_Model.prompt("请选择至少两行数据")}}else{$yt_baseElement.hideLoading();var msg='';var couseArray=tipCourseName.split(',');for(var i=0;i<couseArray.length;i+=1){msg+='《'+couseArray[i]+'》课程已合并,请重新选择</br>'}$('.merge-score-form').hide();$yt_alert_Model.alertOne({haveCloseIcon:false,leftBtnName:"取消",alertMsg:msg,cancelFunction:function(){$('.merge-score-form').show()}})}});$('.merge-score-form').off().on('click','.cancel-merge-btn',function(){var courseIds=$(this).parent().find('input:eq(0)').val();var projectCode=$yt_common.GetQueryString("projectCode");var mergeCode=$(this).parent().find('.course-merge-code').val();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/updateCancelCourseMerge",data:{mergeCode:mergeCode,courseId:courseIds,projectCode:projectCode},async:true,success:function(data){if(data.flag==0){$yt_alert_Model.prompt("取消合并成功");$(this).parent().remove();$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("取消合并失败");$yt_baseElement.hideLoading()}}})});$('.merge-score-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".merge-score-form").hide();$("#pop-modle-alert").hide()})});$('.apply-car-couse').click(function(){$('.apply-car-form .course-type').text("");$('.apply-car-form .course-time').text("");$('.apply-car-form .course-theme').text("");$('.apply-car-form .course-teacher').text("");$('.bus-num').val("");$('.course-place').val("");var couseInfo=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");console.log(couseInfo);var couseInfoLength=$("input[name='couseCheck']:checked").parents("tr").length;console.log("couseInfo",couseInfoLength+couseInfo);if(couseInfoLength==1&&couseInfo!=null){$('.apply-car-form .course-type').text(couseInfo.courseTypeName);$('.apply-car-form .course-time').text(couseInfo.courseDate+' '+couseInfo.courseTime);$('.apply-car-form .course-theme').text(couseInfo.courseTypeName);$('.apply-car-form .course-teacher').text(couseInfo.courseTypeName)}courseManager.getApplyCarList();var user='';var dataObj='';$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"courseCar",processInstanceId:"",parameters:"",versionNum:""},async:true,success:function(data){if(data.flag==0){console.log(data.data);$.each(data.data,function(i,n){console.log(n);console.log(i);for(var k in n){console.log('k',k);console.log("n[k]",n[k]);user=n[k][0].userCode;console.log(user);dataObj=eval("("+k+")");console.log(dataObj);console.log(dataObj.nextCode)}})}}});$(".apply-car-form .yt-model-sure-btn").off().on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var userCount=$('.bus-num').val();var address=$('.course-place').val();if(couseInfoLength==1&&couseInfo!=null){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/addCourseUseCar",data:{projectCode:projectCode,courseId:couseInfo.pkId,userCount:userCount,address:address,businessCode:"courseCar",dealingWithPeople:user,opintion:"",processInstanceId:"",nextCode:dataObj.nextCode},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$('.bus-num').val("");$('.course-place').val("");$yt_alert_Model.prompt("新增用车成功");courseManager.getApplyCarList()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("新增用车失败")})}}})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("请选中一行数据进行新增")})}});$('.apply-car-form').on('click','.cancel-car',function(){});$(".apply-car-form").show();$yt_alert_Model.setFiexBoxHeight($('.apply-car-form .yt-edit-alert-main'));$yt_alert_Model.getDivPosition($(".apply-car-form"));$yt_model_drag.modelDragEvent($(".apply-car-form .yt-edit-alert-title"));$('.apply-car-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".apply-car-form").hide();$("#pop-modle-alert").hide()})});$(".address-type").change(function(){if($(this).val()=="1"){$(".external-address").hide();$(".internal-address").show()}else{$(".internal-address").hide();$(".external-address").show()}$yt_alert_Model.setFiexBoxHeight($(".select-room-box .yt-edit-alert-main"))});$(".select-room-box .key-word .search-btn").click(function(){me.getClassRooms()})},getApplyCarList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/getClassCourseCarList",data:{projectCode:projectCode},async:true,success:function(data){if(data.flag==0){var htmlBody=$('.apply-car-form table:eq(1) tbody');htmlBody.empty();var htmlStr='';$.each(data.data,function(j,k){if(k.sendCarType==1){k.sendCarType="派车中"}else{k.sendCarType="已派车"}htmlStr='<tr><input class="apply-course-id" type="hidden" value="'+k.courseId+'"/><td>'+k.courseTypeName+'</td><td>'+k.courseDate+'</td><td style="text-align:left;"><a style="color:#3c4687;" class=" course-name">'+k.courseName+'</a></td><td style="text-align:right;padding-right:65px;">'+k.userCount+'</td><td style="text-align:left;padding-left:5px;">'+k.address+'</td><td>'+k.sendCarType+'</td></tr>';htmlBody.append(htmlStr)});$yt_baseElement.hideLoading()}}})},getCourseList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({async:true,url:$yt_option.base_path+"class/course/lookForAll",type:"post",data:{projectCode:projectCode},success:function(data){if(data.flag==0){var htmlTbody=$('.course-list-tbody').empty();var htmlTr='';if(data.data.rows.length>0){var rowSpanNum=1;var rowSpanStr='';var lastTr;$.each(data.data.rows,function(i,n){var fileName='';var fileUrl='';if(n.files!=''&&$.parseJSON(n.files).length>0){fileUrl=$.parseJSON(n.files)[0].fileUrl;fileName='<span style="color:#3c4687;" class="file-name" fileUrl="'+fileUrl+'">'+$.parseJSON(n.files)[0].fileName+'</span>'}htmlTr='<tr>';if(rowSpanStr!=n.courseDate){$('.course-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan",rowSpanNum);lastTr=i;rowSpanStr=n.courseDate;htmlTr+='<td class="bgn-tr">'+n.courseDate+'</td>';rowSpanNum=1}else{rowSpanNum+=1}htmlTr+='<td> <label class="check-label yt-checkbox"><input type="checkbox" name="couseCheck" value="1"/>'+n.courseTime+'</label><div class="checkbox-top"></div></td><td>'+(n.courseTypeCode=='teachingActivities'?n.courseTypeDetails:n.courseTypeName)+'</td><td style="text-align:left;">'+n.teacherName+'</td><td style="text-align:left;">'+n.courseName+'</td><td style="text-align:left;">'+fileName+'</td><td style="text-align:left;"><input class="class-room-ids" type="hidden" value="'+n.classroomIds+'"/>'+(n.classroomNames==""?n.address:n.classroomNames)+'</td></tr>';htmlTr=$(htmlTr).data("couseInfo",n);htmlTbody.append(htmlTr)});$('.course-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan",rowSpanNum);$(".course-list-tbody tr").unbind().bind("click",function(){if($(this).find("input[type='checkbox']")[0].checked==true){$(this).find("input[type='checkbox']").setCheckBoxState("uncheck");$(this).find("td:not(.bgn-tr)").removeClass("yt-table-active")}else{$(this).find("input[type='checkbox']").setCheckBoxState("check");$(this).find("td:not(.bgn-tr)").addClass("yt-table-active")}})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},getTeacherList:function(){$("select.teacher-list-selt").empty();var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/teacher/lookForAll",async:false,data:{searchParameters:'',projectCode:projectCode,pageIndexs:1,pageNum:10000},success:function(data){if(data.flag==0){$("select.teacher-list-selt").append('<option value="">请选择</option>');$.each(data.data.rows,function(i,n){$("select.teacher-list-selt").append('<option value="'+n.pkId+'">'+n.realName+'</option>')});$("select.teacher-list-selt").niceSelect()}},error:function(data){}})},getCourseType:function(){$.ajax({type:"post",url:"class/course/getCourseType",data:{courseTypeName:""},async:false,success:function(data){if(data.flag==0){$("select.couse-type").empty();$.each(data.data,function(i,n){$("select.couse-type").append('<option value="'+n.courseTypeCode+'">'+n.courseTypeName+'</option>')})}else{$yt_alert_Model.prompt("课程类型查询失败")}},error:function(data){$yt_alert_Model.prompt("课程类型查询失败")}});$("select.couse-type").niceSelect()},deleteCouse:function(pkId){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/course/deleteCourse",data:{pkId:pkId},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("课程删除成功");courseManager.getCourseList()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("课程删除失败")})}},error:function(data){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("课程删除失败")})}})},editCouseInfo:function(pkId){var postState=true;var courseTypeCode=$(".couse-type").val();var formData={};var projectCode=$yt_common.GetQueryString("projectCode");if(courseTypeCode=="openingCeremony"||courseTypeCode=="windingUp"){if($yt_valid.validFont($(".add-course-box input[name='courseName']"))){var formData=$(".add-course-box").getDatas();formData.projectCode=projectCode;formData.giveType=$(".add-course-box [name='giveType']:checked").val();formData.isNeedGroupPhoto=$(".add-course-box [name='isNeedGroupPhoto']:checked").val()}else{postState=false}}else if(courseTypeCode=="teachingActivities"){if($yt_valid.validFont($(".add-course-box input[name='courseName']"))){var formData=$(".add-course-box").getDatas();formData.projectCode=projectCode;formData.giveType=$(".add-course-box [name='giveType']:checked").val();formData.courseTypeDetails=$(".add-course-box [name='courseTypeDetails']").val()}else{postState=false}}else{if($yt_valid.validFont($(".add-course-box input[name='courseName']"))){var formData=$(".add-course-box").getDatas();formData.projectCode=projectCode;formData.giveType=$(".add-course-box [name='giveType']:checked").val();formData.teacherId=$(".add-course-box [name='teacherId']").val();formData.types=$(".add-course-box [name='fileType']:checked").val();if($(".add-course-box [name='fileType']:checked").parent().next().data("fileInfo")){var fileId=$(".add-course-box [name='fileType']:checked").parent().next().data("fileInfo").pkId;var fileName=$(".add-course-box [name='fileType']:checked").parent().next().data("fileInfo").naming;formData.files=JSON.stringify([{fileId:fileId,fileName:fileName,fileTypes:2}])}}else{postState=false}}if(postState){if(pkId){formData.pkId=pkId}$yt_baseElement.showLoading();$.ajax({type:"post",url:"class/course/addOrUpdateCourse",async:true,data:formData,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作成功");courseManager.getCourseList()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作失败")})}},error:function(data){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作失败")})}})}},uploadFiles:function(){var couseInfo=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");var projectCode=$yt_common.GetQueryString("projectCode");var teacherId=couseInfo.teacherId;var pkId=couseInfo.pkId;var fileId=$(".couse-file-box input[name='fileType']:checked").parent().next().data("fileInfo").pkId;var fileName=$(".couse-file-box input[name='fileType']:checked").parent().next().data("fileInfo").naming;var types=$(".couse-file-box input[name='fileType']:checked").val();var files=JSON.stringify([{fileId:fileId,fileName:fileName,types:types,fileTypes:2}]);$yt_baseElement.showLoading();$.ajax({type:"post",url:"class/course/uploadFiles",data:{projectCode:projectCode,teacherId:teacherId,files:files,pkId:pkId},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传成功");courseManager.getCourseList();$(".couse-file-box").hide()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作异常")})}},error:function(data){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("网络出现异常，请稍后重试")})}})},getClassRooms:function(){var courseDate=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo");var classroomIds=courseDate.classsroomIds;console.log(classroomIds);var projectCode=$yt_common.GetQueryString("projectCode");var classroomName=$(".select-room-box .key-word input").val();$(".rooms-page").pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/course/getClassRooms",type:"post",data:{classroomName:classroomName,projectCode:projectCode},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.rooms-tbody').empty();var htmlTr='';var courseDate=$("input[name='couseCheck']:checked").parents("tr").data("couseInfo").courseDate;var weekList=ytDate.startStop(courseDate);$(".sun-head").nextAll().remove();$(".sun-head").remove();var th='';var day=0;var className='';$.each(weekList,function(i,n){day=new Date(n).getDate();if(i==0){className='sun-head'}else if(i==6){className='sat-head'}else{className=''}th='<th width="18px" class="state-day '+className+'" currentDay="'+n+'">'+day+'</th>';$(".select-room-box table thead tr").append(th)});var arrIndex=0;var stateObj=null;if(data.data.rows.length>0){var stateDay='<td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td><td class="state-day"></td>';$.each(data.data.rows,function(i,n){htmlTr='<tr><td rowspan="3" class="tc"><label class="check-label yt-checkbox"><input class="check-box"  type="checkbox" value="'+n.pkId+'"/></label></td><td rowspan="3" class="room-name"><span>'+n.classroomName+'</span></td><td rowspan="3">'+n.types+'</td><td rowspan="3" class="tr">'+n.galleryful+'</td><td>上午</td>'+stateDay+'</tr><tr><td>下午</td>'+stateDay+'</tr><tr><td>晚上</td>'+stateDay+'</tr>';htmlTr=$(htmlTr).data("roomInfo",n);$.each(n.classroomStates,function(j,m){arrIndex=$.inArray(m.classroomDate,weekList);if(arrIndex!=-1){stateObj=htmlTr.eq(parseInt(m.dataType)-1).find(".state-day").eq(arrIndex).data("arrIndex",arrIndex);stateObj.addClass(m.classroomStates==0?"all-use":"sub-use")}});htmlTbody.append(htmlTr)});$(".rooms-tbody .state-day").each(function(i,n){if($(n).hasClass("all-use")||$(n).hasClass("sub-use")){if(i%7==0){$(n).addClass("start-state")}else if((i+1)%7==0){$(n).addClass("end-state")}else{var lastDay=$(".rooms-tbody .state-day").eq(i-1);var nextDay=$(".rooms-tbody .state-day").eq(i+1);if(!lastDay.hasClass("all-use")&&!lastDay.hasClass("sub-use")){$(n).addClass("start-state")}if(!nextDay.hasClass("all-use")&&!nextDay.hasClass("sub-use")){$(n).addClass("end-state")}}}})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading();$('.room-name span').tooltip({position:'right',content:function(){var roomInfo=$(this).parent().parent().data("roomInfo");roomInfo.infrastructure=roomInfo.infrastructure.replace("1","白板").replace("2","投影").replace("3","扩音器").replace("4",roomInfo.infrastructureOther);var showBox='<table class="tip-table"><tr><td class="tip-lable">教室序号：</td><td>A303</td></tr><tr><td class="tip-lable">类型：</td><td>'+roomInfo.types+'</td></tr><tr><td class="tip-lable">可容纳人数：</td><td>'+roomInfo.galleryful+'人</td></tr><tr><td class="tip-lable">基础设施：</td><td>'+roomInfo.infrastructure+'</td></tr><tr><td class="tip-lable">备注：</td><td>'+roomInfo.remarks+'</td></tr></table>';return showBox},onShow:function(){$(this).tooltip('tip').css({backgroundColor:'#666',borderColor:'#666'})}});$yt_alert_Model.setFiexBoxHeight($(".select-room-box .yt-edit-alert-main"))}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}$yt_alert_Model.getDivPosition($(".select-room-box"))}})}};var studentList={init:function(){var traineeId;$('.org-type').niceSelect();var studentNationList=studentList.getStudentNationList();if(studentNationList!=""){$.each(studentNationList,function(i,w){$('.class-student-stration-form .student-nation').append('<option value="'+w.nationId+'">'+w.nationName+'</option>')});$('.class-student-stration-form .student-nation').niceSelect()}var studentGroupList=studentList.getStudentGroupList();if(studentGroupList!=""){$.each(studentGroupList,function(i,q){$('.class-student-stration-form select.group-id-elementary').append('<option value="'+q.groupId+'">'+q.groupName+'</option>')});$('.class-student-stration-form select.group-id-elementary').niceSelect()}$('.class-student-stration-form select.group-id-elementary').change(function(){groupId=$(this).val();var companyList=studentList.getStudentCompanyList(groupId);if(companyList!=""){$('.class-student-stration-form select.org-id').empty();$('.class-student-stration-form select.org-id').append(' <option value="">请选择</option>');$.each(companyList,function(i,o){if(i!=0){$('.class-student-stration-form select.org-id').append(' <option value="'+o.groupId+'">'+o.groupName+'</option>').data('types',o.types)}});$('.class-student-stration-form select.org-id').niceSelect();$('.class-student-stration-form .orgType').text('');$(".class-student-stration-form select.org-id").off().change(function(){if($(this).val()!=''){$("div.org-id").removeClass('valid-hint');$(this).siblings('.valid-font').text('')}$('.class-student-stration-form .orgType').text($(this).data('types'))})}else{$('.class-student-stration-form select.org-id').empty();$('.class-student-stration-form select.org-id').append(' <option value="">请选择</option>');$('.class-student-stration-form select.org-id').niceSelect()}});$('.box-list').on('click','.real-name-inf',function(){var traineeId=$(this).prev().val();var headImg=new Image();var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeDetails",data:{traineeId:traineeId,projectId:projectCode},async:true,success:function(data){var htmlBody=$('.student-details-form .student-details-train-record tbody');var htmlTrs='';htmlBody.empty();if(data.flag==0){detailsMsg=data.data;if(data.data.idType==1){$(".id-type").text("身份证")}else if(data.data.idType==2){$(".id-type").text("护照")}else if(data.data.idType==3){$(".id-type").text("军官证")}else if(data.data.idType==4){$(".id-type").text("其他")}detailsMsg.checkInDate=detailsMsg.checkInDate.split(" ")[0];if(detailsMsg.gender==1){detailsMsg.gender="男"}else{detailsMsg.gender="女"}if(detailsMsg.invoiceType==0){detailsMsg.invoiceType="暂不开票"}else if(detailsMsg.invoiceType==1){detailsMsg.invoiceType="普通发票"}else{detailsMsg.invoiceType="增值税发票"}if(detailsMsg.checkInState==0){detailsMsg.checkInState="未报到"}else{detailsMsg.checkInState="已报到"}if(detailsMsg.paymentState==0){detailsMsg.paymentState="未对账"}else{detailsMsg.paymentState="已对账"}if(detailsMsg.isOrderNum==0){detailsMsg.isOrderNum="未开票"}else{detailsMsg.isOrderNum="已开票"}$('.student-details-form .cont-edit-test').setDatas(detailsMsg);console.log("学员头像",detailsMsg.headPortraitUrl);if(detailsMsg.headPortrait!=""){headImg.src=detailsMsg.headPortraitUrl;headImg.onload=function(){$('.student-details-img').attr('src',headImg.src);$('.student-details-img').jqthumb({width:89,height:130})}}else{$('.student-details-img').attr('src','../../resources/images/classStudent/student-picture.png');$('.student-details-img').jqthumb({width:89,height:130})}$.each(detailsMsg.trainList,function(i,b){if(b.datatates==6||b.datatates==4){b.projectCode=b.projectCode}else{b.projectCode=""}htmlTrs='<tr><td style="text-align: center;">'+b.projectCode+'</td><td style="text-align: left;">'+b.projectName+'</td><td style="text-align: center;">'+b.startDate+'</td><td>'+b.projectHead+'</td><td>'+b.certificateNo+'</td></tr>';htmlBody.append(htmlTrs)});$yt_baseElement.hideLoading()}}});$(".student-details-form").show();$yt_alert_Model.setFiexBoxHeight($(".student-details-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".student-details-form"));$yt_model_drag.modelDragEvent($(".student-details-form .yt-edit-alert-title"));$('.student-details-form .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){$(".student-details-form").hide()})});$('.class-set-committee-btn').off('click').on('click',function(){if($('.student-div tbody label input[type="checkbox"]:checked').length==1){var committee='';var committeeList=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList');console.log(committeeList);var committeeName=committeeList.realName;$('.class-student-set-committee-from .need-set-group').text(committeeName);$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeCommittee",data:{committee:committee},async:true,success:function(data){var htmlBody=$('.class-student-set-committee-from .set-group-lable');var htmlTr='';htmlBody.empty();if(data.flag==0){$.each(data.data,function(i,v){htmlTr='<label class="check-label yt-radio "><input  type="radio" name="test"  value="'+v.classCommitteeId+'"/>'+v.classCommitteeName+'</label>';htmlBody.append(htmlTr)});if(committeeList.classCommitteeId==0){committeeList.classCommitteeId=4}$('.class-student-set-committee-from label').find('input[value="'+committeeList.classCommitteeId+'"]').setRadioState("check")}}});$(".class-student-set-committee-from").show();$yt_alert_Model.getDivPosition($(".class-student-set-committee-from"));$yt_model_drag.modelDragEvent($(".class-student-set-committee-from .yt-edit-alert-title"));$('.class-student-set-committee-from .yt-model-sure-btn').off('click').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var traineeId=committeeList.traineeId;var classCommitteeId=$('.class-student-set-committee-from .set-group-lable input[name="test"]:checked').val();console.log(classCommitteeId);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/updateTraineeCommittee",data:{projectCode:projectCode,traineeId:traineeId,classCommitteeId:classCommitteeId},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("设置班委成功");$(".class-student-set-committee-from").hide();studentList.getStudentList();studentList.getDifferentList()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("设置班委失败")})}}})});$('.class-student-set-committee-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-set-committee-from").hide()})}else{$yt_alert_Model.prompt("请勾选一条设置班委")}});$('.class-set-group-post-btn').on('click',function(){if($('.student-div tbody label input[type="checkbox"]:checked').length==1){$(".class-student-set-group-post-from").show();var setName=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').realName;var groupPosition=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').groupPositionType;var groupPositionData=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').groupPositionData;$('.class-student-set-group-post-from .set-group-lable input[name="test"][value="'+groupPosition+'"]').setRadioState("check");if(groupPosition==3){$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').show();$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').val(groupPositionData)}else{$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').hide()}$('.class-student-set-group-post-from .need-set-group').text(setName);var setRadioVal=$('.class-student-set-group-post-from .set-group-lable input[name="test"]');var groupPositionType;setRadioVal.change(function(){groupPositionType=$(this).val();if($(this).val()==1||$(this).val()==2){$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').hide()}else{$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').val("");$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').show()}});$yt_alert_Model.getDivPosition($(".class-student-set-group-post-from"));$yt_model_drag.modelDragEvent($(".class-student-set-group-post-from .yt-edit-alert-title"));$('.class-student-set-group-post-from .yt-model-sure-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var traineeId=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').traineeId;var groupPositionData=$('.class-student-set-group-post-from .set-group-custom-input').val();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/updateTraineeGroupPosition",data:{projectCode:projectCode,traineeId:traineeId,groupPositionType:groupPositionType,groupPositionData:groupPositionData},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("分组职务设置成功");$(".class-student-set-group-post-from").hide()});studentList.getStudentList();studentList.getDifferentList()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("分组职务设置失败")})}}})});$('.class-student-set-group-post-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-set-group-post-from").hide()})}else{$yt_alert_Model.prompt("请勾选一行数据添加职务")}});$('.class-set-group-btn').on('click',function(){$('.class-student-set-group-from .set-group-num').val("");var traineeIds='';var traineeNames='';if($('.student-div tbody label input[type="checkbox"]:checked').length!=0){$('.class-student-set-group-from .set-group-selected-length').text($('.student-div tbody label input[type="checkbox"]:checked').length);$('.student-div tbody label input[type="checkbox"]:checked').each(function(){if(traineeIds==''){traineeIds+=$(this).parent().parent().parent().data('studentList').traineeId;traineeNames+=$(this).parent().parent().parent().data('studentList').realName}else{traineeIds+=', '+$(this).parent().parent().parent().data('studentList').traineeId;traineeNames+=', '+$(this).parent().parent().parent().data('studentList').realName}});console.log(traineeNames);console.log(traineeIds);$('.class-student-set-group-from .set-group-list').text(traineeNames);$(".class-student-set-group-from").show();$yt_alert_Model.getDivPosition($(".class-student-set-group-from"));$yt_model_drag.modelDragEvent($(".class-student-set-group-from .yt-edit-alert-title"));$('.class-student-set-group-from .yt-model-sure-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var groupNum=$('.class-student-set-group-from .set-group-num').val();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/updateTraineeGroup",data:{projectCode:projectCode,groupNum:groupNum,traineeIds:traineeIds},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("分组设置成功");$(".class-student-set-group-from").hide()});studentList.getStudentList();studentList.getDifferentList()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("分组设置失败")})}}})});$('.class-student-set-group-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-set-group-from").hide()})}else{$yt_alert_Model.prompt("请勾选数据进行分组")}});$('.class-reserve-room-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam="";var gender="";var phone="";var groupId="";var orgId="";var deptPosition="";var isFirstTraining="";var classCommitteeId="";var signUpState="";var checkInState="";var sort="";var orderType="";$('.class-reserve-room-from .page-info').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/trainee/getClassTrainee",type:"post",data:{projectCode:projectCode,selectParam:selectParam,gender:gender,phone:phone,groupId:groupId,orgId:orgId,deptPosition:deptPosition,isFirstTraining:isFirstTraining,classCommitteeId:classCommitteeId,signUpState:signUpState,checkInState:checkInState,sort:sort,orderType:orderType},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.class-reserve-room-from .list-tbody');var htmlTr='';$(htmlTbody).empty();if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}htmlTr='<tr><input type="hidden" class="reserve-room-trainee-id" value="'+v.traineeId+'"/><td style="text-align: left;padding-left: 20px;">'+v.realName+'</td><td style="text-align: center;">'+v.gender+'</td><td style="text-align: center;">'+v.phone+'</td><td>'+v.orgName+'</td><td>'+v.deptName+'</td><td><input class="yt-input room-number" value="'+v.roomNumber+'"/></td></tr>';htmlTr=$(htmlTr).data('reserveList',v);htmlTbody.append(htmlTr)})}else{htmlTr='<tr class="class-tr"><td colspan="6" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true });$(".class-reserve-room-from").show();$yt_alert_Model.setFiexBoxHeight($(".class-reserve-room-from .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".class-reserve-room-from"));$yt_model_drag.modelDragEvent($(".class-reserve-room-from .yt-edit-alert-title"));$('.class-reserve-room-from .yt-model-sure-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var list=[];$('.class-reserve-room-from .list-tbody .room-number').each(function(){if($(this).val()!=""){var traineeId=$(this).parent().parent().find('.reserve-room-trainee-id').val();var roomNumber=$(this).val();var traineeName=$(this).parent().parent().find('td').eq(0).text();var reserveList={traineeId:traineeId,traineeName:traineeName,roomNumber:roomNumber};list.push(reserveList)}});console.log(list);var traineeIdRoomNumber=JSON.stringify(list);console.log(traineeIdRoomNumber);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/updateTraineeRoomNumber",data:{projectCode:projectCode,traineeIdRoomNumber:traineeIdRoomNumber},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("预定成功")})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("预定失败")})}}})});$('.class-reserve-room-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-reserve-room-from").hide()})});$('.batch-import-form .download-template').click(function(){var fileName="学员列表";$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/downloadTraineeByClass",data:{fileName:fileName}})});$('.batch-import-form .yt-model-sure-btn').off().on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var file=$('.batch-import-form .import-file-name').val();var url=$yt_option.base_path+"class/trainee/leadingTraineeByClass";$yt_baseElement.showLoading();$.ajaxFileUpload({type:"post",url:url,data:{projectCode:projectCode},dataType:'json',fileElementId:'fileName',success:function(data,textStatus){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("导入成功")})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("导入失败")})}},error:function(data,status,e){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("导入文件失败了")})}})});$(".batch-import-form").undelegate().delegate("input[type='file']","change",function(){console.log($(this)[0].files[0].name);$('.batch-import-form .import-file-name').val($(this)[0].files[0].name);});$('.student-import-btn').on('click',function(){$(".batch-import-form").show();$yt_alert_Model.getDivPosition($(".batch-import-form"));$yt_model_drag.modelDragEvent($(".batch-import-form .yt-edit-alert-title"));$('.batch-import-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".batch-import-form").hide();$("#pop-modle-alert").hide()})});$('.student-upload-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var exportName=$('.project-name:eq(0)').text()+"学员列表.xls";var gender="";var phone="";var groupId="";var orgId="";var deptPosition="";var isFirstTraining="";var classCommitteeId="";var signUpState="";$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/exportTraineeByClass",data:{projectCode:projectCode,exportName:exportName,gender:gender,phone:phone,groupId:groupId,orgId:orgId,deptPosition:deptPosition,isFirstTraining:isFirstTraining,classCommitteeId:classCommitteeId,signUpState:signUpState}})});$('.student-delete-btn').on('click',function(){var traineeIds='';if($('.student-div label input[type="checkbox"]:checked').length!=0){$.each($('.student-div .student-list-tbody label input[type="checkbox"]:checked'),function(i,n){console.log($(n).parents('tr'));if(traineeIds==''){traineeIds+=$(n).parents('tr').data('studentList').traineeId}else{traineeIds+=','+$(n).parents('tr').data('studentList').traineeId}});console.log(traineeIds);var projectCode=$yt_common.GetQueryString("projectCode");$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"./resources/images/icons/x.png",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/deleteTrainee",data:{projectCode:projectCode,traineeIds:traineeIds},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除成功")});studentList.getStudentList();studentList.getDifferentList()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除失败")});studentList.getStudentList();studentList.getDifferentList()}}})}})}else{$yt_alert_Model.prompt("请勾选数据进行删除")}});var traineeId;$('.student-add-btn').on('click',function(){$('.class-student-phone').addClass('tip-input');$('.class-student-name').addClass('tip-input');traineeId="";$('.class-student-stration-form .yt-edit-alert-title-msg').text("新增学员");$(".valid-font").text("");$('.class-student-stration-form .class-student-name').val("");$('.class-student-stration-form .class-student-group-num').val("");;$('.class-student-stration-form .class-student-name').parent().nextAll().find('input[type="radio"][value="1"]').setRadioState("check");$('.class-student-stration-form .student-nation').setSelectVal("");$('.class-student-stration-form .class-student-phone').val("");$('.class-student-stration-form .card-type').setSelectVal("");$('.class-student-stration-form .id-number').val("");$('.class-student-stration-form .group-id-elementary').setSelectVal("");$('.class-student-stration-form .org-id').setSelectVal("");$('.class-student-stration-form .student-msg .dept-name').val("");var positionName="";$('.class-student-stration-form .student-link-man').val("");$('.class-student-stration-form .student-link-man-phone').val("");$('.class-student-stration-form .student-link-man-telephone').val("");$('.class-student-stration-form .student-link-man-fax').val("");$('.class-student-stration-form .student-link-man-email').val("");$('.class-student-stration-form .student-link-man-address-email').val("");$('.class-student-stration-form .date-birth').val();$('.class-student-stration-form .org-type').setSelectVal("");$('.class-student-stration-form .mailing-address').val("");$('.class-student-stration-form .postal-code').val("");$('.class-student-stration-form .class-student-fax').val("");$('.class-student-stration-form .party-date').val();$('.class-student-stration-form .education-time').val("");$('.class-student-stration-form .education-time-class').val("");$('.class-student-stration-form .service-time').val("");$('.class-student-stration-form .service-time-class').val("");$('.class-student-stration-form .telephone-project').val("");$('.class-student-stration-form .class-student-email').val("");$('.class-student-stration-form .work-time').val("");$(".class-student-stration-form").show();$yt_alert_Model.setFiexBoxHeight($(".class-student-stration-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".class-student-stration-form"));$yt_model_drag.modelDragEvent($(".class-student-stration-form .yt-edit-alert-title"));$('.class-student-stration-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-stration-form").hide();$("#pop-modle-alert").hide()})});$('.student-update-btn').on('click',function(){var studenList=$('.student-div .yt-table-active').data('studentList');console.log('studentList',studenList);if(studenList!=null){var studentDetailedMsg=studentList.getStudentDetailedMsg();console.log("studentDetailedMsg",studentDetailedMsg);$('.class-student-form .yt-edit-alert-title-msg').text("修改学员");traineeId=studentDetailedMsg.traineeId;$('.class-student-stration-form').setDatas(studentDetailedMsg);var gender=$('.class-student-stration-form .class-student-name').parent().nextAll().find('input[type="radio"][value="'+studentDetailedMsg.gender+'"]').setRadioState("check");$('.class-student-stration-form .student-nation').setSelectVal(studentDetailedMsg.nationId);$('.class-student-stration-form .card-type').setSelectVal(studentDetailedMsg.idType);$('.class-student-stration-form .group-id-elementary').setSelectVal(studentDetailedMsg.groupId);groupId=studentDetailedMsg.groupId;var companyList=studentReport.getCompanyList(groupId);if(companyList!=""){$('.class-student-stration-form select.org-id').empty();$('.class-student-stration-form select.org-id').append(' <option value="">请选择</option>');$.each(companyList,function(i,o){if(i!=0){$('.class-student-stration-form select.org-id').append(' <option value="'+o.groupId+'">'+o.groupName+'</option>').data('types',o.types)}});$('.class-student-stration-form select.org-id').niceSelect();$('.class-student-stration-form .orgType').text($('select.org-id').data('types'));$(".class-student-stration-form select.org-id").off().change(function(){if($(this).val()!=''){$("div.org-id").removeClass('valid-hint');$(this).siblings('.valid-font').text('')}$('.class-student-stration-form .orgType').text($(this).data('types'))})}else{$('.class-student-stration-form select.org-id').empty();$('.class-student-stration-form select.org-id').append(' <option value="">请选择</option>');$('.class-student-stration-form select.org-id').niceSelect()}$('.class-student-stration-form select.org-id').setSelectVal(studentDetailedMsg.groupOrgId);studentList.oldStudentDataMsg.gender==1?studentList.oldStudentDataMsg.genderVal='男':studentList.oldStudentDataMsg.genderVal='女';studentList.oldStudentDataMsg.nationName=$('.class-student-stration-form select.student-nation option:selected').text();studentList.oldStudentDataMsg.idTypeName=$('.class-student-stration-form select.card-type option:selected').text();$(".class-student-stration-form").show();$yt_alert_Model.setFiexBoxHeight($(".class-student-stration-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".class-student-stration-form"));$yt_model_drag.modelDragEvent($(".class-student-stration-form .yt-edit-alert-title"));$('.class-student-stration-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-stration-form").hide();$("#pop-modle-alert").hide()})}else{$yt_alert_Model.prompt("请选择一行进行修改")}});$(".class-student-stration-form .yt-model-sure-btn").off('click').on('click',function(){var afterJson={projectCode:$yt_common.GetQueryString("projectCode"),groupName:$('.class-student-stration-form select.group-id-elementary option:selected').text(),groupOrgName:$('.class-student-stration-form select.org-id option:selected').text(),nationName:$('.class-student-stration-form select.student-nation option:selected').text(),idTypeName:$('.class-student-stration-form select.card-type option:selected').text(),realName:$('.class-student-stration-form .class-student-name').val(),gender:$('.class-student-stration-form .class-student-name').parent().nextAll().find('input[type="radio"]:checked').val(),nationId:$('.class-student-stration-form .student-nation').val(),phone:$('.class-student-stration-form .class-student-phone').val(),idType:$('.class-student-stration-form .card-type').val(),idNumber:$('.class-student-stration-form .id-number').val(),groupId:$('.class-student-stration-form .group-id-elementary').val(),orgId:$('.class-student-stration-form .org-id').val(),deptName:$('.class-student-stration-form .student-msg .dept-name').val(),positionName:'',linkman:$('.class-student-stration-form .student-link-man').val(),linkmanPhone:$('.class-student-stration-form .student-link-man-phone').val(),linkmanTelephone:$('.class-student-stration-form .student-link-man-telephone').val(),linkmanFax:$('.class-student-stration-form .student-link-man-fax').val(),linkmanEmail:$('.class-student-stration-form .student-link-man-email').val(),linkmanAddressEmail:$('.class-student-stration-form .student-link-man-address-email').val(),dateBirth:$('.class-student-stration-form .date-birth').val(),orgType:$('.class-student-stration-form .org-type').val(),mailingAddress:$('.class-student-stration-form .mailing-address').val(),postalCode:$('.class-student-stration-form .postal-code').val(),fax:$('.class-student-stration-form .class-student-fax').val(),partyDate:$('.class-student-stration-form .party-date').val(),educationTime:$('.class-student-stration-form .education-time').val(),educationTimeClass:$('.class-student-stration-form .education-time-class').val(),serviceTime:$('.class-student-stration-form .service-time').val(),serviceTimeClass:$('.class-student-stration-form .service-time-class').val(),telephone:$('.class-student-stration-form .telephone-project').val(),email:$('.class-student-stration-form .class-student-email').val(),workTime:$('.class-student-stration-form .work-time').val()};afterJson.gender==1?afterJson.genderVal='男':afterJson.genderVal='女';if(traineeId!=''){operationContent='修改操作：【'+studentList.oldStudentDataMsg.realName+'】，'+studentList.getLogInfo(studentList.StudentJsonName,studentList.oldStudentDataMsg,afterJson)}if(afterJson.phone!=""){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/addOrUpdateTrainee",data:{traineeId:traineeId,projectCode:afterJson.projectCode,realName:afterJson.realName,gender:afterJson.gender,nationId:afterJson.nationId,phone:afterJson.phone,idNumber:afterJson.idNumber,groupId:afterJson.groupId,orgId:afterJson.orgId,deptName:afterJson.deptName,positionName:afterJson.positionName,groupNum:studentList.oldStudentDataMsg.groupNum,invoiceType:studentList.oldStudentDataMsg.invoiceType,invoiceModel:studentList.oldStudentDataMsg.invoiceModel,orgName:studentList.oldStudentDataMsg.orgName,taxNumber:studentList.oldStudentDataMsg.taxNumber,address:studentList.oldStudentDataMsg.address,telephoneProject:studentList.oldStudentDataMsg.telephoneProject,registeredBank:studentList.oldStudentDataMsg.registeredBank,account:studentList.oldStudentDataMsg.account,linkman:afterJson.linkman,linkmanPhone:afterJson.linkmanPhone,linkmanTelephone:afterJson.linkmanTelephone,linkmanFax:afterJson.linkmanFax,linkmanEmail:afterJson.linkmanEmail,linkmanAddressEmail:afterJson.linkmanAddressEmail,idType:afterJson.idType,dateBirth:afterJson.dateBirth,orgType:afterJson.orgType,mailingAddress:afterJson.mailingAddress,postalCode:afterJson.postalCode,fax:afterJson.fax,partyDate:afterJson.partyDate,educationTime:afterJson.educationTime,educationTimeClass:afterJson.educationTimeClass,serviceTime:afterJson.serviceTime,serviceTimeClass:afterJson.serviceTimeClass,telephone:afterJson.telephone,email:afterJson.email,workTime:afterJson.workTime,operationContent:operationContent},async:true,success:function(data){if(data.flag==0){console.log("traineeId",traineeId);$yt_baseElement.hideLoading(function(){if(traineeId==""){$yt_alert_Model.prompt("添加成功")}else{$yt_alert_Model.prompt("修改成功")}studentList.getStudentList();$(".class-student-stration-form").hide()})}else if(data.flag==5){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt(data.message)})}else if(data.flag==2){$yt_baseElement.hideLoading(function(){if(traineeId==""){$yt_alert_Model.prompt("添加失败")}else{$yt_alert_Model.prompt("修改失败")}studentList.getStudentList();$(".class-student-stration-form").hide()})}}})}else{$('.class-student-phone').removeClass('tip-input');$('.class-student-name').removeClass('tip-input');$yt_valid.validForm($(".valid-tab"))}})},getStudentNationList:function(){var nationList=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/getNations",data:{searchParameters:""},async:false,success:function(data){if(data.flag==0){$.each(data.data,function(a,b){nationList.push(b)})}}});return nationList},getStudentGroupList:function(){var groupList=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/group/getGroups",data:{isSelectGroup:1},async:false,success:function(data){if(data.flag==0){$.each(data.data,function(a,b){groupList.push(b)})}}});return groupList},getStudentCompanyList:function(groupId){var companyList=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/group/getGroups",data:{isSelectGroup:2,groupId:groupId},async:false,success:function(data){if(data.flag==0){console.log("成功");$.each(data.data,function(a,b){companyList.push(b)})}}});return companyList},oldStudentDataMsg:{},getStudentDetailedMsg:function(){var me=this;var traineeId=$(".student-div .yt-table-active .trainee-id").val();var studentDetailedMsg;var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeDetails",data:{traineeId:traineeId,projectId:projectCode},async:false,success:function(data){if(data.flag==0){me.oldStudentDataMsg=data.data;studentDetailedMsg=data.data;$yt_baseElement.hideLoading()}}});return studentDetailedMsg},getStudentList:function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.student-div .keyword').val();var gender="";var phone="";var groupId="";var orgId="";var deptPosition="";var isFirstTraining="";var classCommitteeId="";var signUpState="";var checkInState="";var sort="";var orderType="";$('.student-div .tab-content thead').eq(0).find('label input').setCheckBoxState('uncleck');$('.student-div .page-info').eq(0).pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/trainee/getClassTrainee",type:"post",data:{projectCode:projectCode,selectParam:selectParam,gender:gender,phone:phone,groupId:groupId,orgId:orgId,deptPosition:deptPosition,isFirstTraining:isFirstTraining,classCommitteeId:classCommitteeId,signUpState:signUpState,checkInState:checkInState,sort:sort,orderType:orderType},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.student-div .student-list-tbody');var htmlTr='';var num=1;$(htmlTbody).empty();if(data.data.rows.length>0){$('.student-div .page-info').show();$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}if(v.classCommitteeName!=''){var groupnameArr=[v.classCommitteeName]}else{var groupnameArr=[]}if(v.groupPositionType==1){groupnameArr.push('组长')}if(v.groupPositionType==2){groupnameArr.push('副组长')}if(v.groupPositionType==3){groupnameArr.push(v.groupPositionData)}groupnameArr=groupnameArr.join(',');htmlTr='<tr><td><label style="margin-left:4px;" class="check-label yt-checkbox"><input class="check-box" type="checkbox"/></label></td><td style="text-align: center;"><input type="hidden" value="'+v.pkId+'" class="pkId">'+v.groupNum+'</td><td style="text-align: left;"><input type="hidden" value="'+v.traineeId+'" class="trainee-id"><a href="#" class="real-name-inf" style=" color:#3c4687;word-break: break-all;">'+v.realName+'</a></td><td style="text-align: center;">'+v.gender+'</td><td style="text-align: center;">'+v.phone+'</td><td style="text-align: left;">'+v.groupName+'</td><td style="text-align: left;">'+v.orgName+'</td><td style="text-align: left;">'+v.deptName+'</td>'+'<td>'+groupnameArr+'</td>';if(v.isFirstTraining==0){v.isFirstTraining="否";htmlTr+='<td class="color-yellow" style="text-align: center;">'+v.isFirstTraining+'</td></tr>'}else{v.isFirstTraining="是";htmlTr+='<td style="text-align: center;">'+v.isFirstTraining+'</td></tr>'}htmlTr=$(htmlTr).data('studentList',v);htmlTbody.append(htmlTr)});$yt_baseElement.hideLoading()}else{$('.student-div .page-info').hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr);$yt_baseElement.hideLoading()}}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getDifferentList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getHotelTraineeToClassTrainee",data:{projectCode:projectCode},async:true,success:function(data){var htmlBody=$('.student-div .different-student-list tbody ');var htmlTr='';var num=1;if(data.flag==0){if(data.data.length>0){htmlBody.parent().parent().show();$.each(data.data,function(k,b){htmlTr='<tr><td>'+num++ +'</td><td>'+b.traineeName+'</td><td>'+b.gender+'</td><td>'+b.idNumber+'</td><td>'+b.roomNumber+'</td><td>'+b.createTimeString+'</td><td>'+b.reason+'</td></tr>';htmlBody.append(htmlTr)})}else{htmlBody.parent().parent().hide()}}else{$yt_alert_Model.prompt("查询失败")}}})},getLogInfo:function(objName,obj1,obj2){var logTestArr=[];if(obj1!=null){for(var keyName in objName){if(obj1[keyName]!=undefined&&obj2[keyName]!=undefined&&obj1[keyName]!=obj2[keyName]){obj2[keyName]=='请选择'?obj2[keyName]='':obj2[keyName]=obj2[keyName];obj1[keyName]=='请选择'?obj1[keyName]='':obj1[keyName]=obj1[keyName];logTestArr.push(objName[keyName]+"：“"+obj1[keyName]+"”修改为“"+obj2[keyName]+"”")}}}else{for(var keyName in objName){logTestArr.push(objName[keyName]+"：“"+obj2[keyName]+"”")}}console.log(logTestArr.join('；')+('；'));return logTestArr.join('；')+('；')},StudentJsonName:{projectName:"班级",realName:"姓名",groupNum:"组号",genderVal:"性别",phone:"手机号",nationName:"民族",idNumber:"身份证号",groupName:"集团",groupOrgName:"单位",deptName:"部门",positionName:"职位",invoiceTypeVel:"开发票类型",invoiceModel:"发票类型",orgName:"名称",taxNumber:"纳税人识别号",address:"地址",telephoneProject:"电话",registeredBank:"开户行",account:"账号",idTypeName:"证件类型",dateBirth:"出生年月",orgType:"单位类型",mailingAddress:"通信地址",postalCode:"邮政编码",fax:"传真",partyDate:"入党时间",educationTime:"全职教育",educationTimeClass:"全职教育-毕业院校及专业",serviceTime:"在职教育",serviceTimeClass:"在职教育-毕业院校及专业",linkman:"联系人-姓名",linkmanPhone:"联系人-手机号",linkmanTelephone:"联系人-电话",linkmanFax:"联系人-传真",linkmanEmail:"联系人-邮箱",linkmanAddressEmail:"联系人-单位地址(邮编)",telephone:"电话",email:"电子邮箱",workTime:"参加工作时间"}};var repeatCourtyardList={init:function(){var sortNum='';$('.repeat-come-div thead th').eq(1).click(function(){if(sortNum==''){var orderType="ASC";repeatCourtyardList.getRepeatComeList(orderType);sortNum=1}else{var orderType="DESC";repeatCourtyardList.getRepeatComeList(orderType);sortNum=''}});$('.repeat-come-div .export-repeat-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.repeat-come-div .keyword').val();var gender="";var phone="";var orgId="";var deptPosition="";var startTimeStart="";var startTimeEnd="";var endTimeStart="";var endTimeEnd="";$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/exportRepeatClassTrainee",data:{projectCode:projectCode,gender:gender,phone:phone,orgId:orgId,deptPosition:deptPosition,startTimeStart:startTimeStart,startTimeEnd:startTimeEnd,endTimeStart:endTimeStart,endTimeEnd:endTimeEnd}})});$('.repeat-come-div .export-doubt-repeat-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.repeat-come-div .doubt-keyword').val();var gender="";var phone="";var orgId="";var deptPosition="";var startTimeStart="";var startTimeEnd="";var endTimeStart="";var endTimeEnd="";$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/exportRepeatClassDoubtfulTrainee",data:{projectCode:projectCode,gender:gender,phone:phone,orgId:orgId,deptPosition:deptPosition,startTimeStart:startTimeStart,startTimeEnd:startTimeEnd,endTimeStart:endTimeStart,endTimeEnd:endTimeEnd}})})},getRepeatComeList:function(orderType){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.repeat-come-div .keyword').val();var gender="";var phone="";var orgId="";var deptPosition="";var startTimeStart="";var startTimeEnd="";var endTimeStart="";var endTimeEnd="";var sort="";$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getRepeatClassTrainee",data:{projectCode:projectCode,selectParam:selectParam,gender:gender,phone:phone,orgId:orgId,deptPosition:deptPosition,startTimeStart:startTimeStart,startTimeEnd:startTimeEnd,endTimeStart:endTimeStart,endTimeEnd:endTimeEnd,sort:sort,orderType:orderType},async:true,success:function(data){var htmlBody=$('.repeat-come-div .repeat-list-tbody');var htmlTr="";var num=1;htmlBody.empty();if(data.flag==0){var rowSpanNum=1;var mergeName='';var mergePhone='';var lastTr;if(data.data.rows.length!=0){$('.teacher-info-model').show();$('.repeat-come-div-nodata').remove();$.each(data.data.rows,function(i,n){htmlTr='<tr><td>'+num++ +'</td><td style=" word-break: break-all;text-align:left;">'+n.realName+'</td><td>'+n.gender+'</td><td>'+n.phone+'</td><td>'+n.projectCode+'</td><td style="text-align:left;">'+n.projectName+'</td><td>'+n.startTime+'</td><td>'+n.endTime+'</td><td style="text-align:left;">'+n.orgName+'</td><td style="text-align:left;">'+n.deptPosition+'</td></tr>';htmlBody.append(htmlTr)});$yt_baseElement.hideLoading()}else{$('.teacher-info-model').hide();if($('.teacher-info-model-may').css('display')=='none'&&$('.teacher-info-model').css('display')=='none'){if($('.repeat-come-div').find('.repeat-come-div-nodata')[0]==undefined){$('.repeat-come-div').append('<div class="no-data repeat-come-div-nodata" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div>')}}$yt_baseElement.hideLoading()}}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt('查询失败')})}}})},doubtRepatComeList:function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.repeat-come-div .doubt-keyword').val();var gender="";var phone="";var orgId="";var deptPosition="";var startTimeStart="";var startTimeEnd="";var endTimeStart="";var endTimeEnd="";var sort="";$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getRepeatClassDoubtfulTrainee",data:{projectCode:projectCode,selectParam:selectParam,gender:gender,phone:phone,orgId:orgId,deptPosition:deptPosition,startTimeStart:startTimeStart,startTimeEnd:startTimeEnd,endTimeStart:endTimeStart,endTimeEnd:endTimeEnd},async:true,success:function(data){var htmlBody=$('.repeat-come-div .doubt-repeat-list-tbody');var htmlTr="";var num=1;htmlBody.empty();if(data.flag==0){var rowSpanNum=1;var mergeName='';var mergePhone='';var lastTr;if(data.data.length!=0){$('.teacher-info-model-may').show();$('.repeat-come-div-nodata').remove();$.each(data.data,function(i,n){if(n.gender==1){n.gender="男"}else{n.gender="女"}if(n.orgName==null){n.orgName=""}if(n.realName==undefined){n.realName=""};if(n.gender==undefined){n.gender=""};if(n.phone==undefined){n.phone=""};if(n.projectCode==undefined){n.projectCode=""};if(n.projectName==undefined){n.projectName=""};if(n.startTime==undefined){n.startTime=""};if(n.endTime==undefined){n.endTime=""};if(n.orgName==undefined){n.orgName=""};if(n.deptPosition==undefined){n.deptPosition=""};htmlTr='<tr><td>'+num++ +'</td><td style="text-align:left;">'+n.realName+'</td><td>'+n.gender+'</td><td>'+n.phone+'</td><td>'+n.projectCode+'</td><td style="text-align:left;">'+n.projectName+'</td><td>'+n.startTime+'</td><td>'+n.endTime+'</td><td style="text-align:left;">'+n.orgName+'</td><td style="text-align:left;">'+n.deptPosition+'</td></tr>';htmlBody.append(htmlTr)});$yt_baseElement.hideLoading()}else{$('.teacher-info-model-may').hide();if($('.teacher-info-model-may').css('display')=='none'&&$('.teacher-info-model').css('display')=='none'){if($('.repeat-come-div').find('.repeat-come-div-nodata')[0]==undefined){$('.repeat-come-div').append('<div class="no-data repeat-come-div-nodata" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div>')}}$yt_baseElement.hideLoading()}}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt('查询失败')})}}})}};var studentManual={ue:null,init:function(){$('#uploadOrCode').hover(function(){$(this).prev().css('text-decoration','underline')},function(){$(this).prev().css('text-decoration','none')});studentManual.ue=UE.getEditor('container',{toolbars:[['undo','redo','|','bold','italic','underline','forecolor','|','justifyleft','justifycenter','justifyright','justifyjustify','|','simpleupload','attachment']],autoHeightEnabled:true,elementPathEnabled:false,enableAutoSave:false,autoFloatEnabled:false,maximumWords:1000,saveInterval:0});$('.student-manual-div .student-manual-btn').click(function(){console.log($(this).index());$(this).addClass('change-page-sign').siblings().removeClass('change-page-sign');$('.student-manual-div .manual-div').hide().eq($(this).index()).show();if($(this).index()==1){studentManual.getPreviewData()}});$(".student-manual-div").undelegate().delegate("input[type='file']","change",function(){console.log($(this)[0].files[0]);var type=$(this)[0].files[0].type;var size=$(this)[0].files[0].size;console.log(type);if(size<=307200&&type=='image/jpeg'||size<=307200&&type=='image/png'){var url=$yt_option.acl_path+"api/tAscPortraitInfo/addFile";$yt_baseElement.showLoading();$.ajaxFileUpload({url:url,type:"post",data:{file:name,modelCode:'or-codesss',uploadType:1,type:'PC'},dataType:'json',fileElementId:"uploadOrCode",success:function(data,textStatus){var resultData=$.parseJSON(data);if(resultData.success==0){console.log(resultData.obj.pkId);$('.student-manual-div .upload-or-code-img').attr('src',$yt_option.acl_path+'api/tAscPortraitInfo/download?pkId='+resultData.obj.pkId+'&isDownload=false');$('.qr-code-id').val(resultData.obj.pkId);$('.qr-code-name').val(resultData.obj.naming);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传失败")})}},error:function(data,status,e){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("附件上传失败")})}})}else{$yt_alert_Model.prompt("请选择正确格式")}});$('.manual-main-div .save-btn').on('click',function(){console.log("imgFileId",imgFileId,"imgFileName",imgFileName);var imgFileId=$('.qr-code-id').val();var imgFileName=$('.qr-code-name').val();if(imgFileId==''){$yt_alert_Model.prompt("请上传微信二维码")}else{studentManual.manualOperation(imgFileId,imgFileName)}});$(".manual-main-div .preview-save").on('click',function(){console.log("imgFileId",imgFileId,"imgFileName",imgFileName);var imgFileId=$('.qr-code-id').val();var imgFileName=$('.qr-code-name').val();studentManual.manualOperation(imgFileId,imgFileName);$('.student-manual-div .student-manual-btn').removeClass('change-page-sign');$('.student-manual-div .student-manual-btn').eq(1).addClass('change-page-sign');$('.student-manual-div .manual-div').hide().eq(1).show();studentManual.getPreviewData()});$('.manual-main-div .yt-model-canel-btn').on('click',function(){$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"./resources/images/icons/x.png",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"确定取消当前页面的所有操作吗?",confirmFunction:function(){studentManual.getPageDataList()}})});$('.entrust-company .add-student-manual').on('click',function(){var htmlTr='<tr><td style="text-align:center;"><input class="yt-input entrust-name" style="width: 150px;" type="text"/></td><td style="text-align:center;"><input class="yt-input entrust-dept" type="text"/></td><td style="text-align:center;"><input class="yt-input entrust-room-num" type="text"/></td><td style="text-align:center;"><input class="yt-input entrust-phone" type="text"/></td><td style="text-align: center;"><img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td></tr>';$(this).prev().find('tbody').append(htmlTr);$('.college-project-post').niceSelect()});$('.college-project .add-student-manual').on('click',function(){var htmlTr='<tr><td style="text-align:center;"><input class="yt-input college-project-name" style="width: 150px;" type="text"/></td><td style="text-align:center;"><input class="yt-input college-project-dept" type="text"/></td><td style="text-align:center;"><select class="yt-select college-project-post"><option value="1">带班院领导</option><option value="2">项目组组长</option><option value="3">夜间值班室</option></select></td><td style="text-align:center;"><input class="yt-input college-project-phone" type="text"/></td><td style="text-align: center;"><img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td></tr>';$(this).prev().find('tbody').append(htmlTr);$('.college-project-post').niceSelect();$('div.college-project-post').css("margin-left","44px")});$('.box-list').on('click','.entrust-delete',function(){$(this).addClass('cho-btn');$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"./resources/images/icons/x.png",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:function(){$(' .entrust-delete').removeClass('cho-btn')},alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$('.entrust-delete.cho-btn').parents("tr").remove()}})})},getPreviewData:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/studentHandbook/getStudentHandbookPreview",data:{projectCode:projectCode},async:true,success:function(data){if(data.flag==0){$('.word-scroll').empty();$.each(data.data,function(i,g){if(g.modelCode=='CLASSNAME'){$('.word-scroll').append('<div style="margin: 0px 6px;background-color: #FFFFFF;padding-bottom: 20px;"><div class="class-info-div"><span class="manual-class-name"></span></div><br /><h3>学员手册</h3><br /><h3>大连高级经理学院</h3><br /><h4 class="manual-class-date"></h4></div>');$(".manual-class-name").text(g.modelValue);var manualDate=new Date();var year=manualDate.getFullYear();var month=manualDate.getMonth()+1;$(".manual-class-date").text(year+"年"+month+"月")}else if(g.modelCode=='TRAINDETAILS'){$('.word-scroll').append('<div style="margin: 0px 6px;"><div class="class-info-div"></div><div class="teach-content manual-college-brief"></div></div>');$(".manual-college-brief").prev().text(g.modelName);$(".manual-college-brief").text(g.modelValue)}else if(g.modelCode=='TEACHINGDETAILS'){$('.word-scroll').append('<div style="margin: 0px 6px;"><div class="class-info-div"></div><div class="teach-content manual-teaching-brief"></div></div>');$(".manual-teaching-brief").prev().text(g.modelName);$(".manual-teaching-brief").empty();$(".manual-teaching-brief").html(g.modelValue)}else if(g.modelCode=='COURSE'){$('.word-scroll').append('<div class="preview-course" style="margin:0px 6px;"><div class="class-info-div ">教学日程</div><div class="teach-content manual-teaching-schedule"><table class="yt-table list-table"><thead class="list-thead"><tr><th colspan="2" width="225px">时间</th><th>教学内容	</th><th width="225px">地点</th></tr></thead><tbody></tbody></table></div></div>');$(".manual-teaching-schedule").prev().text(g.modelName);var previewBody=$(".preview-course tbody");previewBody.empty();$.each(g.modelValue,function(i,c){var previewCourse='';$.each(c.courseDetails,function(r,s){previewCourse+='<tr>';if(c.courseDetails.length!=1&&r==0){previewCourse+='<td rowspan="'+c.courseDetails.length+'" style="text-align:center">'+c.courseDate+'</td>'}else if(c.courseDetails.length==1){previewCourse+='<td style="text-align:center">'+c.courseDate+'</td>'}previewCourse+='<td style="text-align: center;">'+s.courseTime+'</td><td><span style="font-weight: bolder;">'+s.courseTypeName+'</span><span>'+s.courseName+'</span><br/><span style="font-weight: bolder;">'+s.speaker+'</span><span>'+s.teacherName+'</span></td><td>'+s.address+'</td></tr>'});previewBody.append(previewCourse)})}else if(g.modelCode=='TRAINEE'){$('.word-scroll').append('<div style="margin: 0px 6px;"><div class="class-info-div"></div><div class="teach-content preview-student-list"></div></div>');$(".preview-student-list").prev().text(g.modelName);var studentList=$(".preview-student-list");studentList.empty();$.each(g.modelValue,function(i,d){var preGroup='';preGroup+='<p style="margin:0 auto;">'+d.groupName+'</p><p>'+d.groupLeader+'</p><table class="yt-table list-table" style="margin-bottom:20px"><thead class="list-thead"><tr><th width="225px">姓名</th><th>单位职务</th><th width="225px">房间号</th></tr></thead><tbody>';$.each(d.traineeDetails,function(p,c){preGroup+='<tr><td style="text-align:center;">'+c.realName+'</td><td>'+c.positionName+'</td><td>'+c.roomNumber+'</td></tr>'});preGroup+='</tbody></table>';studentList.append(preGroup)})}else if(g.modelCode=='COMMITTEE'){$('.word-scroll').append('<div style="margin: 0px 6px;"><div class="class-info-div"></div><div class="teach-content manual-committee"></div></div>');$(".manual-committee").prev().text(g.modelName);var comiteBody=$(".manual-committee");comiteBody.empty();$.each(g.modelValue,function(i,r){var manualComite='';manualComite+='<p style="font-weight: bolder;">'+r.classCommittee+'</p>';$.each(r.traineeDetails,function(t,j){manualComite+='<p style="margin-left:20px"><span>'+j.realName+" </span><span>"+j.positionName+'</span></p>';comiteBody.append(manualComite)})})}else if(g.modelCode=='GUIDE'){$('.word-scroll').append('<div style="margin: 0px 6px;"><div class="class-info-div"></div><div class="teach-content manual-college-guide"></div></div>');$(".manual-college-guide").prev().text(g.modelName);$(".manual-college-guide").html(g.modelValue)}else{$('.word-scroll').append('<div style="margin: 0px 6px;"><div class="class-info-div"></div><div class="teach-content manual-other'+i+'"></div></div>');$(".manual-other"+i).prev().text(g.modelName);$(".manual-other"+i).html(g.modelValue)}});$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("获取预览数据失败")})}}})},getPageDataList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/studentHandbook/getStudentHandbook",data:{projectCode:projectCode},async:true,success:function(data){var htmlPrev=$('.entrust-company tbody');var htmlTr='';var htmlProTeam=$('.college-project tbody');var htmlTb='';htmlPrev.empty();htmlProTeam.empty();if(data.flag==0){if(data.data!=null){var studentManual=data.data;console.log("获取手册数据成功",studentManual.pkId);$('.template-pkid').val(studentManual.pkId);$('.weixin-group-name').val(studentManual.weixnGroupName);$('.weixin-details').val(studentManual.weixnGroupDetails);$('.qr-code-id').val(studentManual.weixinQrCodeId);$('.qr-code-name').val(studentManual.weixinQrCodeName);$('.student-manual-div .upload-or-code-img').attr('src',$yt_option.acl_path+'api/tAscPortraitInfo/download?pkId='+studentManual.weixinQrCodeId+'&isDownload=false');var studentHandbookEntrust=$.parseJSON(studentManual.studentHandbookEntrust);var datastudentHandbookGroup=$.parseJSON(studentManual.studentHandbookGroup);var ueName=$.parseJSON(studentManual.templateData).details;console.log("studentManual.templateData",ueName);var ue=UE.getEditor('container');ue.ready(function(){ue.setContent(ueName)});$.each(studentHandbookEntrust,function(i,v){htmlTr='<tr><td><input class="yt-input entrust-name" style="width: 101px;" value="'+v.userName+'" type="text"/></td><td><input class="yt-input entrust-dept" value="'+v.deptName+'" type="text"/></td><td><input class="yt-input entrust-room-num" value="'+v.roomNumber+'" type="text"/></td><td><input class="yt-input entrust-phone" value="'+v.phone+'" type="text"/></td><td style="text-align: center;"><img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td></tr>';htmlPrev.append(htmlTr)});$.each(datastudentHandbookGroup,function(i,k){if(k!=null){htmlTb='<tr><td><input class="yt-input college-project-name" style="width: 101px;" value="'+k.userName+'" type="text"/></td><td><input class="yt-input college-project-dept" value="'+k.deptName+'"  type="text"/></td><td><select class="yt-select college-project-post"><option value="1">带班院领导</option><option value="2">项目组组长</option><option value="3">夜间值班室</option></select></td><td><input class="yt-input college-project-phone" value="'+k.phone+'"  type="text"/></td><td style="text-align: center;"><img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td></tr>';htmlProTeam.append(htmlTb);$('.college-project-post').setSelectVal(k.positionId);$('.college-project-post').niceSelect()}});$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading()}}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询学员手册失败")})}}})},manualOperation:function(weixinQrCode,weixinQrName){var projectCode=$yt_common.GetQueryString("projectCode");var templateId=studentManual.getTemplateList();;var pkId=$('.template-pkid').val();var details=studentManual.ue.getContent();var templateData={templateId:templateId,details:details};templateData=JSON.stringify(templateData);var weixnGroupName=$('.weixin-group-name').val();var weixnGroupDetails=$('.weixin-details').val();var weixinQrCode={weixinQrCode:weixinQrCode,weixinQrName:weixinQrName};weixinQrCode=JSON.stringify(weixinQrCode);var studentHandbookEntrust=[];$('.entrust-company tbody tr').each(function(i,q){var userName=$(q).find('.entrust-name').val();var deptName=$(q).find('.entrust-dept').val();var roomNumber=$(q).find('.entrust-room-num').val();var phone=$(q).find('.entrust-phone').val();var entrustList={userName:userName,deptName:deptName,roomNumber:roomNumber,phone:phone};studentHandbookEntrust.push(entrustList)});studentHandbookEntrust=JSON.stringify(studentHandbookEntrust);var studentHandbookGroup=[];$('.college-project tbody tr').each(function(i,p){var userName=$(p).find('.college-project-name').val();var deptName=$(p).find('.college-project-dept').val();var positionId=$(p).find('.college-project-post').val();var phone=$(p).find('.college-project-phone').val();var collegeList={userName:userName,deptName:deptName,positionId:positionId,phone:phone};studentHandbookGroup.push(collegeList)});studentHandbookGroup=JSON.stringify(studentHandbookGroup);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/studentHandbook/addOrUpdateStudentHandbook",data:{projectCode:projectCode,pkId:pkId,templateData:templateData,weixnGroupName:weixnGroupName,weixnGroupDetails:weixnGroupDetails,weixinQrCode:weixinQrCode,studentHandbookEntrust:studentHandbookEntrust,studentHandbookGroup:studentHandbookGroup},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交成功")});studentManual.getPageDataList()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交失败")})}}})},getTemplateList:function(){var templateId='';$.ajax({type:"post",url:$yt_option.base_path+"class/traineeTemplate/lookForAll",data:{templateId:1,types:3},async:false,success:function(data){if(data.flag==0){console.log("模板查询成功");$.each(data.data,function(i,q){console.log("模板id",q.pkId);if(q.modelCode=='TEACHINGDETAILS'){templateId=q.pkId}})}}});return templateId}};var receptionNotice={ue:null,init:function(){receptionNotice.ue=UE.getEditor('reception',{toolbars:[['undo','redo','|','bold','italic','underline','forecolor','|','justifyleft','justifycenter','justifyright','justifyjustify','|','simpleupload','attachment']],autoHeightEnabled:true,elementPathEnabled:false,enableAutoSave:false,saveInterval:0});var personnelName=receptionNotice.getPersonnelList();if(personnelName.length!=0){$.each(personnelName,function(i,o){$(".reception-notice-div .project-head-select").append('<option value='+o.textName+'>'+o.name+'</option>')});$(".reception-notice-div .project-head-select").niceSelect()}$('.add-room-list').click(function(){var appedHtml='<tr><td><input type="text" class="yt-input" style="width: 135px;" placeholder="请输入" /></td><td><input type="number" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" /></td><td><input type="number" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" /></td><td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" /></td><td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td></tr>';$(this).prev().find('tbody').append(appedHtml)});$(".add-address-list").click(function(){var appedHtml='<tr><td><input type="text" class="yt-input" style="width: 95%;" placeholder="请输入" /></td><td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" /></td><td><input type="number" class="yt-input" style="width: 94%;text-align:right;" placeholder="请输入" /></td><td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td></tr>';$(this).prev().find('tbody').append(appedHtml)});$(".add-haveMeals-list").click(function(){var appedHtml='<tr><td><input type="text" class="yt-input" style="width: 240px;" placeholder="请输入" /></td><td><input type="text" class="yt-input" style="width: 189px;" placeholder="请输入" /></td><td><input type="text" class="yt-input" style="width: 153px;" placeholder="请输入" /></td><td><input type="number" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" /></td><td><input type="text" class="yt-input" style="width: 85px;" placeholder="请输入" /></td><td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" /></td><td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td></tr>';$(this).prev().find('tbody').append(appedHtml)});$(".add-charge-list").click(function(){var appedHtml='<tr><td><input type="text" class="yt-input" style="width: 93%;" placeholder="请输入" /></td><td><input type="number" class="yt-input" style="width: 93%;text-align: right;" placeholder="请输入" /></td><td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" /></td><td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td></tr>';$(this).prev().find('tbody').append(appedHtml)});$('.reception-notice-div .save-reception').off('click').click(function(){receptionNotice.saveReception(1)});$('.reception-notice-div .generate').off('click').click(function(){receptionNotice.saveReception(2)});$('.reception-notice-div .yt-model-canel-btn').off().click(function(){$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"./resources/images/icons/x.png",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"确定取消当前页面的所有操作吗?",confirmFunction:function(){receptionNotice.getReceptionList()}})})},getGroupOrg:function(){var groupOrg;$.ajax({type:"post",url:$yt_option.base_path+"uniform/group/getGroups",data:{isSelectGroup:2},async:false,success:function(data){if(data.flag==0){groupOrg=data.data}}});return groupOrg},getPersonnelList:function(){var personnelName=[];$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsers",data:{compId:""},async:false,success:function(data){if(data.flag==0){$.each(data.data,function(i,m){if(m.type==3){var personnel={name:m.text,textName:m.textName};personnelName.push(personnel)}});$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading()}}});return personnelName},groupOrgTree:function(){var getGroupOrg=receptionNotice.getGroupOrg();console.log("getGroupOrg",getGroupOrg);if($("#treeDiv").length==0){$('#textTree').createTree({controlId:'treeDiv',dataList:getGroupOrg,listConfig:{id:'groupId',pid:'parentId',name:'groupName'},rootConfig:{id:0,pid:-1,name:"大连高级经理学院"},speed:200,readonly:true,checked:false,hide:true,callback:{onClick:function(obj,id,name){$('#groupId').val(id);$('#textTree').val(name)},}})}},getReceptionList:function(){$(".report-date").calendar({speed:200,complement:true,readonly:true,nowData:false,dateFmt:"yyyy-MM-dd HH:mm"});$(".out-hospital-date").calendar({speed:200,complement:true,readonly:true,nowData:false,dateFmt:"yyyy-MM-dd HH:mm"});$(".trainee-pick-date").calendar({speed:200,complement:true,readonly:true,nowData:false,dateFmt:"yyyy-MM-dd HH:mm"});$(".trainee-check-out-date").calendar({speed:200,complement:true,readonly:true,nowData:false,dateFmt:"yyyy-MM-dd HH:mm"});var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/noticeReception/getNoticeReceptionByProjectCode",data:{projectCode:projectCode},async:true,success:function(data){if(data.flag==0){console.log("接待通知查询列表成功");if(data.data!=null){if(data.data.projectType==1){data.data.projectType="调训";receptionNotice.groupOrgTree();$(".dtree .dTreeNode").eq(0).addClass('tree-first')}else if(data.data.projectType==2){data.data.projectType="委托";if(data.data.groupName!=null){$(".entrust-name-td").empty();$(".entrust-name-td").text(data.data.groupName)}else{receptionNotice.groupOrgTree();$(".dtree .dTreeNode").eq(0).addClass('tree-first')}}else if(data.data.projectType==3){data.data.projectType="选学";$(".entrust-name-td").prev().remove();$(".entrust-name-td").remove()}else{receptionNotice.groupOrgTree();data.data.projectType="调训";$(".dtree .dTreeNode").eq(0).addClass('tree-first')}data.data.haveMealsRemarks=data.data.haveMealsRemarks.replace('班级名称',data.data.projectName);$('.reception-notice-div').setDatas(data.data);$('.head-select').setSelectVal(data.data.projectHeadCode);$(".head-master-select").setSelectVal(data.data.classTeacherCode);var roomList=data.data.roomList;if(roomList!=""){$('.room-list-table tbody').empty();var roomnum=0;$.each(roomList,function(i,a){roomnum+=Number(a.roomCount);var roomHtml='<tr><td><input type="text" class="yt-input" style="width: 135px;" placeholder="请输入" value="'+a.roomType+'" /></td><td><input type="number" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" value="'+a.roomCount+'" /></td><td><input type="number" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" value="'+a.roomPrice+'" /></td><td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" value="'+a.remarks+'" /></td><td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td></tr>';$('.room-list-table tbody').append(roomHtml)});$('.allroom').text(roomnum)}var addressList=data.data.addressList;if(addressList!=""){$('.address-list-table tbody').empty();$.each(addressList,function(i,b){if(b.address==null){b.address=""}var addreHtml='<tr><td><input type="text" class="yt-input" style="width: 95%;" placeholder="请输入" value="'+b.adressDate+'" /></td><td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" value="'+b.address+'" /></td><td><input type="number" class="yt-input" style="width: 94%;text-align:right;" placeholder="请输入" value="'+b.peopleCount+'" /></td><td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td></tr>';$('.address-list-table tbody').append(addreHtml)})}var haveMealsList=data.data.haveMealsList;if(haveMealsList!=""){$('.haveMeals-list-table tbody').empty();$.each(haveMealsList,function(i,c){var mealsHtml='<tr><td><input type="text" class="yt-input" style="width: 240px;" placeholder="请输入" value="'+c.adressDate+'"/></td><td><input type="text" class="yt-input" style="width: 189px;" placeholder="请输入" value="'+c.address+'" /></td><td><input type="text" class="yt-input" style="width: 153px;" placeholder="请输入" value="'+c.types+'" /></td><td><input type="text" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" value="'+c.peopleCount+'" /></td><td><input type="text" class="yt-input" style="width: 85px;" placeholder="请输入" value="'+c.standard+'" /></td><td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" value="'+c.remarks+'" /></td><td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td></tr>';$('.haveMeals-list-table tbody').append(mealsHtml)})}var receptionChargeList=data.data.receptionChargeList;if(receptionChargeList!=""){$('.reception-charge-list-table tbody').empty();$.each(receptionChargeList,function(i,d){var recptionHtml='<tr><td><input type="text" class="yt-input" style="width: 93%;" placeholder="请输入" value="'+d.chargeType+'" /></td><td><input type="text" class="yt-input" style="width: 93%;text-align: right;" placeholder="请输入" value="'+d.chargeTrainee+'" /></td><td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入"  value="'+d.remarks+'"/></td></tr>';$('.reception-charge-list-table tbody').append(recptionHtml)})}var ue=UE.getEditor('reception');ue.ready(function(){if(data.data.specialCaseDescription!=null){ue.setContent(data.data.specialCaseDescription)}});$yt_baseElement.hideLoading()}else{var projectType=$yt_common.GetQueryString("projectType");if(projectType==1){projectType="调训"}else if(projectType==2){projectType="委托"}else if(projectType==3){projectType="选学"}else{projectType="调训"}var projectList={projectType:projectType };console.log(projectList);$('.reception-notice-div').setDatas(projectList);receptionNotice.groupOrgTree();$(".dtree .dTreeNode").eq(0).addClass('tree-first');$yt_baseElement.hideLoading()}}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},saveReception:function(dataStates){var projectCode=$yt_common.GetQueryString("projectCode");var recptionList=$('.reception-notice-div').getDatas();var groupId=$("#groupId").val();console.log("recptionList",recptionList);var projectHeadCode=$('.head-select').val();var classTeacherCode=$(".head-master-select").val();var specialCaseDescription=receptionNotice.ue.getContent();var roomList=[];var addressList=[];var haveMealsList=[];var receptionChargeList=[];$(".room-list-table tbody tr").each(function(i,s){var roomUse={roomType:$(s).find('td').eq(0).find('input').val(),roomCount:$(s).find('td').eq(1).find('input').val(),roomPrice:$(s).find('td').eq(2).find('input').val(),remarks:$(s).find('td').eq(3).find('input').val()};roomList.push(roomUse)});roomList=JSON.stringify(roomList);console.log("roomList",roomList);$(".address-list-table tbody tr").each(function(i,p){var addressUse={adressDate:$(p).find('td').eq(0).find('input').val(),address:$(p).find('td').eq(1).find('input').val(),peopleCount:$(p).find('td').eq(2).find('input').val()};addressList.push(addressUse)});addressList=JSON.stringify(addressList);$(".haveMeals-list-table tbody tr").each(function(i,g){var haveMealsUse={adressDate:$(g).find('td').eq(0).find('input').val(),address:$(g).find('td').eq(1).find('input').val(),types:$(g).find('td').eq(2).find('input').val(),peopleCount:$(g).find('td').eq(3).find('input').val(),standard:$(g).find('td').eq(4).find('input').val(),remarks:$(g).find('td').eq(5).find('input').val()};haveMealsList.push(haveMealsUse)});haveMealsList=JSON.stringify(haveMealsList);$(".reception-charge-list-table tbody tr").each(function(i,u){var receptionUse={chargeType:$(u).find('td').eq(0).find('input').val(),chargeTrainee:$(u).find('td').eq(1).find('input').val(),remarks:$(u).find('td').eq(2).find('input').val()};receptionChargeList.push(receptionUse)});receptionChargeList=JSON.stringify(receptionChargeList);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/noticeReception/addNoticeReception",data:{projectCode:projectCode,dataStates:dataStates,groupId:groupId,reportDate:recptionList.reportDate,outHospitalDate:recptionList.outHospitalDate,traineePickDate:recptionList.traineePickDate,traineeCheckOutDate:recptionList.traineeCheckOutDate,traineeCount:recptionList.traineeCount,personnelCount:recptionList.personnelCount,leaderCount:recptionList.leaderCount,projectHeadCode:projectHeadCode,classTeacherCode:classTeacherCode,projectHeadPhone:recptionList.projectHeadPhone,classTeacherPhone:recptionList.classTeacherPhone,remarks:recptionList.remarks,roomRemarks:recptionList.roomRemarks,addressRemarks:recptionList.addressRemarks,haveMealsRemarks:recptionList.haveMealsRemarks,specialCaseDescription:specialCaseDescription,roomList:roomList,addressList:addressList,haveMealsList:haveMealsList,receptionChargeList:receptionChargeList},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){if(dataStates==1){$yt_alert_Model.prompt("保存成功")}else if(dataStates==2){$yt_alert_Model.prompt("提交成功");$.each($('.reception-notice-div input'),function(i,n){$(n).attr('readonly','readonly');$(n).attr('placeholder','');$(n).css('border','none')});$('.reception-notice-div textarea').attr('disabled','disabled');$('.reception-notice-div textarea').css('border','none');$('.add-notice-reception').remove();$.each($('.reception-notice-div select'),function(i,n){$(n).parents('td').text($(n).val())});$('#reception').html(UE.getEditor('reception').getContent())}});receptionNotice.getReceptionList()}else{$yt_baseElement.hideLoading(function(){if(dataStates==1){$yt_alert_Model.prompt("保存失败")}else if(dataStates==2){$yt_alert_Model.prompt("提交失败")}})}}})}};var classBulletin={ue:null,init:function(){classBulletin.ue=UE.getEditor('manual',{toolbars:[['undo','redo','|','bold','italic','underline','forecolor','|','justifyleft','justifycenter','justifyright','justifyjustify','|','simpleupload','attachment']],autoHeightEnabled:true,elementPathEnabled:false,enableAutoSave:false,saveInterval:0});$('.class-bulletin-div .list-tbody').on('click','.bulletin-delete',function(){var pkId=$(this).parent().parent().find('.bulletin-id').val();$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"./resources/images/icons/x.png",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/notice/deleteClassNotice",data:{pkId:pkId},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除成功");classBulletin.getClassBulletin()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除失败");classBulletin.getClassBulletin()})}}})}})});var pkId;var projectCode=$yt_common.GetQueryString("projectCode");$('.class-bulletin-div .list-tbody').on('click','.bulletin-update',function(){$('.class-bulletin-form .yt-edit-alert-title-msg').text("修改公告");pkId=$(this).parent().parent().find('.bulletin-id').val();var noticeDescribe=$(this).parent().parent().data('bulletin').noticeDescribe;classBulletin.ue.ready(function(){classBulletin.ue.setContent(noticeDescribe)});var noticeTitle=$(this).parent().parent().data('bulletin').noticeTitle;$('.class-bulletin-input').val(noticeTitle);console.log(noticeDescribe);$(".class-bulletin-form").show();$yt_alert_Model.getDivPosition($(".class-bulletin-form"));$yt_model_drag.modelDragEvent($(".class-bulletin-form .yt-edit-alert-title"));$('.class-bulletin-form .yt-eidt-model-bottom .canel-in-btn').off().on("click",function(){$(".class-bulletin-form").hide();$("#pop-modle-alert").hide()})});$('.class-bulletin-add-btn').click(function(){pkId="";$(".class-bulletin-input").val("");classBulletin.ue.execCommand('cleardoc');$(".class-bulletin-form").show();$(".class-bulletin-form .yt-edit-alert-main").css('max-height','475px');$yt_alert_Model.setFiexBoxHeight($(".class-bulletin-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".class-bulletin-form"));$yt_model_drag.modelDragEvent($(".class-bulletin-form .yt-edit-alert-title"));$('.class-bulletin-form .yt-eidt-model-bottom .canel-in-btn').off().on("click",function(){$(".class-bulletin-form").hide();$("#pop-modle-alert").hide()})});$('.class-bulletin-form .yt-model-sure-btn').off().on('click',function(){var noticeDescribe=classBulletin.ue.getContent();var noticeTitle=$(".class-bulletin-input").val();console.log(noticeDescribe);if(noticeDescribe!=null&&noticeTitle!=''){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/notice/addOrUpdateNotice",data:{pkId:pkId,projectCode:projectCode,noticeTitle:noticeTitle,noticeDescribe:noticeDescribe,dateStates:1},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("发布成功");$(".class-bulletin-form").hide();classBulletin.getClassBulletin()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("发布失败");$(".class-bulletin-form").hide();classBulletin.getClassBulletin()})}}})}else{$yt_alert_Model.prompt("请填写公告内容")}console.log(noticeDescribe)});$('.class-bulletin-form .yt-eidt-model-bottom .save-in-btn').off().on("click",function(){var noticeDescribe=classBulletin.ue.getContent();var noticeTitle=$(".class-bulletin-input").val();console.log(noticeTitle);if(noticeDescribe!=null&&noticeTitle!=""){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/notice/addOrUpdateNotice",data:{pkId:pkId,projectCode:projectCode,noticeTitle:noticeTitle,noticeDescribe:noticeDescribe,dateStates:0},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("暂存成功");$(".class-bulletin-form").hide();classBulletin.getClassBulletin()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("暂存成功");$(".class-bulletin-form").hide();classBulletin.getClassBulletin()})}}})}else{$yt_alert_Model.prompt("请填写公告内容")}})},getClassBulletin:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$('.class-bulletin-div .page-info').pageInfo({async:true,pageIndexs:1,pageNum:15,url:$yt_option.base_path+"class/notice/getClassNoticeList",type:"post",before:function(){$yt_baseElement.showLoading()},data:{projectCode:projectCode},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.class-bulletin-div .list-tbody');var htmlTr='';var num=1;$(htmlTbody).empty();if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){$('.class-bulletin-div .page-info').show();htmlTr='<tr><input class="bulletin-id" type="hidden" value="'+v.pkId+'"/><td  style="text-align: center;">'+num++ +'</td><td class="pro-desc">'+v.noticeTitle+'</td><td  style="text-align: center;">'+v.createTimeString+'</td><td  style="text-align: center;">'+v.createUserName+'</td><td  style="text-align: center;"><img class="bulletin-update" src="../../resources/images/icons/amend.png"/><div style="width: 1px;height: 15px;margin:0px 10px;display:inline-block;background: #e6e6e6;"></div><img class="bulletin-delete" src="../../resources/images/icons/t-del.png"/></td></tr>';htmlTr=$(htmlTr).data('bulletin',v);htmlTbody.append(htmlTr)})}else{$('.class-bulletin-div .page-info').hide();htmlTr='<tr class="class-tr"><td colspan="5" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })}};var classQrCode={init:function(){classQrCode.getClassOrCode();$('.qr-img-download').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var baseName='check_in_qr';var fileRealName=$('.project-name').eq(0).text()+'学员报到二维码.jpg';window.location.href=$yt_option.base_path+"class/getQrcode?projectCode="+projectCode+"&&isDownload="+true+"&&fileRealName="+fileRealName+"&&baseName="+baseName});$('.qr-img-print').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var baseName='check_in_qr';var url=$yt_option.base_path+"class/getQrcode?projectCode="+projectCode+"&baseName="+baseName;var html='<img style="margin:14px;width:160px;height:155px;" src="'+url+'"/>';classQrCode.printImg(html)})},getClassOrCode:function(){var projectCode=$yt_common.GetQueryString("projectCode");var baseName='check_in_qr';var url=$yt_option.base_path+"class/getQrcode?projectCode="+projectCode+"&baseName="+baseName;var htmlBody=$('.class-qr-code-div .teacher-list-div .report-qr-code');htmlBody.before('<img style="margin:10px 0px 3px 10px;width:160px;height:154px;" src="'+url+'"/>')},printImg:function(html){$("#project-main").hide();$("#project-main").after($('<div class="body-print-box">'+html+'</div>'));window.print();$("#project-main").show();$(".body-print-box").remove();return false}};var studentReport={init:function(){var me=this;var traineeId;studentReport.losFfocus();$('.student-nation').niceSelect();$('.student-invoice-type').niceSelect();$('.card-type').niceSelect();$('.group-id-elementary').niceSelect();$('.org-id').niceSelect();$(".date-birth").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".party-date").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".work-time").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});var groupList=studentReport.getGroupList();var nationList=studentReport.getNationList();if(nationList.length!=0){$('.class-student-form .student-nation').empty();$.each(nationList,function(q,e){$('.class-student-form .student-nation').append(' <option value="'+e.nationId+'">'+e.nationName+'</option>')});$('.class-student-form .student-nation').niceSelect()}if(groupList.length!=0){$('.class-student-form .group-id-elementary').empty();$.each(groupList,function(q,e){$('.class-student-form select.group-id-elementary').append(' <option value="'+e.groupId+'">'+e.groupName+'</option>')});$('.class-student-form select.group-id-elementary').niceSelect()}$('.class-student-form select.group-id-elementary').change(function(){groupId=$(this).val();var companyList=studentReport.getCompanyList(groupId);if(companyList.length!=0){$('.class-student-form select.org-id').empty();$('.class-student-form .orgType').text('');$('.class-student-form select.org-id').append(' <option value="">请选择</option>');$.each(companyList,function(i,o){if(i!=0){$('.class-student-form select.org-id').append(' <option value="'+o.groupId+'">'+o.groupName+'</option>').data('types',o.types)}});$('.class-student-form select.org-id').niceSelect();$(".class-student-form select.org-id").off().change(function(){if($(this).val()!=''){$("div.org-id").removeClass('valid-hint');$(this).siblings('.valid-font').text('')}$('.class-student-form .orgType').text($(this).data('types'))})}else{$('.class-student-form select.org-id').empty();$('.class-student-form select.org-id').append(' <option value="">请选择</option>');$('.class-student-form select.org-id').niceSelect()}});$('.export-class-student-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var exportName=$('.project-name:eq(0)').text()+"学员列表.xls";var gender="";var phone="";var groupId="";var orgId="";var deptPosition="";var isFirstTraining="";var classCommitteeId="";var signUpState="";$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/exportTraineeByClass",data:{projectCode:projectCode,exportName:exportName,gender:gender,phone:phone,groupId:groupId,orgId:orgId,deptPosition:deptPosition,isFirstTraining:isFirstTraining,classCommitteeId:classCommitteeId,signUpState:signUpState}})});$('.upload-class-student-btn').on('click',function(){$('.class-student-upload-img').empty();$('.img-url-name-length').text(0);$(".class-student-upload-form").show();$yt_alert_Model.getDivPosition($(".class-student-upload-form"));$yt_model_drag.modelDragEvent($(".class-student-upload-form .yt-edit-alert-title"));$(".class-student-upload-form .yt-model-sure-btn").off().on('click',function(){var headPortraits=[];$('.class-student-upload-img .exceed').each(function(i,e){var headPortrait=$(e).find('input').val();var headPortraitName=$(e).find('span').text();var exceedName={headPortrait:headPortrait,headPortraitName:headPortraitName};headPortraits.push(exceedName)});headPortraits=JSON.stringify(headPortraits);console.log("headPortraits",headPortraits);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCheck/updateTraineeHeadPortrait",data:{headPortraits:headPortraits},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("上传成功")})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("上传失败")})}}})});$('.class-student-upload-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-upload-form").hide()})});$(".class-student-upload-form").undelegate().delegate("input[type='file']","change",function(){console.log($(this)[0].files);var imgName=$(this)[0].files;console.log(imgName[0].type);var exceedName='';var repeatName='';for(var i=0;i<imgName.length;i+=1){if(imgName[i].size>3145728){if(exceedName==""){exceedName+=imgName[i].name}else{exceedName+=","+imgName[i].name}}if(imgName[i].name.split(".")[1]!="jpg"&&imgName[i].name.split(".")[1]!="png"){if(repeatName==''){repeatName+=imgName[i].name}else{repeatName+=","+imgName[i].name}}}console.log(imgName.length);console.log(exceedName);var url=$yt_option.acl_path+"api/tAscPortraitInfo/addMultipartFiles?modelCode=headPortraits";if(exceedName==""){if(repeatName==""){$yt_baseElement.showLoading();$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:"fileNames",success:function(data,textStatus){var resultData=$.parseJSON(data);console.log("resultData",resultData.length);$("#fileNames").val("");if(resultData.success==0){$.each(resultData.obj,function(q,e){$('.exceed[fileName="'+e.naming+'"]').remove();$('.class-student-upload-img').append('<span class="exceed" fileName="'+e.naming+'"><input  type="hidden" value="'+e.pkId+'"/><span class="exceed-name">'+e.naming+'</span>，</span>');});$yt_baseElement.hideLoading();$('.img-url-name-length').text($('.class-student-upload-img .exceed').length)}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("上传照片失败")})}},error:function(data,status,e){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("上传照片失败")})}})}else{$("#pop-modle-alert").css("z-index",103);$yt_alert_Model.alertOne({haveCloseIcon:false,leftBtnName:"关闭",cancelFunction:"",alertMsg:'<div class="word-break: break-all;">'+repeatName+'</div>格式不对',cancelFunction:function(){$("#pop-modle-alert").css("z-index",100).show()}})}}else{$("#pop-modle-alert").css("z-index",103);$yt_alert_Model.alertOne({haveCloseIcon:false,leftBtnName:"关闭",cancelFunction:"",alertMsg:'<div class="word-break: break-all;">'+exceedName+'</div>大小超过3M',cancelFunction:function(){$("#pop-modle-alert").css("z-index",100).show()}})}});$('.mail-list-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");var sort='';var orderType='';$yt_baseElement.showLoading();$('.class-student-mail-form .page-info').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/traineeCheck/getClassTrainee",type:"post",data:{projectCode:projectCode,sort:sort,orderType:orderType},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.class-student-mail-form .student-msg tbody');var htmlTr='';var num=1;$(htmlTbody).empty();if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}htmlTr='<tr><td >'+v.realName+'</td><td style="text-align: center;">'+v.gender+'</td><td>'+v.phone+'</td><td>'+v.groupName+'</td><td>'+v.deptPosition+'</td><td style="text-align:center;"><a class="yt-link" href="'+v.headPortrait2+'">'+v.headPortraitName+'</a></td></tr>';htmlTbody.append(htmlTr)})}else{htmlTr='<tr class="class-tr"><td colspan="6" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true });$(".class-student-mail-form").show();$yt_alert_Model.getDivPosition($(".class-student-mail-form"));$yt_model_drag.modelDragEvent($(".class-student-mail-form .yt-edit-alert-title"));$('.class-student-mail-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-mail-form").hide()})});var clickNum=1;$('.class-student-mail-form .yt-model-sure-btn').on('click',function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCheck/getTraineeCheck",data:{projectCode:projectCode,fileType:2},async:true,success:function(data){var htmlBody=$('.class-student-print-form .pring-list tbody');var htmlr='';htmlBody.empty();if(data.flag==0){if(data.data.length!=0){$('.again-print-btn').show();$('.print-opera span').eq(0).show();$('.pring-list').show();$('.print-opera').hide();$.each(data.data,function(i,p){htmlr='<tr><td style="text-align: center;">'+p.createTimeString+'</td><td style="text-align: center;">'+p.createUser+'</td><td><a href="'+p.fileUrl+'" class="yt-link">'+p.fileName+'</a></td><td style="text-align: right;">'+p.printerCount+'</td>';if(p.states=="2"){p.states="打印完成";htmlr+='<td class="colour-yellow" style="text-align: center;">'+p.states+'</td></tr>'}else if(p.states=="3"){p.states="待打印";htmlr+='<td class="colour-blue" style="text-align: center;">'+p.states+'</td></tr>'}else if(p.states=="4"){p.states="已作废";htmlr+='<td class="colour-blue" style="text-align: center;">'+p.states+'</td></tr>'}else if(p.states=="5"){p.states="未打印";htmlr+='<td style="text-align: center;">'+p.states+'</td></tr>'}htmlBody.append(htmlr)})}else{$('.pring-list').hide();$('.print-opera').show();$('.print-opera span').eq(0).hide();$('.print-opera .print-file-name').hide();$('.again-print-btn').hide()}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading()}}});$('.class-student-print-form .again-print-btn').off().on('click',function(){$('.class-student-print-form .print-file-name a').text("");$('.class-student-print-form .print-count-num').val("");$('.print-opera').show()});$('.print-opera .generate-excel-btn').off().on('click',function(){$('.print-opera .print-file-name').show();var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCheck/getPrintingExcel",data:{projectCode:projectCode},async:true,success:function(data){if(data.flag==0){$('.print-opera .file-id').val(data.data.fileId);$('.print-opera .print-file-name a').text(data.data.fileName);$('.print-opera .print-file-name a').attr('href',data.data.fileUrl);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("生成excel失败")})}}})});$('.class-student-print-form .yt-eidt-model-bottom .yt-model-sure-btn').off().on('click',function(){clickNum=2;var projectCode=$yt_common.GetQueryString("projectCode");var fileId=$('.print-opera .file-id').val();var fileName=$('.print-opera .print-file-name a').text();var printerCount=$('.print-opera .print-count-num').val();var fileType=2;var states=3;var pringingData={projectCode:projectCode,fileId:fileId,fileName:fileName,printerCount:printerCount,fileType:fileType,states:states};pringingData=JSON.stringify(pringingData);console.log(pringingData);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCheck/addPrinting",data:{pringingData:pringingData},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("打印成功");$(".class-student-print-form").hide()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("打印失败")})}}})});$(".class-student-mail-form").hide();$(".class-student-print-form").show();$yt_alert_Model.getDivPosition($(".class-student-print-form"));$yt_model_drag.modelDragEvent($(".class-student-print-form .yt-edit-alert-title"));$('.class-student-print-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-print-form").hide();$(".class-student-mail-form").show()})});$('.report-class-student-btn').off().on('click',function(){var studentList=$('.student-report-div .yt-table-active').data('studentList');if(studentList!=null){var checkInState=1;studentReport.reportInterface(checkInState)}else{$yt_alert_Model.prompt("请选择一条进行操作")}});$('.no-report-class-student-btn').off().on('click',function(){var studentList=$('.student-report-div .yt-table-active').data('studentList');if(studentList!=null){var checkInState=0;studentReport.reportInterface(checkInState)}else{$yt_alert_Model.prompt("请选择一条进行操作")}});$('.add-class-student-btn').on('click',function(){traineeId="";$('.class-student-form .yt-edit-alert-title-msg').text("新增学员");$('.class-student-form .class-student-name').val("");$('.class-student-form .class-student-group-num').val("");;$('.class-student-form .class-student-name').parent().parent().nextAll().find('input[type="radio"][value="1"]').setRadioState("check");$('.class-student-form .student-nation').setSelectVal("");$('.class-student-form .class-student-phone').val("");$('.class-student-form .card-type').setSelectVal("");$('.class-student-form .id-number').val("");$('.class-student-form .group-id-elementary').setSelectVal("");$('.class-student-form .org-id').setSelectVal("");$('.class-student-form .student-msg .dept-name').val("");var positionName="";$('.class-student-form .student-invoice-type').setSelectVal("");$('.class-student-form .student-invoice-name').val("");$('.class-student-form .student-invoice-duty').val("");$('.class-student-form .student-invoice-address').val("");$('.class-student-form .student-invoice-phone').val("");$('.class-student-form .student-invoice-open-bank').val("");$('.class-student-form .student-invoice-acc').val("");$('.class-student-form .date-birth').val();$('.class-student-form .org-type').setSelectVal("");$('.class-student-form .mailing-address').val("");$('.class-student-form .postal-code').val("");$('.class-student-form .class-student-fax').val("");$('.class-student-form .party-date').val();$('.class-student-form .education-time').val("");$('.class-student-form .education-time-class').val("");$('.class-student-form .service-time').val("");$('.class-student-form .service-time-class').val("");$('.class-student-form .telephone-project').val("");$('.class-student-form .class-student-email').val("");$('.class-student-form .work-time').val("");$(".class-student-form").show();$yt_alert_Model.setFiexBoxHeight($(".class-student-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".class-student-form"));$yt_model_drag.modelDragEvent($(".class-student-form .yt-edit-alert-title"));$('.class-student-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-form").hide();$("#pop-modle-alert").hide()})});$('.update-class-student-btn').on('click',function(){traineeId=$(".student-report-div .yt-table-active .trainee-id").val();var studentList=$('.student-report-div .yt-table-active').data('studentList');console.log('studentList',studentList);if(studentList!=null){var studentDetailedmsg=studentReport.getStudentDetailedMsg();console.log('studentReport.studentDetailedmsg',studentDetailedmsg);$('.class-student-form .yt-edit-alert-title-msg').text("修改学员");$('.class-student-form').setDatas(studentDetailedmsg);$('.class-student-form .class-student-name').parent().parent().nextAll().find('input[type="radio"][value="'+studentDetailedmsg.gender+'"]').setRadioState("check");$('.class-student-form .student-nation').setSelectVal(studentDetailedmsg.nationId);$('.class-student-form .card-type').setSelectVal(studentDetailedmsg.idType);$('.class-student-form .group-id-elementary').setSelectVal(studentDetailedmsg.groupId);groupId=studentDetailedmsg.groupId;var companyList=studentReport.getCompanyList(groupId);if(companyList!=""){$('.class-student-form select.org-id').empty();$('.class-student-form select.org-id').append(' <option value="">请选择</option>');$.each(companyList,function(i,o){if(i!=0){$('.class-student-form select.org-id').append(' <option value="'+o.groupId+'">'+o.groupName+'</option>').data('types',o.types)}});$('.class-student-form select.org-id').niceSelect();$(".class-student-form select.org-id").off().change(function(){if($(this).val()!=''){$("div.org-id").removeClass('valid-hint');$(this).siblings('.valid-font').text('')}$('.class-student-form .orgType').text($(this).data('types'))})}else{$('.class-student-form select.org-id').empty();$('.class-student-form select.org-id').append(' <option value="">请选择</option>');$('.class-student-form select.org-id').niceSelect()}$('.class-student-form .org-id').setSelectVal(studentDetailedmsg.groupOrgId);$('.class-student-form .student-invoice-type').setSelectVal(studentDetailedmsg.invoiceType);$('.class-student-form .org-type').setSelectVal(studentDetailedmsg.orgType);me.oldStudentDataMsg.gender==1?me.oldStudentDataMsg.genderVal='男':me.oldStudentDataMsg.genderVal='女';if(me.oldStudentDataMsg.invoiceType==1){me.oldStudentDataMsg.invoiceTypeVel='普通发票'}else if(me.oldStudentDataMsg.invoiceType==2){me.oldStudentDataMsg.invoiceTypeVel='增值税发票'}me.oldStudentDataMsg.nationName=$('.class-student-form select.student-nation option:selected').text();me.oldStudentDataMsg.idTypeName=$('.class-student-form select.card-type option:selected').text();$(".class-student-form").show();$yt_alert_Model.setFiexBoxHeight($(".class-student-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".class-student-form"));$yt_model_drag.modelDragEvent($(".class-student-form .yt-edit-alert-title"));$('.class-student-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".class-student-form").hide();$("#pop-modle-alert").hide()})}else{$yt_alert_Model.prompt("请选择一行进行修改")}});$(".class-student-form .yt-model-sure-btn").on('click',function(){var afterJson={projectCode:$yt_common.GetQueryString("projectCode"),groupName:$('.class-student-form select.group-id-elementary option:selected').text(),groupOrgName:$('.class-student-form select.org-id option:selected').text(),nationName:$('.class-student-form select.student-nation option:selected').text(),idTypeName:$('.class-student-form select.card-type option:selected').text(),invoiceTypeVel:$('.class-student-form select.student-invoice-type option:selected').text(),realName:$('.class-student-form .class-student-name').val(),groupNum:$('.class-student-form .class-student-group-num').val(),gender:$('.class-student-form .class-student-name').parent().parent().nextAll().find('input[type="radio"]:checked').val(),nationId:$('.class-student-form .student-nation').val(),phone:$('.class-student-form .class-student-phone').val(),idType:$('.class-student-form .card-type').val(),idNumber:$('.class-student-form .id-number').val(),groupId:$('.class-student-form .group-id-elementary').val(),orgId:$('.class-student-form .org-id').val(),deptName:$('.class-student-form .student-msg .dept-name').val(),positionName:"",invoiceType:$('.class-student-form .student-invoice-type').val(),orgName:$('.class-student-form .student-invoice-name').val(),taxNumber:$('.class-student-form .student-invoice-duty').val(),address:$('.class-student-form .student-invoice-address').val(),telephoneProject:$('.class-student-form .student-invoice-phone').val(),registeredBank:$('.class-student-form .student-invoice-open-bank').val(),account:$('.class-student-form .student-invoice-acc').val(),dateBirth:$('.class-student-form .date-birth').val(),orgType:$('.class-student-form .org-type').val(),mailingAddress:$('.class-student-form .mailing-address').val(),postalCode:$('.class-student-form .postal-code').val(),fax:$('.class-student-form .class-student-fax').val(),partyDate:$('.class-student-form .party-date').val(),educationTime:$('.class-student-form .education-time').val(),educationTimeClass:$('.class-student-form .education-time-class').val(),serviceTime:$('.class-student-form .service-time').val(),serviceTimeClass:$('.class-student-form .service-time-class').val(),telephone:$('.class-student-form .telephone-project').val(),email:$('.class-student-form .class-student-email').val(),workTime:$('.class-student-form .work-time').val()};afterJson.gender==1?afterJson.genderVal='男':afterJson.genderVal='女';if(traineeId!=''){operationContent='修改操作：【'+studentReport.oldStudentDataMsg.realName+'】，'+studentList.getLogInfo(studentList.StudentJsonName,studentReport.oldStudentDataMsg,afterJson)}if(afterJson.phone!=""){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/addOrUpdateTrainee",data:{traineeId:traineeId,projectCode:afterJson.projectCode,realName:afterJson.realName,groupNum:afterJson.groupNum,gender:afterJson.gender,nationId:afterJson.nationId,phone:afterJson.phone,idNumber:afterJson.idNumber,groupId:afterJson.groupId,orgId:afterJson.orgId,deptName:afterJson.deptName,positionName:afterJson.positionName,invoiceType:afterJson.invoiceType,orgName:afterJson.orgName,taxNumber:afterJson.taxNumber,address:afterJson.address,telephoneProject:afterJson.telephoneProject,registeredBank:afterJson.registeredBank,account:afterJson.account,idType:afterJson.idType,dateBirth:afterJson.dateBirth,orgType:afterJson.orgType,mailingAddress:afterJson.mailingAddress,postalCode:afterJson.postalCode,fax:afterJson.fax,partyDate:afterJson.partyDate,educationTime:afterJson.educationTime,educationTimeClass:afterJson.educationTimeClass,serviceTime:afterJson.serviceTime,serviceTimeClass:afterJson.serviceTimeClass,linkman:studentReport.oldStudentDataMsg.linkman,linkmanPhone:studentReport.oldStudentDataMsg.linkmanPhone,linkmanTelephone:studentReport.oldStudentDataMsg.linkmanTelephone,linkmanFax:studentReport.oldStudentDataMsg.linkmanFax,linkmanEmail:studentReport.oldStudentDataMsg.linkmanEmail,linkmanAddressEmail:studentReport.oldStudentDataMsg.linkmanAddressEmail,telephone:afterJson.telephone,email:afterJson.email,workTime:afterJson.workTime,operationContent:operationContent},async:true,success:function(data){if(data.flag==0){console.log("traineeId",traineeId);$yt_baseElement.hideLoading(function(){if(traineeId==""){$yt_alert_Model.prompt("添加成功")}else{$yt_alert_Model.prompt("修改成功")}studentReport.getStudentReport();$(".class-student-form").hide()})}else{$yt_baseElement.hideLoading(function(){if(traineeId==""){$yt_alert_Model.prompt("添加失败")}else{$yt_alert_Model.prompt("修改失败")}studentReport.getStudentReport();$(".class-student-form").hide()})}}})}else{$yt_valid.validForm($(".valid-tab1"))}})},losFfocus:function(){$('.student-invoice-duty').blur(function(){$(this).val($(this).val().toUpperCase())})},oldStudentDataMsg:{},getStudentDetailedMsg:function(){var me=this;var traineeId=$(".student-report-div .yt-table-active .trainee-id").val();var studentDetailedMsg;var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeDetails",data:{traineeId:traineeId,projectId:projectCode},async:false,success:function(data){if(data.flag==0){studentDetailedMsg=data.data;me.oldStudentDataMsg=data.data;$yt_baseElement.hideLoading()}}});return studentDetailedMsg},reportInterface:function(checkInState){var projectCode=$yt_common.GetQueryString("projectCode");var studentList=$('.student-report-div .yt-table-active').data('studentList');var traineeId=studentList.traineeId;$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCheck/updateCheckState",data:{projectCode:projectCode,traineeId:traineeId,checkInState:checkInState},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("设置成功");studentReport.getStudentReport()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("设置失败");studentReport.getStudentReport()})}}})},getNationList:function(){var nationList=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/getNations",data:{searchParameters:""},async:false,success:function(data){if(data.flag==0){console.log("成功");$.each(data.data,function(a,b){nationList.push(b)})}}});return nationList},getGroupList:function(){var groupList=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/group/getGroups",data:{isSelectGroup:1},async:false,success:function(data){if(data.flag==0){$.each(data.data,function(a,b){groupList.push(b)})}}});return groupList},getCompanyList:function(groupId){var companyList=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/group/getGroups",data:{isSelectGroup:2,groupId:groupId},async:false,success:function(data){if(data.flag==0){$.each(data.data,function(a,b){companyList.push(b)})}}});return companyList},getStudentReport:function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.student-report-div .keyword').val();var gender="";var phone="";var groupId="";var orgId="";var deptPosition="";var isFirstTraining="";var classCommitteeId="";var signUpState="";var checkInState="";var sort="";var orderType="";$('.student-report-div .page-info').eq(0).pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/trainee/getClassTrainee",type:"post",data:{projectCode:projectCode,selectParam:selectParam,gender:gender,phone:phone,groupId:groupId,orgId:orgId,deptPosition:deptPosition,isFirstTraining:isFirstTraining,classCommitteeId:classCommitteeId,signUpState:signUpState,checkInState:checkInState,sort:sort,orderType:orderType},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.student-report-div .list-tbody');var htmlTr='';var num=1;$(htmlTbody).empty();if(data.data.rows.length>0){$('.student-report-div .page-info').show();$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}if(v.isFirstTraining==0){v.isFirstTraining="不是"}else{v.isFirstTraining="是"}htmlTr='<tr><td style="text-align: center;"><input type="hidden" value="'+v.pkId+'" class="pkId">'+v.groupNum+'</td><td style="text-align: left;"><input type="hidden" value="'+v.traineeId+'" class="trainee-id"><a href="#" class="real-name-inf" style=" color:#3c4687;word-break: break-all;">'+v.realName+'</a></td><td style="text-align: center;">'+v.gender+'</td><td style="text-align: center;">'+v.phone+'</td><td>'+v.groupName+'</td><td>'+v.orgName+'</td><td>'+v.deptName+'</td><td>'+v.classCommitteeName+'</td><td style="text-align: center;">'+v.isFirstTraining+'</td>';if(v.checkInState==0){v.checkInState="未报到";htmlTr+='<td class="colour-yellow" style="text-align: center;">'+v.checkInState+'</td></tr>'}else{v.checkInState="已报到";htmlTr+='<td class="colour-blue" style="text-align: center;">'+v.checkInState+'</td></tr>'}htmlTr=$(htmlTr).data('studentList',v);htmlTbody.append(htmlTr)})}else{$('.student-report-div .page-info').hide();htmlTr='<tr class="class-tr"><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getDifferentList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getHotelTraineeToClassTrainee",data:{projectCod:projectCode},async:true,success:function(data){var htmlBody=$('.different-student-list tbody ');var htmlTr='';var num=1;if(data.flag==0){if(data.data.length>0){htmlBody.parent().parent().show();$.each(data.data,function(k,b){htmlTr='<tr><td>'+num++ +'</td><td>'+b.traineeName+'</td><td>'+b.gender+'</td><td>'+b.idNumber+'</td><td>'+b.roomNumber+'</td><td>'+b.createTimeString+'</td><td>'+b.reason+'</td></tr>';htmlBody.append(htmlTr)})}else{htmlBody.parent().parent().hide()}}else{$yt_alert_Model.prompt("查询失败")}}})}};var payTicket={init:function(){var me=this;$(".ticket-class-student-form .student-nation").niceSelect();$(".ticket-class-student-form .card-types").niceSelect();$(".ticket-class-student-form .group-id-elementary").niceSelect();$(".ticket-class-student-form .org-ids").niceSelect();$(".ticket-class-student-form .org-types").niceSelect();$(".ticket-class-student-form .student-invoice-types").niceSelect();console.log("缴费开票获取民族",studentList.getStudentNationList());var tickStudentNation=studentList.getStudentNationList();if(tickStudentNation.length!=0){$.each(tickStudentNation,function(i,n){$(".ticket-class-student-form .student-nation").append('<option value="'+n.nationId+'">'+n.nationName+'</option>')});$(".ticket-class-student-form .student-nation").niceSelect()}var tickGroup=studentList.getStudentGroupList();console.log("缴费开票获取集团",tickGroup);if(tickGroup.lenghth!=0){$.each(tickGroup,function(i,b){$(".ticket-class-student-form .group-id-elementary").append('<option value="'+b.groupId+'">'+b.groupName+'</option>')});$(".ticket-class-student-form .group-id-elementary").niceSelect()}$('.pay-ticket-open-div .tab-content label input').change(function(){var reconciliationState=0;var invoiceState=0;var reconciliationList=$('.pay-ticket-open-div .tab-content label input[name="reconciliationState"]:checked');var invoiceList=$('.pay-ticket-open-div .tab-content label input[name="invoiceState"]:checked');console.log(reconciliationList+'-----'+invoiceList);if(reconciliationList.length!=2){reconciliationState=reconciliationList.val()}else{reconciliationState=2}if(invoiceList.length!=2){invoiceState=invoiceList.val()}else{invoiceState=2}payTicket.PayTicketList(reconciliationState,invoiceState)});$('.pay-ticket-open-div .search-btn').click(function(){var reconciliationState=0;var invoiceState=0;var reconciliationList=$('.pay-ticket-open-div .tab-content label input[name="reconciliationState"]:checked');var invoiceList=$('.pay-ticket-open-div .tab-content label input[name="invoiceState"]:checked');console.log(reconciliationList+'-----'+invoiceList);if(reconciliationList.length!=2){reconciliationState=reconciliationList.val()}else{reconciliationState=2}if(invoiceList.length!=2){invoiceState=invoiceList.val()}else{invoiceState=2}payTicket.PayTicketList(reconciliationState,invoiceState)});$('.pay-ticket-open-div .list-table tbody').on('click','.see-ticket',function(){$(".invoice-type-info").text("");$(".org-name-info").text("");$(".tax-number-info").text("");$(".address-info").text("");$(".telephone-info").text("");$(".registered-bank-info").text("");$(".account-info").text("");var traineeId=$(this).parent().parent().find('.trainee-id').val();var inspectTicketList=payTicket.inspectTicketList(traineeId);console.log("inspectTicketList",inspectTicketList);$(".look-billing-inf-alert").setDatas(inspectTicketList);$(".look-billing-inf-alert").show();$yt_alert_Model.getDivPosition($(".look-billing-inf-alert"));$yt_model_drag.modelDragEvent($(".look-billing-inf-alert .yt-edit-alert-title"));$('.look-billing-inf-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".look-billing-inf-alert").hide()})});$(".pay-ticket-open-div").off('click').on('click','.pay-student-name',function(){var traineeId=$(this).parent().parent().find('.trainee-id').val();var headImg=new Image();var ticketStudentDetail=payTicket.ticketStudentDetail(traineeId);if(ticketStudentDetail.idType==1){$(".pay-id-type").text("身份证")}else if(ticketStudentDetail.idType==2){$(".pay-id-type").text("护照")}else if(ticketStudentDetail.idType==3){$(".pay-id-type").text("军官证")}else if(ticketStudentDetail.idType==4){$(".pay-id-type").text("其他")}if(ticketStudentDetail.gender==1){ticketStudentDetail.gender="男"}else{ticketStudentDetail.gender="女"}if(ticketStudentDetail.invoiceType==0){ticketStudentDetail.invoiceType="暂不开票"}else if(ticketStudentDetail.invoiceType==1){ticketStudentDetail.invoiceType="普通发票"}else{ticketStudentDetail.invoiceType="增值税发票"}if(ticketStudentDetail.checkInState==0){ticketStudentDetail.checkInState="未报到"}else{ticketStudentDetail.checkInState="已报到"}if(ticketStudentDetail.paymentState==0){ticketStudentDetail.paymentState="未对账"}else{ticketStudentDetail.paymentState="已对账"}if(ticketStudentDetail.isOrderNum==0){ticketStudentDetail.isOrderNum="未开票"}else{ticketStudentDetail.isOrderNum="已开票"}if(ticketStudentDetail.headPortrait!=""){headImg.src=ticketStudentDetail.headPortraitUrl;headImg.onload=function(){$('.pay-student-details-form .student-details-img').attr('src',headImg.src);$('.pay-student-details-form .student-details-img').jqthumb({width:89,height:130})}}else{$('.pay-student-details-form .student-details-img').attr('src','../../resources/images/classStudent/student-picture.png');$('.pay-student-details-form .student-details-img').jqthumb({width:89,height:130})}$('.pay-student-details-form').setDatas(ticketStudentDetail);$('.pay-student-details-form').show();$yt_alert_Model.setFiexBoxHeight($(".pay-student-details-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".pay-student-details-form"));$yt_model_drag.modelDragEvent($(".pay-student-details-form .yt-edit-alert-title"));$('.pay-student-details-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".pay-student-details-form").hide()})});$(".ticket-class-student-form select.group-id-elementary").change(function(){var groupId=$(this).val();var tickCompany=studentList.getStudentCompanyList(groupId);console.log("缴费开票获取单位",tickCompany);if(tickCompany.length!=0){$(".ticket-class-student-form select.org-ids").empty();$('.ticket-class-student-form .orgTypes').text('');$(".ticket-class-student-form select.org-ids").append('<option value="">请选择</option>');$.each(tickCompany,function(i,a){if(i!=0){console.log(i);$(".ticket-class-student-form select.org-ids").append('<option value="'+a.groupId+'">'+a.groupName+'</option>').data('types',a.types)}});$(".ticket-class-student-form select.org-ids").niceSelect();$("select.org-ids").off().change(function(){if($(this).val()!=''){$("div.org-ids").removeClass('valid-hint');$(this).siblings('.valid-font').text('')}$('.ticket-class-student-form .orgTypes').text($(this).data('types'))})}else{$(".ticket-class-student-form select.org-ids").empty();$(".ticket-class-student-form select.org-ids").append('<option value="">请选择</option>');$(".ticket-class-student-form select.org-ids").niceSelect()}});$('.pay-ticket-open-div .ticket-update-class-student-btn').off('click').on('click',function(){$yt_baseElement.showLoading();var traineeId=$(".pay-ticket-open-div .yt-table-active .trainee-id").val();if(traineeId!=null){var payStudent=payTicket.queryStudentDetails(traineeId);$('.ticket-class-student-form .yt-model-sure-btn').off('click').on('click',function(){payTicket.tickRepairStudent(traineeId)});console.log("payStudent",payStudent);if(payStudent!=null){$('.ticket-class-student-form').setDatas(payStudent);$('.ticket-class-student-form .class-student-name').parent().parent().nextAll().find('input[type="radio"][value="'+payStudent.gender+'"]').setRadioState("check");$('.ticket-class-student-form .student-nation').setSelectVal(payStudent.nationId);$('.ticket-class-student-form .card-types').setSelectVal(payStudent.idType);console.log(payStudent);$('.ticket-class-student-form .group-id-elementary').setSelectVal(payStudent.groupId);groupId=payStudent.groupId;var companyList=studentReport.getCompanyList(groupId);if(companyList!=""){$('.ticket-class-student-form select.org-ids').empty();$('.ticket-class-student-form select.org-ids').append(' <option value="">请选择</option>');$.each(companyList,function(i,o){if(i!=0){$('.ticket-class-student-form select.org-ids').append(' <option value="'+o.groupId+'">'+o.groupName+'</option>').data('types',o.types)}});$('.ticket-class-student-form select.org-ids').niceSelect();$(".ticket-class-student-form select.org-ids").off().change(function(){if($(this).val()!=''){$(".ticket-class-student-form div.org-ids").removeClass('valid-hint');$(this).siblings('.valid-font').text('')}console.log($(this).data('types'));$('.ticket-class-student-form .orgTypes').text($(this).data('types'))})}else{$('.ticket-class-student-form select.org-ids').empty();$('.ticket-class-student-form select.org-ids').append(' <option value="">请选择</option>');$('.ticket-class-student-form select.org-ids').niceSelect()}$('.ticket-class-student-form .org-ids').setSelectVal(payStudent.groupOrgId);$('.ticket-class-student-form .orgTypes').text($('.ticket-class-student-form select.org-ids').data('types'));$('.ticket-class-student-form .student-invoice-types').setSelectVal(payStudent.invoiceType);$('.ticket-class-student-form .orgTypes').setSelectVal(payStudent.orgType);me.oldStudentDataMsg.gender==1?me.oldStudentDataMsg.genderVal='男':me.oldStudentDataMsg.genderVal='女';if(me.oldStudentDataMsg.invoiceType==1){me.oldStudentDataMsg.invoiceTypeVel='普通发票'}else if(me.oldStudentDataMsg.invoiceType==2){me.oldStudentDataMsg.invoiceTypeVel='增值税发票'}me.oldStudentDataMsg.nationName=$('.ticket-class-student-form select.student-nation option:selected').text();me.oldStudentDataMsg.idTypeName=$('.ticket-class-student-form select.card-type option:selected').text();$('.ticket-class-student-form').show();$yt_alert_Model.setFiexBoxHeight($(".ticket-class-student-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".ticket-class-student-form"));$yt_model_drag.modelDragEvent($(".ticket-class-student-form .yt-edit-alert-title"));$('.ticket-class-student-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".ticket-class-student-form").hide()})}else{$yt_alert_Model.prompt("查询失败")}}else{$yt_alert_Model.prompt("请选择一条数据")}$yt_baseElement.hideLoading()});$('.pay-ticket-open-div .ticket-export-class-student-btn').click(function(){console.log("导出");var reconciliationState=0;var invoiceState=0;var reconciliationList=$('.pay-ticket-open-div .tab-content label input[name="reconciliationState"]:checked');var invoiceList=$('.pay-ticket-open-div .tab-content label input[name="invoiceState"]:checked');if(reconciliationList.length!=2){reconciliationState=reconciliationList.val()}else{reconciliationState=2}if(invoiceList.length!=2){invoiceState=invoiceList.val()}else{invoiceState=2}payTicket.ticketExport(reconciliationState,invoiceState)});$('.pay-ticket-open-div .ticket-add-class-student-btn').off('click').on('click',function(){$(".ticket-import-form").show();$yt_alert_Model.getDivPosition($(".ticket-import-form"));$yt_model_drag.modelDragEvent($(".ticket-import-form .yt-edit-alert-title"));$('.ticket-import-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".ticket-import-form").hide()})})},inspectTicketList:function(traineeId){var inspectTicketList;var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"finance/projectInvoice/getInvoice",data:{traineeOrGroupId:traineeId,projectCode:projectCode,types:2},async:false,success:function(data){if(data.flag==0){if(data.data.invoiceType==0){$(".invoice-type-info").text("暂不开票")}else if(data.data.invoiceType==1){$(".invoice-type-info").text("普通发票")}else if(data.data.invoiceType==2){$(".invoice-type-info").text("增值税发票")}inspectTicketList=data.data;$yt_baseElement.hideLoading()}}});return inspectTicketList},PayTicketList:function(reconciliationState,invoiceState){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$(".pay-ticket-open-div .keyword").val();var checkInState=2;$('.pay-ticket-open-div .page-info').pageInfo({async:true,pageIndexs:1,pageNum:15,before:function(){$yt_baseElement.showLoading()},url:$yt_option.base_path+"class/trainee/getClassTraineeInvoice",type:"post",data:{projectCode:projectCode,selectParam:selectParam,checkInState:checkInState,reconciliationState:reconciliationState,invoiceState:invoiceState},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.pay-ticket-open-div .list-table tbody');var htmlTr='';htmlTbody.empty();if(data.data.rows!=null){var margeStates="";var last=0;var numLengtht=1;$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else{v.gender="女"}htmlTr='<tr><td>'+v.groupNum+'</td><input type="hidden" value="'+v.traineeId+'" class="trainee-id"><td style="text-align:left;"><a class="yt-link pay-student-name" style="color:#3c4687;">'+v.realName+'</a></td><td>'+v.gender+'</td><td class="text-overflow">'+v.phone+'</td><td class="text-overflow" style="text-align:left;">'+v.groupOrgName+'</td><td class="tl" style="text-align: center !important;"><a class="yt-link see-ticket">查看</a></td>';if(v.checkInState==1){v.checkInState="已报到";htmlTr+='<td class="colour-blue" style="text-align: center !important;">'+v.checkInState+'</td>'}else{v.checkInState="未报到";htmlTr+='<td class="colour-yellow" style="text-align: center !important;">'+v.checkInState+'</td>'}htmlTr+='<td class="tr">'+v.amountReceivable+'</td>';if(v.reconciliationState==1){v.reconciliationState="已对账";htmlTr+='<td class="colour-blue">'+v.reconciliationState+'</td>'}else{v.reconciliationState="未对账";htmlTr+='<td class="colour-yellow">'+v.reconciliationState+'</td>'}if(v.orderNum!=margeStates){$('.pay-ticket-open-div .list-table tbody tr').eq(last).find('td').eq(9).attr('rowspan',numLengtht);$('.pay-ticket-open-div .list-table tbody tr').eq(last).find('td').eq(10).attr('rowspan',numLengtht);htmlTr+='<td></td>';if(v.invoiceState==1){v.invoiceState="未开票";htmlTr+='<td class="colour-yellow">'+v.invoiceState+'</td>'}else{v.invoiceState="已开票";htmlTr+='<td class="colour-blue">'+v.invoiceState+'</td>'}if($('.pay-ticket-open-div .list-table tbody tr').eq(last).find('td').eq(9).attr('rowspan')!=1){$('.pay-ticket-open-div .list-table tbody tr').eq(last).find('td').eq(9).addClass('colour-yellow');$('.pay-ticket-open-div .list-table tbody tr').eq(last).find('td').eq(9).text("合并开票")}else{$('.pay-ticket-open-div .list-table tbody tr').eq(last).find('td').eq(9).removeClass('colour-yellow')}margeStates=v.orderNum;last=i;numLengtht=1}else{numLengtht+=1}htmlTr+='</tr>';$('.pay-ticket-open-div .list-table tbody tr').eq(last).find('td').eq(9).attr('rowspan',numLengtht);$('.pay-ticket-open-div .list-table tbody tr').eq(last).find('td').eq(10).attr('rowspan',numLengtht);htmlTbody.append(htmlTr)});$('.pay-ticket-open-div .page-info').show()}else{$('.pay-ticket-open-div .page-info').hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="11" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},ticketExport:function(reconciliationState,invoiceState){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$(".pay-ticket-open-div .keyword").val();var checkInState=2;$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/exportTraineeList",data:{projectCode:projectCode,selectParam:selectParam,checkInState:checkInState,reconciliationState:reconciliationState,invoiceState:invoiceState}})},ticketStudentDetail:function(traineeId){var projectCode=$yt_common.GetQueryString("projectCode");var ticketStudentDetail;$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"finance/projectInvoice/getTraineeDetails",data:{traineeId:traineeId,projectId:projectCode},async:false,success:function(data){if(data.flag==0){ticketStudentDetail=data.data;$yt_baseElement.hideLoading();}}});return ticketStudentDetail},oldStudentDataMsg:{},queryStudentDetails:function(traineeId){var me=this;var studentDetailedMsg;var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeDetails",data:{traineeId:traineeId,projectId:projectCode},async:false,success:function(data){if(data.flag==0){studentDetailedMsg=data.data;me.oldStudentDataMsg=data.data;$yt_baseElement.hideLoading()}}});return studentDetailedMsg},tickRepairStudent:function(traineeId){var me=this;var afterJson={projectCode:$yt_common.GetQueryString("projectCode"),groupName:$('.ticket-class-student-form select.group-id-elementary option:selected').text(),groupOrgName:$('.ticket-class-student-form select.org-ids option:selected').text(),nationName:$('.ticket-class-student-form select.student-nation option:selected').text(),idTypeName:$('.ticket-class-student-form select.card-types option:selected').text(),invoiceTypeVel:$('.ticket-class-student-form select.student-invoice-types option:selected').text(),realName:$('.ticket-class-student-form .class-student-name').val(),groupNum:$('.ticket-class-student-form .class-student-group-num').val(),gender:$('.ticket-class-student-form .class-student-name').parent().parent().nextAll().find('input[type="radio"]:checked').val(),nationId:$('.ticket-class-student-form .student-nation').val(),phone:$('.ticket-class-student-form .class-student-phone').val(),idType:$('.ticket-class-student-form .card-types').val(),idNumber:$('.ticket-class-student-form .id-number').val(),groupId:$('.ticket-class-student-form .group-id-elementary').val(),orgId:$('.ticket-class-student-form .org-ids').val(),deptName:$('.ticket-class-student-form .student-msg .dept-name').val(),positionName:"",invoiceType:$('.ticket-class-student-form .student-invoice-types').val(),orgName:$('.ticket-class-student-form .student-invoice-name').val(),taxNumber:$('.ticket-class-student-form .student-invoice-duty').val(),address:$('.ticket-class-student-form .student-invoice-address').val(),telephoneProject:$('.ticket-class-student-form .student-invoice-phone').val(),registeredBank:$('.ticket-class-student-form .student-invoice-open-bank').val(),account:$('.ticket-class-student-form .student-invoice-acc').val(),dateBirth:$('.ticket-class-student-form .date-birth').val(),orgType:$('.ticket-class-student-form .org-type').val(),mailingAddress:$('.ticket-class-student-form .mailing-address').val(),postalCode:$('.ticket-class-student-form .postal-code').val(),fax:$('.ticket-class-student-form .class-student-fax').val(),partyDate:$('.ticket-class-student-form .party-date').val(),educationTime:$('.ticket-class-student-form .education-time').val(),educationTimeClass:$('.ticket-class-student-form .education-time-class').val(),serviceTime:$('.ticket-class-student-form .service-time').val(),serviceTimeClass:$('.ticket-class-student-form .service-time-class').val(),telephone:$('.ticket-class-student-form .telephone-project').val(),email:$('.ticket-class-student-form .class-student-email').val(),workTime:$('.ticket-class-student-form .work-time').val()};afterJson.gender==1?afterJson.genderVal='男':afterJson.genderVal='女';if(traineeId!=''){var operationContent='修改操作：【'+payTicket.oldStudentDataMsg.realName+'】，'+studentList.getLogInfo(studentList.StudentJsonName,payTicket.oldStudentDataMsg,afterJson)}if(afterJson.phone!=""){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/addOrUpdateTrainee",data:{traineeId:traineeId,projectCode:afterJson.projectCode,realName:afterJson.realName,groupNum:afterJson.groupNum,gender:afterJson.gender,nationId:afterJson.nationId,phone:afterJson.phone,idNumber:afterJson.idNumber,groupId:afterJson.groupId,orgId:afterJson.orgId,deptName:afterJson.deptName,positionName:afterJson.positionName,invoiceType:afterJson.invoiceType,orgName:afterJson.orgName,taxNumber:afterJson.taxNumber,address:afterJson.address,telephoneProject:afterJson.telephoneProject,registeredBank:afterJson.registeredBank,account:afterJson.account,idType:afterJson.idType,dateBirth:afterJson.dateBirth,orgType:afterJson.orgType,mailingAddress:afterJson.mailingAddress,postalCode:afterJson.postalCode,fax:afterJson.fax,partyDate:afterJson.partyDate,educationTime:afterJson.educationTime,educationTimeClass:afterJson.educationTimeClass,serviceTime:afterJson.serviceTime,serviceTimeClass:afterJson.serviceTimeClass,linkman:payTicket.oldStudentDataMsg.linkman,linkmanPhone:payTicket.oldStudentDataMsg.linkmanPhone,linkmanTelephone:payTicket.oldStudentDataMsg.linkmanTelephone,linkmanFax:payTicket.oldStudentDataMsg.linkmanFax,linkmanEmail:payTicket.oldStudentDataMsg.linkmanEmail,linkmanAddressEmail:payTicket.oldStudentDataMsg.linkmanAddressEmail,telephone:afterJson.telephone,email:afterJson.email,workTime:afterJson.workTime,operationContent:operationContent},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("修改成功");var reconciliationState=0;var invoiceState=0;var reconciliationList=$('.pay-ticket-open-div .tab-content label input[name="reconciliationState"]:checked');var invoiceList=$('.pay-ticket-open-div .tab-content label input[name="invoiceState"]:checked');console.log(reconciliationList+'-----'+invoiceList);if(reconciliationList.length!=2){reconciliationState=reconciliationList.val()}else{reconciliationState=2}if(invoiceList.length!=2){invoiceState=invoiceList.val()}else{invoiceState=2}payTicket.PayTicketList(reconciliationState,invoiceState);$(".ticket-class-student-form").hide()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("修改失败");var reconciliationState=0;var invoiceState=0;var reconciliationList=$('.pay-ticket-open-div .tab-content label input[name="reconciliationState"]:checked');var invoiceList=$('.pay-ticket-open-div .tab-content label input[name="invoiceState"]:checked');console.log(reconciliationList+'-----'+invoiceList);if(reconciliationList.length!=2){reconciliationState=reconciliationList.val()}else{reconciliationState=2}if(invoiceList.length!=2){invoiceState=invoiceList.val()}else{invoiceState=2}payTicket.PayTicketList(reconciliationState,invoiceState);$(".ticket-class-student-form").hide()})}}})}else{$yt_valid.validForm($(".valid-tab2"))}},};var leaveTube={init:function(){$('.leave-tube-div thead th ').eq(5).find('span').click(function(){var orderType=$(this).attr('orderType');console.log(orderType);if(orderType=='ASC'){$(this).attr('orderType','DESC');$(this).find('img').attr('src','../../resources/images/classStudent/pai-down.png')}else{$(this).attr('orderType','ASC');$(this).find('img').attr('src','../../resources/images/classStudent/pai-up.png')}var sort='start_time';leaveTube.leaveList(sort,orderType)});$('.leave-tube-div thead th ').eq(6).find('span').click(function(){var orderType=$(this).attr('orderType');console.log(orderType);if(orderType=='ASC'){$(this).attr('orderType','DESC');$(this).find('img').attr('src','../../resources/images/classStudent/pai-down.png')}else{$(this).attr('orderType','ASC');$(this).find('img').attr('src','../../resources/images/classStudent/pai-up.png')}var sort='create_time';leaveTube.leaveList(sort,orderType)})},leaveList:function(sort,orderType){$('.leave-tube-div .page-info').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,before:function(){$yt_baseElement.showLoading()},url:$yt_option.base_path+"class/traineeLeave/getClassTraineeLeave",type:"post",data:{sort:sort,orderType:orderType},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.leave-tube-div .leave-list-tbody');var htmlTr='';htmlTbody.empty();if(data.data.rows.length>0){$('.leave-tube-div .page-info').show();$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}htmlTr='<tr><td></td><td style="text-align:left;">'+v.realName+'</td><td>'+v.gender+'</td><td>'+v.phone+'</td><td>'+v.orgName+'</td><td>'+v.leaveTime+'</td><td>'+v.createTimeString+'</td><td style="text-align:left; class="leave-resion">'+v.leaveDetails+'</td></tr>';htmlTbody.append(htmlTr)})}else{$('.leave-tube-div .page-info').hide();htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="8" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })}};var attendance={init:function(){$('.attendance-div ').on('click','.switch-btn',function(){var switchNum=0;console.log($(this).index());var createTime=$(this).find('.switch-date').val();$(this).addClass('switch-btn-change').siblings().removeClass('switch-btn-change');if($(this).index()!=0){switchNum=1;attendance.getStudentDaySign(createTime)}else{attendance.getStudentSign()}$('.attendance-div .teacher-list-div').hide().eq(switchNum).show()});var bollen=true;},getSwitchBtn:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeAttendance/getAttendanceDate",data:{projectCode:projectCode},async:true,success:function(data){var pageBtn=$('.attendance-div .page-switch');var switchBtn='';pageBtn.empty();if(data.flag==0){switchBtn+='<button class="yt-option-btn switch-btn switch-btn-change">全员状态</button>';$.each(data.data,function(i,v){switchBtn+='<button class="yt-option-btn switch-btn"><input type="hidden" class="switch-date" value="'+v.createTime+'"/>'+v.attendanceDate+'</button>'});pageBtn.append(switchBtn);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading();console.log("页签查询失败")}}})},getStudentSign:function(){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.attendance-div .key-word').val();var gender='';var nationId='';$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+" class/traineeAttendance/getTraineeAttendanceAll",data:{projectCode:projectCode,selectParam:selectParam,gender:gender,nationId:nationId},async:true,success:function(data){var htmlBody=$('.attendance-div .student-all-sign tbody');var htmlTr='';var classNum;htmlBody.empty();if(data.flag==0){if(data.data.length!=0){$.each(data.data,function(i,n){if(n.gender==1){n.gender='男'}else{n.gender='女'}if(n.everyAttendance==n.totalAttendance){classNum='colour-blue'}else{classNum='colour-yellow'}if(n.deptPosition=="/"){n.deptPosition=""}htmlTr='<tr><td></td><td>'+n.realName+'</td><td>'+n.gender+'</td><td>'+n.nationName+'</td><td>'+n.phone+'</td><td>'+n.orgName+'</td><td>'+n.deptPosition+'</td><td class="'+classNum+'">'+n.everyAttendance+'/'+n.totalAttendance+'</td></tr>';htmlBody.append(htmlTr)})}else{htmlTr='<tr class="class-tr"><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlBody.append(htmlTr)}$yt_baseElement.hideLoading()}else{htmlTr='<tr class="class-tr"><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlBody.append(htmlTr);$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},getStudentDaySign:function(createTime){var projectCode=$yt_common.GetQueryString("projectCode");var selectParam=$('.attendance-div .key-word').val();var gender='';var nationId='';$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeAttendance/getTraineeAttendance",data:{projectCode:projectCode,createTime:createTime,selectParam:selectParam,gender:gender,nationId:nationId},async:true,success:function(data){var htmlBody=$('.attendance-div .student-sign tbody');var htmlSign='';var className;htmlBody.empty();if(data.flag==0){console.log("每日成功");if(data.data.length!=0){$.each(data.data,function(i,k){if(k.isAttendance==1){k.isAttendance='签到';classNum='colour-blue'}else{k.isAttendance='未签到';classNum='colour-yellow'}if(k.gender==1){k.gender='男'}else{k.gender='女'}if(k.deptPosition=="/"){k.deptPosition=""}else if(k.deptPosition.split("/").length!=1){k.deptPosition=k.deptPosition}else if(k.deptPosition.split("/").length==1){k.deptPosition=k.deptPosition.split("/")[0]}htmlSign='<tr><td></td><td>'+k.realName+'</td><td>'+k.gender+'</td><td>'+k.nationName+'</td><td>'+k.phone+'</td><td>'+k.orgName+'</td><td>'+k.deptPosition+'</td><td class="'+classNum+'">'+k.isAttendance+'</td></tr>';htmlBody.append(htmlSign)})}else{htmlSign='<tr class="class-tr"><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlBody.append(htmlSign)}$yt_baseElement.hideLoading()}else{htmlSign='<tr class="class-tr"><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlBody.append(htmlSign);$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})}};var certificateEnd={init:function(){var projectCode=$yt_common.GetQueryString("projectCode");$('.certificate-end-div .apply-number-btn').click(function(){certificateEnd.applyNumberData();$(".certificate-end-div .graduation-form").show();$yt_alert_Model.getDivPosition($(".certificate-end-div .graduation-form"));$yt_model_drag.modelDragEvent($(".certificate-end-div .graduation-form .yt-edit-alert-title"));$('.certificate-end-div .graduation-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".certificate-end-div .graduation-form").hide()})});$('.certificate-end-div .certificate-upload-btn').click(function(){$.ajaxDownloadFile({url:$yt_option.base_path+"class/traineeCertificateNo/exportTraineeCertificateNoByClass",data:{projectCode:projectCode}})});$('.certificate-end-div .yt-eidt-model-bottom .yt-model-sure-btn').click(function(){certificateEnd.applyEndNum()})},applyEndNum:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCertificateNo/updateTraineeCertificateNoByClass",data:{projectCode:projectCode},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交成功");$(".certificate-end-div .graduation-form").hide()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交失败")})}}})},applyNumberData:function(){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/traineeCertificateNo/getTraineeCertificateNoByClass",data:{projectCode:projectCode},async:true,success:function(data){var htmlBody=$(".certificate-end-div .apply-num-table");var htmlTr='';if(data.flag==0){console.log('编号成功');var applyData=data.data;if(applyData[0].distributionStates!=0){$(".hiden-part").show();$('.certificate-end-div .yt-eidt-model-bottom .yt-model-sure-btn').hide();$('.certificate-end-div .yt-eidt-model-bottom .yt-model-canel-btn').val("关闭");$('.certificate-end-div .yt-eidt-model-bottom .yt-model-canel-btn').css('margin','0')}else{$(".hiden-part").hide()}if(applyData[0].projectType==1){applyData[0].projectType="计划"}else if(applyData[0].projectType==2){applyData[0].projectType="委托"}else if(applyData[0].projectType==3){applyData[0].projectType="选学"}else if(applyData[0].projectType==4){applyData[0].projectType="调训"}if(applyData[0].distributionStates==1){applyData[0].distributionStates="已分配"}if(applyData[0].distributionStates==2){applyData[0].distributionStates="待分配"}$(".certificate-end-div .graduation-form").setDatas(applyData[0]);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading()}}})},getCertificateList:function(){var projectCode=$yt_common.GetQueryString("projectCode");$('.certificate-end-div .table-page').pageInfo({pageIndex:1,pageNum:15,before:function(){$yt_baseElement.showLoading()},url:$yt_option.base_path+"class/traineeCertificateNo/getClassTrainee",type:"post",async:true,data:{projectCode:projectCode},objName:'data',success:function(data){var htmlBody=$('.certificate-end-div .list-tbody');var htmlGrad='';if(data.flag==0){htmlBody.empty();if(data.data.rows.length!=0){$('.certificate-end-div .table-page').show();$.each(data.data.rows,function(i,q){if(q.gender==1){q.gender='男'}else if(q.gender==2){q.gender="女"}htmlGrad='<tr><td>'+q.groupNum+'</td><td style="text-align: left;"><input type="hidden" value="'+q.traineeId+'" class="trainee-id"/><a href="#" class="real-name-inf" style=" color:#3c4687;word-break: break-all;">'+q.realName+'</a></td><td>'+q.gender+'</td><td>'+q.phone+'</td><td>'+q.groupName+'</td><td>'+q.orgName+'</td><td>'+q.certificateNo+'</td></tr>';htmlGrad=$(htmlGrad).data("studentList",q);htmlBody.append(htmlGrad)})}else{$('.certificate-end-div .table-page').hide();htmlGrad='<tr class="class-tr"><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlBody.append(htmlGrad)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })}};var feedBack={init:function(){$('.student-feedback-div .search-btn').off('click').on('click',function(){feedBack.getFeedBackList()});$('.student-feedback-div .certificate-upload-btn').click(function(){var projectCode=$yt_common.GetQueryString("projectCode");var traineeName=$(".student-feedback-div .yt-input.key-word").val();var classCacsi='1,0';$.ajaxDownloadFile({url:$yt_option.base_path+"class/questionnaire/exportQuestionnaire",data:{projectCode:projectCode,traineeName:traineeName,classCacsi:classCacsi,isEffective:1}})});$('.student-feedback-div').off('click').on('click','.back-look-details',function(){var traineeId=$(this).parents("tr").find('input').val();feedBack.getEveryStudentDeatils(traineeId);$(".see-details-form").show();$yt_model_drag.modelDragEvent($(".see-details-form .yt-edit-alert-title"));$('.see-details-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".see-details-form").hide()})})},getEveryStudentDeatils:function(traineeId){var projectCode=$yt_common.GetQueryString("projectCode");$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"class/questionnaire/getTraineeQuestionnaire",data:{projectCode:projectCode,traineeId:traineeId},async:true,success:function(data){var htmlBody=$('.see-details-form .question-student');var indexNum=1;htmlBody.empty();if(data.flag==0){$.each(data.data,function(i,m){var detailsHtml='';detailsHtml+='<div><div class="problem-title-div" style="font-weight:bolder;font-size:16px">'+m.itemName+'</div>';if(m.itemsDetailsJson.length!=0){$.each(m.itemsDetailsJson,function(a,s){detailsHtml+='<div style="margin-left: 10px;" class="student-problem-div"><span>'+indexNum++ +'、</span>'+s.title+'</div>';if(s.types==1){detailsHtml+='<div style="margin-left: 30px;" class="star-num" data-scor="'+s.titleVakue+'"></div>'}else if(s.types==6){if(s.itemDetailsSpecific.length!=0){$.each(s.itemDetailsSpecific,function(k,j){detailsHtml+='<p>'+j.identification+'</p><span>:'+j.identificationValue+'</span>'})}}else if(s.types==2||s.types==3){detailsHtml+='<div style="margin-left: 30px;" class="problem-val-div">'+s.titleVakue+'</div>'}else if(s.types==4){detailsHtml+='<p style="margin-left: 30px;">'+s.titleVakue+'</p>'}})}detailsHtml+='</div>';htmlBody.append(detailsHtml)});$(".star-num").each(function(){$(this).raty({readOnly:true,score:function(){return $(this).attr('data-scor')},starOff:'../../resources/images/starImg/star-off.png',starOn:'../../resources/images/starImg/star-on.png '})});$yt_alert_Model.setFiexBoxHeight($(".see-details-form .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".see-details-form"));$yt_baseElement.hideLoading()}}});},getBackListHead:function(){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/questionnaire/getQuestionnaireColumn",data:{projectCode:projectCode},async:true,success:function(data){if(data.flag==0){var bacHead='';$(".backHeads").remove();$.each(data.data,function(i,n){bacHead='<th class="backHeads" style="text-align: center;">'+n.columnName+'</th>';$(".back-phone").after(bacHead)});$(".feed-back-tbody").find('.class-tr td').attr('colspan',data.data.length+6)}else{}}})},getFeedBackList:function(){var projectCode=$yt_common.GetQueryString("projectCode");var traineeName=$(".student-feedback-div .yt-input.key-word").val();var designImplementationStart="";var designImplementationEnd="";var teachingEffectStart="";var teachingEffectEnd="";var teachingActivitesStart="";var teachingActivitesEnd="";var towslsStart="";var towslsEnd="";var learningeffectStart="";var learningeffectEnd="";var characteristicStart="";var characteristicEnd="";var classCacsi='0,1';$('.student-feedback-div .page-info').pageInfo({async:true,pageIndexs:1,pageNum:15,before:function(){$yt_baseElement.showLoading()},url:$yt_option.base_path+"class/questionnaire/getClassTraineeList",type:"post",data:{projectCode:projectCode,traineeName:traineeName,designImplementationStart:designImplementationStart,designImplementationEnd:designImplementationEnd,teachingEffectStart:teachingEffectStart,teachingEffectEnd:teachingEffectEnd,teachingActivitesStart:teachingActivitesStart,teachingActivitesEnd:teachingActivitesEnd,towslsStart:towslsStart,towslsEnd:towslsEnd,learningeffectStart:learningeffectStart,learningeffectEnd:learningeffectEnd,characteristicStart:characteristicStart,characteristicEnd:characteristicEnd,classCacsi:classCacsi,isEffective:1},objName:'data',success:function(data){var feedBackBody=$(".feed-back-tbody");var feedHtml='';var num=1;if(data.flag==0){if(data.data.rows.length>0){$('.student-feedback-div .page-info').show();feedBackBody.empty();$.each(data.data.rows,function(i,v){if(v.learningEffect==""){v.learningEffect="--"}if(v.towsls==""){v.towsls="--"}if(v.characteristic==""){v.characteristic="--"}if(v.criticismSuggestion==""){v.criticismSuggestion="--"}if(v.teacherRecommendation==""){v.teacherRecommendation="--"}if(v.designImplementation==""){v.designImplementation="--"}if(v.teachingEffect==""){v.teachingEffect="--"}feedHtml='<tr><input type="hidden" value="'+v.traineeId+'" /><td>'+num++ +'</td><td>'+v.traineeName+'</td><td>'+v.phone+'</td><td>'+v.learningEffect+'</td><td>'+v.towsls+'</td><td>'+v.characteristic+'</td><td>'+v.criticismSuggestion+'</td><td>'+v.teacherRecommendation+'</td><td>'+v.designImplementation+'</td><td>'+v.teachingEffect+'</td>';if(v.classCacsi==0){feedHtml+='<td>查看</td></tr>'}else{feedHtml+='<td><a class="back-look-details" style="color:#3c4687">查看</a></td></tr>'}feedBackBody.append(feedHtml)})}else{$('.student-feedback-div .page-info').hide()}$yt_baseElement.hideLoading()}else{$('.student-feedback-div .page-info').hide();$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })}};var ytDate={formatDate:function(date){var myyear=date.getFullYear();var mymonth=date.getMonth()+1;var myweekday=date.getDate();if(mymonth<10){mymonth="0"+mymonth}if(myweekday<10){myweekday="0"+myweekday}return(myyear+"-"+mymonth+"-"+myweekday)},startStop:function(obj){var me=this;var startStop=[];var currentDate=new Date(obj);var weekday=currentDate.getDay()||7;currentDate.setDate(currentDate.getDate()-weekday-1);for(var i=0;i<7;i+=1){currentDate.setDate(currentDate.getDate()+1);startStop.push(me.formatDate(currentDate))}return startStop}};var positionMap={ac:null,myValue:null,addMarkerState:true,mapObj:null,init:function(configData){$("#l-map").empty();this.mapObj=new BMap.Map("l-map");this.mapObj.centerAndZoom("大连市甘井子区中国大连高级经理学院",14);this.mapObj.enableScrollWheelZoom();this.mapObj.enableContinuousZoom();this.ac=new BMap.Autocomplete({"input":"suggestId","location":this.mapObj});this.eventFun()},eventFun:function(){var me=this;me.ac.addEventListener("onhighlight",function(e){var str="";var _value=e.fromitem.value;var value="";if(e.fromitem.index>-1){value=_value.province+_value.city+_value.district+_value.street+_value.business}str="FromItem<br />index = "+e.fromitem.index+"<br />value = "+value;value="";if(e.toitem.index>-1){_value=e.toitem.value;value=_value.province+_value.city+_value.district+_value.street+_value.business}str+="<br />ToItem<br />index = "+e.toitem.index+"<br />value = "+value;me.G("searchResultPanel").innerHTML=str});me.ac.addEventListener("onconfirm",function(e){var _value=e.item.value;myValue=_value.province+_value.city+_value.district+_value.street+_value.business;me.G("searchResultPanel").innerHTML="onconfirm<br />index = "+e.item.index+"<br />myValue = "+myValue;me.setPlace()});},G:function(id){return document.getElementById(id)},setPlace:function(){var me=this;me.mapObj.clearOverlays();function myFun(){var pp=local.getResults().getPoi(0).point;me.mapObj.centerAndZoom(pp,18);var myIcon=new BMap.Icon($yt_option.websit_path+"resources/images/img/blank.png",new BMap.Size(23,25),{offset:new BMap.Size(10,25),});me.marker=new BMap.Marker(pp,{icon:myIcon});me.mapObj.addOverlay(me.marker);me.marker.enableDragging()}var local=new BMap.LocalSearch(me.mapObj,{onSearchComplete:myFun});local.search(myValue)},getPosition:function(){return this.marker==undefined?null:this.marker.getPosition()}};$(function(){caInfoList.init();courseManager.init();studentList.init();repeatCourtyardList.init();studentManual.init();receptionNotice.init();classBulletin.init();classQrCode.init();studentReport.init();payTicket.init();leaveTube.init();attendance.init();certificateEnd.init();feedBack.init();positionMap.init()});