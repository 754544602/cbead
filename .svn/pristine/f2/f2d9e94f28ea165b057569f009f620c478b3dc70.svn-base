var approveList={init:function(){var reductioPpath="finance/reduction/lookForAllByApproved";var invoicingPath="finance/invoicing/lookForAllByApproved";$('.operate-type').val(1);$('.borrow-outlay-operate-type').val(1);$('.borrow-list-box').hide();$('.outlay-list-box').show();approveList.getReductionListInfo(reductioPpath);$(".tab-title-list button").click(function(){$('#keyword').val("");$(this).addClass("active").siblings().removeClass("active");var btnText=$(this).text();if(btnText=="• 费用减免"){$('#keyword').val("");$('.seconed-p').removeClass("appro-btn");$('.fist-p').addClass("appro-btn");$('.operate-type').val(1);$('.borrow-list-box').hide();$('.outlay-list-box').show();approveList.getReductionListInfo(reductioPpath)}else{$('#keyword').val("");$('.seconed-p').removeClass("appro-btn");$('.fist-p').addClass("appro-btn");$('.operate-type').val(2);$('.borrow-list-box').show();$('.outlay-list-box').hide();approveList.getBorrowListInfo(invoicingPath)}});var first=$yt_common.GetQueryString("first");if(first==null){$('#keyword').val("");$('.seconed-p').removeClass("appro-btn");$('.fist-p').addClass("appro-btn");$('.operate-type').val(1);$('.borrow-list-box').hide();$('.outlay-list-box').show();approveList.getReductionListInfo(reductioPpath)}else if(first=="cost"){$('#keyword').val("");$('.seconed-p').removeClass("appro-btn");$('.fist-p').addClass("appro-btn");$('.operate-type').val(1);$('.borrow-list-box').hide();$('.outlay-list-box').show();approveList.getReductionListInfo(reductioPpath)}else if(first=="borrow"){$('#keyword').val("");$('.seconed-p').removeClass("appro-btn");$('.fist-p').addClass("appro-btn");$('.operate-type').val(2);$('.borrow-list-box').show();$('.outlay-list-box').hide();approveList.getBorrowListInfo(invoicingPath)};var approText;var operateVal;$(".appro-type p").click(function(){$(this).addClass("appro-btn").siblings().removeClass("appro-btn");approText=$(this).text();operateVal=$('.operate-type').val();if(operateVal==1){$('#keyword').val("");if(approText=="待审批"){$('#keyword').val("");$('.borrow-outlay-operate-type').val(1);approveList.getReductionListInfo(reductioPpath)}else{$('#keyword').val("");$('.borrow-outlay-operate-type').val(2);var rePath="finance/reduction/lookForAllByHi";approveList.getReductionListInfo(rePath)}}else{$('#keyword').val("");if(approText=="待审批"){$('#keyword').val("");$('.borrow-outlay-operate-type').val(1);approveList.getBorrowListInfo(invoicingPath)}else{$('#keyword').val("");$('.borrow-outlay-operate-type').val(2);var inPath="finance/invoicing/lookForAllByHi";approveList.getBorrowListInfo(inPath)}}});$('.search-btn').click(function(){var operateType=$('.operate-type').val();var boOperateType=$('.borrow-outlay-operate-type').val();if(operateType==1){if(boOperateType==1){approveList.getReductionListInfo(reductioPpath)}else{var rePath="finance/reduction/lookForAllByHi";approveList.getReductionListInfo(rePath)}}else{if(boOperateType==1){approveList.getBorrowListInfo(invoicingPath)}else{var inPath="finance/invoicing/lookForAllByHi";approveList.getBorrowListInfo(inPath)}}});$('.reduce-list').on('click','.project-code-href',function(){var pkId=$(this).parent().parent().find('.pk-id').text();var boOperateType=$('.borrow-outlay-operate-type').val();if(boOperateType==1){approveList.getReductionInfo(pkId)};if(boOperateType==2){window.location.href="costInfo.html?pkId="+pkId+"&num="+2}});$('.borrow-list').on('click','.invoice-org-href',function(){var pkId=$(this).parent().parent().find('.pk-id').text();var boOperateType=$('.borrow-outlay-operate-type').val();if(boOperateType==1){approveList.getBorrowInfo(pkId)};if(boOperateType==2){window.location.href="borrowInfo.html?pkId="+pkId+"&num="+2}})},getBorrowInfo:function(pkId){$.ajax({type:"post",url:$yt_option.base_path+"finance/invoicing/getBeanById",async:false,data:{pkId:pkId},success:function(data){if(data.flag==0){var flowLog=data.data.flowLog;var length=flowLog.length;var tastKeyType=flowLog[0].tastKey;var deleteReason=flowLog[0].deleteReason;if(length==0){}else if(tastKeyType=="activitiEndTask"&&deleteReason=="completed"){window.location.href="borrowInfo.html?pkId="+pkId+"&num="+2}else{window.location.href="reviseborrowApprove.html?pkId="+pkId}}}})},getReductionInfo:function(pkId){$.ajax({type:"post",url:$yt_option.base_path+"finance/reduction/getBeanById",async:false,data:{pkId:pkId},success:function(data){if(data.flag==0){var flowLog=JSON.parse(data.data.flowLog);var length=flowLog.length;var tastKeyType=flowLog[0].tastKey;var deleteReason=flowLog[0].deleteReason;if(length==0){}else if(tastKeyType=="activitiEndTask"&&deleteReason=="completed"){window.location.href="costInfo.html?pkId="+pkId+"&num="+2}else{window.location.href="reviseOutlayApprove.html?pkId="+pkId}}}})},getReductionListInfo:function(path){var keyword=$('#keyword').val();$('.curriculum-page').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+path,type:"post",data:{selectParam:keyword},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.reduce-list .yt-tbody');var htmlTr='';var num=1;var projectType;if(data.data.rows.length>0){htmlTbody.empty();$.each(data.data.rows,function(i,v){i=i+1;if(v.projectType==1){projectType="计划"};if(v.projectType==2){projectType="委托"};if(v.projectType==3){projectType="选学"};if(v.projectType==4){projectType="调训"};htmlTr='<tr><td style="display:none;" class="pk-id">'+v.pkId+'</td><td class="project-code list-td">'+v.projectCode+'</td><td style="text-align:left;" class="project-name"><a style="color: #4169E1;" class="project-code-href">'+v.projectName+'</a></td><td class="project-type list-td">'+projectType+'</td><td class="project-head list-td">'+v.projectHead+'</td><td class="start-date list-td">'+v.startDate+'</td><td class="create-time-string list-td">'+v.createTimeString+'</td><td class="create-time-string list-td">'+v.createTimeString+'</td><td style="text-align:right;" class="post-remission-money">'+v.postRemissionMoney+'</td><td class="create-user list-td">'+v.createUser+'</td><td class="work-flaw-state list-td">'+v.dealingWithPeople+'</td></tr>';htmlTbody.append($(htmlTr).data("legalData",v))})}else{htmlTbody.empty();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr);$('.page-info').hide()}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getBorrowListInfo:function(path){var keyword=$('#keyword').val();$('.page-info').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+path,type:"post",data:{selectParam:keyword},before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.borrow-list .borrow-list-tod');var htmlTr='';var num=1;var invoiceType;if(data.data.rows.length>0){htmlTbody.empty();$.each(data.data.rows,function(i,v){i=i+1;if(v.invoiceType==1){invoiceType="普通发票"};if(v.invoiceType==2){invoiceType="增值税发票"};htmlTr='<tr><td>'+i+'</td><td style="display:none;" class="pk-id">'+v.pkId+'</td><td style="text-align:left;" class="invoice-org"><a style="color: #4169E1;" class="invoice-org-href">'+v.invoiceOrg+'</a></td><td  class="invoice-type">'+invoiceType+'</td><td class="create-time-string">'+v.createTimeString+'</td><td style="text-align:right;" class="application-invoice">'+v.applicationInvoice+'</td><td class="create-user">'+v.createUser+'</td><td class="work-flaw-state">'+v.dealingWithPeople+'</td></tr>';htmlTbody.append(htmlTr)})}else{htmlTbody.empty();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr);$('.page-info').hide()}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })}};$(function(){approveList.init()});