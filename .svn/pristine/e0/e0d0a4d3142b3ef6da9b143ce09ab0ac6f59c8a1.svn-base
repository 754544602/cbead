var bankBillListInfo={init:function(){bankBillListInfo.getBillListInfo("2");bankBillListInfo.getBankStatementDetails();$(".page-return-btn").on("click",function(){window.history.back()});$(".check-box-load").on("change",function(){if($('.check-sure input[type="checkbox"]').is(':checked')){if($('.check-cancel input[type="checkbox"]').is(':checked')){bankBillListInfo.getBillListInfo("2")}else{bankBillListInfo.getBillListInfo("1")}}else{if($('.check-cancel input[type="checkbox"]').is(':checked')){bankBillListInfo.getBillListInfo("0")}else{$yt_baseElement.showLoading();htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="18" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';$(".project-tbody").html(htmlTr);$yt_baseElement.hideLoading()}}});$(".bank-more-div").on("click",function(){$yt_baseElement.showLoading();if($(".bank-more-div").text()=="查看更多"){if($(".payment-list").hasClass("hide")){}var width=parseInt($("#project-main").css("width"));var leftWidth=parseInt($(".bank-table-left").css('width'));$("#project-main").css("width",width+1260+"px");$(".bank-table-left").css("width",leftWidth+1260+'px');$(".bank-th-hide").show();$(".bank-more-div").text("收起");var colspan=$(".bank-tbody-td").attr("colspan");$(".bank-tbody-td").attr("colspan",colspan+11)}else{var width=parseInt($("#project-main").css("width"));var leftWidth=parseInt($(".bank-table-left").css('width'));$("#project-main").css("width",width-1260+"px");$(".bank-table-left").css("width",leftWidth-1260+'px');$(".bank-th-hide").hide();$(".bank-more-div").text("查看更多");var colspan=$(".bank-tbody-td").attr("colspan");$(".bank-tbody-td").attr("colspan",colspan-11)}$yt_baseElement.hideLoading()});$(".project-more-div").on("click",function(){$yt_baseElement.showLoading();if($(".project-more-div").text()=="查看更多"){var width=parseInt($("#project-main").css("width"));var rightWidth=parseInt($(".bank-table-right").css('width'));$("#project-main").css("width",width+480+"px");$(".bank-table-right").css("width",rightWidth+480+'px');$(".project-th-righthide").show();$(".project-more-div").text("收起");var colspan=$(".bank-tbody-td").attr("colspan");$(".bank-tbody-td").attr("colspan",colspan+3)}else{var width=parseInt($("#project-main").css("width"));var rightWidth=parseInt($(".bank-table-right").css('width'));$(".bank-table-right").css("width",rightWidth-480+'px');$("#project-main").css("width",width-480+"px");$(".project-th-righthide").hide();$(".project-more-div").text("查看更多");var colspan=$(".bank-tbody-td").attr("colspan");$(".bank-tbody-td").attr("colspan",colspan-3)}$yt_baseElement.hideLoading()});$(".invalid-more-div").on("click",function(){$(".invalid-hide").show();$(".invalid-more-div").hide()});$(".account-entry-sure").on("click",function(){var bool=false;$(".bank-table-left tbody input[type=checkbox]:checked").each(function(i,v){var classes=$(v).parents('tr').attr('class');$('.'+classes).each(function(j,k){if($(k).find('.claimDate')[0]!=undefined&&$(k).find('.claimDate').text()==''||$(k).find('.claimDate')[0]!=undefined&&$(k).find('.claimDate').text()=='无'){bool=true}})});if(bool){$yt_alert_Model.prompt('请选择已手动入账且已认领的账单')}else{bankBillListInfo.accountEntryInfo("1")}});$(".account-entry-cancel").on("click",function(){bankBillListInfo.accountEntryInfo("0")});$(".update-effective-true").on("click",function(){bankBillListInfo.updateEffectiveInfo(0)});$(".update-effective-cancel").on("click",function(){bankBillListInfo.updateEffectiveInfo(1)});$(".update-admission").on("click",function(){bankBillListInfo.updateAdmission("1")});$(".admission-manual").on("click",function(){var checkLength=$(".bank-table-left").find('label input[type="checkbox"]:checked').length;if(checkLength==0){$yt_alert_Model.prompt("请选择一条信息进行入账");return false}bankBillListInfo.classAlertFunc()});$(".check-all").on("click",function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck");$(this).parents(".bank-table-left").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check");$(this).parents(".bank-table-left").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".project-tbody,.person-tbody,.company-tbody,.invalid-tbody").off().on("change","input[type='checkbox']",function(){if($(this).parents('tbody').find("input[type='checkbox']").length!=$(this).parents('tbody').find("input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}if($(this).parents(".bank-table-left").find("tbody input[type='checkbox']").length!=$(this).parents(".bank-table-left").find("tbody input[type='checkbox']:checked").length){$(this).parents(".bank-table-left").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents(".bank-table-left").find(".check-all").setCheckBoxState("check")}})},classAlertFunc:function(){bankBillListInfo.getProjectInfo();$(".check-all").setCheckBoxState("uncheck");$(".project-name-select").setSelectVal("0");$(".project-name-select").niceSelect();bankBillListInfo.getNoDetailedList("0");bankBillListInfo.getDetailedPersonalList("0","");var identifications=[];var bankStatementDetailsIds="";var bankarr=[];var htmlUl=$(".accountName");htmlUl.empty();$(".bank-table-left").find('label input[type="checkbox"]:checked').each(function(i,v){var htmlLi='';$.each($(this).parents("tbody").find("td.otherPartyName"),function(a,b){htmlLi+='<li>'+$(b).text()+'</li>'});htmlUl.append(htmlLi);var identification=$(this).parents("tr").find("input.identification").val();$.each($(v).parents('.leftTable').find('tr'),function(a,b){bankarr.push($(b).data('data').pkId)});if(identification!=''){identifications.push(identification)}});identifications=identifications.join(',');bankStatementDetailsIds=bankarr.join(',');var projectCode="";$("select.project-name-select").off().change(function(){if($(this).val()=="OTHER"){$(".alert-table-div").hide();$(".alert-div-input").hide();$("#confiscate-amount").show();$("#user-name").css({float:"none",'margin':"8px 48px 8px 84px"});$("#last-amount").css({float:"none",'margin':"8px 0px 8px 42px"});$("#form-class").css({float:"none",'margin':"8px 48px 8px 84px"});$(".select-teacher-div").width("auto");$(".yt-edit-alert-main").height("auto");$('.association-sure-btn').off().on('click',function(){var uncollectedTotal=$("input.uncollectedTotal").val();bankBillListInfo.addNotReconciliations("OTHER","","","","",uncollectedTotal)});$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-teacher-div"));$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));$("select").niceSelect()}else{$(".alert-table-div").show();$(".alert-div-input").show();$("#confiscate-amount").hide();$("#user-name").css({float:"left",'margin':"0px 0px 0px 20px"});$("#last-amount").css({float:"left",'margin':"0px 0px 0px 100px"});$("#form-class").css({float:"left",'margin':"0px 0px 0px 70px"});$(".select-teacher-div").width("1100px");$(".yt-edit-alert-main").height("736px");$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-teacher-div"));$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));$("select").niceSelect();projectCode=$(this).val();bankBillListInfo.getNoDetailedList(projectCode);bankBillListInfo.getDetailedPersonalList(projectCode,"");$(".search-btn").click(function(){var keyword=$("#keyword").val();bankBillListInfo.getDetailedPersonalList(projectCode,keyword)});var identifications=[];$(".bank-table-left").find('label input[type="checkbox"]:checked').each(function(i,v){var identification=$(this).parents("tr").data('data').identification;if(identification!=''){identifications.push(identification)}});identifications=identifications.join(',');bankBillListInfo.getProjectStatementByProjectCode(projectCode,identifications);}});$(".association-sure-btn").off().on("click",function(){var paymentListAdd=[];$(".company-tbody,.person-tbody").find('label input[type="checkbox"]:checked').each(function(){if($(this).hasClass("statement-check")){}else{var paymentType="";var paymentValue=$(this).val();if($(this).parents("tr").find("td").length>6){paymentType="2"}else{paymentType="1"}var paymentListAddArr={paymentType:paymentType,paymentValue:paymentValue};paymentListAdd.push(paymentListAddArr)}});var paymentListDelete=[];$(".company-tbody,.person-tbody").find('input.statement-check').not("input:checked").each(function(){var paymentType="";var paymentValue=$(this).val();if($(this).parents("tr").find("td").length>6){paymentType="2"}else{paymentType="1"}var paymentListDeleteArr={paymentType:paymentType,paymentValue:paymentValue};paymentListDelete.push(paymentListDeleteArr)});var identifications=[];$(".bank-table-left").find('label input[type="checkbox"]:checked').each(function(i,v){var identification=$(this).parents("tr").find("input.identification").val();if(identification!=''){identifications.push(identification)}});identifications=identifications.join(',');var strpaymentListDelete;var strpaymentListAdd;JSON.stringify(paymentListDelete)=='[]'?strpaymentListDelete='':strpaymentListDelete=JSON.stringify(paymentListDelete);JSON.stringify(paymentListAdd)=='[]'?strpaymentListAdd='':strpaymentListAdd=JSON.stringify(paymentListAdd);bankBillListInfo.addNotReconciliations(projectCode,identifications,bankStatementDetailsIds,strpaymentListDelete,strpaymentListAdd,"")});bankBillListInfo.getNotReconciliations(identifications);$(".alert-table-div").show();$(".alert-div-input").show();$("#confiscate-amount").hide();$("#user-name").css({float:"left",'margin':"0px 0px 0px 20px"});$("#last-amount").css({float:"left",'margin':"0px 0px 0px 100px"});$("#form-class").css({float:"left",'margin':"0px 0px 0px 70px"});$(".select-teacher-div").width("1100px");$(".yt-edit-alert-main").height("736px");$(".select-teacher-div").show();$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-teacher-div"));$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));$("select").niceSelect();$('.select-teacher-canel-btn').click(function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},addNotReconciliations:function(projectCode,identifications,bankStatementDetailsIds,paymentListDelete,paymentListAdd,uncollectedTotal){var me=this;$.ajax({url:$yt_option.base_path+"finance/projectStatement/addNotReconciliations",type:"post",data:{isUserClaim:'',projectCode:projectCode,bankStatementDetailsIds:bankStatementDetailsIds,identifications:identifications,paymentListDelete:paymentListDelete,paymentListAdd:paymentListAdd,uncollectedTotal:uncollectedTotal},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("关联成功");$('.person-page').pageInfo("refresh");var sureArr=[];$.each($('.surecheck input:checked'),function(i,v){sureArr.push($(v).val())});sureArr.join(',');sureArr=='0,1'?sureArr=2:sureArr=sureArr;me.getBillListInfo(sureArr)});}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("关联失败")})}}})},getProjectStatementByProjectCode:function(projectCode,identifications){$.ajax({url:$yt_option.base_path+"finance/projectStatement/getProjectStatementByProjectCode",type:"post",data:{projectCode:projectCode,identifications:identifications},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$.each(data.data,function(i,v){$(".company-tbody,.person-tbody").find('input[type="checkbox"]').each(function(j,n){if($(this).parents("tr").find("td").length<6){if($(this).val()==v.paymentValue&&v.paymentType=="1"){$(this).setCheckBoxState("check");$(this).addClass("statement-check")}}else{if($(this).val()==v.paymentValue&&v.paymentType=="2"){$(this).setCheckBoxState("check");$(this).addClass("statement-check")}}})})}else{$yt_alert_Model.alertOne("查询失败")}$yt_baseElement.hideLoading()}})},getBankStatementDetails:function(){var pkId=$yt_common.GetQueryString("pkId");$.ajax({url:$yt_option.base_path+"finance/bankStatement/getBankStatementDetails",type:"post",data:{pkId:pkId},objName:'data',before:function(){$yt_baseElement.showLoading()},async:false,success:function(data){if(data.flag==0){$(".bill-info-table").setDatas(data.data);var htmlTr="";var htmlTbody=$(".invalid-tbody");var noEffectiveList=JSON.parse(data.data.noEffectiveList);htmlTbody.empty();if(noEffectiveList.length>0){$.each(noEffectiveList,function(i,v){htmlTr='<tr><td width="30px" style="text-align: center;"><label class="check-label yt-checkbox"><input type="checkbox" name="test"/></label></td><td>'+(i+1)+'</td><td>'+v.exchangeHour+'</td><td class="invalid-hide" style="text-align:right;display:none">'+v.draw+'</td><td style="text-align:right;">'+v.income+'</td><td class="invalid-hide" style="text-align:right;display:none"">'+v.balance+'</td><td class="invalid-hide" style="display:none">'+v.currency+'</td><td>'+v.otherPartyName+'</td><td>'+v.otherPartyAccounts+'</td><td>'+v.otherPartyGroup+'</td><td class="invalid-hide" style="display:none">'+v.accountDate+'</td><td class="invalid-hide" style="display:none">'+v.bankTradeNumber+'</td><td class="invalid-hide" style="display:none">'+v.enterpriseTradeNumber+'</td><td class="invalid-hide" style="display:none">'+v.voucherType+'</td><td class="invalid-hide" style="display:none">'+v.voucherNo+'</td><td class="invalid-hide" style="display:none">'+v.associatedAccount+'</td><td class="invalid-hide" style="display:none">'+v.alias+'</td><td>'+v.abstractData+'</td><td>'+v.remarks+'</td></tr>';htmlTr=$(htmlTr).data('data',v);htmlTbody.append(htmlTr)})}else{htmlTbody.html("");htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},getBillListInfo:function(isAdmission){$yt_baseElement.showLoading();var keyword=$('#keyword').val();var pkId=$yt_common.GetQueryString("pkId");$('.page1').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/bankStatement/getBankStatementDetailsList",type:"post",data:{selectParam:keyword,pkId:pkId,isAdmission:isAdmission,isClaimUser:"2"},objName:'data',success:function(data){setTimeout($yt_baseElement.hideLoading(),500);if(data.flag==0){var htmlLeftBody=$('.bank-table-left');var htmlRightBody=$('.bank-table-right');var htmlLeftTr='';var htmlRightTr='';var repetitionArr=[];var ordernum=0;htmlLeftBody.find('tbody').empty();htmlRightBody.find('tbody').empty();$.each($('table.leftTable'),function(x,y){$(y).remove()});$.each($('table.rightTable'),function(x,y){$(y).remove()});$('.num').text(data.data.rows.length);if(data.data.rows.length>0){$.each(data.data.rows,function(i,n){var bool=true;for(let j=0;j<repetitionArr.length;j+=1){if(i==repetitionArr[j]){bool=false}}if(bool==false){return true}ordernum+=1;var leftnum=0;var rightnum=0;var rightbool=true;htmlLeftBody.append('<table class="leftTable leftTable'+i+'" width="100%"><tbody class="yt-body project-tbody"></tbody></table>');htmlRightBody.append('<table class="rightTable rightTable'+i+'" width="100%"><tbody class="yt-body project-tbody"></tbody></table>');$.each(data.data.paymentList,function(k,v){if(n.identification==v.identification){rightbool=false;rightnum+=1;if(rightnum==1){htmlRightTr='<tr class="'+i+'">'+'<td width="190px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:center"><input class="identification-last" style="display:none;" value="'+v.identification+'">'+v.projectSell+'</td>'+'<td width="90px" class="project-th-righthide payment-list claimDate merge-last" style="display: none;text-align:center">'+v.claimDate+'</td>'+'<td width="137px" class="payment-list merge-last" style="text-align:center">'+v.projectName+'</td>'+'<td width="200px" class="payment-list merge-last" style="text-align:center">'+v.projectDate+'</td>'+'<td width="200px" class="payment-list merge-last" style="text-align:center">'+v.traineeOrGroupName+'</td>'+'<td width="200px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:center">'+v.orgName+'</td>'+'<td width="68px" class="payment-list merge-last uncollectedTotal" style="text-align:right;">'+v.uncollectedTotal+'</td>'+'<td width="67px" class="payment-list merge-last reconciliationsTotal rightTd'+i+'" style="text-align:right;">'+v.reconciliationsTotal+'</td>'+'<td width="70px" class="payment-list merge-last admissiontotal rightTd'+i+'" style="text-align:right;">'+v.admissiontotal+'</td>'+'<td width="90px" class="payment-list merge-last differencetotal rightTd'+i+'" style="text-align:right;">'+v.differencetotal+'</td>'+'<td width="60px" class="payment-list merge-last rightTd'+i+'" style="text-align:center;">'+(bankBillListInfo.confirmFunc(v.reconciliationState))+'</td>'+'<td width="100px" class="payment-list merge-last rightTd'+i+'" style="text-align:center;">'+v.admissionConfirmUser+'</td></tr>';$('.rightTable'+i).find('tbody').append(htmlRightTr)}else{htmlRightTr='<tr class="'+i+'">'+'<td width="190px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:center;"><input class="identification-last" style="display:none;" value="'+v.identification+'">'+v.projectSell+'</td>'+'<td width="90px" class="project-th-righthide payment-list claimDate merge-last" style="display: none;text-align:center;">'+v.claimDate+'</td>'+'<td width="137px" class="payment-list merge-last" style="text-align:center;">'+v.projectName+'</td>'+'<td width="200px" class="payment-list merge-last" style="text-align:center;">'+v.projectDate+'</td>'+'<td width="200px" class="payment-list merge-last" style="text-align:center;">'+v.traineeOrGroupName+'</td>'+'<td width="200px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:center;">'+v.orgName+'</td>'+'<td width="68px" class="payment-list merge-last uncollectedTotal" style="text-align:right;">'+v.uncollectedTotal+'</td></tr>';$('.rightTable'+i).find('tbody').append(htmlRightTr)}}});$.each(data.data.rows,function(x,y){if(n.identification==y.identification&&n.identification!=''){repetitionArr.push(x);leftnum+=1;if(leftnum==1){htmlLeftTr='<tr class="'+i+'"><td width="30px" style="text-align: center;" class="merge leftTd'+i+'"><label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test"/></label></td><td width="31px" class="merge leftTd'+i+'" style = "text-align:center"><input class="identification-last" style="display:none;" value="'+y.identification+'">'+ordernum+'</td>'+'<td width="90px" class="merge" style = "text-align:center"><input type="text" name="test" style="display:none" class="pkId" value="'+y.pkId+'"/>'+y.exchangeHour+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+y.draw+'</td>'+'<td width="98px" class="merge income" style="text-align:right">'+y.income+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+y.balance+'</td>'+'<td width="60px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.currency+'</td>'+'<td width="131px" class="otherPartyName merge">'+y.otherPartyName+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none"><input class="identification" style="display:none;" value="'+y.identification+'">'+y.otherPartyAccounts+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none">'+y.otherPartyGroup+'</td>'+'<td width="80px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.accountDate+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none">'+y.abstractData+'</td>'+'<td width="116px" class="merge">'+y.remarks+'</td>'+'<td width="131px" class="merge">'+y.enterpriseTradeNumber+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none">'+y.voucherType+'</td>'+'<td width="77px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.voucherNo+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.associatedAccount+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none">'+y.alias+'</td>'+'<td width="160px" class="bank-th-hide merge" style="display:none">'+y.bankTradeNumber+'</td></tr>';htmlLeftTr=$(htmlLeftTr).data('data',y);$('.leftTable'+i).find('tbody').append(htmlLeftTr)}else{htmlLeftTr='<tr class="'+i+'">'+'<td width="90px" class="merge" style = "text-align:center"><input type="text" name="test" style="display:none" class="pkId" value="'+y.pkId+'"/>'+y.exchangeHour+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+y.draw+'</td>'+'<td width="98px" class="merge income" style="text-align:right">'+y.income+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+y.balance+'</td>'+'<td width="60px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.currency+'</td>'+'<td width="131px" class="otherPartyName merge">'+y.otherPartyName+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none"><input class="identification" style="display:none;" value="'+y.identification+'">'+y.otherPartyAccounts+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none">'+y.otherPartyGroup+'</td>'+'<td width="80px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.accountDate+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none">'+y.abstractData+'</td>'+'<td width="116px" class="merge">'+y.remarks+'</td>'+'<td width="131px" class="merge">'+y.enterpriseTradeNumber+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none">'+y.voucherType+'</td>'+'<td width="77px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.voucherNo+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.associatedAccount+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none">'+y.alias+'</td>'+'<td width="160px" class="bank-th-hide merge" style="display:none">'+y.bankTradeNumber+'</td></tr>';htmlLeftTr=$(htmlLeftTr).data('data',y);$('.leftTable'+i).find('tbody').append(htmlLeftTr)}}});if(n.identification==''){leftnum=1;htmlLeftTr='<tr class="'+i+'"><td width="30px" style="text-align: center;" class="merge leftTd'+i+'"><label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test"/></label></td><td width="31px" class="merge leftTd'+i+'" style = "text-align:center"><input class="identification-last" style="display:none;" value="'+n.identification+'">'+ordernum+'</td>'+'<td width="90px" class="merge" style = "text-align:center"><input type="text" name="test" style="display:none" class="pkId" value="'+n.pkId+'"/>'+n.exchangeHour+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+n.draw+'</td>'+'<td width="98px" class="merge income" style="text-align:right">'+n.income+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+n.balance+'</td>'+'<td width="60px" class="bank-th-hide merge" style="display:none;text-align:center">'+n.currency+'</td>'+'<td width="131px" class="otherPartyName merge">'+n.otherPartyName+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none"><input class="identification" style="display:none;" value="'+n.identification+'">'+n.otherPartyAccounts+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none">'+n.otherPartyGroup+'</td>'+'<td width="80px" class="bank-th-hide merge" style="display:none;text-align:center">'+n.accountDate+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none">'+n.abstractData+'</td>'+'<td width="116px" class="merge">'+n.remarks+'</td>'+'<td width="131px" class="merge">'+n.enterpriseTradeNumber+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none">'+n.voucherType+'</td>'+'<td width="77px" class="bank-th-hide merge" style="display:none;text-align:center">'+n.voucherNo+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none;text-align:center">'+n.associatedAccount+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none">'+n.alias+'</td>'+'<td width="160px" class="bank-th-hide merge" style="display:none">'+n.bankTradeNumber+'</td></tr>';htmlLeftTr=$(htmlLeftTr).data('data',n);$('.leftTable'+i).find('tbody').append(htmlLeftTr)}if(rightbool){htmlRightTr='<tr class="'+i+'">'+'<td width="190px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:center"><span style="opacity:0">无</span></td>'+'<td width="90px" class="project-th-righthide payment-list claimDate merge-last" style="display: none;text-align:center"><span style="opacity:0">无</span></td>'+'<td width="137px" class="payment-list merge-last" style="text-align:center"><span style="opacity:0">无</span></td>'+'<td width="200px" class="payment-list merge-last" style="text-align:center"><span style="opacity:0">无</span></td>'+'<td width="200px" class="payment-list merge-last" style="text-align:center"><span style="opacity:0">无</span></td>'+'<td width="200px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:center"><span style="opacity:0">无</span></td>'+'<td width="68px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>'+'<td width="67px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>'+'<td width="70px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>'+'<td width="90px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>'+'<td width="60px" class="payment-list merge-last" style="text-align:center;"><span style="opacity:0">无</span></td>'+'<td width="100px" class="payment-list merge-last" style="text-align:center;"><span style="opacity:0">无</span></td></tr>';$('.rightTable'+i).find('tbody').append(htmlRightTr)}$('.leftTd'+i).attr('rowspan',leftnum);$('.rightTd'+i).attr('rowspan',rightnum);var tableHeight=0;$('.leftTable'+i).height()>$('.rightTable'+i).height()?tableHeight=$('.leftTable'+i).height():tableHeight=$('.rightTable'+i).height();$('.leftTable'+i).height()==$('.rightTable'+i).height()?tableHeight=$('.leftTable'+i).height():false;$('.leftTable'+i).css('height',tableHeight+'px');$('.rightTable'+i).css('height',tableHeight+'px');if($(".bank-more-div").text()=='收起'){htmlLeftBody.find('.bank-th-hide').show()}if($(".project-more-div").text()=='收起'){htmlRightBody.find('.project-th-righthide').show()}var uncollectedTotal=0;$.each($(".rightTable"+i).find('.uncollectedTotal'),function(i,n){uncollectedTotal+=Number($(n).text())});var income=0;$.each($(".leftTable"+i).find('.income'),function(i,n){income+=Number($(n).text())});$(".rightTable"+i).find('.reconciliationsTotal').text(uncollectedTotal);$(".rightTable"+i).find('.admissiontotal').text(income);$(".rightTable"+i).find('.differencetotal').text(income-uncollectedTotal);if((income-uncollectedTotal)==0){var pkIds=[];$.each($(".leftTable"+i).find('tr'),function(i,n){pkIds.push($(n).data('data').pkId)});pkIds=pkIds.join(',');bankBillListInfo.accountEntryInfo("1",pkIds,false)}})}}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getProjectInfo:function(){$yt_baseElement.showLoading();var selectParam="";$.ajax({async:true,url:$yt_option.base_path+"finance/projectStatement/getProjects",type:"post",data:{selectParam:selectParam},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){if(data.data&&data.data&&data.data.length>0){$.each(data.data,function(i,v){$("select.project-name-select").append($('<option value="'+v.projectCode+'">'+v.projectName+'</option>'))});$('select.project-name-select').niceSelect()}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败");$yt_baseElement.hideLoading()})}},})},getNoDetailedList:function(projectCode){$.ajax({url:$yt_option.base_path+"finance/settlement/getNoDetailedList",async:false,type:"post",data:{projectCode:projectCode},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.company-tbody');var htmlTr='';htmlTbody.empty();if(data.data.length>0){$.each(data.data,function(i,v){htmlTr='<tr><td style="text-align: center;"><label class="check-label yt-checkbox unit-checkbox"><input type="checkbox" name="test" class="groupId" value="'+v.groupId+'"/></label></td><td style="text-align:left">'+v.groupName+'</td><td style="text-align:right">'+v.amountReceivable+'</td><td style="text-align:right">'+v.netReceipts+'</td><td style="text-align:right">'+v.uncollected+'</td></tr>';htmlTbody.append(htmlTr)})}else{htmlTbody.html("");htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="5" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getDetailedPersonalList:function(projectCode,keyword){$(".person-page").pageInfo({pageIndexs:1,pageNum:15,pageSize:10,async:false,url:$yt_option.base_path+"finance/settlement/getDetailedPersonalList",type:"post",data:{projectCode:projectCode,selectParam:keyword,trainingExpenseStart:"",trainingExpenseEnd:"",traineeNegotiatedPriceStart:"",traineeNegotiatedPriceEnd:"",quarterageStart:"",quarterageEnd:"",mealFeeStart:"",mealFeeEnd:"",otherChargesStart:"",otherChargesEnd:"",uncollectedStart:"",uncollectedEnd:""},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.person-tbody');var htmlTr='';htmlTbody.empty();if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){htmlTr='<tr><td style="text-align: center;"><label class="check-label yt-checkbox personal-checkbox"><input type="checkbox" value="'+v.traineeId+'"/></label></td><td>'+v.groupNum+'</td><td>'+v.realName+'</td><td>'+v.gender+'</td><td style="text-align:left">'+v.groupName+'</td><td style="text-align:left">'+v.groupOrgName+'</td><td style="text-align:right">'+v.smallPlan+'</td><td style="text-align:right">'+v.moneyTotal+'</td><td style="text-align:right">'+v.uncollected+'</td></tr>';htmlTbody.append(htmlTr)})}else{htmlTbody.html("");htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getNotReconciliations:function(identifications){$.ajax({url:$yt_option.base_path+"finance/projectStatement/getNotReconciliations",type:"post",data:{identifications:identifications},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){if(data.data.notReconciliations==null){data.data.notReconciliations=0}$(".not-reconciliations").text(data.data.notReconciliations);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},accountEntryInfo:function(isAdmission,differencetotal,no){var pkIds=[];$(".bank-table-left tbody input[type=checkbox]:checked").each(function(i,v){$.each($(v).parents('.leftTable').find('tr'),function(a,b){pkIds.push($(b).data('data').pkId)})});pkIds=pkIds.join(',');differencetotal!=undefined?pkIds=differencetotal:pkIds=pkIds;if(pkIds==""){$yt_alert_Model.prompt("请选中对账单进行操作")}else{$.ajax({type:"post",url:$yt_option.base_path+"finance/bankStatement/updateAdmission",data:{pkIds:pkIds,isAdmission:isAdmission},beforeSend:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){if(isAdmission==1){$yt_alert_Model.prompt("确认入账成功")}else{$yt_alert_Model.prompt("取消入账成功")}});if(no!=false){$('.page-info').pageInfo("refresh")}}else{$yt_baseElement.hideLoading(function(){if(isAdmission==1){$yt_alert_Model.prompt("确认入账失败")}else{$yt_alert_Model.prompt("取消入账失败")}})}$(".bank-list-table").find(".check-all").setCheckBoxState("uncheck")}})}},updateEffectiveInfo:function(isEffective){var pkIds=[];if(isEffective==1){$('.invalid-tbody input[type=checkbox]:checked').each(function(i,v){$.each($(v).parents('.leftTable').find('tr'),function(a,b){pkIds.push($(b).data('data').pkId)})});pkIds=pkIds.join(',');if(pkIds==""){$yt_alert_Model.prompt("请选中无效对账单进行操作")}}else if(isEffective==0){$(".bank-table-left tbody input[type=checkbox]:checked").each(function(i,v){pkIds.push($(v).parents('.leftTable').find('tr').data('data').pkId);});pkIds=pkIds.join(',');if(pkIds==""){$yt_alert_Model.prompt("请选中有效对账单进行操作")}}if(pkIds==""){}else{$.ajax({type:"post",url:$yt_option.base_path+"finance/bankStatement/updateEffective",data:{pkIds:pkIds,isEffective:isEffective},beforeSend:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){if(isEffective==1){$yt_alert_Model.prompt("标记有效成功")}else{$yt_alert_Model.prompt("标记无效成功")}$('.page-info').pageInfo("refresh");bankBillListInfo.getBankStatementDetails()})}else{$yt_baseElement.hideLoading(function(){if(isEffective==1){$yt_alert_Model.prompt("标记有效失败")}else{$yt_alert_Model.prompt("标记无效失败")}})}$(".bank-list-table").find(".check-all").setCheckBoxState("uncheck")},error:function(data){$yt_alert_Model.prompt('网络异常，标记失败，请稍后重试')}})}},updateAdmission:function(isPublish){var pkIds=[];$(".bank-table-left tbody input[type=checkbox]:checked").each(function(i,v){$.each($(v).parents('.leftTable').find('tr'),function(a,b){pkIds.push($(b).data('data').pkId)});});pkIds=pkIds.join(',');if(pkIds==""){$yt_alert_Model.prompt("请选中对账单进行操作")}else{$.ajax({type:"post",url:$yt_option.base_path+"finance/bankStatement/updatePublish",data:{pkIds:pkIds,isPublish:isPublish},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("公布成功")})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("公布失败")})}$(".bank-list-table").find(".check-all").setCheckBoxState("uncheck")},error:function(data){$yt_alert_Model.prompt('网络异常，公布失败，请稍后重试')}})}},confirmFunc:function(confirm){if(confirm==1){return "已入账"}else if(confirm==0){return "未入账"}}};$(function(){bankBillListInfo.init()});