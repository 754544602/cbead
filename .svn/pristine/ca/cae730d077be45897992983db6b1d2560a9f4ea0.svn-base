/**
 * 班级详细信息
 */
var caInfoList = {
	//初始化方法
	init: function() {
		caInfoList.getPlanListInfo();
		var projectCode = $yt_common.GetQueryString("projectCode");
		//设置列表样式
		$(".tab-title-list button").click(function() {
			//var divIndex; 
			$(this).addClass("active").siblings().removeClass("active");
//			if($(this).index()==5){
//				divIndex=7;
//			}else if($(this).index()==6){
//				divIndex=8;
//			}else if($(this).index()==7){
//				divIndex=9;
//			}else{
//				divIndex=$(this).index();
//			}
			$(".box-list .content-box").hide().eq($(this).index()).show();
			
			if($(this).index() == 0) {//班级信息页签
				caInfoList.getPlanListInfo();
				
			} else if($(this).index() == 1) {//授课教师页签
				caInfoList.getTeacherListInfo();
				
			} else if($(this).index() == 2) {//课程日程页签
				courseManager.getCourseType();
				courseManager.getCourseList();
				
			} else if($(this).index() == 3) {//学员管理页签
	          studentList.getStudentList();
	         studentList.getDifferentList();
       		  
			} else if($(this).index() == 4) {//重复来院名单页签
				//重复来院名单
				repeatCourtyardList.getRepeatComeList();
				//疑似重复来院名单
				repeatCourtyardList.doubtRepatComeList();
				
			} else if($(this).index() == 5) {//学员手册页签
				studentManual.getTemplateList();
				$('.student-manual-div .student-manual-btn').eq(0).addClass('change-page-sign').siblings().removeClass('change-page-sign');
				$('.student-manual-div .manual-div').hide().eq(0).show();
				studentManual.getPageDataList();
			} else if($(this).index() == 6) {//接待通知页签
				receptionNotice.getReceptionList();
				
			} else if($(this).index() == 7) {//班级公告页签
				//班级公告
				classBulletin.getClassBulletin();
			} else if($(this).index() == 8) {//二维码页签
				
			} else if($(this).index() == 9) {//学员报到页签
				//学员报到
			studentReport.getStudentReport();
			studentReport.getDifferentList();
			} else if($(this).index() == 10) {//缴费开票页签

				
			} else if($(this).index() == 11) {//请假管理页签
					leaveTube.leaveList();
			}else if($(this).index() == 12) {//出勤管理页签
				//获取日期按钮
				attendance.getSwitchBtn();
				//获取全员的签到
				attendance.getStudentSign();
			}else if($(this).index() == 13){//结业证管理页签
				certificateEnd.getCertificateList();
			}else if($(this).index() == 14){//学员反馈页签
				feedBack.getBackListHead();
				feedBack.getFeedBackList();
			}
		});
		//返回班级管理页面
		$('.page-return-btn').off().on('click', function() {
			window.location.href = "classMg.html";
		});
		//点击教师姓名跳到详情页
		$('.teacher-div .tab-content .teacher-table').on('click','.real-name',function(){
			var teacherId=$(this).parents("tr").find('label .select-teacher-pkId').val();
			//班级编号
			var projectCode = $yt_common.GetQueryString("projectCode");
			window.location.href = "classTeacherInf.html?pkId="+teacherId+"&&projectCode="+projectCode;
		});
		//点击弹窗选择授课教师
		$('.teacher-search-btn').click(function() {
			//查询选择教师列表
			caInfoList.selectTeacherListInfo();
			//显示选择教师弹出框
			$(".select-teacher-div").show();
			
			//模糊查询
			$('.teacher-search-img').click(function() {
				caInfoList.selectTeacherListInfo();
			});
			//选择授课教师
			$('.select-teacher-sure-btn').click(function() {
				var pkId = "";
				$('.select-teacher-alert-checkbox input[class="select-teacher-pkId"]:checked').each(function() {
					if(pkId == "") {
						pkId = $(this).val();
					} else {
						pkId += "," + $(this).val();
					}
				});
				if(pkId == "") {
					$yt_alert_Model.prompt("请选中一行数据进行操作", 3000);
				} else {
					caInfoList.selectTeacher(pkId);
				}
			});
			//取消按钮	
			$('.select-teacher-canel-btn').click(function() {
				$('.select-teacher-div .select-teacher-tbody').empty();
				$(".yt-edit-alert,#heard-nav-bak").hide();
				$("#pop-modle-alert").hide();
			});
		});
		//移除教师
		$('.teacher-delete-btn').click(function() {
			var pkId = "";
			$('.select-teacher-checkbox input[class="select-teacher-pkId"]:checked').each(function() {
				if(pkId == "") {
					pkId = $(this).val();
				} else {
					pkId += "," + $(this).val();
				}
			});
			if(pkId == "") {
				$yt_alert_Model.prompt("请勾选一行", 3000);
			} else {
				$yt_alert_Model.alertOne({
					alertMsg: "数据删除将无法恢复,确认删除吗?", //提示信息  
					confirmFunction: function() { //点击确定按钮执行方法  
						caInfoList.deleteTeacher(pkId);
					},
				});
			}
		});
		//教师订票
		$('.teacher-ticket-btn').off('click').click(function() {
			//获取列表
			caInfoList.getTicketList();
			$(".select-ticket-div").show();
			//点击确定按钮
			$('.select-ticket-sure-btn').off('click').click(function() {
				caInfoList.getTicket();
			});
			$yt_model_drag.modelDragEvent($(".select-ticket-div .yt-edit-alert-title"));
			//取消按钮
			$('.select-ticket-canel-btn').click(function() {
				$(".yt-edit-alert").hide();
				$("#pop-modle-alert").hide();
			});
		});
		//复选框
		//全选  
		$(".check-all").change(function() {
			//判断自己是否被选中  
			if($(this).parent().hasClass("check")) {
				//设置反选  
				$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck");
			} else {
				//调用设置选中方法,全选  
				$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check");
			}

		});

		//修改全选按钮状态
		$(".teacher-table tbody,.select-teacher-tbody").on("change", "input[type='checkbox']", function() {
			if($(this).parents("table").find("tbody input[type='checkbox']").length != $(this).parents("table").find("tbody input[type='checkbox']:checked").length) {
				$(this).parents("table").find(".check-all").setCheckBoxState("uncheck");
			} else {
				$(this).parents("table").find(".check-all").setCheckBoxState("check");
			}
		});
		//点击接送站
		$(".teacher-station-btn").click(function() {
			caInfoList.getRelayList();
			/** 
			 * 显示编辑弹出框和显示顶部隐藏蒙层 
			 */
			$(".shuttle-box").show();
			/* 
			 * 调用支持拖拽的方法 
			 */
			$yt_model_drag.modelDragEvent($(".shuttle-box .yt-edit-alert-title"));
			/** 
			 * 点击取消方法 
			 */
			$('.shuttle-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
				//隐藏页面中自定义的表单内容  
				$(".shuttle-box").hide();
			});
		});
		//点击申请派车
		$(".shuttle-box .yt-model-sure-btn").off().on('click',function(){
			//caInfoList.teacherApplyCar();
			caInfoList.getNextOptPeople();
		});
		///tab标签切换
		$(".more-tab-btn-end").click(function() {
			var leftVal = parseInt($(".tab-title-box").css("margin-left")) - 120;
			console.log(leftVal);
			if($(".tab-title-box").parent().width() > ($(".tab-title-box button").last().position().left - 120)) {
				$(".more-tab-btn-end").hide();
				leftVal = (120 * $(".tab-title-box button").length - $(".tab-title-box").parent().width() + 32) * -1;
			}
			$(".tab-title-box").css("padding-left", "32px").stop(true, true).animate({
				"margin-left": leftVal
			}, 100);
			$(".more-tab-btn-start").show();
		});
		$(".more-tab-btn-start").click(function() {
			var leftVal = parseInt($(".tab-title-box").css("margin-left")) + 120;

			if(leftVal >= -120) {
				$(this).hide();
				leftVal = 0;
				$(".tab-title-box").css("padding-left", "0");
			}
			console.log(leftVal);
			$(".tab-title-box").stop(true, true).animate({
				"margin-left": leftVal
			}, 100);
			$(".more-tab-btn-end").show();
		});

	},
	/**
	 * 获取教师订票的pkId
	 */
	getTeacherReseverId:function(){
		var teachersReseverList=[];
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			type:"post",
			url: $yt_option.base_path + "class/teacher/getTeachersReseve",
			data:{
				projectCode:projectCode
			},
			async:false,
			success:function(data){
				if(data.flag==0){
					var resever=$.parseJSON(data.data.teachersReseve);
					$.each(resever, function(i,g) {
						var teacherResever={
							teacherReseverId:g.pkId,
							teacherId:g.teacherId,
							routeType:g.routeType
						};
						teachersReseverList.push(teacherResever);
					});
				}
			}
		});
		//teachersReseverList=JSON.stringify(teachersReseverList);
		return teachersReseverList;
	},
	/**
	 * 获取下一步审批人
	 */
	getNextOptPeople:function(){
		var user="";
		var dataObj ="";
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "uniform/workFlowOperate/getSubmitPageData",
				data: {
					businessCode: "teachersFeederStation",
					processInstanceId: "",
					parameters: "",
					versionNum: ""
				},
				async: true,
				success: function(data) {
					if(data.flag == 0) {
						console.log(data.data);
						$.each(data.data, function(i, n) {
							console.log(n);
							console.log(i);
							for(var k in n) {
								console.log('k', k);
								console.log("n[k]", n[k]);
								 user = n[k][0].userCode;
								console.log("userCode",user);
								 dataObj = eval("(" + k + ")");
								console.log(dataObj);
								console.log("nextCode",dataObj.nextCode);
							}
						});
						caInfoList.teacherApplyCar(user,"",dataObj.nextCode);
					}
				}
			});
			
	},
	/**
	 * 教师申请派车
	 */
	teacherApplyCar:function(dealingWithPeople,processInstanceId,nextCode){
		var teacherReseverList=caInfoList.getTeacherReseverId();
		console.log("订票Id",teacherReseverList);
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		var teachersFeederStation=[];
		//已选中的个数
		var checkedLength=$(".shuttle-box tbody td input[name='test']:checked").length;
		//循环取得所需参数
			$(".shuttle-box tbody td input[name='test']:checked").each(function(i,b){
					var teacherReserveId="";
					var pkId=$(b).parents('tr').find('.shuttle-pk-id').val();
					var teacherId=$(b).parents('tr').find('.teacher-id').val();
					var teacherName=$(b).parents('tr').find('.teach-name').text();
					var phone=$(b).parents('tr').find('.teach-phone').text();
					var routeType=$(b).val();
					var flightTrainNumber=$(b).parents('tr').find('.flight-num').val();
					var address=$(b).parents('tr').find('.relay-address').val();
					var dateTime=$(b).parents('tr').find('.relay-dates').val();
					//关联订票id
					$.each(teacherReseverList, function(q,o) {
						if(o.routeType==routeType&&o.teacherId==teacherId){
							teacherReserveId=o.teacherReseverId;
							return false;
						}
					});
					var sendCarType=1;
					var teachersList={
						pkId:pkId,
						teacherReserveId:teacherReserveId,
						teacherId:teacherId,
						teacherName:teacherName,
						phone:phone,
						routeType:routeType,
						flightTrainNumber:flightTrainNumber,
						address:address,
						dateTime:dateTime,
						sendCarType:sendCarType
					};
				
				teachersFeederStation.push(teachersList);
			});
		teachersFeederStation=JSON.stringify(teachersFeederStation);
		console.log(teachersFeederStation);
		if(checkedLength!=0){
			//显示整体框架loading的方法
			$yt_baseElement.showLoading();
			$.ajax({
				type:"post",
				url:$yt_option.base_path + "class/teacher/addTeachersFeederStation",
				data:{
					projectCode:projectCode,
					teachersFeederStation:teachersFeederStation,
					businessCode:"teachersFeederStation",
					dealingWithPeople:dealingWithPeople,
					processInstanceId:processInstanceId,
					opintion:"",
					nextCode:nextCode
				},
				async:true,
				success:function(data){
					if(data.flag==0){
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function(){
							$yt_alert_Model.prompt("申请成功");
						});
					}else{
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function(){
							$yt_alert_Model.prompt("申请失败");
						});
					}
				}
			});
		}else{
			$yt_alert_Model.prompt("请勾选之后再进行派车");
		}
	
	},
	/**
	 * 获取接送站列表数据
	 */
	getRelayList:function(){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/teacher/getTeachersFeederStation",
			data:{
			projectCode:projectCode	
			},
			async:true,
			success:function(data){
				var ralayBody=$(".shuttle-box tbody");
				var phone='';
				var lasTr;
				var rowsNum=2;
				var routeType;
				if(data.flag==0){
					if(data.data.teachersFeederStation!=""){
						var teachersFeederStation=$.parseJSON(data.data.teachersFeederStation);
						ralayBody.empty();
						$.each(teachersFeederStation, function(i,n) {
							var ralayHtml='';
							ralayHtml+='<tr>';
							if(phone!=n.phone){
								ralayHtml+='<td class="teach-name">'+n.teacherName+'</td>'+
											'<td class="teach-phone">'+n.phone+'</td>';
								$(".shuttle-box tbody").find('tr').eq(lasTr).find('td').eq(0).attr('rowspan',rowsNum);
								$(".shuttle-box tbody").find('tr').eq(lasTr).find('td').eq(1).attr('rowspan',rowsNum);
								phone=n.phone;
								lasTr=i;
							}else{
								//rowsNum++;
							}
							ralayHtml+='<input type="hidden" class="shuttle-pk-id" value="'+n.pkId+'"/>'+
										'<input type="hidden" class="teacher-id" value="'+n.teacherId+'"/>';
									if(n.routeType==1){
											ralayHtml+='<td class="routetype route-meet">'+
											      	'<label class="check-label yt-checkbox" style="margin-left:-26px;">'+ 
									                   ' <input type="checkbox" name="test" value="'+n.routeType+'"/>'+ 
									                '接</label></td>';
										}else{
											ralayHtml+='<td class="routetype route-give">'+
											      	'<label class="check-label yt-checkbox" style="margin-left:-26px;">'+ 
									                   ' <input type="checkbox" name="test" value="'+n.routeType+'"/>'+
									                '送</label></td>';
									}
							ralayHtml+='<td><input type="text" style="width:100px;" class="yt-input flight-num" placeholder="请输入" value="'+n.flightTrainNumber+'"/></td>'+
									'<td><input type="text" style="width:100px;" class="yt-input relay-address" placeholder="请输入" value="'+n.address+'"/></td>'+
									'<td><input class="calendar-input relay-dates" style="width: 140px;background-position: 131px 7px;" value="'+n.dates+'" placeholder="请选择日期" type="text" /></td>';
									if(n.sendCarType==1){
										ralayHtml+='<td style="color:#f8deb9;">派车中</td>'+
													'<td style="color:#f8deb9;">派车中</td></tr>';
									}else if(n.sendCarType==2){
										ralayHtml+='<td>'+n.car+'</td>'+
													'<td>'+n.driver+'</td></tr>';
									}else{
										ralayHtml+='<td>--</td>'+
													'<td>--</td></tr>';
									}
							
									ralayBody.append(ralayHtml);
								$(".shuttle-box tbody").find('tr').eq(lasTr).find('td').eq(0).attr('rowspan',rowsNum);
								$(".shuttle-box tbody").find('tr').eq(lasTr).find('td').eq(1).attr('rowspan',rowsNum);
						});
					}
					
					$(".relay-dates").calendar({  
					    speed: 200, //日期列表展开显示速度, 参数"slow","normal","fast"，或毫秒数值，默认：200     
					    complement: true, // 是否显示日期或年空白处的前后月的补充,默认：true     
					    readonly: true, // 目标对象是否设为只读，默认：true     
					    nowData:false,//默认选中当前时间,默认true  
					    dateFmt:"yyyy-MM-dd HH:mm"  
					});
					/** 
					 * 调用算取div显示位置方法 
					 */
					$yt_alert_Model.setFiexBoxHeight($(".shuttle-box .yt-edit-alert-main"));
					$yt_alert_Model.getDivPosition($(".shuttle-box"));
					console.log("接送站查询成功");
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
				}else{
					var ralayHtml='';
						ralayHtml='<tr>'+
									'<td colspan="8" align="center" style="border:0px;">'+
										'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
											'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
										'</div>'+
									'</td>'+
								'</tr>';
					ralayBody.append(ralayHtml);
						//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
				}
			}
		});
	},
	/**
	 * 获取班级信息
	 */      
	getPlanListInfo: function() {
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type: "post",
			url: $yt_option.base_path + "class/getBeanByProjectCode",
			async: true,
			data: {
				projectCode: projectCode
			},
			objName: 'data',
			success: function(data) {
				if(data.flag == 0) {
					
					if(data.data.projectType==1){
						data.data.projectType="调训";
					}else if(data.data.projectType==2){
						data.data.projectType="委托";
					}else if(data.data.projectType==3){
						data.data.projectType="选学";
					}else if(data.data.projectType==4){
						data.data.projectType="调训";
					}
					$('.project-code').text(data.data.projectCode);
					$('.project-name').text(data.data.projectName);
					$('.project-type').text(data.data.projectType);
					$('.project-sell').text(data.data.projectSell);
					$('.start-date').text(data.data.startDate);
					$('.end-date').text(data.data.endDate);
					$('.details').text(data.data.details);
					$('.train-date').text(data.data.trainDate);
					$('.customer-unit').text(data.data.customerUnit);
					$('.customer-dept').text(data.data.customerDept);
					$('.customer-linkman').text(data.data.customerLinkman);
					$('.customer-linkman-position').text(data.data.customerLinkmanPosition);
					$('.customer-linkman-phone').text(data.data.customerLinkmanPhone);
					$('.customer-linkman-cellphone').text(data.data.customerLinkmanCellphone);
					$('.customer-linkman-fax').text(data.data.customerLinkmanFax);
					$('.customer-linkman-email').text(data.data.customerLinkmanEmail);
					$('.customer-trainee-position').text(data.data.customerTraineePosition);
					$('.customer-trainee-sum').text(data.data.customerTraineeSum);
					$('.customer-trainee-age-structure').text(data.data.customerTraineeAgeStructure);
					$('.customer-target-demand').text(data.data.customerTargetDemand);
					$('.project-head').text(data.data.projectHead);
					$('.class-teacher').text(data.data.classTeacher);
					$('.project-aid').text(data.data.projectAid);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}
			}
		});
	},
	/**
	 * 授课教师列表
	 */
	getTeacherListInfo: function() {
		var projectCode = $yt_common.GetQueryString("projectCode");
		var searchParameters = "";
		$('.teacher-div .tab-content .teacher-table thead label input').setCheckBoxState('uncheck');
		$('.page-info').pageInfo({
			async: true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "class/teacher/lookForAll", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				searchParameters: searchParameters,
				projectCode: projectCode,
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			before:function(){
				$yt_baseElement.showLoading();
			},
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.teacher-div .teacher-table .yt-tbody');
					var htmlTr = '';
					if(data.data.rows.length > 0) {
						$.each(data.data.rows, function(i, v) {
							htmlTr += '<tr class="teacher-tr">' +
								'<td>' + '<label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test" class="select-teacher-pkId" value="' + v.pkId + '"/></label>' + '</td>' +
								'<td><div><a class="yt-link real-name">' + v.realName + '</a></div></td>' +
								'<td>' + (v.gender == 1 ? "男" : "女") + '</td>' +
								'<td class="teacher-phone">' + v.phone + '</td>' +
								'<td>' + v.org + '</td>' +
								'<td>' + v.title + '</td>' +
								'<td>' + v.researchArea + '</td>' +
								'<td class="tr">' + v.dollarsStandardHalf + '</td>' +
								'<td class="tr">' + v.dollarsStandardOne + '</td>' +
								'<td>' + (v.teacherStates == 1 ? "可用" : "已用") + '</td>' +
								'</tr>';
						});
					} else {
						htmlTr += '<tr style="border:0px;background-color:#fff !important;" >' +
							'<td colspan="10" align="center" style="border:0px;">' +
							'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
							'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
							'</div>' +
							'</td>' +
							'</tr>';
					}
					htmlTbody.html(htmlTr);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}
		});
	},
	/**
	 * 获取授课教师列表查询
	 */
	selectTeacherListInfo: function() {
		var projectCode = $yt_common.GetQueryString("projectCode");
		var searchParameters = $('.select-teacher-search-btn').val();
		$('.select-teacher-div thead label input').setCheckBoxState('unckeck');
		$('.teacher-page').pageInfo({
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "class/teacher/getTeachers", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				searchParameters: searchParameters,
				projectCode: projectCode,
			}, //ajax查询访问参数
			async:true,
			before:function(){
				//显示整体框架loading的方法
				$yt_baseElement.showLoading();
			},
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.select-teacher-table .yt-tbody');
					var htmlTr = '';
				 htmlTbody.empty();
					if(data.data.rows.length > 0) {
						$('.teacher-page').show();
						$.each(data.data.rows, function(i, v) {
							if(v.gender==1){
								v.gender="男";
							}else{
								v.gender="女";
							 }
							if(v.teacherStates==1){
								v.teacherStates="可用";
							}else{
								v.teacherStates="已用";
							 }
							htmlTr = '<tr>' +
								'<td>' + '<label class="check-label yt-checkbox select-teacher-alert-checkbox"><input type="checkbox" name="test" class="select-teacher-pkId" value="' + v.pkId + '"/></label>' + '</td>' +
								'<input type="hidden" value="' + v.pkId + '" class="pkid">' +
								'<td><div><a class="yt-link">' + v.realName + '</a></div></td>' +
								'<td>' + v.gender + '</td>' +
								'<td>' + v.phone + '</td>' +
								'<td>' + v.org + '</td>' +
								'<td>' + v.title + '</td>' +
								'<td>' + v.researchArea + '</td>' +
								'<td>' + v.dollarsStandardHalf + '</td>' +
								'<td>' + v.dollarsStandardOne + '</td>' +
								'<td>' + v.grade + '</td>' +
								'<td>' + v.teacherStates + '</td>' +
								'</tr>';
								htmlTbody.append(htmlTr);
						});
//						/隐藏整体框架loading的方法
						$yt_baseElement.hideLoading();
					}else{
						$('.teacher-page').hide();
						htmlTr ='<tr>'+
								'<td colspan="11" align="center" style="border:0px;">'+
									'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
										'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
									'</div>'+
								'</td>'+
							'</tr>';
							htmlTbody.append(htmlTr);
							//隐藏整体框架loading的方法
							$yt_baseElement.hideLoading();
					}
			//计算弹出框位置
			$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));
			$yt_alert_Model.getDivPosition($(".select-teacher-div"));
			$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}
			}
		});
	},
	//选择教师
	selectTeacher: function(pkId) {
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			type: "post",
			url: $yt_option.base_path + "class/teacher/addTeachers", //ajax访问路径  
			async: false,
			data: {
				projectCode: projectCode,
				pkId: pkId,
			},
			success: function(data) {
				if(data.flag == 0) {
					$yt_alert_Model.prompt("添加教师成功");
					$(".yt-edit-alert,#heard-nav-bak").hide();
					$('.page-info').pageInfo("refresh");
					caInfoList.getTeacherListInfo();
				} else {
					$yt_alert_Model.prompt("添加教师失败");
				}
			} //回调函数 匿名函数返回查询结果  
		});
	},
	//移除教师
	deleteTeacher: function(pkId) {
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			type: "post",
			url: $yt_option.base_path + "class/teacher/deleteTeachers", //ajax访问路径  
			async: false,
			data: {
				projectCode: projectCode,
				pkId: pkId,
			},
			success: function(data) {
				if(data.flag == 0) {
					$yt_alert_Model.prompt("移除教师成功");
					caInfoList.getTeacherListInfo();
				} else {
					$yt_alert_Model.prompt("移除教师失败");
				}
			} //回调函数 匿名函数返回查询结果  
		});
	},
	
	//订票
	getTicket: function() { 
		
		var projectCode = $yt_common.GetQueryString("projectCode");
		var teachersReseveArr = [];
		$(".teacher-ticket-div .ticket-teacher-tbody tr").each(function(i, n) {
			var pkId=$(n).find('.teacher-pk-id').val()
			if(pkId=="0"){
				pkId="";
			}
			var teacherId=$(n).find('.teacher-id').val();
			var routeType = $(n).find('.route-type').val();
			var flightTrainNumber = $(n).find('.flight-train-number').val();
			var placeDeparture = $(n).find('.place-departure').val();
			var goOff = $(n).find('.go-off').val();
			var bourn = $(n).find('.bourn').val();
			var arrivalTime = $(n).find('.arrival-time').val();
			var fares=$(n).find('.fares').val();
			var changeFeeRefund = $(n).find('.change-fee-refund').val();
			var states =1;
			var teachersReseveList = {
				pkId:pkId,
				teacherId:teacherId,
				routeType: routeType,
				types: 1,
				flightTrainNumber: flightTrainNumber,
				placeDeparture: placeDeparture,
				goOff: goOff,
				bourn: bourn,
				arrivalTime: arrivalTime,
				fares:fares,
				changeFeeRefund: changeFeeRefund,
				states: states
			};
			teachersReseveArr.push(teachersReseveList);
		});
		var teachersReseve = JSON.stringify(teachersReseveArr);
		console.log("订票数据",teachersReseve);
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			url: $yt_option.base_path + "class/teacher/addTeachersReseve", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode,
				teachersReseve: teachersReseve
			}, //ajax查询访问参数
			success: function(data) {
				if(data.flag == 0) {
					console.log(data);
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						$yt_alert_Model.prompt("订票成功");
					});
				} else {
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						$yt_alert_Model.prompt("订票失败");
					});
				}
			}
		});

	},
	//获取教师订票数据
	getTicketList: function() {
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			url: $yt_option.base_path + "class/teacher/getTeachersReseve", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode
			}, //ajax查询访问参数
			success: function(data) {
				var rowspanNum=1;
				var lastOr;
				var teacherPhone;
				var routeType;
				if(data.flag == 0) {
					console.log(data);
					var teachersReseve =$.parseJSON(data.data.teachersReseve);
					var htmlTbody = $('.select-ticket-div .ticket-teacher-tbody');
					htmlTbody.empty();
					if(teachersReseve!=null){
						$.each(teachersReseve, function(i, v) {
							if(v.routeType==1){
								routeType="来院";
							}else{
								routeType="返程";
							}
							var htmlTr = '';
							htmlTr += '<tr>';
					    if(teacherPhone!= v.phone){
						   	$('.select-ticket-div .ticket-teacher-tbody tr').eq(lastOr).find('td').eq(0).attr('rowspan',rowspanNum);
					   	 	$('.select-ticket-div .ticket-teacher-tbody tr').eq(lastOr).find('td').eq(1).attr('rowspan',rowspanNum);
						  	teacherPhone=v.phone;
						  	lastOr=i;
						  	htmlTr+='<td class="teacherName">' + v.teacherName + '</td>'+
						  	'<td class="phone">' + v.phone + '</td>';
								rowspanNum=1;
					    }else{
							   	rowspanNum++;
						}
					    	$('.select-ticket-div .ticket-teacher-tbody tr').eq(lastOr).find('td').eq(0).attr('rowspan',rowspanNum);
					   	 	$('.select-ticket-div .ticket-teacher-tbody tr').eq(lastOr).find('td').eq(1).attr('rowspan',rowspanNum);
						htmlTr+='<input type="hidden" class="teacher-id" value="' + v.teacherId + '" />'+
								'<input type="hidden" class="teacher-pk-id" value="' + v.pkId + '" />'+
						        '<input type="hidden" class="teacher-phone" value="' + v.phone + '" />'+
								'<td><input type="hidden" class="route-type" value="' + v.routeType + '" />' + routeType + '</td>' +
								'<td><input type="hidden" class="types" value="' + v.types + '" />订票</td>' +
								'<td><input type="text" class="yt-input flight-train-number" value="' + v.flightTrainNumber + '" /></td>' +
								'<td><input type="text" class="yt-input place-departure" value="' + v.placeDeparture + '" /></td>' +
								'<td><input class="calendar-input go-off" style="width: 140px;background-position: 130px 7px;" value="' + v.goOff + '" placeholder="请选择日期" type="text" /></td>' +
								'<td><input type="text" class="yt-input bourn" value="' + v.bourn + '" /></td>' +
								'<td><input class="calendar-input arrival-time" style="width: 140px;background-position: 130px 7px;" value="' + v.arrivalTime + '" placeholder="请选择日期" type="text" /></td>' +
								'<td><input type="number" style="text-align:right" class="yt-input fares" value="' + v.fares + '" /></td>' +
								'<td><input type="number" style="text-align:right" class="yt-input change-fee-refund" value="' + v.changeFeeRefund + '" /></td>' +
								'</tr>';
							htmlTbody.append(htmlTr);
						});
					$(".go-off").calendar({
						speed: 200, //日期列表展开显示速度, 参数"slow","normal","fast"，或毫秒数值，默认：200     
						dateFmt: "yyyy-MM-dd HH:mm",
						nowData:true,
						complement: true,
					});
					$(".arrival-time").calendar({
						speed: 200, //日期列表展开显示速度, 参数"slow","normal","fast"，或毫秒数值，默认：200     
						dateFmt: "yyyy-MM-dd HH:mm",
						nowData:true,
						complement: true,
					});
						$yt_alert_Model.setFiexBoxHeight($(".select-ticket-div .yt-edit-alert-main"));
						$yt_alert_Model.getDivPosition($(".select-ticket-div"));
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading();
					}else{
						htmlTr='<tr>'+
								'<td colspan="11" align="center" style="border:0px;">'+
									'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
										'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
									'</div>'+
								'</td>'+
							'</tr>';
						htmlTbody.append(htmlTr);
						$yt_alert_Model.setFiexBoxHeight($(".select-ticket-div .yt-edit-alert-main"));
						$yt_alert_Model.getDivPosition($(".select-ticket-div"));
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function(){
							$yt_alert_Model.prompt("请先选择教师");
						});
					}
				}else{
					var htmlTr = '';
					htmlTr='<tr>'+
								'<td colspan="11" align="center" style="border:0px;">'+
									'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
										'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
									'</div>'+
								'</td>'+
							'</tr>';
					htmlTbody.append(htmlTr);
				}
			}
		});

	}
}
/**
 * 课程详细信息
 */
var courseManager = {
	init: function() {
		var me = this;
	
		//时间
		$(".course-date").calendar({
			controlId: "courseDate",
			speed: 200, //日期列表展开显示速度, 参数"slow","normal","fast"，或毫秒数值，默认：200     
			complement: true, // 是否显示日期或年空白处的前后月的补充,默认：true     
			readonly: true, // 目标对象是否设为只读，默认：true     
			lowerLimit: "2010/01/01", // 日期下限，默认：NaN(不限制)     
			nowData: true, //默认选中当前时间,默认true  
			dateFmt: "yyyy-MM-dd",
			callback: function() { // 点击选择日期后的回调函数  
				//alert("您选择的日期是：" + $("#txtDate").val());  
			}
		});

		//课程类别切换表单
		$("select.couse-type").change(function() {
			//$(".add-course-box table").hide().eq(parseInt($(this).val())).show();
			$(".add-course-box .couse-type1,.add-course-box .couse-type2,.add-course-box .couse-type3").hide();
			if($(this).val() == "openingCeremony" || $(this).val() == "windingUp") {
				$(".add-course-box .couse-type1").show();
			} else if($(this).val() == "teachingActivities") {
				$(".add-course-box .couse-type3").show();
			} else {
				$(".add-course-box .couse-type2").show();
			}

		});
		//新增课程按钮
		$(".add-couse-btn").click(function() {
			$(".add-course-box .yt-edit-alert-title-msg").text("新增课程");
			//初始化上课时间
			$("[name='giveType']:eq(0)").setRadioState("check");
			$(".add-course-box .start-time").timespinner('setValue', "08:30");
			$(".add-course-box .end-time").timespinner('setValue', "11:30");
			//初始化类型
			var openingCeremony = $("select.couse-type option:eq(0)").val();
			$(".couse-type").setSelectVal(openingCeremony);
			$(".couse-type2").hide();
			$(".couse-type1").show();
			$(".valid-font").text("");
			$(".valid-hint").removeClass("valid-hint");
			$(".select-file-btn").css("visibility", "visible");
			$(".upload-file-btn").css("visibility", "hidden").prev().css("visibility", "hidden");
			$("[name='fileType']:eq(0)").setRadioState("check");
			$("[name='isNeedGroupPhoto']:eq(0)").setRadioState("check");

			$(".upload-file-btn").val("").removeData("fileInfo");
			$("input[name='courseName']").val("");
			me.getTeacherList();

			/** 
			 * 显示编辑弹出框和显示顶部隐藏蒙层 
			 */
			$(".add-course-box").show();
			/** 
			 * 调用算取div显示位置方法 
			 */
			$yt_alert_Model.getDivPosition($(".add-course-box"));
			/* 
			 * 调用支持拖拽的方法 
			 */
			$yt_model_drag.modelDragEvent($(".add-course-box .yt-edit-alert-title"));
			/** 
			 * 点击取消方法 
			 */
			$('.add-course-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
				//隐藏页面中自定义的表单内容  
				$(".add-course-box").hide();
			});

			//新增课程方法
			$(".add-course-box .yt-model-sure-btn").off().on("click", function() {
				me.editCouseInfo();
				me.getCourseList();
			});
		});

		//上传按钮
		$(".upload-file-box").undelegate().delegate("input.upload-file-btn", "change", function() {
			var addFile = $(this).attr("id");
			$yt_baseElement.showLoading();
			var url = $yt_option.acl_path + "api/tAscPortraitInfo/addFile?modelCode=couseFile";
			$.ajaxFileUpload({
				url: url,
				type: "post",
				dataType: 'json',
				fileElementId: addFile,
				success: function(data, textStatus) {
					var resultData = $.parseJSON(data);
					if(resultData.success == 0) {
						$yt_baseElement.hideLoading(function() {
							$("#" + addFile).prev().val(resultData.obj.naming).data("fileInfo", resultData.obj);
							$yt_alert_Model.prompt("附件上传成功");
						});

					} else {
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("附件上传失败");
						});
					}

				},
				error: function(data, status, e) { //服务器响应失败处理函数  
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("附件上传失败");
					});
				}
			});
		});
		//附件类型改变事件
		$("input[name='fileType']").change(function() {
			$(this).parent().nextAll().css("visibility", "visible");
			$(this).parents("table").find("input[name='fileType']:not(:checked)").parent().nextAll().css("visibility", "hidden");
		});
		//时间改变事件
		$(".add-course-box input[name='giveType']").change(function() {
			//8:30 11:30
			//2:00 5:00
			//6:00 9:00
			var startTime = "";
			var endTime = "";
			if($(this).val() == "1") {
				startTime = "08:30";
				endTime = "11:30";
			} else if($(this).val() == "2") {
				startTime = "14:00";
				endTime = "17:00";
			} else {
				startTime = "18:00";
				endTime = "21:00";
			}
			$(".add-course-box .start-time").timespinner('setValue', startTime);
			$(".add-course-box .end-time").timespinner('setValue', endTime);
		});
		//修改课程按钮
		$(".update-couse-btn").click(function() {
			if($("input[name='couseCheck']:checked").length != 1) {
				$yt_alert_Model.prompt("请选择一条数据进行修改");
			} else {
				$('.add-course-box .yt-model-sure-btn').val("确定");
				debugger;
				$(".add-course-box .yt-edit-alert-title-msg").text("修改课程");
				var couseInfo = $("input[name='couseCheck']:checked").parents("tr").data("couseInfo");
				console.log(couseInfo);
				//初始化上课时间
				$("[name='giveType'][value='" + couseInfo.giveType + "']").setRadioState("check");

				var giveTime = couseInfo.courseTime;
				$(".add-course-box .start-time").timespinner('setValue', giveTime.split("-")[0]);
				$(".add-course-box .end-time").timespinner('setValue', giveTime.split("-")[1]);
				//初始化类型
				var openingCeremony = couseInfo.courseTypeCode;
				$(".couse-type").setSelectVal(openingCeremony);
				$(".add-course-box .couse-type1,.add-course-box .couse-type2,.add-course-box .couse-type3").hide();
				if(openingCeremony == "openingCeremony" || openingCeremony == "windingUp") {
					$(".add-course-box .couse-type1").show();
				} else if(openingCeremony == "teachingActivities") {
					$(".add-course-box .couse-type3").show();
				} else {
					$(".add-course-box .couse-type2").show();
				}
				//课程主题
				$("input[name='courseName']").val(couseInfo.courseName);
				$(".valid-font").text("");
				$(".valid-hint").removeClass("valid-hint");
				var types = couseInfo.types;

				if(couseInfo.files != "") {
					var filesArr = $.parseJSON(couseInfo.files);
					$(".upload-file-btn").val("").removeData("fileInfo");
						$(".add-course-box [name='fileType']:eq(0)").setRadioState("check");
						$(".select-file-btn").css("visibility", "visible").val("");
						$(".upload-file-btn").css("visibility", "hidden").prev().css("visibility", "hidden").val("");
						if(filesArr.length > 0) {
							$(".select-file-btn").val(filesArr[0].fileName).data("fileInfo", {
								pkId: filesArr[0].fileId,
								naming: filesArr[0].fileName
							});
						}
//					else {
//						$(".add-course-box [name='fileType']:eq(1)").setRadioState("check");
//						$(".select-file-btn").css("visibility", "hidden").val("");
//						$(".upload-file-btn").css("visibility", "visible").prev().css("visibility", "visible").val("");
//						if(filesArr.length > 0) {
//							$(".upload-file-btn").prev().val(filesArr[0].fileName).data("fileInfo", {
//								pkId: filesArr[0].fileId,
//								naming: filesArr[0].fileName
//							});
//						}
//					}
				}else{
					$(".add-course-box [name='fileType']:eq(0)").setRadioState("check");
					$(".select-file-btn").css("visibility", "visible").val("");
					$(".upload-file-btn").css("visibility", "hidden").prev().css("visibility", "hidden").val("");
				}
				me.getTeacherList();

				$("select.teacher-list-selt").setSelectVal(couseInfo.teacherId);

				/** 
				 * 显示编辑弹出框和显示顶部隐藏蒙层 
				 */
				$(".add-course-box").show();
				/** 
				 * 调用算取div显示位置方法 
				 */
				$yt_alert_Model.getDivPosition($(".add-course-box"));
				/* 
				 * 调用支持拖拽的方法 
				 */
				$yt_model_drag.modelDragEvent($(".add-course-box .yt-edit-alert-title"));
				/** 
				 * 点击取消方法 
				 */
				$('.add-course-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
					//隐藏页面中自定义的表单内容  
					$(".add-course-box").hide();
				});
				//修改课程方法
				$(".add-course-box .yt-model-sure-btn").off().on("click", function() {
					me.editCouseInfo(couseInfo.pkId);
				});

			}
		});
		//删除课程按钮
		$(".delete-couse-btn").click(function() {
			if($(".course-list-tbody .yt-table-active").length != 1) {
				$yt_alert_Model.prompt("请选择一条数据进行操作");
				return false;
			}

			$yt_alert_Model.alertOne({
				leftBtnName: "确定", //左侧按钮名称,默认确定  
				rightBtnName: "取消", //右侧按钮名称,默认取消  
				alertMsg: "数据删除将无法恢复,确认删除吗?", //提示信息  
				confirmFunction: function() { //点击确定按钮执行方法  
					var pkId = $(".course-list-tbody .yt-table-active").data("couseInfo").pkId;
					me.deleteCouse(pkId);
				},
			});

		});

		//选择附件信息
		$(".select-file-btn").click(function() {
			var oldBox = $(this).parents(".yt-pop-model");
			$yt_baseElement.showLoading();
			var teacherId = "";
			if($(this).parents(".add-course-box").length == 0) {
				teacherId = $("input[name='couseCheck']:checked").parents("tr").data("couseInfo").teacherId;
			} else {
				teacherId = $(".add-course-box select[name='teacherId']").val();
			}

			//查询教师附件信息
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "class/course/getTeacherUploadFiles",
				async: true,
				data: {
					teacherId: teacherId
				},
				success: function(data) {
					if(data.flag == 0) {
						var htmlTbody = $(".select-file-div tbody").empty();
						var htmlTr = '';
						if(data.data.length > 0) {
							$.each(data.data, function(i, n) {
								htmlTr = $('<tr><td>' + (i + 1) + '</td><td>' + n.fileName + '</td></tr>').data("fileInfo", n);
								htmlTbody.append(htmlTr);
							});

							htmlTbody.find("tr").click(function() {
								$(this).addClass("yt-table-active").siblings().removeClass("yt-table-active");
							});

						} else {

							htmlTr += '<tr style="border:0px;background-color:#fff !important;" >' +
								'<td colspan="10" align="center" style="border:0px;">' +
								'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
								'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
								'</div>' +
								'</td>' +
								'</tr>';
							htmlTbody.html(htmlTr);

						}
						$yt_baseElement.hideLoading();
					} else {
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("查询教师附件失败");
						});
					}
				},
				error: function(data) {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询教师附件失败");
					});
				}
			});

			oldBox.hide();
			/** 
			 * 显示编辑弹出框和显示顶部隐藏蒙层 
			 */
			$(".select-file-div").show();
			/** 
			 * 调用算取div显示位置方法 
			 */
			$yt_alert_Model.getDivPosition($(".select-file-div"));
			/* 
			 * 调用支持拖拽的方法 
			 */
			$yt_model_drag.modelDragEvent($(".select-file-div .yt-edit-alert-title"));
			/** 
			 * 点击取消方法 
			 */
			$('.select-file-div .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
				//隐藏页面中自定义的表单内容  
				$(".select-file-div").hide();
				oldBox.show();
			});
			//选择附件选择方法
			$('.select-file-div .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click", function() {
				//隐藏页面中自定义的表单内容  

				if($(".select-file-div tr.yt-table-active").length == 0) {

					$yt_alert_Model.prompt("请选择附件");
					return false;
				}
				var fileInfo = $(".select-file-div tr.yt-table-active").data("fileInfo");

				oldBox.find(".select-file-btn").val(fileInfo.fileName).data("fileInfo", {
					pkId: fileInfo.fileId,
					naming: fileInfo.fileName
				});
				$(".select-file-div").hide();
				oldBox.show();
			});
		});

		//下载附件
		$(".course-list-tbody").on('click', '.file-name', function() {
			var fileUrl = $(this).attr("fileUrl");
			$.ajaxDownloadFile({
				url: fileUrl
			});
		});
		//课程上传附件方法
		$(".couse-file-btn").click(function() {
			
			if($("input[name='couseCheck']:checked").length != 1) {
				$yt_alert_Model.prompt("请选择一条数据进行修改");
			} else {
				var couseInfo = $("input[name='couseCheck']:checked").parents("tr").data("couseInfo");
				if(couseInfo.courseTypeCode != "openingCeremony" && couseInfo.courseTypeCode != "windingUp" && couseInfo.courseTypeCode != "teachingActivities") {
					$(".couse-file-box table tr:eq(0) td:eq(1)").text(couseInfo.teacherName);
					$(".couse-file-box table tr:eq(1) td:eq(1)").text(couseInfo.courseName);
					var types = couseInfo.types;
					var filesArr = $.parseJSON(couseInfo.files);
					if(filesArr != "") {
						if(types == 1) {
							$(".couse-file-box [name='fileType']:eq(0)").setRadioState("check");
							$(".select-file-btn").css("visibility", "visible").val("");
							$(".upload-file-btn").css("visibility", "hidden").prev().css("visibility", "hidden").val("");
							if(filesArr.length > 0) {
								$(".select-file-btn").val(filesArr[0].fileName).data("fileInfo", {
									pkId: filesArr[0].fileId,
									naming: filesArr[0].fileName
								});
							}

						} else {
							$(".couse-file-box [name='fileType']:eq(1)").setRadioState("check");
							$(".select-file-btn").css("visibility", "hidden").val("");
							$(".upload-file-btn").css("visibility", "visible").prev().css("visibility", "visible").val("");
							if(filesArr.length > 0) {
								$(".upload-file-btn").prev().val(filesArr[0].fileName).data("fileInfo", {
									pkId: filesArr[0].fileId,
									naming: filesArr[0].fileName
								});
							}
						}
					}
					/** 
					 * 显示编辑弹出框和显示顶部隐藏蒙层 
					 */
					$(".couse-file-box").show();
					/** 
					 * 调用算取div显示位置方法 
					 */
					$yt_alert_Model.getDivPosition($(".couse-file-box"));
					/* 
					 * 调用支持拖拽的方法 
					 */
					$yt_model_drag.modelDragEvent($(".couse-file-box .yt-edit-alert-title"));
					/** 
					 * 点击取消方法 
					 */
					$('.couse-file-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
						//隐藏页面中自定义的表单内容  
						$(".couse-file-box").hide();
					});
					//修改课程方法
					$(".couse-file-box .yt-model-sure-btn").off().on("click", function() {
						//me.editCouseInfo(couseInfo.pkId);
						me.uploadFiles();
					});
				} else {
					$yt_alert_Model.prompt("选择的课程类型不需要上传课件");
				}
			}
		});

		//选择教室
		$(".select-room").click(function() {
			if($("input[name='couseCheck']:checked").length != 1) {
				$yt_alert_Model.prompt("请选择一条数据进行修改");
			} else {
				//地点类型
				$("select.address-type").niceSelect();

				//查询教室信息
				me.getClassRooms();
				//获取课程信息
				var couseInfo = $("input[name='couseCheck']:checked").parents("tr").data("couseInfo");
				//获取上课地点信息
				$.ajax({
					type: "post",
					url: $yt_option.base_path + "class/course/getClassRoomConfig",
					async: true,
					data: {
						courseId: couseInfo.pkId
					},
					success: function(data) {
						if(data.flag == 0) {
							/** 
							 * 显示编辑弹出框和显示顶部隐藏蒙层 
							 */
							$(".select-room-box").show();

							/* 
							 * 调用支持拖拽的方法 
							 */
							$yt_model_drag.modelDragEvent($(".select-room-box .yt-edit-alert-title"));
							if(data.data) {

								$("select[name='courseType']").setSelectVal(data.data.courseType);

								if(data.data.courseType == 1) {
									$(".external-address").hide();
									$(".internal-address").show();
								} else {
									$(".internal-address").hide();
									$(".external-address").show();
									//初始化地图控件
									positionMap.ac.setInputValue(data.data.address);
									var longitude = parseFloat(data.data.longitude);
									var latitude = parseFloat(data.data.latitude);
									positionMap.mapObj.clearOverlays(); //清除地图上所有覆盖物
									var point = new BMap.Point(latitude, longitude);

									var myIcon = new BMap.Icon($yt_option.websit_path + "resources/images/img/blank.png", new BMap.Size(23, 25), {
										offset: new BMap.Size(10, 25), // 指定定位位置  
									});
									positionMap.marker = new BMap.Marker(point, {
										icon: myIcon
									}); // 创建标注
									positionMap.mapObj.addOverlay(positionMap.marker); // 将标注添加到地图中	
									positionMap.marker.enableDragging();
									setTimeout(function() {
										positionMap.mapObj.setCenter(point);
									}, 200)
									$(".external-address [name='placeSign'][value='" + data.data.placeSign + "']").setRadioState("check");

								}

							}

							/** 
							 * 点击取消方法 
							 */

							$('.select-room-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
								//隐藏页面中自定义的表单内容  
								$(".select-room-box").hide();
							});
							//修改课程方法
							$(".select-room-box .yt-model-sure-btn").off().on("click", function() {
								//me.editCouseInfo(couseInfo.pkId);
								//me.uploadFiles();
								var couseFile = {};
								//上课地点类型
								couseFile.courseType = $("select[name='courseType']").val();
								//获取班级code
								couseFile.projectCode = $yt_common.GetQueryString("projectCode");

								//获取课程ID
								couseFile.courseId = couseInfo.pkId;
								if(couseFile.courseType == 1) {
									couseFile.placeSign = 2;
									if($(".select-room-box tbody input[type='checkbox']:checked").length == 0) {
										$yt_alert_Model.prompt("请选择教室");
										return false;
									} else {
										couseFile.classroomIds = "";
										$(".select-room-box tbody input[type='checkbox']:checked").each(function(i, n) {
											if(couseFile.classroomIds == "") {
												couseFile.classroomIds = $(n).val();
											} else {
												couseFile.classroomIds += "," + $(n).val();
											}
										});
									}
								} else {
									couseFile.address = $("#suggestId").val();
									var optionInfo = positionMap.getPosition();
									if(optionInfo == null) {
										$yt_alert_Model.prompt("请在地图中选择签到地点");
										return false;
									}
									couseFile.longitude = optionInfo.lat;
									couseFile.latitude = optionInfo.lng;
									couseFile.placeSign = $(".select-room-box [name='placeSign']:checked").val();

								}

								//选择上课地点
								$yt_baseElement.showLoading();
								$.ajax({
									type: "post",
									url: "class/course/updateClassRoom",
									data: couseFile,
									async: true,
									success: function(data) {
										if(data.flag == 0) {
											$yt_baseElement.hideLoading(function() {
												$yt_alert_Model.prompt("上课地点修改成功");
												$(".select-room-box").hide();
												courseManager.getCourseList();
											});
										} else {
											$yt_baseElement.hideLoading(function() {
												$yt_alert_Model.prompt("操作失败，请稍后重试");
											});
										}
									},
									error: function(data) {
										$yt_baseElement.hideLoading(function() {
											$yt_alert_Model.prompt("网络出现问题，请稍后重试");
										});
									}
								});
							});
						}
					},
					error: function(data) {

					}
				});

			}

		});
		//打印课件
		$('.print-couse').click(function() {
			/** 
			 * 显示编辑弹出框和显示顶部隐藏蒙层 
			 */
			$(".print-couse-form").show();
			var projectCode = $yt_common.GetQueryString("projectCode");
			var fileType = 1;
			$('.print-couse-form tbody').empty();
			//调用显示页面loading方法  
			$yt_baseElement.showLoading();
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "class/course/getPrinting",
				data: {
					projectCode: projectCode,
					fileType: fileType
				},
				async: true,
				success: function(data) {
					if(data.flag == 0) {
						console.log(data.data);
						var htmlBody = $('.print-couse-form tbody');
						var htmlStr = '';
						$.each(data.data, function(c, v) {
							var states = "";
							if(v.states == 2) {
								states = '已完成';
							} else if(v.states == 3) {
								states = '打印中';
							} else if(v.states == 4) {
								states = '已作废';
							} else {
								states = '未打印';
							}
							htmlStr = '<tr class="print-tr">' +
								'<td style="padding-left:20px">';
								if(v.states==5){
									htmlStr+='<label class="check-label yt-checkbox">' +
									'<input class="print-check" type="checkbox" name="test" value="1"/></label>';
								}
						htmlStr+='</td>' +
								'<td class="curse-file-name" style="text-align: left;padding-left: 10px;"><input type="hidden" class="curse-file-id" value="' + v.fileId + '"/>' + v.fileName + '</td>' +
								'<td>' + v.teacherName + '</td>';
								if(v.states!=5){
									htmlStr+='<td><input class="yt-input print-count " disabled="disabled" type="number" value="' + v.printerCount + '" /></td>';
								}else{
									htmlStr+='<td><input style="width:85px;text-align: right;" class="yt-input "  type="number" value="' + v.printerCount + '" /></td>';
								}
						htmlStr+='<td class="print-states">' + states + '</td>' +
								'<input type="hidden" class="curse-id" value="' + v.courseId + '"' +
								'</tr>';
							htmlBody.append(htmlStr);
//							if(states != "未打印") {
//								htmlBody.find('label.check-label').hide();
//								htmlBody.find('.print-count').attr("disabled", "disabled");
//								htmlBody.find('.print-count').removeClass("print-counts");
//							}else {
//								htmlBody.find('label.check-label').show();
//								htmlBody.find('.print-states5').removeAttr("disabled");
//								htmlBody.find('.print-states5').addClass("print-counts");
//							}
						});
						$yt_baseElement.hideLoading();
					}
				}
			});
			/** 
			 * 调用算取div显示位置方法 
			 */
			$yt_alert_Model.getDivPosition($(".print-couse-form"));
			/* 
			 * 调用支持拖拽的方法 
			 */
			$yt_model_drag.modelDragEvent($(".print-couse-form .yt-edit-alert-title"));
			/**
			 * 点击提交方法
			 */
			$('.print-couse-form .yt-model-sure-btn').off().on('click', function() {
				var printData = [];
				var printList = "";
				//选中一行的打印数量
				var printerCount="";
				//声明一个字符串
				var repeatNum="0";
				var checklength=$('.print-check:checked').length;
				$('.print-check:checked').parent().parent().parent().each(function(a, b) {
					var fileId = $(b).find('.curse-file-id').val();
					var courseId = $(b).find('.curse-id').val();
					var fileName = $(b).find('.curse-file-name').text();
					if(printerCount==""){
						printerCount+=$(b).find('.yt-input').val();
					}else{
						printerCount+=","+$(b).find('.yt-input').val();
					}
					var printerCounts = $(b).find('.yt-input').val();
					var states = $(b).find('.print-states').text();
					if(states == "未打印") {
						printList = {
							projectCode: projectCode,
							courseId: courseId,
							fileId: fileId,
							fileName: fileName,
							printerCount: printerCounts,
							fileType: 1,
							states: 3
						};
						printData.push(printList);
					}

				});
				console.log("printerCount",printerCount);
				var pringingData = JSON.stringify(printData);
				console.log(pringingData);
				if(checklength !=0) {
					if(repeatNum.indexOf(printerCount)==-1){
						console.log("有打印数量");
						//显示loading
					$yt_baseElement.showLoading();
					$.ajax({
						type: "post",
						url: $yt_option.base_path + "class/course/addPrinting",
						data: {
							pringingData: pringingData
						},
						async: true,
						success: function(data) {
							if(data.flag == 0) {
								console.log("成功");
								$yt_baseElement.hideLoading(function() {
									$yt_alert_Model.prompt("提交成功");
									$(".print-couse-form").hide();
								});
							} else {
								$yt_baseElement.hideLoading(function() {
									$yt_alert_Model.prompt("提交失败");
								});
							}

						}
					});	
					}else{
						$yt_alert_Model.prompt("请填写打印数量");
					}
				
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("请选择需要打印的附件");
					});
				}

			});
			/** 
			 * 点击取消方法 
			 */
			$('.print-couse-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
				//隐藏页面中自定义的表单内容  
				$(".print-couse-form").hide();
				//隐藏蒙层  
				$("#pop-modle-alert").hide();
			});
		});
		//合并评分
		$('.merge-score-couse').click(function() {
			var projectCode = $yt_common.GetQueryString("projectCode");
			//获取课程信息
			var htmlBody = $('.merge-score-form tbody:eq(0)');
			var htmlHistory = $('.merge-score-form tbody:eq(1)');
			htmlBody.empty();
			htmlHistory.empty();
			$('.merge-couse-name').val("");
			
			var histCourseId = '';
			$("input[name='couseCheck']:checked").parents("tr").each(function(c, d) {
				var couseInfo = $(d).data("couseInfo");
				console.log(couseInfo);
				htmlStr = '<tr class="print-tr">' +
					'<input class="merge-course-id" type="hidden" value="' + couseInfo.pkId + '"/>' +
					'<td >' + couseInfo.courseDate + '</td>' +
					'<td style="text-align:center;">' + couseInfo.courseTime + '</td>' +
					'<td style="text-align:center;">' + couseInfo.courseTypeName + '</td>' +
					'<td style="text-align:center;">' + couseInfo.teacherName + '</td>' +
					'<td style="text-align:center;">' + couseInfo.courseName + '</td>' +
					'</tr>';
				htmlBody.append(htmlStr);
			});
			/**
			 * 查询合并评分历史记录
			 */
			//显示loading
			$yt_baseElement.showLoading();
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "class/course/getCourseMerge",
				data: {
					projectCode: projectCode
				},
				async: true,
				success: function(data) {
					var rowNmu=1;
					var mergeTitle;
					var lastNum;
					
					if(data.flag == 0) {
						//隐藏loading
						$yt_baseElement.hideLoading();
						console.log("查询历史记录成功", data.data);
						$.each(data.data, function(g, h) {
							var htmlStr = '';
							debugger
							if(histCourseId == "") {
								histCourseId += h.pkId;
							} else {
								histCourseId += "," + h.pkId;
							}
							htmlStr += '<tr>'+
						            '<input class="" type="hidden" value="' + h.pkId + '"/>' +
									'<input class="course-merge-code" type="hidden" value="' + h.mergeCode + '"/>' +
									'<td >' + h.courseDate + '</td>' +
									'<td style="text-align:center;">' + h.courseTime + '</td>' +
									'<td style="text-align:center;">' + h.courseTypeName + '</td>' +
									'<td style="text-align:center;">' + h.teacherName + '</td>' +
									'<td style="text-align:center;">' + h.courseName + '</td>';
							if(mergeTitle!=h.mergeTitle){
								$('.merge-record tbody tr').eq(lastNum).find('td').eq(5).attr('rowspan',rowNmu);
								$('.merge-record tbody tr').eq(lastNum).find('td').eq(6).attr('rowspan',rowNmu);
								mergeTitle=h.mergeTitle;
								lastNum=g;
								rowNmu=1;
								htmlStr +='<td rowspan="" style="text-align:center;">' + h.mergeTitle + '</td>'+
								'<td class="cancel-merge-btn">取消合并</td>';
							}else{
								rowNmu++;
							}
							$('.merge-record tbody tr').eq(lastNum).find('td').eq(5).attr('rowspan',rowNmu);
							$('.merge-record tbody tr').eq(lastNum).find('td').eq(6).attr('rowspan',rowNmu);
							htmlStr += '</tr>';
							htmlHistory.append(htmlStr);
						});
					}
				}
			});
			/** 
			 * 显示编辑弹出框和显示顶部隐藏蒙层 
			 */
			$(".merge-score-form").show();
			/** 
			 * 调用算取div显示位置方法 
			 */
			$yt_alert_Model.getDivPosition($(".merge-score-form"));
			/* 
			 * 调用支持拖拽的方法 
			 */
			$yt_model_drag.modelDragEvent($(".merge-score-form .yt-edit-alert-title"));
			/**
			 * 点击合并方法
			 */
			$('.merge-score-form .yt-model-sure-btn:eq(0)').off().on('click', function() {
				//课程合并ID
				var mergeCourseId = "";
				var tipCourseName = "";
				//循环取到每个课程ID
				$('.merge-course-id').each(function() {
                        
					var checkCourseId = $(this).val();
					if(mergeCourseId == "") {
						mergeCourseId += checkCourseId;
					} else {
						mergeCourseId += ',' + checkCourseId;
					}
					//判断选中的课程id是否在合并历史记录里面
					if(histCourseId.indexOf(checkCourseId) != -1) {
						if(tipCourseName == "") {
							tipCourseName += $(this).parent().find('td:eq(4)').text();
						} else {
							tipCourseName += "," + $(this).parent().find('td:eq(4)').text();
						}

					}
				});
				//合并后课程主题
				var courseName = $('.merge-couse-name').val();
				if(tipCourseName == "") {
					if($('.merge-course-id').length>1){
					//显示loading
					$yt_baseElement.showLoading();
					$.ajax({
						type: "post",
						url: $yt_option.base_path + "class/course/updateCourseMerge",
						data: {
							mergeCourseId: mergeCourseId,
							courseName: courseName,
							projectCode: projectCode
						},
						async: true,
						success: function(data) {
							if(data.flag == 0) {
								//隐藏loading
								$yt_baseElement.hideLoading(function() {
									$yt_alert_Model.prompt("合并成功");
								});
								$(".merge-score-form").hide();
							} else {
								$yt_baseElement.hideLoading(function() {
									$yt_alert_Model.prompt("合并失败");
								});
							}
						}
					});	
					}else{
						$yt_alert_Model.prompt("请选择至少两行数据");
					}
					
				} else {
					//隐藏loading
					$yt_baseElement.hideLoading();
					var msg = '';
					//声明数组循环已合并的课程名称
					var couseArray = tipCourseName.split(',');
					for(var i = 0; i < couseArray.length; i++) {
						msg += '《' + couseArray[i] + '》课程已合并,请重新选择</br>'
					}
					$('.merge-score-form').hide();
					$yt_alert_Model.alertOne({
						haveCloseIcon: false, //是否带有关闭图标  
						leftBtnName: "取消", //左侧按钮名称,默认确定  
						alertMsg: msg, //提示信息
						cancelFunction: function() { //点击确定按钮执行方法  
							$('.merge-score-form').show();
						},
					});
				}

			});
			/**
			 * 点击取消合并按钮方法
			 */
			$('.merge-score-form').off().on('click', '.cancel-merge-btn', function() {

				var courseIds = $(this).parent().find('input:eq(0)').val();
				var projectCode = $yt_common.GetQueryString("projectCode");
				var mergeCode = $(this).parent().find('.course-merge-code').val();
				//显示整体框架loading的方法
				$yt_baseElement.showLoading();
				$.ajax({
					type: "post",
					url: $yt_option.base_path + "class/course/updateCancelCourseMerge",
					data: {
						mergeCode: mergeCode,
						courseId: courseIds,
						projectCode: projectCode
					},
					async: true,
					success: function(data) {
						debugger
						if(data.flag == 0) {
							$yt_alert_Model.prompt("取消合并成功");
							$(this).parent().remove();
							//隐藏整体框架loading的方法
							$yt_baseElement.hideLoading();
						} else {
							$yt_alert_Model.prompt("取消合并失败");
							//隐藏整体框架loading的方法
							$yt_baseElement.hideLoading();
						}
					}
				});
			});
			/** 
			 * 点击取消方法 
			 */
			$('.merge-score-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
				//隐藏页面中自定义的表单内容  
				$(".merge-score-form").hide();
				//隐藏蒙层  
				$("#pop-modle-alert").hide();
			});
		});
		//用车申请
		$('.apply-car-couse').click(function() {
			$('.apply-car-form .course-type').text("");
			$('.apply-car-form .course-time').text("");
			$('.apply-car-form .course-theme').text("");
			$('.apply-car-form .course-teacher').text("");
			$('.bus-num').val("");
			$('.course-place').val("");
			//获取课程信息
			var couseInfo = $("input[name='couseCheck']:checked").parents("tr").data("couseInfo");
			console.log(couseInfo);
			var couseInfoLength = $("input[name='couseCheck']:checked").parents("tr").length;
			console.log("couseInfo", couseInfoLength + couseInfo);
			if(couseInfoLength == 1 && couseInfo != null) {
				$('.apply-car-form .course-type').text(couseInfo.courseTypeName);
				$('.apply-car-form .course-time').text(couseInfo.courseDate + ' ' + couseInfo.courseTime);
				$('.apply-car-form .course-theme').text(couseInfo.courseTypeName);
				$('.apply-car-form .course-teacher').text(couseInfo.courseTypeName);
			}
			//获取用车申请历史列表
			courseManager.getApplyCarList();
			//获取下一步审批人和操作
			var user = '';
			var dataObj = '';
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "uniform/workFlowOperate/getSubmitPageData",
				data: {
					businessCode: "courseCar",
					processInstanceId: "",
					parameters: "",
					versionNum: ""
				},
				async: true,
				success: function(data) {
					if(data.flag == 0) {
						console.log(data.data);
						$.each(data.data, function(i, n) {
							
							console.log(n);
							console.log(i);
							for(var k in n) {
								console.log('k', k);
								console.log("n[k]", n[k]);
								user = n[k][0].userCode;
								console.log(user);
								dataObj = eval("(" + k + ")");
								console.log(dataObj);
								console.log(dataObj.nextCode);
							}
						});
					}
				}
			});
			/**
			 * 点击新增按钮
			 */
			$(".apply-car-form .yt-model-sure-btn").off().on('click', function() {
				//班级编号
				var projectCode = $yt_common.GetQueryString("projectCode");
				var userCount = $('.bus-num').val();
				var address = $('.course-place').val();
				if(couseInfoLength == 1 && couseInfo != null) {
					//显示loading
					$yt_baseElement.showLoading();
					$.ajax({
						type: "post",
						url: $yt_option.base_path + "class/course/addCourseUseCar",
						data: {
							projectCode: projectCode,
							courseId: couseInfo.pkId,
							userCount: userCount,
							address: address,
							businessCode: "courseCar",
							dealingWithPeople: user,
							opintion: "",
							processInstanceId: "",
							nextCode: dataObj.nextCode
						},
						async: true,
						success: function(data) {
							
							if(data.flag == 0) {
								//隐藏整体框架loading的方法
								$yt_baseElement.hideLoading(function() {
									$yt_alert_Model.prompt("新增用车成功");
									//获取用车申请历史列表
									courseManager.getApplyCarList();
								});
							} else {
								//隐藏整体框架loading的方法
								$yt_baseElement.hideLoading(function() {
									$yt_alert_Model.prompt("新增用车失败");
								});
							}
						}
					});
				} else {
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("请选中一行数据进行新增");
					});
				}

			});
			/**
			 * 点击取消派车按钮
			 */
			$('.apply-car-form').on('click', '.cancel-car', function() {

			});
			/**
			 * 点击列表中课程主题显示用车详情
			 */
//			$('.apply-car-form').on('click', '.course-name', function() {
//				
//				var courseId = $('.apply-course-id').val();
//				var types = "";
//				//显示loading
//				$yt_baseElement.showLoading();
//				$.ajax({
//					type: "post",
//					url: $yt_option.base_path + "class/course/getCourseUseCar",
//					data: {
//						projectCode: projectCode,
//						courseId: courseId
//					},
//					async: true,
//					success: function(data) {
//						if(data.flag == 0) {
//							if(data.data.sendCarType != 2) {
//								$('.details-tab').hide();
//							} else {
//								$('.details-tab').show();
//							}
//							$('.apply-car-details-form .course-type-details').text(data.data.types);
//							$('.apply-car-details-form .course-time-details').text(data.data.courseTime);
//							$('.apply-car-details-form .course-theme-details').text(data.data.courseName);
//							$('.apply-car-details-form .course-teacher-details').text(data.data.teacherName);
//							$('.apply-car-details-form .bus-num-details').text(data.data.userCount);
//							$('.apply-car-details-form .course-place-details').text(data.data.address);
//							//隐藏整体框架loading的方法
//							$yt_baseElement.hideLoading();
//						} else {
//							//隐藏整体框架loading的方法
//							$yt_baseElement.hideLoading(function() {
//								$yt_alert_Model.prompt("查询失败");
//							});
//						}
//					}
//				});
//				/** 
//				 * 显示编辑弹出框和显示顶部隐藏蒙层 
//				 */
//				$(".apply-car-form").hide();
//				$(".apply-car-details-form").show();
//
//				/** 
//				 * 调用算取div显示位置方法 
//				 */
//				$yt_alert_Model.getDivPosition($(".apply-car-details-form"));
//				/* 
//				 * 调用支持拖拽的方法 
//				 */
//				$yt_model_drag.modelDragEvent($(".apply-car-details-form .yt-edit-alert-title"));
//				/** 
//				 * 点击取消方法 
//				 */
//				$('.apply-car-details-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
//
//					$(".apply-car-details-form").hide();
//					$(".apply-car-form").show();
//					//隐藏页面中自定义的表单内容  
//
//				});
//			});
			/** 
			 * 显示编辑弹出框和显示顶部隐藏蒙层 
			 */
			$(".apply-car-form").show();
			/** 
			 * 调用算取div显示位置方法 
			 */
			$yt_alert_Model.getDivPosition($(".apply-car-form"));
			/* 
			 * 调用支持拖拽的方法 
			 */
			$yt_model_drag.modelDragEvent($(".apply-car-form .yt-edit-alert-title"));
			/** 
			 * 点击取消方法 
			 */
			$('.apply-car-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {

				//隐藏页面中自定义的表单内容  
				$(".apply-car-form").hide();
				//隐藏蒙层  
				$("#pop-modle-alert").hide();
			});
		});

		$(".address-type").change(function() {
			if($(this).val() == "1") {
				$(".external-address").hide()
				$(".internal-address").show();
			} else {
				$(".internal-address").hide();
				$(".external-address").show()
			}
			$yt_alert_Model.setFiexBoxHeight($(".select-room-box .yt-edit-alert-main"));
		});

		//查询教室
		$(".select-room-box .key-word .search-btn").click(function() {
			//查询教室列表
			me.getClassRooms();
		});

	},
	//获取用车申请历史列表
	getApplyCarList:function(){
		//班级编号
			var projectCode = $yt_common.GetQueryString("projectCode");
			//显示loading
			$yt_baseElement.showLoading();
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "class/course/getClassCourseCarList",
				data: {
					projectCode: projectCode
				},
				async: true,
				success: function(data) {
					if(data.flag == 0) {
						var htmlBody = $('.apply-car-form table:eq(1) tbody');
						htmlBody.empty();
						var htmlStr = '';
						$.each(data.data, function(j, k) {
							if(k.sendCarType == 1) {
								k.sendCarType = "派车中";
							} else {
								k.sendCarType = "已派车";
							}
							htmlStr = '<tr>' +
								'<input class="apply-course-id" type="hidden" value="' + k.courseId + '"/>' +
								'<td>' + k.courseTypeName + '</td>' +
								'<td>' + k.courseDate + '</td>' +
								'<td><a class=" course-name">' + k.courseName + '</a></td>' +
								'<td style="text-align:right;padding-right:65px;">' + k.userCount + '</td>' +
								'<td style="text-align:left;">' + k.address + '</td>' +
								'<td>' + k.sendCarType + '</td>' +
								'</tr>';
							htmlBody.append(htmlStr);
						});
						//隐藏loading
						$yt_baseElement.hideLoading();
					}
				}
			});
	},
	getCourseList: function() {
		//查询课程列表
		var projectCode = $yt_common.GetQueryString("projectCode");
		//查询课程信息
		$yt_baseElement.showLoading();
		$.ajax({
			async: true,
			url: $yt_option.base_path + "class/course/lookForAll", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode,
			}, //ajax查询访问参数
			success: function(data) {
				
				if(data.flag == 0) {
					var htmlTbody = $('.course-list-tbody').empty();
					var htmlTr = '';
					if(data.data.rows.length > 0) {
						var rowSpanNum = 1;
						var rowSpanStr = '';
						var lastTr;
						$.each(data.data.rows, function(i, n) {
							var fileName = '';
							var fileUrl = '';
							if(n.files != '' && $.parseJSON(n.files).length > 0) {
								fileUrl = $.parseJSON(n.files)[0].fileUrl;
								fileName = '<span class="file-name" fileUrl="' + fileUrl + '">' + $.parseJSON(n.files)[0].fileName + '</span>';
							}
							htmlTr = '<tr>';
							if(rowSpanStr != n.courseDate) {
								$('.course-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan", rowSpanNum);
								lastTr = i;
								rowSpanStr = n.courseDate;
								htmlTr += '<td class="bgn">' + n.courseDate + '</td>';
								rowSpanNum = 1;
							} else {
								rowSpanNum++;
							}
							htmlTr += '<td> <label class="check-label yt-checkbox">' +
								'<input type="checkbox" name="couseCheck" value="1"/>' + n.courseTime +
								'</label><div class="checkbox-top"></div></td>' +
								'<td>' + (n.courseTypeCode == 'teachingActivities' ? n.courseTypeDetails : n.courseTypeName) + '</td>' +
								'<td>' + n.teacherName + '</td>' +
								'<td>' + n.courseName + '</td>' +
								'<td>' + fileName + '</td>' +
								'<td>' + (n.classroomNames == "" ? n.address : n.classroomNames) + '</td>' +
								'</tr>';
							htmlTr = $(htmlTr).data("couseInfo", n);
							htmlTbody.append(htmlTr);
						});
						$('.course-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan", rowSpanNum);
						$(".course-list-tbody tr").unbind().bind("click", function() {
							if($(this).find("input[type='checkbox']")[0].checked == true) {
								$(this).find("input[type='checkbox']").setCheckBoxState("uncheck");
								$(this).removeClass("yt-table-active");
							} else {
								$(this).find("input[type='checkbox']").setCheckBoxState("check");
								$(this).addClass("yt-table-active");
							}
						});
					} else {
						htmlTr += '<tr style="border:0px;background-color:#fff !important;" >' +
							'<td colspan="7" align="center" style="border:0px;">' +
							'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
							'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
							'</div>' +
							'</td>' +
							'</tr>';
						htmlTbody.html(htmlTr);
					}
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}
			}
		});

	},
	getTeacherList: function() {
		//加载教师列表
		$("select.teacher-list-selt").empty();
		$.ajax({
			type: "post",
			url: $yt_option.base_path + "class/course/getTeacherAll",
			async: false,
			success: function(data) {
				if(data.flag == 0) {
					$.each(data.data, function(i, n) {
						$("select.teacher-list-selt").append('<option value="' + n.teacherId + '">' + n.teacherName + '</option>');
					});
					$("select.teacher-list-selt").niceSelect();
				}
			},
			error: function(data) {

			}
		});
	},
	getCourseType: function() {
		//初始化课程类型下拉列表
		$.ajax({
			type: "post",
			url: "class/course/getCourseType",
			data: {
				courseTypeName: ""
			},
			async: false,
			success: function(data) {
				if(data.flag == 0) {
					$("select.couse-type").empty();
					$.each(data.data, function(i, n) {
						$("select.couse-type").append('<option value="' + n.courseTypeCode + '">' + n.courseTypeName + '</option>');
					});
				} else {
					$yt_alert_Model.prompt("课程类型查询失败");
				}
			},
			error: function(data) {
				$yt_alert_Model.prompt("课程类型查询失败");
			}
		});
		$("select.couse-type").niceSelect();
	},
	deleteCouse: function(pkId) {
		//删除课程
		$yt_baseElement.showLoading();
		$.ajax({
			type: "post",
			url: $yt_option.base_path + "class/course/deleteCourse",
			data: {
				pkId: pkId
			},
			async: true,
			success: function(data) {
				if(data.flag == 0) {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("课程删除成功");
						courseManager.getCourseList();
					});
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("课程删除失败");
					});
				}
			},
			error: function(data) {
				$yt_baseElement.hideLoading(function() {
					$yt_alert_Model.prompt("课程删除失败");
				});
			}
		});
	},
	editCouseInfo: function(pkId) {
		var postState = true;
		var courseTypeCode = $(".couse-type").val();
		var formData = {};

		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");

		if(courseTypeCode == "openingCeremony" || courseTypeCode == "windingUp") {
			if($yt_valid.validFont($(".add-course-box input[name='courseName']"))) {
				var formData = $(".add-course-box").getDatas();
				formData.projectCode = projectCode;
				formData.giveType = $(".add-course-box [name='giveType']:checked").val();
				formData.isNeedGroupPhoto = $(".add-course-box [name='isNeedGroupPhoto']:checked").val();
			} else {
				postState = false;
			}
		} else if(courseTypeCode == "teachingActivities") {
			if($yt_valid.validFont($(".add-course-box input[name='courseName']"))) {
				var formData = $(".add-course-box").getDatas();
				formData.projectCode = projectCode;
				formData.giveType = $(".add-course-box [name='giveType']:checked").val();
				formData.courseTypeDetails = $(".add-course-box [name='courseTypeDetails']").val();
			} else {
				postState = false;
			}
		} else {
			if($yt_valid.validFont($(".add-course-box input[name='courseName']"))) {
				var formData = $(".add-course-box").getDatas();
				formData.projectCode = projectCode;
				formData.giveType = $(".add-course-box [name='giveType']:checked").val();
				formData.teacherId = $(".add-course-box [name='teacherId']").val();

				formData.types = $(".add-course-box [name='fileType']:checked").val();
				var fileId = $(".add-course-box [name='fileType']:checked").parent().next().data("fileInfo").pkId;
				var fileName = $(".add-course-box [name='fileType']:checked").parent().next().data("fileInfo").naming;
				formData.files = JSON.stringify([{
					fileId: fileId,
					fileName: fileName,
					fileTypes: 2
				}]);
			} else {
				postState = false;
			}
		}

		if(postState) {
			if(pkId) {
				formData.pkId = pkId;
			}
			$yt_baseElement.showLoading();
			$.ajax({
				type: "post",
				url: "class/course/addOrUpdateCourse",
				async: true,
				data: formData,
				success: function(data) {
					if(data.flag == 0) {
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("操作成功");
							courseManager.getCourseList();
						});
					} else {
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("操作失败");
						});
					}
				},
				error: function(data) {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("操作失败");
					});
				}
			});
		}
	},
	uploadFiles: function() {
		var couseInfo = $("input[name='couseCheck']:checked").parents("tr").data("couseInfo");
		var projectCode = $yt_common.GetQueryString("projectCode");
		var teacherId = couseInfo.teacherId;
		var pkId = couseInfo.pkId;
		var fileId = $(".couse-file-box input[name='fileType']:checked").parent().next().data("fileInfo").pkId;
		var fileName = $(".couse-file-box input[name='fileType']:checked").parent().next().data("fileInfo").naming;
		var types = $(".couse-file-box input[name='fileType']:checked").val();
		var files = JSON.stringify([{
			fileId: fileId,
			fileName: fileName,
			types: types,
			fileTypes: 2
		}]);
		//上传附件
		$yt_baseElement.showLoading();
		$.ajax({
			type: "post",
			url: "class/course/uploadFiles",
			data: {
				projectCode: projectCode,
				teacherId: teacherId,
				files: files,
				pkId: pkId
			},
			async: true,
			success: function(data) {
				if(data.flag == 0) {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("附件上传成功");
						courseManager.getCourseList();
						$(".couse-file-box").hide();
					});
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("操作异常");
					});
				}
			},
			error: function(data) {
				$yt_baseElement.hideLoading(function() {
					$yt_alert_Model.prompt("网络出现异常，请稍后重试");
				});
			}
		});
	},
	getClassRooms: function() {
		var courseDate = $("input[name='couseCheck']:checked").parents("tr").data("couseInfo");
		var classroomIds = courseDate.classsroomIds;
		console.log(classroomIds);
		var projectCode = $yt_common.GetQueryString("projectCode");
		var classroomName = $(".select-room-box .key-word input").val();
		$(".rooms-page").pageInfo({
			async: true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "class/course/getClassRooms", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				classroomName: classroomName,
				projectCode: projectCode,
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			before: function() {
				$yt_baseElement.showLoading();
			},
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.rooms-tbody').empty();
					var htmlTr = '';
					//初始化日期

					var courseDate = $("input[name='couseCheck']:checked").parents("tr").data("couseInfo").courseDate;
					var weekList = ytDate.startStop(courseDate);

					$(".sun-head").nextAll().remove();
					$(".sun-head").remove();
					var th = '';
					var day = 0;
					var className = '';
					$.each(weekList, function(i, n) {
						day = new Date(n).getDate();
						if(i == 0) {
							className = 'sun-head';
						} else if(i == 6) {
							className = 'sat-head';
						} else {
							className = '';
						}
						th = '<th width="18px" class="state-day ' + className + '" currentDay="' + n + '">' + day + '</th>'
						$(".select-room-box table thead tr").append(th);
					});
					var arrIndex = 0;
					var stateObj = null;
					if(data.data.rows.length > 0) {
						var stateDay = '<td class="state-day"></td>' +
							'<td class="state-day"></td>' +
							'<td class="state-day"></td>' +
							'<td class="state-day"></td>' +
							'<td class="state-day"></td>' +
							'<td class="state-day"></td>' +
							'<td class="state-day"></td>';
						$.each(data.data.rows, function(i, n) {
							htmlTr = '<tr>' +
								'<td rowspan="3" class="tc"><label class="check-label yt-checkbox">' +
								'<input class="check-box"  type="checkbox" value="' + n.pkId + '"/>' +
								'</label></td>' +
								'<td rowspan="3" class="room-name"><span>' + n.classroomName + '</span></td>' +
								'<td rowspan="3">' + n.types + '</td>' +
								'<td rowspan="3" class="tr">' + n.galleryful + '</td>' +
								'<td>上午</td>' +
								stateDay +
								'</tr>' +
								'<tr>' +
								'<td>下午</td>' +
								stateDay +
								'</tr>' +
								'<tr>' +
								'<td>晚上</td>' +
								stateDay +
								'</tr>';
							htmlTr = $(htmlTr).data("roomInfo", n);
							$.each(n.classroomStates, function(j, m) {
								arrIndex = $.inArray(m.classroomDate, weekList);
								if(arrIndex != -1) {
									stateObj = htmlTr.eq(parseInt(m.dataType) - 1).find(".state-day").eq(arrIndex).data("arrIndex", arrIndex);
									stateObj.addClass(m.classroomStates == 0 ? "all-use" : "sub-use");
								}
							});
							htmlTbody.append(htmlTr);
						});

						//修改开始和结束样式
						$(".rooms-tbody .state-day").each(function(i, n) {
							if($(n).hasClass("all-use") || $(n).hasClass("sub-use")) {
								if(i % 7 == 0) {
									$(n).addClass("start-state");
								} else if((i + 1) % 7 == 0) {
									$(n).addClass("end-state");
								} else {
									var lastDay = $(".rooms-tbody .state-day").eq(i - 1);
									var nextDay = $(".rooms-tbody .state-day").eq(i + 1);
									if(!lastDay.hasClass("all-use") && !lastDay.hasClass("sub-use")) {
										$(n).addClass("start-state");
									}
									if(!nextDay.hasClass("all-use") && !nextDay.hasClass("sub-use")) {
										$(n).addClass("end-state");
									}
								}

							}
						});

					} else {
						htmlTr += '<tr style="border:0px;background-color:#fff !important;" >' +
							'<td colspan="10" align="center" style="border:0px;">' +
							'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
							'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
							'</div>' +
							'</td>' +
							'</tr>';
						htmlTbody.html(htmlTr);
					}

					$yt_baseElement.hideLoading();
					$('.room-name span').tooltip({
						position: 'right',
						content: function() {
							var roomInfo = $(this).parent().parent().data("roomInfo");
							roomInfo.infrastructure = roomInfo.infrastructure.replace("1", "白板").replace("2", "投影").replace("3", "扩音器").replace("4", roomInfo.infrastructureOther);
							var showBox = '<table class="tip-table">' +
								'<tr><td class="tip-lable">教室序号：</td><td>A303</td></tr>' +
								'<tr><td class="tip-lable">类型：</td><td>' + roomInfo.types + '</td></tr>' +
								'<tr><td class="tip-lable">可容纳人数：</td><td>' + roomInfo.galleryful + '人</td></tr>' +
								'<tr><td class="tip-lable">基础设施：</td><td>' + roomInfo.infrastructure + '</td></tr>' +
								'<tr><td class="tip-lable">备注：</td><td>' + roomInfo.remarks + '</td></tr>' +
								'</table>';
							return showBox;
						},
						onShow: function() {
							$(this).tooltip('tip').css({
								backgroundColor: '#666',
								borderColor: '#666'
							});
						}
					});

					$yt_alert_Model.setFiexBoxHeight($(".select-room-box .yt-edit-alert-main"));
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}
				/** 
				 * 调用算取div显示位置方法 
				 */
				$yt_alert_Model.getDivPosition($(".select-room-box"));

			}
		})
	}
}
/**
 * 学员管理详细信息
 */
var studentList = {
	init: function() {
		
//		 	$(".student-div .list-table tr").unbind().bind("click", function() {
//				if($(this).find("input[type='checkbox']")[0].checked == true) {
//					$(this).find("input[type='checkbox']").setCheckBoxState("uncheck");
//					$(this).removeClass("yt-table-active");
//				} else {
//					$(this).find("input[type='checkbox']").setCheckBoxState("check");
//					$(this).addClass("yt-table-active");
//				}
//			});
		
//		//点击更多
//		var clickNumber = 0;
//		$('.search-more').off().on('click', function() {
//			//显示窗口
//			if(clickNumber % 2 == 0) {
//				$('.search-box').show();
//				$('.search-put').addClass('flipy');
//			} else {
//				$('.search-box').hide();
//				$('.realName').val("");
//				$('.org').val("");
//				$('.isFormal').setSelectVal("1");
//				$('.title').val("");
//				$('.researchArea').val("");
//				$('.states').setSelectVal("1");
//				$('.startAttendClassStart').val("");
//				$('.startAttendClassEnd').val("");
//				$('.endAttendClassStart').val("");
//				$('.endAttendClassEnd').val("");
//				$('.gradeStart').val("");
//				$('.gradeEnd').val("");
//				$('.search-put').removeClass('flipy');
//			}
//			clickNumber++;
//		});
	var traineeId;
	 $('.org-type').niceSelect();
	 //民族下拉列表
	 var studentNationList=studentList.getStudentNationList();
	 if(studentNationList!=""){
	 	$.each(studentNationList, function(i,w) {
	 		$('.class-student-stration-form .student-nation').append('<option value="'+w.nationId+'">'+w.nationName+'</option>');
	 	});
	 	$('.class-student-stration-form .student-nation').niceSelect();
	 }
	 //集团下拉列表
	  var studentGroupList=studentList.getStudentGroupList();
	if(studentGroupList!=""){
		$.each(studentGroupList, function(i,q) {
			$('.class-student-stration-form .group-id-elementary').append('<option value="'+q.groupId+'">'+q.groupName+'</option>');	
		});
		$('.class-student-stration-form .group-id-elementary').niceSelect();
	}
		//下拉框二级联动
	$('.class-student-stration-form .group-id-elementary').change(function(){
			groupId=$(this).val();
			var companyList=studentList.getStudentCompanyList(groupId);
			//单位添加数据
			if(companyList!=""){
				$('.class-student-stration-form .org-id').empty();
				$('.class-student-stration-form .org-id').append(' <option value="">请选择</option>');
				$.each(companyList, function(i,o) {
					$('.class-student-stration-form .org-id').append(' <option value="'+o.orgId+'">'+o.orgName+'</option>');
				});
				$('.class-student-stration-form .org-id').niceSelect();
			}else{
				$('.class-student-stration-form .org-id').empty();
				$('.class-student-stration-form .org-id').append(' <option value="">请选择</option>');
				$('.class-student-stration-form .org-id').niceSelect();
			}
	});
	//点击学员姓名查看详情
	$('.box-list').on('click','.real-name-inf',function(){
		//var studentList=$('.yt-table-active').data('studentList');
		var traineeId=$(this).prev().val();
		var headImg=new Image();
		//获取班级编号
		 var projectCode = $yt_common.GetQueryString("projectCode");
		 //显示整体框架loading的方法
		 $yt_baseElement.showLoading();
		 $.ajax({
		 	type:"post",
		 	url:$yt_option.base_path + "class/trainee/getTraineeDetails",
		 	data:{
		 		traineeId:traineeId,
		 		projectId:projectCode
		 	},
		 	async:true,
		 	success:function(data){
		 		
		 		var htmlBody=$('.student-details-form .student-details-train-record tbody');
	 			var htmlTrs='';
	 			htmlBody.empty();
		 		if(data.flag==0){
		 			detailsMsg=data.data;
		 			detailsMsg.checkInDate=detailsMsg.checkInDate.split(" ")[0];
		 			//性别
		 			if(detailsMsg.gender==1){
		 				detailsMsg.gender="男";
		 			}else{
		 				detailsMsg.gender="女";
		 			}
		 			//发票类型
		 			if(detailsMsg.invoiceType==0){
		 				detailsMsg.invoiceType="暂不开票";
		 			}else if(detailsMsg.invoiceType==1){
		 				detailsMsg.invoiceType="普通发票";
		 			}else{
		 				detailsMsg.invoiceType="增值税发票";
		 			}
		 			//报到状态
		 			if(detailsMsg.checkInState==0){
		 				detailsMsg.checkInState="未报到";
		 			}else{
		 				detailsMsg.checkInState="已报到";
		 			}
		 			//缴费状态
		 			if(detailsMsg.paymentState==0){
		 				detailsMsg.paymentState="未缴费";
		 			}else{
		 				detailsMsg.paymentState="已缴费";
		 			}
		 			//开票状态
		 			if(detailsMsg.isOrderNum==0){
		 				detailsMsg.isOrderNum="未开票";
		 			}else{
		 				detailsMsg.isOrderNum="已开票";
		 			}
		 			$('.student-details-form .cont-edit-test').setDatas(detailsMsg);
		 			
		 			console.log("学员头像",detailsMsg.headPortraitUrl);
		 			if(detailsMsg.headPortrait!=""){
		 				headImg.src=detailsMsg.headPortraitUrl;
			 			headImg.onload=function(){
			 					$('.student-details-img').attr('src',headImg.src);
							$('.student-details-img').jqthumb({  
							    width: 89,  
							    height: 130
							});
						};
		 			}else{
		 				$('.student-details-img').attr('src','../../resources/images/classStudent/student-picture.png');
		 				$('.student-details-img').jqthumb({  
							    width: 89,  
							    height: 130
							});
		 			}
		 			//添加培训记录
		 			$.each(detailsMsg.trainList, function(i,b) {
		 				htmlTrs='<tr>'+
		 				'<td style="text-align: center;">'+b.projectCode+'</td>'+
	 					'<td style="text-align: center;">'+b.projectName+'</td>'+
 						'<td style="text-align: center;">'+b.startDate+'</td>'+
						'<td>'+b.projectHead+'</td>'+
						'<td>'+b.certificateNo+'</td>'+
		 				'</tr>';
		 				htmlBody.append(htmlTrs);
		 			});
		 			//隐藏整体框架loading的方法
		 			$yt_baseElement.hideLoading();
		 		}
		 	}
		 });
		/** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
        $(".student-details-form").show();  
        /** 
         * 调用算取div显示位置方法 
         */  
        $yt_alert_Model.setFiexBoxHeight($(".student-details-form .yt-edit-alert-main"));
        $yt_alert_Model.getDivPosition($(".student-details-form"));  
        /* 
         * 调用支持拖拽的方法 
         */  
        $yt_model_drag.modelDragEvent($(".student-details-form .yt-edit-alert-title"));  
        /** 
         * 点击取消方法 
         */  
        $('.student-details-form .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".student-details-form").hide();  
        });  
	});
	//点击设置班委
	$('.class-set-committee-btn').off('click').on('click',function(){
		if($('.student-div tbody label input[type="checkbox"]:checked').length==1){
			var committee='';
			var committeeList=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList');
			console.log(committeeList);
			var committeeName=committeeList.realName;
			$('.class-student-set-committee-from .need-set-group').text(committeeName);
		$.ajax({
			type:"post",
			url:$yt_option.base_path +"class/trainee/getTraineeCommittee",
			data:{
				committee:committee
			},
			async:true,
			success:function(data){
				var htmlBody=$('.class-student-set-committee-from .set-group-lable');
				var htmlTr='';
				htmlBody.empty();
				if(data.flag==0){
					$.each(data.data, function(i,v) {
						htmlTr='<label class="check-label yt-radio ">'+
								'<input  type="radio" name="test"  value="'+v.classCommitteeId+'"/>'+v.classCommitteeName+'</label>'; 
						htmlBody.append(htmlTr);
						
					});
					if(committeeList.classCommitteeId==0){
						committeeList.classCommitteeId=4;
					}
					//设置选中
					$('.class-student-set-committee-from label').find('input[value="'+committeeList.classCommitteeId+'"]').setRadioState("check");
				}
			}
		});
		
		 /** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
        $(".class-student-set-committee-from").show();  
        /** 
         * 调用算取div显示位置方法 
         */  
        $yt_alert_Model.getDivPosition($(".class-student-set-committee-from"));  
        /* 
         * 调用支持拖拽的方法 
         */  
        $yt_model_drag.modelDragEvent($(".class-student-set-committee-from .yt-edit-alert-title")); 
       /**
        * 点击确定方法
        */
       $('.class-student-set-committee-from .yt-model-sure-btn').off('click').on('click',function(){
       		//班级编号
        	var projectCode = $yt_common.GetQueryString("projectCode");
        	//学员ID
        	var traineeId=committeeList.traineeId;
            //获取班委ID
           var classCommitteeId=$('.class-student-set-committee-from .set-group-lable input[name="test"]:checked').val();
           console.log(classCommitteeId);
           //显示整体框架loading的方法
           $yt_baseElement.showLoading();
           $.ajax({
           	type:"post",
           	url:$yt_option.base_path +"class/trainee/updateTraineeCommittee",
           	data:{
           		projectCode:projectCode,
           		traineeId:traineeId,
           		classCommitteeId:classCommitteeId
           	},
           	async:true,
           	success:function(data){
           		if(data.flag==0){
           			//隐藏整体框架loading的方法
           			$yt_baseElement.hideLoading(function(){
           				$yt_alert_Model.prompt("设置班委成功");
           				 //隐藏页面中自定义的表单内容  
			           	 $(".class-student-set-committee-from").hide();
				         studentList.getStudentList();
				         studentList.getDifferentList();
           			});
           		}else{
           			//隐藏整体框架loading的方法
           			$yt_baseElement.hideLoading(function(){
           				$yt_alert_Model.prompt("设置班委失败");
           			});
           		}
           	}
           });
       }); 
        /** 
         * 点击取消方法 
         */  
        $('.class-student-set-committee-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".class-student-set-committee-from").hide();  
        }); 
		}else{
			$yt_alert_Model.prompt("请勾选一条设置班委");
		}
		 
	});
	//点击分组职务
	$('.class-set-group-post-btn').on('click',function(){
		  $(".class-student-set-group-post-from").show(); 
		if($('.student-div tbody label input[type="checkbox"]:checked').length==1){
			var setName=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').realName;
			//列表选中的分组职务
			var groupPosition=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').groupPositionType;
			var groupPositionData=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').groupPositionData;
			$('.class-student-set-group-post-from .set-group-lable input[name="test"][value="'+groupPosition+'"]').setRadioState("check");
			if(groupPosition==3){//判断分组职务为3
				$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').show();
				$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').val(groupPositionData);
			}else{//判断分组职务不为3
				$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').hide();
			}
			$('.class-student-set-group-post-from .need-set-group').text(setName);
			//$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').hide();
		var setRadioVal=$('.class-student-set-group-post-from .set-group-lable input[name="test"]');
		//分组职务
		var groupPositionType;
		setRadioVal.change(function(){
			debugger
			groupPositionType=$(this).val();
			if($(this).val()==1||$(this).val()==2){
				$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').hide();
			}else{
				$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').val("");
				$('.class-student-set-group-post-from .set-group-lable .set-group-custom-input').show();
				
			}
		});
		 /** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
       
        /** 
         * 调用算取div显示位置方法 
         */  
        $yt_alert_Model.getDivPosition($(".class-student-set-group-post-from"));  
        /* 
         * 调用支持拖拽的方法 
         */  
        $yt_model_drag.modelDragEvent($(".class-student-set-group-post-from .yt-edit-alert-title"));
        /**
         * 点击确定按钮
         */
        $('.class-student-set-group-post-from .yt-model-sure-btn').on('click',function(){
        	//班级编号
        	var projectCode = $yt_common.GetQueryString("projectCode");
        	//学员ID
        	var traineeId=$('.student-div tbody label input[type="checkbox"]:checked').parent().parent().parent().data('studentList').traineeId;
			//选择自定义设置的值      
		      var groupPositionData=$('.class-student-set-group-post-from .set-group-custom-input').val();
		      //显示整体框架loading的方法
		      $yt_baseElement.showLoading();
		      $.ajax({
		      	type:"post",
		      	url:$yt_option.base_path + "class/trainee/updateTraineeGroupPosition",
		      	data:{
		      		projectCode:projectCode,
		      		traineeId:traineeId,
		      		groupPositionType:groupPositionType,
		      		groupPositionData:groupPositionData
		      	},
		      	async:true,
		      	success:function(data){
		      		if(data.flag==0){
		      			//隐藏整体框架loading的方法
		      			$yt_baseElement.hideLoading(function(){
		      			$yt_alert_Model.prompt("分组职务设置成功");	
		      			//隐藏页面中自定义的表单内容  
            			$(".class-student-set-group-post-from").hide();  
		      			});
		      			studentList.getStudentList();
         				studentList.getDifferentList();
		      		}else{
		      			//隐藏整体框架loading的方法
		      			$yt_baseElement.hideLoading(function(){
		      			$yt_alert_Model.prompt("分组职务设置失败");	
		      			});
		      		}
		      	}
		      });
        });
        /** 
         * 点击取消方法 
         */  
        $('.class-student-set-group-post-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".class-student-set-group-post-from").hide();  
        });
		}else{
			$yt_alert_Model.prompt("请勾选一行数据添加职务");
		}
		  
	});
	//点击分组设置分组
	$('.class-set-group-btn').on('click',function(){
		$('.class-student-set-group-from .set-group-num').val("");
			var traineeIds='';
        	var traineeNames='';
        	//判断复选框的长度
        	if($('.student-div tbody label input[type="checkbox"]:checked').length!=0){
        		$('.class-student-set-group-from .set-group-selected-length').text($('.student-div tbody label input[type="checkbox"]:checked').length);
        	$('.student-div tbody label input[type="checkbox"]:checked').each(function(){
				if(traineeIds==''){
						traineeIds+=$(this).parent().parent().parent().data('studentList').traineeId;
						traineeNames+=$(this).parent().parent().parent().data('studentList').realName;
				}else{
						traineeIds+=', '+$(this).parent().parent().parent().data('studentList').traineeId;
						traineeNames+=', '+$(this).parent().parent().parent().data('studentList').realName;
				}
			
			});
			console.log(traineeNames);
			console.log(traineeIds);
			$('.class-student-set-group-from .set-group-list').text(traineeNames);
		  /** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
        $(".class-student-set-group-from").show();  
        /** 
         * 调用算取div显示位置方法 
         */  
        $yt_alert_Model.getDivPosition($(".class-student-set-group-from"));  
        /* 
         * 调用支持拖拽的方法 
         */  
        $yt_model_drag.modelDragEvent($(".class-student-set-group-from .yt-edit-alert-title"));  
        /**
         * 点击确定按钮
         */
        $('.class-student-set-group-from .yt-model-sure-btn').on('click',function(){
        	//班级编号
        	var projectCode = $yt_common.GetQueryString("projectCode");
        	var groupNum=$('.class-student-set-group-from .set-group-num').val();
        	//显示整体框架loading的方法
        	$yt_baseElement.showLoading();
        	$.ajax({
        		type:"post",
        		url:$yt_option.base_path + "class/trainee/updateTraineeGroup",
        		data:{
        			projectCode:projectCode,
        			groupNum:groupNum,
        			traineeIds:traineeIds
        		},
        		async:true,
        		success:function(data){
        			if(data.flag==0){
        				//隐藏整体框架loading的方法
        				$yt_baseElement.hideLoading(function(){
        					$yt_alert_Model.prompt("分组设置成功");
        					//隐藏页面中自定义的表单内容  
          					 $(".class-student-set-group-from").hide();  
        				});
        				studentList.getStudentList();
         				studentList.getDifferentList();
        			}else{
        				//隐藏整体框架loading的方法
        				$yt_baseElement.hideLoading(function(){
        					$yt_alert_Model.prompt("分组设置失败");
        				});
        			}
        		}
        	});
        	
        });
        /** 
         * 点击取消方法 
         */  
        $('.class-student-set-group-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".class-student-set-group-from").hide();  
        });  
        	}else{
        		$yt_alert_Model.prompt("请勾选数据进行分组");
        	}
        	
	});
	//点击预订房间
	$('.class-reserve-room-btn').on('click',function(){
		var projectCode = $yt_common.GetQueryString("projectCode");
		var selectParam ="";
		var gender = "";
		var phone = "";
		var groupId = "";
		var orgId = "";
		var deptPosition = "";
		var isFirstTraining = "";
		var classCommitteeId = "";
		var signUpState = "";
		var checkInState = "";
		var sort = "";
		var orderType = "";
	 $('.class-reserve-room-from .page-info').pageInfo({
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "class/trainee/getClassTrainee", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode:projectCode,
				selectParam: selectParam,
				gender: gender,
				phone: phone,
				groupId: groupId,
				orgId: orgId,
				deptPosition: deptPosition,
				isFirstTraining: isFirstTraining,
				classCommitteeId: classCommitteeId,
				signUpState: signUpState,
				checkInState: checkInState,
				sort: sort,
				orderType: orderType
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			before:function(){
				//显示loading
				$yt_baseElement.showLoading();
			},
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.class-reserve-room-from .list-tbody');
					var htmlTr = '';
					$(htmlTbody).empty();
					if(data.data.rows.length>0){
							$.each(data.data.rows, function(i, v) {
							if(v.gender==1){
								v.gender="男";
							}else if(v.gender==2){
								v.gender="女";
							}
							htmlTr = '<tr>' +
							'<input type="hidden" class="reserve-room-trainee-id" value="'+v.traineeId+'"/>'+
								'<td style="text-align: left;padding-left: 20px;">' + v.realName + '</td>' +
								'<td style="text-align: center;">' + v.gender + '</td>' +
								'<td style="text-align: center;">' + v.phone + '</td>' +
								'<td>' + v.groupOrgName + '</td>' +
								'<td>' + v.deptName + '</td>' +
								'<td><input class="yt-input room-number" value="'+v.roomNumber+'"/></td>' +
								'</tr>';
							htmlTr=$(htmlTr).data('reserveList',v);
							htmlTbody.append(htmlTr);
					});
					}else{
						htmlTr = '<tr class="class-tr">'+
										'<td colspan="6" align="center" style="border:0px;">'+
											'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
												'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
											'</div>'+
										'</td>'+
									'</tr>';
					htmlTbody.append(htmlTr);
					}
					//隐藏loading
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
        /** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
        $(".class-reserve-room-from").show();  
        /** 
         * 调用算取div显示位置方法 
         */  
         $yt_alert_Model.setFiexBoxHeight($(".class-reserve-room-from .yt-edit-alert-main"));
        $yt_alert_Model.getDivPosition($(".class-reserve-room-from"));  
        /* 
         * 调用支持拖拽的方法 
         */  
        $yt_model_drag.modelDragEvent($(".class-reserve-room-from .yt-edit-alert-title"));  
        /**
         * 点击确定按钮
         */
        $('.class-reserve-room-from .yt-model-sure-btn').on('click',function(){
        	//班级编号
			var projectCode = $yt_common.GetQueryString("projectCode");
			var list=[];
        	$('.class-reserve-room-from .list-tbody .room-number').each(function(){
        		if($(this).val()!=""){
        			var traineeId=$(this).parent().parent().find('.reserve-room-trainee-id').val();
        			var roomNumber=$(this).val();
        			var traineeName=$(this).parent().parent().find('td').eq(0).text();
        			var reserveList={
        				traineeId:traineeId,
        				traineeName:traineeName,
        				roomNumber:roomNumber
        			};
        			list.push(reserveList);
        		}
        	});
        	console.log(list);
        	//学员和房间号
			var traineeIdRoomNumber=JSON.stringify(list);
			console.log(traineeIdRoomNumber);
			//显示整体框架loading的方法
			$yt_baseElement.showLoading();
			$.ajax({
				type:"post",
				url:$yt_option.base_path+"class/trainee/updateTraineeRoomNumber",
				data:{
					projectCode:projectCode,
					traineeIdRoomNumber:traineeIdRoomNumber
				},
				async:true,
				success:function(data){
					if(data.flag==0){
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function(){
							$yt_alert_Model.prompt("预定成功");
						});
					}else{
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function(){
							$yt_alert_Model.prompt("预定失败");
						});
					}
				}
			});
        });
        /** 
         * 点击取消方法 
         */  
        $('.class-reserve-room-from .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".class-reserve-room-from").hide();  
        });  
	});
	//点击下载模板
	$('.batch-import-form .download-template').click(function(){
		var fileName="学员列表.xls";
	$.ajaxDownloadFile({
			url:$yt_option.base_path+"class/trainee/downloadTraineeByClass",
			data:{
				fileName:fileName
			}
			});
	});
	//点击导入弹出框的导入按钮
	$('.batch-import-form .yt-model-sure-btn').off().on('click',function(){
		//班级编号
			var projectCode = $yt_common.GetQueryString("projectCode");
			var file=$('.batch-import-form .import-file-name').val();
			var url=$yt_option.base_path+"class/trainee/leadingTraineeByClass";
			//显示整体框架loading的方法
			$yt_baseElement.showLoading();
			$.ajaxFileUpload({
				type:"post",
				url:url,
				dataType:'json',
				fileElementId:'fileName',
				success:function(data,textStatus){
					if(data.flag==0){
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("导入成功");
						});
					}else{
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("导入失败");
						});
					}
				},
				error: function(data, status, e) { //服务器响应失败处理函数  
				$yt_baseElement.hideLoading(function() {
					$yt_alert_Model.prompt("导入文件失败了");
				});
			}
				
			});
	});
	//点击上传附件
	$(".batch-import-form").undelegate().delegate("input[type='file']", "change", function() {
		console.log($(this)[0].files[0].name);
		$('.batch-import-form .import-file-name').val($(this)[0].files[0].name);
//		var url=$yt_option.acl_path+"api/tAscPortraitInfo/addMultipartFiles?modelCode=trainingCourse";
//		//显示整体框架loading的方法
//		$yt_baseElement.showLoading();
//		$.ajaxFileUpload({
//			url:url,
//			type:'post',
//			dataType:'json',
//			fileElementId:'fileName',
//			success:function(data,textStatus){
//				var resultData = $.parseJSON(data);
//				console.log("resultData",resultData.length);
//				$("#fileName").val("");
//				if(resultData.success == 0) {
//					
//					
//				} else {
//					$yt_baseElement.hideLoading(function() {
//						$yt_alert_Model.prompt("上传文件失败");
//					});
//				}
//			},
//			error: function(data, status, e) { //服务器响应失败处理函数  
//				$yt_baseElement.hideLoading(function() {
//					$yt_alert_Model.prompt("上传文件失败了");
//				});
//			}
//		});
	});
	//点击导入按钮
	$('.student-import-btn').on('click',function(){
		/** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
        $(".batch-import-form").show();  
        /** 
         * 调用算取div显示位置方法 
         */  
        $yt_alert_Model.getDivPosition($(".batch-import-form"));  
        /* 
         * 调用支持拖拽的方法 
         */  
        $yt_model_drag.modelDragEvent($(".batch-import-form .yt-edit-alert-title"));  
        /** 
         * 点击取消方法 
         */  
        $('.batch-import-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".batch-import-form").hide();  
            //隐藏蒙层  
            $("#pop-modle-alert").hide();  
        });  
	});
	//点击导出按钮
	$('.student-upload-btn').on('click',function(){
		//班级编号
			var projectCode = $yt_common.GetQueryString("projectCode");
			var exportName=$('.project-name:eq(0)').text()+"学员列表.xls";
			var gender="";
			var phone="";
			var groupId="";
			var orgId="";
			var deptPosition="";
			var isFirstTraining="";
			var classCommitteeId="";
			var signUpState="";
			$.ajaxDownloadFile({
			url:$yt_option.base_path+"class/trainee/exportTraineeByClass",
			data:{
				projectCode:projectCode,
				exportName:exportName,
				gender:gender,
				phone:phone,
				groupId:groupId,
				orgId:orgId,
				deptPosition:deptPosition,
				isFirstTraining:isFirstTraining,
				classCommitteeId:classCommitteeId,
				signUpState:signUpState
			}
			});
	});
	//点击删除按钮
	$('.student-delete-btn').on('click',function(){
		debugger
		var traineeIds='';
		if($('.student-div label input[type="checkbox"]:checked').length!=0){
			$('.student-div label input[type="checkbox"]:checked').each(function(){
				if(traineeIds==''){
						traineeIds+=$(this).parent().parent().parent().data('studentList').traineeId;
				}else{
						traineeIds+=','+$(this).parent().parent().parent().data('studentList').traineeId;
				}
			});
				console.log(traineeIds);
			//获取班级编号
		 	var projectCode = $yt_common.GetQueryString("projectCode");
		 $yt_alert_Model.alertOne({  
        haveCloseIcon: false, //是否带有关闭图标  
        closeIconUrl: "./resources/images/icons/x.png", //关闭图标路径  
        leftBtnName: "确定", //左侧按钮名称,默认确定  
        rightBtnName: "取消", //右侧按钮名称,默认取消  
        cancelFunction: "", //取消按钮操作方法*/  
        alertMsg: "数据删除将无法恢复,确认删除吗?", //提示信息  
        confirmFunction: function() { //点击确定按钮执行方法  
        	//显示整体框架loading的方法
        	$yt_baseElement.showLoading();
           $.ajax({
           	type:"post",
           	url:$yt_option.base_path + "class/trainee/deleteTrainee",
           	data:{
           	projectCode:projectCode,
           	traineeIds:traineeIds
           	},
           	async:true,
           	success:function(data){
           		if(data.flag==0){
           			//隐藏整体框架loading的方法
           			$yt_baseElement.hideLoading(function(){
           				$yt_alert_Model.prompt("删除成功");
           				 
           			});
      	    			 studentList.getStudentList();
      					   studentList.getDifferentList();
           		}else{
           			//隐藏整体框架loading的方法
           			$yt_baseElement.hideLoading(function(){
           				$yt_alert_Model.prompt("删除失败");
           				 
           			});
           			 studentList.getStudentList();
    			     studentList.getDifferentList();	
           		}
           	}
           });
        },  
    }); 
		}else{
			$yt_alert_Model.prompt("请勾选数据进行删除");
		}
		 
	});
	//点击新增
	$('.student-add-btn').on('click',function(){
			$('.class-student-phone').addClass('tip-input');
 	    	$('.class-student-name').addClass('tip-input');
			traineeId="";
			$('.class-student-stration-form .yt-edit-alert-title-msg').text("新增学员");
			//初始化提示信息
			$(".valid-font").text("");
			//获取名字
		 	$('.class-student-stration-form .class-student-name').val("");
		 	//获取组号
		 	$('.class-student-stration-form .class-student-group-num').val("");;
		 	 //获取性别
		 	$('.class-student-stration-form .class-student-name').parent().nextAll().find('input[type="radio"][value="1"]').setRadioState("check");
		 	 //获取民族
		 	$('.class-student-stration-form .student-nation').setSelectVal("");
		 	 //获取手机号
		 	$('.class-student-stration-form .class-student-phone').val("");
		 	  //获取证件类型
		 	$('.class-student-stration-form .card-type').setSelectVal("");
		 	 //获取证件号
		 	$('.class-student-stration-form .id-number').val("");
		 	 //获取集团
		 	$('.class-student-stration-form .group-id-elementary').setSelectVal("");
		 	 //获取单位
		 	$('.class-student-stration-form .org-id').setSelectVal("");
		 	 //获取部门
		 	$('.class-student-stration-form .student-msg .dept-name').val("");
		 	// 获取职位
		 	 var positionName="";
		 	//获取联系人姓名
		 	$('.class-student-stration-form .student-link-man').val("");
		 	 //获取联系人手机号
		 	$('.class-student-stration-form .student-link-man-phone').val("");
		 	 //获取联系人电话
		 	$('.class-student-stration-form .student-link-man-telephone').val("");
		 	 //获取联系人传真
		 	 $('.class-student-stration-form .student-link-man-fax').val("");
		 	 //获取联系人邮箱
		 	$('.class-student-stration-form .student-link-man-email').val("");
		 	 //获取单位地址(邮编)
		 	$('.class-student-stration-form .student-link-man-address-email').val("");
		 	//出生年月
		 	 $('.class-student-stration-form .date-birth').val();
		 	 //获取单位类型
		 	$('.class-student-stration-form .org-type').setSelectVal("");
		 	 //获取通信地址
		 	$('.class-student-stration-form .mailing-address').val("");
		 	 //获取邮政编码
		 	 $('.class-student-stration-form .postal-code').val("");
		 	 //获取传真
		 	 $('.class-student-stration-form .class-student-fax').val("");
		 	 //获取入党时间
		 	 $('.class-student-stration-form .party-date').val();
		 	 //获取全职教育
		 	 $('.class-student-stration-form .education-time').val("");
		 	 //获取全职教育-毕业院校及专业
		 	  $('.class-student-stration-form .education-time-class').val("");
		 	   //获取在职教育
		 	  $('.class-student-stration-form .service-time').val("");
		 	   //获取在职教育-毕业院校及专业
		 	   $('.class-student-stration-form .service-time-class').val("");
		 	    //获取电话号
		 	   $('.class-student-stration-form .telephone-project').val("");
		 	     //获取电子邮件
		 	    $('.class-student-stration-form .class-student-email').val("");
		 	     //获取工作时间
		 	   $('.class-student-stration-form .work-time').val("");
		 /** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
        $(".class-student-stration-form").show();  
        /** 
         * 调用算取div显示位置方法 
         */  
         $yt_alert_Model.setFiexBoxHeight($(".class-student-stration-form .yt-edit-alert-main"));
        $yt_alert_Model.getDivPosition($(".class-student-stration-form"));  
        /* 
         * 调用支持拖拽的方法 
         */  
       $yt_model_drag.modelDragEvent($(".class-student-stration-form .yt-edit-alert-title"));  
        /** 
         * 点击取消方法 
         */  
        $('.class-student-stration-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".class-student-stration-form").hide();  
            //隐藏蒙层  
            $("#pop-modle-alert").hide();  
        });  
	});
	//点击修改按钮
	$('.student-update-btn').on('click',function(){
		var studenList=$('.student-div .yt-table-active').data('studentList');
		console.log('studentList',studenList);
		if(studenList!=null){
			var studentDetailedMsg=studentList.getStudentDetailedMsg();
			console.log("studentDetailedMsg",studentDetailedMsg);
			$('.class-student-form .yt-edit-alert-title-msg').text("修改学员");
			traineeId=studentDetailedMsg.traineeId;
			$('.class-student-stration-form').setDatas(studentDetailedMsg);
//			if(studentDetailedMsg.gender=="男"){
//				studentDetailedMsg.gender=1;
//			}else if(studentDetailedMsg.gender=="女"){
//				studentDetailedMsg.gender=2;
//			}
			 //获取性别
		 	 var gender=$('.class-student-stration-form .class-student-name').parent().nextAll().find('input[type="radio"][value="'+studentDetailedMsg.gender+'"]').setRadioState("check");
		 	 //获取民族
		 	$('.class-student-stration-form .student-nation').setSelectVal(studentDetailedMsg.nationId);
		 	  //获取证件类型
		 	$('.class-student-stration-form .card-type').setSelectVal(studentDetailedMsg.idType);
		 	 //获取集团
		 	$('.class-student-stration-form .group-id-elementary').setSelectVal(studentDetailedMsg.groupId);
		 	groupId=studentDetailedMsg.groupId;
		var companyList=studentReport.getCompanyList(groupId);
		//单位添加数据
		if(companyList!=""){
			$('.class-student-stration-form .org-id').empty();
			$('.class-student-stration-form .org-id').append(' <option value="">请选择</option>');
			$.each(companyList, function(i,o) {
				$('.class-student-stration-form .org-id').append(' <option value="'+o.orgId+'">'+o.orgName+'</option>');
			});
			$('.class-student-stration-form .org-id').niceSelect();
		}else{
			$('.class-student-stration-form .org-id').empty();
			$('.class-student-stration-form .org-id').append(' <option value="">请选择</option>');
			$('.class-student-stration-form .org-id').niceSelect();
		}
		 	 //获取单位
		 	$('.class-student-stration-form .org-id').setSelectVal(studentDetailedMsg.groupOrgId);
		 
		 /** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
        $(".class-student-stration-form").show();  
        /** 
         * 调用算取div显示位置方法 
         */  
          $yt_alert_Model.setFiexBoxHeight($(".class-student-stration-form .yt-edit-alert-main"));
        $yt_alert_Model.getDivPosition($(".class-student-stration-form"));  
        /* 
         * 调用支持拖拽的方法 
         */  
       $yt_model_drag.modelDragEvent($(".class-student-stration-form .yt-edit-alert-title"));  
        /** 
         * 点击取消方法 
         */  
        $('.class-student-stration-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".class-student-stration-form").hide();  
            //隐藏蒙层  
            $("#pop-modle-alert").hide();  
        });  
		}else{
			$yt_alert_Model.prompt("请选择一行进行修改");
		}
		
	});
	
	//点击弹框确定按钮
		 $(".class-student-stration-form .yt-model-sure-btn").off('click').on('click',function(){
		 	debugger
		 	//获取班级编号
		 	var projectCode = $yt_common.GetQueryString("projectCode");
		 	//获取名字
		 	var realName=$('.class-student-stration-form .class-student-name').val();
		 	//获取组号
		 	 var groupNum=$('.class-student-stration-form .class-student-group-num').val();;
		 	 //获取性别
		 	 var gender=$('.class-student-stration-form .class-student-name').parent().nextAll().find('input[type="radio"]:checked').val();
		 	 //获取民族
		 	 var nationId=$('.class-student-stration-form .student-nation').val();
		 	 //获取手机号
		 	 var phone=$('.class-student-stration-form .class-student-phone').val();
		 	  //获取证件类型
		 	 var idType=$('.class-student-stration-form .card-type').val();
		 	 //获取证件号
		 	 var idNumber=$('.class-student-stration-form .id-number').val();
		 	 //获取集团
		 	 var groupId=$('.class-student-stration-form .group-id-elementary').val();
		 	 //获取单位
		 	 var orgId=$('.class-student-stration-form .org-id').val();
		 	 //获取部门
		 	 var deptName=$('.class-student-stration-form .student-msg .dept-name').val();
		 	// 获取职位
		 	 var positionName="";
		 	//获取联系人姓名
		 	var linkman=$('.class-student-stration-form .student-link-man').val();
		 	 //获取联系人手机号
		 		var linkmanPhone=$('.class-student-stration-form .student-link-man-phone').val();
		 	 //获取联系人电话
		 		var linkmanTelephone=$('.class-student-stration-form .student-link-man-telephone').val();
		 	 //获取联系人传真
		 		var linkmanFax= $('.class-student-stration-form .student-link-man-fax').val();
		 	 //获取联系人邮箱
		 		var linkmanEmail=$('.class-student-stration-form .student-link-man-email').val();
		 	 //获取单位地址(邮编)
		 		var linkmanAddressEmail=$('.class-student-stration-form .student-link-man-address-email').val();
		 	 //出生年月
		 	 var dateBirth=$('.class-student-stration-form .date-birth').val();
		 	 //获取单位类型
		 	 var orgType=$('.class-student-stration-form .org-type').val();
		 	 //获取通信地址
		 	 var mailingAddress=$('.class-student-stration-form .mailing-address').val();
		 	 //获取邮政编码
		 	 var postalCode=$('.class-student-stration-form .postal-code').val();
		 	 //获取传真
		 	 var fax=$('.class-student-stration-form .class-student-fax').val();
		 	 //获取入党时间
		 	 var partyDate=$('.class-student-stration-form .party-date').val();
		 	 //获取全职教育
		 	 var educationTime=$('.class-student-stration-form .education-time').val();
		 	 //获取全职教育-毕业院校及专业
		 	  var educationTimeClass=$('.class-student-stration-form .education-time-class').val();
		 	   //获取在职教育
		 	  var serviceTime=$('.class-student-stration-form .service-time').val();
		 	   //获取在职教育-毕业院校及专业
		 	   var serviceTimeClass=$('.class-student-stration-form .service-time-class').val();
		 	    //获取电话号
		 	    var telephone=$('.class-student-stration-form .telephone-project').val();
		 	     //获取电子邮件
		 	    var email=$('.class-student-stration-form .class-student-email').val();
		 	     //获取工作时间
		 	    var workTime=$('.class-student-stration-form .work-time').val();
		 	    if(phone!=""){
		 	    	//显示整体框架loading的方法
		 			$yt_baseElement.showLoading();
				 	$.ajax({
				 		type:"post",
				 		url:$yt_option.base_path + "class/trainee/addOrUpdateTrainee",
				 		data:{
				 			traineeId:traineeId,
				 			projectCode:projectCode,
				 			realName:realName,
				 			groupNum:groupNum,
				 			gender:gender,
				 			nationId:nationId,
				 			phone:phone,
				 			idNumber:idNumber,
				 			groupId:groupId,
				 			orgId:orgId,
				 			deptName:deptName,
				 			positionName:positionName,
				 			linkman:linkman,
				 			linkmanPhone:linkmanPhone,
				 			linkmanTelephone:linkmanTelephone,
				 			linkmanFax:linkmanFax,
				 			linkmanEmail:linkmanEmail,
				 			linkmanAddressEmail:linkmanAddressEmail,
				 			idType:idType,
				 			dateBirth:dateBirth,
				 			orgType:orgType,
				 			mailingAddress:mailingAddress,
				 			postalCode:postalCode,
				 			fax:fax,
				 			partyDate:partyDate,
				 			educationTime:educationTime,
				 			educationTimeClass:educationTimeClass,
				 			serviceTime:serviceTime,
				 			serviceTimeClass:serviceTimeClass,
				 			telephone:telephone,
				 			email:email,
				 			workTime:workTime
				 		},
				 		async:true,
				 		success:function(data){
				 			if(data.flag==0){
				 				console.log("traineeId",traineeId);
				 				//隐藏整体框架loading的方法
				 				$yt_baseElement.hideLoading(function(){
				 					if(traineeId==""){
				 						$yt_alert_Model.prompt("添加成功");
				 					}else{
				 						$yt_alert_Model.prompt("修改成功");
				 					}
				 				 studentList.getStudentList();
				 					 $(".class-student-stration-form").hide();  
				 				});
				 			}else{
				 				//隐藏整体框架loading的方法
				 				$yt_baseElement.hideLoading(function(){
				 					if(traineeId==""){
				 					$yt_alert_Model.prompt("添加失败");
				 					}else{
				 						$yt_alert_Model.prompt("修改失败");
				 					}
				 					 studentList.getStudentList();
				 					 $(".class-student-stration-form").hide();  
				 				});
				 			}
				 		}
				 	});
		 	    }else{
		 	    	$('.class-student-phone').removeClass('tip-input');
		 	    	$('.class-student-name').removeClass('tip-input');
		 	    	  /** 
				        * 调用验证方法 
				        */  
       				$yt_valid.validForm($(".valid-tab"));
       				
		 	    }
		 	
		 });
	},
	/**
	 * 获取民族列表
	 */
	getStudentNationList:function(){
		var nationList=[];
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "uniform/getNations",
			data:{
			searchParameters:""	
			},
			async:false,
			success:function(data){
				if(data.flag==0){
					console.log("成功");
					$.each(data.data, function(a,b) {
						nationList.push(b);
					});
				}
			}
		});
		return nationList;
	},
	/**
	 * 获取集团列表
	 */
	getStudentGroupList:function(){
		var groupList=[];
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/trainee/getGroups",
			data:{
			groupName:""	
			},
			async:false,
			success:function(data){
				if(data.flag==0){
					console.log("成功");
					$.each(data.data, function(a,b) {
						groupList.push(b);
					});
				}
			}
		});
		return groupList;
	},
	/**
	 * 获取单位列表
	 */
	getStudentCompanyList:function(groupId){
		var companyList=[];
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/trainee/getOrgs",
			data:{
			orgName:"",
			groupId:groupId
			},
			async:false,
			success:function(data){
				if(data.flag==0){
					console.log("成功");
					$.each(data.data, function(a,b) {
						companyList.push(b);
					});
				}
			}
		});
		return companyList;
	},
	/**
	 * 获取一个学员的详细信息
	 */
	getStudentDetailedMsg:function(){
		debugger
		//var studentList=$('.student-div .yt-table-active').data('studentList');
		var traineeId=$(".student-div .yt-table-active .trainee-id").val();
		var studentDetailedMsg;
		//获取班级编号
		 var projectCode = $yt_common.GetQueryString("projectCode");
		 //显示整体框架loading的方法
		 $yt_baseElement.showLoading();
		 $.ajax({
		 	type:"post",
		 	url:$yt_option.base_path + "class/trainee/getTraineeDetails",
		 	data:{
		 		traineeId:traineeId,
		 		projectId:projectCode
		 	},
		 	async:false,
		 	success:function(data){
		 		if(data.flag==0){
		 			studentDetailedMsg=data.data;
		 			//隐藏整体框架loading的方法
		 			$yt_baseElement.hideLoading();
		 		}
		 	}
		 });
		 return studentDetailedMsg;
	},
	/**
	 * 查询学员列表
	 */
	getStudentList: function() {
		var projectCode = $yt_common.GetQueryString("projectCode");
		var selectParam = $('.student-div .keyword').val();
		var gender = "";
		var phone = "";
		var groupId = "";
		var orgId = "";
		var deptPosition = "";
		var isFirstTraining = "";
		var classCommitteeId = "";
		var signUpState = "";
		var checkInState = "";
		var sort = "";
		var orderType = "";
		$('.student-div .tab-content thead').eq(0).find('label input').setCheckBoxState('uncleck');
		$('.student-div .page-info').eq(0).pageInfo({
			async:true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "class/trainee/getClassTrainee", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode:projectCode,
				selectParam: selectParam,
				gender: gender,
				phone: phone,
				groupId: groupId,
				orgId: orgId,
				deptPosition: deptPosition,
				isFirstTraining: isFirstTraining,
				classCommitteeId: classCommitteeId,
				signUpState: signUpState,
				checkInState: checkInState,
				sort: sort,
				orderType: orderType
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			before:function(){
				//显示loading
				$yt_baseElement.showLoading();
			},
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.student-div .student-list-tbody');
					var htmlTr = '';
					var num = 1;
					$(htmlTbody).empty();
					if(data.data.rows.length>0){
						$('.student-div .page-info').show();
							$.each(data.data.rows, function(i, v) {
							if(v.gender==1){
								v.gender="男";
							}else if(v.gender==2){
								v.gender="女";
							}
							
							
							htmlTr = '<tr>' +
							'<td><label class="check-label yt-checkbox">'+  
                    						'<input class="check-box" type="checkbox"/>'+
          								'</label></td>'+
								'<td style="text-align: center;"><input type="hidden" value="' + v.pkId + '" class="pkId">' + v.groupNum + '</td>' +
								'<td><input type="hidden" value="' + v.traineeId + '" class="trainee-id"><a href="#" class="real-name-inf" style=" color:blue;word-break: break-all;">' + v.realName + '</a></td>' +
								'<td style="text-align: center;">' + v.gender + '</td>' +
								'<td style="text-align: center;">' + v.phone + '</td>' +
								'<td>' + v.groupName + '</td>' +
								'<td>' + v.orgName + '</td>' +
								'<td>' + v.deptName + '</td>' +
								'<td>' + v.classCommitteeName + '</td>';
							if(v.isFirstTraining==0){
								v.isFirstTraining="否";
						htmlTr+='<td class="color-yellow" style="text-align: center;">' + v.isFirstTraining + '</td>'+
								'</tr>';
							}else{
								v.isFirstTraining="是";
						htmlTr+='<td style="text-align: center;">' + v.isFirstTraining + '</td>'+
								'</tr>';
							}	
							htmlTr=$(htmlTr).data('studentList',v);
							htmlTbody.append(htmlTr);
					});
					//隐藏loading
					$yt_baseElement.hideLoading();
					}else{
						$('.student-div .page-info').hide();
						htmlTr += '<tr style="border:0px;background-color:#fff !important;" >' +
							'<td colspan="11" align="center" style="border:0px;">' +
							'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
							'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
							'</div>' +
							'</td>' +
							'</tr>';
						htmlTbody.append(htmlTr);
					//隐藏loading
					$yt_baseElement.hideLoading();
					}
				
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	/**
	 * 查询酒店入住名单与学员列表不匹配列表
	 */
	getDifferentList:function(){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			type:"post",
			url: $yt_option.base_path + "class/trainee/getHotelTraineeToClassTrainee",
			data:{
				projectCod:projectCode
			},
			async:true,
			success:function(data){
				var htmlBody=$('.student-div .different-student-list tbody ');
				var htmlTr='';
				var num=1;
				if(data.flag==0){
					if(data.data.length>0){
						htmlBody.parent().parent().show();
						$.each(data.data, function(k,b) {
					htmlTr='<tr>'+
								'<td>'+ num++ +'</td>'+
								'<td>'+b.traineeName+'</td>'+
								'<td>'+b.gender+'</td>'+
								'<td>'+b.idNumber+'</td>'+
								'<td>'+b.roomNumber+'</td>'+
								'<td>'+b.createTimeString+'</td>'+
								'<td>'+b.reason+'</td>'+
							'</tr>';
							htmlBody.append(htmlTr);
					});
					}else{
						htmlBody.parent().parent().hide();
					}
					
				}else{
					$yt_alert_Model.prompt("查询失败");
				}
			}
		});
	}

}
/**
 * 重复来院名单
 */
var repeatCourtyardList={
	init:function(){
	//点击姓名进行排序
	var sortNum='';
	$('.repeat-come-div thead th').eq(1).click(function(){
		if(sortNum==''){
			var orderType="ASC";
			repeatCourtyardList.getRepeatComeList(orderType);
			sortNum=1;
		}else{
			var orderType="DESC";
			repeatCourtyardList.getRepeatComeList(orderType);
			sortNum='';
		}
	});
	//点击导出重复来院名单按钮
	$('.repeat-come-div .export-repeat-btn').on('click',function(){
		//班级编号
			var projectCode = $yt_common.GetQueryString("projectCode");
			var selectParam=$('.repeat-come-div .keyword').val();
			var gender="";
			var phone="";
			var orgId="";
			var deptPosition="";
			var startTimeStart="";
			var startTimeEnd="";
			var endTimeStart="";
			var endTimeEnd="";	
			$.ajaxDownloadFile({
			url:$yt_option.base_path+"class/trainee/exportRepeatClassTrainee",
			data:{
				projectCode:projectCode,
				gender:gender,
				phone:phone,
				orgId:orgId,
				deptPosition:deptPosition,
				startTimeStart:startTimeStart,
				startTimeEnd:startTimeEnd,
				endTimeStart:endTimeStart,
				endTimeEnd:endTimeEnd
			}
		});
	});
	//点击疑似重复来院名单导出按钮
	$('.repeat-come-div .export-doubt-repeat-btn').on('click',function(){
		//班级编号
			var projectCode = $yt_common.GetQueryString("projectCode");
			var selectParam=$('.repeat-come-div .doubt-keyword').val();
			var gender="";
			var phone="";
			var orgId="";
			var deptPosition="";
			var startTimeStart="";
			var startTimeEnd="";
			var endTimeStart="";
			var endTimeEnd="";	
			$.ajaxDownloadFile({
			url:$yt_option.base_path+"class/trainee/exportRepeatClassDoubtfulTrainee",
			data:{
				projectCode:projectCode,
				gender:gender,
				phone:phone,
				orgId:orgId,
				deptPosition:deptPosition,
				startTimeStart:startTimeStart,
				startTimeEnd:startTimeEnd,
				endTimeStart:endTimeStart,
				endTimeEnd:endTimeEnd
			}
		});
	});
	},
	/**
	 * 查询重复来院名单列表
	 */
	getRepeatComeList:function(orderType){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		//模糊查询
		var selectParam=$('.repeat-come-div .keyword').val();
		var gender="";
		var phone="";
		var orgId="";
		var deptPosition="";
		var startTimeStart="";
		var startTimeEnd="";
		var endTimeStart="";
		var endTimeEnd="";
		var sort="";
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type:"post",
			url: $yt_option.base_path + "class/trainee/getRepeatClassTrainee", //ajax访问路径
			data:{
				projectCode:projectCode,
				selectParam:selectParam,
				gender:gender,
				phone:phone,
				orgId:orgId,
				deptPosition:deptPosition,
				startTimeStart:startTimeStart,
				startTimeEnd:startTimeEnd,
				endTimeStart:endTimeStart,
				endTimeEnd:endTimeEnd,
				sort:sort,
				orderType:orderType
			},
			async:true,
			success:function(data){
				var htmlBody=$('.repeat-come-div .repeat-list-tbody');
				var htmlTr="";
				var num=1;
				htmlBody.empty();
				if(data.flag==0){
					var rowSpanNum=1;
					var mergeName='';
					var mergePhone='';
					var lastTr;
					if(data.data.rows.length!=0){
							$.each(data.data.rows, function(i,n) {
								htmlTr='<tr>';
								if(mergeName!=(n.realName+"-----"+n.phone)){
										$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan", rowSpanNum);
										$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(1).attr("rowSpan", rowSpanNum);
										$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(2).attr("rowSpan", rowSpanNum);
										$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(3).attr("rowSpan", rowSpanNum);
										lastTr = i;
										mergeName = n.realName+"-----"+n.phone;
											if(n.gender==1){
													n.gender="男";
												}else{
													n.gender="女";
												}
										htmlTr += '<td>'+ num++ +'</td>'+
										'<td style=" word-break: break-all;">'+ n.realName +'</td>'+
										'<td>'+ n.gender +'</td>'+
										'<td>'+ n.phone +'</td>';
										rowSpanNum = 1;
									} else {
										rowSpanNum++;
									}
								htmlTr+='<td>'+ n.projectCode +'</td>'+
								'<td>'+ n.projectName +'</td>'+
								'<td>'+ n.startTime +'</td>'+
								'<td>'+ n.endTime +'</td>'+
								'<td>'+ n.orgName +'</td>'+
								'<td>'+ n.deptPosition +'</td>'+
								'</tr>';
								htmlBody.append(htmlTr);
							});
							$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan", rowSpanNum);
							$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(1).attr("rowSpan", rowSpanNum);
							$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(2).attr("rowSpan", rowSpanNum);
							$('.repeat-come-div .repeat-list-tbody tr').eq(lastTr).find("td").eq(3).attr("rowSpan", rowSpanNum);
							//隐藏整体框架loading的方法
							$yt_baseElement.hideLoading();
					}else{
						htmlTr='<tr class="class-tr">'+
										'<td colspan="10" align="center" style="border:0px;">'+
											'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
												'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
											'</div>'+
										'</td>'+
									'</tr>';
							htmlBody.append(htmlTr);
							//隐藏整体框架loading的方法
							$yt_baseElement.hideLoading();
					}
				
				}else{
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						$yt_alert_Model.prompt('查询失败');
					});
				}
			}
		});
	},
	/**
	 * 查询疑似重复来院名单
	 */
		doubtRepatComeList:function(){
				//班级编号
				var projectCode = $yt_common.GetQueryString("projectCode");
				//模糊查询
				var selectParam=$('.repeat-come-div .doubt-keyword').val();
				var gender="";
				var phone="";
				var orgId="";
				var deptPosition="";
				var startTimeStart="";
				var startTimeEnd="";
				var endTimeStart="";
				var endTimeEnd="";
				var sort="";
				//显示整体框架loading的方法
				$yt_baseElement.showLoading();
				$.ajax({
					type:"post",
					url: $yt_option.base_path + "class/trainee/getRepeatClassDoubtfulTrainee", //ajax访问路径
					data:{
						projectCode:projectCode,
						selectParam:selectParam,
						gender:gender,
						phone:phone,
						orgId:orgId,
						deptPosition:deptPosition,
						startTimeStart:startTimeStart,
						startTimeEnd:startTimeEnd,
						endTimeStart:endTimeStart,
						endTimeEnd:endTimeEnd
					},
					async:true,
					success:function(data){
						var htmlBody=$('.repeat-come-div .doubt-repeat-list-tbody');
						var htmlTr="";
						var num=1;
						htmlBody.empty();
						if(data.flag==0){
							var rowSpanNum=1;
							var mergeName='';
							var mergePhone='';
							var lastTr;
							if (data.data.length!=0) {
									$.each(data.data, function(i,n) {
										if(n.gender==1){
											n.gender="男";
										}else{
											n.gender="女";
										}
										if(n.orgName==null){
											n.orgName="";
										}
										htmlTr='<tr>';
										if(mergeName!=(n.realName+"-----"+n.phone)){
												$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan", rowSpanNum);
												$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(1).attr("rowSpan", rowSpanNum);
												$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(2).attr("rowSpan", rowSpanNum);
												$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(3).attr("rowSpan", rowSpanNum);
												lastTr = i;
												mergeName = n.realName+"-----"+n.phone;
												mergePhone=n.phone;
												htmlTr += '<td>'+ num++ +'</td>'+
												'<td style=" word-break: break-all;">'+ n.realName +'</td>'+
												'<td>'+ n.gender +'</td>'+
												'<td>'+ n.phone +'</td>';
												rowSpanNum = 1;
											} else {
												rowSpanNum++;
											}
										htmlTr+='<td>'+ n.projectCode +'</td>'+
												'<td>'+ n.projectName +'</td>'+
												'<td>'+ n.startTime +'</td>'+
												'<td>'+ n.endTime +'</td>'+
												'<td>'+ n.orgName +'</td>'+
												'<td>'+ n.deptPosition +'</td>'+
												'</tr>';
										htmlBody.append(htmlTr);
								});
								$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(0).attr("rowSpan", rowSpanNum);
								$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(1).attr("rowSpan", rowSpanNum);
								$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(2).attr("rowSpan", rowSpanNum);
								$('.repeat-come-div .doubt-repeat-list-tbody tr').eq(lastTr).find("td").eq(3).attr("rowSpan", rowSpanNum);
							
								//隐藏整体框架loading的方法
								$yt_baseElement.hideLoading();
							} else{
								htmlTr='<tr class="class-tr">'+
										'<td colspan="10" align="center" style="border:0px;">'+
											'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
												'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
											'</div>'+
										'</td>'+
									'</tr>';
								//隐藏整体框架loading的方法
								$yt_baseElement.hideLoading();
								htmlBody.append(htmlTr);
							}
							
						}else{
							//隐藏整体框架loading的方法
							$yt_baseElement.hideLoading(function(){
								$yt_alert_Model.prompt('查询失败');
							});
						}
					}
				});
			
}
}
/**
 * 学员手册
 */
var studentManual={
	ue: null,
	init:function(){
		
		//初始化富文本编辑器
		studentManual.ue = UE.getEditor('container', {
			toolbars: [
				['undo', 'redo', '|',
					'bold', 'italic', 'underline', 'forecolor', '|',
					'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'simpleupload', 'attachment'
				]
			],
			autoHeightEnabled: true,
			elementPathEnabled: false,
			enableAutoSave: false,
			autoFloatEnabled:false,
			maximumWords:1000,
			saveInterval: 0
		});
	//点击学员手册里面的页签切换
	$('.student-manual-div .student-manual-btn').click(function(){
		console.log($(this).index());
		$(this).addClass('change-page-sign').siblings().removeClass('change-page-sign');
		$('.student-manual-div .manual-div').hide().eq($(this).index()).show();
		if($(this).index()==1){
			studentManual.getPreviewData();
		}
	});
	//点击上传二维码
	$(".student-manual-div").undelegate().delegate("input[type='file']", "change", function() {
		//格式jpg,png
	console.log($(this)[0].files[0]);
	//图片类型
	var type=$(this)[0].files[0].type;
	//图片大小
	var size=$(this)[0].files[0].size;
	console.log(type);
	if(size<=307200&&type=='image/jpeg'||size<=307200&&type=='image/png'){
		var url = $yt_option.acl_path + "api/tAscPortraitInfo/addFile";
	//显示整体框架loading的方法
	$yt_baseElement.showLoading();
		$.ajaxFileUpload({
			url: url,
			type: "post",
			data:{
				file:name,
				modelCode:'or-codesss',
				uploadType:1,
				type:'PC'
			},
			dataType: 'json',
			fileElementId: "uploadOrCode",
			success: function(data, textStatus) {
				var resultData = $.parseJSON(data);
				if(resultData.success == 0) {
					console.log(resultData.obj.pkId);
				$('.student-manual-div .upload-or-code-img').attr('src',$yt_option.acl_path +'api/tAscPortraitInfo/download?pkId='+resultData.obj.pkId+'&isDownload=false');
					$('.qr-code-id').val(resultData.obj.pkId);
					 $('.qr-code-name').val(resultData.obj.naming);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
					$yt_alert_Model.prompt("附件上传失败");
				});
				}
			},
			error: function(data, status, e) { //服务器响应失败处理函数  
				$yt_baseElement.hideLoading(function() {
					$yt_alert_Model.prompt("附件上传失败");
				});
			}
		});
	}else{
		$yt_alert_Model.prompt("请选择正确格式");
	}
	
			
	});
	//点击页面保存按钮
	$('.manual-main-div .save-btn').on('click',function(){
		console.log("imgFileId",imgFileId,"imgFileName",imgFileName);
		var imgFileId=$('.qr-code-id').val();
	   var imgFileName=$('.qr-code-name').val();
		studentManual.manualOperation(imgFileId,imgFileName);
	});
	//点击保存并预览按钮
	$(".manual-main-div .preview-save").on('click',function(){
		console.log("imgFileId",imgFileId,"imgFileName",imgFileName);
		var imgFileId=$('.qr-code-id').val();
	   	var imgFileName=$('.qr-code-name').val();
		studentManual.manualOperation(imgFileId,imgFileName);
		$('.student-manual-div .student-manual-btn').removeClass('change-page-sign');
		$('.student-manual-div .student-manual-btn').eq(1).addClass('change-page-sign');
		$('.student-manual-div .manual-div').hide().eq(1).show();
		studentManual.getPreviewData();
	});
	//点击页面取消按钮
	$('.manual-main-div .yt-model-canel-btn').on('click',function(){
		$yt_alert_Model.alertOne({  
	        haveCloseIcon: false, //是否带有关闭图标  
	        closeIconUrl: "./resources/images/icons/x.png", //关闭图标路径  
	        leftBtnName: "确定", //左侧按钮名称,默认确定  
	        rightBtnName: "取消", //右侧按钮名称,默认取消  
	        cancelFunction:"",//取消按钮操作方法*/
	        alertMsg: "确定取消当前页面的所有操作吗?", //提示信息  
	        confirmFunction: function() { //点击确定按钮执行方法  
	       studentManual.getPageDataList();
	        },  
   		});
	});
	//学员手册获取页面数据
	//studentManual.getPageDataList();
	//点击委托单位新增按钮
     $('.entrust-company .add-student-manual').on('click',function(){
     	var htmlTr='<tr>'+
     	'<td><input class="yt-input entrust-name" style="width: 101px;" type="text"/></td>'+
		'<td><input class="yt-input entrust-dept" type="text"/></td>'+
		'<td><input class="yt-input entrust-room-num" type="text"/></td>'+
		'<td><input class="yt-input entrust-phone" type="text"/></td>'+
		'<td style="text-align: center;">'+
		'<img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td>'+
     	'</tr>';
     	$(this).prev().find('tbody').append(htmlTr);
     		$('.college-project-post').niceSelect();
     });
     //点击项目组新增按钮
       $('.college-project .add-student-manual').on('click',function(){
     	var htmlTr='<tr>'+
     	'<td><input class="yt-input college-project-name" style="width: 101px;" type="text"/></td>'+
		'<td><input class="yt-input college-project-dept" type="text"/></td>'+
		'<td><select class="yt-select college-project-post">'+
            '<option value="1">带班院领导</option>'+  
            '<option value="2">项目组组长</option>'+  
            '<option value="3">夜间值班室</option></select></td>'+
		'<td><input class="yt-input college-project-phone" type="text"/></td>'+
		'<td style="text-align: center;">'+
		'<img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td>'+
     	'</tr>';
     	$(this).prev().find('tbody').append(htmlTr);
     	$('.college-project-post').niceSelect();
     });
	//点击删除图标(包括学员手册和接待通知的删除)；	
	$('.box-list').on('click','.entrust-delete',function(){
		$(this).addClass('cho-btn');
		
		$yt_alert_Model.alertOne({  
	        haveCloseIcon: false, //是否带有关闭图标  
	        closeIconUrl: "./resources/images/icons/x.png", //关闭图标路径  
	        leftBtnName: "确定", //左侧按钮名称,默认确定  
	        rightBtnName: "取消", //右侧按钮名称,默认取消  
	        cancelFunction:function(){ //取消按钮操作方法*/
	        	 $(' .entrust-delete').removeClass('cho-btn');
	        },
	        alertMsg: "数据删除将无法恢复,确认删除吗?", //提示信息  
	        confirmFunction: function() { //点击确定按钮执行方法  
	         $('.entrust-delete.cho-btn').parents("tr").remove();
	        },  
   		}); 
	});
	},
	/**
	 * 学员手册预览获取数据
	 **/
	getPreviewData:function(){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/studentHandbook/getStudentHandbookPreview",
			data:{
				projectCode:projectCode
			},
			async:true,
			success:function(data){
				if(data.flag==0){
				     $.each(data.data, function(i,g) {
				     	
				     	if (g.modelCode=='CLASSNAME') {//预览班级姓名
				     		$(".manual-class-name").text(g.modelValue);
				     		var manualDate=new Date();
				     		var year=manualDate.getFullYear();
				     		 var month=manualDate.getMonth()+1;
				     		$(".manual-class-date").text(year+"年"+month+"月");
				     	} else if (g.modelCode=='TRAINDETAILS'){//预览学院简介
				     		$(".manual-college-brief").prev().text(g.modelName);
				     		$(".manual-college-brief").text(g.modelValue);
				     		
				     	}else if (g.modelCode=='TEACHINGDETAILS'){//预览教学方案简介
				     		$(".manual-teaching-brief").prev().text(g.modelName);
			     			$(".manual-teaching-brief").empty();
				     		$(".manual-teaching-brief").html(g.modelValue);
				     		
				     	}else if (g.modelCode=='COURSE'){//预览课程安排
				     		$(".manual-teaching-schedule").prev().text(g.modelName);
				     		var previewBody=$(".preview-course tbody");
//				     		var courDate;
//				     		var courseNum=1;
//				     		var lasTr;
				     		previewBody.empty();
				     		$.each(g.modelValue, function(i,c) {
				     			var previewCourse='';
				     			$.each(c.courseDetails, function(r,s) {
			     				  previewCourse+='<tr>';
//			     				 if(courDate!=c.courseDate){
//			     				  	$(".preview-course tbody tr").eq(lasTr).find('td').eq(0).attr('rowspan',courseNum);
			     				  	if (c.courseDetails.length!=1&&r==0) {
			     				  		previewCourse+=	'<td rowspan="'+c.courseDetails.length+'" style="text-align:center">'+c.courseDate+'</td>';
			     				  	} else if (c.courseDetails.length==1){
			     				  		previewCourse+=	'<td style="text-align:center">'+c.courseDate+'</td>';
			     				  	}
			     				  	
//			     				  	courDate=c.courseDate;
//			     				  	lasTr=i;
//			     				  	courseNum=1;
//			     				  }else{
//			     				  	courseNum++;
//			     				  }
			     				  previewCourse+='<td style="text-align: center;">'+s.courseTime+'</td>'+
							     				'<td>'+
							     				'<span style="font-weight: bolder;">'+s.courseTypeName+'</span><span>'+s.courseName+'</span><br/>'+
							     				'<span style="font-weight: bolder;">'+s.speaker+'</span><span>'+s.teacherName+'</span>'+
							     				'</td>'+
							     				'<td>'+s.address+'</td>'+
							     				'</tr>';
				     				
				     			});
				     			//$(".preview-course tbody tr").eq(lasTr).find('td').eq(0).attr('rowspan',courseNum);
				     			//previewBody.find('tr').eq(lasTr).find('td').eq(0).attr('rowspan',courseNum);
			     			 	previewBody.append(previewCourse);
			     			 
				     		});
			     			
				     	}else if (g.modelCode=='TRAINEE'){//预览学员名单
				     		$(".preview-student-list").prev().text(g.modelName);
				     		var studentList=$(".preview-student-list");
				     		studentList.empty();
				     		$.each(g.modelValue, function(i,d) {
				     			var preGroup='';
				     			preGroup+='<p style="width:80px;margin:0 auto;">'+d.groupName+'</p>'+
							     			'<p>'+d.groupLeader+'</p>'+
							     			'<table class="yt-table list-table" style="margin-bottom:20px">'+
												'<thead class="list-thead">'+
													'<tr>'+
														'<th width="225px">姓名</th>'+
														'<th>单位职务</th>'+
														'<th width="225px">房间号</th>'+
													'</tr>'+
												'</thead>'+
												'<tbody>';
				     			$.each(d.traineeDetails, function(p,c) {
				     				preGroup+='<tr>'+
							     				'<td style="text-align:center;">'+c.realName+'</td>'+
							     				'<td>'+c.positionName+'</td>'+
							     				'<td>'+c.roomNumber+'</td>'+
							     				'</tr>';
				     			});
				     			preGroup+='</tbody></table>';
				     			studentList.append(preGroup);
				     		});
				     		
				     	}else if (g.modelCode=='COMMITTEE'){//预览班委会成员
				     		$(".manual-committee").prev().text(g.modelName);
				     		var comiteBody=$(".manual-committee");
				     		comiteBody.empty();
				     		$.each(g.modelValue, function(i,r) {
				     			var manualComite='';
				     			manualComite+='<p style="font-weight: bolder;">'+r.classCommittee+'</p>';
				     			$.each(r.traineeDetails, function(t,j) {
     								manualComite+='<p style="margin-left:20px">'+
				     								'<span>'+j.realName+" "+'</span>'+
				     								'<span>'+j.positionName+'</span>'+
				     								'</p>';
     								comiteBody.append(manualComite);
				     			});
				     		});
				     		
				     	}else if (g.modelCode=='GUIDE'){//预览学院指南
				     		$(".manual-college-guide").prev().text(g.modelName);
				     		$(".manual-college-guide").html(g.modelValue);
				     	}
				     }); 
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
				}else{
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						$yt_alert_Model.prompt("获取预览数据失败");
					});
				}
			}
		});
	},
	/**
	 * 学员手册获取页面数据
	 **/
	getPageDataList:function(){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/studentHandbook/getStudentHandbook",
			data:{
			projectCode:projectCode
			},
			async:true,
			success:function(data){
				//添加委托单位人员
				var htmlPrev=$('.entrust-company tbody');
				var htmlTr='';
				//添加项目组人员
				var htmlProTeam=$('.college-project tbody');
				var htmlTb='';
				htmlPrev.empty();
				htmlProTeam.empty();
				if(data.flag==0){
					if(data.data!=null){
						var studentManual=data.data;
						console.log("获取手册数据成功",studentManual.pkId);
						$('.template-pkid').val(studentManual.pkId);
						$('.weixin-group-name').val(studentManual.weixnGroupName);
						$('.weixin-details').val(studentManual.weixnGroupDetails);
						//获取图片
						$('.qr-code-id').val(studentManual.weixinQrCodeId);
						 $('.qr-code-name').val(studentManual.weixinQrCodeName);
						$('.student-manual-div .upload-or-code-img').attr('src',$yt_option.acl_path +'api/tAscPortraitInfo/download?pkId='+studentManual.weixinQrCodeId+'&isDownload=false');
						//循环添加委托单位人员
						var studentHandbookEntrust=$.parseJSON(studentManual.studentHandbookEntrust);
						var datastudentHandbookGroup=$.parseJSON(studentManual.studentHandbookGroup);
						
						//设置编辑器内容
						var ueName=$.parseJSON(studentManual.templateData).details;
						console.log("studentManual.templateData",ueName);
						var ue = UE.getEditor('container');
						ue.ready(function(){
							ue.setContent(ueName);
						});
						//循环添加委托单位工作人员
						$.each(studentHandbookEntrust, function(i,v) {
							htmlTr='<tr>'+
							     	'<td><input class="yt-input entrust-name" style="width: 101px;" value="'+v.userName+'" type="text"/></td>'+
									'<td><input class="yt-input entrust-dept" value="'+v.deptName+'" type="text"/></td>'+
									'<td><input class="yt-input entrust-room-num" value="'+v.roomNumber+'" type="text"/></td>'+
									'<td><input class="yt-input entrust-phone" value="'+v.phone+'" type="text"/></td>'+
									'<td style="text-align: center;">'+
									'<img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td>'+
							     	'</tr>';
							    htmlPrev.append(htmlTr); 	
						});
						//循环添加学员项目组人员
						
						$.each(datastudentHandbookGroup, function(i,k) {
							if(k!=null){
							htmlTb='<tr>'+
							     	'<td><input class="yt-input college-project-name" style="width: 101px;" value="'+k.userName+'" type="text"/></td>'+
									'<td><input class="yt-input college-project-dept" value="'+k.deptName+'"  type="text"/></td>'+
									'<td><select class="yt-select college-project-post">'+
							            '<option value="1">带班院领导</option>'+  
							            '<option value="2">项目组组长</option>'+  
							            '<option value="3">夜间值班室</option></select></td>'+
									'<td><input class="yt-input college-project-phone" value="'+k.phone+'"  type="text"/></td>'+
									'<td style="text-align: center;">'+
									'<img class="entrust-delete" src="../../resources/images/icons/t-del.png"/></td>'+
							     	'</tr>';
							htmlProTeam.append(htmlTb);
							$('.college-project-post').setSelectVal(k.positionId);
							$('.college-project-post').niceSelect();	
							}
							
						});
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading();
					}else{
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading();
					}
					
				}else{
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						$yt_alert_Model.prompt("查询学员手册失败");
					});
				}
				
			}
		});
	},
    /**
     * 新增修改手册
     */
    manualOperation:function(weixinQrCode,weixinQrName){
    	
    	//班级编号
    	var projectCode = $yt_common.GetQueryString("projectCode");
    	var templateId=studentManual.getTemplateList();;
    	var pkId=$('.template-pkid').val();
    	var details=studentManual.ue.getContent();
    	//模板数据
    	var templateData={
    		templateId:templateId,
    		details:details
    	};
    	templateData=JSON.stringify(templateData);
    	//微信名称
    	var weixnGroupName=$('.weixin-group-name').val();
    	//微信说明
    	var weixnGroupDetails=$('.weixin-details').val();
    	//二维码数据
    	var weixinQrCode={
    		weixinQrCode:weixinQrCode,
    		weixinQrName:weixinQrName
    	};
    	weixinQrCode=JSON.stringify(weixinQrCode);
    	//委托单位工作人员数据
    	var studentHandbookEntrust=[];
    	$('.entrust-company tbody tr').each(function(i,q){
    		var userName=$(q).find('.entrust-name').val();
    		var deptName=$(q).find('.entrust-dept').val();
    		var roomNumber=$(q).find('.entrust-room-num').val();
    		var phone=$(q).find('.entrust-phone').val();
    		var entrustList={
    			userName:userName,
    			deptName:deptName,
    			roomNumber:roomNumber,
    			phone:phone
    		};
    		studentHandbookEntrust.push(entrustList);
    	});
    	studentHandbookEntrust=JSON.stringify(studentHandbookEntrust);
    	//学院项目组成员数据
    	var studentHandbookGroup=[];
    	$('.college-project tbody tr').each(function(i,p){
    		var userName=$(p).find('.college-project-name').val();
    		var deptName=$(p).find('.college-project-dept').val();
    		var positionId=$(p).find('.college-project-post').val();
    		var phone=$(p).find('.college-project-phone').val();
    		var collegeList={
    			userName:userName,
    			deptName:deptName,
    			positionId:positionId,
    			phone:phone
    		};
    		studentHandbookGroup.push(collegeList);
    	});
    	studentHandbookGroup=JSON.stringify(studentHandbookGroup);
    	//显示整体框架loading的方法
    	$yt_baseElement.showLoading();
    	$.ajax({
    		type:"post",
    		url:$yt_option.base_path + "class/studentHandbook/addOrUpdateStudentHandbook",
    		data:{
    			 projectCode:projectCode,
    			 pkId:pkId,
				 templateData:templateData,
		    	 weixnGroupName:weixnGroupName,
		    	 weixnGroupDetails:weixnGroupDetails,
		    	 weixinQrCode:weixinQrCode,
		    	 studentHandbookEntrust:studentHandbookEntrust,
		    	 studentHandbookGroup:studentHandbookGroup
    		},
    		async:true,
    		success:function(data){
    			if(data.flag==0){
    				//隐藏整体框架loading的方法
    				$yt_baseElement.hideLoading(function(){
    					$yt_alert_Model.prompt("提交成功");
    				});
    				studentManual.getPageDataList();
    			}else{
    				//隐藏整体框架loading的方法
    				$yt_baseElement.hideLoading(function(){
    					$yt_alert_Model.prompt("提交失败");
    				});
    				
    			}
    		}
    	});
    },
    /**
     * 查询模板列表
     */
    getTemplateList:function(){
    	var templateId='';
    	$.ajax({
    		type:"post",
    		url:$yt_option.base_path + "class/traineeTemplate/lookForAll",
    		data:{
    			templateId:1,
    			types:3
    		},
    		async:false,
    		success:function(data){
    			if(data.flag==0){
    				console.log("模板查询成功");
    				$.each(data.data, function(i,q) {
    					console.log("模板id",q.pkId);
    					if(q.modelCode=='TEACHINGDETAILS'){
    						templateId=q.pkId;
    					}
    				});
    			}
    		}
    	});
    	return templateId;
    }
}
/**
 * 接待通知
 */
var receptionNotice={
	ue: null,
	init:function(){
		//初始化富文本编辑器
		receptionNotice.ue = UE.getEditor('reception', {
			toolbars: [
				['undo', 'redo', '|',
					'bold', 'italic', 'underline', 'forecolor', '|',
					'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'simpleupload', 'attachment'
				]
			],
			autoHeightEnabled: true,
			elementPathEnabled: false,
			enableAutoSave: false,
			saveInterval: 0
		});
		//初始化人员下拉框
	var personnelName=receptionNotice.getPersonnelList();
	if(personnelName.length!=0){
		$.each(personnelName, function(i,o) {
			$(".reception-notice-div .project-head-select").append('<option value='+o.textName+'>'+o.name+'</option>');
		});
		$(".reception-notice-div .project-head-select").niceSelect();
	}
	console.log(personnelName);
	//新增房间使用情况
	$('.add-room-list').click(function(){
		var appedHtml='<tr>'+
						'<td><input type="text" class="yt-input" style="width: 135px;" placeholder="请输入" /></td>'+
						'<td><input type="number" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" /></td>'+
						'<td><input type="number" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" /></td>'+
						'<td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" /></td>'+
						'<td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td>'+
					  '</tr>';
		$(this).prev().find('tbody').append(appedHtml);
	});
	//新增教学场地
	$(".add-address-list").click(function(){
		var appedHtml='<tr>'+
						'<td><input type="text" class="yt-input" style="width: 95%;" placeholder="请输入" /></td>'+
						'<td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" /></td>'+
						'<td><input type="number" class="yt-input" style="width: 94%;text-align:right;" placeholder="请输入" /></td>'+
						'<td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td>'+
					'</tr>';
		$(this).prev().find('tbody').append(appedHtml);
	});
	//新增用餐情况
	$(".add-haveMeals-list").click(function(){
			var appedHtml='<tr>'+
							'<td><input type="text" class="yt-input" style="width: 240px;" placeholder="请输入" /></td>'+
							'<td><input type="text" class="yt-input" style="width: 189px;" placeholder="请输入" /></td>'+
							'<td><input type="text" class="yt-input" style="width: 153px;" placeholder="请输入" /></td>'+
							'<td><input type="number" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" /></td>'+
							'<td><input type="text" class="yt-input" style="width: 85px;" placeholder="请输入" /></td>'+
							'<td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" /></td>'+
							'<td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td>'+
						  '</tr>';
		$(this).prev().find('tbody').append(appedHtml);
	});
	//收费情况
	$(".add-charge-list").click(function(){
			var appedHtml='<tr>'+
							'<td><input type="text" class="yt-input" style="width: 93%;" placeholder="请输入" /></td>'+
							'<td><input type="number" class="yt-input" style="width: 93%;text-align: right;" placeholder="请输入" /></td>'+
							'<td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" /></td>'+
							'<td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td>'+
						'</tr>';
		$(this).prev().find('tbody').append(appedHtml);
	});
	//点击保存按钮
	$('.reception-notice-div .save-reception').off('click').click(function(){
		receptionNotice.saveReception(1);
	});
	//点击生成按钮
	$('.reception-notice-div .generate').off('click').click(function(){
		receptionNotice.saveReception(2);
	});
	//点击取消按钮
	$('.reception-notice-div .yt-model-canel-btn').off().click(function(){
		$yt_alert_Model.alertOne({  
		        haveCloseIcon: false, //是否带有关闭图标  
		        closeIconUrl: "./resources/images/icons/x.png", //关闭图标路径  
		        leftBtnName: "确定", //左侧按钮名称,默认确定  
		        rightBtnName: "取消", //右侧按钮名称,默认取消  
		        cancelFunction: "", //取消按钮操作方法*/  
		        alertMsg: "确定取消当前页面的所有操作吗?", //提示信息  
		        confirmFunction: function() { //点击确定按钮执行方法  
		          receptionNotice.getReceptionList();
		        },  
   		 });  
	});
	},
	/**
	 * 获取集团单位
	 */
	getGroupOrg:function(){
		var groupOrg;
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "uniform/group/getGroups",
			data:{
				isSelectGroup:2
			},
			async:false,
			success:function(data){
				if(data.flag==0){
					groupOrg=data.data;
				}
			}
		});
		return groupOrg;
	},
	/**
	 * 人员列表数据
	 */
	getPersonnelList:function(){
		var personnelName=[];
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "uniform/user/getUsers",
			data:{
				compId:""
			},
			async:false,
			success:function(data){
				if(data.flag==0){
					$.each(data.data, function(i,m) {
						if(m.type==3){
							console.log("人员查询成功");
						var personnel={
								name:m.text,
								textName:m.textName
							};
							personnelName.push(personnel);
						}
					});
					//隐藏整体框架loading的方法	
					$yt_baseElement.hideLoading();
				}else{
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
				}
			}
		});
		return personnelName;
	},
	/**
	 * 委托单位树形列表
	 */
	groupOrgTree:function(){
		var getGroupOrg=receptionNotice.getGroupOrg();
			console.log("getGroupOrg",getGroupOrg);
			if($("#treeDiv").length == 0){
				$('#textTree').createTree({  
			        controlId: 'treeDiv',// 必选 弹出的树列表控件ID，默认: $(this).attr("id") + "Tree"  
			        dataList: getGroupOrg, // 必选 对象数组 树列表数据  
			         listConfig: { // 必选 树列表节点参数名称 设置为传入的数据对象参数名称  
			            id: 'groupId', //参数ID名称  
			            pid: 'parentId', //上一级ID名称  
			            name: 'groupName' //参数名称  
			        },  
			        rootConfig: { //必选 设置根目录的 默认信息  
			            id: 0, //根目录ID  
			            pid: -1, // 根目录上一级ID 固定值为-1  
			            name: "大连高级经理学院" //根目录名称  
			        },  
			        speed: 200,// 可选 下拉树列表显示速度 参数"slow","normal","fast"，或毫秒数值，默认：200      
			        readonly: true, //可选 目标对象是否设为只读，默认：true  
			        checked: false,//可选 是否显示多选框 默认：false  
			        hide:true,//设置单击节点立即隐藏 默认：false
			         callback: {  
			            onClick:function(obj, id, name){
		            	$('#groupId').val(id);
						$('#textTree').val(name);
						}, //可选 点击树列表节点触发的事件  
			        } 
			    });
			}
	},
	/**
	 * 获取列表数据
	 */
	getReceptionList:function(){
			
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/noticeReception/getNoticeReceptionByProjectCode",
			data:{
				projectCode:projectCode
			},
			async:true,
			success:function(data){
				if(data.flag==0){
					console.log("接待通知查询列表成功");
					//console.log("项目类型",data.data.projectType);
					if(data.data!=null){
						if(data.data.projectType==1){
							data.data.projectType="调训";
							receptionNotice.groupOrgTree();
						}else if(data.data.projectType==2){
							data.data.projectType="委托";
							$(".entrust-name-td").empty();
							$(".entrust-name-td").text(data.data.groupName);
						}else if(data.data.projectType==3){
							data.data.projectType="选学";
							$(".entrust-name-td").prev().remove();
							$(".entrust-name-td").remove();
						}else{
							receptionNotice.groupOrgTree(); 
							data.data.projectType="调训";
						}
						//列表添加数据
						$('.reception-notice-div').setDatas(data.data);
						//当前的项目主任
						$('.head-select').setSelectVal(data.data.projectHeadCode);
						//当前的班主任
						$(".head-master-select").setSelectVal(data.data.classTeacherCode);
						//房间使用情况
						var roomList=data.data.roomList;
						if (roomList!="") {
							$('.room-list-table tbody').empty();
							$.each(roomList, function(i,a) {
								var roomHtml='<tr>'+
												'<td><input type="text" class="yt-input" style="width: 135px;" placeholder="请输入" value="'+a.roomType+'" /></td>'+
												'<td><input type="number" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" value="'+a.roomCount+'" /></td>'+
												'<td><input type="number" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" value="'+a.roomPrice+'" /></td>'+
												'<td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" value="'+a.remarks+'" /></td>'+
												'<td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td>'+
											  '</tr>';
								$('.room-list-table tbody').append(roomHtml);
							});
						}
						//教学场地使用情况
						var addressList=data.data.addressList;
						if(addressList!=""){
							$('.address-list-table tbody').empty();
							$.each(addressList, function(i,b) {
								var addreHtml='<tr>'+
												'<td><input type="text" class="yt-input" style="width: 95%;" placeholder="请输入" value="'+b.adressDate+'" /></td>'+
												'<td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" value="'+b.address+'" /></td>'+
												'<td><input type="number" class="yt-input" style="width: 94%;text-align:right;" placeholder="请输入" value="'+b.peopleCount+'" /></td>'+
												'<td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td>'+
											   '</tr>';
								$('.address-list-table tbody').append(addreHtml);
							});
						}
						//用餐情况
						var haveMealsList=data.data.haveMealsList;
						if(haveMealsList!=""){
							$('.haveMeals-list-table tbody').empty();
							$.each(haveMealsList, function(i,c) {
								var mealsHtml='<tr>'+
												'<td><input type="text" class="yt-input" style="width: 240px;" placeholder="请输入" value="'+c.adressDate+'"/></td>'+
												'<td><input type="text" class="yt-input" style="width: 189px;" placeholder="请输入" value="'+c.address+'" /></td>'+
												'<td><input type="text" class="yt-input" style="width: 153px;" placeholder="请输入" value="'+c.types+'" /></td>'+
												'<td><input type="number" class="yt-input" style="width: 85px;text-align:right;" placeholder="请输入" value="'+c.peopleCount+'" /></td>'+
												'<td><input type="text" class="yt-input" style="width: 85px;" placeholder="请输入" value="'+c.standard+'" /></td>'+
												'<td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入" value="'+c.remarks+'" /></td>'+
												'<td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td>'+
											  '</tr>';
								$('.haveMeals-list-table tbody').append(mealsHtml);
							});
						}
						//收费情况
						var receptionChargeList=data.data.receptionChargeList;
						if(receptionChargeList!=""){
							$('.reception-charge-list-table tbody').empty();
							$.each(receptionChargeList, function(i,d) {
								var recptionHtml='<tr>'+
												'<td><input type="text" class="yt-input" style="width: 93%;" placeholder="请输入" value="'+d.chargeType+'" /></td>'+
												'<td><input type="number" class="yt-input" style="width: 93%;text-align: right;" placeholder="请输入" value="'+d.chargeTrainee+'" /></td>'+
												'<td><input type="text" class="yt-input" style="width: 98%;" placeholder="请输入"  value="'+d.remarks+'"/></td>'+
	  											'<td><img class="entrust-delete" src="../../resources/images/icons/t-del.png" style="cursor: pointer;" /></td>'+
											   '</tr>';
								$('.reception-charge-list-table tbody').append(recptionHtml);
							});
						}
						/**
						 * 初始化编辑器数据
						 */
						var ue = UE.getEditor('reception');
							ue.ready(function(){
								ue.setContent(data.data	.specialCaseDescription);
							});
							
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading();
					}else{
						//班级类型
						var projectType = $yt_common.GetQueryString("projectType");
						if(projectType==1){
							projectType="计划";
						}else if(projectType==2){
							projectType="委托";
						}else if(projectType==3){
							projectType="选学";
						}else{
							projectType="调训";
						}
						//var projectName= $yt_common.GetQueryString("projectName");
						var projectList={
							projectType:projectType
							//projectName:projectName
						};
						console.log(projectList);
						if(projectType==1){//类型为计划
							//调用树形结构列表
							receptionNotice.groupOrgTree();
						}else if(projectType==2){//类型为委托
							$(".entrust-name-td").empty();
							$(".entrust-name-td").text(data.data.groupName);
						}else if(projectType==3){//类型为选学
							$(".entrust-name-td").prev().remove();
							$(".entrust-name-td").remove();
						}else{//类型为调训
							//调用树形结构列表
							receptionNotice.groupOrgTree(); 
						}
						//列表添加数据
						$('.reception-notice-div').setDatas(projectList);
						//receptionNotice.groupOrgTree(); 
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading();
					}
				}else{
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						$yt_alert_Model.prompt("查询失败");
					});
				}
			}
		});
		},
		/**
		 * 接待通知保存/生成
		 */
		saveReception:function(dataStates){
			
			//班级编号
			var projectCode = $yt_common.GetQueryString("projectCode");
			var recptionList=$('.reception-notice-div').getDatas();
			var groupId=$("#groupId").val();
			console.log("recptionList",recptionList);
			var projectHeadCode=$('.head-select').val();
			var classTeacherCode=$(".head-master-select").val();
			var specialCaseDescription=receptionNotice.ue.getContent();
			//console.log(specialCaseDescription);
			var roomList=[];
			var addressList=[];
			var haveMealsList=[];
			var receptionChargeList=[];
			//获取房间使用情况
			$(".room-list-table tbody tr").each(function(i,s){
				var roomUse={
					roomType:$(s).find('td').eq(0).find('input').val(),
					roomCount:$(s).find('td').eq(1).find('input').val(),
					roomPrice:$(s).find('td').eq(2).find('input').val(),
					remarks:$(s).find('td').eq(3).find('input').val()
				};
				roomList.push(roomUse);
			});
			roomList=JSON.stringify(roomList);
			console.log("roomList",roomList);
			//获取教学场地使用情况
			$(".address-list-table tbody tr").each(function(i,p){
				var addressUse={
					adressDate:$(p).find('td').eq(0).find('input').val(),
					address:$(p).find('td').eq(1).find('input').val(),
					peopleCount:$(p).find('td').eq(2).find('input').val()
				};
				addressList.push(addressUse);
			});
			addressList=JSON.stringify(addressList);
			//获取用餐情况
			$(".haveMeals-list-table tbody tr").each(function(i,g){
				var haveMealsUse={
					adressDate:$(g).find('td').eq(0).find('input').val(),
					address:$(g).find('td').eq(1).find('input').val(),
					types:$(g).find('td').eq(2).find('input').val(),
					peopleCount:$(g).find('td').eq(3).find('input').val(),
					standard:$(g).find('td').eq(4).find('input').val(),
					remarks:$(g).find('td').eq(5).find('input').val()
				};
				haveMealsList.push(haveMealsUse);
			});
			haveMealsList=JSON.stringify(haveMealsList);
			//获取收费情况
			$(".reception-charge-list-table tbody tr").each(function(i,u){
				var receptionUse={
					chargeType:$(u).find('td').eq(0).find('input').val(),
					chargeTrainee:$(u).find('td').eq(1).find('input').val(),
					remarks:$(u).find('td').eq(2).find('input').val()
				};
				receptionChargeList.push(receptionUse);
			});
			receptionChargeList=JSON.stringify(receptionChargeList);
			//显示整体框架loading的方法
			$yt_baseElement.showLoading();
			$.ajax({
				type:"post",
				url:$yt_option.base_path + "class/noticeReception/addNoticeReception",
				data:{
					projectCode:projectCode,
					dataStates:dataStates,
					groupId:groupId,
					reportDate:recptionList.reportDate,
					outHospitalDate:recptionList.outHospitalDate,
					traineePickDate:recptionList.traineePickDate,
					traineeCheckOutDate:recptionList.traineeCheckOutDate,
					traineeCount:recptionList.traineeCount,
					personnelCount:recptionList.personnelCount,
					leaderCount:recptionList.leaderCount,
					projectHeadCode:projectHeadCode,
					classTeacherCode:classTeacherCode,
					projectHeadPhone:recptionList.projectHeadPhone,
					classTeacherPhone:recptionList.classTeacherPhone,
					remarks:recptionList.remarks,
					roomRemarks:recptionList.roomRemarks,
					addressRemarks:recptionList.addressRemarks,
					haveMealsRemarks:recptionList.haveMealsRemarks,
					specialCaseDescription:specialCaseDescription,
					roomList:roomList,
					addressList:addressList,
					haveMealsList:haveMealsList,
					receptionChargeList:receptionChargeList
				},
				async:true,
				success:function(data){
					if(data.flag==0){
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function(){
							$yt_alert_Model.prompt("提交成功");
						});
						receptionNotice.getReceptionList();
					}else{
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function(){
							$yt_alert_Model.prompt("提交失败");
						});
					}
				}
			});
		}
}
/**
 * 班级公告
 */
var classBulletin = {
	ue: null,
	init: function() {
		//初始化富文本编辑器
		classBulletin.ue = UE.getEditor('manual', {
			toolbars: [
				['undo', 'redo', '|',
					'bold', 'italic', 'underline', 'forecolor', '|',
					'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'simpleupload', 'attachment'
				]
			],
			autoHeightEnabled: true,
			elementPathEnabled: false,
			enableAutoSave: false,
			saveInterval: 0
		});
		
		//点击删除图标
		$('.class-bulletin-div .list-tbody').on('click', '.bulletin-delete', function() {
			var pkId = $(this).parent().parent().find('.bulletin-id').val();
			$yt_alert_Model.alertOne({
				haveCloseIcon: false, //是否带有关闭图标  
				closeIconUrl: "./resources/images/icons/x.png", //关闭图标路径  
				leftBtnName: "确定", //左侧按钮名称,默认确定  
				rightBtnName: "取消", //右侧按钮名称,默认取消  
				cancelFunction: "", //取消按钮操作方法*/  
				alertMsg: "数据删除将无法恢复,确认删除吗?", //提示信息  
				confirmFunction: function() { //点击确定按钮执行方法  
					//显示整体框架loading的方法
					$yt_baseElement.showLoading();
					$.ajax({
						type: "post",
						url: $yt_option.base_path + "class/notice/deleteClassNotice", //ajax访问路径 
						data: {
							pkId: pkId
						},
						async: true,
						success: function(data) {
							if(data.flag == 0) {
								//隐藏整体框架loading的方法
								$yt_baseElement.hideLoading(function() {
									$yt_alert_Model.prompt("删除成功");
									//查询公告列表
									classBulletin.getClassBulletin();
								});
								
							} else {
								//隐藏整体框架loading的方法
								$yt_baseElement.hideLoading(function() {
									$yt_alert_Model.prompt("删除失败");
									//查询公告列表
									classBulletin.getClassBulletin();
								});
								
							}
						}
					});
				},
			});
		});
		var pkId;
		var projectCode = $yt_common.GetQueryString("projectCode");
		//点击修改图标
		$('.class-bulletin-div .list-tbody').on('click', '.bulletin-update', function() {

			$('.class-bulletin-form .yt-edit-alert-title-msg').text("修改公告");
			pkId = $(this).parent().parent().find('.bulletin-id').val();
			//获取当前行的公告内容
			var noticeDescribe = $(this).parent().parent().data('bulletin').noticeDescribe;
			classBulletin.ue.ready(function() {
				classBulletin.ue.setContent(noticeDescribe);
			});
			//获取当前行的内容标题
			var noticeTitle = $(this).parent().parent().data('bulletin').noticeTitle;
			//添加到弹出框上
			$('.class-bulletin-input').val(noticeTitle);
			console.log(noticeDescribe);
			/** 
			 * 显示编辑弹出框和显示顶部隐藏蒙层 
			 */
			$(".class-bulletin-form").show();
			/** 
			 * 调用算取div显示位置方法 
			 */
			$yt_alert_Model.getDivPosition($(".class-bulletin-form"));
			/* 
			 * 调用支持拖拽的方法 
			 */
			$yt_model_drag.modelDragEvent($(".class-bulletin-form .yt-edit-alert-title"));
			/**
			 * 点击取消方法
			 */
			 $('.class-bulletin-form .yt-eidt-model-bottom .canel-in-btn').off().on("click", function() {  
		            //隐藏页面中自定义的表单内容  
		            $(".class-bulletin-form").hide();  
		            //隐藏蒙层  
		            $("#pop-modle-alert").hide();  
	           });
		});
		//点击班级公告新增
		$('.class-bulletin-add-btn').click(function() {

			pkId = "";
			$(".class-bulletin-input").val("");
			classBulletin.ue.execCommand('cleardoc');
			/** 
			 * 显示编辑弹出框和显示顶部隐藏蒙层 
			 */
			$(".class-bulletin-form").show();
			/** 
			 * 调用算取div显示位置方法 
			 */
			$yt_alert_Model.getDivPosition($(".class-bulletin-form"));
			/* 
			 * 调用支持拖拽的方法 
			 */
			$yt_model_drag.modelDragEvent($(".class-bulletin-form .yt-edit-alert-title"));
			/**
			 * 点击取消方法
			 */
			 $('.class-bulletin-form .yt-eidt-model-bottom .canel-in-btn').off().on("click", function() {  
		            //隐藏页面中自定义的表单内容  
		            $(".class-bulletin-form").hide();  
		            //隐藏蒙层  
		            $("#pop-modle-alert").hide();  
	           });
		});
		//点击发布按钮
		$('.class-bulletin-form .yt-model-sure-btn').off().on('click', function() {

			var noticeDescribe = classBulletin.ue.getContent();
			var noticeTitle = $(".class-bulletin-input").val();
			console.log(noticeDescribe);
			if(noticeDescribe!=null&&noticeTitle!=''){
				//显示整体框架loading的方法
			$yt_baseElement.showLoading();
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "class/notice/addOrUpdateNotice",
				data: {
					pkId: pkId,
					projectCode: projectCode,
					noticeTitle: noticeTitle,
					noticeDescribe: noticeDescribe,
					dateStates: 1
				},
				async: true,
				success: function(data) {
					if(data.flag == 0) {
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("发布成功");
							//隐藏弹出框
							$(".class-bulletin-form").hide();
							classBulletin.getClassBulletin();
						});
					} else {
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("发布失败");
							//隐藏弹出框
							$(".class-bulletin-form").hide();
							classBulletin.getClassBulletin();
						});
					}
				}
			});	
			}else{
				$yt_alert_Model.prompt("请填写公告内容");
			}
		
			console.log(noticeDescribe);
		});
		/** 
		 * 点击暂存方法 
		 */
		$('.class-bulletin-form .yt-eidt-model-bottom .save-in-btn').off().on("click", function() {

			var noticeDescribe = classBulletin.ue.getContent();
			var noticeTitle = $(".class-bulletin-input").val();
			console.log(noticeTitle);
			if(noticeDescribe!=null&&noticeTitle!=""){
					//显示整体框架loading的方法
			$yt_baseElement.showLoading();
			$.ajax({
				type: "post",
				url: $yt_option.base_path + "class/notice/addOrUpdateNotice",
				data: {
					pkId: pkId,
					projectCode: projectCode,
					noticeTitle: noticeTitle,
					noticeDescribe: noticeDescribe,
					dateStates: 0
				},
				async: true,
				success: function(data) {
					if(data.flag == 0) {
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("暂存成功");
							//隐藏弹出框 
							$(".class-bulletin-form").hide();
							classBulletin.getClassBulletin();
						});
					} else {
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function() {
							$yt_alert_Model.prompt("暂存成功");
							//隐藏弹出框
							$(".class-bulletin-form").hide();
							classBulletin.getClassBulletin();
						});

					}
				}
			});
			}else{
				$yt_alert_Model.prompt("请填写公告内容");
			}
		

		});

	},
	
	/**
	 * 获取班级公告列表
	 */
	getClassBulletin: function() {
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$('.class-bulletin-div .page-info').pageInfo({
			async:true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			//pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "class/notice/getClassNoticeList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			before:function(){
				$yt_baseElement.showLoading();
			},
			data: {
				projectCode: projectCode
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.class-bulletin-div .list-tbody');
					var htmlTr = '';
					var num = 1;
					$(htmlTbody).empty();
					if(data.data.rows.length > 0) {
						$.each(data.data.rows, function(i, v) {
							$('.class-bulletin-div .page-info').show();
							htmlTr = '<tr>' +
								'<input class="bulletin-id" type="hidden" value="' + v.pkId + '"/>' +
								'<td  style="text-align: center;">' + num++ + '</td>' +
								'<td class="pro-desc">' + v.noticeTitle + '</td>' +
								'<td  style="text-align: center;">' + v.createTimeString + '</td>' +
								'<td  style="text-align: center;">' + v.createUserName + '</td>' +
								'<td  style="text-align: center;"><img class="bulletin-update" src="../../resources/images/icons/amend.png"/>' +
								'<div style="width: 1px;height: 15px;margin:0px 10px;display:inline-block;background: #e6e6e6;"></div>' +
								'<img class="bulletin-delete" src="../../resources/images/icons/t-del.png"/></td>' +
								'</tr>';
							htmlTr = $(htmlTr).data('bulletin', v);
							htmlTbody.append(htmlTr);
						});
					}else{
						$('.class-bulletin-div .page-info').hide();
						htmlTr='<tr class="class-tr">'+
										'<td colspan="5" align="center" style="border:0px;">'+
											'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
												'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
											'</div>'+
										'</td>'+
									'</tr>';
									htmlTbody.append(htmlTr);
					}
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
				} else {
					//隐藏整体框架loading的方法	
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	}
}
/**
 * 班级二维码
 */
var classQrCode = {
	init: function() {
classQrCode.getClassOrCode();
//点击下载按钮
$('.qr-img-download').on('click',function(){
	//获取班级编号
		 var projectCode = $yt_common.GetQueryString("projectCode");
	 	 var baseName='check_in_qr';	
	 	 var fileRealName=$('.project-name').eq(0).text()+'学员报到二维码.jpg';
	 	 window.location.href=$yt_option.base_path+"class/getQrcode?projectCode="+projectCode+"&&isDownload="+true+"&&fileRealName="+fileRealName+"&&baseName="+baseName;
});
//点击打印按钮
$('.qr-img-print').on('click',function(){
	//获取班级编号
		 var projectCode = $yt_common.GetQueryString("projectCode");
	 	 var baseName='check_in_qr';	
	var url=$yt_option.base_path+"class/getQrcode?projectCode="+projectCode+"&baseName="+baseName;
	var html='<img style="margin:14px;width:160px;height:155px;" src="'+url+'"/>';
		classQrCode.printImg(html);
});
	},
	//获取班级报到二维码
	getClassOrCode:function(){
		//获取班级编号
		 var projectCode = $yt_common.GetQueryString("projectCode");
		 var baseName='check_in_qr';
			var url=$yt_option.base_path+"class/getQrcode?projectCode="+projectCode+"&baseName="+baseName;
			var htmlBody=$('.class-qr-code-div .teacher-list-div .report-qr-code');
			htmlBody.before('<img style="margin:10px 0px 3px 10px;width:160px;height:154px;" src="'+url+'"/>');
			
	},
	//打印二维码
	printImg: function(html) {
		/*var headstr = "<html><head><title></title></head><body>";
		var footstr = "</body>";
		var printData = html;
		//获得 div 里的所有 html 数据
		var oldstr = document.body.innerHTML;
		document.body.innerHTML = headstr + html + footstr;*/
		$("#project-main").hide();
		$("#project-main").after($('<div class="body-print-box">'+html+'</div>'))
		
		window.print();
		$("#project-main").show();
		$(".body-print-box").remove();
		//document.body.innerHTML = oldstr;
		//trainingDetails.init();
		return false;
	},

}
/**
 * 学员报到
 */
var studentReport={
	init: function() {
		var traineeId;
//		//点击更多
//		var clickNumber = 0;
//		$('.search-more').click(function() {
//			//显示窗口
//			if(clickNumber %2==0){
//				$('.search-box').show();
//				$('.search-put').addClass('flipy');
//			}else{
//				$('.search-box').hide();
//				$('.project-code').val("");
//				$('.project-name').val("");
//				$('.project-head').val("");
//				$('.project-sell').val("");
//				$('.project-state-box').each(function() {
//					$(this).find("option:eq(0)").prop("selected", "selected");
//				});
//				$('.project-type-box').each(function() {
//					$(this).find("option:eq(0)").prop("selected", "selected");
//				});
//				$('.start-time-start').val("");
//				$('.start-time-end').val("");
//				$('.end-time-start').val("");
//				$('.end-time-end').val("");
//				$('.search-put').removeClass('flipy');
//				
//			}
//			clickNumber++;
//		});
		//失去焦点事件
		studentReport.losFfocus();
		//初始化下拉框
		$('.student-nation').niceSelect();
		$('.student-invoice-type').niceSelect();
		$('.card-type').niceSelect();
		$('.group-id-elementary').niceSelect();
		$('.org-id').niceSelect();
		//初始化日期控件
		$(".date-birth").calendar({
		    speed: 200, //日期列表展开显示速度, 参数"slow","normal","fast"，或毫秒数值，默认：200     
		    complement: true, // 是否显示日期或年空白处的前后月的补充,默认：true     
		    readonly: true, // 目标对象是否设为只读，默认：true     
		    lowerLimit:"NaN", // 日期下限，默认：NaN(不限制)     
		    nowData:true,//默认选中当前时间,默认true  
		    dateFmt:"yyyy-MM-dd",  
		    callback: function() { // 点击选择日期后的回调函数  
		        //alert("您选择的日期是：" + $("#txtDate").val());  
		    }  
		});
		$(".party-date").calendar({
		    speed: 200, //日期列表展开显示速度, 参数"slow","normal","fast"，或毫秒数值，默认：200     
		    complement: true, // 是否显示日期或年空白处的前后月的补充,默认：true     
		    readonly: true, // 目标对象是否设为只读，默认：true     
		    lowerLimit:"NaN", // 日期下限，默认：NaN(不限制)     
		    nowData:true,//默认选中当前时间,默认true  
		    dateFmt:"yyyy-MM-dd",  
		    callback: function() { // 点击选择日期后的回调函数  
		        //alert("您选择的日期是：" + $("#txtDate").val());  
		    }  
		});
		$(".work-time").calendar({
		    speed: 200, //日期列表展开显示速度, 参数"slow","normal","fast"，或毫秒数值，默认：200     
		    complement: true, // 是否显示日期或年空白处的前后月的补充,默认：true     
		    readonly: true, // 目标对象是否设为只读，默认：true     
		    lowerLimit:"NaN", // 日期下限，默认：NaN(不限制)     
		    nowData:true,//默认选中当前时间,默认true  
		    dateFmt:"yyyy-MM-dd",  
		    callback: function() { // 点击选择日期后的回调函数  
		        //alert("您选择的日期是：" + $("#txtDate").val());  
		    }  
		});
		var groupList=studentReport.getGroupList();
		var nationList=studentReport.getNationList();
		//民族下拉列表添加数据
		if(nationList.length!=0){
			$('.class-student-form .student-nation').empty();
			$.each(nationList, function(q,e) {
				$('.class-student-form .student-nation').append(' <option value="'+e.nationId+'">'+e.nationName+'</option>');
			});
			$('.class-student-form .student-nation').niceSelect();
		}
		//集团添加数据
		if(groupList.length!=0){
			$('.class-student-form .group-id-elementary').empty();
			$.each(groupList, function(q,e) {
				$('.class-student-form .group-id-elementary').append(' <option value="'+e.groupId+'">'+e.groupName+'</option>');
			});
			$('.class-student-form .group-id-elementary').niceSelect();
		}
		//下拉框二级联动
	$('.class-student-form .group-id-elementary').change(function(){
		groupId=$(this).val();
		var companyList=studentReport.getCompanyList(groupId);
		//单位添加数据
		if(companyList.length!=0){
			$('.class-student-form .org-id').empty();
			$('.class-student-form .org-id').append(' <option value="">请选择</option>');
			$.each(companyList, function(i,o) {
				$('.class-student-form .org-id').append(' <option value="'+o.orgId+'">'+o.orgName+'</option>');
			});
			$('.class-student-form .org-id').niceSelect();
		}else{
			$('.class-student-form .org-id').empty();
			$('.class-student-form .org-id').append(' <option value="">请选择</option>');
			$('.class-student-form .org-id').niceSelect();
		}
	});
		//点击导出按钮
		$('.export-class-student-btn').on('click',function(){
			
			//班级编号
			var projectCode = $yt_common.GetQueryString("projectCode");
			var exportName=$('.project-name:eq(0)').text()+"学员列表.xls";
			var gender="";
			var phone="";
			var groupId="";
			var orgId="";
			var deptPosition="";
			var isFirstTraining="";
			var classCommitteeId="";
			var signUpState="";
			$.ajaxDownloadFile({
			url:$yt_option.base_path+"class/trainee/exportTraineeByClass",
			data:{
				projectCode:projectCode,
				exportName:exportName,
				gender:gender,
				phone:phone,
				groupId:groupId,
				orgId:orgId,
				deptPosition:deptPosition,
				isFirstTraining:isFirstTraining,
				classCommitteeId:classCommitteeId,
				signUpState:signUpState
			}
		});
		});
		
		//点击上传照片按钮
		$('.upload-class-student-btn').on('click',function(){
			$('.class-student-upload-img').empty();
			$('.img-url-name-length').text(0);
			
				/** 
	         * 显示编辑弹出框和显示顶部隐藏蒙层 
	         */  
	        $(".class-student-upload-form").show();  
	        /** 
	         * 调用算取div显示位置方法 
	         */  
	        $yt_alert_Model.getDivPosition($(".class-student-upload-form"));  
	        /* 
	         * 调用支持拖拽的方法 
	         */ 
	        $yt_model_drag.modelDragEvent($(".class-student-upload-form .yt-edit-alert-title"));
	        /**
	         * 点击弹窗中的上传按钮
	         */
	       $(".class-student-upload-form .yt-model-sure-btn").off().on('click',function(){
			var headPortraits=[];
			$('.class-student-upload-img .exceed').each(function(i,e){
				var headPortrait=$(e).find('input').val();
				var headPortraitName=$(e).find('span').text();
				var exceedName={
					headPortrait:headPortrait,
					headPortraitName:headPortraitName
				};
				headPortraits.push(exceedName);
			});
			headPortraits=JSON.stringify(headPortraits);
			console.log("headPortraits",headPortraits);
			//显示整体框架loading的方法
			$yt_baseElement.showLoading();
		 $.ajax({
		 	type:"post",
		 	url:$yt_option.base_path+ "class/traineeCheck/updateTraineeHeadPortrait",
		 	data:{
		 		headPortraits:headPortraits
		 	},
		 	async:true,
		 	success:function(data){
				if(data.flag==0){
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						$yt_alert_Model.prompt("上传成功");
					});
				}else{
						//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						$yt_alert_Model.prompt("上传失败");
					});
				}
		 	}
		 });
		
	       });
	        /** 
	         * 点击取消方法 
	         */  
	        $('.class-student-upload-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
	            //隐藏页面中自定义的表单内容  
	            $(".class-student-upload-form").hide();  
	        });  
		});
	
		//上传方法
		$(".class-student-upload-form").undelegate().delegate("input[type='file']", "change", function() {
			
			console.log($(this)[0].files);
			var imgName=$(this)[0].files;
			console.log(imgName[0].type);
			//声明一个超过3M的空字符串
			var exceedName='';
			//声明一个照片格式不正确的字符串
			var repeatName='';
			
			for (var i=0;i<imgName.length;i++) {
				//判断大小是否超过3M
				if(imgName[i].size>3145728){
					if(exceedName==""){
						exceedName+=imgName[i].name;
					}else{
						exceedName+=","+imgName[i].name;
					}
				}
				//判断格式是否正确
				if(imgName[i].name.split(".")[1]!="jpg"&&imgName[i].name.split(".")[1]!="png"){
					if(repeatName==''){
						repeatName+=imgName[i].name;
					}else{
						repeatName+=","+imgName[i].name;
					}
				}
			}
			console.log(imgName.length);
			console.log(exceedName);
			var url = $yt_option.acl_path + "api/tAscPortraitInfo/addMultipartFiles?modelCode=headPortraits";
			//判断是否超过3M
			if(exceedName==""){
				//判断照片格式是否正确	
				if(repeatName==""){
					$yt_baseElement.showLoading();
					$.ajaxFileUpload({
						url: url,
						type: "post",
						dataType: 'json',
						fileElementId: "fileNames",
						success: function(data, textStatus) {
							var resultData = $.parseJSON(data);
							console.log("resultData",resultData.length);
							$("#fileNames").val("");
							if(resultData.success == 0) {
								$.each(resultData.obj, function(q,e) {
									$('.exceed[fileName="'+e.naming+'"]').remove();
									$('.class-student-upload-img').append('<span class="exceed" fileName="'+e.naming+'"><input  type="hidden" value="'+e.pkId+'"/><span class="exceed-name">'+e.naming+'</span>，</span>');
									//$('.class-student-upload-img .exceed0').append('<input  type="hidden" value="'+e.pkId+'"/>');
								});
								$yt_baseElement.hideLoading();
								$('.img-url-name-length').text($('.class-student-upload-img .exceed').length);
							} else {
								$yt_baseElement.hideLoading(function() {
									$yt_alert_Model.prompt("上传照片失败");
								});
							}
						},
						error: function(data, status, e) { //服务器响应失败处理函数  
							$yt_baseElement.hideLoading(function() {
								$yt_alert_Model.prompt("上传照片失败");
							});
						}
					});
				}else{
					$("#pop-modle-alert").css("z-index",103);
		 			$yt_alert_Model.alertOne({  
				        haveCloseIcon: false, //是否带有关闭图标  
				        leftBtnName: "关闭", //左侧按钮名称,默认确定  
				        cancelFunction: "", //取消按钮操作方法*/  
				        alertMsg: '<div class="word-break: break-all;">'+repeatName+'</div>格式不对', //提示信息  
				        cancelFunction: function() { //点击确定按钮执行方法  
				        	$("#pop-modle-alert").css("z-index",100).show();
				        }
				    }); 
				}
			}else{
				$("#pop-modle-alert").css("z-index",103);
	 			$yt_alert_Model.alertOne({  
			        haveCloseIcon: false, //是否带有关闭图标  
			        leftBtnName: "关闭", //左侧按钮名称,默认确定  
			        cancelFunction: "", //取消按钮操作方法*/  
			        alertMsg: '<div class="word-break: break-all;">'+exceedName+'</div>大小超过3M', //提示信息  
			        cancelFunction: function() { //点击确定按钮执行方法  
			        	$("#pop-modle-alert").css("z-index",100).show();
			        }
			    });  
			}
		});
		
		//点击通讯录按钮
		$('.mail-list-btn').on('click',function(){
			//班级编号
			var projectCode = $yt_common.GetQueryString("projectCode");
			var sort='';
			var orderType='';
			//显示整体框架loading的方法
			$yt_baseElement.showLoading();
			$('.class-student-mail-form .page-info').pageInfo({
				async:true,
				pageIndexs: 1,
				pageNum: 15, //每页显示条数  
				pageSize: 10, //显示...的规律  
				url: $yt_option.base_path + "class/traineeCheck/getClassTrainee", //ajax访问路径  
				type: "post", //ajax访问方式 默认 "post"  
				data: {
					projectCode: projectCode,
					sort:sort,
					orderType: orderType
				}, //ajax查询访问参数
				objName: 'data', //指获取数据的对象名称  
				before:function(){
					//显示整体框架loading的方法	
				$yt_baseElement.showLoading();
				},
				success: function(data) {
					if(data.flag == 0) {
						var htmlTbody = $('.class-student-mail-form .student-msg tbody');
						var htmlTr = '';
						var num = 1;
						$(htmlTbody).empty();
						if(data.data.rows.length > 0) {
							$.each(data.data.rows, function(i, v) {
								if(v.gender==1){
									v.gender="男";
								}else if(v.gender==2){
									v.gender="女";
								}
								htmlTr = '<tr>' +
									'<td >'+v.realName+'</td>'+
									'<td style="text-align: center;">'+v.gender+'</td>'+
									'<td>'+v.phone+'</td>'+
									'<td>'+v.groupName+'</td>'+
									'<td>'+v.deptPosition+'</td>'+
									'<td style="text-align:center;">'+v.headPortraitName+'</td>'+
									'</tr>';
								htmlTbody.append(htmlTr);
							});
						}else{
							htmlTr='<tr class="class-tr">'+
											'<td colspan="6" align="center" style="border:0px;">'+
												'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
													'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
												'</div>'+
											'</td>'+
										'</tr>';
							htmlTbody.append(htmlTr);
						}
						//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
					} else {
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function(){
							$yt_alert_Model.prompt("查询失败");
						});
						
					}
	
				}, //回调函数 匿名函数返回查询结果  
				isSelPageNum: true //是否显示选择条数列表默认false  
			});
			 /** 
	         * 显示编辑弹出框和显示顶部隐藏蒙层 
	         */  
	        $(".class-student-mail-form").show();  
	        /** 
	         * 调用算取div显示位置方法 
	         */  
	        $yt_alert_Model.getDivPosition($(".class-student-mail-form"));  
	        /* 
	         * 调用支持拖拽的方法 
	         */  
	        $yt_model_drag.modelDragEvent($(".class-student-mail-form .yt-edit-alert-title"));  
	        /** 
	         * 点击取消方法 
	         */  
	        $('.class-student-mail-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
	            //隐藏页面中自定义的表单内容  
	            $(".class-student-mail-form").hide();  
	        });  
			});
			var clickNum=1;
			//点击弹窗的打印按钮
			$('.class-student-mail-form .yt-model-sure-btn').on('click',function(){
				//获取班级编号
		 	var projectCode = $yt_common.GetQueryString("projectCode");
		 	//显示整体框架loading的方法
		 	$yt_baseElement.showLoading();
				$.ajax({
					type:"post",
					url:$yt_option.base_path + "class/traineeCheck/getTraineeCheck",
					data:{
						projectCode:projectCode,
						fileType:2
					},
					async:true,
					success:function(data){
						var htmlBody=$('.class-student-print-form .pring-list tbody');
						var htmlr='';
						htmlBody.empty();
						if(data.flag==0){
							if(data.data.length!=0){
								//判断此接口是否有返回值，若有则为第二次打印
								$('.again-print-btn').show();
								$('.print-opera span').eq(0).show();
								$('.pring-list').show();
								$('.print-opera').hide();
								$.each(data.data, function(i,p) {
									htmlr = '<tr>'+
											'<td style="text-align: center;">'+p.createTimeString+'</td>'+
											'<td style="text-align: center;">'+p.createUser+'</td>'+
											'<td><a href="'+p.fileUrl+'" class="yt-link">'+p.fileName+'</a></td>'+
											'<td style="text-align: right;">'+p.printerCount+'</td>';
									if(p.states=="2"){
										p.states="打印完成";
										htmlr+='<td class="colour-yellow" style="text-align: center;">'+p.states+'</td>'+	
												'</tr>';
									}else if(p.states=="3"){
										p.states="待打印";
										htmlr+='<td class="colour-blue" style="text-align: center;">'+p.states+'</td>'+	
												'</tr>';
									}else if(p.states=="4"){
										p.states="已作废";
										htmlr+='<td class="colour-blue" style="text-align: center;">'+p.states+'</td>'+	
												'</tr>';
									}else if(p.states=="5"){
										p.states="未打印";
										htmlr+='<td style="text-align: center;">'+p.states+'</td>'+	
												'</tr>';
									}
									htmlBody.append(htmlr);
								});
							}else{
								//判断此接口是否有返回值，若没有则为第一次打印
								$('.pring-list').hide();
								$('.print-opera').show();
								$('.print-opera span').eq(0).hide();
								$('.print-opera .print-file-name').hide();
								$('.again-print-btn').hide();
							}
							//隐藏整体框架loading的方法
							$yt_baseElement.hideLoading();
						}else{
							//隐藏整体框架loading的方法
							$yt_baseElement.hideLoading();
						}
					}
				});
				//点击重新打印按钮
				$('.class-student-print-form .again-print-btn').on('click',function(){
				
					$('.print-opera').show();
				});
				//点击生成excel按钮
				$('.print-opera .generate-excel-btn').on('click',function(){
					$('.print-opera .print-file-name').show();
					//获取班级编号
		 	var projectCode = $yt_common.GetQueryString("projectCode");
		 	//显示整体框架loading的方法
		 	$yt_baseElement.showLoading();
		 	$.ajax({
		 		type:"post",
		 		url:$yt_option.base_path + "class/traineeCheck/getPrintingExcel",
		 		data:{
		 			projectCode:projectCode
		 		},
		 		async:true,
		 		success:function(data){
		 			if(data.flag==0){
		 				$('.print-opera .file-id').val(data.data.fileId);
		 				
	 					$('.print-opera .print-file-name a').text(data.data.fileName);
	 					$('.print-opera .print-file-name a').attr('href',data.data.fileUrl);
	 					//隐藏整体框架loading的方法
	 					$yt_baseElement.hideLoading();
		 			}else{
		 				//隐藏整体框架loading的方法
	 					$yt_baseElement.hideLoading(function(){
	 						$yt_alert_Model.prompt("生成excel失败");
	 					});
		 			}
		 		}
		 	});
				});
				//点击确定按钮
				$('.class-student-print-form .yt-eidt-model-bottom .yt-model-sure-btn').on('click',function(){
					clickNum=2;
					//获取班级编号
		 	var projectCode = $yt_common.GetQueryString("projectCode");
		 	var fileId=$('.print-opera .file-id').val();
		 	var fileName=$('.print-opera .print-file-name a').text();
		 	var printerCount=$('.print-opera .print-count-num').val();
		 	var fileType=2;
		 	var states=3;
		 	var pringingData={
		 		projectCode:projectCode,
		 		fileId:fileId,
		 		fileName:fileName,
		 		printerCount:printerCount,
		 		fileType:fileType,
		 		states:states
		 	};
		 	pringingData=JSON.stringify(pringingData);
		 	console.log(pringingData);
		 	//显示整体框架loading的方法
		 	$yt_baseElement.showLoading();
		 	$.ajax({
		 		type:"post",
		 		url:$yt_option.base_path + "class/traineeCheck/addPrinting",
		 		data:{
		 			pringingData:pringingData
		 		},
		 		async:true,
		 		success:function(data){
		 			if(data.flag==0){
		 				//隐藏整体框架loading的方法
		 				$yt_baseElement.hideLoading(function(){
		 					$yt_alert_Model.prompt("打印成功");
		 					 $(".class-student-print-form").hide();  
		 				});
		 			}else{
		 				//隐藏整体框架loading的方法
		 				$yt_baseElement.hideLoading(function(){
		 					$yt_alert_Model.prompt("打印失败");
		 				});
		 			}
		 		}
		 	});
				});
			/** 
	         * 显示编辑弹出框和显示顶部隐藏蒙层 
	         */  
	          $(".class-student-mail-form").hide();
	        $(".class-student-print-form").show();  
	        /** 
	         * 调用算取div显示位置方法 
	         */  
	        $yt_alert_Model.getDivPosition($(".class-student-print-form"));  
	        /* 
	         * 调用支持拖拽的方法 
	         */  
	        $yt_model_drag.modelDragEvent($(".class-student-print-form .yt-edit-alert-title"));  
	        /** 
	         * 点击取消方法 
	         */  
	        $('.class-student-print-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {
	        	
	            //隐藏页面中自定义的表单内容  
	             $(".class-student-print-form").hide();  
	            $(".class-student-mail-form").show();  
	        });  
		});
		//点击报到按钮
		$('.report-class-student-btn').off().on('click',function(){
			var studentList=$('.student-report-div .yt-table-active').data('studentList');
			if(studentList!=null){
				var checkInState=1;
				studentReport.reportInterface(checkInState);
			}else{
				$yt_alert_Model.prompt("请选择一条进行操作");
			}
			
		});
		//点击未报到按钮
		$('.no-report-class-student-btn').off().on('click',function(){
			var studentList=$('.student-report-div .yt-table-active').data('studentList');
			if(studentList!=null){
				var checkInState=0;
				studentReport.reportInterface(checkInState);
			}else{
				$yt_alert_Model.prompt("请选择一条进行操作");
			}
		});
		//点击新增
	$('.add-class-student-btn').on('click',function(){
		traineeId="";
		$('.class-student-form .yt-edit-alert-title-msg').text("新增学员");
		//获取名字
		 	$('.class-student-form .class-student-name').val("");
		 	//获取组号
		 	$('.class-student-form .class-student-group-num').val("");;
		 	 //获取性别
		 	$('.class-student-form .class-student-name').parent().parent().nextAll().find('input[type="radio"][value="1"]').setRadioState("check");
		 	 //获取民族
		 	$('.class-student-form .student-nation').setSelectVal("");
		 	 //获取手机号
		 	$('.class-student-form .class-student-phone').val("");
		 	  //获取证件类型
		 	$('.class-student-form .card-type').setSelectVal("");
		 	 //获取证件号
		 	$('.class-student-form .id-number').val("");
		 	 //获取集团
		 	$('.class-student-form .group-id-elementary').setSelectVal("");
		 	 //获取单位
		 	$('.class-student-form .org-id').setSelectVal("");
		 	 //获取部门
		 	$('.class-student-form .student-msg .dept-name').val("");
		 	// 获取职位
		 	 var positionName="";
		 	 //获取发票类型
		 	$('.class-student-form .student-invoice-type').setSelectVal("");
		 	 //获取发票名称
		 	$('.class-student-form .student-invoice-name').val("");
		 	 //获取识别号
		 	$('.class-student-form .student-invoice-duty').val("");
		 	 //获取地址
		 	 $('.class-student-form .student-invoice-address').val("");
		 	 //获取电话
		 	$('.class-student-form .student-invoice-phone').val("");
		 	 //获取开户行
		 	$('.class-student-form .student-invoice-open-bank').val("");
		 	 //获取账户
		 	 $('.class-student-form .student-invoice-acc').val("");
		 	 //出生年月
		 	 $('.class-student-form .date-birth').val();
		 	 //获取单位类型
		 	$('.class-student-form .org-type').setSelectVal("");
		 	 //获取通信地址
		 	$('.class-student-form .mailing-address').val("");
		 	 //获取邮政编码
		 	 $('.class-student-form .postal-code').val("");
		 	 //获取传真
		 	 $('.class-student-form .class-student-fax').val("");
		 	 //获取入党时间
		 	 $('.class-student-form .party-date').val();
		 	 //获取全职教育
		 	 $('.class-student-form .education-time').val("");
		 	 //获取全职教育-毕业院校及专业
		 	  $('.class-student-form .education-time-class').val("");
		 	   //获取在职教育
		 	  $('.class-student-form .service-time').val("");
		 	   //获取在职教育-毕业院校及专业
		 	   $('.class-student-form .service-time-class').val("");
		 	    //获取电话号
		 	   $('.class-student-form .telephone-project').val("");
		 	     //获取电子邮件
		 	    $('.class-student-form .class-student-email').val("");
		 	     //获取工作时间
		 	   $('.class-student-form .work-time').val("");
		 /** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
        $(".class-student-form").show();  
        /** 
         * 调用算取div显示位置方法 
         */  
      	$yt_alert_Model.setFiexBoxHeight($(".class-student-form .yt-edit-alert-main"));
        $yt_alert_Model.getDivPosition($(".class-student-form"));  
        /* 
         * 调用支持拖拽的方法 
         */  
       $yt_model_drag.modelDragEvent($(".class-student-form .yt-edit-alert-title"));  
        /** 
         * 点击取消方法 
         */  
        $('.class-student-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".class-student-form").hide();  
            //隐藏蒙层  
            $("#pop-modle-alert").hide();  
        });  
	});
	//点击修改按钮
	$('.update-class-student-btn').on('click',function(){
		//获取学员Id
		traineeId=$(".student-report-div .yt-table-active .trainee-id").val();
		var studentList=$('.student-report-div .yt-table-active').data('studentList');
		console.log('studentList',studentList);
		if(studentList!=null){
			var studentDetailedmsg=studentReport.getStudentDetailedMsg();
			console.log('studentReport.studentDetailedmsg',studentDetailedmsg);
			$('.class-student-form .yt-edit-alert-title-msg').text("修改学员");
			$('.class-student-form').setDatas(studentDetailedmsg);
			//获取性别
		$('.class-student-form .class-student-name').parent().parent().nextAll().find('input[type="radio"][value="'+studentDetailedmsg.gender+'"]').setRadioState("check");	
		 	 //获取民族
		 	$('.class-student-form .student-nation').setSelectVal(studentDetailedmsg.nationId);
		 	  //获取证件类型
		 	$('.class-student-form .card-type').setSelectVal(studentDetailedmsg.idType);
		 	 //获取集团
		 	$('.class-student-form .group-id-elementary').setSelectVal(studentDetailedmsg.groupId);
		 	groupId=studentDetailedmsg.groupId;
		var companyList=studentReport.getCompanyList(groupId);
		//单位添加数据
		if(companyList!=""){
			$('.class-student-form .org-id').empty();
			$('.class-student-form .org-id').append(' <option value="">请选择</option>');
			$.each(companyList, function(i,o) {
				$('.class-student-form .org-id').append(' <option value="'+o.orgId+'">'+o.orgName+'</option>');
			});
			$('.class-student-form .org-id').niceSelect();
		}else{
			$('.class-student-form .org-id').empty();
			$('.class-student-form .org-id').append(' <option value="">请选择</option>');
			$('.class-student-form .org-id').niceSelect();
		}
		 	 //获取单位
		 	$('.class-student-form .org-id').setSelectVal(studentDetailedmsg.groupOrgId);
		 	 //获取发票类型
		 	$('.class-student-form .student-invoice-type').setSelectVal(studentDetailedmsg.invoiceType);
		 	 //获取单位类型
		 	$('.class-student-form .org-type').setSelectVal(studentDetailedmsg.orgType);
		 /** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
        $(".class-student-form").show();  
        /** 
         * 调用算取div显示位置方法 
         */  
         $yt_alert_Model.setFiexBoxHeight($(".class-student-form .yt-edit-alert-main"));
        $yt_alert_Model.getDivPosition($(".class-student-form"));  
        /* 
         * 调用支持拖拽的方法 
         */  
       $yt_model_drag.modelDragEvent($(".class-student-form .yt-edit-alert-title"));  
        /** 
         * 点击取消方法 
         */  
        $('.class-student-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".class-student-form").hide();  
            //隐藏蒙层  
            $("#pop-modle-alert").hide();  
        });  
		}else{
			$yt_alert_Model.prompt("请选择一行进行修改");
		}
		
	});
	
	//点击弹框确定按钮
		 $(".class-student-form .yt-model-sure-btn").on('click',function(){
		 	
		 	//获取班级编号
		 	var projectCode = $yt_common.GetQueryString("projectCode");
		 	//获取名字
		 	var realName=$('.class-student-form .class-student-name').val();
		 	//获取组号
		 	 var groupNum=$('.class-student-form .class-student-group-num').val();;
		 	 //获取性别
		 	 var gender=$('.class-student-form .class-student-name').parent().parent().nextAll().find('input[type="radio"]:checked').val();
		 	 //获取民族
		 	 var nationId=$('.class-student-form .student-nation').val();
		 	 //获取手机号
		 	 var phone=$('.class-student-form .class-student-phone').val();
		 	  //获取证件类型
		 	 var idType=$('.class-student-form .card-type').val();
		 	 //获取证件号
		 	 var idNumber=$('.class-student-form .id-number').val();
		 	 //获取集团
		 	 var groupId=$('.class-student-form .group-id-elementary').val();
		 	 //获取单位
		 	 var orgId=$('.class-student-form .org-id').val();
		 	 //获取部门
		 	 var deptName=$('.class-student-form .student-msg .dept-name').val();
		 	// 获取职位
		 	 var positionName="";
		 	 //获取发票类型
		 	 var invoiceType=$('.class-student-form .student-invoice-type').val();
		 	 //获取发票名称
		 	 var orgName=$('.class-student-form .student-invoice-name').val();
		 	 //获取识别号
		 	 var taxNumber=$('.class-student-form .student-invoice-duty').val();
		 	 //获取地址
		 	 var address=$('.class-student-form .student-invoice-address').val();
		 	 //获取电话
		 	 var telephoneProject=$('.class-student-form .student-invoice-phone').val();
		 	 //获取开户行
		 	 var registeredBank=$('.class-student-form .student-invoice-open-bank').val();
		 	 //获取账户
		 	 var account=$('.class-student-form .student-invoice-acc').val();
		 	 //出生年月
		 	 var dateBirth=$('.class-student-form .date-birth').val();
		 	 //获取单位类型
		 	 var orgType=$('.class-student-form .org-type').val();
		 	 //获取通信地址
		 	 var mailingAddress=$('.class-student-form .mailing-address').val();
		 	 //获取邮政编码
		 	 var postalCode=$('.class-student-form .postal-code').val();
		 	 //获取传真
		 	 var fax=$('.class-student-form .class-student-fax').val();
		 	 //获取入党时间
		 	 var partyDate=$('.class-student-form .party-date').val();
		 	 //获取全职教育
		 	 var educationTime=$('.class-student-form .education-time').val();
		 	 //获取全职教育-毕业院校及专业
		 	  var educationTimeClass=$('.class-student-form .education-time-class').val();
		 	   //获取在职教育
		 	  var serviceTime=$('.class-student-form .service-time').val();
		 	   //获取在职教育-毕业院校及专业
		 	  var serviceTimeClass=$('.class-student-form .service-time-class').val();
		 	    //获取电话号
		 	  var telephone=$('.class-student-form .telephone-project').val();
		 	     //获取电子邮件
		 	  var email=$('.class-student-form .class-student-email').val();
		 	     //获取工作时间
		 	  var workTime=$('.class-student-form .work-time').val();
		 	  if(phone!=""){
 	  			//显示整体框架loading的方法
	 			$yt_baseElement.showLoading();
			 	$.ajax({
			 		type:"post",
			 		url:$yt_option.base_path + "class/trainee/addOrUpdateTrainee",
			 		data:{
			 			traineeId:traineeId,
			 			projectCode:projectCode,
			 			realName:realName,
			 			groupNum:groupNum,
			 			gender:gender,
			 			nationId:nationId,
			 			phone:phone,
			 			idNumber:idNumber,
			 			groupId:groupId,
			 			orgId:orgId,
			 			deptName:deptName,
			 			positionName:positionName,
			 			invoiceType:invoiceType,
			 			orgName:orgName,
			 			taxNumber:taxNumber,
			 			address:address,
			 			telephoneProject:telephoneProject,
			 			registeredBank:registeredBank,
			 			account:account,
			 			idType:idType,
			 			dateBirth:dateBirth,
			 			orgType:orgType,
			 			mailingAddress:mailingAddress,
			 			postalCode:postalCode,
			 			fax:fax,
			 			partyDate:partyDate,
			 			educationTime:educationTime,
			 			educationTimeClass:educationTimeClass,
			 			serviceTime:serviceTime,
			 			serviceTimeClass:serviceTimeClass,
			 			telephone:telephone,
			 			email:email,
			 			workTime:workTime
			 		},
			 		async:true,
			 		success:function(data){
			 			if(data.flag==0){
			 				console.log("traineeId",traineeId);
			 				//隐藏整体框架loading的方法
			 				$yt_baseElement.hideLoading(function(){
			 					if(traineeId==""){
			 						$yt_alert_Model.prompt("添加成功");
			 					}else{
			 						$yt_alert_Model.prompt("修改成功");
			 					}
			 					//刷新页面
			 					studentReport.getStudentReport();
			 					 $(".class-student-form").hide();  
			 				});
			 			}else{
			 				//隐藏整体框架loading的方法
			 				$yt_baseElement.hideLoading(function(){
			 					if(traineeId==""){
			 						$yt_alert_Model.prompt("添加失败");
			 					}else{
			 						$yt_alert_Model.prompt("修改失败");
			 					}
			 					//刷新页面
			 					studentReport.getStudentReport();
			 					 $(".class-student-form").hide();  
			 				});
			 			}
			 		}
			 	});
		 	  }else{
		 	  	 /** 
		          * 调用验证方法 
		          */  
		      	 $yt_valid.validForm($(".valid-tab1")); 
		 	  }
		 
		 });
	},
	/**
	 * 失去焦点事件
	 */
	losFfocus:function(){
		$('.student-invoice-duty').blur(function(){
			//税号字母变成大写
			$(this).val($(this).val().toUpperCase());
		});
	},
	/**
	 * 获取一个学员的详细信息
	 */
	getStudentDetailedMsg:function(){
		
		//var studentList=$('.student-report-div .yt-table-active').data('studentList');
		var traineeId=$(".student-report-div .yt-table-active .trainee-id").val();
		var studentDetailedMsg;
		//获取班级编号
		 var projectCode = $yt_common.GetQueryString("projectCode");
		 //显示整体框架loading的方法
		 $yt_baseElement.showLoading();
		 $.ajax({
		 	type:"post",
		 	url:$yt_option.base_path + "class/trainee/getTraineeDetails",
		 	data:{
		 		traineeId:traineeId,
		 		projectId:projectCode
		 	},
		 	async:false,
		 	success:function(data){
		 		if(data.flag==0){
		 			studentDetailedMsg=data.data;
		 			//隐藏整体框架loading的方法
		 			$yt_baseElement.hideLoading();
		 		}
		 	}
		 });
		 return studentDetailedMsg;
	},
	/**
	 * 报到未报到接口
	 */
	reportInterface:function(checkInState){
		//获取班级编号
		 	var projectCode = $yt_common.GetQueryString("projectCode");
			var studentList=$('.student-report-div .yt-table-active').data('studentList');
			var traineeId=studentList.traineeId;
			//显示整体框架loading的方法
			$yt_baseElement.showLoading();
			$.ajax({
				type:"post",
				url:$yt_option.base_path + "class/traineeCheck/updateCheckState",
				data:{
					projectCode:projectCode,
					traineeId:traineeId,
					checkInState:checkInState
				},
				async:true,
				success:function(data){
					if(data.flag==0){
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function(){
							$yt_alert_Model.prompt("设置成功");
							studentReport.getStudentReport();
						});
					}else{
						//隐藏整体框架loading的方法
						$yt_baseElement.hideLoading(function(){
							$yt_alert_Model.prompt("设置失败");
							studentReport.getStudentReport();
						});
					}
				}
			});
	},
	//获取民族列表
	getNationList:function(){
		var nationList=[];
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "uniform/getNations",
			data:{
			searchParameters:""	
			},
			async:false,
			success:function(data){
				if(data.flag==0){
					console.log("成功");
					$.each(data.data, function(a,b) {
						nationList.push(b);
					});
				}
			}
		});
		return nationList;
	},
	//获取集团列表
	getGroupList:function(){
		var groupList=[];
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/trainee/getGroups",
			data:{
			groupName:""	
			},
			async:false,
			success:function(data){
				if(data.flag==0){
					console.log("成功");
					$.each(data.data, function(a,b) {
						groupList.push(b);
					});
				}
			}
		});
		return groupList;
	},
	//获取单位列表
	getCompanyList:function(groupId){
		var companyList=[];
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/trainee/getOrgs",
			data:{
			orgName:"",
			groupId:groupId
			},
			async:false,
			success:function(data){
				if(data.flag==0){
					console.log("成功");
					$.each(data.data, function(a,b) {
						companyList.push(b);
					});
				}
			}
		});
		return companyList;
	},
	/**
	 * 查询学员报到列表
	 */
	getStudentReport: function() {
		var projectCode = $yt_common.GetQueryString("projectCode");
		var selectParam = $('.student-report-div .keyword').val();
		var gender = "";
		var phone = "";
		var groupId = "";
		var orgId = "";
		var deptPosition = "";
		var isFirstTraining = "";
		var classCommitteeId = "";
		var signUpState = "";
		var checkInState = "";
		var sort = "";
		var orderType = "";
	
		$('.student-report-div .page-info').eq(0).pageInfo({
			async:true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "class/trainee/getClassTrainee", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode,
				selectParam: selectParam,
				gender: gender,
				phone: phone,
				groupId: groupId,
				orgId: orgId,
				deptPosition: deptPosition,
				isFirstTraining: isFirstTraining,
				classCommitteeId: classCommitteeId,
				signUpState: signUpState,
				checkInState: checkInState,
				sort: sort,
				orderType: orderType
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			before:function(){
				//显示整体框架loading的方法	
			$yt_baseElement.showLoading();
			},
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.student-report-div .list-tbody');
					var htmlTr = '';
					var num = 1;
					$(htmlTbody).empty();
					if(data.data.rows.length > 0) {
						$('.student-report-div .page-info').show();
						$.each(data.data.rows, function(i, v) {
							
							if(v.gender==1){
								v.gender="男";
							}else if(v.gender==2){
								v.gender="女";
							}
							if(v.isFirstTraining==0){
								v.isFirstTraining="不是";
							}else{
								v.isFirstTraining="是";
							}
							
							htmlTr = '<tr>' +
								'<td style="text-align: center;"><input type="hidden" value="' + v.pkId + '" class="pkId">' + v.groupNum + '</td>' +
								'<td><input type="hidden" value="' + v.traineeId + '" class="trainee-id"><a href="#" class="real-name-inf" style=" color:blue;word-break: break-all;">' + v.realName + '</a></td>' +
								'<td style="text-align: center;">' + v.gender + '</td>' +
								'<td style="text-align: center;">' + v.phone + '</td>' +
								'<td>' + v.groupName + '</td>' +
								'<td>' + v.orgName + '</td>' +
								'<td>' + v.deptName + '</td>' +
								'<td>' + v.classCommitteeName + '</td>' +
								'<td style="text-align: center;">' + v.isFirstTraining + '</td>';
							if(v.checkInState==0){
								v.checkInState="未报到";
								htmlTr+='<td class="colour-yellow" style="text-align: center;">' + v.checkInState + '</td>' +
										'</tr>';
							}else{
								v.checkInState="已报到";
								htmlTr+='<td class="colour-blue" style="text-align: center;">' + v.checkInState + '</td>' +
										'</tr>';
							}	
						
							htmlTr=$(htmlTr).data('studentList',v);
							htmlTbody.append(htmlTr);
						});
					}else{
						$('.student-report-div .page-info').hide();
						htmlTr='<tr class="class-tr">'+
										'<td colspan="10" align="center" style="border:0px;">'+
											'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
												'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
											'</div>'+
										'</td>'+
									'</tr>';
						htmlTbody.append(htmlTr);
					}
					//隐藏整体框架loading的方法
				$yt_baseElement.hideLoading();
				} else {
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						
						$yt_alert_Model.prompt("查询失败");
					});
					
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
	/**
	 * 查询酒店入住名单与学员列表不匹配列表
	 */
	getDifferentList:function(){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			type:"post",
			url: $yt_option.base_path + "class/trainee/getHotelTraineeToClassTrainee",
			data:{
				projectCod:projectCode
			},
			async:true,
			success:function(data){
				var htmlBody=$('.different-student-list tbody ');
				var htmlTr='';
				var num=1;
				if(data.flag==0){
					if(data.data.length>0){
						htmlBody.parent().parent().show();
						$.each(data.data, function(k,b) {
					htmlTr='<tr>'+
								'<td>'+ num++ +'</td>'+
								'<td>'+b.traineeName+'</td>'+
								'<td>'+b.gender+'</td>'+
								'<td>'+b.idNumber+'</td>'+
								'<td>'+b.roomNumber+'</td>'+
								'<td>'+b.createTimeString+'</td>'+
								'<td>'+b.reason+'</td>'+
							'</tr>';
							htmlBody.append(htmlTr);
					});
					}else{
						htmlBody.parent().parent().hide();
					}
					
				}else{
					$yt_alert_Model.prompt("查询失败");
				}
			}
		});
	}
}
/**
 * 缴费开票
 */
var payTicket={
	init:function(){
		//加载下拉列表
		$(".ticket-class-student-form .student-nation").niceSelect();
		$(".ticket-class-student-form .card-types").niceSelect();
		$(".ticket-class-student-form .group-id-elementary").niceSelect();
		$(".ticket-class-student-form .org-ids").niceSelect();
		$(".ticket-class-student-form .org-types").niceSelect();
		$(".ticket-class-student-form .student-invoice-types").niceSelect();
		
		console.log("缴费开票获取民族",studentList.getStudentNationList());
		//加载民族
		var tickStudentNation=studentList.getStudentNationList();
		if(tickStudentNation.length!=0){
			$.each(tickStudentNation, function(i,n) {
				$(".ticket-class-student-form .student-nation").append('<option value="'+n.nationId+'">'+n.nationName+'</option>');
			});
			$(".ticket-class-student-form .student-nation").niceSelect();
		}
		//加载集团
		var tickGroup=studentList.getStudentGroupList();
		console.log("缴费开票获取集团",tickGroup);
		if(tickGroup.lenghth!=0){
			$.each(tickGroup, function(i,b) {
				$(".ticket-class-student-form .group-id-elementary").append('<option value="'+b.groupId+'">'+b.groupName+'</option>');
			});
			$(".ticket-class-student-form .group-id-elementary").niceSelect();
		}
		//二级联动加载单位
		$(".ticket-class-student-form .group-id-elementary").change(function(){
			var groupId=$(this).val();
			var tickCompany=studentList.getStudentCompanyList(groupId);
			console.log("缴费开票获取单位",tickCompany);
			if(tickCompany.length!=0){
				$(".ticket-class-student-form .org-ids").empty();
				$(".ticket-class-student-form .org-ids").append('<option value="">请选择</option>');
				$.each(tickCompany, function(i,a) {
					$(".ticket-class-student-form .org-ids").append('<option value="'+a.orgId+'">'+a.orgName+'</option>');
				});
				$(".ticket-class-student-form .org-ids").niceSelect();
			}else{
				$(".ticket-class-student-form .org-ids").empty();
				$(".ticket-class-student-form .org-ids").append('<option value="">请选择</option>');
				$(".ticket-class-student-form .org-ids").niceSelect();
			}
		});
		//点击修改按钮
		$('.pay-ticket-open-div .ticket-update-class-student-btn').off('click').on('click',function(){
			//修改弹窗赋值
			
			/** 
	         * 显示编辑弹出框和显示顶部隐藏蒙层 
	         */  
	       $('.ticket-class-student-form').show();
	        /** 
	         * 调用算取div显示位置方法 
	         */  
	          $yt_alert_Model.setFiexBoxHeight($(".ticket-class-student-form .yt-edit-alert-main"));
	        $yt_alert_Model.getDivPosition($(".ticket-class-student-form"));  
	        /* 
	         * 调用支持拖拽的方法 
	         */  
	        $yt_model_drag.modelDragEvent($(".ticket-class-student-form .yt-edit-alert-title"));  
	        /** 
	         * 点击取消方法 
	         */  
	        $('.ticket-class-student-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
	            //隐藏页面中自定义的表单内容  
	            $(".ticket-class-student-form").hide();  
	        });  
		});
	//点击导入开票信息
	$('.pay-ticket-open-div .ticket-add-class-student-btn').off('click').on('click',function(){
		 /** 
         * 显示编辑弹出框和显示顶部隐藏蒙层 
         */  
        $(".ticket-import-form").show();  
        /** 
         * 调用算取div显示位置方法 
         */  
        $yt_alert_Model.getDivPosition($(".ticket-import-form"));  
        /* 
         * 调用支持拖拽的方法 
         */  
      	$yt_model_drag.modelDragEvent($(".ticket-import-form .yt-edit-alert-title"));  
        /** 
         * 点击取消方法 
         */  
        $('.ticket-import-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
            //隐藏页面中自定义的表单内容  
            $(".ticket-import-form").hide();  
        });  
	});
	},
	/**
	 * 缴费开票导出
	 */
	
	/**
	 * 查询一个学员的详细信息
	 */
//	queryStudentDetails:function(traineeId){
//		 //$(".student-div .yt-table-active .trainee-id").val();
//		var studentDetailedMsg;
//		//获取班级编号
//		 var projectCode = $yt_common.GetQueryString("projectCode");
//		 //显示整体框架loading的方法
//		 $yt_baseElement.showLoading();
//		 $.ajax({
//		 	type:"post",
//		 	url:$yt_option.base_path + "class/trainee/getTraineeDetails",
//		 	data:{
//		 		traineeId:traineeId,
//		 		projectId:projectCode
//		 	},
//		 	async:false,
//		 	success:function(data){
//		 		if(data.flag==0){
//		 			studentDetailedMsg=data.data;
//		 			//隐藏整体框架loading的方法
//		 			$yt_baseElement.hideLoading();
//		 		}
//		 	}
//		 });
//		 return studentDetailedMsg;
//	},
	/**
	 * 缴费开票修改学员
	 */
	tickRepairStudent:function(traineeId){
		//获取班级编号
		 	var projectCode = $yt_common.GetQueryString("projectCode");
		 	//获取名字
		 	var realName=$('.ticket-class-student-form .class-student-name').val();
		 	//获取组号
		 	 var groupNum=$('.ticket-class-student-form .class-student-group-num').val();;
		 	 //获取性别
		 	 var gender=$('.ticket-class-student-form .class-student-name').parent().parent().nextAll().find('input[type="radio"]:checked').val();
		 	 //获取民族
		 	 var nationId=$('.ticket-class-student-form .student-nation').val();
		 	 //获取手机号
		 	 var phone=$('.ticket-class-student-form .class-student-phone').val();
		 	  //获取证件类型
		 	 var idType=$('.ticket-class-student-form .card-type').val();
		 	 //获取证件号
		 	 var idNumber=$('.ticket-class-student-form .id-number').val();
		 	 //获取集团
		 	 var groupId=$('.ticket-class-student-form .group-id-elementary').val();
		 	 //获取单位
		 	 var orgId=$('.ticket-class-student-form .org-id').val();
		 	 //获取部门
		 	 var deptName=$('.ticket-class-student-form .student-msg .dept-name').val();
		 	// 获取职位
		 	 var positionName="";
		 	 //获取发票类型
		 	 var invoiceType=$('.ticket-class-student-form .student-invoice-type').val();
		 	 //获取发票名称
		 	 var orgName=$('.ticket-class-student-form .student-invoice-name').val();
		 	 //获取识别号
		 	 var taxNumber=$('.ticket-class-student-form .student-invoice-duty').val();
		 	 //获取地址
		 	 var address=$('.ticket-class-student-form .student-invoice-address').val();
		 	 //获取电话
		 	 var telephoneProject=$('.ticket-class-student-form .student-invoice-phone').val();
		 	 //获取开户行
		 	 var registeredBank=$('.ticket-class-student-form .student-invoice-open-bank').val();
		 	 //获取账户
		 	 var account=$('.ticket-class-student-form .student-invoice-acc').val();
		 	 //出生年月
		 	 var dateBirth=$('.ticket-class-student-form .date-birth').val();
		 	 //获取单位类型
		 	 var orgType=$('.ticket-class-student-form .org-type').val();
		 	 //获取通信地址
		 	 var mailingAddress=$('.ticket-class-student-form .mailing-address').val();
		 	 //获取邮政编码
		 	 var postalCode=$('.ticket-class-student-form .postal-code').val();
		 	 //获取传真
		 	 var fax=$('.ticket-class-student-form .class-student-fax').val();
		 	 //获取入党时间
		 	 var partyDate=$('.ticket-class-student-form .party-date').val();
		 	 //获取全职教育
		 	 var educationTime=$('.ticket-class-student-form .education-time').val();
		 	 //获取全职教育-毕业院校及专业
		 	  var educationTimeClass=$('.ticket-class-student-form .education-time-class').val();
		 	   //获取在职教育
		 	  var serviceTime=$('.ticket-class-student-form .service-time').val();
		 	   //获取在职教育-毕业院校及专业
		 	  var serviceTimeClass=$('.ticket-class-student-form .service-time-class').val();
		 	    //获取电话号
		 	  var telephone=$('.ticket-class-student-form .telephone-project').val();
		 	     //获取电子邮件
		 	  var email=$('.ticket-class-student-form .class-student-email').val();
		 	     //获取工作时间
		 	  var workTime=$('.ticket-class-student-form .work-time').val();
		 	  if(phone!=""){
 	  			//显示整体框架loading的方法
	 			$yt_baseElement.showLoading();
			 	$.ajax({
			 		type:"post",
			 		url:$yt_option.base_path + "class/trainee/addOrUpdateTrainee",
			 		data:{
			 			traineeId:traineeId,
			 			projectCode:projectCode,
			 			realName:realName,
			 			groupNum:groupNum,
			 			gender:gender,
			 			nationId:nationId,
			 			phone:phone,
			 			idNumber:idNumber,
			 			groupId:groupId,
			 			orgId:orgId,
			 			deptName:deptName,
			 			positionName:positionName,
			 			invoiceType:invoiceType,
			 			orgName:orgName,
			 			taxNumber:taxNumber,
			 			address:address,
			 			telephoneProject:telephoneProject,
			 			registeredBank:registeredBank,
			 			account:account,
			 			idType:idType,
			 			dateBirth:dateBirth,
			 			orgType:orgType,
			 			mailingAddress:mailingAddress,
			 			postalCode:postalCode,
			 			fax:fax,
			 			partyDate:partyDate,
			 			educationTime:educationTime,
			 			educationTimeClass:educationTimeClass,
			 			serviceTime:serviceTime,
			 			serviceTimeClass:serviceTimeClass,
			 			telephone:telephone,
			 			email:email,
			 			workTime:workTime
			 		},
			 		async:true,
			 		success:function(data){
			 			if(data.flag==0){
			 				//隐藏整体框架loading的方法
			 				$yt_baseElement.hideLoading(function(){
		 						$yt_alert_Model.prompt("修改成功");
			 					//刷新页面
			 					studentReport.getStudentReport();
			 					 $(".ticket-class-student-form").hide();  
			 				});
			 			}else{
			 				//隐藏整体框架loading的方法
			 				$yt_baseElement.hideLoading(function(){
		 						$yt_alert_Model.prompt("修改失败");
			 					//刷新页面
			 					studentReport.getStudentReport();
			 					 $(".ticket-class-student-form").hide();  
			 				});
			 			}
			 		}
			 	});
		 	}else{
			 		
			 	}
	},
	/**
	 * 导入开票信息
	 */
}
/**
 * 请假管理
 */
var leaveTube={
	init:function(){
		//点击请假时间
		$('.leave-tube-div thead th ').eq(5).find('span').click(function(){
			var orderType=$(this).attr('orderType');
			console.log(orderType);
			if(orderType=='ASC'){
				$(this).attr('orderType','DESC');
				$(this).find('img').attr('src','../../resources/images/classStudent/pai-down.png');
			}else{
				$(this).attr('orderType','ASC');
				$(this).find('img').attr('src','../../resources/images/classStudent/pai-up.png');
			}
			var sort='start_time';
			
			leaveTube.leaveList(sort,orderType);
		});
		//点击提交时间
		$('.leave-tube-div thead th ').eq(6).find('span').click(function(){
			var orderType=$(this).attr('orderType');
			console.log(orderType);
			if(orderType=='ASC'){
				$(this).attr('orderType','DESC');
				$(this).find('img').attr('src','../../resources/images/classStudent/pai-down.png');
			}else{
				$(this).attr('orderType','ASC');
				$(this).find('img').attr('src','../../resources/images/classStudent/pai-up.png');
			}
			var sort='create_time';
			leaveTube.leaveList(sort,orderType);
		});
	},
	/**
	 * 查询请假单详情信息
	 */
	leaveList:function(sort,orderType){
			$('.leave-tube-div .page-info').pageInfo({
			async:true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			before:function(){
				$yt_baseElement.showLoading();
			},
			url: $yt_option.base_path + "class/traineeLeave/getClassTraineeLeave", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				sort: sort,
				orderType:orderType
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.leave-tube-div .leave-list-tbody');
					var htmlTr = '';
					htmlTbody.empty();
					if(data.data.rows.length > 0) {
						$('.leave-tube-div .page-info').show();
						$.each(data.data.rows, function(i, v) {
							if(v.gender==1){
								v.gender="男";
							}else if(v.gender==2){
								v.gender="女";
							}
							htmlTr='<tr>'+
							'<td></td>'+
							'<td>'+v.realName+'</td>'+
							'<td>'+v.gender+'</td>'+
							'<td>'+v.phone+'</td>'+
							'<td>'+v.orgName+'</td>'+
							'<td>'+v.leaveTime+'</td>'+
							'<td>'+v.createTimeString+'</td>'+
							'<td class="leave-resion">'+v.leaveDetails+'</td>'+
							'</tr>';
							htmlTbody.append(htmlTr);
						});
					
					} else {
						$('.leave-tube-div .page-info').hide();
						htmlTr = '<tr style="border:0px;background-color:#fff !important;" >' +
							'<td colspan="9" align="center" style="border:0px;">' +
							'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
							'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
							'</div>' +
							'</td>' +
							'</tr>';
							htmlTbody.append(htmlTr);
					}
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function (){
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	}
}
/**
 * 出勤管理
 */
var attendance={
	init:function(){
		//点击日期切换页签
	$('.attendance-div ').on('click','.switch-btn',function(){
		var switchNum=0;
		console.log($(this).index());
		var createTime=$(this).find('.switch-date').val();
		$(this).addClass('switch-btn-change').siblings().removeClass('switch-btn-change');
		if($(this).index()!=0){
			//获取每日的学员签到
			switchNum=1;
			attendance.getStudentDaySign(createTime);
		}else{
			//获取全员的签到
			attendance.getStudentSign();
		}
		$('.attendance-div .teacher-list-div').hide().eq(switchNum).show();
	});
	},
	/**
	 * 获取页签切换按钮
	 */
	getSwitchBtn:function(){
		debugger
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/traineeAttendance/getAttendanceDate",
			data:{
				projectCode:projectCode
			},
			async:true,
			success:function(data){
				var pageBtn=$('.attendance-div .page-switch');
				var switchBtn='';
				pageBtn.empty();
				if(data.flag==0){
					switchBtn+='<button class="yt-option-btn switch-btn switch-btn-change">全员状态</button>';
					$.each(data.data, function(i,v) {
						switchBtn+='<button class="yt-option-btn switch-btn">'+
									'<input type="hidden" class="switch-date" value="'+v.createTime+'"/>'+v.attendanceDate+'</button>';
						
					});
				pageBtn.append(switchBtn);
				//隐藏整体框架loading的方法
				$yt_baseElement.hideLoading();
				}else{
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
					console.log("页签查询失败");
				}
			}
		});
	},
	/**
	 * 获取学员签到全员信息
	 */
	getStudentSign:function(){
			//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		var selectParam=$('.attendance-div .key-word').val();
		var gender='';
		var nationId='';
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type:"post",
			url:$yt_option.base_path + " class/traineeAttendance/getTraineeAttendanceAll",
			data:{
			projectCode:projectCode,
			selectParam:selectParam,
			gender:gender,
			nationId:nationId
			},
			async:true,
			success:function(data){
				var htmlBody=$('.attendance-div .student-all-sign tbody');
				var htmlTr='';
				var classNum;
				htmlBody.empty();
				if(data.flag==0){
					if(data.data.length!=0){
						$.each(data.data, function(i,n) {
							if(n.gender==1){
								n.gender='男';
							}else{
								n.gender='女';
							}
							if(n.everyAttendance==n.totalAttendance){
								classNum='colour-blue';
							}else{
								classNum='colour-yellow';
							}
							htmlTr='<tr>'+
									'<td></td>'+
									'<td>'+n.realName+'</td>'+
									'<td>'+n.gender+'</td>'+
									'<td>'+n.nationName+'</td>'+
									'<td>'+n.phone+'</td>'+
									'<td>'+n.orgName+'</td>'+
									'<td>'+n.deptPosition+'</td>'+
									'<td class="'+classNum+'">'+n.everyAttendance+'/'+n.totalAttendance+'</td>'+
									'</tr>';
							htmlBody.append(htmlTr);
					});
					}else{
						htmlTr='<tr class="class-tr">'+
								'<td colspan="7" align="center" style="border:0px;">'+
									'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
									'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
									'</div>'+
									'</td>'+
									'</tr>';
					htmlBody.append(htmlTr);
					}
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
				}else{
					htmlTr='<tr class="class-tr">'+
						'<td colspan="7" align="center" style="border:0px;">'+
							'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
								'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
							'</div>'+
						'</td>'+
					'</tr>';
					htmlBody.append(htmlTr);
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						$yt_alert_Model.prompt("查询失败");
					});
				}
			}
		});
	},
	/**
	 * 获取每日学员签到信息
	 */
	getStudentDaySign:function(createTime){
	//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		var selectParam=$('.attendance-div .key-word').val();
		var gender='';
		var nationId='';
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/traineeAttendance/getTraineeAttendance",
			data:{
				projectCode:projectCode,
				createTime:createTime,
				selectParam:selectParam,
				gender:gender,
				nationId:nationId
			},
			async:true,
			success:function(data){
                 var htmlBody=$('.attendance-div .student-sign tbody');
                 var htmlSign='';
                 var className;
                 htmlBody.empty();
				if(data.flag==0){
					console.log("每日成功");
					if(data.data.length!=0){
						$.each(data.data, function(i,k) {
							if(k.isAttendance==1){
								k.isAttendance='签到';
								classNum='colour-blue';
							}else{
								k.isAttendance='未签到';
								classNum='colour-yellow';
							}
							if(k.gender==1){
								k.gender='男';
							}else{
								k.gender='女';
							}
							htmlSign='<tr>'+
								'<td></td>'+
								'<td>'+k.realName+'</td>'+
								'<td>'+k.gender+'</td>'+
								'<td>'+k.nationName+'</td>'+
								'<td>'+k.phone+'</td>'+
								'<td>'+k.orgName+'</td>'+
								'<td>'+k.deptPosition+'</td>'+
								'<td class="'+classNum+'">'+k.isAttendance+'</td>'+
								'</tr>';
							htmlBody.append(htmlSign);
						});
					}else{
						htmlSign='<tr class="class-tr">'+
								'<td colspan="7" align="center" style="border:0px;">'+
									'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
										'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
									'</div>'+
								'</td>'+
								'</tr>';
							htmlBody.append(htmlSign);
					}
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
				}else{
					htmlSign='<tr class="class-tr">'+
								'<td colspan="7" align="center" style="border:0px;">'+
									'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
										'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
									'</div>'+
								'</td>'+
								'</tr>';
							htmlBody.append(htmlSign);
							//隐藏整体框架loading的方法
							$yt_baseElement.hideLoading(function(){
								$yt_alert_Model.prompt("查询失败");
							});
				}
			}
		});
	}
}
/**
 * 结业证
 */
var certificateEnd={
	init:function(){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		//点击申请编号
		$('.certificate-end-div .apply-number-btn').click(function(){
			//获取申请编号的数据
			certificateEnd.applyNumberData();
			/** 
	         * 显示编辑弹出框和显示顶部隐藏蒙层 
	         */  
	        $(".certificate-end-div .graduation-form").show();  
	        /** 
	         * 调用算取div显示位置方法 
	         */  
	        $yt_alert_Model.getDivPosition($(".certificate-end-div .graduation-form"));  
	        /* 
	         * 调用支持拖拽的方法 
	         */  
	        $yt_model_drag.modelDragEvent($(".certificate-end-div .graduation-form .yt-edit-alert-title"));  
	        /** 
	         * 点击取消方法 
	         */  
	        $('.certificate-end-div .graduation-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
	            //隐藏页面中自定义的表单内容  
	            $(".certificate-end-div .graduation-form").hide();  
	        });  
		});
		//点击导出
		$('.certificate-end-div .certificate-upload-btn').click(function(){
			$.ajaxDownloadFile({
			url:$yt_option.base_path+"class/traineeCertificateNo/exportTraineeCertificateNoByClass",
			data:{
			projectCode:projectCode
			}
			});
		});
		//点击提交按钮
		$('.certificate-end-div .yt-eidt-model-bottom .yt-model-sure-btn').click(function(){
			certificateEnd.applyEndNum();
		});
	},
	//申请结业证编号
	applyEndNum:function(){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/traineeCertificateNo/updateTraineeCertificateNoByClass",
			data:{
				projectCode:projectCode
			},
			async:true,
			success:function(data){
				if(data.flag==0){
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						$yt_alert_Model.prompt("提交成功");
					});
				}else{
						//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading(function(){
						$yt_alert_Model.prompt("提交失败");
					});
				}
			}
		});
	},
	//申请结业证编号获取数据
	applyNumberData:function(){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/traineeCertificateNo/getTraineeCertificateNoByClass",
			data:{
				projectCode:projectCode	
			},
			async:true,
			success:function(data){
				var htmlBody=$(".certificate-end-div .apply-num-table");
				var htmlTr='';
				if(data.flag==0){
					console.log('编号成功');
					var applyData=data.data;
					//根据分配状态判断编号是否显示
					if(applyData[0].distributionStates!=0){
						$(".hiden-part").show();
						$('.certificate-end-div .yt-eidt-model-bottom .yt-model-sure-btn').hide();
						$('.certificate-end-div .yt-eidt-model-bottom .yt-model-canel-btn').val("关闭");
						$('.certificate-end-div .yt-eidt-model-bottom .yt-model-canel-btn').css('margin','0');
					}else{
						$(".hiden-part").hide();
					}
					if(applyData[0].projectType==1){
						applyData[0].projectType="计划";
					}else if(applyData[0].projectType==2){
						applyData[0].projectType="委托";
					}else if(applyData[0].projectType==3){
						applyData[0].projectType="选学";
					}else if(applyData[0].projectType==4){
						applyData[0].projectType="调训";
					}
					
					if(applyData[0].distributionStates==1){
						applyData[0].distributionStates="已分配";
					}if(applyData[0].distributionStates==2){
						applyData[0].distributionStates="待分配";
					}
					$(".certificate-end-div .graduation-form").setDatas(applyData[0]);
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
				}else{
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
				}
			}
		});
	},
	//获取结业证列表信息
	getCertificateList:function(){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
	  $('.certificate-end-div .table-page').pageInfo({  
	        pageIndex: 1,  
	        pageNum: 15, //每页显示条数  
	        before:function(){
	        	//显示整体框架loading的方法
	        	$yt_baseElement.showLoading();
	        },
            url: $yt_option.base_path + "class/traineeCertificateNo/getClassTrainee", //ajax访问路径  
            type: "post", //ajax访问方式 默认 "post"  
            async: true, //ajax 访问类型 默认 true 异步,false同步  
            data: {  
         		  projectCode:projectCode
            }, //ajax查询访问参数  
            objName: 'data', //指获取数据的对象名称
            success: function(data) {  
            	var htmlBody=$('.certificate-end-div .list-tbody');
            	var htmlGrad='';
               if(data.flag==0){
               	htmlBody.empty();
               	if(data.data.rows.length!=0){
               		 $('.certificate-end-div .table-page').show();
           			$.each(data.data.rows, function(i,q) {
           				if(q.gender==1){
           					q.gender='男';
           				}else if(q.gender==2){
           					q.gender="女";
           				}
		   				htmlGrad='<tr>'+
		               			'<td>'+q.groupNum+'</td>'+
		               			'<td><input type="hidden" value="'+q.traineeId+'" class="trainee-id"/><a href="#" class="real-name-inf" style=" color:blue;word-break: break-all;">'+q.realName+'</a></td>'+
		               			'<td>'+q.gender+'</td>'+
		               			'<td>'+q.phone+'</td>'+
		               			'<td>'+q.groupName+'</td>'+
		               			'<td>'+q.orgName+'</td>'+
		               			'<td>'+q.certificateNo+'</td>'+
		               			'</tr>';
	               		htmlGrad=$(htmlGrad).data("studentList",q);	
		               			htmlBody.append(htmlGrad);
		               		});
               	}else{
               		 $('.certificate-end-div .table-page').hide();
               		htmlGrad='<tr class="class-tr">'+
								'<td colspan="7" align="center" style="border:0px;">'+
									'<div class="no-data" style="width: 280px;margin: 0 auto;">'+
										'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">'+
									'</div>'+
								'</td>'+
							'</tr>';
					htmlBody.append(htmlGrad);
               	}
               	//隐藏整体框架loading的方法
               	$yt_baseElement.hideLoading();
               }else{
               	//隐藏整体框架loading的方法
               	$yt_baseElement.hideLoading(function(){
               		$yt_alert_Model.prompt("查询失败");
               	});
               }
            },  
        	isSelPageNum: true //是否显示选择条数列表默认false,  
    });
	}
}
/**
 * 学员反馈
 */
var feedBack={
	init:function(){
		//点击模糊查询
		$('.student-feedback-div .search-btn').off('click').on('click',function(){
			feedBack.getFeedBackList();
		});
		//点击导出按钮
		$('.student-feedback-div .certificate-upload-btn').click(function(){
			//班级编号
			var projectCode = $yt_common.GetQueryString("projectCode");
			//学员名字
			var traineeName=$(".student-feedback-div .yt-input.key-word").val();
			//是否评价
			var classCacsi='1,0';
			$.ajaxDownloadFile({
				url:$yt_option.base_path+"class/questionnaire/exportQuestionnaire",
				data:{
					projectCode:projectCode,
					traineeName:traineeName,
					classCacsi:classCacsi,
					isEffective:1
				}
			});
		});
		//点击每一行的查看详情
		$('.student-feedback-div').off('click').on('click','.back-look-details',function(){
			var traineeId=$(this).parents("tr").find('input').val();
			feedBack.getEveryStudentDeatils(traineeId);
			 /** 
	         * 显示编辑弹出框和显示顶部隐藏蒙层 
	         */  
	        $(".see-details-form").show();  
	        /* 
	         * 调用支持拖拽的方法 
	         */  
	        $yt_model_drag.modelDragEvent($(".see-details-form .yt-edit-alert-title"));  
	        /** 
	         * 点击取消方法 
	         */  
	        $('.see-details-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click", function() {  
	            //隐藏页面中自定义的表单内容  
	            $(".see-details-form").hide();  
	        });  
		});
	},
	/**
	 * 获取每个学员的详细信息
	 */
	getEveryStudentDeatils:function(traineeId){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		//显示整体框架loading的方法
		$yt_baseElement.showLoading();
			$.ajax({
				type:"post",
				url:$yt_option.base_path + "class/questionnaire/getTraineeQuestionnaire",
				data:{
					projectCode:projectCode,
					traineeId:traineeId
				},
				async:true,
				success:function(data){
					var htmlBody=$('.see-details-form .question-student');
					var indexNum=1;
					//var starNum=0;
					htmlBody.empty();
					if(data.flag==0){
						//循环大项
					$.each(data.data, function(i,m) {
						var detailsHtml='';
						detailsHtml+='<div><div class="problem-title-div" style="font-weight:bolder;font-size:16px">'+m.itemName+'</div>';
						if(m.itemsDetailsJson.length!=0){
							//循环问题
							$.each(m.itemsDetailsJson, function(a,s) {
								detailsHtml+='<div style="margin-left: 10px;" class="student-problem-div"><span>'+ indexNum++ +'、</span>'+s.title+'</div>';//问题的标题
									if(s.types==1){//问题类型为评分的
										detailsHtml+='<div style="margin-left: 30px;" class="star-num" data-scor="'+s.titleVakue+'"></div>';
									}else if(s.types==6){//问题类型为特殊处理的
										if(s.itemDetailsSpecific.length!=0){
											//循环问题选项
											$.each(s.itemDetailsSpecific, function(k,j) {
												detailsHtml+='<p>'+j.identification+'</p><span>:'+j.identificationValue+'</span>'
											});
										}
									}else if(s.types==2||s.types==3){//问题类型为单选或多选的
											detailsHtml+='<div style="margin-left: 30px;" class="problem-val-div">'+s.titleVakue+'</div>';
												 	
									}else if(s.types==4){//问题类型为开放的
										detailsHtml+='<p style="margin-left: 30px;">'+s.titleVakue+'</p>';
									}
							
							});	
						}
						detailsHtml+='</div>';
						htmlBody.append(detailsHtml);
					});	
					//循环添加星星
					$(".star-num").each(function(){
						$(this).raty({ 
							readOnly: true,
							score:function(){
								return $(this).attr('data-scor');
							},
							starOff:'../../resources/images/starImg/star-off.png',
							starOn:'../../resources/images/starImg/star-on.png '
						});
					});
			 /** 
	         * 调用算取div显示位置方法 
	         */  
	         $yt_alert_Model.setFiexBoxHeight($(".see-details-form .yt-edit-alert-main"));
	        $yt_alert_Model.getDivPosition($(".see-details-form"));  
					//隐藏整体框架loading的方法
					$yt_baseElement.hideLoading();
					}
				}
			});
			 
//			for (var i=0;i<=5;i++) {
//				detailsHtml='<div>'+
//				'<div class="problem-title-div">问题大标题'+i+'</div>'+
//				'<div id="score-demo'+i+'"></div>'+
//				'<div class="student-problem-div">问题小标题'+i+'</div>'+
//				'</div>';
//				htmlBody.append(detailsHtml);
//				$("#score-demo"+i+"").raty({ 
//					readOnly: true,
//					score:num,
//					starOff:'../../resources/images/starImg/star-off.png',
//					starOn:'../../resources/images/starImg/star-on.png '
//				});
//		}
	},
	/**
	 * 获取反馈列表的表头
	 */
	getBackListHead:function(){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		$.ajax({
			type:"post",
			url:$yt_option.base_path + "class/questionnaire/getQuestionnaireColumn",
			data:{
			projectCode:projectCode	
			},
			async:true,
			success:function(data){
				if(data.flag==0){
					var bacHead='';
					$(".backHeads").remove();
					$.each(data.data, function(i,n) {
						bacHead='<th class="backHeads" style="text-align: center;">'+n.columnName+'</th>';
						$(".back-phone").after(bacHead);
					});
					$(".feed-back-tbody").find('.class-tr td').attr('colspan',data.data.length+6);
				}else{
					
				}
			}
		});
	},
	/**
	 * 获取学员反馈列表数据
	 */
	getFeedBackList:function(){
		//班级编号
		var projectCode = $yt_common.GetQueryString("projectCode");
		var traineeName=$(".student-feedback-div .yt-input.key-word").val();
			var	designImplementationStart="";
			var	designImplementationEnd="";
			var	teachingEffectStart="";
			var	teachingEffectEnd="";
			var	teachingActivitesStart="";
			var	teachingActivitesEnd="";
			var	towslsStart="";
			var	towslsEnd="";
			var	learningeffectStart="";
			var	learningeffectEnd="";
			var	characteristicStart="";
			var	characteristicEnd="";
			var	classCacsi='0,1';
		$('.student-feedback-div .page-info').pageInfo({
			async:true,
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			before:function(){
				$yt_baseElement.showLoading();
			},
			url: $yt_option.base_path + "class/questionnaire/getClassTraineeList", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				projectCode: projectCode,
				traineeName: traineeName,
				designImplementationStart: designImplementationStart,
				designImplementationEnd: designImplementationEnd,
				teachingEffectStart: teachingEffectStart,
				teachingEffectEnd:teachingEffectEnd,
				teachingActivitesStart: teachingActivitesStart,
				teachingActivitesEnd: teachingActivitesEnd,
				towslsStart: towslsStart,
				towslsEnd: towslsEnd,
				learningeffectStart:learningeffectStart,
				learningeffectEnd:learningeffectEnd,
				characteristicStart:characteristicStart,
				characteristicEnd:characteristicEnd,
				classCacsi:classCacsi,
				isEffective:1
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				var feedBackBody=$(".feed-back-tbody");
				var feedHtml='';
				var num=1;
				if(data.flag == 0) {
					if(data.data.rows.length > 0) {
						$('.student-feedback-div .page-info').show();
						feedBackBody.empty();
						$.each(data.data.rows, function(i, v) {
							if(v.learningEffect==""){
								v.learningEffect="--";
							}
							if(v.towsls==""){
								v.towsls="--";
							}
							if(v.characteristic==""){
								v.characteristic="--";
							}
							if(v.criticismSuggestion==""){
								v.criticismSuggestion="--";
							}
							if(v.teacherRecommendation==""){
								v.teacherRecommendation="--";
							}
							if(v.designImplementation==""){
								v.designImplementation="--";
							}
							if(v.teachingEffect==""){
								v.teachingEffect="--";
							}
							feedHtml='<tr>'+
									'<input type="hidden" value="'+v.traineeId+'" />'+
									'<td>'+ num++ +'</td>'+
									'<td>'+v.traineeName+'</td>'+
									'<td>'+v.phone+'</td>'+
									'<td>'+v.learningEffect+'</td>'+
									'<td>'+v.towsls+'</td>'+
									'<td>'+v.characteristic+'</td>'+
									'<td>'+v.criticismSuggestion+'</td>'+
									'<td>'+v.teacherRecommendation+'</td>'+
									'<td>'+v.designImplementation+'</td>'+
									'<td>'+v.teachingEffect+'</td>';
									if(v.classCacsi==0){
										feedHtml+='<td>查看</td>'+
													'</tr>';
									}else{
										feedHtml+='<td><a class="back-look-details" style="color:#3c4687">查看</a></td>'+
													'</tr>';
									}
							feedBackBody.append(feedHtml);
						});
					}else{
						$('.student-feedback-div .page-info').hide();
					}
					$yt_baseElement.hideLoading();
				} else {
					$('.student-feedback-div .page-info').hide();
					$yt_baseElement.hideLoading(function (){
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	}
}
var ytDate = {
	//格局化日期：yyyy-MM-dd   
	formatDate: function(date) {
		var myyear = date.getFullYear();
		var mymonth = date.getMonth() + 1;
		var myweekday = date.getDate();

		if(mymonth < 10) {
			mymonth = "0" + mymonth;
		}
		if(myweekday < 10) {
			myweekday = "0" + myweekday;
		}
		return(myyear + "-" + mymonth + "-" + myweekday);
	},
	startStop: function(obj) {
		var me = this;
		var startStop = new Array();
		//获取当前时间    
		var currentDate = new Date(obj);
		var weekday = currentDate.getDay() || 7;
		currentDate.setDate(currentDate.getDate() - weekday - 1); //往前算（weekday-1）天，年份、月份会自动变化
		for(var i = 0; i < 7; i++) {
			currentDate.setDate(currentDate.getDate() + 1); //往前算（weekday-1）天，年份、月份会自动变化
			startStop.push(me.formatDate(currentDate));
		}
		return startStop;
	}
}

//百度地图插件
var positionMap = {
	ac: null,
	myValue: null,
	addMarkerState: true,
	mapObj: null,
	init: function(configData) {
		$("#l-map").empty();
		this.mapObj = new BMap.Map("l-map");
		this.mapObj.centerAndZoom("大连市甘井子区中国大连高级经理学院", 14); // 初始化地图,设置城市和地图级别。
		/*	var myCity = new BMap.LocalCity();
		myCity.get(function (result){
			var cityName = result.name;
			console.log(cityName);
			map.centerAndZoom(cityName,14);                   // 初始化地图,设置城市和地图级别。
		});*/
		this.mapObj.enableScrollWheelZoom(); //启用滚轮放大缩小，默认禁用
		this.mapObj.enableContinuousZoom(); //启用地图惯性拖拽，默认禁用
		// 添加定位控件
		this.ac = new BMap.Autocomplete( //建立一个自动完成的对象
			{
				"input": "suggestId",
				"location": this.mapObj
			});
		this.eventFun();
	},
	eventFun: function() {
		var me = this;
		me.ac.addEventListener("onhighlight", function(e) { //鼠标放在下拉列表上的事件
			var str = "";
			var _value = e.fromitem.value;
			var value = "";
			if(e.fromitem.index > -1) {
				value = _value.province + _value.city + _value.district + _value.street + _value.business;
			}
			str = "FromItem<br />index = " + e.fromitem.index + "<br />value = " + value;

			value = "";
			if(e.toitem.index > -1) {
				_value = e.toitem.value;
				value = _value.province + _value.city + _value.district + _value.street + _value.business;
			}
			str += "<br />ToItem<br />index = " + e.toitem.index + "<br />value = " + value;
			me.G("searchResultPanel").innerHTML = str;
		});

		me.ac.addEventListener("onconfirm", function(e) { //鼠标点击下拉列表后的事件
			var _value = e.item.value;
			myValue = _value.province + _value.city + _value.district + _value.street + _value.business;
			me.G("searchResultPanel").innerHTML = "onconfirm<br />index = " + e.item.index + "<br />myValue = " + myValue;

			me.setPlace();
		});

		/*this.mapObj.addEventListener("tilesloaded",function(e){
				if(me.addMarkerState){
					var myIcon  = new BMap.Icon("http://api.map.baidu.com/img/markers.png", new BMap.Size(23, 25), {  
	                    offset: new BMap.Size(10, 25), // 指定定位位置  
	                    imageOffset: new BMap.Size(0, 0 - 10 * 25) // 设置图片偏移  
	                });  

					me.marker = new BMap.Marker(me.mapObj.getCenter(),{icon: myIcon});// 创建标注
					me.mapObj.addOverlay(me.marker);             // 将标注添加到地图中	
					me.marker.enableDragging();  
					me.addMarkerState = false;
				}
				
			});*/
	},
	// 百度地图API功能
	G: function(id) {
		return document.getElementById(id);
	},
	setPlace: function() {
		var me = this;
		me.mapObj.clearOverlays(); //清除地图上所有覆盖物
		function myFun() {
			var pp = local.getResults().getPoi(0).point; //获取第一个智能搜索的结果
			me.mapObj.centerAndZoom(pp, 18);
			var myIcon = new BMap.Icon($yt_option.websit_path + "resources/images/img/blank.png", new BMap.Size(23, 25), {
				offset: new BMap.Size(10, 25), // 指定定位位置  
			});
			me.marker = new BMap.Marker(pp, {
				icon: myIcon
			});
			me.mapObj.addOverlay(me.marker); //添加标注

			me.marker.enableDragging();
		}
		var local = new BMap.LocalSearch(me.mapObj, { //智能搜索
			onSearchComplete: myFun
		});
		local.search(myValue);
	},
	getPosition: function() {
		return this.marker == undefined ? null : this.marker.getPosition();
	}
}
$(function() {
	//初始化方法
	caInfoList.init();
	//初始化课程模块
	courseManager.init();
	//初始化学员管理模块
	studentList.init();
	//初始化重复来院名单
	repeatCourtyardList.init();
	//初始化学员手册
	studentManual.init();
	//初始化接待通知
	receptionNotice.init();
	//初始化班级公告模块
	classBulletin.init();
	//初始化班级二维码模块
	classQrCode.init();
	//初始化学员报到模块
	studentReport.init();
	//初始化缴费开票
	payTicket.init();
	//初始化请假管理
	leaveTube.init();
	//初始化出勤管理
	attendance.init();
	//初始化结业证
	certificateEnd.init();
	//初始化学员反馈
	feedBack.init();
	//初始化百度地图
	positionMap.init();
});