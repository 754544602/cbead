var projectDetailsList={init:function(){var tp="";var tp=$yt_common.GetQueryString('tp');if(tp==1){$('.hid-title').hide();$('.hid-approva-box').hide()}$(".yt-select").niceSelect();$(".time-receipt").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:false,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".feedback-time").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:false,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".date-birth").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:false,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".party-date").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:false,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".work-time").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:false,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".discuss-date").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:false,dateFmt:"yyyy-MM-dd",callback:function(){}});var pkId=$yt_common.GetQueryString('pkId');var projectCode=$yt_common.GetQueryString('projectCode');var projectCodeList=$yt_common.GetQueryString('projectCodeList');var projectType=$yt_common.GetQueryString('projectType');$(".project-code").text(projectCodeList);if(projectType==2){projectDetailsList.getProjectInf();projectDetailsList.getApproveInf()}else{$(".hid-approva-box").hide();$(".hid-title").hide();projectDetailsList.getProjectInf()}$(".class-info-table input").attr("disabled","disabled");$(".tab-title-list button").click(function(){$(this).addClass("active").siblings().removeClass("active");$(".box-list .content-box").eq($(this).index()).show().siblings().hide()});$(".discuss-records").click(function(){projectDetailsList.getDiscussInf()});$(".btn-add").click(function(){$(".edit-discuss-alert-title").text("新增");$(".discuss-date").calendar();projectDetailsList.discussAdd();$(".add-discuss-alert .discuss-states").setSelectVal("");$(".add-discuss-alert .discuss-data").val("");$(".add-discuss-alert .linkman").val("");$(".add-discuss-alert .phone").val("");$(".add-discuss-alert .discussDetails").val("");$(".add-discuss-alert .train-cost").val("");$(".add-discuss-alert .course-cost").val("");$(".add-discuss-alert .stay-cost").val("");$(".add-discuss-alert .meal-cost").val("");$(".add-discuss-alert .other-cost").val("");$(".discuss-btn-sure .yt-model-sure-btn").off().on().click(function(){var discussId="";projectDetailsList.addDiscussList(discussId)})});$(".discuss-box").on('click','.discuss-editor',function(){$(".discuss-date").calendar();$(".edit-discuss-alert-title").text("编辑");projectDetailsList.discussAdd();var discussStates=$(this).parent().parent().parent().parent().parent().data("discussData").discussStates;var discussDate=$(this).parent().parent().parent().parent().parent().data("discussData").discussDate;var linkman=$(this).parent().parent().parent().parent().parent().data("discussData").linkman;var phone=$(this).parent().parent().parent().parent().parent().data("discussData").phone;var discussDetails=$(this).parent().parent().parent().parent().parent().data("discussData").discussDetails;var trainCost=$(this).parent().parent().parent().parent().parent().data("discussData").trainCost;var courseCost=$(this).parent().parent().parent().parent().parent().data("discussData").courseCost;var stayCost=$(this).parent().parent().parent().parent().parent().data("discussData").stayCost;var mealCost=$(this).parent().parent().parent().parent().parent().data("discussData").mealCost;var otherCost=$(this).parent().parent().parent().parent().parent().data("discussData").otherCost;var discussId=$(this).parent().parent().parent().parent().parent().data("discussData").discussId;$(".add-discuss-alert .discuss-states").setSelectVal(discussStates);$(".add-discuss-alert .discuss-data").val(discussDate);$(".add-discuss-alert .linkman").val(linkman);$(".add-discuss-alert .phone").val(phone);$(".add-discuss-alert .discussDetails").val(discussDetails);$(".add-discuss-alert .train-cost").val(trainCost);$(".add-discuss-alert .course-cost").val(courseCost);$(".add-discuss-alert .stay-cost").val(stayCost);$(".add-discuss-alert .meal-cost").val(mealCost);$(".add-discuss-alert .other-cost").val(otherCost);$(".yt-model-sure-btn").off().on().click(function(){projectDetailsList.addDiscussList(discussId)})});$(".discuss-box").on('click','.discuss-del',function(){var discussId=$(this).find("input.discussId").val();$('.hid-discuss-id').val(discussId);projectDetailsList.delDiscussList(discussId)});$('.discuss-box').on('click','.talk-over-with-submit',function(){var btn=$(this);var textareaNoe=$(this).parent().prev().find('.apprro-view');var discussId=$(this).parent().find('.hid-discuss-id').val();var details=$(this).parent().prev().find('.apprro-view').val();var pkId=$yt_common.GetQueryString('pkId');$.ajax({type:"post",url:$yt_option.base_path+"project/addOrUpdateDiscussIdea",data:{pkId:pkId,discussId:discussId,ideaType:"2",details:details},async:false,success:function(data){if(data.flag==0){btn.parent().hide();textareaNoe.attr("disabled",true);textareaNoe.css("border","none");textareaNoe.css("background","#FFF");projectDetailsList.getDiscussInf()}}})});$(".student-admin").click(function(){projectDetailsList.getStudentAdminList();var groupOnlyList=projectDetailsList.getListSelectGroup1("1");if(groupOnlyList!=null){$.each(groupOnlyList,function(i,n){$("select.group-id-elementary").append('<option value="'+n.groupId+'">'+n.groupName+'</option>')});$("select.group-id-elementary").off().change(function(){if($(this).val()!=''){$('div.group-id-elementary').removeClass('valid-hint');$(this).siblings('.valid-font').text('')}var groupList=projectDetailsList.getListSelectGroup1("2",$(this).val());if(groupList!=null){$("select.org-id").empty();$("select.org-id").append('<option value=" ">请选择</option>');$.each(groupList,function(i,n){if(i!=0){$("select.org-id").append('<option value="'+n.groupId+'">'+n.groupName+'</option>').data('types',n.types)}$('.orgType').text('')});$("select.org-id").niceSelect();$("select.org-id").off().change(function(){if($(this).val()!=''){$("div.org-id").removeClass('valid-hint');$(this).siblings('.valid-font').text('')}$('.orgType').text($(this).data('types'))})}})}$("select").niceSelect()});$(".check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".student-admin-tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}});$(".student-add").click(function(){projectDetailsList.studentAdd();$(".add-student .yt-model-sure-btn").click(function(){if($yt_valid.validForm($('.add-valid'))){projectDetailsList.addStudentList()}})});$(".student-amend").click(function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要修改的数据");return false}projectDetailsList.getStudentInf();$(".yt-edit-alert-title-msg").text("修改");projectDetailsList.studentAdd();$(".add-student .yt-model-sure-btn").click(function(){projectDetailsList.amendStudentList()})});$(".student-del").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要删除的数据");return false}projectDetailsList.delStudentList()});$(".log-list").off().click(function(){projectDetailsList.studentLog()});$('.exportList2').off().click(function(){if($('.student-admin-tbody input:checked').length==0){$yt_alert_Model.prompt("请选择需要推送的学员")}else{projectDetailsList.exportList()}});$(".student-lead").click(function(){projectDetailsList.studentLead();$(".lead-student .yt-model-sure-btn").off().click(function(){projectDetailsList.batchStudentLead()})});$(".download-template").off().click(function(){var file=$(".template-file").val();var fileName=getFileName(file);function getFileName(o){var pos=o.lastIndexOf("\\");return o.substring(pos+1)}var downUrl=$yt_option.base_path+"class/trainee/downloadTraineeByClass";$.ajaxDownloadFile({url:downUrl,data:{fileName:fileName,isDownload:true}})});$(".export-student-list").on("click",function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}var projectCode=$yt_common.GetQueryString('pkId');var exportName=$('.yt-table-active').data("legalData").exportName;var selectParam=$('.yt-table-active').data("legalData").selectParam;var gender=$('.yt-table-active').data("legalData").gender;var phone=$('.yt-table-active').data("legalData").phone;var groupId=$('.yt-table-active').data("legalData").groupId;var orgId=$('.yt-table-active').data("legalData").orgId;var deptPosition=$('.yt-table-active').data("legalData").deptPosition;var isFirstTraining=$('.yt-table-active').data("legalData").isFirstTraining;var classCommitteeId=$('.yt-table-active').data("legalData").classCommitteeId;var signUpState=$('.yt-table-active').data("legalData").signUpState;var downUrl=$yt_option.base_path+"teacher/exportTeacher";$.ajaxDownloadFile({url:downUrl,data:{projectCode:projectCode,exportName:exportName,selectParam:selectParam,gender:gender,phone:phone,groupId:groupId,orgId:orgId,deptPosition:deptPosition,isFirstTraining:isFirstTraining,classCommitteeId:classCommitteeId,signUpState:signUpState,isDownload:true}})});$(".btn-return").click(function(){window.history.back()});$(".add-charge").click(function(){var num=$(".charge-tbody tr:last").find('.addchargenum').text();num=Number(num);$(".charge-tbody").append('<tr><td style="text-align:center"><span class="addchargenum" style="margin-left:10px">'+(num+1)+'</span></td><td class="groupId"><select class="yt-select group-select" style="width:200px"><option value="">请选择</option></select></td><td><input class="yt-input trainingExpenseRackRate" type="text" validform="{isNull:true,blurFlag:true,type:/^[0-9]*$/,size:20}"/></td><td><input class="yt-input traineeRackRate" type="text" validform="{isNull:true,blurFlag:true,type:/^[0-9]*$/,size:20}"/></td><td><input class="yt-input quarterageRackRate" type="text" validform="{isNull:true,blurFlag:true,type:/^[0-9]*$/,size:20}"/></td><td><input class="yt-input mealFeeRackRate" type="text" validform="{isNull:true,blurFlag:true,type:/^[0-9]*$/,size:20}"/></td><td><input class="yt-input trainingExpenseNegotiatedPrice" type="text" validform="{isNull:true,blurFlag:true,type:/^[0-9]*$/,size:20}"/></td><td><input class="yt-input traineeNegotiatedPrice" type="text" validform="{isNull:true,blurFlag:true,type:/^[0-9]*$/,size:20}"/></td><td><input class="yt-input quarterageNegotiatedPrice" type="text" validform="{isNull:true,blurFlag:true,type:/^[0-9]*$/,size:20}"/></td><td><input class="yt-input mealFeeNegotiatedPrice" type="text" validform="{isNull:true,blurFlag:true,type:/^[0-9]*$/,size:20}"/></td><td align="center"><a href="#" class="editor-charge">编辑</a></td><td align="center"><span style=""><img src="../../resources/images/icons/cost-level.png" class="del-charge" alt="" /></span></td></tr>');var groupList=projectDetailsList.getListSelectGroup();if(groupList!=null){$.each(groupList,function(i,n){$(".group-select").append('<option value="'+n.groupId+'">'+n.groupName+'</option>')})}$(".group-select").niceSelect()});$(".charge-tbody").on('click','.del-charge',function(){$(this).parent().parent().parent().remove();$.each($('.charge-tbody tr'),function(i,n){var num=$(n).index()+1;$(n).find('.addchargenum').text(num)})});$(".charge-tbody").on('click','.editor-charge',function(){projectDetailsList.billingInf();$(".invoice-inf .sub-invoice").click(function(){projectDetailsList.savebillingInf()})});$(".charge-standard").click(function(){projectDetailsList.getStudentCostInf();projectDetailsList.getUnitCostInf();$(".stop-charging").click(function(){$(this).parent().parent().parent().find("table.list-table").hide()});$(".enable-the-charge").click(function(){$(this).parent().parent().parent().find("table.list-table").show()});$('.btn-charge').on('click','.btn-sub-charge',function(){var bool=true;$.each($('select.group-select'),function(i,n){if($(n).val()==''){bool=false}});if(bool){if($yt_valid.validForm($('.charge-tbody'))&&$yt_valid.validForm($('.personal-standard'))){projectDetailsList.saveChargeStandard();projectDetailsList.getStudentCostInf();$(".btn-sub-charge").text('编辑');$('.charge-tbody input').attr('readonly','readonly');$('.charge-tbody input').css('border','none');$('.personal-standard input').attr('readonly','readonly');$('.personal-standard input').css('border','none');$('.unit-tfoot').css('display','none');$('div.group-select').css('display','none');$('select.group-select').css({'display':'block','border':'none','color':'#333333 !important'});$('select.group-select').attr('disabled','disabled');$(".btn-sub-charge").attr('class','yt-option-btn btn-move-charge')}else{$yt_alert_Model.prompt("请将信息填写完整")}}else{$yt_alert_Model.prompt("请选择增加的集团名称")}});$('.btn-charge').on('click','.btn-move-charge',function(){$(this).text('确定');$('.charge-tbody input').attr('readonly',' ');$('.charge-tbody input').css('border','1px solid #DFE6F3');$('.personal-standard input').attr('readonly',' ');$('.personal-standard input').css('border','1px solid #DFE6F3');$('.unit-tfoot').removeAttr('style');$('div.group-select').css('display','block');$('select.group-select').css({'display':'none','border':'none'});$('select.group-select').attr('disabled',' ');$(this).attr('class','yt-option-btn btn-sub-charge')});$(".update-trainee-details").click(function(){projectDetailsList.updateTraineeDetails()})});$(".teaching-plan").click(function(){projectDetailsList.getTeachPlanDesignRequirements()});$(".btn-teach-plan-submit").click(function(){var dataStates=1;projectDetailsList.teachPlanDesignRequirements(dataStates)});$(".btn-teach-plan-save").click(function(){var dataStates=0;projectDetailsList.teachPlanDesignRequirements(dataStates)});var nationsList=projectDetailsList.getListSelectNations();if(nationsList!=null){$.each(nationsList,function(i,n){$("select.nation-id").append('<option value="'+n.nationId+'">'+n.nationName+'</option>')})}$("select.nation-id").niceSelect();$('.search-btn').click(function(){projectDetailsList.getStudentAdminList()});$(".student-admin-tbody").on('click','.real-name-alert-details',function(){projectDetailsList.getStudentInf();projectDetailsList.elementaryStudentDetailsAlert();$(".shut-down").click(function(){$(".elementary-student-details").hide()})});$(".file-upload").off().undelegate().delegate("input","change",function(){var addFile=$(this).attr("id");$yt_baseElement.showLoading();var url=$yt_option.acl_path+"api/tAscPortraitInfo/addFile";$.ajaxFileUpload({url:url,type:"post",data:{modelCode:"teachPlan"},dataType:'json',fileElementId:addFile,success:function(data,textStatus){var resultData=$.parseJSON(data);if(resultData.success==0){$yt_alert_Model.prompt("附件上传成功");$(".file-id").empty();$(".file-id").append('<p style="width:870px;height:40px;border:1px dashed #e6e6e6;line-height:40px;"><span class="file-name" style="margin-right: 50px;color:blue;cursor: pointer"><input type="hidden" class="file-span-id" value="'+resultData.obj.pkId+'" >'+resultData.obj.naming+'</span><span class="del-file-p" style="float:right;cursor: pointer;"><img src="../../resources/images/icons/teach-plan-del.png" alt="" />删除</span><span class="down-load-file-index" style="float:right;cursor: pointer;"><img src="../../resources/images/icons/down-load-teach-plan.png" alt="" />下载</span><span style="float:right; display:none;"><img src="../../resources/images/icons/preview.png" alt="" />预览</span></p>')}else{$yt_alert_Model.prompt("附件上传失败")}$yt_baseElement.hideLoading()},error:function(data,status,e){$yt_alert_Model.prompt("附件上传失败");$yt_baseElement.hideLoading()}})});$(".file-id").on("click",".down-load-file-index",function(){var downUrl=$('.down-file-url').val();$.ajaxDownloadFile({url:downUrl})});$(".down-load-template").click(function(){var pkId=$(".file-span-id").val();var downUrl=$yt_option.base_path+"project/downloadTeachingScheme";$.ajaxDownloadFile({url:downUrl,data:{fileName:""}})});$(".file-id").on("click",".del-file-p",function(){$(this).parent().remove()});$('.btn-teach-plan-end-cancel').click(function(){$(".file-id").empty()});$('.btn-teach-plan-end-cancel').click(function(){$(".last-file-id").empty()});$(".last-file-upload").undelegate().delegate("input","change",function(){var addFile=$(this).attr("id");$yt_baseElement.showLoading();var url=$yt_option.acl_path+"api/tAscPortraitInfo/addFile";$.ajaxFileUpload({url:url,type:"post",data:{modelCode:"teachPlan"},dataType:'json',fileElementId:addFile,success:function(data,textStatus){var resultData=$.parseJSON(data);if(resultData.success==0){$yt_alert_Model.prompt("附件上传成功");$(".last-file-id").empty();$(".last-file-id").append('<p style="width:870px;height:40px;border:1px dashed #e6e6e6;line-height:40px;"><span class="file-name" style="margin-right: 50px;color:blue;cursor: pointer"><input type="hidden" class="file-span-id" value="'+resultData.obj.pkId+'" >'+resultData.obj.naming+'</span><span class="del-file-p" style="float:right;cursor: pointer;"><img src="../../resources/images/icons/teach-plan-del.png" alt="" />删除</span><span class="down-load-file-index" style="float:right;cursor: pointer;"><img src="../../resources/images/icons/down-load-teach-plan.png" alt="" />下载</span><span style="float:right; display:none;"><img src="../../resources/images/icons/preview.png" alt="" />预览</span></p>')}else{$yt_alert_Model.prompt("附件上传失败")}$yt_baseElement.hideLoading()},error:function(data,status,e){$yt_alert_Model.prompt("附件上传失败");$yt_baseElement.hideLoading()}})});$(".btn-teach-plan-star-submit").click(function(){projectDetailsList.firstDraftByProjectDirector(1)});$(".btn-teach-plan-end-submit").click(function(){projectDetailsList.firstDraftByProjectDirector(2)});$(".check-label input[type='radio']").change(function(){var rad=$(this).val();if(rad=="completed"){if($('.hid-tast-key').val()!="activitiEndTask"){$('.hid-input').show()}else{$('.hid-input').hide()}}else{$('#nextPeople').val("");$('.hid-input').hide()}});$(".project-radio input[type='radio']").change(function(){var rad=$(this).val();if(rad=="completed"){if($('.hid-tast-key').val()=="activitiEndTask"){projectDetailsList.setPrincipal();var alertProjectType=$(".get-project-type").text();$(".project-name").text($(".project-title-center").text());$(".project-type").text(alertProjectType);$(".set-principal-alert .yt-model-sure-btn").click(function(){projectDetailsList.setHeadAlert()});$('.hid-input').hide()}else{$('.hid-input').show()}};if(rad=="returnedSubmit"){$('#nextPeople').val(" ");$('.hid-input').hide()}});$('.back-btn').click(function(){window.history.back()});$('.appro-submit-teach').click(function(){var processInstanceId=$('.hid-process-instance-id').val();var projectId=$yt_common.GetQueryString('pkId');var dealingWithPeople=$('.next-people-teach').val();var tastKey=$('.tast-key-teach').val();if(tastKey=="activitiEndTask"){dealingWithPeople=""}var opintion=$('.opintion-teach').val();var nextCode=$('input[name="radioType"]:checked ').val();if(nextCode=="returnedSubmit"){dealingWithPeople=""}$.ajax({type:"post",url:$yt_option.base_path+"project/updateTeachingSchemeApply",data:{projectId:projectId,businessCode:"teachingsSchemeLevel",dealingWithPeople:dealingWithPeople,opintion:opintion,processInstanceId:processInstanceId,nextCode:nextCode},success:function(data){if(data.flag==0){window.location.href="teachingDesignApproveList.html"}}})});$('.appro-cancel-teach').click(function(){window.location.href="teachingDesignApproveList.html"});$('.appro-submit').click(function(){if($('#nextPeople').val()=='no'&&$('.next-operate-person-tr').css('display')!='none'){$yt_alert_Model.prompt("请选择下一步操作人")}else{var processInstanceId=$('.hid-process-instance-id').val();var pkId=$yt_common.GetQueryString('pkId');var projectCode=$yt_common.GetQueryString('projectCode');var dealingWithPeople=$('#nextPeople').val();var tastKey=$('.hid-tast-key').val();if(tastKey=="activitiEndTask"){dealingWithPeople=""}var opintion=$('#opintion').val();var nextCode=$('input[name="radioType"]:checked ').val();if(nextCode=="returnedSubmit"){dealingWithPeople=""}$.ajax({type:"post",url:$yt_option.base_path+"project/updateApply",data:{pkId:pkId,projectCode:projectCode,businessCode:"project",dealingWithPeople:dealingWithPeople,opintion:opintion,processInstanceId:processInstanceId,nextCode:nextCode},success:function(data){if(data.flag==0){window.history.back()}}})}});$('.appro-cancel').click(function(){window.location.href="projectList.html"})},projectStateStepFn:function(dataArr){var projectStates=$yt_common.GetQueryString('projectState');console.log(dataArr);$('.project-first-step p').text(dataArr[0].createTimeString);function secondStep(){$('.seconed-step-blue').show();$('.seconed-step-grey').hide();if(dataArr[0].approvalTimeString==''||dataArr[0].approvalTimeString==null){}else{dataArr[0].approvalTimeString=dataArr[0].approvalTimeString.split(' ')[0];$('.project-second-step p').text(dataArr[0].approvalTimeString)}}function fourthStep(){$('.fourth-step-blue').show();$('.fourth-step-grey').hide();$('.project-fourth-step p').text(dataArr[0].startDate)}function fifthStep(){$('.fifth-step-blue').show();$('.fifth-step-grey').hide();$('.project-fifth-step p').text(dataArr[0].endDate)}function thirdStep(){$('.third-step-blue').show();$('.third-step-grey').hide();$('.project-third-step p').text(dataArr[0].applyTime);var applyTime=new Date(dataArr[0].applyTime);var feedbackTime=new Date(dataArr[0].feedbackTime);if(applyTime.getTime()>feedbackTime.getTime()){var date1=feedbackTime;var date2=applyTime;var date3=date2.getTime()-date1.getTime();var days=Math.floor(date3/(24*3600*1000));var leave1=date3%(24*3600*1000);var hours=Math.floor(leave1/(3600*1000));var leave2=leave1%(3600*1000);var minutes=Math.floor(leave2/(60*1000));var leave3=leave2%(60*1000);var seconds=Math.round(leave3/1000);var loadTime=" 相差 "+days+"天 "+hours+"小时 "+minutes+" 分钟"+seconds+" 秒";$('.project-third-step span').text('已停滞'+loadTime)}}if(projectStates==4){secondStep()}if(projectStates==5){secondStep();fourthStep()}if(projectStates==7){secondStep();fourthStep();fifthStep()}if(dataArr[0].applyTime!=''){thirdStep()}},userInfo:function(){$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsersDetails",data:{},success:function(data){$('.hid-user-real-name').val(data.data.userRealName)}})},getListSelectGroup:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/group/getGroups",data:{isSelectGroup:'2',groupId:""},async:false,success:function(data){list=data.data||[]}});return list},getListSelectGroup1:function(isSelectGroup,groupId){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/group/getGroups",data:{isSelectGroup:isSelectGroup,groupId:groupId},async:false,success:function(data){list=data.data||[]}});return list},getListSelectNations:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/getNations",data:{searchParameters:""},async:false,success:function(data){list=data.data||[]}});return list},getProjectInf:function(){$yt_baseElement.showLoading();projectDetailsList.userInfo();var projectType=$yt_common.GetQueryString('projectType');var pkId=$yt_common.GetQueryString('pkId');var dataArr=[];$.ajax({type:"post",url:$yt_option.base_path+"project/getBeanById",data:{pkId:pkId},success:function(data){if(data.flag==0){var dataArrJson={createTimeString:data.data.createTimeString,approvalTimeString:data.data.approvalTimeString,feedbackTime:data.data.feedbackTime,applyTime:data.data.applyTime,startDate:data.data.startDate,endDate:data.data.endDate};dataArr.push(dataArrJson);projectDetailsList.projectStateStepFn(dataArr);$('.hid-project-sell-name').val(data.data.projectSellName);$('.hid-project-head-name').val(data.data.projectHeadName);$(".project-title-center").text(data.data.projectName);$(".get-project-inf").setDatas(data.data);$('.project-sell-name').val(data.data.projectSellName);$('.project-head').val(data.data.projectHead);if(projectType==2){$(".approve-over-project-code").text("")}else{$(".approve-over-project-code").text(data.data.projectCode)}var flowLog;if(data.data.flowLog==''){$('.btn-teach-plan-submit').off();$('.btn-teach-plan-submit').css('background-color','#797979');$('.project-appro-btn-box').hide()}else{flowLog=JSON.parse(data.data.flowLog)}if(flowLog!=null&&flowLog.length>0){if(flowLog[0].tastKey=="activitiEndTask"&&flowLog[0].deleteReason!=""){$(".approve-over-project-code").text(data.data.projectCode)}else{$(".approve-over-project-code").text("")}}if(data.data.projectType==1){$(".project-type").text("计划")}else if(data.data.projectType==2){$(".project-type").text("委托")}else if(data.data.projectType==3){$(".project-type").text("选学");$(".applicant-info-hide,.discuss-records").hide()}else if(data.data.projectType==4){$(".project-type").text("调训")}$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("获取失败");$yt_baseElement.hideLoading()}}})},setHeadAlert:function(){var projectCode=$('.yt-table-active').data("legalData").projectCode;var userList="";var userListArr=[];$(".set-principal-alert .set-principal-alert-select").each(function(i,n){types=$(n).find("select.types option:selected").attr("types");typesData=$(n).find("select.types option:selected").val();var arrUserList={types:types,typesData:typesData};userListArr.push(arrUserList)});var userList=JSON.stringify(userListArr);$.ajax({type:"post",url:$yt_option.base_path+"project/updateProjectPrincipal",data:{projectCode:projectCode,userList:userList},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("操作成功");$(".set-principal-alert").hide()}else{$yt_alert_Model.prompt("操作失败");$(".set-principal-alert").hide()}}})},setPrincipal:function(){$(".set-principal-alert").show();$yt_alert_Model.getDivPosition($(".set-principal-alert"));$yt_model_drag.modelDragEvent($(".set-principal-alert .yt-edit-alert-title"));$('.set-principal-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".set-principal-alert").hide();$("#pop-modle-alert").hide()})},getApproveInf:function(){$yt_baseElement.showLoading();var pkId=$yt_common.GetQueryString('pkId');var approve=$yt_common.GetQueryString('approve');$.ajax({type:"post",url:$yt_option.base_path+"project/getBeanById",data:{pkId:pkId},success:function(data){if(data.data!=null){if(data.data.projectType==2){$('.hid-process-instance-id').val(data.data.processInstanceId);if(data.data.flowLog==""||data.data.flowLog==null){}else{$('.hid-title').show();$('.hid-approva-box').show();if(data.flag==0){var flowLog=JSON.parse(data.data.flowLog);var middleStepHtml;var length=flowLog.length;$.each(flowLog,function(i,v){if(i==0){if(flowLog.length>2&&flowLog[1].deleteReason=="returnedSubmit"){$('.last-step-project-div').hide();$('.project-appro-btn-box').hide()}if(v.tastKey=="activitiEndTask"&&v.deleteReason!=""){$('.project-appro-btn-box').hide()}if(v.userName!=$('.hid-user-real-name').val()){$('.last-step-project-div').hide();$('.project-appro-btn-box').hide()}if(approve==1){$('.last-step-project-div').hide();var order=length-i;middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+v.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+v.operationState+'</span></li><li class="view-time-li middle-step-commentTime" >'+v.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment" style="padding-left:10px;">'+v.comment+'</div></li></ul></div></div>';$('.last-step-add-project').append(middleStepHtml)}else{if((v.tastKey=="activitiEndTask"&&v.deleteReason=="")){$('.next-operate-person-tr').hide();$('.hid-tast-key').val(v.tastKey);$('.last-step-order').text(length);$('.last-step-operate-person-userName').text(v.userName);$('.last-step-operationState').text(v.operationState);$('.last-step-commentTime').text(v.commentTime)}else{$('.hid-tast-key').val(v.tastKey);$('.last-step-order').text(length);$('.last-step-operate-person-userName').text(v.userName);$('.last-step-operationState').text(v.operationState);$('.last-step-commentTime').text(v.commentTime)};if(v.tastKey=="activitiEndTask"&&v.deleteReason!=""){$('.last-step-project-div').hide();var order=length-i;middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+v.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+v.operationState+'</span></li><li class="view-time-li middle-step-commentTime" >'+v.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment" style="padding-left:10px;">'+v.comment+'</div></li></ul></div></div>';$('.last-step-add-project').append(middleStepHtml)}}};if(i==length-1){$('.first-step-order').text(1);$('.first-step-operate-person-userName').text(v.userName);$('.first-step-taskName').text(v.operationState);$('.first-step-commentTime').text(v.commentTime)};if(i!=0&&i<length-1){var order=length-i;middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+v.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+v.operationState+'</span></li><li class="view-time-li middle-step-commentTime" >'+v.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment" style="padding-left:10px;">'+v.comment+'</div></li></ul></div></div>';$('.last-step-add-project').append(middleStepHtml)}});$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("获取失败");$yt_baseElement.hideLoading()}}}else{$('.hid-title').hide();$('.hid-approva-box').hide();$('.project-appro-btn-box').hide()}}var nextPersonList=projectDetailsList.getworkFlowOperateTeach('project');if(nextPersonList!=null){$.each(nextPersonList,function(i,n){$("#nextPeople").append('<option value="'+n.userCode+'">'+n.userName+'</option>')})};$("#nextPeople").niceSelect()}})},getDiscussInf:function(){$yt_baseElement.showLoading();var pkId=$yt_common.GetQueryString('pkId');$.ajax({type:"post",url:$yt_option.base_path+"project/getDiscuss",data:{pkId:pkId},success:function(data){if(data.flag==0){var htmlDiscuss=$(".discuss-box");var htmlIndex="";var num=1;$(htmlDiscuss).empty();if(data.data.length>0){$.each(data.data,function(i,v){var createUsername="";var details="";var deleEdit="";var ideaJsonArr=JSON.parse(v.ideaJson);if(i==data.data.length-1){deleEdit='<button class="yt-option-btn discuss-editor">编辑</button><button class="yt-option-btn discuss-del"><input type="hidden" value="'+v.discussId+'" class="discussId">删除</button>'}if(ideaJsonArr.length==0){discuinfo='<table style="width:100%;"><tr><td colspan="2" style="height:30px;padding-bottom: 15px;"><p style="width:82px;height:30px;line-height:30px;text-align:center; background: #5B66AB url(../../resources/images/icons/left-top.png) no-repeat;color:#FFF;color:#FFF;">审核意见</p></td></tr><tr><td valign="top" style="width:85px;text-align:right;">审核意见：</td><td ><textarea class="apprro-view" style="min-height: 50px; width: 860px;resize:none;"></textarea></td></tr></table><div class="yt-eidt-model-bottom" style="text-align: center;margin: 10px 0px;"><input class="hid-discuss-id" type="hidden" value="'+v.discussId+'" /><input class="yt-model-bot-btn yt-model-sure-btn talk-over-with-submit" type="button" value="提交" /><input class="yt-model-bot-btn yt-model-canel-btn talk-over-with-cancel" type="button" value="取消" style="margin-left: 20px;" /></div>'}else{createUsername=ideaJsonArr[0].createUsername;details=ideaJsonArr[0].details;discussDate=ideaJsonArr[0].createTimeString;var discuinfo='<table style="width:100%;box-shadow: 0px 2px 1px #DDD;"><tr><td colspan="2" style="height:30px;padding-bottom: 15px;"><p style="width:82px;height:30px;line-height:30px;text-align:center; background: #5B66AB url(../../resources/images/icons/left-top.png) no-repeat;color:#FFF;color:#FFF;">审核意见</p></td></tr><tr><td style="height:35px;width:100px;text-align:right;line-heigth:35px;">审核人：</td><td class="create-username" style="text-align:left;">'+createUsername+'<span style="margin-left:100px ;">'+discussDate+'</span></td></tr><tr><td valign="top" style="width:100px;text-align:right;">审核意见：</td><td ><p class="details-p" style="min-height:50px;">'+details+'</p></td></tr></table>'}var discussStates="";if(v.discussStates==1){discussStates="咨询"}else if(v.discussStates==2){discussStates="在谈"}else if(v.discussStates==3){discussStates="意向"}else if(v.discussStates==4){discussStates="方案"}else if(v.discussStates==5){discussStates="调整"}else if(v.discussStates==6){discussStates="签约"}else if(v.discussStates==7){discussStates="咨询"}else{discussStates="取消"}htmlIndex='<div class="class-info-centent discuss-index" style="margin:0px 0px 0px 5px;"><div class="class-info-title" style="margin-bottom: 15px;"><div class="discuss-info-div"><p class="steps-num"><span style="color:#de595a;">'+num++ +'</span></p><div class="class-info-name" style="color:#de595a;border:none;"><img class="discuss-steps" src="../../resources/images/icons/discuss-steps-red.png"><span style="display: inline-block;margin-bottom: 0px;">洽谈详情</span><div class="discuss-btn">'+deleEdit+'</div></div></div></div><div style="background:#FFF;padding:1px 0px 10px 0px;margin-bottom:10px;"><table class="class-info-table" style="margin:20px auto;"><tr><td align="right" valign="top"><span>洽谈状态：</span></td><td valign="top"><p class="discuss-states" data-val="discussStates" style="width: 120px;">'+discussStates+'</p></td><td align="right" valign="top"><span>洽谈日期：</span></td><td valign="top"><p class="discuss-date" data-val="discussDate" style="width: 120px;">'+v.discussDate+'</p></td><td align="right" valign="top"><span>联系人：</span></td><td valign="top"><p class="linkman" data-val="linkman" style="width: 120px;">'+v.linkman+'</p></td><td align="right" valign="top"><span>联系电话：</span></td><td valign="top"><p class="phone" data-val="phone" style="width: 120px;">'+v.phone+'</p></td></tr><tr><td align="right" valign="top"><span>洽谈内容：</span></td><td colspan="7" valign="top"><p class="discussDetails" data-val="discussDetails" style="width:720px;height: auto;word-break: break-all;word-wrap: break-word">'+v.discussDetails+'</p></td></tr>'+'</table><div style="width: 990px;border:1px solid #DDD;margin: 0px auto;box-shadow: 0px 1px 1px #DDD;"><p style="width:82px;height:30px;line-height:30px;text-align:center; background: #5B66AB url(../../resources/images/icons/left-top.png) no-repeat;color:#FFF;">报价情况</p><table style="width: 100%;margin: 15px;"><tbody><tr><td style="text-align:right;width:70px;">培训费：</td><td class="train-cost" data-val="trainCost">'+v.trainCost+'</td><td style="text-align:right;">课程费：</td><td class="course-cost" data-val="courseCost">'+v.courseCost+'</td><td style="text-align:right;">住宿费：</td><td class="stay-cost" data-val="stayCost">'+v.stayCost+'</td><td style="text-align:right;">餐费：</td><td class="meal-cost" data-val="mealCost">'+v.mealCost+'</td><td style="text-align:right;">其他费用：</td><td class="other-cost" data-val="otherCost" style="width: 190px;">'+v.otherCost+'</td></tr></tbody></table></div><div style="margin:10px 70px;border:1px solid #ECECEC;">'+discuinfo+'</div></div>';'</div>';htmlDiscuss.append($(htmlIndex).data("discussData",v))})}$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("获取失败");$yt_baseElement.hideLoading()}}})},addDiscussList:function(discussId){var projectId=$yt_common.GetQueryString('pkId');var discussStates=$(".alert-add-discuss .discuss-states").val();var discussDate=$(".alert-add-discuss .discuss-date").val();var linkman=$(".alert-add-discuss .linkman").val();var phone=$(".alert-add-discuss .phone").val();var discussDetails=$(".alert-add-discuss .discussDetails").val();var trainCost=$(".alert-add-discuss .train-cost").val();var courseCost=$(".alert-add-discuss .course-cost").val();var stayCost=$(".alert-add-discuss .stay-cost").val();var mealCost=$(".alert-add-discuss .meal-cost").val();var otherCost=$(".alert-add-discuss .other-cost").val();$.ajax({type:"post",url:$yt_option.base_path+"project/addOrUpdateDiscuss",data:{projectId:projectId,discussId:discussId,discussStates:discussStates,discussDate:discussDate,linkman:linkman,phone:phone,discussDetails:discussDetails,trainCost:trainCost,courseCost:courseCost,stayCost:stayCost,mealCost:mealCost,otherCost:otherCost},success:function(data){if(data.flag==0){if(discussId==""){$yt_alert_Model.prompt("新增成功");projectDetailsList.getDiscussInf()}else{$yt_alert_Model.prompt("修改成功");projectDetailsList.getDiscussInf()}$(".yt-edit-alert").hide()}else{if(discussId==""){$yt_alert_Model.prompt("新增失败");projectDetailsList.getDiscussInf()}else{$yt_alert_Model.prompt("修改失败");projectDetailsList.getDiscussInf()}}}})},delDiscussList:function(discussId){$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"project/deleteDiscuss",data:{discussId:discussId},success:function(data){if(data.flag==0){var deleEditDiv=$('.discuss-box').children("div:last-child").find('.discuss-btn');deleEdit='<button class="yt-option-btn discuss-editor">编辑</button><button class="yt-option-btn discuss-del"><input type="hidden" value="'+discussId+'" class="discussId">删除</button>';deleEditDiv.append(deleEdit);$yt_alert_Model.prompt("删除成功");projectDetailsList.getDiscussInf()}else{$yt_alert_Model.prompt("不能删除")}}})}})},discussAdd:function(){$(".lawyer-opinion-box").show();$yt_alert_Model.getDivPosition($(".lawyer-opinion-box"));$yt_alert_Model.setFiexBoxHeight($(".alert-add-discuss form"));$yt_model_drag.modelDragEvent($(".lawyer-opinion-box .yt-edit-alert-title"));$('.lawyer-opinion-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".lawyer-opinion-box").hide();$("#pop-modle-alert").hide()})},getStudentAdminList:function(){var selectParam=$(".selectParam").val();var projectCode=$yt_common.GetQueryString('projectCode');$yt_baseElement.showLoading();$('.student-admin-page').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/trainee/getClassTraineeManager",type:"post",data:{projectCode:projectCode,selectParam:selectParam,gender:"",nationId:"",sort:"groupId",orderType:"ASC"},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.student-admin-tbody');var htmlTr='';var num=1;$(htmlTbody).empty();if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}if(v.checkInState==0){v.checkInState="未报到"}else if(v.checkInState==1){v.checkInState="已报到"}if(v.reconciliationState==0){v.reconciliationState="未入账"}else if(v.reconciliationState==1){v.reconciliationState="已入账"}if(v.invoiceState==0){v.invoiceState="未开票"}else if(v.invoiceState==1){v.invoiceState="已开票"}htmlTr='<tr><td><label class="check-label yt-checkbox select-elementary-checkbox" style="margin-left:8px;"><input type="checkbox" name="test" class="student-admin-pkId" value="'+v.pkId+'"/></label></td><td style="text-align:center;"><input type="hidden" class="trainee-id" value="'+v.traineeId+'"/>'+num++ +'</td><td><input type="hidden" class="project-code" value="'+v.projectCode+'"/><a style="color: #3c4687;" href="#" class="real-name-alert-details">'+v.realName+'</a></td><td style="text-align:center;">'+v.gender+'</td><td style="text-align:center;">'+v.nationName+'</td><td style="text-align:center;">'+v.phone+'</td><td>'+v.groupName+'</td><td>'+v.groupOrgName+'</td><td>'+v.deptPosition+'</td><td>'+v.invoiceType+'</td><td style="text-align:center;">'+v.checkInState+'</td><td style="text-align:center;">'+v.reconciliationState+'</td><td style="text-align:center;">'+v.invoiceState+'</td></tr>';$(".student-admin-page").show();htmlTbody.append($(htmlTr).data("legalData",v))})}else{$(".student-admin-page").hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="13" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})},addStudentList:function(){$yt_baseElement.showLoading();var projectCode=$yt_common.GetQueryString('projectCode');var realName=$(".add-student .real-name").val();var gender=$(".add-student .gender").val();var nationId=$(".add-student .nation-id").val();var phone=$(".add-student .phone").val();var idType=$(".add-student .id-type").val();var idNumber=$(".add-student .id-number").val();var dateBirth=$(".add-student .date-birth").val();var groupId=$(".add-student .group-id-elementary").val();var orgId=$(".add-student .org-id").val();var orgType=$(".add-student .org-type").val();var deptName=$(".add-student .dept-name").val();var mailingAddress=$(".add-student .mailing-address").val();var postalCode=$(".add-student .postal-code").val();var telephoneProject=$(".add-student .telephone-project").val();var fax=$(".add-student .fax").val();var email=$(".add-student .email").val();var partyDate=$(".add-student .party-date").val();var workTime=$(".add-student .work-time").val();var educationTime=$(".add-student .education-time").val();var educationTimeClass=$(".add-student .education-time-class").val();var serviceTime=$(".add-student .service-time").val();var serviceTimeClass=$(".add-student .service-time-class").val();var linkman=$(".add-student .linkman").val();var linkmanPhone=$(".add-student .linkman-phone").val();var linkmanTelephone=$(".add-student .linkman-telephone").val();var linkmanFax=$(".add-student .linkman-fax").val();var linkmanEmail=$(".add-student .linkman-email").val();var linkmanAddressEmail=$(".add-student .linkman-address-email").val();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/addOrUpdateTrainee",data:{traineeId:"",projectCode:projectCode,realName:realName,gender:gender,nationId:nationId,phone:phone,idType:idType,idNumber:idNumber,dateBirth:dateBirth,groupId:groupId,orgId:orgId,orgType:orgType,deptName:deptName,mailingAddress:mailingAddress,postalCode:postalCode,telephoneProject:telephoneProject,fax:fax,email:email,partyDate:partyDate,workTime:workTime,educationTime:educationTime,educationTimeClass:educationTimeClass,serviceTime:serviceTime,serviceTimeClass:serviceTimeClass,linkman:linkman,linkmanPhone:linkmanPhone,linkmanTelephone:linkmanTelephone,linkmanFax:linkmanFax,linkmanEmail:linkmanEmail,linkmanAddressEmail:linkmanAddressEmail,traineeId:"",groupNum:"",positionName:"",invoiceType:"",taxNumber:"",address:"",registeredBank:"",account:"",telephone:"",orgName:""},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("新增成功");$('.student-admin-page').pageInfo("refresh");$(".yt-edit-alert").hide();$yt_baseElement.hideLoading()}else if(data.flag==5){$yt_alert_Model.prompt(data.message);$(".yt-edit-alert").hide()}else{$yt_alert_Model.prompt("新增失败");$yt_baseElement.hideLoading()}}})},getStudentInf:function(){var traineeId=$('.yt-table-active .trainee-id').val();var projectId=$yt_common.GetQueryString('pkId');$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeDetails",data:{traineeId:traineeId,projectId:projectId},success:function(data){if(data.flag==0){$(".elementary-student-details").setDatas(data.data);$(".add-student").setDatas(data.data);$("select.project-code").setSelectVal(data.data.projectCode);$("select.nation-id").setSelectVal(String(data.data.nationId));$("select.project-states").setSelectVal(data.data.idType);$("select.group-id-elementary").setSelectVal(data.data.groupId);$("select.org-id").setSelectVal(String(data.data.groupOrgId));$("select.org-type").setSelectVal(data.data.orgType);if(data.data.gender=="1"){$("#radio1").setRadioState("check")}else if(data.data.gender=="2"){$("#radio2").setRadioState("check")};if($("span.gender").text()=="1"){$("span.gender").text("男")}else if($("span.gender").text()=="2"){$("span.gender").text("女")};var nationsList=projectDetailsList.getListSelectNations();if(nationsList!=null){$.each(nationsList,function(i,n){if($("span.nation-id").text()==n.nationId){$("span.nation-id").text(n.nationName)}})};if($("span.id-type").text()==1){$("span.id-type").text("身份证")}else if($("span.id-type").text()==2){$("span.id-type").text("护照")}else if($("span.id-type").text()==3){$("span.id-type").text("军官证")}else if($("span.id-type").text()==4){$("span.id-type").text("其他")};var trainList=data.data.trainList;var htmlTbody=$(".train-list-tbody");var htmlTr="";$.each(trainList,function(i,v){htmlTr+='<tr><td class="project-code" style="text-align:center"><a style="color: #4169E1;" class="file-name">'+v.projectCode+'</td><td style="text-align:center">'+v.projectName+'</a></td><td class="project-head" style="text-align:center">'+v.startDate+'</td><td class="certificate-no" style="text-align:center">'+v.projectHead+'</td><td class="start-date" style="text-align:center">'+v.certificateNo+'</td></tr>'});htmlTbody.html(htmlTr)}else{$yt_alert_Model.prompt("获取失败")}}})},elementaryStudentDetailsAlert:function(){$(".elementary-student-details").show();$yt_alert_Model.getDivPosition($(".elementary-student-details"));$yt_alert_Model.setFiexBoxHeight($(".elementary-student-details .alert-form"));$yt_model_drag.modelDragEvent($(".elementary-student-details .yt-edit-alert-title"));$('.elementary-student-details .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".elementary-student-details").hide();$("#pop-modle-alert").hide()})},amendStudentList:function(){var projectCode=$yt_common.GetQueryString('projectCode');var traineeId=$(".yt-table-active .trainee-id").val();var realName=$(".add-student .real-name").val();var gender=$(".add-student .gender").val();var nationId=$(".add-student .nation-id").val();var phone=$(".add-student .phone").val();var idType=$(".add-student .id-type").val();var idNumber=$(".add-student .id-number").val();var dateBirth=$(".add-student .date-birth").val();var groupId=$(".add-student .group-id-elementary").val();var orgId=$(".add-student .org-id").val();var orgType=$(".add-student .org-type").val();var deptName=$(".add-student .dept-name").val();var mailingAddress=$(".add-student .mailing-address").val();var postalCode=$(".add-student .postal-code").val();var telephoneProject=$(".add-student .telephone-project").val();var fax=$(".add-student .fax").val();var email=$(".add-student .email").val();var partyDate=$(".add-student .party-date").val();var workTime=$(".add-student .work-time").val();var educationTime=$(".add-student .education-time").val();var educationTimeClass=$(".add-student .education-time-class").val();var serviceTime=$(".add-student .service-time").val();var serviceTimeClass=$(".add-student .service-time-class").val();var linkman=$(".add-student .linkman").val();var linkmanPhone=$(".add-student .linkman-phone").val();var linkmanTelephone=$(".add-student .linkman-telephone").val();var linkmanFax=$(".add-student .linkman-fax").val();var linkmanEmail=$(".add-student .linkman-email").val();var linkmanAddressEmail=$(".add-student .linkman-address-email").val();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/addOrUpdateTrainee",data:{traineeId:traineeId,projectCode:projectCode,realName:realName,gender:gender,nationId:nationId,phone:phone,idType:idType,idNumber:idNumber,dateBirth:dateBirth,groupId:groupId,orgId:orgId,orgType:orgType,deptName:deptName,mailingAddress:mailingAddress,postalCode:postalCode,telephoneProject:telephoneProject,fax:fax,email:email,partyDate:partyDate,workTime:workTime,educationTime:educationTime,educationTimeClass:educationTimeClass,serviceTime:serviceTime,serviceTimeClass:serviceTimeClass,linkman:linkman,linkmanPhone:linkmanPhone,linkmanTelephone:linkmanTelephone,linkmanFax:linkmanFax,linkmanEmail:linkmanEmail,linkmanAddressEmail:linkmanAddressEmail,traineeId:"",groupNum:"",positionName:"",invoiceType:"",taxNumber:"",address:"",registeredBank:"",account:"",telephone:"",orgName:""},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("修改成功");$('.student-admin-page').pageInfo("refresh");$(".yt-edit-alert").hide()}else if(data.flag==5){$yt_alert_Model.prompt(data.message);$(".yt-edit-alert").hide()}else{$yt_alert_Model.prompt("修改失败")}}})},studentAdd:function(){$(".add-student").show();$yt_alert_Model.setFiexBoxHeight($(".add-student .alert-form"));$yt_alert_Model.getDivPosition($(".add-student"));$yt_model_drag.modelDragEvent($(".add-student .yt-edit-alert-title"));$('.add-student .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".add-student").hide();$("#pop-modle-alert").hide()})},delStudentList:function(){var projectCode=$('.yt-table-active .project-code').val();var traineeIds=$('.yt-table-active .trainee-id').val();var projectId=$yt_common.GetQueryString('pkId');$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/deleteTrainee",data:{projectCode:projectCode,traineeIds:traineeIds},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("删除成功");$('.student-admin-page').pageInfo("refresh")}else{$yt_alert_Model.prompt("不能删除")}}})}})},studentLog:function(){$(".student-log").show();$yt_alert_Model.setFiexBoxHeight($(".student-log .alert-form"));$yt_alert_Model.getDivPosition($(".student-log"));$yt_model_drag.modelDragEvent($(".student-log .yt-edit-alert-title"));$('.student-log .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".student-log").hide();$("#pop-modle-alert").hide()})},batchStudentLead:function(){var projectCode=$yt_common.GetQueryString('pkId');var fileName=$(".template-file").val();var file=getFileName(fileName);function getFileName(o){var pos=o.lastIndexOf("\\");return o.substring(pos+1)}$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/leadingTraineeByClass",data:{projectCode:projectCode,file:file},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("导入成功");$('.student-admin-page').pageInfo("refresh");$(".yt-edit-alert").hide()}else{$yt_alert_Model.prompt("导入失败")}}})},studentLead:function(){$(".lead-student").show();$yt_alert_Model.setFiexBoxHeight($(".lead-student .alert-form"));$yt_alert_Model.getDivPosition($(".lead-student"));$yt_model_drag.modelDragEvent($(".lead-student .yt-edit-alert-title"));$('.lead-student .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".lead-student").hide();$("#pop-modle-alert").hide()})},getUnitCostInf:function(){$yt_baseElement.showLoading();var projectId=$yt_common.GetQueryString('pkId');$.ajax({url:$yt_option.base_path+"project/getProjectRates",type:"post",data:{projectId:projectId},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.charge-tbody');var htmlTr='';var num=1;var groupRatesArr=$.parseJSON(data.data.groupRates);if(groupRatesArr.length>0){$.each(groupRatesArr,function(i,v){$('.yt-tab-active .group-select').setSelectVal(v.groupId);$('.invoice-inf .invoiceModel').val(v.invoiceModel);$('.invoice-inf .orgName').val(v.orgName);$('.invoice-inf .taxNumber').val(v.taxNumber);$('.invoice-inf .address').val(v.address);$('.invoice-inf .telephone').val(v.telephone);$('.invoice-inf .registeredBank').val(v.registeredBank);$('.invoice-inf .account').val(v.account);htmlTr+='<tr><td><span style="margin-left:10px" class="addchargenum">'+(i+1)+'</span></td><td class="groupId"><select class="yt-select group-select" style="width:200px" value="'+v.groupId+'"><option value="'+v.groupId+'"selected>'+v.groupName+'</option></select></td><td><input class="yt-input trainingExpenseRackRate" value="'+v.trainingExpenseRackRate+'"  type="text"/></td><td><input class="yt-input traineeRackRate" value="'+v.traineeRackRate+'"  type="text"/></td><td><input class="yt-input quarterageRackRate" value="'+v.quarterageRackRate+'"  type="text"/></td><td><input class="yt-input mealFeeRackRate" value="'+v.mealFeeRackRate+'"  type="text"/></td><td><input class="yt-input trainingExpenseNegotiatedPrice" value="'+v.trainingExpenseNegotiatedPrice+'"  type="text"/></td><td><input class="yt-input traineeNegotiatedPrice" value="'+v.traineeNegotiatedPrice+'"  type="text"/></td><td><input class="yt-input quarterageNegotiatedPrice" value="'+v.quarterageNegotiatedPrice+'"  type="text"/></td><td><input class="yt-input mealFeeNegotiatedPrice" value="'+v.mealFeeNegotiatedPrice+'"  type="text"/></td><td align="center"><a href="#" class="editor-charge">编辑</a></td><td align="center"><span style="text-align:center;"><img src="../../resources/images/icons/cost-level.png" class="del-charge" alt="" /></span></td></tr>';htmlTbody.html(htmlTr)});var groupList=projectDetailsList.getListSelectGroup();if(groupList!=null){$.each(groupList,function(i,n){$(".group-select").append('<option value="'+n.groupId+'">'+n.groupName+'</option>')})}$(".group-select").niceSelect()}var traineeRatesArr=$.parseJSON(data.data.traineeRates);if(traineeRatesArr!=null){$(".personal-standard").setDatas(traineeRatesArr)}else{}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},savebillingInf:function(){$yt_baseElement.showLoading();var projectId=$yt_common.GetQueryString('pkId');var groupId=$('.yt-tab-active .group-select').val();var invoiceModel=$('.invoice-inf .invoiceModel').val();var orgName=$('.invoice-inf .orgName').val();var taxNumber=$('.invoice-inf .taxNumber').val();var address=$('.invoice-inf .address').val();var telephone=$('.invoice-inf .telephone').val();var registeredBank=$('.invoice-inf .registeredBank').val();var account=$('.invoice-inf .account').val();$.ajax({type:"post",url:$yt_option.base_path+"project/updateProjectOrgInvoice",data:{projectId:projectId,groupId:groupId,invoiceModel:invoiceModel,orgName:orgName,taxNumber:taxNumber,address:address,telephone:telephone,registeredBank:registeredBank,account:account,deliveryAddress:"",recipients:"",recipientsPhone:"",invoiceType:""},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("保存成功");$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("保存失败");$yt_baseElement.hideLoading()}}})},billingInf:function(){$(".billing-inf-alert").show();$yt_alert_Model.setFiexBoxHeight($(".billing-inf-alert .alert-form"));$yt_alert_Model.getDivPosition($(".billing-inf-alert"));$yt_model_drag.modelDragEvent($(".billing-inf-alert .yt-edit-alert-title"));$('.billing-inf-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".billing-inf-alert").hide();$("#pop-modle-alert").hide()})},saveChargeStandard:function(){$yt_baseElement.showLoading();var projectId=$yt_common.GetQueryString('pkId');var groupRates="";var traineeRates="";var groupRatesArr=[];$(".charge-tbody tr").each(function(i,n){var projectId=$yt_common.GetQueryString('pkId');groupId=$(n).find(".groupId .group-select").val();trainingExpenseRackRate=$(n).find(".trainingExpenseRackRate").val();traineeRackRate=$(n).find(".traineeRackRate").val();quarterageRackRate=$(n).find(".quarterageRackRate").val();mealFeeRackRate=$(n).find(".mealFeeRackRate").val();trainingExpenseNegotiatedPrice=$(n).find(".trainingExpenseNegotiatedPrice").val();traineeNegotiatedPrice=$(n).find(".traineeNegotiatedPrice").val();quarterageNegotiatedPrice=$(n).find(".quarterageNegotiatedPrice").val();mealFeeNegotiatedPrice=$(n).find(".mealFeeNegotiatedPrice").val();var groupRatesList={projectId:projectId,groupId:groupId,trainingExpenseRackRate:trainingExpenseRackRate,traineeRackRate:traineeRackRate,quarterageRackRate:quarterageRackRate,mealFeeRackRate:mealFeeRackRate,trainingExpenseNegotiatedPrice:trainingExpenseNegotiatedPrice,traineeNegotiatedPrice:traineeNegotiatedPrice,quarterageNegotiatedPrice:quarterageNegotiatedPrice,mealFeeNegotiatedPrice:mealFeeNegotiatedPrice,invoiceType:0};groupRatesArr.push(groupRatesList)});var groupRates=JSON.stringify(groupRatesArr);var projectId=$yt_common.GetQueryString('pkId');var trainingExpenseRackRate=$(".personal-standard .training-expense-rack-rate").val();var traineeRackRate=$(".personal-standard .trainee-rack-rate").val();var quarterageRackRate=$(".personal-standard .quarterage-rack-rate").val();var mealFeeRackRate=$(".personal-standard .meal-fee-rack-rate").val();var trainingExpenseNegotiatedPrice=$(".personal-standard .training-expense-negotiated-price").val();var traineeNegotiatedPrice=$(".personal-standard .trainee-negotiated-price").val();var quarterageNegotiatedPrice=$(".personal-standard .quarterage-negotiated-price").val();var mealFeeNegotiatedPrice=$(".personal-standard .meal-fee-negotiated-price").val();var traineeRatesList={projectId:projectId,trainingExpenseRackRate:trainingExpenseRackRate,traineeRackRate:traineeRackRate,quarterageRackRate:quarterageRackRate,mealFeeRackRate:mealFeeRackRate,trainingExpenseNegotiatedPrice:trainingExpenseNegotiatedPrice,traineeNegotiatedPrice:traineeNegotiatedPrice,quarterageNegotiatedPrice:quarterageNegotiatedPrice,mealFeeNegotiatedPrice:mealFeeNegotiatedPrice};var traineeRates=JSON.stringify(traineeRatesList);$.ajax({type:"post",url:$yt_option.base_path+"project/updateProjectRates",data:{projectId:projectId,groupRates:groupRates,traineeRates:traineeRates},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("保存成功");$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("保存失败");$yt_baseElement.hideLoading()}}})},getStudentCostInf:function(){$yt_baseElement.showLoading();var projectId=$yt_common.GetQueryString('pkId');var selectParam="";$.ajax({url:$yt_option.base_path+"project/getProjectRatesDetails",type:"post",data:{projectId:projectId,selectParam:selectParam},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.student-cost-tbody');var htmlTr='';var num=1;if(data.data.length>0){$.each(data.data,function(i,v){if(v.types==1){v.trainingExpenseRackRate=0;v.traineeRackRate=0;v.quarterageRackRate=0;v.mealFeeRackRate=0;v.trainingExpenseNegotiatedPrice=0;v.traineeNegotiatedPrice=0;v.quarterageNegotiatedPrice=0;v.mealFeeNegotiatedPrice=0}htmlTr+='<tr><td style="text-align: center;">'+num++ +'</td><td><input type="hidden" value="'+v.traineeId+'" class="traineeId"/><span class=" traineeName" value="">'+v.traineeName+'</span></td><td><span class=" groupName" value=""><input type="hidden" value="'+v.groupId+'" class="groupId"/>'+v.groupName+'</span></td><td><input type="hidden" value="'+v.types+'" class="types"/><input class="yt-input trainingExpenseRackRate" value="'+v.trainingExpenseRackRate+'"  type="text"/></td><td><input class="yt-input traineeRackRate" value="'+v.traineeRackRate+'"  type="text"/></td><td><input class="yt-input quarterageRackRate" value="'+v.quarterageRackRate+'"  type="text"/></td><td><input class="yt-input mealFeeRackRate" value="'+v.mealFeeRackRate+'"  type="text"/></td><td><input class="yt-input trainingExpenseNegotiatedPrice" value="'+v.trainingExpenseNegotiatedPrice+'"  type="text"/></td><td><input class="yt-input traineeNegotiatedPrice" value="'+v.traineeNegotiatedPrice+'"  type="text"/></td><td><input class="yt-input quarterageNegotiatedPrice" value="'+v.quarterageNegotiatedPrice+'"  type="text"/></td><td><input class="yt-input mealFeeNegotiatedPrice" value="'+v.mealFeeNegotiatedPrice+'"  type="text"/></td></tr>'})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},updateTraineeDetails:function(){$yt_baseElement.showLoading();var updateData="";var updateDataArr=[];$(".student-cost-tbody tr").each(function(i,n){var projectId=$yt_common.GetQueryString('pkId');traineeId=$(n).find(".traineeId").val();groupId=$(n).find(".groupId").val();types=$(n).find(".types").val();trainingExpenseRackRate=$(n).find(".trainingExpenseRackRate").val();traineeRackRate=$(n).find(".traineeRackRate").val();quarterageRackRate=$(n).find(".quarterageRackRate").val();mealFeeRackRate=$(n).find(".mealFeeRackRate").val();trainingExpenseNegotiatedPrice=$(n).find(".trainingExpenseNegotiatedPrice").val();traineeNegotiatedPrice=$(n).find(".traineeNegotiatedPrice").val();quarterageNegotiatedPrice=$(n).find(".quarterageNegotiatedPrice").val();mealFeeNegotiatedPrice=$(n).find(".mealFeeNegotiatedPrice").val();var groupRatesList={projectId:projectId,types:types,groupId:groupId,traineeId:traineeId,trainingExpenseRackRate:trainingExpenseRackRate,traineeRackRate:traineeRackRate,quarterageRackRate:quarterageRackRate,mealFeeRackRate:mealFeeRackRate,trainingExpenseNegotiatedPrice:trainingExpenseNegotiatedPrice,traineeNegotiatedPrice:traineeNegotiatedPrice,quarterageNegotiatedPrice:quarterageNegotiatedPrice,mealFeeNegotiatedPrice:mealFeeNegotiatedPrice};updateDataArr.push(groupRatesList)});var updateData=JSON.stringify(updateDataArr);$.ajax({type:"post",url:$yt_option.base_path+"project/updateTraineeDetails",data:{updateData:updateData},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("保存成功");$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("保存失败");$yt_baseElement.hideLoading()}}})},getTeachPlanDesignRequirements:function(){$yt_baseElement.showLoading();var userRealName=$('.hid-user-real-name').val();var projectSellName=$('.hid-project-sell-name').val();var projectHead=$('.hid-project-head-name').val();projectHead=projectHead.split('、');var projectId=$yt_common.GetQueryString('pkId');$.ajax({type:"post",url:$yt_option.base_path+"project/getTeachingScheme",data:{projectId:projectId},success:function(data){$('.hid-process-instance-id').val(' ');if(userRealName==projectSellName){$('.teach-plan-table').show();$('.demand-btn').show()}else{$('.teach-plan-table').hide();$('.demand-btn').hide()}if(data.flag==0&&data.data!=null){$(".teach-plan-table .pk-id").val(data.data.pkId);if(data.data.dataStates==1){$('.demand-btn').hide();$('.teach-plan-table').hide();$('.teach-plan-table-info').show();data.data.traineeLevel=data.data.traineeLevel.replace('1','一级经理');data.data.traineeLevel=data.data.traineeLevel.replace('2','二级经理');data.data.traineeLevel=data.data.traineeLevel.replace('3','三级经理');data.data.traineeLevel=data.data.traineeLevel.replace('4','其他');data.data.schemeRequirement=data.data.schemeRequirement.replace('1','方案设计思路');data.data.schemeRequirement=data.data.schemeRequirement.replace('2','教学日程');data.data.schemeRequirement=data.data.schemeRequirement.replace('3','师资简介');if(data.data.estimatedTransactionPrice=1){data.data.estimatedTransactionPrice="较高"}else if(data.data.estimatedTransactionPrice=2){data.data.estimatedTransactionPrice="一般"}else if(data.data.estimatedTransactionPrice=3){data.data.estimatedTransactionPrice="较低"}$('.trainee-level-info').text(data.data.traineeLevel);$('.estimated-transaction-price-info').text(data.data.estimatedTransactionPrice);$('.time-receipt-info').text(data.data.timeReceipt);$('.feedback-time-info').text(data.data.feedbackTime);$('.scheme-requirement-info').text(data.data.schemeRequirement);$('.linkman-info').text(data.data.linkman);$('.phone-info').text(data.data.phone);$('.ad-details-info').text(data.data.adDetails);var teachingsSchemeLevel=data.data.teachingsSchemeLevel;var tsl="";if(teachingsSchemeLevel=="teachingSchemeDept"){tsl="部门级别"}else if(teachingsSchemeLevel=="teachingSchemeExpert"){tsl="专家组"}else{tsl="院领导"}$('.teachings-scheme-level-info').text(tsl)}else{$('.teach-plan-table').setDatas(data.data)}var firstDraft;var teachingSchemeFile=JSON.parse(data.data.teachingSchemeFile);if(projectHead.indexOf(userRealName)!=-1){if($('.teachings-scheme-level-info').text()=='部门级别'){var getAllNextPeople=projectDetailsList.getworkFlowOperateTeach('teachingSchemeDept')}else if($('.teachings-scheme-level-info').text()=='专家组'){var getAllNextPeople=projectDetailsList.getworkFlowOperateTeach('teachingSchemeExpert')}else if($('.teachings-scheme-level-info').text()=='院领导'){var getAllNextPeople=projectDetailsList.getworkFlowOperateTeach('teachingSchemeLeader')}if(getAllNextPeople!=null){$.each(getAllNextPeople,function(i,n){if(i==0){$('.star-dealingWithPeople').val(n.userCode)}})};if(teachingSchemeFile.length>0){if(teachingSchemeFile[0].fileType==1){$('.first-draft').show();$('.first-draft-btn').hide();$('.plan-btn-flirst').hide();var teacherUl=$(".file-id");var teacherLi="";var fileIdsArr=$.parseJSON(data.data.teachingSchemeFile);if(fileIdsArr.length>0){$('.first-draft-inf').css('width','875px');$('.first-upload-time-title').show();$.each(fileIdsArr,function(i,v){if(v.fileType==1){$('.first-upload-time').text(v.createTimeString);teacherLi='<p style="width:870px;height:40px;border:1px dashed #e6e6e6;line-height:40px;"><input type="hidden" class="down-file-url" value="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+v.fileId+'"><span class="file-name" style="margin-right: 50px;color:blue;cursor: pointer"><input type="hidden" class="file-span-id" value="'+v.pkId+'" >'+v.fileName+'</span><span class="del-file-p" style="float:right;cursor: pointer;display:none;"><img src="../../resources/images/icons/teach-plan-del.png" alt="" />删除</span><span class="down-load-file-index" style="float:right;cursor: pointer;"><img src="../../resources/images/icons/down-load-teach-plan.png" alt="" />下载</span><span style="float:right; display:none;"><img src="../../resources/images/icons/preview.png" alt="" />预览</span></p>';teacherUl.html(teacherLi)}})}}else{$('.first-draft').show()}}else{$('.first-draft').show()}var flowLogArr=$.parseJSON(data.data.flowLog);if(flowLogArr!=null){if(flowLogArr.length>0){if(flowLogArr[0].tastKey=="activitiEndTask"&&flowLogArr[0].deleteReason!=""){var bool=true;$.each(teachingSchemeFile,function(i,n){if(n.fileType==2){bool=false}});if(bool){$('.last-draft').show()}else{$('.last-draft').show();$('.last-draft-btn').hide();$('.plan-btn-last').hide();if(fileIdsArr.length>0){$('.last-draft-inf').css('width','875px');$('.last-upload-time-title').show();$.each(fileIdsArr,function(i,v){$('.last-upload-time').text(v.createTimeString);if(v.fileType==2){teacherLi='<p style="width:870px;height:40px;border:1px dashed #e6e6e6;line-height:40px;padding:0px 20px"><input type="hidden" class="last-down-file-url" value="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+v.fileId+'"><span class="file-name" style="margin-right: 50px;color:blue;cursor: pointer"><input type="hidden" class="file-span-id" value="'+v.pkId+'" >'+v.fileName+'</span><span class="del-file-p" style="float:right;cursor: pointer;display:none;"><img src="../../resources/images/icons/teach-plan-del.png" alt="" />删除</span><span class="last-down-load-file-index" style="float:right;cursor: pointer;"><img src="../../resources/images/icons/down-load-teach-plan.png" alt="" />下载</span><span style="float:right; display:none;"><img src="../../resources/images/icons/preview.png" alt="" />预览</span></p>';$('.last-file-id').html(teacherLi)}})}}}}}}else{$('.last-step-div-teach').hide();$('.appro-btn-div').hide();if(teachingSchemeFile.length>0){if(teachingSchemeFile[0].fileType==1){$('.first-draft').show();$('.first-draft-btn').hide();$('.plan-btn-flirst').hide();var teacherUl=$(".file-id");var teacherLi="";var fileIdsArr=$.parseJSON(data.data.teachingSchemeFile);if(fileIdsArr.length>0){$('.first-draft-inf').css('width','875px');$('.first-upload-time-title').show();$.each(fileIdsArr,function(i,v){if(v.fileType==1){$('.first-upload-time').text(v.createTimeString);teacherLi='<p style="width:870px;height:40px;border:1px dashed #e6e6e6;line-height:40px;"><input type="hidden" class="down-file-url" value="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+v.fileId+'"><span class="file-name" style="margin-right: 50px;color:blue;cursor: pointer"><input type="hidden" class="file-span-id" value="'+v.pkId+'" >'+v.fileName+'</span><span class="del-file-p" style="float:right;cursor: pointer;display:none;"><img src="../../resources/images/icons/teach-plan-del.png" alt="" />删除</span><span class="down-load-file-index" style="float:right;cursor: pointer;"><img src="../../resources/images/icons/down-load-teach-plan.png" alt="" />下载</span><span style="float:right; display:none;"><img src="../../resources/images/icons/preview.png" alt="" />预览</span></p>';teacherUl.html(teacherLi)}})}}}var flowLogArr=$.parseJSON(data.data.flowLog);if(flowLogArr!=null){if(flowLogArr.length>0){if(flowLogArr[0].tastKey=="activitiEndTask"&&flowLogArr[0].deleteReason!=""){var bool=true;$.each(teachingSchemeFile,function(i,n){if(n.fileType==2){bool=false}});if(bool==false){$('.last-draft').show();$('.last-draft-btn').hide();$('.plan-btn-last').hide();if(fileIdsArr.length>0){$('.last-draft-inf').css('width','875px');$('.last-upload-time-title').show();$.each(fileIdsArr,function(i,v){$('.last-upload-time').text(v.createTimeString);if(v.fileType==2){teacherLi='<p style="width:870px;height:40px;border:1px dashed #e6e6e6;line-height:40px;padding:0px 20px"><input type="hidden" class="last-down-file-url" value="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+v.fileId+'"><span class="file-name" style="margin-right: 50px;color:blue;cursor: pointer"><input type="hidden" class="file-span-id" value="'+v.pkId+'" >'+v.fileName+'</span><span class="del-file-p" style="float:right;cursor: pointer;display:none;"><img src="../../resources/images/icons/teach-plan-del.png" alt="" />删除</span><span class="last-down-load-file-index" style="float:right;cursor: pointer;"><img src="../../resources/images/icons/down-load-teach-plan.png" alt="" />下载</span><span style="float:right; display:none;"><img src="../../resources/images/icons/preview.png" alt="" />预览</span></p>';$('.last-file-id').html(teacherLi)}})}}}}}}$('.hid-process-instance-id').val(data.data.processInstanceId);var flowLogArr=$.parseJSON(data.data.flowLog);if(flowLogArr!=null){if(flowLogArr.length>0){$('.last-step-add-teach').empty();$('.approval-process-module').show();$.each(flowLogArr,function(i,n){$('.tast-key-teach').val(flowLogArr[0].tastKey);if(userRealName==flowLogArr[0].userName){if(i==0){if(n.tastKey=="activitiEndTask"){$('.next-operate-person-teach-tr').hide();if(n.deleteReason!=""){$('.last-step-div-teach').hide();$('.appro-btn-div').hide();middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+flowLogArr.length+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+flowLogArr[0].userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+flowLogArr[0].operationState+'</span></li><li class="view-time-li middle-step-commentTime" >'+flowLogArr[0].commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment">'+flowLogArr[0].comment+'</div></li></ul></div></div>';$('.last-step-add-teach').append(middleStepHtml)}else{$('.last-step-div-teach').show();$('.appro-btn-div').show();$('.hid-tast-key').val(n.tastKey);$('.last-step-order-teach').text(flowLogArr.length);$('.last-step-operate-person-userName-teach').text(n.userName);$('.last-step-operationState-teach').text(n.operationState);$('.last-step-commentTime-teach').text(n.commentTime)}}else{$('.last-step-div-teach').show();$('.appro-btn-div').show();$('.last-step-order-teach').text(flowLogArr.length);$('.last-step-operate-person-userName-teach').text(n.userName);$('.last-step-operationState-teach').text(n.operationState);$('.last-step-commentTime-teach').text(n.commentTime)}}}else{$('.last-step-div-teach').hide();$('.appro-btn-div').hide();if(i==0){middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+flowLogArr.length+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+flowLogArr[0].userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+flowLogArr[0].operationState+'</span></li><li class="view-time-li middle-step-commentTime" >'+flowLogArr[0].commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment">'+flowLogArr[0].comment+'</div></li></ul></div></div>';$('.last-step-add-teach').append(middleStepHtml)}}if(i==flowLogArr.length-1){$('.first-step-order-teach').text(1);$('.first-step-operate-person-username-teach').text(n.userName);$('.first-step-taskName-teach').text(n.operationState);$('.first-step-commentTime-teach').text(n.commentTime)};if(i!=0&&i<flowLogArr.length-1){var order=flowLogArr.length-i;middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+n.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+n.operationState+'</span></li><li class="view-time-li middle-step-commentTime" >'+n.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment">'+n.comment+'</div></li></ul></div></div>';$('.last-step-add-teach').append(middleStepHtml)}});if(flowLogArr[0].tastKey=="activitiEndTask"&&flowLogArr[0].deleteReason!=""){if(teachingSchemeFile.length>1){$('.last-draft').show();$('.last-draft-btn').hide();$('.plan-btn-last').hide();if(fileIdsArr.length>0){$.each(fileIdsArr,function(i,v){$('.last-upload-time').text(v.createTimeString);if(v.fileType==2){teacherLi='<p style="width:870px;height:40px;border:1px dashed #e6e6e6;line-height:40px;padding:0px 20px"><input type="hidden" class="last-down-file-url" value="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+v.fileId+'"><span class="file-name" style="margin-right: 50px;color:blue;cursor: pointer"><input type="hidden" class="file-span-id" value="'+v.pkId+'" >'+v.fileName+'</span><span class="del-file-p" style="float:right;cursor: pointer;display:none;"><img src="../../resources/images/icons/teach-plan-del.png" alt="" />删除</span><span class="last-down-load-file-index" style="float:right;cursor: pointer;"><img src="../../resources/images/icons/down-load-teach-plan.png" alt="" />下载</span><span style="float:right; display:none;"><img src="../../resources/images/icons/preview.png" alt="" />预览</span></p>';$('.last-file-id').html(teacherLi)}})}}}}}$yt_baseElement.hideLoading()}else{if(userRealName==projectSellName){$('.teach-plan-table').show()}$yt_baseElement.hideLoading()}projectDetailsList.getNextOperatePersonTeach();$(".next-people-teach").niceSelect()}})},getNextOperatePersonTeach:function(){if($('.teachings-scheme-level-info').text()=='部门级别'){var nextPersonList=projectDetailsList.getworkFlowOperateTeach('teachingSchemeDept')}else if($('.teachings-scheme-level-info').text()=='专家组'){var nextPersonList=projectDetailsList.getworkFlowOperateTeach('teachingSchemeExpert')}else if($('.teachings-scheme-level-info').text()=='院领导'){var nextPersonList=projectDetailsList.getworkFlowOperateTeach('teachingSchemeLeader')}if(nextPersonList!=null){$.each(nextPersonList,function(i,n){$(".next-people-teach").append('<option value="'+n.userCode+'">'+n.userName+'</option>')})};$(".next-people-teach").niceSelect()},teachPlanDesignRequirements:function(dataStates){var projectId=$yt_common.GetQueryString('pkId');var pkId=$(".teach-plan-table .pk-id").val();var traineeLevel=[];var estimatedTransactionPrice=$(".teach-plan-table .estimated-transaction-price").val();var timeReceipt=$(".teach-plan-table .time-receipt").val();var feedbackTime=$(".teach-plan-table .feedback-time").val();var schemeRequirement=[];var linkman=$(".teach-plan-table .linkman").val();var phone=$(".teach-plan-table .phone").val();var adDetails=$(".teach-plan-table .ad-details").val();var teachingsSchemeLevel=$(".teach-plan-table .teachings-scheme-level").val();$.each($(".trainee-level>input:checkbox:checked"),function(i,n){traineeLevel.push($(n).val())});$.each($('.scheme-requirement>input:checkbox:checked'),function(i,n){schemeRequirement.push($(n).val())});traineeLevel=traineeLevel.join(',');schemeRequirement=schemeRequirement.join(',');$.ajax({type:"post",url:$yt_option.base_path+"project/addOrUpdateTeachingScheme",data:{projectId:projectId,pkId:pkId,traineeLevel:traineeLevel,estimatedTransactionPrice:estimatedTransactionPrice,timeReceipt:timeReceipt,feedbackTime:feedbackTime,schemeRequirement:schemeRequirement,linkman:linkman,phone:phone,adDetails:adDetails,teachingsSchemeLevel:teachingsSchemeLevel,dataStates:dataStates},success:function(data){if(data.flag==0){if(dataStates==0){$yt_alert_Model.prompt("保存成功");projectDetailsList.getTeachPlanDesignRequirements()}else{$yt_alert_Model.prompt("提交成功");projectDetailsList.getTeachPlanDesignRequirements()}}else{if(dataStates==0){$yt_alert_Model.prompt("保存失败")}else{$yt_alert_Model.prompt("提交失败")}}}})},firstDraftByProjectDirector:function(fileType){var projectId=$yt_common.GetQueryString('pkId');if($('.teachings-scheme-level-info').text()=='部门级别'){var businessCode='teachingSchemeDept'}else if($('.teachings-scheme-level-info').text()=='专家组'){var businessCode='teachingSchemeExpert'}else if($('.teachings-scheme-level-info').text()=='院领导'){var businessCode='teachingSchemeLeader'}var dealingWithPeople=$('.star-dealingWithPeople').val();var files="";var filesArr=[];if(fileType==1){$(".file-id p").each(function(i,n){fileName=$(n).find(".file-name").text();fileId=$(n).find(".file-name .file-span-id").val();var arrFile={fileName:fileName,fileId:fileId};filesArr.push(arrFile)})}else{$(".last-file-id p").each(function(i,n){fileName=$(n).find(".file-name").text();fileId=$(n).find(".file-name .file-span-id").val();var arrFile={fileName:fileName,fileId:fileId};filesArr.push(arrFile)})}var files=JSON.stringify(filesArr);$.ajax({type:"post",url:$yt_option.base_path+"project/addOrUpdateTeachingSchemeFile",data:{projectId:projectId,fileType:fileType,files:files,businessCode:businessCode,dealingWithPeople:dealingWithPeople,opintion:"",processInstanceId:"",nextCode:"submited"},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("操作成功");window.location.href="projectList.html"}else{$yt_alert_Model.prompt("操作失败")}}})},getworkFlowOperateTeach:function(businessCode){var processInstanceId=$('.hid-process-instance-id').val();var list=[];var user;$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:businessCode,processInstanceId:processInstanceId},async:false,success:function(data){$.each(data.data,function(i,n){for(var k in n){user=n[k]}})}});return user},exportList:function(){var projectCode=$yt_common.GetQueryString("projectCode");var traineeIds=[];$.each($('.student-admin-tbody input:checked'),function(i,n){traineeIds.push($(n).parents('tr').find('.trainee-id').val())});traineeIds=traineeIds.join(',');$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/addTraineeNation",async:true,data:{projectCode:projectCode,traineeIds:traineeIds},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("推送成功")}else{$yt_alert_Model.prompt("推送失败")}},error:function(data){console.log(data.status)}})}};$(function(){projectDetailsList.init()});