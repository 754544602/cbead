(function($,window){var serveExamine={appId:'',costType:'',processInstanceId:'',request_params:'',init:function(){var ts=this;serveExamine.appId=serveExamine.GetQueryString('appId');ts.getReimAppInfoDetailByReimAppId();ts.getDictInfoByTypeCode();ts.start();ts.events()},start:function(){$('select').niceSelect()},events:function(){var me=this;$("#closeBtn").click(function(){window.close()});me.tallyListEvent();$('.yt-table tbody').on('click','tr',function(){var ts=$(this);var trs=ts.siblings();trs.removeClass('yt-table-active');ts.addClass('yt-table-active')});$('table.payee-personal').on('click','.to-data',function(){$("#pop-modle-alert").show();var tr=$(this).parents('tr');$('#perPayeeName').text(tr.attr('payeename'));$('#perPersonalTotal').text(tr.attr('personalTotal'));var choiceLoan=tr.attr('choiceLoan');if(choiceLoan){$('.personal-payment .display-loan').show();$('#perChoiceLoan').text(tr.attr('choiceLoan'));$('.per-arrears-money').text(tr.attr('arrearsmoney'));$('.per-reverse-money').text(tr.attr('thereversemoney'))}else{$('.personal-payment .display-loan').hide();$('#perChoiceLoan').text('').niceSelect();$('.per-arrears-money').text('0.00');$('.per-reverse-money').text('0.00')}$('#perWiteOffPersonal').text(tr.attr('witeOffPersonal'));$('.per-writeoff-money').text(tr.attr('personalWriteoff'));$('#perCash').text(tr.attr('cash'));$('#perOfficialCard').text(tr.attr('officialCard'));$('#perTransferAccounts').text(tr.attr('transferAccounts'));$('#perIdCarkno').text(tr.attr('idCarkno'));$('#perPayeeBank').text(tr.attr('payeeBank'));$('#perBankName').text(tr.attr('bankName'));$('#perPhoneNum').text(tr.attr('phoneNum'));$('#perOffOpenBank').text(tr.attr('offOpenBank'));$('#perOffAccounts').text(tr.attr('offAccounts'));var payeeRadio=tr.attr('payeeRadio');$('#payeeRadio').text(payeeRadio==1?'有':'无');$('#perSpecial').text(tr.attr('personalSpecial'));$('#personalPayment').show();$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('#personalPayment'));$('#pop-modle-alert').show();$('#personalPayment').show()});$('#personalPayment .model-bottom-btn .yt-cancel-btn').on('click',function(){$yt_baseElement.hideMongoliaLayer();$('#pop-modle-alert').hide();$('#personalPayment').hide();$('#perPayeeName').text('--');$('#perPersonalTotal').text('0.00');var choiceLoan=tr.attr('choiceLoan');if(choiceLoan){$('.personal-payment .display-loan').show();$('#perChoiceLoan').text('--');$('.per-arrears-money').text('0.00');$('.per-reverse-money').text('0.00')}else{$('.personal-payment .display-loan').hide();$('#perChoiceLoan').text('--');$('.per-arrears-money').text('0.00');$('.per-arrears-money').text('0.00')}$('#perWiteOffPersonal').text('--');$('.per-writeoff-money').text('0.00');$('#perCash').text('0.00');$('#perOfficialCard').text('0.00');$('#perTransferAccounts').text('0.00');$('#perIdCarkno').text('--');$('#perPayeeBank').text('--');$('#perBankName').text('--');$('#perPhoneNum').text('--');$('#payeeRadio').text('--');$('#perSpecial').text('--')});$(".bottom-btn button.print-btn").on("click",function(){var pageUrl="";var goPageUrl="view/system/expensesReim/module/approval/expenApplApprList.html";if($(this).val()=="printBills"){pageUrl="view/system/expensesReim/module/print/InvoicePasting.html?appId="+serveExamine.appId}if($(this).val()=="printExpend"){pageUrl="view/system/expensesReim/module/print/expenditureVoucher.html?expenditureAppId="+serveExamine.appId}if($(this).val()=="printExpendDetail"){pageUrl='view/system/expensesReim/module/print/expenditureVoucherDetailed.html?expenditureAppId='+serveExamine.appId+"&costType="+serveExamine.costType}$yt_baseElement.openNewPage(2,pageUrl)});$("#expenseEdit").on("click",function(){var pageUrl=$yt_option.websit_path+"view/system/expensesReim/module/reimApply/expenseExamine.html?appId="+serveExamine.appId;window.location.href=pageUrl})},fmMoney:function(str){return $yt_baseElement.fmMoney(str||'0')},rmoney:function(str){return $yt_baseElement.rmoney(str||'0')},paymentListEvent:function(){var me=this;$('#addProcuList').on('click',function(){me.showPaymentAlert()});$("#paymentAddBtn").on('click',function(){var budgetProject=$('#budgetProject option:selected').text();var budgetMoney=$('#budgetMoney').val();var specialNum=$('#specialNum').text();var html='<tr> <td>'+budgetProject+'</td> <td style="text-align: right;">'+budgetMoney+'</td> <td>'+specialNum+'</td> <td><span class="operate-update"><img src="../resources/images/common/edit-icon.png"></span><span class="operate-del"><img src="../resources/images/common/del-icon.png"></span></td> </tr>';$('#paymentList tbody').append(html);me.hidePaymentAlert()});$('#paymentList').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})});$('#paymentList').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');me.showPaymentAlert()});$('#paymentCanelBtn').on('click',function(){me.hidePaymentAlert()})},showPaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hidePaymentAlert:function(){var alert=$('#createDetali');$yt_baseElement.hideMongoliaLayer();alert.hide();$('#pop-modle-alert').hide()},serveExamineEvent:function(){$('.prior-approval').click(function(){$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition($('.prior-alert'));$('#pop-modle-alert').show();$('.prior-alert').show()});$('.prior-common').click(function(){var code=$('.prior-approval-list .yt-table-active').attr('code');if(code){$('.prior-approval').val(code);$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()}else{$yt_alert_Model.prompt('请选择一条数据')}});$('.prior-cancel').click(function(){$yt_baseElement.hideMongoliaLayer();$('.prior-alert').hide();$('#pop-modle-alert').hide()})},tallyListEvent:function(){var me=this;$('.add-tally').click(function(){me.showMsgAlert();$('.tally-common').off().on('click',function(){me.appendMsgList()}).text('添加到列表')});$('.tally-cancel').click(function(){me.hideMsgAlert();me.clearAlert($('.msg-alert'))});$('.tally-list').on('click','.operate-del',function(){var ithis=$(this);var tr=ithis.parents('tr');$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.remove()}})});$('.tally-list').on('click','.operate-update',function(){var ithis=$(this);var tr=ithis.parents('tr');var loanType=$('#loanType option[value="'+tr.attr('loanCode')+'"]').attr('selected',true);var abstract=$('#abstract').val(tr.attr('abstract'));var totalSubject=$('#totalSubject').val(tr.attr('totalSubject'));var detailSubject=$('#detailSubject').val(tr.attr('detailSubject'));var tallyMoney=$('#tallyMoney').val(tr.attr('tallyMoney'));$('#loanType').niceSelect();me.showMsgAlert();$('.tally-common').off().on('click',function(){me.appendMsgList(tr)}).text('确定')})},appendMsgList:function(tr){var me=this;if($yt_valid.validForm($('.tally-alert'))){var loanType=$('#loanType option:selected').text();var loanCode=$('#loanType option:selected').val();var abstract=$('#abstract').val();var totalSubject=$('#totalSubject').val();var detailSubject=$('#detailSubject').val();var tallyMoney=$('#tallyMoney').val();var totalText='';var detailText='';if(loanType=='DEBIT_ENTRY'){totalText=tallyMoney}else{detailText=tallyMoney}var html='<tr pid="" class="" loanCode="'+loanCode+'" loanType="'+loanType+'" abstract="'+abstract+'" totalSubject="'+totalSubject+'" detailSubject="'+detailSubject+'" tallyMoney="'+tallyMoney+'"><td>'+abstract+'</td><td>'+totalSubject+'</td><td>'+detailSubject+'</td><td>'+totalText+'</td><td>'+detailText+'</td><td><span class="operate-update"><img src="../resources/images/common/edit-icon.png"></span><span class="operate-del"><img src="../resources/images/common/del-icon.png"></span></td></tr>';if(tr){tr.replaceWith(html)}else{$('.tally-list').append(html)}me.hideMsgAlert();me.clearAlert($('.tally-alert'))}else{}},showMsgAlert:function(){var alert=$('.tally-alert');$yt_baseElement.showMongoliaLayer();$yt_alert_Model.getDivPosition(alert);$('#pop-modle-alert').show();alert.show()},hideMsgAlert:function(){$yt_baseElement.hideMongoliaLayer();$('.tally-alert').hide();$('#pop-modle-alert').hide()},clearAlert:function(obj){var selects=obj.find('select');$.each(selects,function(i,n){$(n).find('option:first-child').attr('selected',true)});selects.niceSelect();var inputs=obj.find('input');inputs.val('')},getReimAppInfoDetailByReimAppId:function(){var me=this;$.ajax({type:"post",url:$yt_option.base_path+"sz/expenditureApp/getExpenditureAppInfoByAppId",async:true,data:{expenditureAppId:serveExamine.appId,"CASPARAMS":"OFF_INDEX"},success:function(data){var datas=eval('('+data+')');var d=datas.data;serveExamine.processInstanceId=d.processInstanceId;serveExamine.getCommentByProcessInstanceId(serveExamine.processInstanceId);serveExamine.costType=d.costType;me.saveData=d;if(d.jsFun){me[d.jsFun]()}me.showDetail(d);console.log(d.workFlowState);me.getPaymentAmountInfoList(d.expenditureAppId);$('.pay-detail,.print-div').show();$('#approve-users').attr("validform","{isNull:false,msg:'请选择审批人'}");$('.check-label').off('click');$('.check-label input').attr('disabled',true).off('click')}})},getCostAppInfoDetailByParams:function(appId,costType){var me=this;$.ajax({type:"post",url:$yt_option.base_path+"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{appId:appId,costType:costType,"CASPARAMS":"OFF_INDEX"},success:function(data){if(data){me.showCostDetail(data.data)}else{$yt_alert_Model.prompt(data.message)}}})},getReimPreviewDetailByReimAppId:function(reimAppId,previewFalg,qrCodeContext){var me=this;$.ajax({type:"post",url:$yt_option.base_path+"sz/reimApp/getCostAppInfoDetailByParams",async:true,data:{reimAppId:reimAppId,previewFalg:previewFalg,qrCodeContext:qrCodeContext,"CASPARAMS":"OFF_INDEX"},success:function(data){}})},getSubData:function(){var getFileList=function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length?',':'')});return str};var costReceptionistList=function(){var list=[];var trs=$('.msg-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costReceptionistId:tr.attr('pkId'),name:tr.find('.name-text').text(),jobName:tr.find('.job-text').text(),unitName:tr.find('.unit-text').text(),})});return list};var costDetailsList=function(){var list=[];var trs=$('#paymentList tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({costDetailsId:tr.attr('pkId'),publicServiceProCode:tr.attr('budgetcode'),activityDate:tr.find('.act-date').text(),placeName:tr.find('.place-name').text(),costType:tr.attr('costcode'),standardAmount:tr.find('.stan-money').attr('money'),activityAmount:tr.find('.money').attr('money'),peopleNum:tr.find('.people-num').text(),setMethod:''})});return list};var tripPlanList=function(){var list=[];var trs=$('#tripList tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelType:tr.attr('busicode'),travelAddress:tr.find('.address').attr('val'),travelAddressName:tr.find('.address').text(),startTime:tr.find('.sdate').text(),endTime:tr.find('.edate').text(),travelPersonnels:tr.attr('usercode'),receptionCostItem:tr.attr('rececode'),setMethod:''})});return list};var carfareList=function(){var costCarfareList=[];var costCarfareJson="";var cityDatas;if($("#traffic-list-info tbody tr:not(.total-last-tr)").length>0){$("#traffic-list-info tbody tr:not(.total-last-tr)").each(function(i,n){cityDatas=$(this).getDatas();cityDatas.crafare=$yt_baseElement.rmoney(cityDatas.crafare);cityDatas.setMethod='';if($(this).find(".hid-child-code").val()=="null"||$(this).find(".hid-child-code").val()==""){cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."}else{cityDatas.vehicle="."+$(this).find(".hid-vehicle").val()+"."+$(this).find(".hid-child-code").val()+"."}costCarfareList.push(cityDatas)})}return costCarfareList};var hotelList=function(){var costHotelList=[];var costHotelJson="";var hotelDatas;if($("#hotel-list-info tbody tr:not(.total-last-tr)").length>0){$("#hotel-list-info tbody tr:not(.total-last-tr)").each(function(i,n){hotelDatas=$(this).getDatas();hotelDatas.hotelExpense=$yt_baseElement.rmoney(hotelDatas.hotelExpense);hotelDatas.setMethod='';costHotelList.push(hotelDatas)});if(costHotelList.length>0){costHotelJson=JSON.stringify(costHotelList)}}return costHotelList};var otherList=function(){var costOtherList=[];var costOtherJson="";var otherDatas;if($("#other-list-info tbody tr:not(.total-last-tr)").length>0){$("#other-list-info tbody tr:not(.total-last-tr)").each(function(i,n){otherDatas=$(this).getDatas();otherDatas.reimAmount=$yt_baseElement.rmoney(otherDatas.reimAmount);otherDatas.setMethod='';costOtherList.push(otherDatas)});if(costOtherList.length>0){costOtherJson=JSON.stringify(costOtherList)}}return costOtherList};var costSubsidyList=function(){var list=[];var trs=$('#subsidy-list-info tbody tr:not(.last)');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({travelPersonnel:tr.find('.user').attr('code'),subsidyDays:tr.find('.subsidy-num').text(),subsidyFoodAmount:tr.find('.food').attr('num'),carfare:tr.find('.traffic').attr('num'),setMethod:''})});return list};var costData=function(){return JSON.stringify({costReceptionistList:costReceptionistList(),costDetailsList:costDetailsList(),travelRouteList:tripPlanList(),costCarfareList:carfareList(),costHotelList:hotelList(),costOtherList:otherList(),costSubsidyList:costSubsidyList()})};var billingVoucherJson=function(){var list=[];var trs=$('#tally-list tbody tr');var tr=null;$.each(trs,function(i,n){tr=$(n);list.push({billingVoucherId:tr.attr('pid'),toLoanType:tr.attr('loancode'),abstracts:tr.attr('abstract'),ledger:tr.attr('totalsubject'),detailed:tr.attr('detailsubject'),amount:tr.attr('tallymoney')})});return JSON.stringify(list)};return{advanceAppId:$('#advanceAppId').val(),loanAppId:$('#loanAppId').val(),reimAppId:$('#reimAppId').val(),reimAppNum:$('#reimAppNum').val(),reimAppName:$('#reimAppName').attr('val'),costType:$('#costTypeName').attr('val'),isSpecial:$('#isSpecial').attr('val'),specialCode:$('#specialName').attr('val'),invoiceNum:$('#invoiceNum').text(),totalAmount:$('#totalAmount').attr('num'),writeOffAmount:$('#writeOffAmount').attr('num'),officialCard:$('#officialCard').attr('num'),cash:$('#cash').attr('num'),cheque:$('#cheque').attr('num'),transfer:0,attIdStr:getFileList(),paymentDate:$('#paymentDate').val(),paymentAmount:$('#paymentAmount').val(),cmTotalAmount:$('#cmTotalAmount').attr('num'),cmWriteOffAmount:$('#cmWriteOffAmount').attr('num'),cmOfficialCard:$('#cmOfficialCard').val(),cmCash:$('#cmCash').val(),cmCheque:$('#cmCheque').val(),cmTransfer:0,applicantUser:$('#applicantUser').val(),parameters:'',dealingWithPeople:$('#approve-users option:selected').val(),opintion:$('#opintion').val(),processInstanceId:$('#processInstanceId').val(),nextCode:$('#operate-flow option:selected').val(),costData:[],billingVoucherJson:billingVoucherJson(),}},showDetail:function(d){var me=this;var fMoney=$yt_baseElement.fmMoney;$(".ordinary-div").setDatas(d);$('#busiUsers').text(d.applicantUserName);$('#deptName').text(d.applicantUserDeptName);$('#jobName').text(d.applicantUserPositionName==""?"--":d.applicantUserPositionName);$("#telPhone").text(d.applicantUserPhone==""?"--":d.applicantUserPhone);$("#expenditureAppName").text(d.expenditureAppName);$('#advanceAppId').val(d.advanceAppId);var outWriteAmount=d.totalAmount<=d.arrearsAmount?d.totalAmount:d.arrearsAmount;$('#outWriteAmount').text(fMoney(outWriteAmount||'0'));$('#reimAppId').val(d.reimAppId);$('#advanceAppNum').text((d.advanceAppNum==''?'--':d.advanceAppNum));if(d.advanceAppNum){$('.advance-relevance').show();$('#advanceAppBalance').text(d.advanceAppBalance?(fMoney(d.advanceAppBalance)+'元'):'--')}if(d.prjName){$('#prjName').text(d.prjName);$('.prj-name-tr').show()}$('#reimAppNum').val(d.reimAppNum);$('#formNum').text(d.expenditureAppNum).attr('val',d.expenditureAppNum);$('#reimAppName').text(d.reimAppName).attr('val',d.advanceAppReason);$('#costTypeName').text(d.costTypeName).attr('val',d.costType);$('#specialName').text((d.specialName==''?'--':d.specialName)).attr('val',d.specialCode);$('#budgetBalanceAmount').text(d.budgetBalanceAmount?fMoney(d.budgetBalanceAmount)+'万元':'--');$('#deptBudgetBalanceAmount').text(d.deptBudgetBalanceAmount?fMoney(d.deptBudgetBalanceAmount)+'万元':'--');$('#invoiceNum').text(d.invoiceNum||'0');$('#totalAmount').text(fMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$('#amountTotalMoney').text(fMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$('#paymentList .total-money').text(fMoney(d.totalAmount||'0')).attr('num',d.totalAmount);$('#totalMoneyUpper').text(arabiaToChinese(d.totalAmount+''||'0'));$('#writeOffAmount,#outWriteAmount').text(fMoney(d.writeOffAmount||'0')).attr('num',d.writeOffAmount);$('#balanceMoney').text(fMoney(d.totalAmount<d.loanAppBalance?d.loanAppBalance-d.totalAmount:'0'));$('#officialCard').text(fMoney(d.officialCard||'0')).attr('num',d.officialCard);$('#cash').text(fMoney(d.cash||'0')).attr('num',d.cash);$('#cheque').text(fMoney(d.cheque||'0')).attr('num',d.cheque);var body=$('#applyTable tbody');var total= +d.officialCard+ +d.cash+ +d.cheque+0;var rtotal=fMoney(total||'0');body.find('.total').text(rtotal).attr('num',total);$('#replaceMoney,#cmReplaceMoney').text(fMoney(total));$('#paymentDate').text(d.paymentDate);$('#paymentAmount').text(fMoney(d.paymentAmount||'0'));var cmTotalAmount=d.cmTotalAmount?d.cmTotalAmount:d.totalAmount;$('#cmTotalAmount').text(fMoney(cmTotalAmount||'0')).attr('num',cmTotalAmount);var cmWriteOffAmount= +cmTotalAmount- +d.cmWriteOffAmount;cmWriteOffAmount=cmWriteOffAmount>0?cmWriteOffAmount:'';$('#cmWriteOffAmount').text(fMoney(d.cmWriteOffAmount||'0')).attr('num',d.cmWriteOffAmount);$('#cmOfficialCard').text(fMoney(d.cmOfficialCard||'0'));$('#cmCash').text(fMoney(d.cmCash||'0'));$('#cmCheque').text(fMoney(d.cmCheque||'0'));$('#applicantUser').val(d.applicantUser);$('#applicantTime').text(d.applicantTime);$('#operate-flow option[value="'+d.nodeNowState+'"]').attr('selected',true);$('#processInstanceId').val(serveExamine.processInstanceId);me.getCommentByProcessInstanceId(serveExamine.processInstanceId);$('#approve-users option[value="'+d.currentAssignee+'"]').attr('selected',true);$('#operate-flow,#approve-users').niceSelect();me.showFileList(d.attList);me.showCostDetail(d.costData);},showCostDetail:function(data){var me=this;var fMoney=$yt_baseElement.fmMoney;var costReceptionistList=data.costReceptionistList;var costDetailsList=data.costDetailsList;var receHtml='';$.each(costReceptionistList,function(i,n){receHtml+='<tr pkId="'+n.costReceptionistId+'" class="" nameVal="'+n.name+'" dutyVal="'+n.jobName+'" deptVal="'+n.unitName+'"><td><span class="num">1</span></td><td><span class="name-text">'+n.name+'</span></td><td><span class="job-text">'+n.jobName+'</span></td><td><span class="unit-text">'+n.unitName+'</span></td></tr>'});$('.msg-list tbody').append(receHtml);me.resetNum($('.msg-list'));var detaHtml='';var costDetaClose=$('#paymentList').next().find('.check-label input');var thisTotal=0;$.each(costDetailsList,function(i,n){detaHtml+='<tr pkId="'+n.costDetailsId+'" budgetCode="'+n.publicServiceProCode+'" costCode="'+n.costType+'" budgetProject="'+n.publicServiceProName+'" applyDate="'+n.activityDate+'" siteVal="'+n.placeName+'" costBreakdown="'+n.costTypeName+'" standardMoney="'+n.standardAmount+'" budgetMoney="'+n.activityAmount+'" accompanyNum="'+n.peopleNum+'"><td><span class="">'+n.publicServiceProName+'</span></td><td><span class="act-date">'+n.activityDate+'</span></td><td><span class="place-name">'+n.placeName+'</span></td><td>'+n.costTypeName+'</td>'+'<td style="text-align: right;"><div class="money" money='+n.activityAmount+'>'+fMoney(n.activityAmount||'0')+'</div></td><td><span class="people-num">'+n.peopleNum+'</span></td></tr>';thisTotal+= +n.activityAmount;if(costDetaClose.length>0&&n.setMethod){costDetaClose.setCheckBoxState('check')}});detaHtml+='<tr><td>合计</td><td></td><td></td><td></td><td style="text-align: right;" class="total-money">'+$yt_baseElement.fmMoney(thisTotal)+'</td><td></td></tr>';$('#paymentList .yt-tbody').html(detaHtml);var tripPlanList=data.travelRouteList;var tripHtml='';var travelPersonnelsList=[];var getUserNames=function(list){var str='';$.each(list,function(i,n){str+=n.travelPersonnelName+(i<list.length-1?'、':'')});return str};var costItem=function(str){switch(str){case '1':return '住宿费';break;case '2':return '伙食费';break;case '3':return '市内交通费';break;default:return '';break}};var getCostItemName=function(str){var txt='';if(str){var list=str.split(',');$.each(list,function(i,n){if(n){txt+=costItem(n)+(i<list.length-1?'、':'')}});return txt}return '--'};$.each(tripPlanList,function(i,n){var dateFrom=new Date(n.startTime);var dateTo=new Date(n.endTime);var diff=dateTo.valueOf()-dateFrom.valueOf();var diff_day=parseInt(diff/(1000*60*60*24));tripHtml+='<tr busicode="'+n.travelType+'" usercode="'+n.travelPersonnels+'" rececode="'+n.receptionCostItem+'" ><td><input type="hidden" class="hid-user-code" value="'+n.travelPersonnels+'" /> <span class="name">'+n.travelTypeName+'</span></td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="day">'+diff_day+'</td><td class="address" val="'+n.travelAddress+'">'+n.travelAddressName+'</td><td class="uname">'+getUserNames(n.travelPersonnelsList)+'</td><td class="numof">'+n.travelPersonnelsList.length+'</td><td class="reception">'+getCostItemName(n.receptionCostItem)+'</td></tr>'});$('#tripList tbody').html(tripHtml);var costCarfareList=data.costCarfareList;var carHtml='';var costCarfareClose=$('#traffic-list-info').next().find('.check-label input');$.each(costCarfareList,function(i,n){carHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" class="hid-traf-users" value="'+n.travelPersonnel+'"/></td><td>'+n.travelPersonnelsDept+'</td><td data-text="goTime">'+n.goTime+'</td><td><input data-val="goAddress" type="hidden" value="'+n.goAddress+'"><span data-text="goAddressName">'+n.goAddressName+'</span></td><td data-text="arrivalTime">'+n.arrivalTime+'</td><td><input data-val="arrivalAddress" type="hidden" value="'+n.arrivalAddress+'"> <span data-text="arrivalAddressName">'+n.arrivalAddressName+'</span></td><td><span data-text="vehicle">'+n.vehicleName+'</span><input type="hidden" class="hid-vehicle" value="'+n.vehicle+'"/><input type="hidden" class="hid-child-code" value=""/></td><td class="font-right money-td" data-text="crafare">'+(n.crafare==""?"--":fMoney(n.crafare||'0'))+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"无":n.remarks)+'</td><td style="display:none;"><input type="hidden" class="hid-cost-type" value="0"/><span class="operate-update"><img src="../resources/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../resources/images/common/del-icon.png"/></span></td></tr>';if(costCarfareClose.length>0&&n.setMethod){costCarfareClose.setCheckBoxState('check')}});carHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td></tr>';$('#traffic-list-info tbody').html(carHtml);serveExamine.updateMoneySum(0);var costHotelList=data.costHotelList;var hotelHtml='';var costHotelClose=$('#hotel-list-info').next().find('.check-label input');$.each(costHotelList,function(i,n){var avg=n.hotelDays>0?fMoney((+n.hotelExpense/ +n.hotelDays)||'0'):n.hotelExpense;hotelHtml+='<tr><td><span>'+n.travelPersonnelName+'</span><input type="hidden" data-val="travelPersonnel" value="'+n.travelpersonnel+'"/></td><td>'+n.travelPersonnelsJobLevelName+'</td>'+'<td class="font-right">'+avg+'</td><td risk-code-val="hotelCheckInDate" class="check-in-date"><span class="sdate">'+n.hotelTime+'</span></td><td class="leave-date"><span class="edate">'+n.leaveTime+'</span></td><td data-text="hotelDays">'+n.hotelDays+'</td><td class="font-right money-td" data-text="hotelExpense">'+fMoney(n.hotelExpense||'0')+'</td><td><span data-text="hotelAddressName">'+n.hotelAddressName+'</span><input type="hidden" data-val="hotelAddress" value="'+n.hotelAddress+'"</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"无":n.remarks)+'</td><td style="display:none;"><input type="hidden" class="hid-set-met" data-val="setMethod"/><input type="hidden" class="hid-cost-type" value="1"/><span class="operate-update"><img src="../resources/images/common/edit-icon.png"/></span><span class="operate-del"><img src="../resources/images/common/del-icon.png"/></span></td></tr>';if(costHotelClose.length>0&&n.setMethod){costHotelClose.setCheckBoxState('check')}});hotelHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td></td><td></td><td></td><td></td><td></td><td class="font-right"><span class="tab-font-blod money-sum">0.00</span></td><td></td><td></td></tr>';$('#hotel-list-info tbody').html(hotelHtml);serveExamine.updateMoneySum(1);var costOtherList=data.costOtherList;var otherHtml='';var costOtherClose=$('#other-list-info').next().find('.check-label input');$.each(costOtherList,function(i,n){otherHtml+='<tr><td><span>'+n.costTypeName+'</span><input type="hidden" data-val="costType" value="'+n.costType+'"/></td><td class="font-right money-td" data-text="reimAmount">'+fMoney(n.reimAmount||'0')+'</td><td class="text-overflow-sty" data-text="remarks" title="'+n.remarks+'">'+(n.remarks==""?"无":n.remarks)+'</td></tr>';if(costOtherClose.length>0&&n.setMethod){costOtherClose.setCheckBoxState('check')}});otherHtml+='<tr class="total-last-tr"><td><span class="tab-font-blod">合计</span></td><td class="font-right"><span class="tab-font-blod money-sum"></span></td><td></td></tr>';$('#other-list-info tbody').html(otherHtml);serveExamine.updateMoneySum(2);var costSubsidyList=data.costSubsidyList;var subHtml='';var totalFood=0;var totalTraffic=0;$.each(costSubsidyList,function(i,n){subHtml+='<tr class="'+n.travelPersonnel+'" code="'+n.travelPersonnel+'"><td><div class="user" code="'+n.travelPersonnel+'">'+n.travelPersonnelName+'</div></td><td><div class="lv">'+n.travelPersonnelsDept+'</div></td><td><div class="subsidy-num">'+n.subsidyDays+'</div></td><td><div style="text-align:right;" class="food">'+fMoney(n.subsidyFoodAmount||'0')+'</div></td><td><div  style="text-align:right;" class="traffic">'+fMoney(n.carfare||'0')+'</div></td></tr>';totalFood+= +n.subsidyFoodAmount;totalTraffic+= +n.carfare});subHtml+='<tr class="last"><td>合计</td><td></td><td></td><td class="total-food"  style="text-align:right;">'+fMoney(totalFood||'0')+'</td><td class="total-traffic"  style="text-align:right;">'+fMoney(totalTraffic||'0')+'</td></tr>';$('#subsidy-list-info tbody').html(subHtml);var meetingList=data.meetingList;$.each(meetingList,function(i,n){$("#meetTypeName").text(n.meetTypeName);$("#meetName").text(n.meetName);$("#meetAddress").text(n.meetAddress);$("#meetStartTime").text(n.meetStartTime);$("#meetEndTime").text(n.meetEndTime);$("#meetDays").text(n.meetDays);$("#meetOfNum").text(n.meetOfNum);$("#meetWorkerNum").text(n.meetWorkerNum)});var meetingCostList=data.meetingCostList;$.each(meetingCostList,function(i,n){$("#meetHotel").text(n.meetHotel);$("#meetFood").text(n.meetFood);$("#meetOther").text(n.meetOther);$("#meetAmount").text(n.meetAmount);$("#meetAverage").text(n.meetAverage)});var payReceivablesData=me.saveData.payReceivablesData;var gatheringUnitList=payReceivablesData.gatheringUnitList;var otherPayeeHtml="";var otherPayeeTotale=0;$.each(gatheringUnitList,function(i,n){otherPayeeHtml+='<tr><td>'+n.unitName+'</td><td >'+n.reverseTheWayName+'</td><td style="text-align:right;">'+$yt_baseElement.fmMoney(n.amount)+'</td><td >'+n.openBank+'</td><td >'+n.accounts+'</td><td >'+(n.isContract==1?'是':'否')+'</td><td >'+(n.remarks==''?'无':n.remarks)+'</td></tr>';otherPayeeTotale+= +n.amount});$(".payee-unit .yt-tbody .payee-unit-total").before(otherPayeeHtml);$(".payee-unit .payee-unit-total .payee-unit-money").text($yt_baseElement.fmMoney(otherPayeeTotale));if(gatheringUnitList.length==0){$(".payee-unit-model").hide()}var gatheringPersonList=payReceivablesData.gatheringPersonList;var gatheringPersonHtml="";var gatheringPersonTotale=0;$.each(gatheringPersonList,function(i,n){var theReverseMoney=n.amount<=n.loanAppArrearsAmount?n.amount:n.loanAppArrearsAmount;gatheringPersonHtml+='<tr class="payee-personal-tr" pkid="" payeeval="'+n.personalCode+'" payeename="'+n.personalName+'" pedepartment="'+n.personalDept+'" perank="'+n.personalJobLevelName+'" personaltotal="'+n.amount+'" witeoffpersonal="'+n.reverseTheWay+'" personalwriteoff="'+n.replaceAmount+'" cash="'+n.cash+'" officialcard="'+n.officialCard+'" transferaccounts="'+n.transfer+'" payeeradio="'+n.isContract+'" personalspecial="'+n.remarks+'" idcarkno="'+n.idCard+'" payeebank="'+n.accounts+'" bankname="'+n.openBank+'" phonenum="'+n.phoneNum+'" choiceloan="'+n.loanAppNum+'" choiceloanval="'+n.loanAppId+'" arrearsmoney="'+n.loanAppArrearsAmount+'" thereversemoney="0.00" offOpenBank="'+n.offOpenBank+'" offAccounts="'+n.offAccounts+'"><td class="per" value="personal">'+n.personalName+'</td><td style="text-align: right;" class="personalTotal">'+n.amount+'</td><td>'+(n.reverseTheWayName?n.reverseTheWayName:'无')+'</td><td style="text-align: right;">'+(serveExamine.fmMoney(theReverseMoney))+'</td><td style="text-align: right;">'+(serveExamine.fmMoney(n.replaceAmount))+'</td><td style="text-align: right;">'+(serveExamine.fmMoney(n.cash))+'</td><td style="text-align: right;">'+(serveExamine.fmMoney(n.officialCard))+'</td><td style="text-align: right;">'+(serveExamine.fmMoney(n.transfer))+'</td><td><a class="yt-link to-data">详情</a></td><td>'+(n.isContract==1?'有':'无')+'</td><td>'+n.remarks+'</td></tr>';gatheringPersonTotale+= +n.amount});$(".payee-personal .yt-tbody .payee-personal-total").before(gatheringPersonHtml);$(".payee-personal .payee-personal-total .payee-personal-money").text($yt_baseElement.fmMoney(gatheringPersonTotale));if(gatheringPersonList.length==0){$(".payee-personal-model").hide()}var gatheringOtherList=payReceivablesData.gatheringOtherList;var gatheringOtherHtml="";var gatheringOtherTotale=0;$.each(gatheringOtherList,function(i,n){gatheringOtherHtml+='<tr><td>'+n.otherName+'</td>'+'<td >'+n.reverseTheWayName+'</td>'+'<td style="text-align:right;">'+$yt_baseElement.fmMoney(n.amount)+'</td>'+'<td >'+(n.isContract==1?'是':'否')+'</td>'+'<td>'+(n.remarks==''?'无':n.remarks)+'</td>'+'</tr>';gatheringOtherTotale+= +n.amount});$(".payee-other .yt-tbody .payee-other-total").before(gatheringOtherHtml);$(".payee-other .payee-other-total .payee-other-total-money").text($yt_baseElement.fmMoney(gatheringOtherTotale));if(gatheringOtherList.length==0){$(".payee-other-model").hide()}if(gatheringOtherList.length==0&&gatheringPersonList.length==0&&gatheringUnitList.length==0){$(".payee-info-isshow").html('<table style="width:100%"><tr style="border:0px;background-color:#fff !important;"><td align="center"style="border:0px;"><div class="no-data" style="width: 280px;padding:0;margin: 0 auto;"><img src="../resources/images/common/no-data.png" alt="" style="padding:10px 0;"></div></td></tr></table>')}me.setTrainApplyInfoList(data.trainApplyInfoList);me.setTeacherApplyInfoList(data.teacherApplyInfoList);me.setCostTrainApplyInfoList(data.costTrainApplyInfoList);me.setCostTeachersFoodApplyInfoList(data.costTeachersFoodApplyInfoList);me.setCostTeachersLectureApplyInfoList(data.costTeachersLectureApplyInfoList);me.setCostTeachersTravelApplyInfoList(data.costTeachersTravelApplyInfoList);me.setCostTeachersHotelApplyInfoList(data.costTeachersHotelApplyInfoList);me.setCostNormalList(data.costNormalList);me.setCostSpecialList(data.costSpecialList);if(data.costCarfareList.length==0){$(".traffic-cost-div").hide()}if(data.costHotelList.length==0){$(".hotel-list-model").hide()}if(data.costOtherList.length==0){$(".other-cost-model").hide()}if(data.costSubsidyList.length==0){$(".subsidy-model").hide()}if(data.costCarfareList.length==0&&data.costHotelList.length==0&&data.costOtherList.length==0&&data.costSubsidyList.length==0){$(".cost-list-model").html('<table style="width:100%"><tr style="border:0px;background-color:#fff !important;"><td align="center"style="border:0px;"><div class="no-data" style="width: 280px;padding:0;margin: 0 auto;"><img src="../resources/images/common/no-data.png" alt="" style="padding:10px 0;"></div></td></tr></table>')}if(data.costTrainApplyInfoList.length==0&&data.costTeachersFoodApplyInfoList==0&&data.costTeachersLectureApplyInfoList==0&&data.costTeachersTravelApplyInfoList==0&&data.costTeachersHotelApplyInfoList==0){$("#costDetailDiv").html('<table style="width:100%"><tr style="border:0px;background-color:#fff !important;"><td align="center"style="border:0px;"><div class="no-data" style="width: 280px;padding:0;margin: 0 auto;"><img src="../resources/images/common/no-data.png" alt="" style="padding:10px 0;"></div></td></tr></table>')}},setTrainApplyInfoList:function(list){var html='';$.each(list,function(i,n){$('#trainType').text(n.trainTypeName);$('#regionDesignation').text(n.regionDesignation);$('#regionName').text(n.regionName);$('#reportTime').text(n.reportTime);$('#endTime').text(n.endTime);$('#trainDays').text(n.trainDays);$('#trainOfNum').text(n.trainOfNum);$('#workerNum').text(n.workerNum)});$('#trainingPopTable tbody').html(html)},setTeacherApplyInfoList:function(list){var html='';$.each(list,function(i,n){html+='<tr><td class="lecturerName"><input type="hidden" class="lectureId" value="'+n.lecturerId+'"><span>'+n.lecturerName+'</span></td><td class="professional">'+n.lecturerTitleName+'</td><td class="level">'+n.lecturerLevelName+'</td><td style="display:none"><span class="operate-update"><img src="../resources/images/common/edit-icon.png"></span><span class="operate-del"><img src="../resources/images/common/del-icon.png"></span></td></tr>'});$('#lecturerTable tbody').html(html)},setCostTrainApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr><td>'+n.trainTypeName+'</td><td class="moneyText">'+$yt_baseElement.fmMoney(n.standard)+'</td><td>'+n.trainOfNum+'</td><td>'+n.trainDays+'</td><td class="moneyText">'+$yt_baseElement.fmMoney(n.averageMoney)+'</td><td>'+(n.remark==''?'无':n.remark)+'</td></tr>';total+= +n.averageMoney});html+='<tr class="last"><td>合计</td><td></td><td></td><td></td><td class="moneyText costTotal">'+$yt_baseElement.fmMoney(total)+'</td><td></td></tr>';$('#trainingFeeTable tbody').html(html);if(list.length==0){$('.train-money').hide();$('.train-money').parent().hide();$('#trainingFeeTable,.other-title-train').hide()}},setCostTeachersFoodApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.foodId+'"><td><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="avg" style="text-align: right;">'+serveExamine.fmMoney(n.averageMoney)+'</td><td class="day">'+n.foodOfDays+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.foodAmount)+'</td><td class="dec">'+n.remarks+'</td><td style="display:none"><input type="hidden" class="popM" value="4"/><span class="operate-update"><img src="../resources/images/common/edit-icon.png"></span><span class="operate-del"><img src="../resources/images/common/del-icon.png"></span></td></tr>';total+= +n.foodAmount});$('#dietFeeTable tbody .end-tr').before(html);$('#dietFeeTable tbody .costTotal').text(serveExamine.fmMoney(total));if(list.length==0){$('.food-money').hide();$('.food-money').parent().hide();$('#dietFeeTable').hide()}},setCostTeachersLectureApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersLectureId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="holder">'+n.lecturerTitleName+'</td><td class="hour">'+n.teachingHours+'</td><td class="cname">'+n.courseName+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.perTaxAmount)+'</td><td class="moneyText after">'+serveExamine.fmMoney(n.afterTaxAmount)+'</td><td class="moneyText avg">'+serveExamine.fmMoney(n.averageMoney)+'</td><td style="display:none"><input type="hidden" class="popM" value="1"/><span class="operate-update"><img src="../resources/images/common/edit-icon.png"></span><span class="operate-del"><img src="../resources/images/common/del-icon.png"></span></td></tr>';total+= +n.perTaxAmount});$('#lectureFeeTable tbody .end-tr').before(html);$('#lectureFeeTable tbody .costTotal').text(serveExamine.fmMoney(total));if(list.length==0){$('.lecture-money').hide();$('.lecture-money').parent().hide();$('#lectureFeeTable').hide()}},setCostTeachersTravelApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersTravelId+'"><td class="uname"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="ulv">'+n.lecturerLevelName+'</td><td class="sdate">'+n.goTime+'</td><td class="edate">'+n.arrivalTime+'</td><td class="sadd"><input type="hidden" class="scode" value="'+n.goAddress+'">'+n.goAddressName+'</td><td class="eadd"><input type="hidden" class="ecode" value="'+n.arrivalAddress+'">'+n.arrivalAddressName+'</td><td class="tname"><input type="hidden" class="tool" value="'+n.vehicle+'">'+n.vehicleName+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.carfare)+'</td><td class="dec">'+n.remarks+'</td><td  style="display:none"><input type="hidden" class="popM" value="2"/><span class="operate-update"><img src="../resources/images/common/edit-icon.png"></span><span class="operate-del"><img src="../resources/images/common/del-icon.png"></span></td></tr>';total+= +n.carfare});$('#carFeeTable tbody .end-tr').before(html);$('#carFeeTable tbody .costTotal').text(serveExamine.fmMoney(total));if(list.length==0){$('.traffic-money').hide();$('.traffic-money').parent().hide();$('#carFeeTable').hide()}},setCostTeachersHotelApplyInfoList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr pid="'+n.teachersHotelId+'"><td class="name"><input type="hidden" class="lectureId" value="'+n.lecturerId+'">'+n.lecturerName+'</td><td class="sdate">'+n.startTime+'</td><td class="edate">'+n.endTime+'</td><td class="moneyText avg">'+serveExamine.fmMoney(n.averageMoney)+'</td><td class="day">'+n.hotelDays+'</td><td class="moneyText sum-pay">'+serveExamine.fmMoney(n.hotelExpense)+'</td><td class="dec">'+n.remarks+'</td><td style="display:none"><input type="hidden" class="popM" value="3"/><span class="operate-update"><img src="../resources/images/common/edit-icon.png"></span><span class="operate-del"><img src="../resources/images/common/del-icon.png"></span></td></tr>';total+= +n.hotelExpense});$('#hotelFeeTable tbody .end-tr').before(html);$('#hotelFeeTable tbody .costTotal').text(serveExamine.fmMoney(total));if(list.length==0){$('.accommodation-money').hide();$('.accommodation-money').parent().hide();$('#hotelFeeTable').hide()}},setCostNormalList:function(list){var html='';var total=0;$.each(list,function(i,n){html+='<tr><td style="text-align:left;" class="reimContent">'+n.normalName+'</td><td style="text-align: right;" class="reimAmount">'+($yt_baseElement.fmMoney(n.normalAmount))+'</td><td>'+(n.remarks==''?'无':n.remarks)+'</td></tr>';total+= +n.normalAmount});$('.ordinary-approval #costList tbody .last').before(html);$('.ordinary-approval #costList tbody #reimAmountlSum').text($yt_baseElement.fmMoney(total))},setCostSpecialList:function(list){var html='';var specialAmountSum=0;var deductBudgetAmountSum=0;var code=$('#costTypeName').attr('val');if(code=='SOCIAL_SECURITY_FEE'||code=='MEDICAL_EXPENSES'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'){$.each(list,function(i,n){html+='<tr class="yt-tab-row"><td  class="specialContent">'+n.specialName+'</td><td style="text-align: right;" class="specialAmount">'+($yt_baseElement.fmMoney(n.specialAmount))+'</td><td class="specialInstructions"> '+(n.remarks||'')+'</td></tr>';specialAmountSum+= +n.specialAmount});$('.ordinary-approval #specialCostList tbody .last').before(html);$('.ordinary-approval #specialCostList tbody #specialAmountSum').text($yt_baseElement.fmMoney(specialAmountSum))}else if(code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'){$.each(list,function(i,n){html+='<tr class="yt-tab-row"><td  class="specialContent">'+n.specialName+'</td><td style="text-align: right;" class="specialAmount">'+($yt_baseElement.fmMoney(n.specialAmount))+'</td><td style="text-align: right;" class="deductBudgetAmount">'+($yt_baseElement.fmMoney(n.deductBudgetAmount))+'</td><td class="specialInstructions"> '+(n.remarks||'')+'</td></tr>';specialAmountSum+= +n.specialAmount;deductBudgetAmountSum+= +n.deductBudgetAmount});$('.ordinary-approval #specialCostList tbody .last').before(html);$('.ordinary-approval #specialCostList tbody #specialAmountSum').text($yt_baseElement.fmMoney(specialAmountSum));$('.ordinary-approval #specialCostList tbody #deductBudgetAmountSum').text($yt_baseElement.fmMoney(deductBudgetAmountSum))}},showFileList:function(list){var ls='';var src='';if(list.length){$.each(list,function(i,n){var imgType=n.attName.split('.');if(imgType.length>1&&(imgType[1]=='png'||imgType[1]=='jpeg'||imgType[1]=='bmp'||imgType[1]=='jpg')){src=$yt_option.base_path+'fileUpDownload/download?pkId='+n.attId+'&isDownload=false';ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pv">预览<img src="'+src+'" ></label></div>'}else{ls+='<div fid="'+n.attId+'" class="li-div"><span class="file-name" >'+n.attName+'</span><label class="file-dw">下载</label><label class="file-pvno">预览</label></div>'}})}$('#attIdStr').html(ls);$('#attIdStr .file-dw').on('click',function(){var id=$(this).parent().attr('fid');window.location.href=$yt_option.base_path+'fileUpDownload/download?pkId='+id+'&isDownload=true'});$('#attIdStr .file-pv img').showImg();if(list.length==0){$("#attIdStr").html("<span style='color:;'>暂无附件</span>")}},showBillingVoucherList:function(list){var totalText='';var detailText='';var html='';$.each(function(i,n){if(n.toLoanType=='DEBIT_ENTRY'){totalText=n.amount}else{detailText=n.amount}html+='<tr pid="'+n.billingVoucherId+'" class="" loanCode="'+n.toLoanType+'" loanType="'+n.toLoanTypeName+'" abstract="'+n.abstracts+'" totalSubject="'+n.ledger+'" detailSubject="'+n.detailed+'" tallyMoney="'+n.amount+'"><td>'+n.abstracts+'</td><td>'+n.ledger+'</td><td>'+n.detailed+'</td><td>'+totalText+'</td><td>'+detailText+'</td></tr>'});$('.tally-list').append(html)},getDictInfoByTypeCode:function(){$.ajax({type:"post",url:$yt_option.base_path+"basicconfig/dictInfo/getDictInfoByTypeCode",async:true,data:{dictTypeCode:'TO_LOAN_TYPE',"CASPARAMS":"OFF_INDEX"},success:function(data){var list=data.data||[];var optone='<option value="">请选择</option>';$.each(list,function(i,n){optone+='<option value="'+n.value+'">'+n.disvalue+'</option>'});$('#loanType').html(optone).niceSelect();}})},resetNum:function(obj){var trs=obj.find('tbody tr');$.each(trs,function(i,n){$(n).find('.num').text(i+1)})},submitReimAppInfo:function(subData){$.ajax({type:"post",url:$yt_option.base_path+"sz/reimApp/submitReimAppInfo",async:true,data:subData,success:function(data){$yt_alert_Model.prompt(data.message);if(data.flag==0){window.location.href=$yt_option.websit_path+'view/system/expensesReim/module/reimApply/reimApproveList.html'}}})},getTotleMoney:function(){var tds=$('#paymentList tbody .money');var total=0;$.each(tds,function(i,n){total+= +$(n).attr('money')});var fmTotal=$yt_baseElement.fmMoney(total||'0');$('#paymentList tbody .total-money').text(fmTotal);$('#applyTotalMoney').text(fmTotal).attr('num',total);$('#amountTotalMoney').text(fmTotal).attr('num',total);$('#TotalMoneyUpper').text(arabiaToChinese(fmTotal));var writeOffAmount= +($('#writeOffAmount').attr('num'));var num=total-writeOffAmount;if(num>=0){$('#replaceMoney').text($yt_baseElement.fmMoney(num))}else{$('#balanceMoney').text($yt_baseElement.fmMoney(num))}},getSaveData:function(){var me=this;var data=me.saveData;data.paymentDate=$('#paymentDate').val();data.paymentAmount=$('#paymentAmount').val();data.cmTotalAmount=$('#cmTotalAmount').attr('num');data.cmWriteOffAmount=$('#cmWriteOffAmount').attr('num');data.cmOfficialCard=$yt_baseElement.rmoney($('#cmOfficialCard').val()||'0');data.cmCash=$yt_baseElement.rmoney($('#cmCash').val()||'0');data.cmCheque=$yt_baseElement.rmoney($('#cmCheque').val()||'0');data.costData=JSON.stringify(data.costData);data.nextCode=$('#operate-flow option:selected').val();data.dealingWithPeople=$('#approve-users option:selected').val();data.attIdStr=me.getFileList();return data},getFileList:function(){var str='';var list=$('#attIdStr .li-div');$.each(list,function(i,n){str+=$(n).attr('fid')+(i<list.length?',':'')});return str},showBusinessFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.index-main-div').show();serveExamine.loadingWord('view/system/expensesReim/module/reimApply/hospitalitySpendingDetail.html')},showGeneralFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.index-main-div').show();serveExamine.loadingWord('view/system/expensesReim/module/reimApply/costDetailApproval.html')},showTravelFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.index-main-div').show();serveExamine.loadingWord('view/system/expensesReim/module/reimApply/travelSpendingDetails.html')},showTrainFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();$('.index-main-div').show();serveExamine.loadingWord('view/system/expensesReim/module/busiTripApply/trainApproval.html')},showMettingFun:function(){$('.qtip-text-div').hide();$('.mod-div').hide();$('.dottom-div,.approve-div').show();$('.grod-div').show();serveExamine.loadingWord('view/system/expensesReim/module/beforehand/meetingCostApplyDetails.html')},showSheBaoFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();serveExamine.loadingWord('view/system/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},showYingJiaoFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();serveExamine.loadingWord('view/system/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},showYiLiaoFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();serveExamine.loadingWord('view/system/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},showGongHuiFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();serveExamine.loadingWord('view/system/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},showDangJianFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();serveExamine.loadingWord('view/system/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},showKouChuFun:function(){$('.index-main-div').html('');$('.qtip-text-div').hide();$('.mod-div').hide();$('.approve-div,.else-div').show();$("#payeeInformation").hide();$(".appr-flow-log").hide();serveExamine.loadingWord('view/system/expensesReim/module/reimApply/costDetail.html');$(".rece-msg").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show();$(".advance-file-div").hide();$("#advanceApplication").hide();$("#costSpending").hide();$("#socialSecurity").show();$(".special-btn").hide();$(".operation").hide()},clearexamine:function(){$("#clearBtn").off().on("click",function(){$yt_common.parentAction({url:$yt_option.parent_action_path,funName:'locationToMenu',data:{url:'view/system/expensesReim/module/reimApply/reimApproveList.html'}})})},getCommentByProcessInstanceId:function(){var processInstanceId=serveExamine.processInstanceId;$.ajax({type:"post",url:$yt_option.base_path+"basicconfig/workFlow/getWorkFlowLog",async:false,data:{processInstanceId:processInstanceId,"CASPARAMS":"OFF_INDEX"},success:function(data){var txt='';var data=eval('('+data+')');if(!!data&&data.flag=='0'){var list=data.data||[];var imgUrl="";for(var i=0,len=list.length;i<len;i+=1){if(i==0){imgUrl="../resources/images/common/log-border-color.png"}else{imgUrl="../resources/images/common/log-info-border.png"}txt+='<div class="log-info">'+(i==list.length-1?'':'<div class="log-icon-border"></div>')+'<div class="log-icon"><img src="'+(list.length==1?'../resources/images/common/num-icon-one.png':(i==0?'../resources/images/common/log-num-first.png':'../resources/images/common/log-num.png'))+'" /><div class="log-icon-num" '+(i==0?'style="top: 7px;"':'')+'>'+(list.length-i)+'<div></div></div></div><div class="log-details '+(i==0?"log-shadow-sty":"")+'" '+((list[i].comment==undefined||list[i].comment==null||list[i].comment=="")?'style="padding-bottom: 30px;"':'')+'><label class="log-task-name">【'+list[i].taskName+'】</label><label class="log-name">'+list[i].userName+'</label><img style="'+(i==0?"left: -9px;":"left:-8px;")+'" src="'+imgUrl+'"/><div><p><label class="log-title">操作状态：</label><span class="log-state">'+list[i].operationState+'</span></p>'+((list[i].comment==undefined||list[i].comment==null||list[i].comment=="")?'':('<p class="log-ideap"><label class="log-title">操作意见：</label><label class="log-idea">'+list[i].comment+'</label></p>'))+'</div></div><label class="log-time">'+list[i].commentTime+'</label></div>'}$('.flow-div').html(txt)}else{$(".appr-flow-log").hide()}}})},setPayDetailList:function(list){var html='';var total=0;$('.pay-detail-tabel tbody tr:not(.pay-detail-tabel-total)').remove();if(list&&list.length>0){$.each(list,function(i,n){html+='<tr pid="'+n.receivablesId+'" type="'+n.receivablesType+'" payee="'+n.receivablesId+'" payment="'+n.paymentDate+'" paymentmoney="'+n.paymentAmount+'"> <td class="payee" style="width: 100px;">'+n.receivablesName+'</td> <td class="payment" style="width: 100px;">'+n.paymentDate+'</td> <td class="">'+serveExamine.fmMoney(n.cash)+'</td> <td class="">'+serveExamine.fmMoney(n.officialCard)+'</td> <td class="">'+serveExamine.fmMoney(n.transfer)+'</td> <td class="paymentmoney" style="text-align: right;">'+serveExamine.fmMoney(n.paymentAmount)+'</td></tr>';total+= +n.paymentAmount})}$('.pay-detail-tabel .pay-detail-tabel-total').before(html);$('.pay-detail-tabel .payee-other-total-money').text(serveExamine.fmMoney(total))},getPaymentAmountInfoList:function(appId){$.ajax({type:"post",url:$yt_option.base_path+"sz/payDetailBillingVoucher/getPaymentAmountInfoList",async:true,data:{appId:appId,"CASPARAMS":"OFF_INDEX"},success:function(data){if(data.flag==0){var d=data.data;$('#mustMoney').text(serveExamine.fmMoney(d.totalAmount));var paymentAmount=d.paymentAmount;$('#alreadyMoney').text(serveExamine.fmMoney(paymentAmount));var paymentBalanceAmount=d.paymentBalanceAmount;$('#notMoney').text(serveExamine.fmMoney(paymentBalanceAmount));var payDetailList=d.payDetailList||[];serveExamine.setPayDetailList(payDetailList)}}})},updateMoneySum:function(thisTab){var moenySum=0.00;if(thisTab==0){$("#traffic-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#traffic-list-info tbody .money-sum").text(moenySum)}else{$("#traffic-list-info tbody .money-sum").text("0.00")}}if(thisTab==1){$("#hotel-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#hotel-list-info tbody .money-sum").text(moenySum)}else{$("#hotel-list-info tbody .money-sum").text("0.00")}}if(thisTab==2){$("#other-list-info tbody .money-td").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#other-list-info tbody .money-sum").text(moenySum)}else{$("#other-list-info tbody .money-sum").text("0.00")}}if(thisTab==3){$("#subsidy-list-info tbody .food-money").each(function(i,n){moenySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});moenySum=$yt_baseElement.fmMoney(moenySum);if(moenySum!=undefined&&$yt_baseElement.rmoney(moenySum)>0){$("#subsidy-list-info tbody .money-sum").text(moenySum)}else{$("#subsidy-list-info tbody .money-sum").text("0.00")}var cityMoneySum=0.00;$("#subsidy-list-info tbody .city-money").each(function(i,n){cityMoneySum+=parseFloat($yt_baseElement.rmoney($(n).text()))});cityMoneySum=$yt_baseElement.fmMoney(cityMoneySum);if(cityMoneySum!=undefined&&$yt_baseElement.rmoney(cityMoneySum)>0){$("#subsidy-list-info tbody .city-money-td").text(cityMoneySum)}else{$("#subsidy-list-info tbody .city-money-td").text("0.00")}}serveExamine.updateApplyMeonySum()},updateApplyMeonySum:function(){var sumMoney=0;$(".cost-list-model table .money-sum").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});$(".cost-list-model table .city-money-td").each(function(i,n){sumMoney+=$yt_baseElement.rmoney($(n).text())});sumMoney=$yt_baseElement.fmMoney(sumMoney);$("#applySumMoney").text(sumMoney);if($("body").find("#reimPrice")){$("#reimPrice").text(sumMoney);var loanPrice=$("#loanCost").text();var replPrice=$yt_baseElement.rmoney(sumMoney)-parseFloat(loanPrice);replPrice=$yt_baseElement.fmMoney(replPrice);$("#givePrice").text(replPrice)}if(sumMoney!=null&&sumMoney!=undefined&&$yt_baseElement.rmoney(sumMoney)>0){var sumMoneyLower=arabiaToChinese(sumMoney);$("#applyMoneyLower").text(sumMoneyLower)}else{$("#applySumMoney").text("0.00")}},loadingWord:function(url){if(url.indexOf("http://")!=0){url=$yt_option.websit_path+url}serveExamine.request_params={};if(url.indexOf("?")!=-1){var str=url.substr(url.indexOf("?")+1);strs=str.split("&");for(var i=0;i<strs.length;i+=1){serveExamine.request_params[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}}else{serveExamine.request_params=null}$("#indexMainDiv").html("");$.ajax({type:"get",url:url,async:false,data:{"CASPARAMS":"OFF_INDEX"},success:function(data){$("#indexMainDiv").html(data);$("body img").each(function(){$(this).attr("src",$(this).attr("src").replace("../../../../../","../"))});$("body link").each(function(){$(this).attr("href",$(this).attr("href").replace("../../../../../","../"))});$("body script").each(function(){$(this).attr("src",$(this).attr("src").replace("../../../../../","../"))})}})},GetQueryString:function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)");var r=window.location.search.substr(1).match(reg);if(r!=null){return unescape(r[2])}return null}};$(function(){serveExamine.init();serveExamine.clearexamine()})})(jQuery,window);function arabiaToChinese(Num){Num=Num+"";for(i=Num.length-1;i>=0;i-=1){Num=Num.replace(",","");Num=Num.replace(" ","");}Num=Num.replace("￥","");if(isNaN(Num)){$yt_alert_Model.prompt("请检查小写金额是否正确",2000);return}part=String(Num).split(".");newchar="";for(i=part[0].length-1;i>=0;i-=1){if(part[0].length>10){$yt_alert_Model.prompt("位数过大，无法计算",2000);return ""}tmpnewchar="";perchar=part[0].charAt(i);switch(perchar){case "0":tmpnewchar="零"+tmpnewchar;break;case "1":tmpnewchar="壹"+tmpnewchar;break;case "2":tmpnewchar="贰"+tmpnewchar;break;case "3":tmpnewchar="叁"+tmpnewchar;break;case "4":tmpnewchar="肆"+tmpnewchar;break;case "5":tmpnewchar="伍"+tmpnewchar;break;case "6":tmpnewchar="陆"+tmpnewchar;break;case "7":tmpnewchar="柒"+tmpnewchar;break;case "8":tmpnewchar="捌"+tmpnewchar;break;case "9":tmpnewchar="玖"+tmpnewchar;break}switch(part[0].length-i-1){case 0:tmpnewchar=tmpnewchar+"元";break;case 1:if(perchar!=0){tmpnewchar=tmpnewchar+"拾"}break;case 2:if(perchar!=0){tmpnewchar=tmpnewchar+"佰"}break;case 3:if(perchar!=0){tmpnewchar=tmpnewchar+"仟"}break;case 4:tmpnewchar=tmpnewchar+"万";break;case 5:if(perchar!=0){tmpnewchar=tmpnewchar+"拾"}break;case 6:if(perchar!=0){tmpnewchar=tmpnewchar+"佰"}break;case 7:if(perchar!=0){tmpnewchar=tmpnewchar+"仟"}break;case 8:tmpnewchar=tmpnewchar+"亿";break;case 9:tmpnewchar=tmpnewchar+"拾";break}newchar=tmpnewchar+newchar}if(Num.indexOf(".")!=-1){if(part[1].length>2){$yt_alert_Model.prompt("小数点之后只能保留两位,系统将自动截段",2000);part[1]=part[1].substr(0,2)}for(i=0;i<part[1].length;i+=1){tmpnewchar="";perchar=part[1].charAt(i);switch(perchar){case "0":tmpnewchar="零"+tmpnewchar;break;case "1":tmpnewchar="壹"+tmpnewchar;break;case "2":tmpnewchar="贰"+tmpnewchar;break;case "3":tmpnewchar="叁"+tmpnewchar;break;case "4":tmpnewchar="肆"+tmpnewchar;break;case "5":tmpnewchar="伍"+tmpnewchar;break;case "6":tmpnewchar="陆"+tmpnewchar;break;case "7":tmpnewchar="柒"+tmpnewchar;break;case "8":tmpnewchar="捌"+tmpnewchar;break;case "9":tmpnewchar="玖"+tmpnewchar;break}if(i==0){tmpnewchar=tmpnewchar+"角"}if(i==1){tmpnewchar=tmpnewchar+"分"}newchar=newchar+tmpnewchar}}while(newchar.search("零零")!=-1){newchar=newchar.replace("零零","零")}newchar=newchar.replace("零亿","亿");newchar=newchar.replace("亿万","亿");newchar=newchar.replace("零万","万");newchar=newchar.replace("零元","元");newchar=newchar.replace("零角","");newchar=newchar.replace("零分","");if(newchar.charAt(newchar.length-1)=="元"||newchar.charAt(newchar.length-1)=="角"){newchar=newchar+"整"}if(newchar=="元整"){newchar="--"}return newchar};$.fn.extend({showImg:function(obj){var imgId='show-img-box'+(parseInt(Math.random()*1000000000));var imgs=$(this);imgs.addClass(imgId);imgs.off().on("click",function(){var ulMl=$("#"+imgId).find("li").width()*imgs.index($(this))*-1;if($("#"+imgId).length>0){$("#"+imgId).find("ul").css("margin-left",ulMl+"px");$("#"+imgId).show();$('#pop-modle-alert').show()}else{var wHeigth=$(window).height();var wWidth=$(window).width();if(wWidth/wHeigth>20/13){wWidth=Math.floor(wHeigth*20/13-200)}else{wWidth=wWidth-100}var bannerWidth=Math.floor(wWidth*0.8);var hannerHeight=Math.floor(bannerWidth*13/20);var imgsElement=$('<div id="'+imgId+'" class="show-img-box"><a class="prev"></a><a class="next"></a></div>');$("body").append(imgsElement);var closeElement=$('<a class="close-btn" src="img/icons/atta-x.png"></a>');var imgBox=$('<div class="imgs-list"></div>');imgBox.css({width:bannerWidth,height:hannerHeight});closeElement.click(function(){$("#"+imgId).hide();$('#pop-modle-alert').hide()});imgsElement.append(closeElement).append(imgBox);var imgListEle=$('<ul style="width: '+($("."+imgId).length*bannerWidth)+'px;"></ul>');imgListEle.css("margin-left",ulMl+"px");$("."+imgId).each(function(){var img=new Image();var imgLi=$('<li></li>').append(img);imgLi.css({width:bannerWidth,height:hannerHeight});img.draggable=false;img.src=$(this).attr('src');img.name='viewImg';var meImg=imgLi.find("img");img.onload=function(){if(img.width/img.height>20/13){$(meImg).css("width","100%")}else{$(meImg).css("height","100%")}};imgListEle.append(imgLi)});imgBox.append(imgListEle);ulMl=imgsElement.find("li").width()*imgs.index($(this))*-1;imgsElement.find("ul").css("margin-left",ulMl+"px");imgsElement.find(".next").click(function(){$(this).siblings(".imgs-list").find("ul").stop(true,true);var bannerWidth=$(this).siblings(".imgs-list").find("li").width();var bannerUlWidth=$(this).siblings(".imgs-list").find("ul").width();var ulLeft=$(this).siblings(".imgs-list").find("ul").css("margin-left");var nextUlLeft=parseInt(ulLeft.replace("px","").replace("PX",""))-bannerWidth;if(nextUlLeft>bannerUlWidth*-1){$(this).siblings(".imgs-list").find("ul").animate({marginLeft:nextUlLeft},500,function(){});}});imgsElement.find(".prev").click(function(){$(this).siblings(".imgs-list").find("ul").stop(true,true);var bannerWidth=$(this).siblings(".imgs-list").find("li").width();var ulLeft=$(this).siblings(".imgs-list").find("ul").css("margin-left");var nextUlLeft=parseInt(ulLeft.replace("px","").replace("PX",""))+bannerWidth;console.log(nextUlLeft);if(nextUlLeft<=10){$(this).siblings(".imgs-list").find("ul").animate({marginLeft:nextUlLeft},500,function(){});}});imgsElement.show();$('#pop-modle-alert').show()}})}});