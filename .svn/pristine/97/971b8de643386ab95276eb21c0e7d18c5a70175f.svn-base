var classInfo={init:function(){classInfo.getPlanListInfo();$('.add-type-name-select').niceSelect();$('select').niceSelect();$(".addList").click(function(){$(".type-name-select").empty();$('.ticket-class-title-span').text("新增");classInfo.clearAddAlertBox();classInfo.addShowAlert()});$(".updateList").click(function(){$('.ticket-class-title-span').text("修改");var pkId=$('.yt-table-active .pkId').val();if(pkId==""||pkId==undefined){$yt_alert_Model.prompt("请选择要修改的数据")}else{classInfo.addShowAlert();classInfo.updateClassRoom()}});$('.add-btn-div').on('click','.add-class-btn',function(){var title=$('.ticket-class-title-span').text();var pkId="";if(title=="新增"){classInfo.addClassRoom(pkId)}else{pkId=$('.yt-table-active .pkId').val();classInfo.addClassRoom(pkId)}});$(".deleteList").on('click',function(){if($(".yt-table-active").length==0){$yt_alert_Model.prompt("请选择要删除的数据");return false}classInfo.delclassInfo()});$(".btn-all").on('click','.add-class-roomtype-btn',function(){classInfo.classRoomTpyeShowAlert();});$(".add-one-line").on('click',function(){var typeName=$('.add-one-line-tbody tr:last').find('.typeName').val();if(typeName==""){$yt_valid.validForm($(".add-one-line-tab"))}else{var length=$('.add-one-line-tbody tr').length+1;var addOneHtml='<tr><td style="text-align:center;" class="order"><input class="yt-input input-style type-id" type="hidden" value="" /><span>'+length+'</span></td><td style="position:relative;text-align:center;"><input class="yt-input input-style add-room-type typeName" style="width:300px" value="" placeholder="请输入" type="text" validform="{isNull:true,blurFlag:true,size:20,msg:\'不能为空,不要超过10个字\'}"/><span class="valid-font" style="left:45px;"></span></td><td style="text-align:center;"><img style="margin:0px;" class="entry-del-icon del-img" src="../../resources/images/open/delete.png" /></td></tr>';$('.add-one-line-tbody').append(addOneHtml)}});var deleteId='';$(".class-btn-div").on('click','.class-room-btn',function(){classInfo.addClassRoomType(deleteId)});$(".add-one-line-tbody").on('click','.del-img',function(){$(this).addClass('delete-img');$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"./resources/images/icons/x.png",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:function(){$(".add-one-line-tbody .del-img").removeClass('delete-img');$('#pop-modle-alert').show()},alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){if(deleteId!=''){deleteId+=","+$(".add-one-line-tbody .delete-img").parent().parent().find('.type-id').val()}else{deleteId+=$(".add-one-line-tbody .delete-img").parent().parent().find('.type-id').val()}$(".add-one-line-tbody .delete-img").parent().parent().remove();$('#pop-modle-alert').show();var order=$('.add-one-line-tab .add-one-line-tbody tr');$.each(order,function(i,v){i=i+1;$(v).find('.order span').text(i)})}});});$('.key-word').off().on('click','.search-btn',function(){classInfo.getPlanListInfo()})},getRoomTypeList:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"classroom/lookForAllClassroomType",data:{typeName:""},async:false,success:function(data){typeList=data.data||[];if(typeList!=null){$.each(typeList,function(i,n){$(".add-type-name-select").append('<option value="'+n.typeId+'">'+n.typeName+'</option>')});$(".add-type-name-select").niceSelect()}}})},getClassRoomType:function(){$('.add-one-line-tbody').empty();var selectParam="";var addOneHtml;$.ajax({type:"post",url:$yt_option.base_path+"classroom/lookForAllClassroomType",data:{selectParam:selectParam},async:false,success:function(data){if(data.data.length!=0){$.each(data.data,function(i,v){i=i+1;addOneHtml='<tr><td style="text-align:center;" class="order"><input class="yt-input input-style type-id" type="hidden" value="'+v.typeId+'" /><span>'+i+'</span></td><td style="text-align:center"><input class="yt-input add-room-type typeName" style="width: 300px;" type="text" value="'+v.typeName+'" /></td><td style="text-align:center;"><img style="margin:0px;" class="del-class-roomtype del-img" src="../../resources/images/open/delete.png" /></td></tr>';$('.add-one-line-tbody').append(addOneHtml)})}}})},addClassRoomType:function(deleteClassroomtype){var classRoomArr=[];var pkId;var typeName;var typeTypeName=$('.add-one-line-tbody tr');$.each(typeTypeName,function(i,b){var pkId=$(b).find('.type-id').val();var typeName=$(b).find('.typeName').val();var roomMap={pkId:pkId,typeName:typeName};classRoomArr.push(roomMap);});var classroomTypeData=JSON.stringify(classRoomArr);$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"classroom/addClassroomType",data:{deleteClassroomtype:deleteClassroomtype,classroomTypeData:classroomTypeData},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("新增成功")});}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("新增失败")})}}})},addShowAlert:function(){$(".add-shuttle-box").show();$yt_alert_Model.getDivPosition($(".add-shuttle-box"));$yt_model_drag.modelDragEvent($(".add-shuttle-box .yt-edit-alert-title"));$('.add-shuttle-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$(".add-type-name-select").find("option").remove();$(".add-type-name-select").niceSelect();classInfo.getRoomTypeList();$('.add-shuttle-box .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},classRoomTpyeShowAlert:function(){classInfo.getClassRoomType();$(".class-room-tye-shuttle-box").show();$yt_alert_Model.getDivPosition($(".class-room-tye-shuttle-box"));$yt_model_drag.modelDragEvent($(".class-room-tye-shuttle-box .yt-edit-alert-title"));$('.class-room-tye-shuttle-box .yt-eidt-model-bottom .yt-model-sure-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$('.class-room-tye-shuttle-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},getPlanListInfo:function(){$yt_baseElement.showLoading();var keyword=$('#keyword').val();var buildingNo="";$('.page-info').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"classroom/lookForAll",type:"post",data:{selectParam:keyword},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.list-table .yt-tbody');var htmlTr='';var num=1;if(data.data.rows.length>0){$(htmlTbody).empty();$.each(data.data.rows,function(i,v){if(v.buildingNo==1){buildingNo="A座"};if(v.buildingNo==2){buildingNo="B座"};i=i+1;htmlTr='<tr><td style="text-align:center;">'+i+'</td><td style="display:none;"><input type="hidden" value="'+v.pkId+'" class="pkId"><a href="#" classInfo="real-name-inf" style="color:blue">'+v.carNum+'</a></td><td class="classroom-name">'+v.classroomName+'</td><td style="text-align:center;" class="type-name"><input type="hidden" value="'+v.typeId+'" class="type-id">'+v.typeName+'</td><td style="text-align:center;" class="building-no">'+buildingNo+'</td><td style="text-align:center;" class="classroom-num">'+v.classroomNum+'</td><td style="text-align:center;" class="classroom-person-num">'+v.classroomPersonNum+'</td><td class="base-facility">'+v.baseFacility+'</td><td class="remarks">'+v.remarks+'</td></tr>';htmlTbody.append($(htmlTr).data("legalData",v))})}else{$(htmlTbody).empty();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="8" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';$('.page1').hide();htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},clearAddAlertBox:function(){$('.add-classroom-name').val("");$('.add-type-name-select').setSelectVal("");$('.add-building-no').setSelectVal("");$('add-classroom-num').val("");$('.add-classroom-person-num').val("");$(".input-style").val("");$('.equipment').setCheckBoxState("uncheck");$('#baseFacilityOther').setCheckBoxState("uncheck");$('#baseFacilityOther').val("");$('#baseFacilityOtherText').val("");$('#remarks').val("")},addClassRoom:function(pkId){var pkId;var classroomName=$('.add-classroom-name').val();var typeId=$('.add-type-name-select').val();var buildingNo=$('.add-building-no').val();var classroomNum=$('.add-classroom-num').val();var classroomPersonNum=$('.add-classroom-person-num').val();var blank;var projector;var megaphone;var baseFacilityOther;var baseFacilityOtherText;var baseFacility="";var checkAll=$('.tr-checkbox').find('.equipment-checkbox');$.each(checkAll,function(i,c){if($(c).hasClass("check")){if(baseFacility==""){baseFacility=$(c).find('.equipment').val();if($(c).find('.equipment').val()==4){baseFacilityOtherText=$(c).next().val()}}else{baseFacility+=","+$(c).find('.equipment').val();if($(c).find('.equipment').val()==4){baseFacilityOtherText=$(c).next().val()}}}});var remarks=$('#remarks').val();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"classroom/addOrUpdateClassroom",data:{pkId:pkId,classroomName:classroomName,typeId:typeId,buildingNo:buildingNo,classroomNum:classroomNum,classroomPersonNum:classroomPersonNum,baseFacility:baseFacility,baseFacilityOther:baseFacilityOtherText,remarks:remarks},async:false,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("新增失败")})};classInfo.getPlanListInfo()}})},updateClassRoom:function(){classInfo.clearAddAlertBox();var pkId=$('.yt-table-active .pkId').val();var classroomName=$('.yt-table-active .classroom-name').text();var typeId=$('.yt-table-active .type-id').val();var buildingNo=$('.yt-table-active .building-no').text();var classroomNum=$('.yt-table-active .classroom-num').text();var classroomPersonNum=$('.yt-table-active .classroom-person-num').text();var baseFacility=$('.yt-table-active .base-facility').text();var baseFacilityOtherText;$('.add-classroom-name').val(classroomName);$('.add-type-name-select').setSelectVal(typeId);$('.add-building-no').setSelectVal(buildingNo);$('.add-classroom-num').val(classroomNum);$('.add-classroom-person-num').val(classroomPersonNum);var baseFacilityArr=baseFacility.split(',');for(var i in baseFacilityArr){if(baseFacilityArr[i]=="白板"){$(".blank").setCheckBoxState("check")}else if(baseFacilityArr[i]=="投影"){$(".projector").setCheckBoxState("check")}else if(baseFacilityArr[i]=="扩音器"){$(".megaphone").setCheckBoxState("check")}else{if(baseFacilityArr[i]!=""){$(".baseFacilityOther").setCheckBoxState("check");baseFacilityOtherText=$('#baseFacilityOtherText').val(baseFacilityArr[i])}}};var remarks=$('.yt-table-active .remarks').text();$('#remarks').val(remarks)},delclassInfo:function(){var pkId=$('.yt-table-active .pkId').val();$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"classroom/deleteClassroom",data:{pkId:pkId},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除成功")});$('.page-info').pageInfo("refresh")}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除失败")})}}})}})}};$(function(){classInfo.init()});