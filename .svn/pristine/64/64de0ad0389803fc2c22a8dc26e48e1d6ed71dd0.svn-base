var projectList={init:function(){projectList.getOneListInfo();$('.back-btn').click(function(){window.location.href="reimburseExamination.html"});$(".check-label input[type='radio']").change(function(){var rad=$(this).val();if(rad=="completed"){$('.hid-input').show()};if(rad=="returnedSubmit"){$('#nextPeople').val("");$('.hid-input').hide()}});$('#last-submit').click(function(){var pkId=$yt_common.GetQueryString('pkId');var processInstanceId=$('.processInstanceId').val();var dealingWithPeople=$('#nextPeople').val();var tastKey=$('#tastKey').val();if(tastKey=="activitiEndTask"){dealingWithPeople=""}var opintion=$('#opintion').val();var nextCode=$('input[name="radioType"]:checked ').val();if(nextCode=="returnedSubmit"){dealingWithPeople=""}$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/updateApplyClassExpense",async:false,data:{pkId:pkId,businessCode:"classExpense",dealingWithPeople:dealingWithPeople,opintion:opintion,processInstanceId:processInstanceId,nextCode:nextCode},objName:'data',success:function(data){if(data.flag==0){}}});window.location.href="reimburseExamination.html"});$('#last-cancel').click(function(){window.location.href="reimburseExamination.html"});var getAllNextPeople=projectList.getListSelectDealingWithPeople();if(getAllNextPeople!=null){$.each(getAllNextPeople,function(i,n){$("#nextPeople").append('<option value="'+n.userCode+'">'+n.userName+'</option>')})};$("#nextPeople").niceSelect()},getListSelectDealingWithPeople:function(){var list=[];var processInstanceId=$('.processInstanceId').val();$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"project",processInstanceId:processInstanceId},async:false,success:function(data){$.each(data.data,function(i,n){for(var k in n){list=n[k]}})}});return list},getOneListInfo:function(){$yt_baseElement.showLoading();var pkId=$yt_common.GetQueryString("pkId");$.ajax({type:"post",url:$yt_option.base_path+"finance/teacherExpense/getBeanByIdClassExpense",async:false,data:{pkId:pkId},objName:'data',success:function(data){if(data.flag==0){$('.processInstanceId').val(data.data.processInstanceId);var projectCode=data.data.projectCode;$('#projectName').text(data.data.projectName);$('#projectCode').text(projectCode);$('#flowNumber').text(data.data.flowNumber);$('#projectHead').text(data.data.projectHead);$('#createUser').text(data.data.createUser);$('#createTimeString').text(data.data.createTimeString);$('.state-type').text(data.data.workFlawState);$('#cheque-number').text(data.data.chequeNumber);$('#amount-money').text(data.data.chequeNumberMoney);$('.details').text(data.data.remarks);var htmlTbody=$('.class-tbody');var twoTbody=$('#two-table').empty();var htmlTr='';var twoTr='';if(data.data.expenseClassDetails.length>0){data.data.expenseClassDetails=JSON.parse(data.data.expenseClassDetails);var afterTaxSum=0;var surrenderPersonalSum=0;var expenseMoneySum=0;var num=0;$.each(data.data.expenseClassDetails,function(i,v){var papersType=v.papersType;if(papersType==1){papersType='身份证'}if(papersType==2){papersType='护照'}if(papersType==3){papersType='军官证'}if(papersType==4){papersType='其他'}var courseDateJson=v.courseDateJson;var lengthJson=courseDateJson.length;num=i+1;var jsonTd='';afterTaxSum+=v.afterTax;surrenderPersonalSum+=v.surrenderPersonal;expenseMoneySum+=v.expenseMoney;$.each(courseDateJson,function(index,value){if(index==0){htmlTr+='<tr><td class="teacherId" style="display:none;">'+v.teacherId+'</td><td rowspan="'+lengthJson+'" style="text-align:center">'+num+'</td><td rowspan="'+lengthJson+'" style="text-align:center">'+v.teacherName+'</td><td rowspan="'+lengthJson+'" style="text-align:center">'+papersType+'</td><td rowspan="'+lengthJson+'">'+v.papersNumber+'</td><td rowspan="'+lengthJson+'">'+v.registeredBank+'</td><td rowspan="'+lengthJson+'">'+v.account+'</td><td  style="text-align:center">'+value.courseDate+'</td><td rowspan="'+lengthJson+'" style="text-align:right">'+v.afterTax.toFixed(2)+'</td><td rowspan="'+lengthJson+'" style="text-align:right">'+v.surrenderPersonal.toFixed(2)+'</td><td rowspan="'+lengthJson+'" style="text-align:right">'+v.expenseMoney.toFixed(2)+'</td></tr>'}else{htmlTr+='<tr"><td style="text-align:center" class="courseDate">'+value.courseDate+'</td></tr>'}});twoTr='<tr class="twoTr twoTr'+i+'"><td style="text-align:center">'+(i+1)+'</td><td style="text-align:center">'+v.teacherName+'</td><td style="text-align:center">'+papersType+'</td><td>'+v.papersNumber+'</td><td>'+v.registeredBank+'</td><td>'+v.account+'</td><td style="text-align:center">电汇</td><td style="text-align:right" class="twotablemoney" >'+ +v.afterTax.toFixed(2)+'</td></tr>';twoTbody.append(twoTr)});var mun=num+1;htmlTr+='<tr><td colspan="7"  style="text-align:center">合计</td><td style="text-align:right"><b>'+afterTaxSum.toFixed(2)+'</b></td><td style="text-align:right"><b>'+surrenderPersonalSum.toFixed(2)+'</b></td><td style="text-align:right"><b>'+expenseMoneySum.toFixed(2)+'</b></td></tr>'}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading();if(flowLog!=''){var flowLog=JSON.parse(data.data.flowLog)}var middleStepHtml;var length=flowLog.length;$.each(flowLog,function(i,v){$('#tastKey').val(v.tastKey);if(v.tastKey=="activitiEndTask"){$('.next-operate-person-tr').hide()}if(i==0){$('.last-step-order').text(length);$('.last-step-operate-person-userName').text(v.userName);$('.last-step-operationState').text(v.operationState);$('.last-step-commentTime').text(v.commentTime)};if(i==length-1){$('.first-step-order').text(1);$('.first-step-operate-person-userName').text(v.userName);$('.first-step-taskName').text(v.operationState);$('.first-step-commentTime').text(v.commentTime)};if(i!=0&&i<length-1){var order=length-i;middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+v.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+v.operationState+'</span></li><li class="view-time-li middle-step-commentTime" style="width:200px;">'+v.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment">'+v.comment+'</div></li></ul></div></div>';$('.last-step').append(middleStepHtml)}});$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})}};$(function(){projectList.init()});