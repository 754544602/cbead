var projectList={init:function(){projectList.getOneListInfo();$('.add-lecture-tb tbody').on('click',".down-file",function(){var filePkId=$(this).parent().parent().find('.file-span-id').val();var fileURL=$(this).parent().parent().find('.fileURL').val();$.ajaxDownloadFile({url:fileURL})});$(".check-label input[type='radio']").change(function(){var rad=$(this).val();if(rad=="completed"){if($('#taskKey').val()!="activitiEndTask"){$('.hid-input').show()}else{$('.hid-input').hide()}};if(rad=="returnedSubmit"){$('#nextPeople').setSelectVal("");$('.hid-input').hide()}});$('#last-submit').click(function(){var types=$('#types').val();var pkId=$('#pkId').val();var businessCode;if(types==1){businessCode="openHonorsStart"};if(types==2){businessCode="openHonorsEnd"};var processInstanceId=$('#processInstanceId').val();var dealingWithPeople=$('#nextPeople').val();var opintion=$('#opintion').val();var nextCode=$('input[name="radioType"]:checked ').val();var tastKey=$('#taskKey').val();if(nextCode=="returnedSubmit"||tastKey=="activitiEndTask"){dealingWithPeople=""}if(dealingWithPeople=="no"){$yt_alert_Model.prompt("请选择下一步操作人！",3000)}else{$.ajax({type:"post",url:$yt_option.base_path+"class/openHonors/updateApply",async:false,data:{pkId:pkId,types:types,businessCode:businessCode,processInstanceId:processInstanceId,dealingWithPeople:dealingWithPeople,opintion:opintion,nextCode:nextCode},objName:'data',success:function(data){if(data.flag==0){}}});window.location.href="waitOpenHonorsList.html"}});$('#last-cancel').click(function(){window.location.href="waitOpenHonorsList.html"});projectList.getNextOperatePerson();$("#nextPeople").niceSelect();$('.back-btn').click(function(){window.location.href="waitOpenHonorsList.html"})},getNextOperatePerson:function(){var nextPersonList=projectList.getworkFlowOperate();if(nextPersonList!=null){$.each(nextPersonList,function(i,n){$("#nextPeople").append('<option value="'+n.userCode+'">'+n.userName+'</option>')})}},getworkFlowOperate:function(){var businessCode;var processInstanceId=$('#processInstanceId').val();var types=$('#types').val();if(types==1){businessCode="openHonorsStart"};if(types==2){businessCode="openHonorsEnd"}var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:businessCode,processInstanceId:processInstanceId},async:false,success:function(data){if(data.flag==0){$.each(data.data,function(i,n){for(var k in n){user=n[k]}})}}});return user},getOutOpenHonors:function(){var pkId=$('#pkId').val();var type=$('#types').val();alertNmae=$('.types').val();$.ajaxDownloadFile({url:$yt_option.base_path+"class/openHonors/exportOrder",pkId:pkId,types:type})},getOneListInfo:function(){$yt_baseElement.showLoading();var pkId=$yt_common.GetQueryString("pkId");var types=$yt_common.GetQueryString("types");if(types==2){$(".class-title").text("结业式待审批");$('.order-title').text("结业式会序");$(".file-title").text("结业式讲稿");$(".approve-title").text("结业式审批流程")}$.ajax({type:"post",url:$yt_option.base_path+"class/openHonors/getBeanById",async:false,data:{pkId:pkId,types:types},objName:'data',success:function(data){if(data.flag==0){$('#processInstanceId').val(data.data.processInstanceId);$('#types').val(data.data.types);$('#pkId').val(data.data.pkId);$('#projectCode').text(data.data.projectName);$('#projectUserName').text(data.data.projectUserName);$('#startTime').text(data.data.startTime);$('#traineeCount').text(data.data.traineeCount);$('#createTimeString').text(data.data.createTimeString);$('#createUser').text(data.data.createUserName);var orderList=data.data.orderList;var orderListObj=$.parseJSON(orderList);$.each(orderListObj,function(i,v){var num=$(".add-order-tb tbody tr").length+1;var lineTrHtml='<tr class="add-textList tr-border-style"><td style="text-align:center;" class="order-by"> <input type="hidden" class="orderBy" value="'+v.orderBy+'"/>'+num+'</td><td class="td-input details">'+v.details+'</td><td class="dateLength" style="padding-right:10px;text-align:right"><span style="margin-right:5px">'+v.dateLength+'</span>分钟</td></tr>';$(".add-order-tb tbody").append(lineTrHtml)});var fileList=data.data.fileList;var fileListObj=$.parseJSON(fileList);$.each(fileListObj,function(i,v){var num=$(".lecture tbody tr").length+1;var lineTrHtml='<tr class="file-tr-border-style"><input type="hidden" class="fileURL" value="http://10.2.1.249:7216/acl/api/tAscPortraitInfo/download?isDownload=true&pkId='+v.fileId+'"><td class="lecture-tds">【<span class="fileLineNum">'+num+'</span>】</td><td class="fileName"><input type="hidden" class="file-span-id" value="'+v.fileId+'" >'+v.fileName+'</td><td style="display:none;" class="lecture-tds"><img class="ioc-img" src="../../resources/images/open/yulan.png" /></td><td style="width: 40px; display:none;">预览</td><td class="lecture-tds" style="text-align:center;width:70px"><span style="cursor: pointer;" class="down-file"><img class="ioc-img" src="../../resources/images/open/xiazai2.png" />下载</span></td></tr>';$(".lecture").append(lineTrHtml)});var flowLog=data.data.flowLog;var middleStepHtml;var length=flowLog.length;$.each(flowLog,function(i,v){if(i==0){$('#taskKey').val(v.tastKey);$('.last-step-order').text(length);$('.last-step-operate-person-userName').text(v.userName);$('.last-step-operationState').text(v.operationState);$('.last-step-commentTime').text(v.commentTime)};if(i==length-1){$('.first-step-order').text(1);$('.first-step-operate-person-userName').text(v.userName);$('.first-step-taskName').text(v.operationState);$('.first-step-commentTime').text(v.commentTime)};if(i!=0&&i<length-1){var order=length-i;middleStepHtml='<div><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+v.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+v.operationState+'</span></li><li class="view-time-li middle-step-commentTime" >'+v.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment">'+v.comment+'</div></li></ul></div></div>';$('.last-step').append(middleStepHtml)}});$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})}};$(function(){projectList.init()});