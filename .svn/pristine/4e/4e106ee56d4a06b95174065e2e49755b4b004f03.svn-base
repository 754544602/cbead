var ticketOpenInfo = {

	//初始化方法
	init: function() {
		$(".yt-select").niceSelect();
		$(".start-time-start").calendar({
			controlId: "startDate",
			nowData: false, //默认选中当前时间,默认true  
			upperLimit: $(".start-time-end") //开始日期最大为结束日期  
		});
		$(".start-time-end").calendar({
			controlId: "endDate",
			nowData: false, //默认选中当前时间,默认true  
			lowerLimit: $(".start-time-start") //结束日期最小为开始日期  
		});
		$(".end-time-start").calendar({
			controlId: "startDate",
			nowData: false, //默认选中当前时间,默认true  
			upperLimit: $(".end-time-end") //开始日期最大为结束日期  
		});
		$(".end-time-end").calendar({
			controlId: "endDate",
			nowData: false, //默认选中当前时间,默认true  
			lowerLimit: $(".end-time-start") //结束日期最小为开始日期  
		});
		//初始化列表
		ticketOpenInfo.getPlanListInfo();
		//点击查询
		$('.key-word').off().on('click', '.search-btn', function() {
			//调用获取列表数据方法查询
			ticketOpenInfo.getPlanListInfo();
		});
		//跳转页面
		$(".open-class-tbody").on("click",".project-name",function(){
			var projectCode = $(this).parent().parent().find(".project-code").text();
			var pkId = $(this).parent().parent().find(".pk-id").val();
			var projectType = $(this).parent().parent().find(".project-type-hid").val();
			window.location.href = "ticketOpenInfo.html?projectCode="+projectCode+"&"+"pkId="+pkId+"&projectType="+projectType;
		});
		//点击页面上的其他位置收起高级搜索
		ticketOpenInfo.hideSearch();
	},

	/**
	 * 项目档案列表
	 */
	getPlanListInfo: function() {
		$yt_baseElement.showLoading();
		var keyword = $("#keyword").val();
		$('.page-info').pageInfo({
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "finance/projectInvoice/lookForAll", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				selectParam: keyword
			}, //ajax查询访问参数
			async:true,
			success: function(data) {
				if(data.flag == 0) {
					var htmlTbody = $('.list-table .yt-tbody');
					var htmlTr = '';
					htmlTbody.empty();
					if(data.data.rows.length > 0) {
						var projectType;
						var states;
						var projectStates;
						$('.page-info').show();
						$.each(data.data.rows, function(i, v) {
							if(v.projectStates == 1 ){
								v.projectStates = "已立项";
							}else if(v.projectStates == 2 ){
								v.projectStates = "培训中";
							}else{
								v.projectStates = "已结束";
							}
							htmlTr = '<tr>' +
								'<td class="project-code"><input type="hidden" class="pk-id" value="'+v.pkId+'" />' + v.projectCode + '</td>' +
								'<td style="text-align: left;"><a style="color: #3c4687;" class="project-name" href="#">' + v.projectName + '</a></td>' +
								'<td class="project-type"><input type="hidden" class="project-type-hid" value="'+v.projectType+'" />' + (ticketOpenInfo.projectTypeInfo(v.projectType)) + '</td>' +
								'<td style="text-align:left;" class="project-sell">' + v.projectSell + '</td>' +
								'<td style="text-align:left;" class="project-head">' + v.projectHead + '</td>' +
								'<td class="start-date">' + v.startDate + '</td>' +
								'<td class="end-date">' + v.endDate + '</td>' +
								'<td style="text-align:right;" class="check-in-count">' + v.checkInCount + '</td>' +
								'<td>' + v.projectStates + '</td>' +
								'<td style="text-align:right;" class="noInvoice-count">' + v.noInvoiceCount + '</td>' +
								'</tr>';
							htmlTbody.append(htmlTr);
						});
					}else {
						$('.page-info').hide();
						htmlTr += '<tr style="border:0px;background-color:#fff !important;" >' +
							'<td colspan="10" align="center" style="border:0px;">' +
							'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
							'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
							'</div>' +
							'</td>' +
							'</tr>';
						htmlTbody.append(htmlTr);
					}

					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function() {
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	},
		//项目类型设置
	projectTypeInfo: function(code) {
		if(code == 1) {
			return "计划";
		} else if(code == 2) {
			return "委托";
		} else if(code == 3) {
			return "选学";
		} else if(code == 4) {
			return"中组部调训";
		} else if(code == 5) {
			return"国资委调训";
		}else {
			return '';
		};
	},
	/**
	 * 点击页面其他位置收起高级搜索
	 */
	hideSearch:function(){
		//初始化鼠标的点击状态
		var clickState=false;
		var hisearch=$('div.search-box');
		console.log('hisearch',hisearch.target);
		///高级搜索
		var clickTime=0;
		$("button.senior-search-btn").click(function(e){
			if(clickTime%2==0){
				$('.search-box').show();
				$('.search-put').addClass('flipy');
			}else{
				$('.search-box select').setSelectVal("");
				$('.search-box input').val("");
				$('.search-box').hide();
				$('.search-put').removeClass('flipy');
			}
			e.stopPropagation();
			clickTime++;
		});
		
		$(document).click(function(){
			clickTime=0;
			hisearch.hide();
			$('.search-put').removeClass('flipy');
		});

	}
}
$(function() {
	//初始化方法
	ticketOpenInfo.init();
});