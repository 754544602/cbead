/**
 * 满意度评分汇总（非选学）
 */
var quList={init:function(){quList.getClassDetails();quList.demoSatisfaction();quList.getDetailsExportList();quList.getOriginalExportList();quList.look();quList.addContentText();$(".tab-title-list button").click(function(){$(this).addClass("active").siblings().removeClass("active");$(".details-box .original-box").hide().eq($(this).index()).show();$('#keyword1').val("");$('#keyword2').val("");if($(this).index()==0){$(".summary-box").show();$(".details-box").hide();$(".original-box").hide();quList.addContentText();quList.demoSatisfaction()}else if($(this).index()==1){$(".details-box").show();$(".summary-box").hide();$(".original-box").hide();$("input[type=checkbox][name='test']").setCheckBoxState("check");quList.getDetailsList();}else if($(this).index()==2){$(".original-box").show();$(".summary-box").hide();$(".details-box").hide();$("input[type=checkbox][name='test2']").setCheckBoxState("check");quList.getOriginalList();}});$('.page-return-btn').off().on('click',function(){window.location.href="projectQualityList.html"});$(".more-tab-btn-end").click(function(){var leftVal=parseInt($(".tab-title-box").css("margin-left"))-120;if($(".tab-title-box").parent().width()>($(".tab-title-box button").last().position().left-120)){$(".more-tab-btn-end").hide();leftVal=(120*$(".tab-title-box button").length-$(".tab-title-box").parent().width()+32)*-1}$(".tab-title-box").css("padding-left","32px").stop(true,true).animate({"margin-left":leftVal},100);$(".more-tab-btn-start").show()});$(".more-tab-btn-start").click(function(){var leftVal=parseInt($(".tab-title-box").css("margin-left"))+120;if(leftVal>=-120){$(this).hide();leftVal=0;$(".tab-title-box").css("padding-left","0")}console.log(leftVal);$(".tab-title-box").stop(true,true).animate({"margin-left":leftVal},100);$(".more-tab-btn-end").show()});$("#searchList").click(function(){quList.getDetailsList()});$("#searchList2").click(function(){quList.getOriginalList()});$(".effective").click(function(){quList.updateEffective($('.effective').val());if(quList.updateEffective($('.effective').val())){quList.refreshEffective()}});$(".invalid").click(function(){quList.updateEffective($('.invalid').val());if(quList.updateEffective($('.invalid').val())){quList.refreshEffective()}});$('.score-info').on('click','.lookDetails',function(){quList.lookDetails()});$('.original-score-info').on('click','.lookDetails',function(){quList.originalLookDetails()});$('.details-box .search-btn-slect input[type=checkbox]').change(function(){quList.getDetailsList()});$('.original-box .search-btn-slect input[type=checkbox]').change(function(){quList.getOriginalList()});$('.class-tbody2').off('click').on('click','tr',function(){var exName=$(this).attr('exname');$(".ex[exname="+exName+"]").addClass('yt-table-active').siblings(".ex[exname!="+exName+"]").removeClass('yt-table-active');console.log('thisClass',exName)})},getClassDetails:function(){var pkId=$yt_common.GetQueryString("pkId");$.ajax({type:"post",url:$yt_option.base_path+"project/getBeanById",data:{pkId:pkId},async:true,success:function(data){if(data.flag==0){if(data.data.projectType==1){data.data.projectType="计划"}else if(data.data.projectType==2){data.data.projectType="委托"}else if(data.data.projectType==3){data.data.projectType="选学"}else if(data.data.projectType==4){data.data.projectType="中组部调训"}else{data.data.projectType="国资委调训"}$(".proje-details-div").setDatas(data.data)}else{}}})},look:function(){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/questionnaire/lookForAll",async:true,data:{selectParam:projectCode,pageIndexs:1,pageNum:15},success:function(data){$('.project-name').text(data.data.rows[0].projectName)},error:function(data){console.log(data.status)}})},averageSatisfaction:0,demoSatisfaction:function(){var xAxisList=[];var seriesList=[];var projectCode=$yt_common.GetQueryString("projectCode");var downUrl=$yt_option.base_path+"class/questionnaire/getChartByNoSelection";$.post(downUrl,{'projectCode':projectCode},function(data){if(data.flag==0){var averageSatisfaction=0;var averageSatisfactionLength=0;if(data.data.evaluation){$('.rateDiv').setDatas(data.data.evaluation)}if(data.data.radarChart.columnCode.length==0){data.data.radarChart.columnCode=['培训设计与实施','授课效果','教学活动','教学组织、学风院风、后勤服务','培训学习效果'];data.data.radarChart.columnFraction=[0,0,0,0,0]}$('.every-part-1 .lab ul').empty();$.each(data.data.radarChart.columnCode,function(k,v){xAxisList.push({name:v,max:100});if(data.data.radarChart.columnFraction[k]!=''){averageSatisfaction+=Number(data.data.radarChart.columnFraction[k]);averageSatisfactionLength+=1}$('.every-part-1 .lab ul').append('<li>'+v+'：<span>'+Number(data.data.radarChart.columnFraction[k]).toFixed(2)+'</span></li>')});quList.averageSatisfaction=(averageSatisfaction/averageSatisfactionLength).toFixed(2);quList.averageSatisfaction=='NaN'?quList.averageSatisfaction=0:'';seriesList=data.data.radarChart.columnFraction;var wholeSatisfaction=data.data.satisfaction.wholeSatisfaction.wholeSatisfactionFraction[0]?Number(data.data.satisfaction.wholeSatisfaction.wholeSatisfactionFraction[0]).toFixed(2):0;var myChart=echarts.init($('.drawing-1').get(0));var option={title:{text:'总体满意度:'+wholeSatisfaction,textStyle:{color:'#111111',fontSize:18,fontWeight:100},x:'left'},tooltip:{formatter:function(v){var h=v.seriesName+'<br/>';$.each(xAxisList,function(i,n){h+=n.name+':'+v.value[i]+'<br/>'});return h}},legend:{x:'center',top:'10%',textStyle:{color:'#5B5B5B'}},radar:{name:{textStyle:{color:'#333333',fontSize:14}},indicator:xAxisList},series:[{name:'满意度统计',type:'radar',itemStyle:{color:'#847ccf',borderColor:'#847ccf'},lineStyle:{color:'#847ccf'},areaStyle:{color:'#847ccf',opacity:0.5},data:[{value:seriesList.map(function(x){return Number(x).toFixed(2)})}]}]};myChart.setOption(option);quList.demoTrain(data.data);quList.demoTrain2(data.data);quList.demoTrain3(data.data);quList.demoTrain4(data.data);quList.demoTrain5(data.data);quList.demoTrain6(data.data);quList.demoTrain7(data.data);window.onresize=function(){myChart.setOption(option);quList.demoTrain(data.data);quList.demoTrain2(data.data);quList.demoTrain3(data.data);quList.demoTrain4(data.data);quList.demoTrain5(data.data);quList.demoTrain6(data.data);quList.demoTrain7(data.data)};setTimeout($yt_baseElement.hideLoading(),500)}})},numberchina:['一','二','三','四','五','六','七','八','九','十'],demoTrain:function(data){var designScore=data.radarChart.columnFraction[0];var nameList=data.designImplementation.designImplementationName;var dataList=data.designImplementation.designImplementationFraction;var average=0;if(dataList.length==0){$('.drawing-2').parents('.drawing').remove();return false}$.each(dataList,function(i,n){average+=Number(n)});if(average!=0){average=(Number(average)/Number(dataList.length)).toFixed(2)}var wid=$('.drawing-2').height();$('.drawing-2').replaceWith('<div  class="drawing-2" style="height:'+wid+'px"></div>');$('.drawing-2').siblings('.average').empty().append('<span class="userCount">平均满意度：<label class="userCount-label">'+average+'</label>分</span>');var myChart=echarts.init($('.drawing-2').get(0));var option={color:['#2F4F4F'],title:{text:quList.numberchina[$('.drawing-2').parents('.drawing').index()]+'、学员对培训设计与实施的满意度评分',textStyle:{color:'#111111',fontSize:18,fontWeight:100},top:10},legend:{orient:'vertical',y:'bottom',right:40,itemWidth:10,itemHeight:10,textStyle:{fontSize:14,color:'#555555'},data:nameList},tooltip:{trigger:'axis',axisPointer:{type:'shadow'}},grid:{left:'3%',right:'5%',containLabel:true},color:['#847ccf','#b8b3e2','#df94e0','#f59700'],xAxis:{type:'value',lineStyle:{color:'#000000'},max:100,axisLabel:{formatter:function(value){return value.toFixed(0)}},interval:20},yAxis:{type:'category',data:nameList,inverse:true,axisLabel:{show:true,formatter:function(params){return quList.formatter(params,10)}}},series:[{type:'bar',stack:'总量',barMaxWidth:40,label:{show:true,position:'right',color:'#000'},barWidth:17,barGap:"0%",barCategoryGap:"60px",itemStyle:{barBorderRadius:[0,8,8,0]},data:dataList.map(function(x){return Number(x).toFixed(2)})}]};myChart.setOption(option)},demoTrain2:function(data){var designScore=data.radarChart.columnFraction[1];var nameList=data.teachingEffect.teacherName;var dataList=data.teachingEffect.teacherFraction;var average=0;if(dataList.length==0){$('.drawing-3').parents('.drawing').remove()}else{$.each(dataList,function(i,n){average+=Number(n)});if(average!=0){average=(Number(average)/Number(dataList.length)).toFixed(2)}$('.drawing-3').siblings('.average').empty().append('<span class="userCount">平均满意度：<label class="userCount-label">'+average+'</label>分</span>');if(nameList.length>7){$('.drawing-3').replaceWith('<div  class="drawing-3" style="width: 100%;"></div>');$('.drawing-3').css('height',400+((nameList.length-7)*40)+'px')}else{$('.drawing-3').replaceWith('<div  class="drawing-3" style="width: 100%;"></div>');$('.drawing-3').css('height','400px')}var myChart=echarts.init($('.drawing-3').get(0));var option={color:['#2F4F4F'],title:{text:quList.numberchina[$('.drawing-3').parents('.drawing').index()]+'、学员对教师授课效果的满意度评分',textStyle:{color:'#111111',fontSize:18,fontWeight:100},top:10},tooltip:{trigger:'axis',axisPointer:{type:'shadow'}},legend:{y:'bottom',right:40,itemWidth:10,itemHeight:10,textStyle:{fontSize:14,color:'#555555'},data:data.teachingEffect.teacherName},grid:{left:'3%',right:'5%',containLabel:true},color:['#847ccf','#b8b3e2','#df94e0','#f59700'],xAxis:{type:'value',lineStyle:{color:'#000000'},max:100,axisLabel:{formatter:function(value){return value.toFixed(0)}},interval:20},yAxis:{type:'category',data:nameList,inverse:true,axisLabel:{show:true,formatter:function(params){return quList.formatter(params,10)}}},series:[{type:'bar',stack:'总量',barMaxWidth:40,label:{show:true,position:'right',color:'#000'},barWidth:17,barGap:"0%",barCategoryGap:"60px",itemStyle:{barBorderRadius:[0,8,8,0]},data:dataList.map(function(x){return Number(x).toFixed(2)})}]};myChart.setOption(option)}},demoTrain3:function(data){var designScore=data.radarChart.columnFraction[2];var nameList=data.teachingActivites.courseName;var dataList=data.teachingActivites.courseFraction;if(dataList.length==0){$('.drawing-4').parents('.drawing').remove()}else{var average=0;$.each(dataList,function(i,n){average+=Number(n)});if(average!=0){average=(Number(average)/Number(dataList.length)).toFixed(2)}$('.drawing-4').siblings('.average').empty().append('<span class="userCount">平均满意度：<label class="userCount-label">'+average+'</label>分</span>');if(nameList.length>4){$('.drawing-4').replaceWith('<div  class="drawing-4" style="width: 100%;"></div>');$('.drawing-4').css('height',400+((nameList.length-4)*100)+'px')}else{$('.drawing-4').replaceWith('<div  class="drawing-4" style="width: 100%;"></div>');$('.drawing-4').css('height','400px')}var myChart=echarts.init($('.drawing-4').get(0));var option={color:['#2F4F4F'],title:{text:quList.numberchina[$('.drawing-4').parents('.drawing').index()]+'、学员对教学活动的满意度评分',textStyle:{color:'#111111',fontSize:18,fontWeight:100},top:10},tooltip:{trigger:'axis',axisPointer:{type:'shadow'}},legend:{orient:'vertical',y:'bottom',right:40,itemWidth:10,itemHeight:10,textStyle:{fontSize:14,color:'#555555'},data:nameList},grid:{left:'3%',right:'5%',containLabel:true},color:['#847ccf','#b8b3e2','#df94e0','#f59700'],xAxis:{type:'value',lineStyle:{color:'#000000'},max:100,axisLabel:{formatter:function(value){return value.toFixed(0)}},interval:20},yAxis:{type:'category',data:nameList,inverse:true,axisLabel:{show:true,formatter:function(params){return quList.formatter(params,10)}}},series:[{type:'bar',barMaxWidth:40,label:{show:true,position:'right',color:'#000'},barWidth:17,barGap:"0%",barCategoryGap:"60px",itemStyle:{barBorderRadius:[0,8,8,0]},data:dataList.map(function(x){return Number(x).toFixed(2)})}]};myChart.setOption(option)}},demoTrain4:function(data){var designScore=data.radarChart.columnFraction[3];var nameList=data.towsls.towslsName;var dataList=data.towsls.towslsFraction;if(dataList.length==0){$('.drawing-5').parents('.drawing').remove();return false}var average=0;$.each(dataList,function(i,n){average+=Number(n)});if(average!=0){average=(Number(average)/Number(dataList.length)).toFixed(2)}var wid=$('.drawing-5').height();$('.drawing-5').replaceWith('<div  class="drawing-5" style="height:'+wid+'px"></div>');$('.drawing-5').siblings('.average').empty().append('<span class="userCount">平均满意度：<label class="userCount-label">'+average+'</label>分</span>');var myChart=echarts.init($('.drawing-5').get(0));var option={color:['#2F4F4F'],title:{text:quList.numberchina[$('.drawing-5').parents('.drawing').index()]+'、学员对教学组织、学院院风、后勤服务的满意度评分',textStyle:{color:'#111111',fontSize:18,fontWeight:100},top:10},tooltip:{trigger:'axis',axisPointer:{type:'shadow'}},grid:{left:'3%',right:'5%',bottom:'3%',containLabel:true},color:['#847ccf','#b8b3e2','#df94e0','#f59700'],xAxis:{type:'value',lineStyle:{color:'#000000'},max:100,axisLabel:{formatter:function(value){return value.toFixed(0)}},interval:20},yAxis:{type:'category',data:nameList,inverse:true,axisLabel:{show:true,formatter:function(params){return quList.formatter(params,10)}}},series:[{type:'bar',barMaxWidth:40,label:{show:true,position:'right',color:'#000'},barWidth:17,barGap:"0%",barCategoryGap:"60px",itemStyle:{barBorderRadius:[0,8,8,0]},data:dataList.map(function(x){return Number(x).toFixed(2)})}]};myChart.setOption(option)},demoTrain5:function(data){var designScore=data.radarChart.columnFraction[4];var nameList=data.learningeffect.learningeffectName;var dataList=data.learningeffect.learningeffectFraction;if(dataList.length==0){$('.drawing-6').parents('.drawing').remove();return false}var average=0;$.each(dataList,function(i,n){average+=Number(n)});if(average!=0){average=(Number(average)/Number(dataList.length)).toFixed(2)}var wid=$('.drawing-6').height();$('.drawing-6').replaceWith('<div  class="drawing-6" style="height:'+wid+'px"></div>');$('.drawing-6').siblings('.average').empty().append('<span class="userCount">平均满意度：<label class="userCount-label">'+average+'</label>分</span>');var myChart=echarts.init($('.drawing-6').get(0));var option={color:['#2F4F4F'],title:{text:quList.numberchina[$('.drawing-6').parents('.drawing').index()]+'、学员对培训学习效果的满意度评分',textStyle:{color:'#111111',fontSize:18,fontWeight:100},top:10},tooltip:{trigger:'axis',axisPointer:{type:'shadow'}},grid:{left:'3%',right:'5%',bottom:'3%',containLabel:true},color:['#847ccf','#b8b3e2','#df94e0','#f59700'],xAxis:{type:'value',lineStyle:{color:'#000000'},max:100,axisLabel:{formatter:function(value){return value.toFixed(0)}},interval:20},yAxis:{type:'category',data:nameList,inverse:true,axisLabel:{show:true,formatter:function(params){return quList.formatter(params,10)}}},series:[{type:'bar',barMaxWidth:40,label:{show:true,position:'right',color:'#000'},barWidth:17,barGap:"0%",barCategoryGap:"60px",itemStyle:{barBorderRadius:[0,8,8,0]},data:dataList.map(function(x){return Number(x).toFixed(2)})}]};myChart.setOption(option)},demoTrain6:function(data){var dataList2=[];var nameList=data.satisfaction.wholeSatisfaction.wholeSatisfactionName;var dataList=data.satisfaction.wholeSatisfaction.wholeSatisfactionFraction;if(dataList.length==0){$('.drawing-7').parents('.drawing').remove();return false}var nameList2=[data.satisfaction.wholeSatisfaction.wholeSatisfactionName,'本期培训班平均满意度'];data.satisfaction.wholeSatisfaction.wholeSatisfactionFraction.push(quList.averageSatisfaction);dataList2=data.satisfaction.wholeSatisfaction.wholeSatisfactionFraction;dataList2=dataList2.map(function(x){return Number(x).toFixed(2)});var wid=$('.drawing-7').height();$('.drawing-7').replaceWith('<div  class="drawing-7" style="height:'+wid+'px"></div>');var myChart=echarts.init($('.drawing-7').get(0));var waterMarkText='';var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');canvas.width=canvas.height=100;ctx.textAlign='center';ctx.textBaseline='middle';ctx.globalAlpha=0.08;ctx.font='20px Microsoft Yahei';ctx.translate(50,50);ctx.rotate(-Math.PI/4);ctx.fillText(waterMarkText,0,0);option={color:['#2F4F4F'],backgroundColor:{type:'pattern',image:canvas,repeat:'repeat'},tooltip:{trigger:'axis',axisPointer:{type:'shadow'}},title:{text:quList.numberchina[$('.drawing-7').parents('.drawing').index()]+'、满意度',textStyle:{color:'#111111',fontSize:18,fontWeight:100},top:10},grid:{top:50,bottom:'5%	',left:'3%',right:'5%',containLabel:true},color:['#847ccf','#b8b3e2','#df94e0','#f59700'],xAxis:{type:'value',splitLine:{show:true},max:100,axisLabel:{formatter:function(value){return value.toFixed(0)}},interval:20},yAxis:{type:'category',inverse:true,data:nameList2,splitLine:{show:false},axisLabel:{show:true,formatter:function(params){return quList.formatter(params,10)}}},series:{type:'bar',barMaxWidth:40,label:{show:true,position:'right',color:'#000'},barWidth:17,barGap:"0%",barCategoryGap:"60px",itemStyle:{barBorderRadius:[0,8,8,0]},data:dataList2}};myChart.setOption(option)},demoTrain7:function(data){var nameList=data.schoolCharacteristic.singleElection.singleName;var dataList=data.schoolCharacteristic.singleElection.singleFraction;if(dataList.length==0){$('.drawing-8').parents('.drawing').remove();return false}dataList=dataList.map(function(x){return Number(x).toFixed(2)});var wid=$('.drawing-8').height();$('.drawing-8').replaceWith('<div  class="drawing-8" style="height:'+wid+'px"></div>');var myChart=echarts.init($('.drawing-8').get(0));var option1={color:['#2F4F4F'],title:{text:quList.numberchina[$('.drawing-8').parents('.drawing').index()]+'、办学特色',textStyle:{color:'#111111',fontSize:18,fontWeight:100},top:10},tooltip:{trigger:'axis',axisPointer:{type:'shadow'}},grid:{left:'3%',right:'5%',bottom:'3%',containLabel:true},color:['#847ccf','#b8b3e2','#df94e0','#f59700'],xAxis:{type:'value',lineStyle:{color:'#000000'},max:100,axisLabel:{formatter:function(value){return value.toFixed(0)}},interval:20},yAxis:{type:'category',data:nameList,inverse:true,axisLabel:{show:true,formatter:function(params){return quList.formatter(params,10)}}},series:[{type:'bar',label:{show:true,position:'right',color:'#000'},barWidth:17,barGap:"0%",barCategoryGap:"60px",itemStyle:{barBorderRadius:[0,8,8,0]},data:dataList}]};myChart.setOption(option1);$.each(data.schoolCharacteristic.multiSelection,function(k,v){var nameList2=[];var dataList2=[];var titleList2=v.multiITitle;nameList2=v.multiIName;dataList2=v.multiPercentage;var option2={color:['#2F4F4F'],title:{text:'          '+titleList2+": ",textStyle:{color:'#111111',fontSize:18,fontWeight:100}},tooltip:{trigger:'axis',axisPointer:{type:'shadow'},formatter:function(value){return value[0].name+'：'+value[0].value+'%'}},grid:{left:'3%',right:'5%',bottom:'3%',containLabel:true},color:['#847ccf','#b8b3e2','#df94e0','#f59700'],xAxis:{type:'value',lineStyle:{color:'#000000'},max:100,axisLabel:{formatter:function(value){return value.toFixed(0)}},interval:20},yAxis:{type:'category',data:nameList2,inverse:true,axisLabel:{show:true,formatter:function(params){return quList.formatter(params,10)}}},series:[{type:'bar',label:{show:true,position:'right',color:'#000',formatter:function(value){return value.value+'%'}},barWidth:17,barGap:"0%",barCategoryGap:"60px",itemStyle:{barBorderRadius:[0,8,8,0]},data:dataList2.map(function(x){return Number(x).toFixed(2)})}]};if(dataList2.length>4){$('.drawing-9').replaceWith('<div  class="drawing-9" style="width: 100%;"></div>');$('.drawing-9').css('height',400+((dataList2.length-4)*100)+'px')}else{$('.drawing-9').replaceWith('<div  class="drawing-9" style="width: 100%;"></div>');$('.drawing-9').css('height','400px')}myChart=echarts.init($('.drawing-9').get(0));myChart.setOption(option2)})},formatter:function(params,num){var newParamsName="";var paramsNameNumber=params.length;var provideNumber=num;var rowNumber=Math.ceil(paramsNameNumber/provideNumber);if(paramsNameNumber>provideNumber){for(var p=0;p<rowNumber;p+=1){var tempStr="";var start=p*provideNumber;var end=start+provideNumber;if(p==rowNumber-1){tempStr=params.substring(start,paramsNameNumber)}else{tempStr=params.substring(start,end)+"\n"}newParamsName+=tempStr}}else if(paramsNameNumber<provideNumber){for(var j=0;j<provideNumber-paramsNameNumber;j+=1){params='   '+params}newParamsName=params}else{newParamsName=params}return newParamsName},detailsList:[],getDetailsList:function(){var me=this;$('.class-tbody').empty();var projectCode=$yt_common.GetQueryString("projectCode");var traineeName=$('#keyword1').val();var classCacsi=quList.getChecks();var isEffective='0';$('.page1').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/questionnaire/getClassTraineeList",type:"post",data:{projectCode:projectCode,traineeName:traineeName,classCacsi:'1',isEffective:isEffective},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){me.detailsList=data.data;if(data.flag==0){var htmlTbody=$('.class-tbody');var htmlTr='';htmlTbody.empty();if(data.data.rows.length>0){$('.page1').show();var num=1;$.each(data.data.rows,function(i,v){var type='';var classCacsi='';if(v.classCacsi==0){classCacsi='未评价';type='--';}if(v.learningEffect=="0"){v.learningEffect="--"}if(v.towsls=="0"){v.towsls="--"}if(v.teachingActivites=="0"){v.teachingActivites="--"}if(v.designImplementation=="0"){v.designImplementation="--"}if(v.teachingEffect=="0"){v.teachingEffect="--"}if(v.criticismSuggestion==""){v.criticismSuggestion="--"}if(v.characteristic=="0"){v.characteristic='--'}if(v.classCacsi==1){classCacsi='已评价';type='<a class="yt-link lookDetails" id='+v.traineeId+'>查看</a>'}if(v.criticismSuggestion==""||v.criticismSuggestion==null){v.criticismSuggestion="--"}v.teacherRecommendation=JSON.parse(v.teacherRecommendation);if(v.teacherRecommendation.length!=0){$.each(v.teacherRecommendation,function(a,b){if(b.teacherName==""){b.teacherName="--"}if(b.contactWay==""){b.contactWay="--"}if(b.classTitle==""){b.classTitle="--"}if(b.orgName==""){b.orgName="--"}if(b.understandTeacher==""){b.understandTeacher="--"}if(a==0){htmlTr='<tr><td rowspan="'+v.teacherRecommendation.length+'">'+num++ +'</td><input type="hidden" class="traid" value="'+v.traineeId+'"><td rowspan="'+v.teacherRecommendation.length+'">'+v.traineeName+'</td><td rowspan="'+v.teacherRecommendation.length+'" class="text-overflow">'+v.designImplementation+'</td><td rowspan="'+v.teacherRecommendation.length+'" class="text-overflow">'+v.teachingEffect+'</td><td rowspan="'+v.teacherRecommendation.length+'" class="text-overflow">'+v.teachingActivites+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+v.towsls+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+v.learningEffect+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+v.characteristic+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+v.criticismSuggestion+'</td><td>'+b.teacherName+'</td><td>'+b.contactWay+'</td><td>'+b.classTitle+'</td><td>'+b.orgName+'</td><td>'+b.understandTeacher+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+classCacsi+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+type+'</td></tr>'}else{htmlTr+='<tr><td>'+b.teacherName+'</td><td>'+b.contactWay+'</td><td>'+b.classTitle+'</td><td>'+b.orgName+'</td><td>'+b.understandTeacher+'</td></tr>'}})}else{htmlTr='<tr><td>'+num++ +'</td><input type="hidden" class="traid" value="'+v.traineeId+'"><td>'+v.traineeName+'</td><td class="text-overflow">'+v.designImplementation+'</td><td class="text-overflow">'+v.teachingEffect+'</td><td class="text-overflow">'+v.teachingActivites+'</td><td>'+v.towsls+'</td><td>'+v.learningEffect+'</td><td>'+v.characteristic+'</td><td>'+v.criticismSuggestion+'</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>'+classCacsi+'</td><td>'+type+'</td></tr>'}htmlTbody.append(htmlTr)});}else{$('.page1').hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="15" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true });quList.lookDetails()},lookDetails:function(classCacsi){var me=this;$('.details-box').off().on('click','.lookDetails',function(){quList.showAlert5();var j=$(this).parent().parent().find('.traid').val();quList.getScoreDetail(j,success);$yt_baseElement.showLoading();function success(data){$yt_baseElement.hideLoading();console.log(data.data);$('#details-form').empty();var num=1;$.each(data.data,function(i,n){$('#details-form').append('<table style="margin-top: 5px"><tr><th><b style="font-weight: bolder;font-size: 16px;">'+n.itemName+'</b></th></tr></table>');$.each(n.itemsDetailsJson,function(x,y){if(y.types!=6&&y.types!=5){$('#details-form table:nth-child('+(i+1)+')').append('<tr id="title"><td colspan="2" style="padding:2px 10px">'+num+'、'+y.title+'</td></tr>')}if(y.types==1){var lastNum=5-y.titleVakue;$('#details-form table:nth-child('+(i+1)+')').append('<tr><td id="star" style="padding:2px 40px"></td></tr>');for(let q=0;q<y.titleVakue;q+=1){$('#details-form table:nth-child('+(i+1)+') #star:eq('+x+')').append('<img src="../../resources/images/starImg/star-on.png"/>')}for(var a=0;a<lastNum;a+=1){$('#details-form table:nth-child('+(i+1)+') #star:eq('+x+')').append('<img src="../../resources/images/starImg/star-off.png"/>')}}if(y.types==2){$.each(y.itemDetailsSpecific,function(c,s){$('#details-form table:nth-child('+(i+1)+')').append('<tr><td style="padding:2px 40px">'+s.specificValue+'</td></tr>')})}if(y.types==3){$.each(y.itemDetailsSpecific,function(p,u){$('#details-form table:nth-child('+(i+1)+')').append('<tr><td colspan="2" style="padding:2px 40px">'+u.specificValue+'</td></tr>')})}if(y.types==5){if(y.itemCode=="rollHead"){$('#details-form table:nth-child('+(i+1)+')').append('<tr id="title"><td colspan="2" style="padding:2px 10px">'+y.title+'</td></tr>');num=0}else{$('#details-form table:nth-child('+(i+1)+')').append('<tr id="title"><td colspan="2" style="padding:2px 10px">'+num+'、'+y.title+'</td></tr>')}$.each(y.itemDetailsSpecific,function(a,b){$('#details-form table:nth-child('+(i+1)+')').append('<tr><td colspan="2" style="padding:2px 40px">'+b.specificValue+'</td></tr>')})}if(y.types==6){$.each(y.teacherRecommend,function(c,s){$('#details-form table:nth-child('+(i+1)+')').append('<tr><td style="width: 200px;padding: 2px 0px 2px 10px;">'+s.identificationName+'</td><td>'+s.identificationValue+'</td></tr>')});num-=1}if(y.types==4){$('#details-form table:nth-child('+(i+1)+')').append('<tr><td colspan="2" style="padding:2px 40px">'+y.titleVakue+'</td></tr>')}num+=1})});$yt_alert_Model.setFiexBoxHeight($(".details-alert .yt-edit-alert-main"))}})},getDetailsExportList:function(){$(".exportList").on("click",function(){var projectCode=$yt_common.GetQueryString("projectCode");var traineeName=$('#keyword1').val();var classCacsi=quList.getChecks();var isEffective='1';var fileName="评分详情";var downUrl=$yt_option.base_path+"class/questionnaire/exportQuestionnaire";$.ajaxDownloadFile({url:downUrl,data:{projectCode:projectCode,traineeName:traineeName,classCacsi:'1',fileName:fileName,isEffective:isEffective,selectionType:2,isDownload:true,istraineeName:1}})})},getChecks:function(){var classCacsi='';var checks=$('input[name=test]:checked');$.each(checks,function(k,n){if(classCacsi==''){classCacsi+=checks[k].value}else{classCacsi+=','+checks[k].value}});return classCacsi},getScoreDetail:function(traineeIds,success){var projectCode=$yt_common.GetQueryString("projectCode");$.ajax({type:"post",url:$yt_option.base_path+"class/questionnaire/getTraineeQuestionnaire",async:true,data:{projectCode:projectCode,traineeId:traineeIds},success:function(data){success(data)}})},showAlert5:function(){$(".details-alert").show();$yt_alert_Model.setFiexBoxHeight($(".yt-edit-alert-main"));$yt_model_drag.modelDragEvent($(".yt-edit-alert .yt-edit-alert-title"));$('.yt-edit-alert .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},originalLookDetails:function(classCacsi){},originalList:[],getOriginalList:function(){var me=this;$('.class-tbody2').empty();var projectCode=$yt_common.GetQueryString("projectCode");var traineeName2=$('#keyword2').val();var classCacsi2=quList.getChecks2();var isEffective2='1';if(me.criticismSuggestionStates==2){$('.invalid,.effective').attr('disabled','disabled').css('background-color','#b5b5b5')}$('.page2').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/questionnaire/getClassTraineeList",type:"post",data:{projectCode:projectCode,traineeName:traineeName2,classCacsi:classCacsi2,isEffective:isEffective2},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){me.originalList=data.data;if(data.flag==0){var htmlTbody=$('.class-tbody2');var htmlTr='';htmlTbody.empty();if(data.data.rows.length>0){$('.page2').show();var num=1;$.each(data.data.rows,function(i,v){var type='';var classCacsi='';if(v.classCacsi==0){classCacsi='未评价';type='--';}if(v.learningEffect=="0"){v.learningEffect="--"}if(v.towsls=="0"){v.towsls="--"}if(v.teachingActivites=="0"){v.teachingActivites="--"}if(v.designImplementation=="0"){v.designImplementation="--"}if(v.teachingEffect=="0"){v.teachingEffect="--"}if(v.criticismSuggestion==""){v.criticismSuggestion="--"}if(v.characteristic=="0"){v.characteristic='--'}if(v.classCacsi==1){classCacsi='已评价';type='<a class="yt-link lookDetails" id='+v.traineeId+'>查看</a>'}if(v.classCacsi==2){classCacsi='<span style="color:red;">无效</span>';type='<a class="yt-link lookNoDetails lookDetails" id='+v.traineeId+'>查看</a>'}if(v.criticismSuggestion==""||v.criticismSuggestion==null){v.criticismSuggestion="--"}v.teacherRecommendation=JSON.parse(v.teacherRecommendation);if(v.teacherRecommendation.length!=0){$.each(v.teacherRecommendation,function(a,b){if(b.teacherName==""){b.teacherName="--"}if(b.contactWay==""){b.contactWay="--"}if(b.classTitle==""){b.classTitle="--"}if(b.orgName==""){b.orgName="--"}if(b.understandTeacher==""){b.understandTeacher="--"}if(a==0){htmlTr='<tr class="ex" exName="'+v.traineeId+'"><td rowspan="'+v.teacherRecommendation.length+'">'+num++ +'</td><input type="hidden" class="traineeId" value="'+v.traineeId+'"><td rowspan="'+v.teacherRecommendation.length+'">'+v.traineeName+'</td><td rowspan="'+v.teacherRecommendation.length+'" class="text-overflow">'+v.designImplementation+'</td><td rowspan="'+v.teacherRecommendation.length+'" class="text-overflow">'+v.teachingEffect+'</td><td rowspan="'+v.teacherRecommendation.length+'" class="text-overflow">'+v.teachingActivites+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+v.towsls+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+v.learningEffect+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+v.characteristic+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+v.criticismSuggestion+'</td><td>'+b.teacherName+'</td><td>'+b.contactWay+'</td><td>'+b.classTitle+'</td><td>'+b.orgName+'</td><td>'+b.understandTeacher+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+classCacsi+'</td><td rowspan="'+v.teacherRecommendation.length+'">'+type+'</td></tr>'}else{htmlTr+='<tr class="ex" exName="'+v.traineeId+'"><td>'+b.teacherName+'</td><td>'+b.contactWay+'</td><td>'+b.classTitle+'</td><td>'+b.orgName+'</td><td>'+b.understandTeacher+'</td></tr>'}})}else{htmlTr='<tr class="ex" exName="'+v.traineeId+'"><td>'+num++ +'</td><input type="hidden" class="traineeId" value="'+v.traineeId+'"><td>'+v.traineeName+'</td><td class="text-overflow">'+v.designImplementation+'</td><td class="text-overflow">'+v.teachingEffect+'</td><td class="text-overflow">'+v.teachingActivites+'</td><td>'+v.towsls+'</td><td>'+v.learningEffect+'</td><td>'+v.characteristic+'</td><td>'+v.criticismSuggestion+'</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>'+classCacsi+'</td><td>'+type+'</td></tr>'}htmlTbody.append(htmlTr)});}else{$('.page2').hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="15" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true });quList.lookDetails2()},getOriginalExportList:function(){$(".originalExportList").on("click",function(){var projectCode=$yt_common.GetQueryString("projectCode");var traineeName=$('#keyword2').val();var classCacsi=quList.getChecks2();var isEffective='0,1';var fileName="原始评分";var downUrl=$yt_option.base_path+"class/questionnaire/exportQuestionnaire";$.ajaxDownloadFile({url:downUrl,data:{projectCode:projectCode,traineeName:traineeName,classCacsi:classCacsi,fileName:fileName,isEffective:isEffective,selectionType:2,isDownload:true,istraineeName:1}})})},getChecks2:function(){var classCacsi='';var checks=$('input[name=test2]:checked');$.each(checks,function(k,n){if(classCacsi==''){classCacsi+=checks[k].value}else{classCacsi+=','+checks[k].value}});return classCacsi},lookDetails2:function(classCacsi){var me=this;$('.original-box').off().on('click','.lookDetails',function(){quList.showAlert5();var j=$(this).parent().parent().find('.traineeId').val();quList.getScoreDetail(j,success);$yt_baseElement.showLoading();function success(data){$yt_baseElement.hideLoading();console.log(data.data);$('#details-form').empty();var num=1;$.each(data.data,function(i,n){$('#details-form').append('<table style="margin-top: 5px"><tr><th><b style="font-weight: bolder;font-size: 16px;">'+n.itemName+'</b></th></tr></table>');$.each(n.itemsDetailsJson,function(x,y){console.log('num'+num);if(y.types!=6&&y.types!=5){$('#details-form table:nth-child('+(i+1)+')').append('<tr id="title"><td colspan="2" style="padding:2px 10px">'+num+'、'+y.title+'</td></tr>')}if(y.types==1){var lastNum=5-y.titleVakue;$('#details-form table:nth-child('+(i+1)+')').append('<tr><td id="star" style="padding:2px 40px"></td></tr>');for(let q=0;q<y.titleVakue;q+=1){$('#details-form table:nth-child('+(i+1)+') #star:eq('+x+')').append('<img src="../../resources/images/starImg/star-on.png"/>')}for(var a=0;a<lastNum;a+=1){$('#details-form table:nth-child('+(i+1)+') #star:eq('+x+')').append('<img src="../../resources/images/starImg/star-off.png"/>')}}if(y.types==2){$.each(y.itemDetailsSpecific,function(c,s){$('#details-form table:nth-child('+(i+1)+')').append('<tr><td style="padding:2px 40px">'+s.specificValue+'</td></tr>')})}if(y.types==3){$.each(y.itemDetailsSpecific,function(p,u){$('#details-form table:nth-child('+(i+1)+')').append('<tr><td colspan="2" style="padding:2px 40px">'+u.specificValue+'</td></tr>')})}if(y.types==5){if(y.itemCode=="rollHead"){$('#details-form table:nth-child('+(i+1)+')').append('<tr id="title"><td colspan="2" style="padding:2px 10px">'+y.title+'</td></tr>');num=0}else{$('#details-form table:nth-child('+(i+1)+')').append('<tr id="title"><td colspan="2" style="padding:2px 10px">'+num+'、'+y.title+'</td></tr>')}$.each(y.itemDetailsSpecific,function(a,b){$('#details-form table:nth-child('+(i+1)+')').append('<tr><td colspan="2" style="padding:2px 40px">'+b.specificValue+'</td></tr>')})}if(y.types==6){$.each(y.teacherRecommend,function(c,s){$('#details-form table:nth-child('+(i+1)+')').append('<tr><td style="width: 200px;padding: 2px 0px 2px 10px;">'+s.identificationName+'</td><td>'+s.identificationValue+'</td></tr>')});num-=1}if(y.types==4){$('#details-form table:nth-child('+(i+1)+')').append('<tr><td colspan="2" style="padding:2px 40px">'+y.titleVakue+'</td></tr>')}num+=1})});$yt_alert_Model.setFiexBoxHeight($(".details-alert .yt-edit-alert-main"))}})},updateEffective:function(isEffective){var bool=true;var projectCode=$yt_common.GetQueryString("projectCode");var traineeId=$(".yt-table-active .traineeId").val();var downUrl=$yt_option.base_path+"class/questionnaire/updateEffective";if($("tr.yt-table-active").length!=0){$.ajax({url:downUrl,async:false,type:'post',data:{projectCode:projectCode,traineeId:traineeId,isEffective:isEffective},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("标记成功")}else{$yt_alert_Model.prompt("标记失败")}}})}else{$yt_alert_Model.prompt("请选择要操作的数据");bool=false}return bool},refreshEffective:function(){$('.page2').pageInfo("refresh")},criticismSugg:function(){var me=this;var projectCode=$yt_common.GetQueryString('projectCode');$.ajax({type:"post",url:$yt_option.base_path+"class/questionnaire/getProjectTeacherRecommend",async:false,data:{projectCode:projectCode},success:function(data){if(data.flag==0){var htmlTr='';var criticismSuggestion=data.data.criticismSuggestion;if(criticismSuggestion!=""){$(".cri-and-sug textarea").val(criticismSuggestion)}else{$(".cri-and-sug textarea").val("")}var teacherRecommend=data.data.teacherRecommend;$(".teacher-recommend table tbody").empty();if(teacherRecommend.length!=0){$(".teacher-recommend table").attr('teaTr',1);$.each(teacherRecommend,function(i,n){if(n.teacherName==undefined){n.teacherName=''}if(n.contactWay==undefined){n.contactWay=''}if(n.classTitle==undefined){n.classTitle=''}if(n.orgName==undefined){n.orgName=''}if(n.understandTeacher==undefined){n.understandTeacher=''}htmlTr='<tr><td style="text-align:center;"><span style="display:none">'+n.teacherName+'</span><input type="text" class="yt-input input-td tea-name" value="'+n.teacherName+'"/></td><td style="text-align:center;"><span style="display:none">'+n.contactWay+'</span><input type="text" class="yt-input input-td contact-way" value="'+n.contactWay+'"/></td><td style="text-align:center;"><span style="display:none">'+n.classTitle+'</span><input type="text" class="yt-input input-td cla-title" value="'+n.classTitle+'"/></td><td><span style="display:none">'+n.orgName+'</span><input type="text" class="yt-input input-td org-name" value="'+n.orgName+'"/></td><td><span style="display:none">'+n.understandTeacher+'</span><input type="text" class="yt-input input-td understand-teacher" value="'+n.understandTeacher+'"/></td><td class="ope-td" style="text-align:center"><img class="del-icon" src="../../resources/images/icons/cost-level.png"/>'+'</td></tr>';$(".teacher-recommend table tbody").append(htmlTr)})}else{$(".teacher-recommend table").attr('teaTr',0);}$(".teacher-recommend table tbody tr").find('input.input-td').off().on('input',function(){$(this).siblings('span').text($(this).val())});if(data.data.criticismSuggestionStates==2){me.criticismSuggestionStates=2;$(".teacher-recommend table th.teach-th").hide();$(".teacher-recommend table tbody td.ope-td").hide();$(".teacher-recommend table tbody td .input-td").hide().siblings('span').show();$(".teacher-recommend div.ope-tr").hide();$(".teacher-recommend table tbody .add-tr").hide();$(".teacher-recommend div.bootom-btn").hide();$(".cri-and-sug textarea").attr('readonly','readonly');$(".cri-and-sug textarea").css('border','none')}$(".cri-and-sug textarea").autoHeight()}else{}}})},criticismSuggestionStates:1,addContentText:function(){quList.criticismSugg();var thisUser=$yt_common.GetQueryString('thisUrs');var teaTr=$(".teacher-recommend table").attr('teaTr');var criSug=$(".cri-and-sug textarea").val();console.log('thisUser',thisUser);if(thisUser!="300"){$('.yt-option-btn.details-info-btn').hide();$('.yt-option-btn.original-info-btn').hide();if(teaTr!="1"){$(".teacher-recommend").hide()}else{$(".teacher-recommend").show();$(".teacher-recommend table th.teach-th").hide();$(".teacher-recommend table tbody td.ope-td").hide();$(".teacher-recommend div.ope-tr").hide();$(".teacher-recommend div.bootom-btn").hide()}if(criSug==""){$(".cri-and-sug").hide()}else{$(".cri-and-sug").show();$(".cri-and-sug textarea").attr('readonly','readonly');$(".cri-and-sug textarea").css('border','none');$(".cri-and-sug textarea").autoHeight()}}$(".teacher-recommend .bootom-btn .updateTeacherRecommend").off('click').click(function(){$yt_alert_Model.alertOne({leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据提交后将无法修改，确认提交吗？",confirmFunction:function(){quList.addTeacherRecommend(2)}})});$(".teacher-recommend .bootom-btn .saveTeacherRecommend").off('click').click(function(){quList.addTeacherRecommend(1)});$(".teacher-recommend table tbody").off().on('click','img.del-icon',function(e){$(this).parents('tr').remove();});$(".teacher-recommend div.ope-tr.add-new-tr").click(function(){var htmlTr='<tr class="add-tr"><td><input type="text" class="yt-input tea-name"/></td><td><input type="text" class="yt-input contact-way"/></td><td><input type="text" class="yt-input cla-title"/></td><td><input type="text" class="yt-input org-name"/></td><td><input type="text" class="yt-input understand-teacher"/></td><td style="text-align:center"><img class="del-icon" src="../../resources/images/icons/cost-level.png"/>'+'</td></tr>';$(".teacher-recommend table tbody").append(htmlTr)})},addTeacherRecommend:function(criticismSuggestionStates){var teaName=true;var projectCode=$yt_common.GetQueryString('projectCode');var criticismSuggestion=$(".cri-and-sug textarea").val();var addTr=$(".teacher-recommend table tbody tr[class!='ope-tr']");console.log('addTr',addTr);var teacherRecommend=[];if(addTr.length!=0){$.each(addTr,function(i,v){var teacherName=$(v).find('.tea-name').val();var contactWay=$(v).find('.contact-way').val();var classTitle=$(v).find('.cla-title').val();var orgName=$(v).find('.org-name').val();var understandTeacher=$(v).find('.understand-teacher').val();if(teacherName==""){teaName=false;$yt_alert_Model.prompt("请填写教师姓名");return false}var teacherRe={teacherName:teacherName,contactWay:contactWay,classTitle:classTitle,orgName:orgName,understandTeacher:understandTeacher};teacherRecommend.push(teacherRe)});teacherRecommend=JSON.stringify(teacherRecommend)}else{teacherRecommend=""}if(teaName){$.ajax({type:"post",url:$yt_option.base_path+"class/questionnaire/addProjectTeacherRecommend",async:true,beforeSend:function(){$yt_baseElement.showLoading()},data:{projectCode:projectCode,criticismSuggestionStates:criticismSuggestionStates,criticismSuggestion:criticismSuggestion,teacherRecommend:teacherRecommend},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){if(criticismSuggestionStates==1){$yt_alert_Model.prompt('保存成功')}else{$yt_alert_Model.prompt('提交成功')}});quList.criticismSugg()}else{$yt_baseElement.hideLoading(function(){if(criticismSuggestionStates==1){$yt_alert_Model.prompt('保存失败')}else{$yt_alert_Model.prompt('提交失败')}})}}})}}};$(function(){$yt_baseElement.showLoading();quList.init()});