var groupTubeList={init:function(){$('.province-select').niceSelect();$('.merge-province-select').niceSelect();$('.company-types-select').niceSelect();$('.classify-select').niceSelect();$('.group-type-select').niceSelect();$('.group-merge-type-select').niceSelect();$('.company-merge-types-select').niceSelect();$('.belong-group-merge').niceSelect();$('.belong-org').niceSelect();var pkId="";$('.merge-btn').on('click',function(){var checkLength=$("input[name='groupCheck']:checked").length;var classify=$("input[name='groupCheck']:checked").attr("rowType");if(classify==1){$('.yt-edit-alert-title-msg').text("集团合并");$('.merge-name-text').text("集团名称：");$('.company-merge-part').hide();$('.group-merge-part').show()}else if(classify==2){$('.yt-edit-alert-title-msg').text("单位合并");$('.merge-name-text').text("单位名称：");$('.company-merge-part').show();$('.group-merge-part').hide()}$.each($("input[name='groupCheck']:checked"),function(i,n){$('.merge-table').append('<tr><td>'+(i+1)+'</td><td>'+$(n).parents('span').text()+'</td></tr>')});groupTubeList.initForm();groupTubeList.mergeFormListData();groupTubeList.provinceSelectData();if(checkLength>1){groupTubeList.showAlert6()}else{$yt_alert_Model.prompt("合并请最少选中两行")}});$('.search-btn').on('click',function(){var groupName=$('#keyword').val();groupTubeList.getGroupList()});$(".addList").on('click',function(){$('.yt-edit-alert-title-msg').text("新增集团");groupTubeList.initForm();$('.classify-select').setSelectVal('1');$('.company-part').hide();$('.group-part').show();$('.modifiable-name').text("集团名称：");$('.valid-hint').removeClass('valid-hint');groupTubeList.showAlert5()});$(".updateList").on('click',function(){groupTubeList.initForm();$(".valid-font").text("");$('.valid-hint').removeClass('valid-hint');pkId=$("input[name='groupCheck']:checked").val();var checkLength=$("input[name='groupCheck']:checked").length;if(checkLength==1){groupTubeList.showAlert5();$('.province-select').setSelectVal($("input[name='groupCheck']:checked").attr("province"));$('.classify-select').setSelectVal($("input[name='groupCheck']:checked").attr("rowType"));$('.group-name').val($("input[name='groupCheck']:checked").attr("groupName"));$('.belong-group').setSelectVal($("input[name='groupCheck']:checked").attr("parentId"));$('.group-type-select').setSelectVal($("input[name='groupCheck']:checked").attr("groupType"));$('.company-types-select').setSelectVal($("input[name='groupCheck']:checked").attr("types"));$('.group-num').val($("input[name='groupCheck']:checked").attr("groupNum"));$('.remarks-textarea').val($("input[name='groupCheck']:checked").attr("remarks"));groupTubeList.clickClassific();var classify=$("input[name='groupCheck']:checked").attr("rowType");if(classify==1){$('.yt-edit-alert-title-msg').eq(0).text("修改集团")}else if(classify==2){$('.yt-edit-alert-title-msg').eq(0).text("修改单位")}}else{$yt_alert_Model.prompt("请选中一行进行修改")}});$('select.province-select,select.group-type-select,.belong-org').change(function(){if($(this).val()!=''){$(this).siblings(".valid-font").text("");$(this).parents('td').find('.valid-hint').removeClass('valid-hint')}});$('.belong-group').change(function(){if($(this).val()!=''){$(this).siblings(".valid-font").text("");$(this).parents('td').find('.valid-hint').removeClass('valid-hint')}groupTubeList.getBelongGroup($(this).val())});$('.company-types-select').change(function(){if($(this).val()!=''){$(this).siblings(".valid-font").text("");$(this).parents('td').find('.valid-hint').removeClass('valid-hint')}if($(this).val()==3){$('.belong-org-tr').show();groupTubeList.getBelongGroup($('.belong-group').val())}else{$('.belong-org-tr').hide()}});$('.group-submit-btn').on('click',function(){var classify=$('.classify-select').val();if($yt_valid.validForm($(".valid-table tr:visible"))){if(pkId==""){groupTubeList.addGroupData(pkId)}else{groupTubeList.addGroupData(pkId)}}});$('.merge-submit-btn').on('click',function(){if($yt_valid.validForm($(".valid-table2 td:visible"))){var classify=$("input[name='groupCheck']:checked").attr("rowType");if(classify==1){groupTubeList.groupMerge()}else{groupTubeList.companyMerge()}}});$('.classify-select').change(function(){groupTubeList.clickClassific()});groupTubeList.getGroupList();groupTubeList.clickClassific()},mergeFormListData:function(){$('.list-table tbody tr').remove();var groupList=[];$("input[name='groupCheck']:checked").each(function(){groupList.push($(this).attr("groupName"))});for(var a=0;a<groupList.length;a+=1){var num=a+1;$('.list-table tbody ').append('<tr><td>'+num+'</td><td>'+groupList[a]+'</td></tr>')}},groupMerge:function(){var groupMergeId="";$("input[name='groupCheck']:checked").each(function(){if(groupMergeId==""){groupMergeId+=$(this).val()}else{groupMergeId+=','+$(this).val()}});var parentId=0;var classify=1;var groupName=$('.merge-name').val();var province=$('.merge-province-select').val();var groupType=$('.group-merge-type-select').val();var groupNum=$('.merge-group-num').val();var remarks=$('.merge-remarks').val();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"group/addGroupMerge",data:{groupMergeId:groupMergeId,classify:classify,groupName:groupName,parentId:parentId,province:province,groupType:groupType,groupNum:groupNum,remarks:remarks},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("合并成功");groupTubeList.getGroupList();$(".merge-form,#heard-nav-bak").hide()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("合并失败")})}}})},companyMerge:function(){var groupMergeId="";$("input[name='groupCheck']:checked").each(function(){if(groupMergeId==""){groupMergeId+=$(this).val()}else{groupMergeId+=','+$(this).val()}});var parentId=$('.belong-group-merge').val();var classify=2;var groupName=$('.merge-name').val();var province=$('.merge-province-select').val();var types=$('.company-merge-types-select').val();var groupNum=$('.merge-group-num').val();var remarks=$('.merge-remarks').val();$.ajax({type:"post",url:$yt_option.base_path+"group/addGroupMerge",data:{groupMergeId:groupMergeId,classify:classify,groupName:groupName,parentId:parentId,province:province,types:types,groupNum:groupNum,remarks:remarks},async:true,success:function(data){if(data.flag==0){$yt_alert_Model.prompt("合并成功");groupTubeList.getGroupList();$(".merge-form,#heard-nav-bak").hide()}else{$yt_alert_Model.prompt("合并失败")}}})},initForm:function(){$(".valid-font").text("");$('.belongs-group').hide();$('.classify-select').setSelectVal("");$('.belong-group').setSelectVal("");$('.group-name').val("");$('.province-select').val("");$('.group-type-select').setSelectVal("");$('.company-types-select').setSelectVal("");$('.group-num').val("");$('.remarks-textarea').val("");$('.merge-name').val("");$('.merge-province-select').setSelectVal("");$('.group-merge-type-select').setSelectVal("");$('.company-merge-types-select').setSelectVal("");$('.merge-group-num').val("");$('.merge-remarks').val("");$('select.belong-org').empty();$('select.belong-org').append('<option value="">请选择</option>');$('select.belong-org').niceSelect()},getBelongGroup:function(groupId){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"uniform/group/getGroups",data:{isSelectGroup:3,groupId:groupId},async:true,success:function(data){if(data.flag==0){$('select.belong-org').empty();$('select.belong-org').append('<option value="">请选择</option>');if(groupId!=''){$.each(data.data,function(t,y){if(y.types=='央企二级公司'){$('select.belong-org').append('<option value="'+y.groupId+'">'+y.groupName+'</option>')}})}$('select.belong-org').niceSelect({search:true,backFunction:function(text){$("select.belong-org option").remove();if(text==""){$("select.belong-org").append('<option value="">请选择</option>')}$.each(data.data,function(i,n){if(n.groupName.indexOf(text)!=-1){if(n.types=='央企二级公司'){$("select.belong-org").append('<option value="'+n.groupId+'">'+n.groupName+'</option>')}}})}});$yt_baseElement.hideLoading()}}})},clickClassific:function(){var classify=$('.classify-select').val();if(classify==1){$('.modifiable-name').text("集团名称：");$('.yt-edit-alert-title-msg').text("新增集团");$('.company-part').hide();$('.group-part').show();$('.belong-group').setSelectVal("");$('.company-types-select').setSelectVal("")}else if(classify==2){$('.group-type-select').setSelectVal("");$('.yt-edit-alert-title-msg').text("新增单位");$('.modifiable-name').text("单位名称：");$('.company-part').show();$('.belong-org-tr').hide();$('.group-part').hide()}},addGroupData:function(pkId){var parentId;if($('.belong-org-tr').is(':visible')){parentId=$(".belong-org").val()}else{parentId=$(".belong-group").val()}var classify=$('.classify-select').val();var groupName=$('.group-name').val();var province=$('.province-select').val();var groupType=$('.group-type-select').val();var types=$('.company-types-select').val();var groupNum=$('.group-num').val();var remarks=$('.remarks-textarea').val();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"group/addOrUpdate",data:{pkId:pkId,classify:classify,groupName:groupName,parentId:parentId,province:province,groupType:groupType,types:types,groupNum:groupNum,remarks:remarks},async:true,success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交成功");$(".yt-edit-alert,#heard-nav-bak").hide();groupTubeList.getGroupList()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("提交失败")})}},error:function(){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("网络异常，提交失败")})}})},getProvince:function(){var provinceList=[];$.ajax({type:"get",url:$yt_option.base_path+"website/resources/js/modules/groupTube/province.json",async:false,success:function(data){provinceList=data||[]}});return provinceList},provinceSelectData:function(){var province=groupTubeList.getProvince();$('.province-select').empty();$('.merge-province-select').empty();$('.province-select').append(' <option value="">请选择</option>');$('.merge-province-select').append(' <option value="">请选择</option>');$.each(province,function(i,t){$('.province-select').append(' <option value="'+t.text+'">'+t.text+'</option>');$('.merge-province-select').append(' <option value="'+t.text+'">'+t.text+'</option>')});$('.province-select').niceSelect();$('.merge-province-select').niceSelect()},showAlert5:function(){var me=this;$('select.belong-group').empty();$("select.belong-group").append('<option value="">请选择</option>');$('select.belong-group').niceSelect({search:true,backFunction:function(text){$("select.belong-group option").remove();if(text==""){$("select.belong-group").append('<option value="">请选择</option>')}$.each(me.groupList,function(i,n){if(n.groupName.indexOf(text)!=-1){if(n.classify==1){$("select.belong-group").append('<option value="'+n.pkId+'" types=3 >'+n.groupName+'</option>')}}})}});$(".add-update-form,#heard-nav-bak").show();groupTubeList.provinceSelectData();$yt_alert_Model.getDivPosition($(".add-update-form"));$yt_model_drag.modelDragEvent($(".add-update-form .yt-edit-alert-title"));$('.add-update-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".add-update-form,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},showAlert6:function(){$(".merge-form,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($(".merge-form"));$yt_alert_Model.setFiexBoxHeight($(".merge-form .yt-edit-alert-main"));$yt_model_drag.modelDragEvent($(".merge-form .yt-edit-alert-title"));$('.merge-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".merge-form,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},groupList:[],getGroupList:function(){var me=this;var groupName=$('#keyword').val();$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+'group/getGroups',data:{groupName:groupName},async:true,success:function(data){if(data.flag==0){$('.belong-group option:gt(0)').remove();$('.belong-group-merge option:gt(0)').remove();$.each(data.data,function(t,y){if(y.classify==1){$('.belong-group').append('<option value="'+y.pkId+'">'+y.groupName+'</option>');$('.belong-group-merge').append('<option value="'+y.pkId+'">'+y.groupName+'</option>')}});me.groupList=data.data;$('select.belong-group').niceSelect({search:true,backFunction:function(text){$("select.belong-group option").remove();if(text==""){$("select.belong-group").append('<option value="">请选择</option>')}$.each(me.groupList,function(i,n){if(n.groupName.indexOf(text)!=-1){if(n.classify==1){$("select.belong-group").append('<option value="'+n.pkId+'" types=3 >'+n.groupName+'</option>')}}})}});$('.belong-group-merge').niceSelect();var treeObj=$yt_common.getTreeData(data.data,0);console.log(treeObj);$('#tt').treegrid({data:treeObj,method:'post',animate:true,cascadeCheck:false,checkOnSelect:true,fitColumns:true,idField:'pkId',treeField:'groupName',queryParams:{groupName:groupName},columns:[[{field:'groupNum',title:'排序',width:'5%'},{field:'groupName',title:'集团单位名称',width:'66.9%',formatter:function(value,row,index){return '<label class="check-label yt-checkbox"><input type="checkbox" name="groupCheck" value="'+row.pkId+'" rowType="'+row.classify+'"groupName="'+row.groupName+'"parentId="'+row.parentId+'"types="'+row.types+'"province="'+row.province+'"groupNum="'+row.groupNum+'"remarks="'+row.remarks+'"groupType="'+row.groupType+'"/></label>  '+value}},{field:'province',title:'省份',width:'10%'},{field:'types',title:'单位性质',width:'10%',formatter:function(value,row,index){console.log("types",value);if(value==1){value="央企集团本部"}else if(value==2){value="央企二级公司"}else if(value==3){value="央企三级公司"}else if(value==4){value="省属企业"}else if(value==5){value="市属企业"}else if(value==6){value="其他"}return value}},{field:'groupType',title:'行业分类',width:'10%',formatter:function(value,row,index){console.log("groupType",value);if(value==1){value="国家行政企业"}else if(value==2){value="公私合作企业"}else if(value==3){value="中外合资企业"}else if(value==4){value="社会组织机构"}else if(value==5){value="国际组织机构"}return value}}]],onLoadSuccess:function(){$("input[name='groupCheck']").change(function(){if($(this).attr("rowType")!=$("input[name='groupCheck']:checked:gt(0)").attr("rowType")&&$("input[name='groupCheck']:checked").length>1||$(this).attr("rowType")!=$("input[name='groupCheck']:checked:eq(0)").attr("rowType")&&$("input[name='groupCheck']:checked").length>1){$(this).setCheckBoxState("uncheck");$yt_alert_Model.prompt("只能选择同一级的单位")}})}});$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}}})}};$(function(){groupTubeList.init()});