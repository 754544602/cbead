var item={dtree:null,treeAllData:null,init:function(){item.tablePage();item.flodShow()},flodShow:function(){$('.fold-tr').createTableFlod({text:function(obj){$(obj).addClass('yt-table-active');return item.getBudgetSpecialInfoById()},speed:200});$("body").delegate("textarea.level-three","click",function(){item.clickAlert();$(".relevance-pop").on("click",".canel-btn",function(){$(".rela-dept-search").val('');$('.role-right-ul').find('li').remove();sysCommon.closeModel($(".relevance-pop"));});$(".set-role-button").on("click",".right",function(){var checkNode=$("#dataItemTree").tree('getChecked');var ulBody=$(".role-right-ul");var checkDict={};var liAttr=$(".role-right-ul").find('li');if(liAttr!=undefined){var checkKey="";var checkValue=",";var getLiVal="";$.each(liAttr,function(i,d){getLiVal=$(d).attr('liid')==undefined||$(d).attr('liid')==null?"":$(d).attr('liid');checkKey=$(d).attr('tableDictCode')==undefined||$(d).attr('tableDictCode')==null?"":$(d).attr('tableDictCode');checkValue=checkDict[checkKey];if(checkValue==undefined||checkValue==null){checkValue=","}checkValue=checkValue+(getLiVal==""?"":getLiVal+",");checkDict[checkKey]=checkValue})}checkValue="";var liStr="";$.each(checkNode,function(i,n){if(n.sortId){checkValue=checkDict[n.tableDictCode]==undefined||checkDict[n.tableDictCode]==null?"":checkDict[n.tableDictCode];if(checkValue.indexOf(","+n.id+",")<0){liStr+='<li tableDictCode="'+n.tableDictCode+'" liid='+n.id+'>'+n.text+'</li>'}}});ulBody.append(liStr)});$(".set-role-button").on("click",".d-right",function(){var uncheckNode=$('#dataItemTree').tree('getChecked','unchecked');var checkNodes=$('#dataItemTree').tree('getChecked');$.each(uncheckNode,function(i,n){$("#dataItemTree").tree("check",n.target)});$.each(checkNodes,function(i,n){$("#"+n.domId).find("span.tree-title").css("color","rgb(65, 141, 204)")});$("#dataItemTree").tree('expandAll',uncheckNode.target);var checkNode=$('#dataItemTree').tree('getChecked');var ulBody=$(".role-right-ul");var checkDict={};var liAttr=$(".role-right-ul").find('li');if(liAttr!=undefined){var checkKey="";var checkValue=",";var getLiVal="";$.each(liAttr,function(i,d){getLiVal=$(d).attr('liid')==undefined||$(d).attr('liid')==null?"":$(d).attr('liid');checkKey=$(d).attr('tableDictCode')==undefined||$(d).attr('tableDictCode')==null?"":$(d).attr('tableDictCode');checkValue=checkDict[checkKey];if(checkValue==undefined||checkValue==null){checkValue=","}checkValue=checkValue+(getLiVal==""?"":getLiVal+",");checkDict[checkKey]=checkValue})}checkValue="";var liStr="";$.each(checkNode,function(i,n){checkValue=checkDict[n.tableDictCode]==undefined||checkDict[n.tableDictCode]==null?"":checkDict[n.tableDictCode];if(checkValue.indexOf(","+n.id+",")<0){liStr+='<li tableDictCode="'+n.tableDictCode+'" liid='+n.id+'>'+n.text+'</li>'}});ulBody.append(liStr)});$(".set-role-button").on("click",".left",function(){var rootNode=$('#dataItemTree').tree('getRoot');var childNode=$('#dataItemTree').tree('getChildren',rootNode.target);var parentNode="";var parentsNode="";var selDatas=[];$(".role-right-ul li.li-active").each(function(i,n){selDatas.push($(n).attr('liid'))});$.each(childNode,function(i,n){$.each(selDatas,function(i,s){if(n.id==selDatas[i]){$("#dataItemTree").tree("uncheck",n.target);$("#"+n.domId).find("span.tree-title").css("color","#333")}})});$(".role-right-ul").find('.li-active').remove()});$(".set-role-button").on("click",".d-left",function(){var oneright=$("#dataItemTree").tree('getChecked');var rootNode=$('#dataItemTree').tree('getRoot');$("#dataItemTree").tree('collapseAll',rootNode.target);$.each(oneright,function(i,n){$('#dataItemTree').tree('uncheck',oneright[i].target)});$(".role-right-ul").find('li').remove()});$(".role-right-ul").on('click',"li",function(){$(this).toggleClass('li-active')});item.getAllBudgetSpecialInfoList()})},getBudgetSpecialInfoById:function(){var tableData=$("#flod-table .yt-table-active").data("tableData");var reStr="";$.ajax({type:"post",url:"budget/special/getBudgetSpecialInfoById",async:false,data:{specCode:tableData.secondSpecialCode},success:function(data){if(data.flag==0){var datas=data.data;if(datas.includeAttr==""){var inc=0}else{var inc=1}reStr+='<div style="height:200px;" class="bold-div"><div class="item-div">数据项信息<label class="check-label yt-checkbox '+(inc==1?'check':'')+'"style="margin-left: 20px;"><input id="itemInformation" type="checkbox" name="test" value="0" disabled="disabled"/>带文本输入框<span>（文本输入框的位置始终在最后）</span></label></div><div class="level-one-div">一级：<span class="level-one">'+datas.firstSpecialName+'</span></div><div class="level-two-div">二级：<span class="level-two">'+datas.secondSpecialName+'</span></div><div class="level-three-div"><div style="float: left;line-height: 28px;">三级：</div><div style="float: left;width: 90%;"><textarea style="cursor: pointer;" class="level-three yt-textarea"  readonly="readonly">'+datas.thirdSpecialName+'</textarea></div></div></div>';}}});return reStr},getAllBudgetSpecialInfoList:function(){var tableData=$("#flod-table .yt-table-active").data("tableData");$.ajax({type:"post",url:"budget/special/getAllBudgetSpecialInfoList",async:false,data:{specCode:tableData.secondSpecialCode},success:function(data){var trStr="";if(data.flag==0){var dataL=data.data.tableKeyList;item.treeAllData=dataL;var dataR=data.data.rightTableKeyList;$("#dataItemTree").tree({data:dataL,animate:true,checkbox:true,onClick:function(node){if(node.checkState!=undefined){if(node.checkState=="checked"){$("#dataItemTree").tree("uncheck",$("#"+node.domId));$("#"+node.domId).find("span.tree-title").css("color","#333")}else{$("#dataItemTree").tree("check",$("#"+node.domId));$("#"+node.domId).find("span.tree-title").css("color","#418dcc")}}},onCheck:function(node,checked){if(checked){$("#"+node.domId).find("span.tree-title").css("color","#418dcc");$("#"+node.domId).next().find("li span.tree-title").css("color","#418dcc")}else{$("#"+node.domId).find("span.tree-title").css("color","#333");$("#"+node.domId).next().find("li span.tree-title").css("color","#333")}}});$(".tree-icon,.tree-file").removeClass("tree-icon tree-file");$(".tree-icon,.tree-folder").removeClass("tree-icon tree-folder tree-folder-open tree-folder-closed");var liStr="";var htmlUl=$(".role-right-ul");if(dataR.length>0){$(".role-right-ul").find('li').remove();$.each(dataR,function(i,n){liStr+='<li tableDictCode="'+n.tableDictCode+'" liId='+n.subCode+'>'+n.subName+'</li>'});htmlUl.append(liStr)}}}})},saveBudgetSpecialInfo:function(){var tableData=$("#flod-table .yt-table-active").data("tableData");var keyLi="";var addJson={};var addListJson=[];var alli=$(".role-right-ul").find('li');$.each(alli,function(i,d){keyLi+=$(d).attr('liid');addJson={tableDictCode:$(d).attr('tableDictCode'),subCode:$(d).attr('liid')};addListJson.push(addJson)});var addListJsonStr=JSON.stringify(addListJson);$.ajax({type:"post",url:"budget/special/saveBudgetSpecialInfo",async:false,data:{specCode:tableData.secondSpecialCode,addJson:addListJsonStr},success:function(data){$yt_alert_Model.prompt(data.message);$(".rela-dept-search").val('');$('.role-right-ul').find('li').remove();sysCommon.closeModel($(".relevance-pop"));$("#flod-table  div.fold-div").html(item.getBudgetSpecialInfoById())}})},clickAlert:function(){sysCommon.showModel($("#relevancePop"));$("#relevancePop").off().on("click",".save-btn",function(){item.saveBudgetSpecialInfo()});$(".input-search").on("click","#resetBtn",function(){$(".rela-dept-search").val('');item.getAllBudgetSpecialInfoList()});$(".input-search").on("click","#queryBtn",function(){var searchText=$(".rela-dept-search").val();var searchData=[];var searchParentInfo={};var searchChildData=[];var checkDict={};var checkKey="";var checkValue=",";var getLiVal="";var alli=$(".role-right-ul").find('li');$.each(alli,function(i,d){checkKey=$(d).attr('tableDictCode');getLiVal=$(d).attr('liid');checkValue=checkDict[checkKey];if(checkValue==undefined||checkValue==null){checkValue=","}checkValue=checkValue+(getLiVal==""?"":getLiVal+",");checkDict[checkKey]=checkValue});checkValue="";var leftData=[];leftData=JSON.parse(JSON.stringify(item.treeAllData));$.each(leftData,function(i,p){searchParentInfo={};searchChildData=[];$.each(p.children,function(j,c){checkValue=checkDict[p.tableDictCode]==undefined||checkDict[p.tableDictCode]==null?"":checkDict[p.tableDictCode];c.checked=false;if(checkValue.indexOf(","+c.id+",")>-1){c.checked=true}if(searchText!=null&&searchText!=""){if(c.text.indexOf(searchText)>-1){searchChildData.push(c)}}});if(null!=searchChildData&&searchChildData.length>0){searchParentInfo=p;searchParentInfo["children"]=searchChildData;searchData.push(searchParentInfo)}});if(searchText==null||searchText==""){searchData=leftData}$('#dataItemTree').tree('loadData',searchData);$(".tree-icon,.tree-file").removeClass("tree-icon tree-file");$(".tree-icon,.tree-folder").removeClass("tree-icon tree-folder tree-folder-open tree-folder-closed")})},tablePage:function(){$.ajax({type:"post",url:"budget/special/getBudgetSpecialInfoList",async:false,success:function(data){var htmlTbody=$('#flod-table .yt-tbody');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data;if(datas.length>0){$.each(datas,function(i,n){trStr+='<tr class="fold-tr"><td style="text-align: left;">'+n.firstSpecialName+'</td><td style="text-align: left;">'+n.secondSpecialName+'</td><td style="text-align: left;" class="text-overflow" title="'+(n.thirdSpecialName||'无')+'">'+(n.thirdSpecialName||'无')+'</td><td>'+(n.includeAttr=="TEXT"?"是":"否")+'</td><td style="'+(n.state=1?'color:green':'color:red')+'">'+(n.state=1?'启用':'停用')+'</td></tr>';trStr=$(trStr).data("tableData",n);htmlTbody.append(trStr)})}else{htmlTbody.html(sysCommon.noDataTrStr(5))}}else{htmlTbody.html(sysCommon.noDataTrStr(5));$yt_alert_Model.prompt(data.message)}}})}};function getMultiChecked(checkNode){var check='';$.each(checkNode,function(i,n){check+=n.id+','+n.name+';'});console.log(check)}$(function(){item.init()});