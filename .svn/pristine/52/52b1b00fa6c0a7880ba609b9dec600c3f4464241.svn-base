function Node(e,g,b,a,k,d,i,h,f,l,c){this.id=e;this.pid=g;this.name=b;this.url=a;this.title=k;this.target=d;this.icon=i;this.iconOpen=h;this._io=f||false;this._is=false;this._ls=false;this._hc=false;this._ai=0;this._p;this.checked=l||false;this.nodeData=c}function dTree(c,a,b){this.config={target:null,folderLinks:true,useSelection:true,useCookies:true,useLines:true,useIcons:true,useStatusText:false,closeSameLevel:false,inOrder:false,check:false};if(!b){b="img/"}this.icon={root:b+"base.gif",folder:b+"folder.gif",folderOpen:b+"img-dtree-root.png",node:b+"img-dtree-child.png",empty:b+"empty.gif",line:b+"line.gif",join:b+"join.gif",joinBottom:b+"joinbottom.gif",plus:b+"plus.gif",plusBottom:b+"plusbottom.gif",minus:b+"minus.gif",minusBottom:b+"minusbottom.gif",nlPlus:b+"nolines_plus.gif",nlPlus:b+"nolines_plus.gif",nlMinus:b+"nolines_minus.gif"};this.cbCollection=new Object();this.obj=a;this.aNodes=[];this.aIndent=[];this.checkednodes=[];this.root=new Node(-1);this.objId=c;this.selectedNode=null;this.selectedFound=false;this.completed=false}dTree.prototype.add=function(a){this.aNodes[this.aNodes.length]=new Node(a.id,a.pid,a.name,a.url,a.title,a.target,a.icon,a.iconOpen,a.open,a.checked,a.nodeData);if(a.checked){this.checkednodes[this.checkednodes.length]=new Node(a.id,a.pid,a.name,a.url,a.title,a.target,a.icon,a.iconOpen,a.open,a.checked,a.nodeData)}};dTree.prototype.openAll=function(){this.oAll(true)};dTree.prototype.closeAll=function(){this.oAll(false)};dTree.prototype.toString=function(){var a='<div class="dtree">\n';if(document.getElementById){if(this.config.useCookies){this.selectedNode=this.getSelected()}a+=this.addNode(this.root)}else{a+="Browser not supported."}a+="</div>";if(!this.selectedFound){this.selectedNode=null}this.completed=true;return a};dTree.prototype.addNode=function(a){var b="";var d=0;if(this.config.inOrder){d=a._ai}for(d;d<this.aNodes.length;d++){if(this.aNodes[d].pid==a.id){var c=this.aNodes[d];c._p=a;c._ai=d;this.setCS(c);if(!c.target&&this.config.target){c.target=this.config.target}if(c._hc&&!c._io&&this.config.useCookies){c._io=this.isOpen(c.id)}if(!this.config.folderLinks&&c._hc){c.url=null}if(this.config.useSelection&&c.id==this.selectedNode&&!this.selectedFound){c._is=true;this.selectedNode=d;this.selectedFound=true}b+=this.node(c,d);if(c._ls){break}}}return b};dTree.prototype.co=function(b){if(this.cbCollection[b]){return this.cbCollection[b]}for(var a=0;a<this.aNodes.length;a++){if(this.aNodes[a].id==b){this.cbCollection[b]=document.getElementById("c"+this.obj+a);break}}return this.cbCollection[b]};dTree.prototype.getCheckedNodes=function(){var b=new Array();var a;for(var c=0;c<this.aNodes.length;c++){a=this.co(this.aNodes[c].id);if(a!=null){if(a.checked==true){b[b.length]=this.aNodes[c]}}}return b};dTree.prototype.cc=function(l){var p=document.getElementById("c"+this.obj+l).checked;var b,d=this.aNodes[l];var m=this.aNodes.length;for(b=0;b<m;b++){if(this.aNodes[b].pid==d.id){document.getElementById("c"+this.obj+b).checked=p;var u=document.getElementById("lc"+this.obj+b).getAttribute("class");if(p){document.getElementById("lc"+this.obj+b).setAttribute("class","check-label yt-checkbox check");document.getElementById("c"+this.obj+b).checked=true}else{document.getElementById("lc"+this.obj+b).setAttribute("class","check-label yt-checkbox");document.getElementById("c"+this.obj+b).checked=false}this.cc(b)}}var t=0;var v=0;if(p==true){var i=d.pid,b=0,s=0,a=0;var h,q=false;do{h=false;for(b=0;b<m;b++){if(this.aNodes[b].id==i){document.getElementById("c"+this.obj+b).checked=true;var u=document.getElementById("lc"+this.obj+b).getAttribute("class");document.getElementById("lc"+this.obj+b).setAttribute("class","check-label yt-checkbox check");for(s=0;s<m;s++){if(this.aNodes[s].pid==i){v+=1;var r=$(document.getElementById("lc"+this.obj+this.aNodes[s]._ai));var g=document.getElementById("c"+this.obj+this.aNodes[s]._ai).checked;if(g){t+=1}}}if(t<v){document.getElementById("lc"+this.obj+b).setAttribute("class","check-label yt-checkbox yt-checkbox-half");document.getElementById("c"+this.obj+b).checked=true}else{document.getElementById("lc"+this.obj+b).setAttribute("class","check-label yt-checkbox check");document.getElementById("c"+this.obj+b).checked=true}i=this.aNodes[b].pid;h=true;break}}}while(h==true)}if(p==false){var i=d.pid,f=0,e=0,s=0,q=false;do{for(f=0;f<m;f++){if(this.aNodes[f].pid==i&&document.getElementById("c"+this.obj+f).checked==true){q=false}}if(f==m){for(e=0;e<m;e++){if(this.aNodes[e].id==i){document.getElementById("lc"+this.obj+e).setAttribute("class","check-label yt-checkbox");document.getElementById("c"+this.obj+e).checked=false;for(s=0;s<m;s++){if(this.aNodes[s].pid==i){v+=1;var r=$(document.getElementById("lc"+this.obj+this.aNodes[s]._ai));var g=document.getElementById("c"+this.obj+this.aNodes[s]._ai).checked;if(g){t+=1}}}if(t>0){document.getElementById("lc"+this.obj+e).setAttribute("class","check-label yt-checkbox yt-checkbox-half");document.getElementById("c"+this.obj+e).checked=true}else{if(v==t){document.getElementById("lc"+this.obj+e).setAttribute("class","check-label yt-checkbox check");document.getElementById("c"+this.obj+e).checked=true}else{document.getElementById("lc"+this.obj+e).setAttribute("class","check-label yt-checkbox");document.getElementById("c"+this.obj+e).checked=false}}i=this.aNodes[e].pid;break}}}}while(i!=-1)}};dTree.prototype.setcc=function(d){document.getElementById("c"+this.obj+d).checked=true;document.getElementById("lc"+this.obj+d).setAttribute("class","check-label yt-checkbox check");var b=true;var e,c=this.aNodes[d];var a=this.aNodes.length;for(e=0;e<a;e++){if(this.aNodes[e].pid==c.id){document.getElementById("c"+this.obj+e).checked=b;document.getElementById("lc"+this.obj+e).setAttribute("class","check-label yt-checkbox check");this.setcc(e)}}};dTree.prototype.getNodes=function(e){var c=[];var f,d=this.aNodes[e],b=d.pid;var a=this.aNodes.length;for(j=0;j<a;j++){if(this.aNodes[j].pid==b){c.push(this.aNodes[j])}}return c};dTree.prototype.node=function(a,c){var b='<div class="dTreeNode">'+this.indent(a,c);if(this.config.check==true){b+='<label class="check-label yt-checkbox" id="lc'+this.obj+c+'"><input type="checkbox" class="cx" id="c'+this.obj+c+'" onclick="javascript:'+this.obj+".cc("+c+')"/><a>'+a.name+"</a></label>"}if(this.config.useIcons){if(!a.icon){a.icon=(this.root.id==a.pid)?this.icon.root:((a._hc)?this.icon.folder:this.icon.node)}if(!a.iconOpen){a.iconOpen=(a._hc)?this.icon.folderOpen:this.icon.node}if(this.root.id==a.pid){a.icon=this.icon.root;a.iconOpen=this.icon.root}if(((a._io)?a.iconOpen:a.icon)!=""){b+='<img id="i'+this.obj+c+'" src="'+((a._io)?a.iconOpen:a.icon)+'" alt="" />'}}if(!this.config.check){if(a.url){b+='<a id="s'+this.obj+c+'" class="'+((this.config.useSelection)?((a._is?"nodeSel":"node")):"node")+'" href="'+a.url+'"';if(a.title){b+=' title="'+a.title+'"'}if(a.target){b+=' target="'+a.target+'"'}if(this.config.useStatusText){b+=" onmouseover=\"window.status='"+a.name+"';return true;\" onmouseout=\"window.status='';return true;\" "}if(this.config.useSelection&&((a._hc&&this.config.folderLinks)||!a._hc)){b+=' onclick="javascript: '+this.obj+".s("+c+');"'}b+=">"}else{if((!this.config.folderLinks||!a.url)&&a._hc&&a.pid!=this.root.id){b+='<a href="javascript: '+this.obj+".o("+c+');" class="node">'}}b+=a.name;if(a.url||((!this.config.folderLinks||!a.url)&&a._hc)){b+="</a>"}}b+="</div>";if(a._hc){b+='<div id="d'+this.obj+c+'" class="clip" style="display:'+((this.root.id==a.pid||a._io)?"block":"none")+';">';b+=this.addNode(a);b+="</div>"}this.aIndent.pop();return b};dTree.prototype.indent=function(a,c){var b="";if(this.root.id!=a.pid){for(var d=0;d<this.aIndent.length;d++){b+='<img src="'+((this.aIndent[d]==1&&this.config.useLines)?this.icon.line:this.icon.empty)+'" alt="" />'}(a._ls)?this.aIndent.push(0):this.aIndent.push(1);if(a._hc){b+='<a href="javascript: '+this.obj+".o("+c+');"><img id="j'+this.obj+c+'" src="';if(!this.config.useLines){b+=(a._io)?this.icon.nlMinus:this.icon.nlPlus}else{b+=((a._io)?((a._ls&&this.config.useLines)?this.icon.minusBottom:this.icon.minus):((a._ls&&this.config.useLines)?this.icon.plusBottom:this.icon.plus))}b+='" alt="" /></a>'}else{b+='<img src="'+((this.config.useLines)?((a._ls)?this.icon.joinBottom:this.icon.join):this.icon.empty)+'" alt="" />'}}else{for(var d=0;d<this.aIndent.length;d++){b+='<img src="'+((this.aIndent[d]==1&&this.config.useLines)?this.icon.line:this.icon.empty)+'" alt="" />'}(a._ls)?this.aIndent.push(0):this.aIndent.push(1);if(true){b+='<a href="javascript: '+this.obj+".o("+c+');"><img id="j'+this.obj+c+'" src="';if(!this.config.useLines){b+=(true)?this.icon.nlMinus:this.icon.nlPlus}else{b+=((true)?((a._ls&&this.config.useLines)?this.icon.minusBottom:this.icon.minus):((a._ls&&this.config.useLines)?this.icon.plusBottom:this.icon.plus))}b+='" alt="" /></a>'}else{b+='<img src="'+((this.config.useLines)?((a._ls)?this.icon.joinBottom:this.icon.join):this.icon.empty)+'" alt="" />'}}return b};dTree.prototype.setCS=function(a){var b;for(var c=0;c<this.aNodes.length;c++){if(this.aNodes[c].pid==a.id){a._hc=true}if(this.aNodes[c].pid==a.pid){b=this.aNodes[c].id}}if(b==a.id){a._ls=true}};dTree.prototype.getSelected=function(){var a=this.getCookie("cs"+this.obj);return(a)?a:null};dTree.prototype.s=function(b){if(!this.config.useSelection){return}var a=this.aNodes[b];if(a._hc&&!this.config.folderLinks){return}if(this.selectedNode!=b){if(this.selectedNode||this.selectedNode==0){eOld=document.getElementById("s"+this.obj+this.selectedNode);eOld.className="node"}eNew=document.getElementById("s"+this.obj+b);eNew.className="nodeSel";this.selectedNode=b;if(this.config.useCookies){this.setCookie("cs"+this.obj,a.id)}}};dTree.prototype.o=function(b){var a=this.aNodes[b];this.nodeStatus(!a._io,b,a._ls);a._io=!a._io;if(this.config.closeSameLevel){this.closeLevel(a)}if(this.config.useCookies){this.updateCookie()}};dTree.prototype.oAll=function(a){for(var b=0;b<this.aNodes.length;b++){if(this.aNodes[b]._hc&&this.aNodes[b].pid!=this.root.id){this.nodeStatus(a,b,this.aNodes[b]._ls);this.aNodes[b]._io=a}}if(this.config.useCookies){this.updateCookie()}};dTree.prototype.openTo=function(b,c,a){if(!a){for(var e=0;e<this.aNodes.length;e++){if(this.aNodes[e].id==b){b=e;break}}}var d=this.aNodes[b];if(d.pid==this.root.id||!d._p){return}d._io=true;d._is=c;if(this.completed&&d._hc){this.nodeStatus(true,d._ai,d._ls)}if(this.completed&&c){this.s(d._ai)}else{if(c){this._sn=d._ai}}this.openTo(d._p._ai,false,true)};dTree.prototype.closeLevel=function(a){for(var b=0;b<this.aNodes.length;b++){if(this.aNodes[b].pid==a.pid&&this.aNodes[b].id!=a.id&&this.aNodes[b]._hc){this.nodeStatus(false,b,this.aNodes[b]._ls);this.aNodes[b]._io=false;this.closeAllChildren(this.aNodes[b])}}};dTree.prototype.closeAllChildren=function(a){for(var b=0;b<this.aNodes.length;b++){if(this.aNodes[b].pid==a.id&&this.aNodes[b]._hc){if(this.aNodes[b]._io){this.nodeStatus(false,b,this.aNodes[b]._ls)}this.aNodes[b]._io=false;this.closeAllChildren(this.aNodes[b])}}};dTree.prototype.nodeStatus=function(b,c,a){eDiv=document.getElementById("d"+this.obj+c);eJoin=document.getElementById("j"+this.obj+c);if(this.config.useIcons){eIcon=document.getElementById("i"+this.obj+c);eIcon.src=(b)?this.aNodes[c].iconOpen:this.aNodes[c].icon}eJoin.src=(this.config.useLines)?((b)?((a)?this.icon.minusBottom:this.icon.minus):((a)?this.icon.plusBottom:this.icon.plus)):((b)?this.icon.nlMinus:this.icon.nlPlus);eDiv.style.display=(b)?"block":"none"};dTree.prototype.clearCookie=function(){var b=new Date();var a=new Date(b.getTime()-1000*60*60*24);this.setCookie("co"+this.obj,"cookieValue",a);this.setCookie("cs"+this.obj,"cookieValue",a)};dTree.prototype.setCookie=function(d,e,b,c,a,f){document.cookie=escape(d)+"="+escape(e)+(b?"; expires="+b.toGMTString():"")+(c?"; path="+c:"")+(a?"; domain="+a:"")+(f?"; secure":"")};dTree.prototype.getCookie=function(d){var e="";var a=document.cookie.indexOf(escape(d)+"=");if(a!=-1){var c=a+(escape(d)+"=").length;var b=document.cookie.indexOf(";",c);if(b!=-1){e=unescape(document.cookie.substring(c,b))}else{e=unescape(document.cookie.substring(c))}}return(e)};dTree.prototype.updateCookie=function(){var a="";for(var b=0;b<this.aNodes.length;b++){if(this.aNodes[b]._io&&this.aNodes[b].pid!=this.root.id){if(a){a+="."}a+=this.aNodes[b].id}}this.setCookie("co"+this.obj,a)};dTree.prototype.isOpen=function(c){var b=this.getCookie("co"+this.obj).split(".");for(var a=0;a<b.length;a++){if(b[a]==c){return true}}return false};if(!Array.prototype.push){Array.prototype.push=function array_push(){for(var a=0;a<arguments.length;a++){this[this.length]=arguments[a]}return this.length}}if(!Array.prototype.pop){Array.prototype.pop=function array_pop(){lastElement=this[this.length-1];this.length=Math.max(this.length-1,0);return lastElement}}dTree.prototype.init=function(c){document.getElementById(this.objId).innerHTML=c;this.oAll(true);for(var b=0;b<this.checkednodes.length;b++){var d=this.checkednodes[b].id;var a=this.aNodes.length;for(n=0;n<a;n++){if(d==this.aNodes[n].id&&!this.aNodes[n]._hc){document.getElementById("c"+this.obj+n).checked=true;document.getElementById("lc"+this.obj+n).setAttribute("class","check-label yt-checkbox check");this.cc(n)}}}};var dtrees={};$.fn.extend({createTree:function(i){function e(k){var c=[];c.x=k.offsetLeft;for(c.y=k.offsetTop;k=k.offsetParent;){c.x+=k.offsetLeft;c.y+=k.offsetTop}return c}i=jQuery.extend({controlId:$(this).attr("id")+"Tree",dataList:[],listConfig:{id:"id",pid:"parentId",name:"deptNameing"},speed:200,readonly:true,checked:false,hide:false,isDropDown:true,callback:{onClick:function(){},onCheckClick:function(){}},rootConfig:{id:0,pid:-1,name:""}},i||{});dtrees[i.controlId]=null;var h=$(this);if(i.isDropDown){if(i.readonly){h.attr("readonly",true);h.bind("keydown",function(){if(event.keyCode==8){event.keyCode=0}})}var d="";d+='<div id="'+i.controlId+'"class="tree-div"><div></div></div>';$("body").append(d);$(h).addClass("tree-input");var b=parseInt($(h).css("padding-left"));var g=parseInt($(h).css("padding-right"));var f=$(h).width()-(b)-(b!=0?5:10);$(h).css("background-position",(f)+"px");h.bind("click",function(){if(!$(h).hasClass("open")){$(h).addClass("open");$("#"+i.controlId).show();var k=$("#"+i.controlId),c=e(h[0]),l=c.x+Number($(h).get(0).clientLeft)-1;c=c.y+Number($(h).get(0).clientTop)+Number($(h).get(0).clientHeight)-1;k.css({top:c+"px",left:l+"px"});l=$("#"+i.controlId).width();c=$("#"+i.controlId).height();k.width(0);k.height(0);k.css("display","block").animate({width:l+"px",height:c+"px"},i.speed);k.bind("selectstart",function(){return false}).bind("mousedown",function(){return false})}else{$("#"+i.controlId).hide();$(h).removeClass("open").css("background-position",(f)+"px")}});$(document).mouseup(function(c){if($(c.target).attr("id")!=h.attr("id")&&($(c.target).parentsUntil("#"+i.controlId).parent().length==0||$(c.target).parentsUntil("#"+i.controlId).parent()[0].id!=i.controlId)&&$(c.target).attr("id")!=i.controlId){$("#"+i.controlId).hide();$(h).removeClass("open").css("background-position",(f)+"px")}})}function a(){var c=i.dataList;dtrees[i.controlId]=new dTree(i.controlId,"dtrees."+i.controlId,$yt_option.websit_path+"resources/js/dTree/images/system/menu/");dtrees[i.controlId].icon.line="";dtrees[i.controlId].icon.join=$yt_option.websit_path+"resources/js/dTree/images/system/menu/empty.gif";dtrees[i.controlId].icon.joinBottom=$yt_option.websit_path+"resources/js/dTree/images/system/menu/empty.gif";dtrees[i.controlId].config.check=i.checked;if(i.checked){dtrees[i.controlId].config.useIcons=false;dtrees[i.controlId].useStatusText=true}dtrees[i.controlId].getDeptValue=function(l,m,k){if(!i.checked){i.callback.onClick(l,m,k)}if(i.hide){$("#"+i.controlId).hide();$(h).removeClass("open").css("background-position",(f)+"px")}};i.rootConfig.id=i.rootConfig.id||0;i.rootConfig.pid=-1;i.rootConfig.name=i.rootConfig.name||"";i.rootConfig.url="javascript:dtrees."+i.controlId+".getDeptValue(this,"+i.rootConfig.id+",'"+i.rootConfig.name+"')";dtrees[i.controlId].add({id:i.rootConfig.id,pid:i.rootConfig.pid,name:i.rootConfig.name,url:i.rootConfig.url,_io:true});$.each(c,function(l,k){dtrees[i.controlId].add({id:k[i.listConfig.id],pid:k[i.listConfig.pid],name:k[i.listConfig.name],checked:k[i.listConfig.checked],url:"javascript:dtrees."+i.controlId+".getDeptValue(this,"+k[i.listConfig.id]+",'"+k[i.listConfig.name]+"')"})});dtrees[i.controlId].init(dtrees[i.controlId]);$("#"+i.controlId).find(".yt-checkbox input").off("change").on("change",function(){setTimeout(function(){var k=dtrees[i.controlId].getCheckedNodes();var l=$.each(k,function(p,o){if(!!o.pid){if(o.pid==-1){k.splice(p,1);return false}}});i.callback.onCheckClick(k)},10)})}a()}});