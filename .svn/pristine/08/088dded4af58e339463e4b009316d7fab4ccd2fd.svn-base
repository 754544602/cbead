var first_menu_data='';var first_menu_data_bak='';$(function(){$yt_common.ytAclCookieKey='dynamicKey';$yt_common.getUserDataByDynamicKey();$yt_common.init();$yt_common.navFunEvent();$yt_common.heardFunEvent()});var commonFuncAuth="";var $yt_common={user_info:{},request_params:{},common_width:0,left_width:0,html_width:0,setMainWidth:function(){if($(window).width()<this.common_width){this.html_width=this.common_width}else{this.html_width=$(window).width()}var left=(this.html_width-1200)/2;if(left<0){left=0}var main_left=this.left_width+left;var main_width=this.html_width-main_left;console.log("left"+left);$(".left-nav").css("left",left);$(".main-nav").css({width:main_width,left:main_left,"min-width":main_width});$(".head-nav").css({"min-width":this.common_width})},navFunEvent:function(){$("#nav-fun-list li").mouseover(function(){var navHidVal=$(this).find(".nav-fun-hid").val();switch(navHidVal){case "index":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/index-icon2.png");break;case "address":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/address-list-icon2.png");break;case "msg":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/msg-icon2.png");break;case "set":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/set-icon2.png");break;case "out":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/logo-out-icon2.png");break;default:}$(this).addClass("nav-fun-check")});$("#nav-fun-list li").mouseout(function(){var navHidVal=$(this).find(".nav-fun-hid").val();switch(navHidVal){case "index":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/index-icon1.png");break;case "address":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/address-list-icon1.png");break;case "msg":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/msg-icon1.png");break;case "set":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/set-icon1.png");break;case "out":$(this).find(".nav-fun-icon").attr("src","./resources/images/common/logo-out-icon1.png");break;default:}$("#nav-fun-list li").removeClass("nav-fun-check")});$("#nav-fun-list li:not(.users-info-li)").off("click").click(function(){if($(".li-bak").css("display")=="none"){var left=$(this).offset().left+30;$(".li-bak").css({"left":left,"display":"inline-block"})}else{var left=$(this).offset().left+30;$(".li-bak").stop().animate({"left":left+"px"},100)}})},init:function(){$("body").append('<div id="pop-modle-alert"></div><div id="pop-modle-bg"></div>');$(window).scroll(function(){$("#yt-index-head-nav").css("left",$(window).scrollLeft()*-1);$("#frame-right-model").css("left",$(window).scrollLeft()*-1+220);$(".top-button-list").css("top",$(window).scrollTop()+80);$(".peoper-list-model").css("top",$(window).scrollTop());});$(window).resize(function(){})},eventStopPageaction:function(){var e=arguments.callee.caller.arguments[0]||event;if(e&&e.stopPropagation){e.stopPropagation()}else if(window.event){window.event.cancelBubble=true}},getToken:function(){var cookies=document.cookie.split(";");var dynamicKey="";if(cookies.length>0){for(var i=0;i<cookies.length;i+=1){var cookie=cookies[i].split("=");if($.trim(cookie[0])==$yt_common.ytAclCookieKey){dynamicKey=unescape(cookie[1])}}}return dynamicKey},getyitianSSODynamicKey:function(){var cookies=document.cookie.split(";");var dynamicKey="";if(cookies.length>0){for(var i=0;i<cookies.length;i+=1){var cookie=cookies[i].split("=");if($.trim(cookie[0])=='yitianSSODynamicKey'){dynamicKey=unescape(cookie[1])}}}return dynamicKey},clearCookie:function(){var date=new Date();date.setTime(date.getTime()-10000);var keys=document.cookie.match(/[^ =;]+(?=\=)/g);if(keys){for(var i=0;i<keys.length;i+=1){document.cookie=keys[i]+"=; expire="+date.toGMTString()+"; path=/"}}},getUserDataByDynamicKey:function(){var userInfo={};var token=$yt_common.getToken();$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsersDetails",async:true,success:function(data){console.log(data);$yt_common.user_info=data.data;$("#nav-fun-list .logo-user-name").text(data.data.userRealName);}})},getParameter:function(name){return $yt_common.request_params[name]},GetQueryString:function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)");var r=window.location.search.substr(1).match(reg);if(r!=null){return unescape(r[2])}return null},GetRequest:function(){var url=location.search;var theRequest={};if(url!=""&&url!=null){if(url.indexOf("?")!=-1){var str=url.substr(1);strs=str.split("&");for(var i=0;i<strs.length;i+=1){theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}}}return theRequest},heardFunEvent:function(){$(".home-model").off().on("click",function(){window.location.href=$yt_option.indexUrl});$(".logout-model").off().on("click",function(){var yitianSSODynamicKey=$yt_common.getyitianSSODynamicKey();$.ajax({type:"post",url:$yt_option.logoutUrl,data:{indexUrl:$yt_option.websit_index},async:true,success:function(){$yt_common.clearCookie()},error:function(){}})})},parentAction:function(param){if(param.url&&param.funName){var dataStr=JSON.stringify(param.data);var url=param.url+'?funName='+param.funName+'&param='+dataStr;var iframes=document.getElementById('myfarme');if(iframes){document.getElementsByTagName("body")[0].removeChild(iframes)}var iframe=document.createElement("iframe");iframe.id="myfarme";iframe.style.display='none';document.getElementsByTagName("body")[0].appendChild(iframe);document.getElementById('myfarme').src=url}},getTreeData:function(data,parentId){var me=this;var result=[],temp;for(var i in data){if(data[i].parentId==parentId){result.push(data[i]);temp=me.getTreeData(data,data[i].pkId);if(temp.length>0){data[i].children=temp}}}return result}};var $left_menu={menuId:"",twoMenuId:"",init:function(){var me=this;var contentType="application/x-www-form-urlencoded; charset=utf-8";if(window.XDomainRequest){contentType="text/plain"}var systemId=$("#yt-index-head-sys select").val();var paramObj=$yt_common.GetRequest();$.ajax({type:"get",url:$yt_option.menu_path,async:true,success:function(data){var sysMenu='';$("#nav-resource").empty().append('<ul id="system-menu"></ul>');$.each(data.data.children,function(i,n){if(n.type=="system"){sysMenu=$('<li class="system-menu-li"><div class="menu-fun-element"></div><div class="system-menu menu-element"><div class="system-menu-img-model"><img src="'+(n.logoUrl==undefined?"":n.logoUrl)+'"></div><div class="system-menu-name" title="'+n.menuName+'">'+n.menuName+'</div></div></li>');sysMenu.find(".menu-element").data("menuData",n);if(n.leaf=="false"){me.getMenuData(n.children,sysMenu)}$("#system-menu").append(sysMenu)}});$(".menu-element").click(function(){var menuInfo=$(this).data("menuData");if(menuInfo.leaf=="true"){$(this).parent().siblings().removeClass("child-check");$(".child-check").removeClass("child-check");$(this).parent().addClass("child-check");$left_menu.switchTab(menuInfo.parentId,menuInfo.menuUrl,menuInfo.pkId,menuInfo.openType,menuInfo.implateType,menuInfo.systemId)}else{$(this).parent().siblings().removeClass("system-men-check");$(this).parent().toggleClass("system-men-check")}});if(paramObj.pageUrl!=""&&paramObj.pageUrl!=null&&paramObj.pageUrl!=undefined){var goPageUrl=paramObj.goPageUrl;var menuEle=$('[menuurl="'+goPageUrl+'"]');var menuInfo=menuEle.data("menuData");menuEle.parent().siblings().removeClass("child-check");menuEle.parent().addClass("child-check");console.log(menuInfo);$left_menu.switchTab(menuInfo.parentId,decodeURIComponent(paramObj.pageUrl),menuInfo.pkId,1,menuInfo.implateType,menuInfo.systemId);$('.menu'+menuInfo.id).addClass("child-check").parents(".one-menu,.system-menu-li").addClass("system-men-check")}else{$yt_baseElement.showLoading();$("#frame-right-model").addClass("iframe-flow").html('<iframe src="'+$yt_option.websit_index_base+'" name="right" id="rightMain" src="" frameborder="no" scrolling="auto" width="100%" height="100%" allowtransparency="true" style="display: block;"></iframe>')}},error:function(data){console.log('菜单获取失败')}})},getMenuData:function(menuData,sysMenu){var me=this;var className='';var menuUl=$('<ul class="menu-list""></ul>');var menuNameClass='';var paramObj=$yt_common.GetRequest();$.each(menuData,function(i,n){menuNameClass='one-menu-text menu-element';className='one-menu no-border';if(n.leaf=="true"){className='two-menu leaf-menu menu'+n.id;menuNameClass='menu-element';if(first_menu_data==""){if(paramObj.defaultSysCode==undefined||paramObj.defaultSysCode==''){first_menu_data=n}else if(n.systemCode==paramObj.defaultSysCode){first_menu_data=n}}if(first_menu_data_bak==""){first_menu_data_bak=n}}var childMenu=$('<li class="'+className+'"><div class="menu-fun-element"></div><div class="'+menuNameClass+'"  menuUrl="'+n.menuUrl+'">'+n.menuName+'</div></li>');childMenu.find(".menu-element").data("menuData",n);if(n.leaf=="false"){me.getMenuData(n.children,childMenu)}menuUl.append(childMenu)});sysMenu.append(menuUl)},switchTab:function(menuId,url,twoMenuId,openType,implateType,systemId){$yt_baseElement.showLoading();$left_menu.menuId=menuId;$left_menu.twoMenuId=twoMenuId;$yt_baseElement.hideLoading();if(url.indexOf("?")>-1){url=url+"&menuId="+menuId+"&systemId="+systemId}else{url=url+"?menuId="+menuId+"&systemId="+systemId}if(openType=="2"){window.open(url);return false}else if(implateType=="2"){$("#frame-right-model").addClass("iframe-flow").html('<iframe src="'+url+'" name="right" id="rightMain" src="" frameborder="no" scrolling="auto" width="100%" height="100%" allowtransparency="true" style="display: block;"></iframe>');return false}if(url.indexOf("http://")!=0){url=$yt_option.websit_path+url}$yt_common.request_params={};if(url.indexOf("?")!=-1){var str=url.substr(url.indexOf("?")+1);strs=str.split("&");for(var i=0;i<strs.length;i+=1){$yt_common.request_params[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}}else{$yt_common.request_params={}}$("#frame-right-model").html("");$.ajax({type:"get",url:url,async:false,success:function(data){data=data.replace(/YTVERSIONCODE/g,'versionCode='+$yt_option.version_code);$("#frame-right-model").removeClass("iframe-flow").html('<div id="yt-index-main-nav" style="">'+data+'</div>');$(window).scrollTop(0)}});var divMinHei=$(window).height();$(".web-criterion-model").css("min-height",divMinHei);$left_menu.accessControlFun(systemId,menuId)},accessControlFun:function(systemId,menuId){var getParmaObj=$yt_common.GetRequest();if(systemId==undefined){systemId=getParmaObj.systemId}if(menuId==undefined){menuId=getParmaObj.menuId}$.ajax({type:"post",url:$yt_option.base_path+'api/index/getFuncListByMenuId',async:false,data:{"dynamicKey":$yt_common.user_info.dynamicKey,"systemId":systemId,"menuId":menuId},success:function(data){var resultData=",";$.each(data.data,function(i,n){resultData+=n.funcCode+','});commonFuncAuth=resultData;$left_menu.removeAuth()}})},locationToMenu:function(param){if(window!=top){window.parent.$left_menu.locationToMenu(param)}else{var url=JSON.parse(param).url;var menuEle=$('[menuurl="'+url+'"]');var menuInfo=menuEle.data("menuData");menuEle.parent().siblings().removeClass("child-check");menuEle.parent().addClass("child-check");$left_menu.switchTab(menuInfo.parentId,menuInfo.menuUrl+"?"+$.param(JSON.parse(param)),menuInfo.pkId,menuInfo.openType,menuInfo.implateType,menuInfo.systemId);$(menuEle).addClass("child-check").parents(".one-menu,.system-menu-li").addClass("system-men-check")}},removeAuth:function(){$("[acl-code]").each(function(i,n){var acl_code=","+$(n).attr("acl-code")+",";if(commonFuncAuth.indexOf(acl_code)==-1){$(n).remove()}})}};