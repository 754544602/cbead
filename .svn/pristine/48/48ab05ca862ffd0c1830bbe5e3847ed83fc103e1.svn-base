/**
 *
 *
 * C(05)分页方法
 *
 *
 * */
;(function($){$.fn.extend({"pageInfo":function(options){var defaults={pageIndex:1,pageNum:15,pageSize:5,pageDoc:this,url:'',type:"post",async:false,data:{},objName:'',success:function(data){},isSelPageNum:false,selPageNumList:[]};var pageObj=$.extend(defaults,options);this.pageInfo=pageInfo;this.pageInfo.config(pageObj,this);return this}});var pageInfo={pageNumList:[{"pageNum":"15条/页","num":15},{"pageNum":"30条/页","num":30},{"pageNum":"50条/页","num":50},{"pageNum":"100条/页","num":100},{"pageNum":"200条/页","num":200},{"pageNum":"500条/页","num":500}],pageSize:10,pageNum:15,total:0,pageDoc:null,init:function(pageIndex,pageDoc,total,pageSize,pageNum,isSelPageNum,selPageNumList,pageObj){var me=this;pageDoc.find(".last-page.pointer").unbind().bind("click",function(){var pageIndex=pageDoc.find(".num-text.active").text();pageIndex=parseInt(pageIndex)-1;me.setPage(pageIndex,pageDoc,total,pageSize,pageNum,isSelPageNum,selPageNumList,pageObj);me.bindTrClick();});pageDoc.find(".next-page.pointer").unbind().bind("click",function(){var pageIndex=pageDoc.find(".num-text.active").text();pageIndex=parseInt(pageIndex)+1;me.setPage(pageIndex,pageDoc,total,pageSize,pageNum,isSelPageNum,selPageNumList,pageObj);me.bindTrClick()});pageDoc.find(".num-text").unbind().bind("click",function(){var pageIndex=$(this).text();me.setPage(pageIndex,pageDoc,total,pageSize,pageNum,isSelPageNum,selPageNumList,pageObj);me.bindTrClick()});pageDoc.find(".frist-page.pointer").unbind().bind("click",function(){me.setPage(1,pageDoc,total,pageSize,pageNum,isSelPageNum,selPageNumList,pageObj);me.bindTrClick()});pageDoc.find(".end-page.pointer").unbind().bind("click",function(){var pageCount=Math.ceil(total/pageNum);me.setPage(pageCount,pageDoc,total,pageSize,pageNum,isSelPageNum,selPageNumList,pageObj);me.bindTrClick()});me.bindTrClick();pageDoc.find("select.page-num-list-sel").unbind().bind("change",function(){me.setPage(1,pageDoc,total,pageSize,$(this).val(),isSelPageNum,selPageNumList,pageObj);me.bindTrClick()})},bindTrClick:function(){$(".yt-table .yt-tbody tr").on("click",function(){$(".yt-table .yt-tbody tr.yt-table-active").removeClass("yt-table-active");$(this).addClass("yt-table-active")})},config:function(pageObj,$this){if(!pageObj.pageIndex){pageObj.pageIndex=1}if(pageObj.pageNum){this.pageNum=pageObj.pageNum}else{this.pageNum=15}if(pageObj.pageSize){this.pageSize=pageObj.pageSize}else{this.pageSize=10}if(pageObj.pageDoc){this.pageDoc=$(pageObj.pageDoc).html('<table><tr></tr></table>')}else{this.pageDoc=$(".opinion-page").html('<table><tr></tr></table>')}if(pageObj.async==undefined){pageObj.async=true}$this.pageObj=pageObj;this.setPage(pageObj.pageIndex,this.pageDoc,this.total,this.pageSize,this.pageNum,pageObj.isSelPageNum,pageObj.selPageNumList,$this.pageObj)},setPage:function(pageIndex,pageDoc,total,pageSize,pageNum,isSelPageNum,selPageNumList,pageObj){var _this=this;var newData={};newData=pageObj.data;newData.pageIndex=parseInt(pageIndex);newData.pageNum=parseInt(pageNum);console.log(newData);$.ajax({type:pageObj.type||"post",url:pageObj.url,async:pageObj.async,data:newData,success:function(data){if((typeof data=='string')&&data.constructor==String){data=eval('('+data+')')}pageObj.success(data);if(pageObj.objName){total=data[pageObj.objName].total}else{total=data.data.total}pageIndex=parseInt(pageIndex);var pageCount=Math.ceil(total/pageNum);pageDoc.find("table tr td:not(.page-num-select)").remove();var countHtml='<td><div class="data-count">共'+total+'条记录，</div></td><td><div class="data-count page-index">'+pageIndex+'/'+pageCount+'，</div></td>';pageDoc.find("table tr").append(countHtml);var lastButton='<td><div class="last-page"><</div></td>';var lastButtonActive='<td><div class="last-page change-btn pointer"><</div></td>';var nextButton='<td><div class="next-page">></div></td>';var nextButtonActive='<td><div class="next-page change-btn pointer">></div></td>';var firstButton='<td><div class="frist-page">首页</div></td>';var firstButtonAction='<td><div class="frist-page pointer">首页</div></td>';var endButton='<td><div class="end-page">尾页</div></td>';var endButtonAction='<td><div class="end-page pointer">尾页</div></td>';if(pageCount<=pageSize+1){if(pageIndex>1){pageDoc.find("table tr").append(firstButtonAction);pageDoc.find("table tr").append(lastButtonActive)}else{pageDoc.find("table tr").append(firstButton);pageDoc.find("table tr").append(lastButton)}for(var int=1;int<=pageCount;int+=1){var pageHtml='<td><div class="num-text change-btn pointer">'+int+'</div></td>';if(int==pageIndex){var pageHtml='<td><div class="num-text change-btn active">'+int+'</div></td>'}pageDoc.find("table tr").append(pageHtml)}if(pageIndex<pageCount){pageDoc.find("table tr").append(nextButtonActive);pageDoc.find("table tr").append(endButtonAction)}else{pageDoc.find("table tr").append(nextButton);pageDoc.find("table tr").append(endButton)}}else if(pageCount>pageSize+1&&pageIndex<=pageSize-1){if(pageIndex>1){pageDoc.find("table tr").append(firstButtonAction);pageDoc.find("table tr").append(lastButtonActive)}else{pageDoc.find("table tr").append(firstButton);}for(var int=1;int<=pageSize;int+=1){var pageHtml='<td><div class="num-text change-btn pointer">'+int+'</div></td>';if(int==pageIndex){var pageHtml='<td><div class="num-text change-btn active">'+int+'</div></td>'}pageDoc.find("table tr").append(pageHtml)}var pageHtml='<td><div class="">···</div></td>';pageDoc.find("table tr").append(pageHtml);pageDoc.find("table tr").append(nextButtonActive);pageDoc.find("table tr").append(endButtonAction)}else if(pageCount>pageSize+1&&pageIndex>=pageCount-pageSize+2){pageDoc.find("table tr").append(firstButtonAction);pageDoc.find("table tr").append(lastButtonActive);var pageHtml='<td><div class="">···</div></td>';pageDoc.find("table tr").append(pageHtml);for(var int=pageCount-pageSize+1;int<=pageCount;int+=1){var pageHtml='<td><div class="num-text change-btn pointer">'+int+'</div></td>';if(int==pageIndex){var pageHtml='<td><div class="num-text change-btn active">'+int+'</div></td>'}pageDoc.find("table tr").append(pageHtml)}if(pageIndex<pageCount){pageDoc.find("table tr").append(nextButtonActive);pageDoc.find("table tr").append(endButtonAction)}else{pageDoc.find("table tr").append(endButton)}}else{pageDoc.find("table tr").append(firstButtonAction);pageDoc.find("table tr").append(lastButtonActive);var pageHtml='<td><div class="">···</div></td>';pageDoc.find("table tr").append(pageHtml);var pageSizeNum=pageSize%2==0?pageSize/2:Math.ceil(pageSize/2)-1;for(var int=pageIndex-pageSizeNum;int<=pageIndex+pageSizeNum;int+=1){var pageHtml='<td><div class="num-text change-btn pointer">'+int+'</div></td>';if(int==pageIndex){var pageHtml='<td><div class="num-text change-btn active">'+int+'</div></td>'}pageDoc.find("table tr").append(pageHtml)}var pageHtml='<td><div class="">···</div></td>';pageDoc.find("table tr").append(pageHtml);pageDoc.find("table tr").append(nextButtonActive);pageDoc.find("table tr").append(endButtonAction)}if(isSelPageNum&&pageDoc.find("table tr").find("select.page-num-list-sel").length==0){var selPageListStr='<td class="page-num-select" style="padding:0px 5px;"><select class="yt-select page-num-list-sel" style="width:90px;"></select></td>';var pageSelNumList="";pageDoc.find("table tr").append(selPageListStr);if(selPageNumList!=undefined&&selPageNumList!=""){pageSelNumList=selPageNumList}else{pageSelNumList=pageInfo.pageNumList}if(pageSelNumList.length>0&&pageSelNumList!=""){pageDoc.find("table tr").find("select.page-num-list-sel").replaceWith('<select class="yt-select page-num-list-sel" style="width:90px;"></select>');$.each(pageSelNumList,function(i,n){pageDoc.find("table tr").find("select.page-num-list-sel").append('<option value="'+n.num+'">'+n.pageNum+'</option>')})}pageDoc.find("table tr").find("select.page-num-list-sel").niceSelect()}else{var ted=pageDoc.find("table tr").find("select.page-num-list-sel").parent();pageDoc.find("table tr").append(ted)}_this.init(pageIndex,pageDoc,total,pageSize,pageNum,isSelPageNum,selPageNumList,pageObj)}})}}})(jQuery);