var teachingStaffList={init:function(){$('select').niceSelect();$(".check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".teaching-staf-table tbody,.teaching-staff-tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}});$(".teaching-staff-add-list").click(function(){$(".teaching-staffList-div").show();$yt_alert_Model.getDivPosition($(".teaching-staffList-div"));$yt_model_drag.modelDragEvent($(".teaching-staffList-div .yt-edit-alert-title"));teachingStaffList.getPosition();teachingStaffList.getDepts();$('input.user-name').val("");$('select.user-gender').setSelectVal("3");$('select.position-code').setSelectVal("0");$(".tree-text-div").empty();$("input.user-email").val("");$("input.user-phone").val("");$("span.valid-font").text("");$("select").niceSelect();$('.teaching-staffList-canel-btn').click(function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$('.teaching-staffList-sure-btn').off().on("click",function(){teachingStaffList.verification("")})});$('select.user-gender').change(function(){var gender=$('select.user-gender').val();if(gender!=""){$('div.user-gender').removeClass('valid-hint');$('div.user-gender').parent().find('.valid-font').text('')}});$('select.position-code').change(function(){var positionCode=$('.position-code').val();if(positionCode!=""){$('div.position-code').removeClass('valid-hint');$('div.position-code').next().text('')}});$(".teaching-staff-update-list").click(function(){var num=$('.teaching-staff-tbody').find('label input[type="checkbox"]:checked').length;if(num>1||num==0){$yt_alert_Model.prompt("请选中一行数据进行操作")}else{$(".teaching-staffList-div").show();$yt_alert_Model.getDivPosition($(".teaching-staffList-div"));$yt_model_drag.modelDragEvent($(".teaching-staffList-div .yt-edit-alert-title"));teachingStaffList.getPosition();teachingStaffList.getDepts();$('.teaching-staff-tbody').find('label input[type="checkbox"]:checked').parents("td").each(function(){var userName=$(this).parents("tr").find('td.user-name').text();var userGender=$(this).parents("tr").find('td.user-gender').text();var positionCode=$(this).parents("tr").find('input.position-code').val();var deptName=$(this).parents("tr").find('td.position-deptName').text();var deptId=$(this).parents("tr").find('.dept-id').val();var userEmail=$(this).parents("tr").find('td.user-email').text();var userPhone=$(this).parents("tr").find('td.user-phone').text();$('input.user-name').val(userName);if(userGender=="男"){$('select.user-gender').setSelectVal("1")}else if(userGender=="女"){$('select.user-gender').setSelectVal("0")}$('select.position-code').setSelectVal(positionCode);$(".tree-text-div").empty();$(".tree-text-div").append('<span types="'+deptId+'">'+deptName+'</span>');$("input.user-email").val(userEmail);$("input.user-phone").val(userPhone);$("select").niceSelect()});$('.teaching-staffList-sure-btn').off().on("click",function(){var pkId=$('.teaching-staff-tbody').find('label input[type="checkbox"]:checked').val();teachingStaffList.verification(pkId)})};$('.teaching-staffList-canel-btn').click(function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})});$(".teaching-staff-delete-list").click(function(){var num=$('.teaching-staff-tbody').find('label input[type="checkbox"]:checked').length;if(num==0){$yt_alert_Model.prompt("请选中数据进行操作")}else{var pkIds="";$('.teaching-staff-tbody').find('label input[type="checkbox"]:checked').each(function(){if(pkIds==""){pkIds=$(this).val()}else{pkIds+=","+$(this).val()}});teachingStaffList.deleteteachingStaff(pkIds)}});$(".search-btn").click(function(){teachingStaffList.getteachingStaffListInf()});teachingStaffList.getteachingStaffListInf();teachingStaffList.getDepts();teachingStaffList.getAllDept();$(".tree-text-div").click(function(){$(this).parent().find('.prepare-tt').show()});$(".prepare-tt").mouseleave(function(){$(this).hide()})},getAllDept:function(){var divText;var dataObj=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsers",data:{compId:""},async:false,success:function(data){if(data.flag==0){$.each(data.data,function(i,v){if(v.type!=3){dataObj.push(v)}})}}});dataObj=this.getTreeData(dataObj,0);$('.prepare-tt').tree({data:dataObj,checkbox:true,onlyLeafCheck:true,lines:true,fit:true,onSelect:function(node){if(node.type==2){$(node.target).parents(".prepare-tt").parent().parent().find(".tree-text-div").empty();$(node.target).parents(".prepare-tt").parent().parent().find(".tree-text-div").append('<span types="'+node.id+'">'+node.text+'</span>')}},onLoadSuccess:function(node,data){$("span.tree-checkbox").hide()}})},getTreeData:function(data,parentId){var me=this;var result=[],temp;for(var i in data){if(data[i].parentId==parentId){result.push(data[i]);temp=me.getTreeData(data,data[i].id);if(temp.length>0){data[i].children=temp}}}return result},getteachingStaffListInf:function(){var selectParam=$(".selectParam").val();$('.teaching-staff-page').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"administrator/teachingStaff/lookForAll",type:"post",data:{selectParam:selectParam,userGender:"",positionCode:"",deptId:""},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.teaching-staff-tbody');var htmlTr='';if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){htmlTr+='<tr><td><label class="check-label yt-checkbox teaching-staf-checkbox"><input type="checkbox" name="test" class="pkId" value="'+v.pkId+'"/></label></td><td>'+(i+1)+'</a></td><td class="user-name">'+v.userName+'</td><td class="user-gender">'+(teachingStaffList.getUserGender(v.userGender))+'</a></td><td class="position-name"><input type="hidden" value="'+v.positionCode+'" class="position-code">'+v.positionName+'</td><td class="position-deptName"><input type="hidden" value="'+v.deptId+'" class="dept-id">'+v.deptName+'</td><td style="text-align:left;" class="user-email">'+v.userEmail+'</td><td class="user-phone">'+v.userPhone+'</td></tr>'})}else{htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="8" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},verification:function(pkId){if($yt_valid.validForm($(".valid-tab"))){teachingStaffList.addteachingStaff(pkId)}},addteachingStaff:function(pkId){var userName=$('input.user-name').val();var userGender=$('select.user-gender').val();var positionCode=$('select.position-code').val();var deptId=$(".tree-text-div").children().attr('types');var userEmail=$("input.user-email").val();var userPhone=$("input.user-phone").val();$.ajax({type:"post",url:$yt_option.base_path+"administrator/teachingStaff/addOrUpdateTeachingStaff",async:false,data:{pkId:pkId,userName:userName,userGender:userGender,positionCode:positionCode,deptId:deptId,userEmail:userEmail,userPhone:userPhone},before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){if(pkId==""){$yt_alert_Model.prompt("新增成功")}else{$yt_alert_Model.prompt("修改成功")}teachingStaffList.getteachingStaffListInf();$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})}else{$yt_baseElement.hideLoading(function(){if(pkId==""){$yt_alert_Model.prompt("新增失败")}else{$yt_alert_Model.prompt("修改失败")}})}}})},deleteteachingStaff:function(pkIds){$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"administrator/teachingStaff/deleteTeachingStaff",async:false,data:{pkIds:pkIds},before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除成功");teachingStaffList.getteachingStaffListInf()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除失败")})}}})}})},getUserGender:function(userGender){if(userGender==0){return "女"}else if(userGender==1){return "男"}},getPosition:function(){var posiName="";$.ajax({async:false,url:$yt_option.base_path+"administrator/teachingStaff/getPositionList",type:"post",data:{posiName:posiName},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){if(data.data&&data.data&&data.data.length>0){$.each(data.data,function(i,v){$("select.position-code").append('<option value="'+v.posiCode+'">'+v.posiName+'</option>')});$('select.position-code').niceSelect()}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},})},getDepts:function(){var compName="";$.ajax({async:false,url:$yt_option.base_path+"uniform/dept/getDepts",type:"post",data:{compName:compName},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){if(data.data&&data.data&&data.data.length>0){$.each(data.data,function(i,v){$("select.dept-id").append('<option value="'+v.id+'">'+v.text+'</option>')});$('select.dept-id').niceSelect()}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},})}};$(function(){teachingStaffList.init()});