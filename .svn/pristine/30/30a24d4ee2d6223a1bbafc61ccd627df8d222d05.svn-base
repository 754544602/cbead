var costDetail={init:function(){costDetail.paymentTotal();costDetail.socialTotal();costDetail.showOrHide();costDetail.showPayeeDeduct();var reimAmountlSum=$("#reimAmountlSum").text();if(reimAmountlSum!=''){$("#reimAmountlSum").text($yt_baseElement.fmMoney(reimAmountlSum))}else{$("#reimAmountlSum").text('0.00')};$("#reimAmount,#specialAmount,#deductBudgetAmount").on("focus",function(){if($(this).val()!=""){$(this).val($yt_baseElement.rmoney($(this).val()))}});$("#reimAmount,#specialAmount,#deductBudgetAmount").on("blur",function(){if($(this).val()!=""){$(this).val($yt_baseElement.fmMoney($(this).val()))}});costDetail.event()},event:function(){$("#costList").on("click",".operate-update",function(){var thisObj=$(this);var reimContent=thisObj.parents('tr').find('.reimContent').text();var reimAmount=thisObj.parents('tr').find('.reimAmount').text();var reimInstructions=thisObj.parents('tr').find('.reimInstructions').text();costDetail.showAlert(thisObj);$("#reimContent").val(reimContent);$("#reimAmount").val(reimAmount);$("#instructions").val(reimInstructions==''?'':reimInstructions)});$("#costList,#specialCostList").on("click",".operate-del",function(){var thisObj=$(this);$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){thisObj.parents("tr").remove();costDetail.paymentTotal();costDetail.socialTotal()}})});$("#specialCostList").on("click",".operate-update",function(){var thisObj=$(this);var code=$('.docu-style:checked').val();if(code=='SOCIAL_SECURITY_FEE'){costDetail.showSpecialExpenditureAlert(thisObj);costDetail.titleContext();var specialCode=thisObj.parents('tr').find('.specialContent').attr('code');var specialContent=thisObj.parents('tr').find('.specialContent').text();var specialAmount=thisObj.parents('tr').find('.specialAmount').text();var specialinstructions=thisObj.parents('tr').find('.specialinstructions').text().replace(/^\s+|\s+$/g,"");var deductBudgetAmount=thisObj.parents('tr').find('.deductBudgetAmount').text();$('.special-valid-tab .cost-name option[value ="'+specialCode+'"]').attr("selected","selected");$('.special-valid-tab .cost-name').next().find(".current").text(specialContent);$("#specialAmount").val(specialAmount);$("#deductBudgetAmount").val(deductBudgetAmount);$("#specialinstructions").val(specialinstructions==''?'':specialinstructions)}else if(code=='MEDICAL_EXPENSES'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'||code=='CURRENT_ACCOUNT'){var specialContent=thisObj.parents('tr').find('.specialContent').text();var specialAmount=thisObj.parents('tr').find('.specialAmount').text();var specialinstructions=thisObj.parents('tr').find('.specialinstructions').text().replace(/^\s+|\s+$/g,"");costDetail.showSpecialExpenditureAlert(thisObj);$('.special-content-input .special-content').val(specialContent);$("#specialAmount").val(specialAmount);$("#specialinstructions").val(specialinstructions==''?'':specialinstructions)}else if(code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'){costDetail.showSpecialExpenditureAlert(thisObj);costDetail.titleContext();var specialCode=thisObj.parents('tr').find('.specialContent').attr('code');var specialContent=thisObj.parents('tr').find('.specialContent').text();var specialAmount=thisObj.parents('tr').find('.specialAmount').text();var deductBudgetAmount=thisObj.parents('tr').find('.deductBudgetAmount').text();var specialinstructions=thisObj.parents('tr').find('.specialinstructions').text();$('.special-valid-tab .cost-name option[value ="'+specialCode+'"]').attr("selected","selected");$('.special-valid-tab .cost-name').next().find(".current").text(specialContent);$("#specialAmount").val(specialAmount);$("#deductBudgetAmount").val(deductBudgetAmount);$("#specialinstructions").val(specialinstructions==''?'':specialinstructions)}});$("#specialAmount").on("blur",function(){var value=$yt_baseElement.rmoney($(this).val());if($(this).val()!=""){var code=$('.docu-style:checked').val();if(code=='ACCRUED_TAX'){if($(".special-valid-tab .cost-name option:selected").val()=='ACCRUED_TAX1'||$(".special-valid-tab .cost-name option:selected").val()=='ACCRUED_TAX5'){$("#deductBudgetAmount").val($yt_baseElement.fmMoney(value))}else{$("#deductBudgetAmount").val($yt_baseElement.fmMoney(0))}}else if(code=='SOCIAL_SECURITY_FEE'){if($(".special-valid-tab .cost-name option:selected").val()=='SOCIAL_SECURITY_FEE2'){$("#deductBudgetAmount").val($yt_baseElement.fmMoney(0))}else{$("#deductBudgetAmount").val($yt_baseElement.fmMoney($yt_baseElement.rmoney($("#specialAmount").val())/2))}}else{if(code!='SPECIAL_DEDUCTION'){$("#deductBudgetAmount").val($yt_baseElement.fmMoney(value))}}}})},showPayeeDeduct:function(){var code=$('#costTypeName').attr('val');if(code=='SOCIAL_SECURITY_FEE'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'||code=='CURRENT_ACCOUNT'){$(".deductBudgetAmountTr").hide();$("#deductBudgetAmountSum").hide();$("#doAdvanceBox").hide();$("#deductBudgetDiv").hide()}else if(code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'){$(".deductBudgetAmountTr").show();$("#deductBudgetAmountSum").show();$("#doAdvanceBox").hide();$("#deductBudgetDiv").show()}if(code=='SOCIAL_SECURITY_FEE'||code=='SPECIAL_DEDUCTION'){$("#payeeInformation").hide();}else if(code=='MEDICAL_EXPENSES'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'||code=='ACCRUED_TAX'){$("#payeeInformation").show();}if(code=='MEDICAL_EXPENSES'){$("#specialCostList .deductBudgetAmountTr,.cost-popm .deductBudgetAmountTr,#deductBudgetDiv").hide()}if(code=='CURRENT_ACCOUNT'){$("#payeeInformation").show();}if(code=='SOCIAL_SECURITY_FEE'){$(".deductBudgetAmountTr,#deductBudgetDiv").show()}},showAlert:function(thisObj){if(thisObj!=null){$(".save-btn").show();$(".sure-btn").hide()}else{$(".save-btn").hide();$(".sure-btn").show()}costDetail.clearCPMInfo();$(".yt-edit-alert,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($(".yt-edit-alert"));$(".sure-btn").off().on("click",function(){var isTrue=$yt_valid.validForm($(".valid-tab"));if(isTrue){$yt_alert_Model.prompt("填写的信息已成功加入到列表");var reimContent=$("#reimContent").val();var reimAmount=$("#reimAmount").val();var instructions=$("#instructions").val();instructions=instructions||'';var trHtml=' <tr class="yt-tab-row"> <td style="text-align:center;" class="reimContent">'+reimContent+'</td> <td style="text-align:right;" class="reimAmount">'+reimAmount+'</td> <td class="reimInstructions">'+instructions+'</td> <td class="operation"> <span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span> <span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span> </td> </tr>';$("#costList tbody .last").before(trHtml);costDetail.paymentTotal();costDetail.clearCPMInfo()}});$(".save-btn").off().on("click",function(){debugger;var isTrue=$yt_valid.validForm($(".valid-tab"));if(isTrue){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();var reimContent=$("#reimContent").val();var reimAmount=$("#reimAmount").val();var instructions=$("#instructions").val();thisObj.parents('tr').find('td').eq(0).text(reimContent);thisObj.parents('tr').find('td').eq(1).text(reimAmount);thisObj.parents('tr').find('td').eq(2).text(instructions||'');costDetail.paymentTotal();costDetail.clearCPMInfo()}});$('.yt-edit-alert .yt-eidt-model-bottom .yt-cancel-btn,.yt-edit-alert .closed-span').off().on("click",function(){costDetail.clearCPMInfo();$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},titleContext:function(){var code=$('.docu-style-box .check .docu-style').val();var flowCode="";if(code=='SOCIAL_SECURITY_FEE'){$(".yt-edit-alert-title-msg").text("公积金明细");flowCode="SZ_SBJF_APP";costDetail.getDictTypeByTypeCode(code)}else if(code=='ACCRUED_TAX'){$(".yt-edit-alert-title-msg").text("薪酬税费明细");flowCode="SZ_YJSF_APP";costDetail.getDictTypeByTypeCode(code)}else if(code=='MEDICAL_EXPENSES'){$(".yt-edit-alert-title-msg").text("医疗费明细");flowCode="SZ_YYF_APP"}else if(code=='LABOUR_UNION_FUNDS'){$(".yt-edit-alert-title-msg").text("工会明细");flowCode="SZ_GHJF_APP"}else if(code=='PARTY_BUILDING_FUNDS'){$(".yt-edit-alert-title-msg").text("党建明细");flowCode="SZ_DJJF_APP"}else if(code=='CURRENT_ACCOUNT'){$(".yt-edit-alert-title-msg").text("往来款项明细");flowCode="SZ_WLKX_APP"}else if(code=='SPECIAL_DEDUCTION'){$(".yt-edit-alert-title-msg").text("专项扣除明细");flowCode="SPECIAL_DEDUCTION";costDetail.getDictTypeByTypeCode(code)}},showOrHide:function(){var code=$('.docu-style:checked').val();if(code=='SOCIAL_SECURITY_FEE'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'||code=='CURRENT_ACCOUNT'){$(".deductBudgetAmountTr").hide();$("#deductBudgetAmountSum").hide()}else if(code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'){$(".deductBudgetAmountTr").show();$("#deductBudgetAmountSum").show()}if(code=='MEDICAL_EXPENSES'){$("#specialCostList .deductBudgetAmountTr,.cost-popm .deductBudgetAmountTr").hide()}if(code=='SOCIAL_SECURITY_FEE'){$(".deductBudgetAmountTr").show()}},showSpecialExpenditureAlert:function(thisObj){costDetail.titleContext();if(thisObj!=null){$(".save-btn").show();$(".sure-btn").hide()}else{$(".save-btn").hide();$(".sure-btn").show()}costDetail.clearSpecialCPMInfo();$(".yt-edit-alert,#heard-nav-bak").show();$yt_alert_Model.getDivPosition($(".yt-edit-alert"));$(".yt-edit-alert").css({"position":"fixed","left":"460px","top":"164px"});var code=$('.docu-style:checked').val();if(code=='MEDICAL_EXPENSES'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'||code=='CURRENT_ACCOUNT'){$(".special-content-select").hide();$(".special-content-input").show();$(".special-content-input .special-content").attr("validform","{isNull:true,blurFlag:true,msg:'请输入收款人所在单位'}");$('#deductBudgetAmount').removeAttr("validform");if($("#reimAppName").val()){$(".special-content-input .special-content").val($("#reimAppName").val())}}else if(code=='SOCIAL_SECURITY_FEE'||code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'){$(".special-content-select").show();$(".special-content-input").hide();$(".special-content-input .special-content").removeAttr("validform");$('#deductBudgetAmount').attr("validform","{isNull:true,blurFlag:true,msg:'请输入扣除预算金额'}")}$(".sure-btn").off().on("click",function(){var isTrue=$yt_valid.validForm($(".special-valid-tab"));if(isTrue){$yt_alert_Model.prompt("填写的信息已成功加入到列表");var specialContent='';var specialCode='';var code=$('.docu-style:checked').val();if(code=='MEDICAL_EXPENSES'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'||code=='CURRENT_ACCOUNT'){specialContent=$(".special-valid-tab .special-content").val()}else if(code=='SOCIAL_SECURITY_FEE'||code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'){specialContent=$(".special-valid-tab .cost-name option:selected").text();specialCode=$(".special-valid-tab .cost-name option:selected").val()}var specialAmount=$("#specialAmount").val();var deductBudgetAmount=$("#deductBudgetAmount").val();var specialinstructions=$("#specialinstructions").val();specialinstructions=specialinstructions||'';var trHtml='';var code=$('.docu-style:checked').val();if(code=='SOCIAL_SECURITY_FEE'){trHtml+='<tr class="yt-tab-row"> <td class="specialContent" code = "'+specialCode+'" >'+specialContent+'</td> <td style="text-align: right;" class="specialAmount">'+$yt_baseElement.fmMoney(specialAmount)+'</td> <td style="text-align: right;" class="deductBudgetAmount">'+$yt_baseElement.fmMoney(deductBudgetAmount||0)+'</td> <td class="specialinstructions">'+specialinstructions+'</td> <td class="operation"> <span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span> <span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span> </td> </tr>'}else if(code=='MEDICAL_EXPENSES'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'||code=='CURRENT_ACCOUNT'){trHtml+='<tr class="yt-tab-row"> <td class="specialContent" >'+specialContent+'</td> <td style="text-align: right;" class="specialAmount">'+$yt_baseElement.fmMoney(specialAmount)+'</td> <td class="specialinstructions">'+specialinstructions+'</td> <td class="operation"> <span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span> <span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span> </td> </tr>'}else if(code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'){trHtml+=' <tr class="yt-tab-row"> <td class="specialContent" code = "'+specialCode+'" >'+specialContent+'</td> <td style="text-align: right;" class="specialAmount">'+$yt_baseElement.fmMoney(specialAmount)+'</td> <td style="text-align: right;" class="deductBudgetAmount">'+$yt_baseElement.fmMoney(deductBudgetAmount)+'</td> <td class="specialinstructions">'+specialinstructions+'</td> <td class="operation"> <span class="operate-update"><img src="../../../../../resources-sasac/images/common/edit-icon.png"></span> <span class="operate-del"><img src="../../../../../resources-sasac/images/common/del-icon.png"></span> </td> </tr>'}$("#specialCostList tbody .last").before(trHtml);costDetail.socialTotal();costDetail.clearSpecialCPMInfo()}});$(".save-btn").off().on("click",function(){var isTrue=$yt_valid.validForm($(".special-valid-tab"));if(isTrue){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();var specialContent='';var specialCode='';var code=$('.docu-style:checked').val();if(code=='MEDICAL_EXPENSES'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'||code=='CURRENT_ACCOUNT'){specialContent=$(".special-valid-tab .special-content").val()}else if(code=='SOCIAL_SECURITY_FEE'||code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'){specialContent=$(".special-valid-tab .cost-name option:selected").text();specialCode=$(".special-valid-tab .cost-name option:selected").val()}var specialAmount=$("#specialAmount").val();var deductBudgetAmount=$("#deductBudgetAmount").val();var specialinstructions=$("#specialinstructions").val();var code=$('.docu-style:checked').val();if(code=='SOCIAL_SECURITY_FEE'){thisObj.parents('tr').find('td').eq(0).text(specialContent);thisObj.parents('tr').find('td').eq(0).attr("code",specialCode);thisObj.parents('tr').find('td').eq(1).text(specialAmount);thisObj.parents('tr').find('td').eq(2).text(deductBudgetAmount||"0.00");thisObj.parents('tr').find('td').eq(3).text(specialinstructions||'')}else if(code=='MEDICAL_EXPENSES'||code=='LABOUR_UNION_FUNDS'||code=='PARTY_BUILDING_FUNDS'||code=='CURRENT_ACCOUNT'){thisObj.parents('tr').find('td').eq(0).text(specialContent);thisObj.parents('tr').find('td').eq(1).text(specialAmount);thisObj.parents('tr').find('td').eq(2).text(specialinstructions||'')}else if(code=='ACCRUED_TAX'||code=='SPECIAL_DEDUCTION'){thisObj.parents('tr').find('td').eq(0).text(specialContent);thisObj.parents('tr').find('td').eq(0).attr("code",specialCode);thisObj.parents('tr').find('td').eq(1).text(specialAmount);thisObj.parents('tr').find('td').eq(2).text(deductBudgetAmount);thisObj.parents('tr').find('td').eq(3).text(specialinstructions||'')}costDetail.socialTotal();costDetail.clearSpecialCPMInfo()}});$('.yt-edit-alert .yt-eidt-model-bottom .yt-cancel-btn,.yt-edit-alert .closed-span').off().on("click",function(){costDetail.clearCPMInfo();$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},clearCPMInfo:function(){$("#specialContent").val('').removeClass("valid-hint");$("#reimContent").val('').removeClass("valid-hint");$("#reimAmount").val('').removeClass("valid-hint");$(".cost-popm .valid-font").text('');$("#instructions").val('')},clearSpecialCPMInfo:function(){$('.special-valid-tab .cost-name option[value = "1"]').attr("selected","selected");$('.special-valid-tab .cost-name').next().find(".current").text("请选择");$(".special-content").val('');$("#specialAmount").val('');$("#deductBudgetAmount").val('');$("#specialinstructions").val('')},dataAttrList:function(){var list=[];var tr=null;var trs=$('#costList tbody tr:not(.last)');;$.each(trs,function(i,n){tr=$(n);list.push({normalId:tr.find('').text(),normalName:tr.find('.reimContent').text(),normalInstructions:tr.find('.reimInstructions').text(),normalAmount:$yt_baseElement.rmoney(tr.find(".reimAmount").text())})});return list},textbtn:function(){$(".text").off().on("click",function(){costDetail.dataAttrList()})},getDictTypeByTypeCode:function(dictTypeCode){$.ajax({type:"post",url:"basicconfig/dictInfo/getDictTypeByTypeCode",async:false,data:{dictTypeCode:dictTypeCode},success:function(data){var list=data.data||[];var start='<option value="1">请选择</option>';$.each(list,function(i,n){start+='<option value="'+n.value+'">'+n.disvalue+'</option>'});$('select.cost-name').html(start).niceSelect()}})},socialTotal:function(){var tdsS=$('#specialCostList tbody .specialAmount,#specialDeduction tbody .specialAmount,#costSpending tbody .reimAmount');var tdsD=$('#specialCostList tbody .deductBudgetAmount,#specialDeduction tbody .deductBudgetAmount');var totalS=0;var totalD=0;$.each(tdsS,function(i,n){totalS+=$yt_baseElement.rmoney($(n).text())});$.each(tdsD,function(i,n){totalD+=$yt_baseElement.rmoney($(n).text())});var fmTotalS=$yt_baseElement.fmMoney(totalS);var fmTotalD=$yt_baseElement.fmMoney(totalD);$('#applyTotalMoney,.count-val-num,#specialAmountSum').text(fmTotalS);$('#deductBudgetTotalMoney,#deductBudgetAmountSum').text(fmTotalD);$('#TotalMoneyUpper,.total-money-up').text(arabiaToChinese(totalS+''))},paymentTotal:function(){var tds=$('#costList tbody .reimAmount');var total=0;$.each(tds,function(i,n){total+=$yt_baseElement.rmoney($(n).text())});var fmTotal=$yt_baseElement.fmMoney(total);$('#applyTotalMoney,.count-val-num,#amountTotalMoney').text(fmTotal);$('#TotalMoneyUpper,.total-money-up').text(arabiaToChinese(total+''));$('#costList tbody #reimAmountlSum').text(fmTotal);var loanAmount=$('#loanAmount').text();loanAmount=loanAmount=='--'?0:$yt_baseElement.rmoney(loanAmount);var outstandingBalance=$yt_baseElement.rmoney($('#outstandingBalance').text());var writeOffAmount=total>=outstandingBalance?outstandingBalance:total;$('#writeOffAmount,#outWriteAmount').text($yt_baseElement.fmMoney(writeOffAmount));var replaceMoney=total>=outstandingBalance?total-writeOffAmount:'0';$('#replaceMoney').text($yt_baseElement.fmMoney(replaceMoney));$('#balanceMoney').text($yt_baseElement.fmMoney(total<outstandingBalance?outstandingBalance-total:'0'))}};$(function(){costDetail.init();costDetail.textbtn()});