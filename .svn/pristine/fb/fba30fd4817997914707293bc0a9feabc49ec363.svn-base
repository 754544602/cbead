var executeQueryObj={init:function(){$("#executeQuery").css("min-height",$(window).height()-55+"px");executeQueryObj.getQueryParamData();if($yt_common.user_info.deptId==80||$yt_common.user_info.deptId==73){$('.unit-none-lable').show();$('.unit-none-lable').removeClass('lable-my-id')}else{$('.unit-none-lable').hide();$('.unit-none-lable').addClass('lable-my-id')}$("select").niceSelect()},getQueryParamData:function(){$.ajax({type:"post",url:"budget/main/getBudgetYear",async:true,success:function(data){if(data.flag==0){$("select.budget-year-sel").empty();var optionStr='';$.each(data.data,function(i,n){optionStr+='<option value="'+(i+1)+'">'+n.budgetYear+'</option>'});$("select.budget-year-sel").append(optionStr);$("select.budget-year-sel").niceSelect();executeQueryObj.getBudgetDataInfo($("select.budget-year-sel option:selected").text());$("select.budget-year-sel").change(function(){var thisYear=$(this).find("option:selected").text();executeQueryObj.getBudgetDataInfo(thisYear,$("select.unit-sel").val())})}}});$.ajax({type:"post",url:"user/userInfo/getAllDeptsInfo",async:true,success:function(data){if(data.flag==0){var list=data.data||[];$("select.unit-sel").empty();var optionStr='<option value="">全部</option>';if(list.length>0){$.each(list,function(i,n){if(n.type=="2"){optionStr+='<option value="'+n.id+'">'+n.text+'</option>'}})}$("select.unit-sel").append(optionStr).niceSelect();$("select.unit-sel").change(function(){var thisUnit=$(this).val();executeQueryObj.getBudgetDataInfo($("select.budget-year-sel option:selected").text(),thisUnit)})}}})},getBudgetDataInfo:function(yearVal,unitVal){yearVal=(yearVal==undefined?"":yearVal);unitVal=(unitVal==undefined?"":unitVal);if($('.unit-none-lable').hasClass('lable-my-id')){unitVal=$yt_common.user_info.deptId}$.ajax({type:"post",url:"budget/main/getBudgetExecuteTableDataInfo",async:true,data:{budgetYear:yearVal,deptId:unitVal},success:function(data){if(data.flag==0){var datas=executeQueryObj.getTreeData(data.data,'-1',"specialCode","parentCode");$('#budgetTab').treegrid("loadData",datas)}else{$yt_alert_Model.prompt(data.message)}}})},getTreeData:function(data,parentId,code,parentCode){code=code?code:'id';parentCode=parentCode?parentCode:'parentId';var me=this;var result=[],temp;for(var i in data){if(data[i][parentCode]==parentId){result.push(data[i]);temp=me.getTreeData(data,data[i][code],code,parentCode);if(temp.length>0){data[i].children=temp}}}return result},initQtip:function(){$('.qtip-lable').qtip({content:{text:function(event,api){var thisObj=$(this);var execute=$(this).attr("execute-data");var unExecute=$(this).attr("un-execute-data");var showText='<div style="width:160px;color:#666;"><div><div class="qtip-yuan-div" style="background: blue;"></div><span>已执行</span><span  style="margin-left:10px;">'+execute+'</span></div><div><div class="qtip-yuan-div" style="background: orange;"></div><span>待执行</span><span  style="margin-left:10px;">'+unExecute+'</span></div></div>';return showText}},position:{my:'top center',at:'top center',container:false,viewport:$('body'),adjust:{x:0,y:10,mouse:true,resize:true,method:'flip flip'}},hide:{fixed:true,},style:{classes:'showmod',tip:{corner:true,mimic:false,width:10,height:10,border:true,offset:0}},events:{show:function(data){$(data.target).find(".qtip-content").css("max-height",$('#frame-right-model').height()-200)}}})},eventInit:function(){}};$(function(){executeQueryObj.init();$('#budgetTab').treegrid({idField:'specialCode',treeField:'specialName',columns:[[{title:'预算科目',field:'specialName',width:'25%',align:'center',formatter:function(value,row,index,num){return '<span class="tree-title" style="" title="'+value+'">'+value+'</span>'}},{title:'预算额(万元)',field:'totalAmount',width:'15%',align:'center',formatter:function(value,row,index,num){return '<span style="float: right;display: inline;">'+(value==""?"0.00":$yt_baseElement.fmMoney(value))+'</span>'}},{title:'已执行预算额(万元)',field:'executeAmount',width:'15%',align:'center',formatter:function(value,row,index,num){return '<span style="float: right;display: inline;">'+(value==""?"0.00":$yt_baseElement.fmMoney(value))+'</span>'}},{title:'预算与已执行的差额(万元)',field:'differenceAmount',width:'15%',align:'center',formatter:function(value,row,index,num){return '<span style="float: right;display: inline;">'+(value==""?"0.00":$yt_baseElement.fmMoney(value))+'</span>'}},{title:'待执行预算额(万元)',field:'unExecuteAmount',width:'15%',align:'center',formatter:function(value,row,index,num){return '<span style="float: right;display: inline;">'+(value==""?"0.00":$yt_baseElement.fmMoney(value))+'</span>'}},{title:'执行进度',field:'percentExecute',width:'16%',align:'center',formatter:function(value,row,index,num){var planStr='<div class="plan-div qtip-lable" style="background: #c2c1c1;width: 100%;" execute-data="'+row.percentExecute+'" un-execute-data="'+row.percentUnExecute+'"><div class="plan-div percentExecute" style="background: blue;width:'+row.percentExecute+'"></div><div class="plan-div percentUnExecute" style="background: orange;width:'+row.percentUnExecute+'"></div></div>';return planStr}}]],onLoadSuccess:function(){executeQueryObj.initQtip();$(".tree-icon").removeClass("tree-folder tree-folder-open tree-folder-closed")}})});