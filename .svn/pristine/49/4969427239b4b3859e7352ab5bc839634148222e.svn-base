var curriculumList={init:function(){var first=$yt_common.GetQueryString("first");if(first==null){$('#operate-type').val("减免");$('.listName').text('费用减免列表');$('.reduce-list').show();$('.borrow-list').hide();curriculumList.getPlanListInfo()}else if(first=="cost"){$(".cost-btn").addClass("active").siblings().removeClass("active");$('#operate-type').val("减免");$('.listName').text('费用减免列表');$('.reduce-list').show();$('.borrow-list').hide();curriculumList.getPlanListInfo()}else if(first=="borrow"){$(".borrow-btn").addClass("active").siblings().removeClass("active");$('#operate-type').val("发票");$('.reduce-list').hide();$('.listName').text('借用发票列表');$('.borrow-list').show();curriculumList.getBorrowListInfo()};var operate;$(".tab-title-list button").click(function(){$(this).addClass("active").siblings().removeClass("active");operate=$(this).text();if(operate=="• 费用减免"){$('.listName').text('费用减免列表');$('#operate-type').val("减免");$('.reduce-list').show();$('.borrow-list').hide();curriculumList.getPlanListInfo();$(".search-btn").click(function(){curriculumList.getPlanListInfo()})};if(operate=="• 借用发票"){$('#operate-type').val("发票");$('.listName').text('借用发票列表');$('.reduce-list').hide();$('.borrow-list').show();curriculumList.getBorrowListInfo();$(".search-btn").click(function(){curriculumList.getBorrowListInfo()})}});$(".delete-couse-btn").on('click',function(){if($(".yt-table-active").length==0){$yt_alert_Model.prompt("请选择要删除的数据");return false}operate=$('#operate-type').val();var path="";var pkId=$('.yt-table-active .pkId').text();if(operate=="减免"){path="finance/reduction/removeBeanById";curriculumList.delclassInfo(pkId,path);$('.reduce-list').show();$('.borrow-list').hide();curriculumList.getPlanListInfo()}if(operate=="发票"){path="finance/invoicing/removeBeanById";curriculumList.delclassInfo(pkId,path);$('.reduce-list').hide();$('.borrow-list').show();curriculumList.getBorrowListInfo()}});$('.add-couse-btn').on('click',function(){operate=$('#operate-type').val();if(operate=="减免"){window.location.href="addCostList.html"}else if(operate=="发票"){window.location.href="addBorrowList.html"}});$('.borrow-list').on("click",".invoice-org-href",function(){var pkId=$(this).parent().parent().find('td.pkId').text();var workFlawState=$(this).parent().parent().find("td.workFlawState").text();if(workFlawState=="已通过"){window.location.href="borrowInfo.html?pkId="+pkId+"&num=4"}else if(workFlawState=="已开票"){var billingInformation=encodeURI(encodeURI($(this).parent().parent().find("td.billing-information").text()));var url="borrowInfo.html?pkId="+pkId+"&num=3&billingInformation="+billingInformation;window.location.href=encodeURI(url)}});$('.reduce-list').on("click",".project-code-href",function(){var pkId=$(this).parent().parent().find('td.pkId').text();window.location.href="costInfo.html?pkId="+pkId+"&num=3"});$(".update-couse-btn").click(function(){if($(".yt-table-active").length==0){$yt_alert_Model.prompt("请选择要修改的数据");return false}operate=$('#operate-type').val();var pkId=$('.yt-table-active .pkId').text();if(operate=="减免"){window.location.href="costInfoEditable.html?pkId="+pkId}else if(operate=="发票"){window.location.href="borrowInfoEditable.html?pkId="+pkId}});$('.search-btn').click(function(){var lableType=$('#operate-type').val();if(lableType=="减免"){curriculumList.getPlanListInfo()}else{curriculumList.getBorrowListInfo()}})},getPlanListInfo:function(){var keyword=$('#keyword').val();$('.curriculum-page').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/reduction/lookForAllByPass",type:"post",data:{selectParam:keyword},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.reduce-list .yt-tbody');var htmlTr='';var num=1;var projectType;if(data.data!=null){$(htmlTbody).empty();$.each(data.data.rows,function(i,v){i=i+1;if(v.projectType==1){projectType="计划"};if(v.projectType==2){projectType="委托"};if(v.projectType==3){projectType="选学"};if(v.projectType==4){projectType="调训"};var createTimeString=v.createTimeString.split(" ")[0];htmlTr='<tr><td style="display:none;" class="pkId">'+v.pkId+'</td><td class="projectCode list-td">'+v.projectCode+'</td><td style="text-align:left;" class="projectName"><a style="color: #3c4687;" class="project-code-href">'+v.projectName+'</a></td><td class="projectType list-td">'+projectType+'</td><td class="projectHead list-td">'+v.projectHead+'</td><td class="startDate list-td">'+v.startDate+'</td><td class="endDate list-td">'+v.endDate+'</td><td class="createTimeString list-td">'+createTimeString+'</td><td class="postRemissionMoney" style="text-align:right;">'+v.postRemissionMoney+'</td><td class="createUser list-td">'+v.createUser+'</td><td class="workFlawState list-td">'+v.workFlawState+'</td></tr>';htmlTbody.append($(htmlTr).data("legalData",v))})}else{htmlTbody.html("");htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$('#keyword').val("");$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getBorrowListInfo:function(){var keyword=$('#keyword').val();$('.page-info').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/invoicing/lookForAllByPass",type:"post",data:{selectParam:keyword},before:function(){$yt_baseElement.showLoading()},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.borrow-list .borrow-list-tod');var htmlTr='';var num=1;var invoiceType;if(data.data!=null){$(htmlTbody).empty();$.each(data.data.rows,function(i,v){i=i+1;if(v.invoiceType==1){invoiceType="普通发票"};if(v.invoiceType==2){invoiceType="增值税发票"};var createTimeString=v.createTimeString.split(" ")[0];htmlTr='<tr><td>'+i+'</td><td style="display:none;" class="pkId">'+v.pkId+'</td><td style="text-align:left;" class="invoiceOrg"><a style="color: #3c4687;" class="invoice-org-href">'+v.invoiceOrg+'</a></td><td class="invoiceType">'+invoiceType+'</td><td class="createTimeString">'+createTimeString+'</td><td style="text-align:right;" class="applicationInvoice">'+v.applicationInvoice+'</td><td class="createUser">'+v.createUser+'</td><td class="workFlawState">'+v.workFlawState+'</td><td class="billing-information">'+v.billingInformation+'</td></tr>';htmlTbody.append(htmlTr)})}else{htmlTbody.html("");htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="8" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$('#keyword').val("");$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},delclassInfo:function(pkId,path){$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+path,data:{pkId:pkId},before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading();}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("删除失败")})}}})}})}};$(function(){curriculumList.init()});