var budgetQueryList = {
	//初始化方法
	init: function() {
		$(".yt-select").niceSelect();
		//日期控件
		$(".start-time-start").calendar({
			controlId: "startDate",
			nowData: false, //默认选中当前时间,默认true  
			upperLimit: $(".start-time-end") //开始日期最大为结束日期  
		});
		$(".start-time-end").calendar({
			controlId: "endDate",
			nowData: false, //默认选中当前时间,默认true  
			lowerLimit: $(".start-time-start") //结束日期最小为开始日期  
		});
		$(".end-time-start").calendar({
			controlId: "startDate",
			dateFmt:"yyyy-MM-dd HH:mm",
			nowData: false, //默认选中当前时间,默认true  
			upperLimit: $(".end-time-end") //开始日期最大为结束日期  
		});
		$(".end-time-end").calendar({
			controlId: "endDate",
			dateFmt:"yyyy-MM-dd HH:mm",
			nowData: false, //默认选中当前时间,默认true  
			lowerLimit: $(".end-time-start") //结束日期最小为开始日期  
		});
		//调用获取列表数据方法
		budgetQueryList.getbudgetQueryListInf();
		
		//点击待审批中项目名称跳转到审批详情页面
		$(".budget-query-tbody").on("click",".project-name-query",function(){
			window.location.href="/cbead/website/view/projectBudget/projectBudgetDetails.html?pkId=" + $('.yt-table-active .pkId').val();
		});
		//模糊查询
		$(".search-btn").click(function(){
			budgetQueryList.getbudgetQueryListInf();
		});
		//高级查询
		var clickTIme=0;
		$("button.senior-search-btn").click(function(){
			if(clickTIme%2==0){
				$(".search-box").show();
				$(".search-put").addClass('flipy');
			}else{
				$(".search-box").hide();
				$(".search-put").removeClass('flipy');
			}
			clickTIme++;
		});
	},
		
	/**
	 * 获取列表数据
	 */
	getbudgetQueryListInf: function() {
		$yt_baseElement.showLoading();
		var selectParam=$(".selectParam").val(); 
		$('.budget-query-page').pageInfo({
			pageIndexs: 1,
			pageNum: 15, //每页显示条数  
			pageSize: 10, //显示...的规律  
			url: $yt_option.base_path + "finance/projectBudget/lookForAllByFinished", //ajax访问路径  
			type: "post", //ajax访问方式 默认 "post"  
			data: {
				selectParam:selectParam,
				startDateStart:"",
				startDateEnd:"",
				createTimeStart:"",
				createTimeEnd:"",
				trainDateStart:"",
				trainDateEnd:"",
				surplusBudgetStart:"",
				surplusBudgetEnd:"",
				types:"",
				implementationRateStart:"",
				implementationRateEnd:""
			}, //ajax查询访问参数
			objName: 'data', //指获取数据的对象名称  
			success: function(data) {
				$yt_baseElement.showLoading();
				if(data.flag == 0) {
					var htmlTbody = $('.budget-query-tbody');
					var htmlTr = '';
					if(data.data.rows.length > 0) {
						$.each(data.data.rows, function(i, v) {
							v.workFlawState=='已完成'?v.workFlawState='已通过':v.workFlawState=v.workFlawState;
							htmlTr += '<tr>' +
								'<td><a class="file-name" ><input type="hidden" value="' + v.pkId + '" class="pkId">'+v.projectCode+'</a></td>' +
								'<td style="text-align: left;"><a href="#" class="project-name-query" style="color:#3c4687;">' + v.projectName + '</a></td>' +
								'<td style="text-align: left;">' + v.projectHead + '</td>' +
								'<td>' + v.startDate + '</td>' +
								'<td style="text-align: right;">' + v.trainDate + '</td>' +
								'<td>' + v.createTime + '</td>' +
								'<td style="text-align: right;">' + Number(v.budgetTotal).toFixed(2) + '</td>' +
								'<td style="text-align: left;">' + v.workFlawState + '</td>' +
								'<td style="text-align: right;">' + v.implementationRate + '</td>' +
								'<td style="text-align: right;">' + v.surplusBudget + '</td>' +
								'</tr>';
								$(".budget-query-page").show();
						});
					} else {
						$(".budget-query-page").hide();
						htmlTr += '<tr style="border:0px;background-color:#fff !important;" >' +
							'<td colspan="10" align="center" style="border:0px;">' +
							'<div class="no-data" style="width: 280px;margin: 0 auto;">' +
							'<img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;">' +
							'</div>' +
							'</td>' +
							'</tr>';
					}
					htmlTbody.html(htmlTr);
					$yt_baseElement.hideLoading();
				} else {
					$yt_baseElement.hideLoading(function (){
						$yt_alert_Model.prompt("查询失败");
					});
				}

			}, //回调函数 匿名函数返回查询结果  
			isSelPageNum: true //是否显示选择条数列表默认false  
		});
	}
}
$(function() {
	//初始化方法
	budgetQueryList.init();
	
});