var assetsList={init:function(){$("select").niceSelect();$("#txtDate").calendar({speed:200,complement:true,lowerLimit:"2010/01/01",nowData:true,dateFmt:"yyyy-MM-dd",callback:function(){}});$("input.check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".check-all-tab tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody tr").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}});$(".addList").click(function(){$("select").niceSelect();$('.ticket-title-span').text("新增资产");assetsList.clearAddBox();assetsList.getAssetsCode();assetsList.showAlert()});$(".select-teacher-btn-div").on('click','.select-ticket-sure-btn',function(){assetsList.addOrUpdateRoom()});var pkId="";$(".updateList").click(function(){var len=$('.select-assets-alert-checkbox input[class="select-assets-pkId"]:checked').length;if(len==1){pkId=$('.select-assets-alert-checkbox input[class="select-assets-pkId"]:checked').val();$('.hid-pk-id').val(pkId);$('.ticket-title-span').text("修改资产");assetsList.clearAddBox();assetsList.showAlert();assetsList.getUpdate()}else{$yt_alert_Model.prompt("请选中一行数据进行操作",3000)}});$(".disableList").click(function(){assetsList.getExportAssets()});$(".class-tbody").on('click','.real-name-inf',function(){$(".only-look-shuttle-box").width("800px");$('.ticket-title-div').show();$('.info-copy-btn').show();$('.cont-info-hide').show();$('.copy-alert-title-div').hide();$('.cont-copy-hide').hide();var pkId=$(this).prev().val();$('.hid-pk-id').val(pkId);assetsList.clearAddBox();assetsList.onlyLookAlert();assetsList.lookOneInfor(pkId);$('.select-ticket-canel-btn').val("关闭");});assetsList.getPlanListInfo();$('.key-word').off().on('click','.search-btn',function(){assetsList.getPlanListInfo()});var typeList=assetsList.getTypeList();if(typeList!=null){$.each(typeList.data,function(i,n){if(n!=null){$("#typeList").append($('<option value="'+n.typeId+'">'+n.typeName+'</option>').data("classData",n))}})};$("select").niceSelect();$('#typeList').on('change',function(){assetsList.getclassifyCode()});$('#assetsCodeList').on('change',function(){var assetsCode=$('#assetsCodeList option:selected').val();$('#classifyName').val(assetsCode);$("select").niceSelect()});$('#classifyName').on('change',function(){var classifyName=$('#classifyName option:selected').val();$('#assetsCodeList').val(classifyName);$("select").niceSelect()});$('#userName').on('change',function(){var userName=$('#userName option:selected').val();$('#administratorCode').val(userName);$("select").niceSelect()});var deptList=assetsList.getDeptList();if(deptList!=null){$.each(deptList.data,function(i,n){if(n.type==2){$("#deptList").append($('<option value="'+n.id+'">'+n.text+'</option>').data("classData",n))}if(n.type==3){$("#userName").append($('<option value="'+n.textName+'">'+n.text+'</option>').data("classData",n))}if(n.type==3){$("#administratorCode").append($('<option value="'+n.textName+'">'+n.text+'</option>').data("classData",n))}})};$("select").niceSelect();$(".deleteList").click(function(){var pkId="";$('.select-assets-alert-checkbox input[class="select-assets-pkId"]:checked').each(function(){if(pkId==""){pkId=$(this).val()}else{pkId+=","+$(this).val()}});if(pkId==""){$yt_alert_Model.prompt("请选中一行数据进行操作",3000)}else{$yt_alert_Model.alertOne({alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){assetsList.removeBeanById(pkId)}})}});$(".leading-in").undelegate().delegate("input","change",function(){var me=$(this);var addFile=$(this).attr("id");var fileName=$(this).val().split('\\');var fm=fileName[fileName.length-1]});assetsList.getAssetsCode();$("#assetsCode").blur(function(){assetsList.getAssetsCodeIsHave()});$('.student-import-btn').on('click',function(){$(".batch-import-form").show();$yt_alert_Model.getDivPosition($(".batch-import-form"));$yt_model_drag.modelDragEvent($(".batch-import-form .yt-edit-alert-title"));$('.batch-import-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".batch-import-form").hide();$("#pop-modle-alert").hide()})});$('.batch-import-form .download-template').click(function(){var fileName="资产列表模板";$.ajaxDownloadFile({url:$yt_option.base_path+"administrator/assets/downloadAssts",data:{fileName:fileName}})});$(".leading-in").undelegate().delegate("input","change",function(){var me=$(this);var addFile=$(this).attr("id");var fileName=$(this).val().split('\\');var fm=fileName[fileName.length-1];$('.batch-import-form .import-file-name').val(fm)});$('.batch-import-form .yt-model-sure-btn').off().on('click',function(){var addFile='fileName';var fm=$('.batch-import-form .import-file-name').val();var url=$yt_option.base_path+"administrator/assets/importAssets";if(fm==""){$yt_alert_Model.prompt("请选择导入文件！")}else{$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:addFile,data:{},success:function(data,textStatus){$("#"+addFile).val("");$yt_alert_Model.prompt(data.message)},error:function(data,status,e){$yt_alert_Model.prompt("附件导入失败!!!!");$("#"+addFile).val("")}})}});$('.copy-btn').click(function(){$(".only-look-shuttle-box").width("600px");$('#count').val("");$('.start-num').val("");$('.end-num').val("");$('.ticket-title-div').hide();$('.info-copy-btn').hide();$('.cont-info-hide').hide();$('.copy-alert-title-div').show();$('.cont-copy-hide').show()});$('.cop-canel-btn').click(function(){$(".only-look-shuttle-box").width("800px");$('.ticket-title-div').show();$('.info-copy-btn').show();$('.cont-info-hide').show();$('.copy-alert-title-div').hide();$('.cont-copy-hide').hide()});$('#count').blur(function(){var vail=$yt_valid.validForm($(".copy-table"));if(vail){var intStarNum;$.ajax({type:"post",url:$yt_option.base_path+"administrator/assets/getAssetsCode",async:false,data:{},success:function(data){$('.start-num').val(data.data);intStarNum=data.data},error:function(data){}});var count=parseInt($(this).val());var intStarNum=parseInt($(".start-num").val());var strNum='000000000'+intStarNum.toString();strNum=strNum.substring(strNum.length-9,strNum.length);$('.start-num').val(strNum);var strEndNum='000000000'+(intStarNum+count).toString();strEndNum=strEndNum.substring(strEndNum.length-9,strEndNum.length);$('.end-num').text(strEndNum)}});$('.start-num').blur(function(){var count=parseInt($('#count').val());var intStarNum=parseInt($(".start-num").val());var strNum='000000000'+intStarNum.toString();strNum=strNum.substring(strNum.length-9,strNum.length);$('.start-num').val(strNum);var strEndNum='000000000'+(intStarNum+count).toString();strEndNum=strEndNum.substring(strEndNum.length-9,strEndNum.length);$('.end-num').text(strEndNum)});$('.only-look-shuttle-box .yt-eidt-model-bottom .cop-sur-btn').off().on("click",function(){var pkId=$('.hid-pk-id').val();var count=$('#count').val();var assetsCode=$('.start-num').val();$.ajax({type:"post",url:$yt_option.base_path+"administrator/assets/copyAssets",data:{pkId:pkId,copyCount:count,assetsCode:assetsCode},async:false,success:function(data){if(data.flag==0){$yt_alert_Model.prompt("复制成功",2000);assetsList.getPlanListInfo();$('.cont-copy-hide').hide()}else if(data.flag==5){$yt_alert_Model.alertOne({haveCloseIcon:true,leftBtnName:"确定",cancelFunction:"",alertMsg:"资产编码范围与已有资产编码重复，无法进行复制。请调整复制数量",cancelFunction:function(){}})}else{$yt_alert_Model.prompt(data.message,2000)}}});$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},getclassifyCode:function(){$("#assetsCodeList  option:gt(0)").remove();var typeId=$('#typeList option:selected').val();var classifyName=$('#typeList option:selected').data("classData").typeName;var classify=assetsList.getClassify(typeId,classifyName);$("select").niceSelect();if(classify!=null){$.each(classify.data,function(i,n){$("#assetsCodeList").append($('<option value="'+n.classifyCode+'">'+n.classifyCode+n.classifyName+'</option>').data("classData",n));})};$("select").niceSelect()},showAlert:function(){$(".shuttle-box").show();$yt_alert_Model.getDivPosition($(".shuttle-box"));$yt_model_drag.modelDragEvent($(".shuttle-box .yt-edit-alert-title"));$('.shuttle-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()});$('.shuttle-box .yt-eidt-model-bottom .select-ticket-sure-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},onlyLookAlert:function(){$(".only-look-shuttle-box").show();$yt_alert_Model.getDivPosition($(".only-look-shuttle-box"));$yt_model_drag.modelDragEvent($(".only-look-shuttle-box .yt-edit-alert-title"));$('.only-look-shuttle-box .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},getTypeList:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"administrator/assets/getType",data:{typeName:""},async:false,success:function(data){list=data||[]}});return list},getClassify:function(typeId,classifyName){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"administrator/assets/getClassify",data:{typeId:typeId,classifyName:""},async:false,success:function(data){list=data||[]}});return list},getDeptList:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/user/getUsers",data:{typeName:""},async:false,success:function(data){list=data||[]}});return list},getPlanListInfo:function(){$yt_baseElement.showLoading();var keyword=$('#keyword').val();$('.page-info').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"administrator/assets/lookForAll",type:"post",data:{selectParam:keyword},objName:'data',success:function(data){var directionUse;var useStatus;if(data.flag==0){var htmlTbody=$('.list-table .yt-tbody');var htmlTr='';var num=1;if(data.data.rows.length>0){$(htmlTbody).empty();$.each(data.data.rows,function(i,v){if(v.directionUse==1){directionUse="自用"};if(v.directionUse==2){directionUse="出借"}if(v.useStatus==1){useStatus="在用"};if(v.useStatus==2){useStatus="不能用"};if(v.useStatus==3){useStatus="闲置"};if(v.useStatus==4){useStatus="其他"};htmlTr='<tr><td style="text-align:center;"><label class="check-label yt-checkbox select-assets-alert-checkbox"><input type="checkbox" name="test" class="select-assets-pkId" value="'+v.pkId+'"/></label></td><td style="text-align:center;"><input type="hidden" value="'+v.pkId+'" class="pkId"><a style="color:#3c4687;" href="#" class="real-name-inf assetsCode">'+v.assetsCode+'</a></td><td >'+v.assetsName+'</td><td style="text-align:center;">'+v.typeName+'</td><td>'+v.assetsBrand+'</td><td style="text-align:center;">'+v.obtainDate+'</td><td style="text-align:center;">'+directionUse+'</td><td style="text-align:center;">'+useStatus+'</td><td style="text-align:center;">'+v.userName+'</td><td style="text-align:center;">'+v.administratorName+'</td><td>'+v.placeStorage+'</td></tr>';htmlTbody.append($(htmlTr).data("legalData",v))})}else{$(htmlTbody).empty();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="8" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';$('.page1').hide();htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},clearAddBox:function(){$('.typeId').setSelectVal("");$('.classifyCode').setSelectVal("");$('.obtainDate').val("");$('.assetsName').val("");$('.sourceFunds').setSelectVal("");$('.assetsCode').val("");$('.directionUse').setSelectVal("");$('.assetsName').val("");$('.useStatus').setSelectVal("");$('.assetsBrand').val("");$('.deptId').setSelectVal("");$('.assetsModel').val("");$('.userName').setSelectVal("");$('.serialNumber').val("");$('.administratorCode').setSelectVal("");$('.assetsCount').val("");$('.placeStorage').val("");$('.assetsWorth').val("");$('.otherCode').val("");$('.remarks').val("")},look:function(){var typeId=$('#typeList').text();var classifyCode=$('#assetsCodeList').text();var obtainDate=$('#txtDate').text();var classifyName=$('.classifyName').text();var sourceFunds=$('.sourceFunds').text();var assetsCode=$('#assetsCode').text();var directionUse=$('.directionUse').text();var assetsName=$('.assetsName').text();var useStatus=$('.useStatus').text();var assetsBrand=$('.assetsBrand').text();var deptId=$('.deptId').text();var assetsModel=$('.assetsModel').text();var userCode=$('.userName').text();var serialNumber=$('.serialNumber').text();var administratorCode=$('.administratorCode').text();var assetsCount=$('.assetsCount').text();var placeStorage=$('.placeStorage').text();var assetsWorth=$('.assetsWorth').text();var remarks=$('.remarks').text()},getAssetsCode:function(){$.ajax({type:"post",url:$yt_option.base_path+"administrator/assets/getAssetsCode",data:{},async:false,success:function(data){$('.add-table').find('#assetsCode').val(data.data)}})},getAssetsCodeIsHave:function(){var pkId=$('.hid-pk-id').val();var assetsCode=$('#assetsCode').val();$.ajax({type:"post",url:$yt_option.base_path+"administrator/assets/getAssetsCodeIsHave",data:{pkId:pkId,assetsCode:assetsCode},async:false,success:function(data){if(data.flag==0){if(data.data==1){$yt_alert_Model.prompt("资产编号已存在！")}}}})},addOrUpdateRoom:function(){var pkId=$('.hid-pk-id').val();var typeId=$('#typeList').val();var classifyCode=$('#assetsCodeList').val();var obtainDate=$('#txtDate').val();var classifyName=$('.classifyName').val();var sourceFunds=$('.sourceFunds').val();var assetsCode=$('#assetsCode').val();var directionUse=$('.directionUse').val();var assetsName=$('.assetsName').val();var useStatus=$('.useStatus').val();var assetsBrand=$('.assetsBrand').val();var deptId=$('.deptId').val();var assetsModel=$('.assetsModel').val();var userCode=$('.userName').val();var serialNumber=$('.serialNumber').val();var administratorCode=$('#administratorCode').val();var assetsCount=$('.assetsCount').val();var placeStorage=$('.placeStorage').val();var assetsWorth=$('.assetsWorth').val();var otherCode=$('.otherCode').val();var remarks=$('.remarks').val();$.ajax({type:"post",url:$yt_option.base_path+"administrator/assets/addOrUpdateRoom",data:{pkId:pkId,typeId:typeId,classifyCode:classifyCode,obtainDate:obtainDate,assetsCode:assetsCode,assetsName:assetsName,assetsBrand:assetsBrand,sourceFunds:sourceFunds,directionUse:directionUse,useStatus:useStatus,deptId:deptId,assetsModel:assetsModel,userCode:userCode,serialNumber:serialNumber,administratorCode:administratorCode,assetsCount:assetsCount,placeStorage:placeStorage,assetsWorth:assetsWorth,otherCode:otherCode,remarks:remarks},async:false,beforeSend:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$yt_alert_Model.prompt(data.message);$yt_baseElement.hideLoading();assetsList.getPlanListInfo()}else{$yt_baseElement.hideLoading(function(){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("操作失败")});assetsList.getPlanListInfo()})}}})},getUpdate:function(){var pkId=$('.hid-pk-id').val();$.ajax({type:"post",url:$yt_option.base_path+"administrator/assets/getBeanById",data:{pkId:pkId},beforeSend:function(){$yt_baseElement.showLoading()},async:false,success:function(data){if(data.flag==0){$('#typeList').setSelectVal(data.data.typeId);assetsList.getclassifyCode();$('#assetsCodeList').setSelectVal(data.data.classifyCode);$('#txtDate').val(data.data.obtainDate);$('#classifyName').setSelectVal(data.data.classifyCode);$('#sourceFunds').setSelectVal(data.data.sourceFunds);$('#assetsCode').val(data.data.assetsCode);$('#directionUse').setSelectVal(data.data.directionUse);$('.assetsName').val(data.data.assetsName);$('#useStatus').setSelectVal(data.data.useStatus);$('#assetsBrand').val(data.data.assetsBrand);$('#deptName').setSelectVal(data.data.deptId);$('#assetsModel').val(data.data.assetsModel);$('#userName').setSelectVal(data.data.userCode);$('#serialNumber').val(data.data.serialNumber);$('#administratorCode').setSelectVal(data.data.administratorCode);$('#assetsCount').val(data.data.assetsCount);$('#placeStorage').val(data.data.placeStorage);$('#assetsWorth').val(data.data.assetsWorth);$('#otherCode').val(data.data.otherCode);$('#remarks').val(data.data.remarks);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("获取数据失败")})}}})},removeBeanById:function(pkId){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"administrator/assets/removeBeanById",async:false,data:{pkIds:pkId},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading();assetsList.getPlanListInfo()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("移除资产失败")})}}})},lookOneInfor:function(pkId){$yt_baseElement.showLoading();$.ajax({type:"post",url:$yt_option.base_path+"administrator/assets/getBeanById",data:{pkId:pkId},async:false,success:function(data){if(data.flag==0){var classifyCode=data.data.classifyCode+data.data.classifyName;var directionUse="";var useStatus="";var sourceFunds="";if(data.data.sourceFunds==1){sourceFunds="财政"};if(data.data.sourceFunds==2){sourceFunds="自有"};if(data.data.sourceFunds==3){sourceFunds="财政&自有"};if(data.data.directionUse==1){directionUse="自用"};if(data.data.directionUse==2){directionUse="出借"};if(data.data.directionUse==3){directionUse="出租"}if(data.data.directionUse==4){directionUse="其它"}if(data.data.useStatus==1){useStatus="在用"};if(data.data.useStatus==2){useStatus="不能用"};if(data.data.useStatus==3){useStatus="闲置"};if(data.data.useStatus==4){useStatus="其他"};$('#typeName-look').text(data.data.typeName);$('#classifyCode-look').text(classifyCode);$('#txtDate-look').text(data.data.obtainDate);$('#sourceFunds-look').text(sourceFunds);$('#assetsCode-look').text(data.data.assetsCode);$('#directionUse-look').text(directionUse);$('#assetsName-look').text(data.data.assetsName);$('#useStatus-look').text(useStatus);$('#assetsBrand-look').text(data.data.assetsBrand);$('#deptName-look').text(data.data.deptName);$('#assetsModel-look').text(data.data.assetsModel);$('#userName-look').text(data.data.userName);$('#serialNumber-look').text(data.data.serialNumber);$('#administratorName-look').text(data.data.administratorName);$('#assetsCount-look').text(data.data.assetsCount);$('#placeStorage-look').text(data.data.placeStorage);$('#assetsWorth-look').text(data.data.assetsWorth);$('#remarks-look').text(data.data.remarks);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("获取数据失败")})}}})},getExportAssets:function(){var selectParam=$('#keyword').val();var aText;var assetsCodes="";$('.select-assets-alert-checkbox input[class="select-assets-pkId"]:checked').each(function(i,n){aText=$(n).parent().parent().parent().eq(0).find('.assetsCode');if(assetsCodes==""){assetsCodes=aText.text()}else{assetsCodes+=","+aText.text()}});alertNmae=$('.types').val();$.ajaxDownloadFile({url:$yt_option.base_path+"administrator/assets/exportAssets",data:{selectParam:selectParam,obtainDateStart:"",obtainDateEnd:"",typeId:"",directionUse:"",useStatus:"",assetsCodes:assetsCodes,fileName:"资产导出数据"}})}};$(function(){assetsList.init()});