var budgetApprovalList={init:function(){$(".yt-select").niceSelect();$(".start-time-start").calendar({controlId:"startDate",nowData:false,upperLimit:$(".start-time-end")});$(".start-time-end").calendar({controlId:"endDate",nowData:false,lowerLimit:$(".start-time-start")});$(".end-time-start").calendar({controlId:"startDate",dateFmt:"yyyy-MM-dd HH:mm",nowData:false,upperLimit:$(".end-time-end")});$(".end-time-end").calendar({controlId:"endDate",dateFmt:"yyyy-MM-dd HH:mm",nowData:false,lowerLimit:$(".end-time-start")});var index=0;var backType=$yt_common.GetQueryString('backType');if(backType==1){$(".pending-approval-tab").eq(1).removeClass("active");budgetApprovalList.getPendingBudgetApprovalListInf()}else if(backType==2){$(".pending-approval-tab").removeClass("active");$(".approval-record-tab").addClass("active");$(".box-list .content-box").hide().eq(0).hide();$(".box-list .content-box").hide().eq(1).show();index=1;$(".approval-record-selectParam").val("");budgetApprovalList.getApprovalRecordListInf()}else{budgetApprovalList.getPendingBudgetApprovalListInf()}budgetApprovalList.hideSearch();$(".tab-title-list button").click(function(){$(this).addClass("active").siblings().removeClass("active");$(".box-list .content-box").hide().eq($(this).index()).show();if($(this).index()==0){index=0;$(".pending-approval-selectParam").val("");budgetApprovalList.getPendingBudgetApprovalListInf()};if($(this).index()==1){index=1;$(".approval-record-selectParam").val("");budgetApprovalList.getApprovalRecordListInf();}});$(".budget-approval-tbody").on("click",".project-name-approval",function(){window.location.href="/cbead/website/view/budgetApproval/budgetApprovalDetails.html?pkId="+$('.yt-table-active .pkId').val()});$(".approval-record-tbody").on("click",".project-name-approval",function(){window.location.href="/cbead/website/view/projectBudget/projectBudgetDetails.html?history=oldApprove&pkId="+$('.yt-table-active .pkId').val()});$(".search-btn").click(function(){if(index==0){budgetApprovalList.getPendingBudgetApprovalListInf()}else if(index==1){budgetApprovalList.getApprovalRecordListInf()}})},getPendingBudgetApprovalListInf:function(){$yt_baseElement.showLoading();var selectParam=$(".pending-approval-selectParam").val();$('.budget-approval-page').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/projectBudget/lookForAllByApproved",type:"post",data:{selectParam:selectParam,startDateStart:"",startDateEnd:"",createTimeStart:"",createTimeEnd:"",trainDateStart:"",trainDateEnd:"",surplusBudgetStart:"",surplusBudgetEnd:"",projectType:"",types:""},objName:'data',success:function(data){$yt_baseElement.showLoading();if(data.flag==0){var htmlTbody=$('.budget-approval-tbody');var htmlTr='';if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){if(v.projectType==1){v.projectType="计划"}else if(v.projectType==2){v.projectType="委托"}else if(v.projectType==3){v.projectType="选学"}else if(v.projectType==4){v.projectType="中组部调训"}else if(v.projectType==5){v.projectType="国资委调训"}if(v.types==1){v.types="预算申请"}if(v.types==2){v.types="预算变更"}htmlTr+='<tr><td><a class="file-name"><input type="hidden" value="'+v.pkId+'" class="pkId">'+v.projectCode+'</a></td><td style="text-align: left;"><a style="color:#3c4687;" href="#" class="project-name-approval">'+v.projectName+'</a></td><td style="text-align: center;">'+v.projectType+'</td><td style="text-align: left;">'+v.projectHead+'</td><td>'+v.startDate+'</td><td style="text-align: right;">'+v.trainDate+'</td><td>'+v.createTime+'</td><td style="text-align: right;">'+Number(v.budgetTotal).toFixed(2)+'</td><td style="text-align: center;">'+v.types+'</td><td style="text-align: center;">'+v.dealingWithPeople+'</td></tr>';$(".budget-approval-page").show()})}else{$(".budget-approval-page").hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getApprovalRecordListInf:function(){var selectParam=$(".approval-record-selectParam").val();$('.approval-record-page').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/projectBudget/lookForAllByHi",type:"post",data:{selectParam:selectParam,startDateStart:"",startDateEnd:"",createTimeStart:"",createTimeEnd:"",trainDateStart:"",trainDateEnd:"",surplusBudgetStart:"",surplusBudgetEnd:"",projectType:"",types:""},before:function(){$yt_baseElement.showLoading()},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.approval-record-tbody');var htmlTr='';if(data.data.rows.length!=0){$.each(data.data.rows,function(i,v){if(v.projectType==1){v.projectType="计划"}else if(v.projectType==2){v.projectType="委托"}else if(v.projectType==3){v.projectType="选学"}else if(v.projectType==4){v.projectType="中组部调训"}else if(v.projectType==5){v.projectType="国资委调训"}if(v.types==1){v.types="预算申请"}if(v.types==2){v.types="预算变更"}htmlTr+='<tr><td><a class="file-name"><input type="hidden" value="'+v.pkId+'" class="pkId">'+v.projectCode+'</a></td><td style="text-align: left;"><a style="color:#3c4687;" href="#" class="project-name-approval">'+v.projectName+'</a></td><td style="text-align: center;">'+v.projectType+'</td><td style="text-align: left;">'+v.projectHead+'</td><td>'+v.startDate+'</td><td style="text-align: right;">'+v.trainDate+'</td><td>'+v.createTime+'</td><td style="text-align: right;">'+Number(v.budgetTotal).toFixed(2)+'</td><td style="text-align: center;">'+v.types+'</td><td style="text-align: center;">'+v.dealingWithPeople+'</td></tr>';$(".approval-record-page").show()})}else{$(".approval-record-page").hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},hideSearch:function(){var clickTime=0;$("button.senior-search-btn").click(function(e){if(clickTime%2==0){$("button.senior-search-btn img").addClass('flipy');$(".search-box1").show()}else{$("button.senior-search-btn img").removeClass('flipy');$(".search-box1").hide()}clickTime+=1;e.stopPropagation()});var clickTimes=0;$("button.search-record-btn").click(function(e){if(clickTimes%2==0){$("button.search-record-btn img").addClass('flipy');$(".search-box2").show()}else{$("button.search-record-btn img").removeClass('flipy');$(".search-box2").hide()}clickTimes+=1;e.stopPropagation()});$(document).click(function(e){clickTime=0;clickTimes=0;$("button.search-record-btn img").removeClass('flipy');$(".search-box1").hide();$(".search-box2").hide()});$(".search-box1,.search-box2").click(function(e){e.stopPropagation()})}};$(function(){budgetApprovalList.init()});