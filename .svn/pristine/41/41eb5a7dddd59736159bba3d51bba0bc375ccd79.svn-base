var billListInfo={init:function(){billListInfo.getBillListInfo();billListInfo.getProjectInfo();$(".bank-more-div").on("click",function(){if($(".bank-more-div").text()=="查看更多"){$("#project-main").css("width","2350px");$('.bank-more-div').text("收起");$(".bank-th-hide").show();$(".bank-tbody-td").attr("colspan","18")}else{$("#project-main").css("width","1140px");$('.bank-more-div').text("查看更多");$(".bank-th-hide").hide();$(".bank-tbody-td").attr("colspan","7")}});$(".claim-record").click(function(){if($(".yt-table-active").length!=0){var pkId=$(".yt-table-active").find(".pkId").val();window.location.href="claimRecord.html?pkId="+pkId}else{$yt_alert_Model.prompt("请选择一行数据！")}});$(".search-btn").click(function(){billListInfo.getBillListInfo()});$(".admission-manual").click(function(){if($(".yt-table-active").length==0){$yt_alert_Model.prompt("请选择一条信息进行认领");return false}billListInfo.classAlertFunc();});$(".check-all").on("click",function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".person-tbody,.company-tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}})},classAlertFunc:function(){billListInfo.getProjectInfo();$(".check-all").setCheckBoxState("uncheck");$(".class-select").setSelectVal("0");$(".class-select").niceSelect();billListInfo.getNoDetailedList("0");billListInfo.getDetailedPersonalList("0","");var identifications=$(".yt-table-active").find("input.identifications").val();var bankStatementDetailsIds=$(".yt-table-active").find("input.pkId").val();var projectCode="";$("select.class-select").change(function(){$(".alert-table-div").show();$(".alert-div-input").show();$("#confiscate-amount").hide();$("#user-name").css({float:"left",'margin':"0px 0px 0px 20px"});$("#last-amount").css({float:"left",'margin':"0px 0px 0px 100px"});$("#form-class").css({float:"left",'margin':"0px 0px 0px 70px"});$(".select-teacher-div").width("1100px");$(".yt-edit-alert-main").height("736px");$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-teacher-div"));$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));$("select").niceSelect();projectCode=$(this).val();billListInfo.getNoDetailedList(projectCode);billListInfo.getDetailedPersonalList(projectCode,"");$(".search-btn").click(function(){var keyword=$("#keyword").val();billListInfo.getDetailedPersonalList(projectCode,keyword)});if($(".identifications-div").text()!=""){var identifications=$(".identifications-div").text();billListInfo.getProjectStatementByProjectCode(projectCode,identifications)}else{var identifications=$(".yt-table-active").find(".identifications").val();billListInfo.getProjectStatementByProjectCode(projectCode,identifications)}});$(".select-teacher-sure-btn").on("click",function(){var paymentListAdd=[];$(".company-tbody,.person-tbody").find('label input[type="checkbox"]:checked').each(function(){if($(this).hasClass("statement-check")){}else{var paymentType="";var paymentValue=$(this).val();if($(this).parents("tr").find("td").length>6){paymentType="2"}else{paymentType="1"}var paymentListAddArr={paymentType:paymentType,paymentValue:paymentValue};paymentListAdd.push(paymentListAddArr)}});var paymentListDelete=[];$(".company-tbody,.person-tbody").find('input.statement-check').not("input:checked").each(function(){var paymentType="";var paymentValue=$(this).val();if($(this).parents("tr").find("td").length>6){paymentType="2"}else{paymentType="1"}var paymentListDeleteArr={paymentType:paymentType,paymentValue:paymentValue};paymentListDelete.push(paymentListDeleteArr)});var identifications=$(".yt-table-active").find(".identifications").val();;billListInfo.addNotReconciliations(projectCode,identifications,bankStatementDetailsIds,JSON.stringify(paymentListDelete),JSON.stringify(paymentListAdd),"")});$(".alert-table-div").show();$(".alert-div-input").show();$("#confiscate-amount").hide();$("#user-name").css({float:"left",'margin':"0px 0px 0px 20px"});$("#last-amount").css({float:"left",'margin':"0px 0px 0px 100px"});$("#form-class").css({float:"left",'margin':"0px 0px 0px 70px"});$(".select-teacher-div").width("1100px");$(".yt-edit-alert-main").height("736px");$(".select-teacher-div").show();$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-teacher-div"));$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));$("select").niceSelect();$('.select-teacher-canel-btn').click(function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})},addNotReconciliations:function(projectCode,identifications,bankStatementDetailsIds,paymentListDelete,paymentListAdd,uncollectedTotal){$.ajax({url:$yt_option.base_path+"finance/projectStatement/addNotReconciliations",type:"post",data:{projectCode:projectCode,bankStatementDetailsIds:bankStatementDetailsIds,identifications:identifications,paymentListDelete:paymentListDelete,paymentListAdd:paymentListAdd,uncollectedTotal:uncollectedTotal},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("认领成功");});$(".identifications-div").text(data.data)}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("认领失败")})}}})},getBillListInfo:function(){$yt_baseElement.showLoading();var keyword=$('.selectParam').val();$('.page-info').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"project/getBankStatementList",type:"post",data:{selectParam:keyword},success:function(data){if(data.flag==0){var htmlTbody=$('.project-tbody');var htmlTr='';htmlTbody.empty();if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){htmlTr+='<tr><td><input type="hidden" value="'+v.pkId+'" class="pkId">'+(i+1)+'</td><td><input type="hidden" class="identifications" value="'+v.identification+'"/>'+v.exchangeHour+'</td><td class="bank-th-hide" style="display:none;tex-align:right;">'+v.draw+'</td><td style="text-align:right">'+v.income+'</td><td style="text-align:left">'+v.otherPartyName+'</td><td style="text-align:left;">'+v.remarks+'</td><td>'+v.otherPartyAccounts+'</td><td style="text-align:right;">'+v.otherPartyGroup+'</td><td class="bank-th-hide" style="display:none">'+v.balance+'</td><td class="bank-th-hide" style="display:none">'+v.currency+'</td><td class="bank-th-hide" style="display:none">'+v.accountDate+'</td><td class="bank-th-hide" style="display:none">'+v.abstractData+'</td><td class="bank-th-hide" style="display:none">'+v.bankTradeNumber+'</td><td class="bank-th-hide enterpriseTradeNumber" style="display:none">'+v.enterpriseTradeNumber+'</td><td class="bank-th-hide" style="display:none">'+v.voucherType+'</td><td class="bank-th-hide" style="display:none">'+v.voucherNo+'</td><td class="bank-th-hide" style="display:none;text-align:left;">'+v.associatedAccount+'</td><td class="bank-th-hide" style="display:none;text-align:left;">'+v.alias+'</td></tr>';})}else{htmlTbody.empty();htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.append(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}var num=$(".project-tbody").children().length;$(".num").text(num)},isSelPageNum:true })},getNoDetailedList:function(){$yt_baseElement.showLoading();var projectCode=$('.class-select').val();$('.page-info').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/settlement/getNoDetailedList",type:"post",data:{projectCode:projectCode},success:function(data){if(data.flag==0){var htmlTbody=$('.company-tbody');var htmlTr='';var num=1;htmlTbody.empty();if(data.data.length>0){var states;var projectStates;$.each(data.data,function(i,v){htmlTr+='<tr><td style="text-align: center;"><input type="hidden" class="states"/><label class="check-label yt-checkbox select-checkbox"><input type="checkbox" name="test" class="group-id" value="'+v.groupId+'"/></label></td><td style="text-align:left">'+v.groupName+'</td><td style="text-align:right">'+v.amountReceivable+'</td><td style="text-align:right">'+v.netReceipts+'</td><td style="text-align:right">'+v.uncollected+'</td></tr>'})}else{htmlTbody.empty();htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="5" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';$('.page-info').hide()}htmlTbody.append(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getDetailedPersonalList:function(projectCode,keyword){$(".person-page").pageInfo({pageIndexs:1,pageNum:15,pageSize:10,async:false,url:$yt_option.base_path+"finance/settlement/getDetailedPersonalList",type:"post",data:{projectCode:projectCode,selectParam:keyword,trainingExpenseStart:"",trainingExpenseEnd:"",traineeNegotiatedPriceStart:"",traineeNegotiatedPriceEnd:"",quarterageStart:"",quarterageEnd:"",mealFeeStart:"",mealFeeEnd:"",otherChargesStart:"",otherChargesEnd:"",uncollectedStart:"",uncollectedEnd:""},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.person-tbody');var htmlTr='';htmlTbody.empty();if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){htmlTr='<tr><td style="text-align: center;"><label class="check-label yt-checkbox personal-checkbox"><input type="checkbox" value="'+v.traineeId+'"/></label></td><td>'+v.groupNum+'</td><td>'+v.realName+'</td><td>'+v.gender+'</td><td style="text-align:left">'+v.groupName+'</td><td style="text-align:left">'+v.groupOrgName+'</td><td style="text-align:right">'+v.smallPlan+'</td><td style="text-align:right">'+v.moneyTotal+'</td><td style="text-align:right">'+v.uncollected+'</td></tr>';htmlTbody.append(htmlTr)})}else{htmlTbody.html("");htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getAlertListInfoPlan:function(){var projectCode=$(".class-select").val();var keyword=$('#keyword').val();$yt_baseElement.showLoading();$('.page-info').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/settlement/getNoDetailedPersonalList",type:"post",data:{projectCode:projectCode,selectParam:keyword},success:function(data){if(data.flag==0){var htmlTbody=$('.person-tbody');var htmlTr='';htmlTbody.empty();if(data.data.rows.length>0){var states;var projectStates;$.each(data.data.rows,function(i,v){htmlTr+='<tr><td style="text-align: center;"><input type="hidden" class="states"/><label class="check-label yt-checkbox select-teacher-checkbox">	<input type="checkbox" name="test" class="select-trainee-pkId" value="'+v.traineeId+'"/></label></td><td style="text-align:left">'+v.realName+'</td><td style="text-align:right">'+v.gender+'</td><td style="text-align:right">'+v.groupName+'</td><td style="text-align:right">'+v.groupOrgName+'</td><td style="text-align:right">'+v.trainingExpenseNegotiatedPrice+'</td><td style="text-align:right">'+v.otherCost+'</td><td style="text-align:right">'+v.netReceipts+'</td><td style="text-align:right">0.00</td></tr>'})}else{htmlTbody.empty();htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="9" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.append(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},projectTypeInfo:function(code){if(code==1){return "计划"}else if(code==2){return "委托"}else if(code==3){return "选学"}else if(code==4){return "调训"}else{return ''}},getProjectInfo:function(){$yt_baseElement.showLoading();var selectParam="";$.ajax({async:true,url:$yt_option.base_path+"finance/projectStatement/getProjects",type:"post",data:{selectParam:selectParam},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){if(data.data&&data.data&&data.data.length>0){$.each(data.data,function(i,v){$("select.class-select").append($('<option value="'+v.projectCode+'">'+v.projectName+'</option>').data("classData",v))});$('select.class-select').niceSelect()}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败");$yt_baseElement.hideLoading()})}},})},getProjectStatementByProjectCode:function(projectCode,identifications){$.ajax({url:$yt_option.base_path+"finance/projectStatement/getProjectStatementByProjectCode",type:"post",data:{projectCode:projectCode,identifications:identifications},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){$.each(data.data,function(i,v){$(".company-tbody,.person-tbody").find('input[type="checkbox"]').each(function(j,n){if($(this).parents("tr").find("td").length<6){if($(this).val()==v.paymentValue&&v.paymentType=="1"){$(this).setCheckBoxState("check");$(this).addClass("statement-check")}}else{if($(this).val()==v.paymentValue&&v.paymentType=="2"){$(this).setCheckBoxState("check");$(this).addClass("statement-check")}}})})}else{$yt_alert_Model.alertOne("查询失败")}$yt_baseElement.hideLoading()}})},};$(function(){billListInfo.init()});