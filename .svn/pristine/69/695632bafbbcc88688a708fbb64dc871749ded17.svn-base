var elementaryStudentList={init:function(){$("select").niceSelect();$(".chose-year").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:true,dateFmt:"yyyy",callback:function(){elementaryStudentList.getElementaryStudentList()}});$(".date-birth").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:false,dateFmt:"yyyy-MM-dd",callback:function(){}});$(".party-date").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:false,dateFmt:"yyyy-MM",callback:function(){}});$(".work-time").calendar({speed:200,complement:true,readonly:true,lowerLimit:"NaN",nowData:false,dateFmt:"yyyy-MM",callback:function(){}});$(".addList").on('click',function(){$(".elementary-student-title").text("新增学员");elementaryStudentList.addElementaryStudentAlert();$("select.org-id").empty();$("select.org-id").niceSelect();$(".yt-model-sure-btn").off().click(function(){if($yt_valid.validForm($('body'))&&$("select.project-code").val()!=""&&$("select.group-id-elementary").val()!=""&&$("select.org-id").val()!=""){elementaryStudentList.addElementaryStudentList('')}else{elementaryStudentList.pageToScroll($('body .valid-font'));$yt_alert_Model.prompt("请将必填项填写完整")}})});var classList=elementaryStudentList.getListSelectClass();if(classList!=null){$.each(classList,function(i,n){if(n.type==3){$("select.project-code").append('<option value="'+n.projectCode+'" className="'+n.className+'">'+n.projectCode+'</option>')}})}var nationsList=elementaryStudentList.getListSelectNations();if(nationsList!=null){$.each(nationsList,function(i,n){$("select.nation-id").append('<option value="'+n.nationId+'">'+n.nationName+'</option>')})}var groupOnlyList=elementaryStudentList.getListSelectGroup("1");if(groupOnlyList!=null){$.each(groupOnlyList,function(i,n){$("select.group-id-elementary").append('<option value="'+n.groupId+'">'+n.groupName+'</option>')});$("select.group-id-elementary").off().change(function(){if($(this).val()!=''){$('div.group-id-elementary').removeClass('valid-hint');$(this).siblings('.valid-font').text('')}var groupList=elementaryStudentList.getListSelectGroup("2",$(this).val());if(groupList!=null){$("select.org-id").empty();$("select.org-id").append('<option value=" ">请选择</option>');$.each(groupList,function(i,n){if(i!=0){$("select.org-id").append('<option value="'+n.groupId+'">'+n.groupName+'</option>').data('types',n.types)}});$("select.org-id").niceSelect();$("select.org-id").off().change(function(){if($(this).val()!=''){$("div.org-id").removeClass('valid-hint');$(this).siblings('.valid-font').text('')}$('.orgType').text($(this).data('types'))})}})}$("select.group-id-elementary").niceSelect();$(".updateList").on('click',function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要修改的数据");return false}elementaryStudentList.getStudentInf();$(".elementary-student-title").text("修改学员");elementaryStudentList.addElementaryStudentAlert();$(".yt-model-sure-btn").off().click(function(){elementaryStudentList.addElementaryStudentList()})});$(".elementary-tbody").on('click','.real-name-alert-details',function(){elementaryStudentList.getStudentInf();elementaryStudentList.elementaryStudentDetailsAlert();$(".shut-down").click(function(){$(".elementary-student-details").hide()})});$(".delList").on('click',function(){var pkId="";$('.select-elementary-checkbox input[class="select-elementary-pkId"]:checked').each(function(){if(pkId==""){pkId=$(this).val()}else{pkId+=","+$(this).val()}});if(pkId==""){$yt_alert_Model.prompt("请选中一行数据进行操作",3000)}else{elementaryStudentList.delElementaryStudentList(pkId)}});$(".train-tbody").on('click',".real-name-inf",function(){window.location.href=$yt_option.base_path+"website/view/project/projectDetails.html?pkId="+$('.yt-table-active .pkId').val()});$("select.project-code").change(function(){var className=$("select.project-code option:selected").attr("className");$(".class-name").text(className);if($(this).val()!=''){$('div.project-code').removeClass('valid-hint');$(this).siblings('.valid-font').text('')}});$(".btn-effective").click(function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要修改的数据");return false}var remarks="有效";elementaryStudentList.effectiveInvalidElementaryList(remarks)});$(".btn-invalid").click(function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要修改的数据");return false}var remarks="无效";elementaryStudentList.effectiveInvalidElementaryList(remarks)});$(".export-student-btn").on("click",function(){var selectParam=$('.selectParam').val();var years=$('.chose-year').val();var downUrl=$yt_option.base_path+"class/trainee/downloadTraineeByYear";$.ajaxDownloadFile({url:downUrl,data:{selectParam:selectParam,years:years,isDownload:true}})});$(".check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".elementary-tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}});$('.search-btn').click(function(){elementaryStudentList.getElementaryStudentList()});elementaryStudentList.getElementaryStudentList();$(".leading-in").undelegate().delegate("input","change",function(){var me=$(this);var addFile=$(this).attr("id");var fileName=$(this).val().split('\\');var fm=fileName[fileName.length-1]});$('.set-principal-btn').on('click',function(){$(".batch-import-form").show();$yt_alert_Model.getDivPosition($(".batch-import-form"));$yt_model_drag.modelDragEvent($(".batch-import-form .yt-edit-alert-title"));$('.batch-import-form .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".batch-import-form").hide();$("#pop-modle-alert").hide()})});$('.batch-import-form .download-template').click(function(){var fileName="选学学员列表";$.ajaxDownloadFile({url:$yt_option.base_path+"class/trainee/downloadTraineeByClass",data:{fileName:fileName}})});$(".leading-in").undelegate().delegate("input","change",function(){var me=$(this);var addFile=$(this).attr("id");var fileName=$(this).val().split('\\');var fm=fileName[fileName.length-1];$('.batch-import-form .import-file-name').val(fm)});$('.batch-import-form .yt-model-sure-btn').off().on('click',function(){var projectCode=$('.list-table tbody input[type=checkbox]:checked').val();var addFile='fileName';var fm=$('.batch-import-form .import-file-name').val();var url=$yt_option.base_path+"class/trainee/leadingTraineeByClass";if(fm==""){$yt_alert_Model.prompt("请选择导入文件！")}else{$.ajaxFileUpload({url:url,type:"post",dataType:'json',fileElementId:addFile,data:{projectCode:projectCode},success:function(data,textStatus){$("#"+addFile).val("");$yt_alert_Model.prompt(data.message)},error:function(data,status,e){$yt_alert_Model.prompt("附件导入失败!!!!");$("#"+addFile).val("")}})}});$('.add-elementary-student').on('change','.nation-id',function(){if($(this).val()!=''){$('div.nation-id').removeClass('valid-hint');$(this).siblings('.valid-font').text('')}})},getListSelectGroup:function(isSelectGroup,groupId){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/group/getGroups",data:{isSelectGroup:isSelectGroup,groupId:groupId},async:false,success:function(data){list=data.data||[]}});return list},getStudentInf:function(){$yt_baseElement.showLoading();var traineeId=$('.yt-table-active .trainee-id').val();var projectId=$('.yt-table-active .project-id').val();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/getTraineeDetails",data:{traineeId:traineeId,projectId:projectId},success:function(data){if(data.flag==0){if(data.data.types==1){data.data.types="央企集团本部"}else if(data.data.types==2){data.data.types="央企二级公司"}else if(data.data.types==3){data.data.types="央企三级公司"}else if(data.data.types==4){data.data.types="省属企业"}else if(data.data.types==5){data.data.types="市属企业"}else if(data.data.types==6){data.data.types="其他"}if(data.data.checkInState==0){data.data.checkInState="未报到"}else if(data.data.checkInState==1){data.data.checkInState="已报到"}if(data.data.paymentState==0){data.data.paymentState="未对账"}else if(data.data.paymentState==1){data.data.paymentState="已对账"}if(data.data.isOrderNum==0){data.data.isOrderNum="未开票"}else if(data.data.isOrderNum==1){data.data.isOrderNum="已开票"}if(data.data.projectStates==1){data.data.projectStates="未开始"}else if(data.data.projectStates==2){data.data.projectStates="培训中"}else if(data.data.projectStates==3){data.data.projectStates="未结项"}else if(data.data.projectStates==4){data.data.projectStates="已结项"}if(data.data.remarks==""){data.data.remarks="有效"}$(".elementary-student-details").setDatas(data.data);$(".add-elementary-student").setDatas(data.data);$("select.project-code").setSelectVal(data.data.projectCode);$("select.nation-id").setSelectVal(String(data.data.nationId));$("select.project-states").setSelectVal(data.data.idType);$("select.group-id-elementary").setSelectVal(data.data.groupId);var groupList=elementaryStudentList.getListSelectGroup("2",$("select.group-id-elementary").val());if(groupList!=null){$("select.org-id").empty();$("select.org-id").append('<option value=" ">请选择</option>');$.each(groupList,function(i,n){if(i!=0){$("select.org-id").append('<option value="'+n.groupId+'">'+n.groupName+'</option>').data('types',n.types)}});$("select.org-id").niceSelect();$("select.org-id").setSelectVal(data.data.groupOrgId)}$('.orgType').text($("select.org-id").data('types'));$("select.id-type").setSelectVal(data.data.idType);if(data.data.gender=="1"){$("#radio1").setRadioState("check")}else if(data.data.gender=="2"){$("#radio2").setRadioState("check")};if($("span.gender").text()=="1"){$("span.gender").text("男")}else if($("span.gender").text()=="2"){$("span.gender").text("女")};var nationsList=elementaryStudentList.getListSelectNations();if(nationsList!=null){$.each(nationsList,function(i,n){if($("span.nation-id").text()==n.nationId){$("span.nation-id").text(n.nationName)}})};if($("span.id-type").text()==1){$("span.id-type").text("身份证")}else if($("span.id-type").text()==2){$("span.id-type").text("护照")}else if($("span.id-type").text()==3){$("span.id-type").text("军官证")}else if($("span.id-type").text()==4){$("span.id-type").text("其他")};var trainList=data.data.trainList;var htmlTbody=$(".train-list-tbody");var htmlTr="";$.each(trainList,function(i,v){htmlTr+='<tr><td style="text-align:center" class="project-code"><a style="color: #4169E1;" class="file-name">'+v.projectCode+'</td><td style="text-align:center" style="text-align:center">'+v.projectName+'</a></td><td style="text-align:center" class="project-head">'+v.startDate+'</td><td style="text-align:center" class="certificate-no">'+v.projectHead+'</td><td style="text-align:center" class="start-date">'+v.certificateNo+'</td></tr>'});htmlTbody.html(htmlTr);$yt_alert_Model.setFiexBoxHeight($(".elementary-student-details .alert-form"));$yt_baseElement.hideLoading()}else{$yt_alert_Model.prompt("获取失败");$yt_baseElement.hideLoading()}}})},getListSelectClass:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/getClasslist",data:{searchParameters:"",types:'4'},async:false,success:function(data){list=data.data||[]}});return list},getListSelectNations:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/getNations",data:{searchParameters:""},async:false,success:function(data){list=data.data||[]}});return list},getElementaryStudentList:function(){$yt_baseElement.showLoading();var selectParam=$(".selectParam").val();var years=$(".chose-year").val();$('.elementary-page').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/trainee/getClassTraineeByYear",type:"post",data:{selectParam:selectParam,years:years},objName:'data',success:function(data){if(data.flag==0){var htmlTbody=$('.list-table .elementary-tbody');var htmlTr='';var num=1;if(data.data.rows.length>0){$(htmlTbody).empty();$.each(data.data.rows,function(i,v){if(v.deptPosition==null){v.deptPosition=""}if(v.types==1){v.types="央企集团本部"}else if(v.types==2){v.types="央企二级公司"}else if(v.types==3){v.types="央企三级公司"}else if(v.types==4){v.types="省属企业"}else if(v.types==5){v.types="市属企业"}else if(v.types==6){v.types="其他"}if(v.gender==1){v.gender="男"}else if(v.gender==2){v.gender="女"}if(v.checkInState==0){v.checkInState="未报到"}else if(v.checkInState==1){v.checkInState="已报到"}if(v.projectStates==1){v.projectStates="未开始"}else if(v.projectStates==2){v.projectStates="培训中"}else if(v.projectStates==3){v.projectStates="未结项"}else if(v.projectStates==4){v.projectStates="已结项"}else if(v.projectStates==6){v.projectStates="未结项"}if(v.remarks==""){v.remarks="有效"}htmlTr='<tr><td style="width:26px;"><label style="margin-left:6px;" class="check-label yt-checkbox select-elementary-checkbox"><input type="checkbox" name="test" class="select-elementary-pkId" value="'+v.pkId+'"/></label></td><td><input type="hidden" class="trainee-id" value="'+v.traineeId+'"/>'+num++ +'</td><td class="project-code">'+v.projectCode+'</a></td><td style="text-align:left"><input type="hidden" class="project-id" value="'+v.projectId+'"/>'+v.groupName+'</td><td style="word-wrap:break-word;"><a style="color: #3c4687;" href="#" class="real-name-alert-details">'+v.realName+'</a></td><td>'+v.gender+'</td><td style="text-align:left">'+v.orgName+'</td><td>'+v.types+'</td><td>'+v.deptName+'</td><td>'+v.remarks+'</td><td>'+v.linkman+'</td><td>'+v.linkmanPhone+'</td><td>'+v.checkInState+'</td><td>'+v.projectStates+'</td></tr>';$(".elementary-page").show();htmlTbody.append($(htmlTr).data("legalData",v))})}else{$(".elementary-page").hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="14" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.html(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},addElementaryStudentList:function(){var me=this;$yt_baseElement.showLoading();var validFlag=$yt_valid.validForm($(".valid-tab"));if(validFlag){}else{}var traineeId=$('.projectTraineeId').text();var projectCode=$(".add-elementary-student select.project-code").val();var realName=$(".add-elementary-student .real-name").val();var gender=$(".add-elementary-student input[type='radio']:checked").val();var nationId=$(".add-elementary-student .nation-id").val();var phone=$(".add-elementary-student .phone").val();var idType=$(".add-elementary-student .id-type").val();var idNumber=$(".add-elementary-student .id-number").val();var dateBirth=$(".add-elementary-student .date-birth").val();var groupId=$(".add-elementary-student .group-id-elementary").val();var orgId=$(".add-elementary-student .org-id").val();var orgType=$("#orgType").val();var deptName=$(".add-elementary-student .dept-name").val();var mailingAddress=$(".add-elementary-student .mailing-address").val();var postalCode=$(".add-elementary-student .postal-code").val();var telephoneProject=$(".add-elementary-student .telephone-project").val();var fax=$(".add-elementary-student .fax").val();var email=$(".add-elementary-student .email").val();var partyDate=$(".add-elementary-student .party-date").val();var workTime=$(".add-elementary-student .work-time").val();var educationTime=$(".add-elementary-student .education-time").val();var educationTimeClass=$(".add-elementary-student .education-time-class").val();var serviceTime=$(".add-elementary-student .service-time").val();var serviceTimeClass=$(".add-elementary-student .service-time-class").val();var linkman=$(".add-elementary-student .linkman").val();var linkmanPhone=$(".add-elementary-student .linkman-phone").val();var linkmanTelephone=$(".add-elementary-student .linkman-telephone").val();var linkmanFax=$(".add-elementary-student .linkman-fax").val();var linkmanEmail=$(".add-elementary-student .linkman-email").val();var linkmanAddressEmail=$(".add-elementary-student .linkman-address-email").val();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/addOrUpdateTrainee",data:{projectCode:projectCode,realName:realName,gender:gender,nationId:nationId,phone:phone,idType:idType,idNumber:idNumber,dateBirth:dateBirth,groupId:groupId,orgId:orgId,orgType:orgType,deptName:deptName,mailingAddress:mailingAddress,postalCode:postalCode,telephoneProject:telephoneProject,fax:fax,email:email,partyDate:partyDate,workTime:workTime,educationTime:educationTime,educationTimeClass:educationTimeClass,serviceTime:serviceTime,serviceTimeClass:serviceTimeClass,linkman:linkman,linkmanPhone:linkmanPhone,linkmanTelephone:linkmanTelephone,linkmanFax:linkmanFax,linkmanEmail:linkmanEmail,linkmanAddressEmail:linkmanAddressEmail,traineeId:traineeId,groupNum:"",positionName:"",invoiceType:"",taxNumber:"",address:"",registeredBank:"",account:"",telephone:"",orgName:""},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading();$yt_alert_Model.prompt("操作成功");$('.elementary-page').pageInfo("refresh");$(".yt-edit-alert").hide()}else if(data.flag==5){$yt_baseElement.hideLoading();$yt_alert_Model.prompt(data.message);$(".yt-edit-alert").hide()}else{$yt_baseElement.hideLoading();$yt_alert_Model.prompt("操作失败");$(".yt-edit-alert").hide()}}})},addElementaryStudentAlert:function(){$(".add-elementary-student").show();$yt_alert_Model.getDivPosition($(".add-elementary-student"));$yt_alert_Model.setFiexBoxHeight($(".add-elementary-student .alert-form"));$yt_model_drag.modelDragEvent($(".add-elementary-student .yt-edit-alert-title"));elementaryStudentList.getEmpty();$('.add-elementary-student .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".add-elementary-student").hide();$("#pop-modle-alert").hide()})},elementaryStudentDetailsAlert:function(){$(".elementary-student-details").show();$yt_alert_Model.getDivPosition($(".elementary-student-details"));$yt_alert_Model.setFiexBoxHeight($(".elementary-student-details .alert-form"));$yt_model_drag.modelDragEvent($(".elementary-student-details .yt-edit-alert-title"));$('.elementary-student-details .yt-eidt-model-bottom .yt-model-canel-btn').off().on("click",function(){$(".elementary-student-details").hide();$("#pop-modle-alert").hide()})},delElementaryStudentList:function(){var projectCode=$('.yt-table-active .project-code').text();var traineeIds=$('.yt-table-active .trainee-id').val();$yt_alert_Model.alertOne({haveCloseIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/deleteTrainee",data:{projectCode:projectCode,traineeIds:traineeIds,projectId:""},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("删除成功");$('.elementary-page').pageInfo("refresh")}else{$yt_alert_Model.prompt("不能删除")}}})}})},effectiveInvalidElementaryList:function(remarks){var projectCode=$('.yt-table-active .project-code').text();var traineeId=$('.yt-table-active .trainee-id').val();$.ajax({type:"post",url:$yt_option.base_path+"class/trainee/updateClassTraineeRemarks",data:{projectCode:projectCode,traineeId:traineeId,remarks:remarks},success:function(data){if(data.flag==0){$yt_alert_Model.prompt("操作成功");$('.elementary-page').pageInfo("refresh")}else{$yt_alert_Model.prompt("操作失败")}}})},getEmpty:function(){$("add-elementary-student select");$("select.project-code").setSelectVal("");$("select.nation-id").setSelectVal("");$("select.id-type").setSelectVal("");$("select.group-id-elementary").setSelectVal("");$("select.org-id").setSelectVal("");$("select.org-type").setSelectVal("");$("select").niceSelect();$("span.class-name").text("");$('.add-elementary-student td>input').val("")},pageToScroll:function(validObj){var scrollTopVal=0;$(validObj).each(function(){if($(this).text()!=""){if($(window).scrollTop()&&($(this).eq(0).parent().offset().top<$(window).scrollTop()||$(this).eq(0).parent().offset().top>$(window).height())){scrollTopVal=$(this).eq(0).parents().offset().top-30;$(window).scrollTop(scrollTopVal)}return false}})}};$(function(){elementaryStudentList.init()});