var mal={initDate:function(){$(".body-div").css("min-height",$(window).height()-12);$("#startDate").calendar({controlId:"startTime",nowData:false,upperLimit:$("#endDate"),speed:0,callback:function(){}});$("#endDate").calendar({controlId:"endTime",nowData:false,lowerLimit:$("#startDate"),speed:0,callback:function(){}});mal.setAddselect();mal.moneyFormat();mal.getMyApplyList()},thisEvent:function(){$(".apply-search-btn").click(function(){mal.getMyApplyList()});$(".apply-reset-btn").click(function(){$(".apply-begin-date").val('');$(".apply-end-date").val('');$(".apply-reason-or-Id").val('');$(".apply-type").html('<option value="">请选择</option>');mal.setAddselect();$(".apply-type").niceSelect();$(".apply-begin-money").val('');$(".apply-end-money").val('');mal.getMyApplyList()});mal.toDetails();$(".plan-list-model").on('click','.process-state',function(){var processInstanceId=$(this).parents("tr").find(".processInstanceId").val();sysCommon.processStatePop(processInstanceId)})},setAddselect:function(thisData){var me=this;$.ajax({type:"post",data:{dictTypeCode:'APPLY_TYPE'},url:'basicconfig/dictInfo/getDictInfoByTypeCode',success:function(data){var datas=data.data;$.each(datas,function(i,n){var value=n.value;if(value!='CHANGE_APP'&&value!='FINAL_APP'){$('select.user-name-sel').append('<option value="'+n.value+'">'+n.disvalue+'</option>')}});$("select.user-name-sel").niceSelect()}})},moneyFormat:function(){$(".top-money,.bottom-money").on("focus",function(){if($(this).val()!=""){$(this).val($yt_baseElement.rmoney($(this).val()))}});$(".top-money,.bottom-money").on("blur",function(){if($(this).val()!=""){$(this).val($yt_baseElement.fmMoney($(this).val()))}})},getMyApplyList:function(){var me=this;var applyBgDate=$(".apply-begin-date").val();var applyEndDate=$(".apply-end-date").val();var applyReasonOrId=$(".apply-reason-or-Id").val();var applyType=$(".apply-type").val();var applyBgMoney="";if($(".apply-begin-money").val()){applyBgMoney=$yt_baseElement.rmoney($(".apply-begin-money").val())}var applyEndMoney="";if($(".apply-end-money").val()){applyEndMoney=$yt_baseElement.rmoney($(".apply-end-money").val())}$('.page1').pageInfo({pageIndex:1,pageNum:15,pageSize:10,url:"sz/applyApp/myApplicationAppInfo",type:"post",data:{startDate:applyBgDate,endDate:applyEndDate,queryParams:applyReasonOrId,formType:applyType,startAmount:applyBgMoney,endAmount:applyEndMoney,type:'expenditure'},objName:'data',success:function(data){var htmlTbody=$('.plan-list-model .yt-tbody.my-apply-list');htmlTbody.empty();var trStr="";if(data.flag==0){var datas=data.data.rows;if(datas.length>0){$('.page1').show();sysCommon.isWorkFlowStateStr=','+sysCommon.isWorkFlowStateStr+',';$.each(datas,function(i,n){trStr+='<tr><td>'+n.applicantTime+'</td><td><a class="yt-link to-detail">'+n.appNum+'</a><input type="hidden" class="hid-obj-id" value="'+n.pkId+'"/><input type="hidden" class="processInstanceId" value="'+n.processInstanceId+'"/><input type="hidden" class="hid-obj-type" value="'+n.formType+'"/></td><td style="text-align: left;">'+n.appName+'</td><td>'+n.formTypeName+'</td><td style="text-align: right;">'+$yt_baseElement.fmMoney(n.totalAmount)+'</td>';if(sysCommon.isWorkFlowStateStr.indexOf(','+n.workFlowState+',')==-1){trStr+='<td style="text-align: left;"><span class="yt-link process-state">'+n.nodeNowState+'</span></td>'}else{trStr+='<td style="text-align: left;">'+n.nodeNowState+'</td>'}trStr+='</tr>'});htmlTbody.append(trStr)}else{$('.page1').hide();htmlTbody.html('<tr style="border:0px;background-color:#fff !important;"><td  colspan="6" align="center"style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../../../../resources-sasac/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>')}}},isSelPageNum:true })},toDetails:function(){$('.plan-list-model .yt-tbody.my-apply-list').off("click").on('click','.yt-link.to-detail',function(){$yt_baseElement.eventStopPageaction();var processInstanceId=$(this).parents('tr').find('.processInstanceId').val();var objId=$(this).parents('tr').find('.hid-obj-id').val();var objType=$(this).parents('tr').find('.hid-obj-type').val();var pageUrl='';var goPageUrl='';if(objType=='ADVANCE_APP'){pageUrl="view/system-sasac/expensesReim/module/beforehand/beforeApplyDetail.html?advanceId="+objId;goPageUrl="view/system-sasac/expensesReim/module/approval/beforehandApproveList.html";}else if(objType=='REIM_APP'){pageUrl="view/system-sasac/expensesReim/module/reimApply/reimApplyDetail.html?processInstanceId="+processInstanceId+"&reimId="+objId;goPageUrl="view/system-sasac/expensesReim/module/reimApply/reimApproveList.html";}else if(objType=='PAYMENT_APP'){pageUrl="view/system-sasac/expensesReim/module/payment/paymentApplyDetail.html?processInstanceId="+processInstanceId+"&payAppId="+objId;goPageUrl="view/system-sasac/expensesReim/module/approval/paymentApprovalList.html";}else if(objType=='LOAN_APP'){pageUrl="view/system-sasac/expensesReim/module/loanApply/loanApplyDetail.html?processInstanceId="+processInstanceId+"&loanId="+objId;goPageUrl="view/system-sasac/expensesReim/module/approval/loanApprovalList.html";}else if(objType=='EXPENDITURE_APP'){var systemId=$yt_common.GetQueryString("systemId");var menuId=$yt_common.GetQueryString("menuId");pageUrl="view/system-sasac/expensesReim/module/reimApply/expenseDetail.html?appId="+objId+"&systemId="+systemId+"&menuId="+menuId;goPageUrl="view/system-sasac/expensesReim/module/approval/expenApplApprList.html";}else if(objType=='CHANGE_APP'){pageUrl="view/system-sasac/expensesReim/module/busiTripApply/projectServeDetails.html?advanceAppId="+objId;goPageUrl="view/system-sasac/expensesReim/module/approval/projectBefList.html";}$yt_baseElement.openNewPage(2,pageUrl)})}};$(function(){mal.initDate();mal.thisEvent()});