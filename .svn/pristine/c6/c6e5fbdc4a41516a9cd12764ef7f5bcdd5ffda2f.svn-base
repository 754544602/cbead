var addBorrowList={init:function(){$("select").niceSelect();var dealingWithPeople=addBorrowList.getListSelectDealingWithPeople();if(dealingWithPeople!=null){$.each(dealingWithPeople,function(i,n){$("select.dealing-with-people").append('<option value="'+n.userCode+'">'+n.userName+'</option>')});$("select.dealing-with-people").niceSelect()};$(".save-budget").click(function(){var applicationInvoice=$(".application-invoice").val();var invoiceOrg=$(".invoice-org").val();var invoiceType=$(".invoice-type").val();var orgName=$(".org-name").val();var taxNumber=$(".tax-number").val();var address=$(".address").val();var telephone=$(".telephone").val();var registeredBank=$(".registered-bank").val();var account=$(".account").val();$(".invoice-type-span").text("");if(applicationInvoice==""){$yt_valid.validForm($(".valid-tab"))}else if(invoiceOrg==""){$yt_valid.validForm($(".valid-tab"))}else if(invoiceType=="0"){$(".invoice-type-span").text("请选择发票类型")}else if(orgName==""){$yt_valid.validForm($(".valid-tab"))}else if(taxNumber==""){$yt_valid.validForm($(".valid-tab"))}else if(address==""){$yt_valid.validForm($(".valid-tab"))}else if(telephone==""){$yt_valid.validForm($(".valid-tab"))}else if(registeredBank==""){$yt_valid.validForm($(".valid-tab"))}else if(account==""){$yt_valid.validForm($(".valid-tab"))}else if(applicationInvoice==""){$yt_valid.validForm($(".valid-tab"))}if(invoiceOrg==""){$yt_alert_Model.prompt("请填写单位名称")}else if(invoiceType==0){$yt_alert_Model.prompt("请选择发票类型")}else{var projects=[];var projectCode="";$('.project-tbody').find('td.project-code').each(function(){projectCode=$(this).text();var projectsArr={projectCode:projectCode};projects.push(projectsArr)});var dataStates=1;var pkId=$yt_common.GetQueryString("pkId");addBorrowList.addBorrowListInfo(dataStates,projects,pkId)}});$(".submit-budget").click(function(){var applicationInvoice=$(".application-invoice").val();var invoiceOrg=$(".invoice-org").val();var invoiceType=$(".invoice-type").val();var orgName=$(".org-name").val();var taxNumber=$(".tax-number").val();var address=$(".address").val();var telephone=$(".telephone").val();var registeredBank=$(".registered-bank").val();var account=$(".account").val();$(".invoice-type-span").text("");if(applicationInvoice==""){$yt_valid.validForm($(".valid-tab"))}else if(invoiceOrg==""){$yt_valid.validForm($(".valid-tab"))}else if(invoiceType=="0"){$(".invoice-type-span").text("请选择发票类型")}else if(orgName==""){$yt_valid.validForm($(".valid-tab"))}else if(taxNumber==""){$yt_valid.validForm($(".valid-tab"))}else if(address==""){$yt_valid.validForm($(".valid-tab"))}else if(telephone==""){$yt_valid.validForm($(".valid-tab"))}else if(registeredBank==""){$yt_valid.validForm($(".valid-tab"))}else if(account==""){$yt_valid.validForm($(".valid-tab"))}else if(applicationInvoice==""){$yt_valid.validForm($(".valid-tab"))}var dealingWithPeople=$(".dealing-with-people").val();var invoiceType=$('.invoiceType').val();var invoiceOrg=$('.invoiceOrg').val();if(dealingWithPeople==0){$yt_alert_Model.prompt("请选择下一步操作人")}else if(invoiceOrg==""){$yt_alert_Model.prompt("请填写单位名称")}else if(invoiceType==0){$yt_alert_Model.prompt("请选择发票类型")}else{var projects=[];var projectCode="";$('.project-tbody').find('td.project-code').each(function(){projectCode=$(this).text();var projectsArr={projectCode:projectCode};projects.push(projectsArr)});var dataStates=2;debugger;var pkId=$yt_common.GetQueryString("pkId");addBorrowList.addBorrowListInfo(dataStates,projects,pkId)}});$(".btn-off").click(function(){var first="borrow";window.location.href="borrowList.html?first="+first;$('.reduce-list').hide();$('.borrow-list').show();$yt_baseElement.showLoading()});$(".borrow-select-btn").on("click",function(){addBorrowList.getProjectInfo()});$('.page-return-btn').on('click',function(){var first="borrow";window.location.href="borrowList.html?first="+first;$('.reduce-list').hide();$('.borrow-list').show();$yt_baseElement.showLoading()});$(".check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents("table").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".select-teacher-table tbody,.addBorrow-tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}});$('.borrow-search-btn').click(function(){var me=this;$(".select-teacher-div").show();addBorrowList.getProjectInfo();$yt_alert_Model.setFiexBoxHeight($(".select-teacher-div .yt-edit-alert-main"));$yt_alert_Model.getDivPosition($(".select-teacher-div"));$yt_model_drag.modelDragEvent($(".select-teacher-div .yt-edit-alert-title"));$('.select-teacher-sure-btn').click(function(){var addBorrowListArr=[];$('.addBorrow-tbody').find('label input[type="checkbox"]:checked').each(function(){var addBorrowList=$(this).parent().parent().parent().data('list');addBorrowListArr.push(addBorrowList)});var htmlTbody=$('.project-tbody');var htmlTr="";$.each(addBorrowListArr,function(i,v){htmlTr+='<tr><td class="project-code">'+v.projectCode+'</td><td style="text-align: left";>'+v.projectName+'</td><td class="project-type">'+(addBorrowList.projectTypeInfo(v.projectType))+'</td><td>'+v.projectHead+'</td><td>'+v.startDate+'</td><td>'+v.endDate+'</td></tr>'});$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide();htmlTbody.html(htmlTr)});$('.select-teacher-canel-btn').click(function(){$(".yt-edit-alert,#heard-nav-bak").hide();$("#pop-modle-alert").hide()})})},addBorrowListInfo:function(dataStates,projectArr,pkId){var applicationInvoice=$('.application-invoice').val();var invoiceOrg=$('.invoice-org').val();var invoiceType=$('.invoice-type').val();var orgName=$('.org-name').val();var taxNumber=$('.tax-number').val();var address=$('.address').val();var telephone=$('.telephone').val();var registeredBank=$('.registered-bank').val();var account=$('.account').val();var invoiceReason=$('.invoice-reason').val();var dealingWithPeople=$(".dealing-with-people").val();$.ajax({type:"post",url:$yt_option.base_path+"finance/invoicing/addOrUpdateBean",async:false,data:{pkId:pkId,applicationInvoice:applicationInvoice,invoiceOrg:invoiceOrg,invoiceType:invoiceType,orgName:orgName,taxNumber:taxNumber,address:address,telephone:telephone,registeredBank:registeredBank,account:account,invoiceReason:invoiceReason,"projects":JSON.stringify(projectArr),dataStates:dataStates,businessCode:"invoicing",dealingWithPeople:dealingWithPeople,opintion:"",processInstanceId:"",nextCode:"submited"},success:function(data){if(data.flag==0){var first="borrow";if(dataStates==1){$yt_alert_Model.prompt("新增成功");window.location.href="borrowList.html?first="+first}else if(dataStates==2){$yt_alert_Model.prompt("提交成功");window.location.href="borrowList.html?first="+first}}else{if(dataStates==1){$yt_alert_Model.prompt("新增失败")}else if(dataStates==2){$yt_alert_Model.prompt("提交失败")}}}})},projectCodeInfo:function(){$(".project-tbody").find('td.project-code').each(function(i,v){var lastProjectCode=$(this).text();$('.addBorrow-tbody').find('td.project-code').each(function(i,v){var firstProjectCode=$(this).text();if(firstProjectCode==lastProjectCode){$(this).parents("tr").find("td input[type='checkbox']").setCheckBoxState("check")}})})},projectTypeInfo:function(code){if(code==1){return "计划"}else if(code==2){return "委托"}else if(code==3){return "选学"}else if(code==4){return "调训"}else{return ''}},getProjectInfo:function(){var me=this;var selectParam=$('.borrow-search-input').val();$('.borrow-page').pageInfo({async:true,pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/invoicing/lookForAllProject",type:"post",data:{selectParam:selectParam,startDateStart:"",startDateEnd:"",endDateStart:"",endDateEnd:"",projectType:""},objName:'data',before:function(){$yt_baseElement.showLoading()},success:function(data){if(data.flag==0){var htmlTbody=$('.addBorrow-tbody');var htmlTr='';if(data.data.rows.length>0){htmlTbody.html("");$.each(data.data.rows,function(i,v){htmlTr='<tr><td style="text-align: center;"><label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test" class="select-teacher-pkId" value="'+v.projectCode+'"/></label></td><td style="text-align: center;" class="project-code">'+v.projectCode+'</td><td style="text-align: left;">'+v.projectName+'</td><td style="text-align: center;" class="project-type">'+(me.projectTypeInfo(v.projectType))+'</td><td style="text-align: center;">'+v.projectHead+'</td><td style="text-align: center;">'+v.startDate+'</td><td style="text-align: center;">'+v.endDate+'</td></tr>';htmlTr=$(htmlTr).data('list',v);htmlTbody.append(htmlTr)});addBorrowList.projectCodeInfo()}else{htmlTbody.html("");htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="7" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},getListSelectDealingWithPeople:function(){var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"invoicing",processInstanceId:"",parameters:"",versionNum:""},async:false,success:function(data){$.each(data.data,function(i,n){for(var k in n){list=n[k]}})}});return list}};$(function(){addBorrowList.init()});