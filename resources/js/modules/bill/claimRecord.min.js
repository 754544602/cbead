var claimRecord={init:function(){claimRecord.getBillListInfo("2");$(".search-btn").click(function(){claimRecord.getBillListInfo("2")});$(".check-box-load").on("change",function(){var isAdmission=[];if($('.check-sure input[type="checkbox"]').is(':checked')){isAdmission.push(1)}if($('.check-cancel input[type="checkbox"]').is(':checked')){isAdmission.push(0)}if(isAdmission.length==2){isAdmission='2'}else{isAdmission=isAdmission.join(',')}claimRecord.getBillListInfo(isAdmission)});$(".bank-more-div").on("click",function(){$yt_baseElement.showLoading();if($(".bank-more-div").text()=="查看更多"){if($(".payment-list").hasClass("hide")){}var width=parseInt($("#project-main").css("width"));var leftWidth=parseInt($(".bank-table-left").css('width'));$("#project-main").css("width",width+1260+"px");$(".bank-table-left").css("width",leftWidth+1260+'px');$(".bank-th-hide").show();$(".bank-more-div").text("收起");var colspan=$(".bank-tbody-td").attr("colspan");$(".bank-tbody-td").attr("colspan",colspan+11)}else{var width=parseInt($("#project-main").css("width"));var leftWidth=parseInt($(".bank-table-left").css('width'));$("#project-main").css("width",width-1260+"px");$(".bank-table-left").css("width",leftWidth-1260+'px');$(".bank-th-hide").hide();$(".bank-more-div").text("查看更多");var colspan=$(".bank-tbody-td").attr("colspan");$(".bank-tbody-td").attr("colspan",colspan-11)}$yt_baseElement.hideLoading()});$(".project-more-div").on("click",function(){$yt_baseElement.showLoading();if($(".project-more-div").text()=="查看更多"){var width=parseInt($("#project-main").css("width"));var rightWidth=parseInt($(".bank-table-right").css('width'));$("#project-main").css("width",width+360+"px");$(".bank-table-right").css("width",rightWidth+360+'px');$(".project-th-hide").show();$(".project-more-div").text("收起");var colspan=$(".bank-tbody-td").attr("colspan");$(".bank-tbody-td").attr("colspan",colspan+3)}else{var width=parseInt($("#project-main").css("width"));var rightWidth=parseInt($(".bank-table-right").css('width'));$(".bank-table-right").css("width",rightWidth-360+'px');$("#project-main").css("width",width-360+"px");$(".project-th-hide").hide();$(".project-more-div").text("查看更多");var colspan=$(".bank-tbody-td").attr("colspan");$(".bank-tbody-td").attr("colspan",colspan-3)}$yt_baseElement.hideLoading()});$(".check-all").change(function(){if($(this).parent().hasClass("check")){$(this).parents(".bank-table-left").find("tbody input[type='checkbox']").setCheckBoxState("uncheck")}else{$(this).parents(".bank-table-left").find("tbody input[type='checkbox']").setCheckBoxState("check")}});$(".project-tbody,.person-tbody,.company-tbody").on("change","input[type='checkbox']",function(){if($(this).parents("table").find("tbody input[type='checkbox']").length!=$(this).parents("table").find("tbody input[type='checkbox']:checked").length){$(this).parents("table").find(".check-all").setCheckBoxState("uncheck")}else{$(this).parents("table").find(".check-all").setCheckBoxState("check")}})},getBillListInfo:function(isAdmission){var me=this;var pkId=$yt_common.GetQueryString("pkId");$yt_baseElement.showLoading();$('.page-info').pageInfo({pageIndexs:1,pageNum:15,pageSize:10,url:$yt_option.base_path+"finance/bankStatement/getBankStatementDetailsList",type:"post",data:{pkId:pkId,isAdmission:isAdmission,isClaimUser:"1",isUserProject:"2"},success:function(data){setTimeout($yt_baseElement.hideLoading(),500);if(data.flag==0){var htmlLeftBody=$('.bank-table-left');var htmlRightBody=$('.bank-table-right');var htmlLeftTr='';var htmlRightTr='';var repetitionArr=[];var ordernum=0;htmlLeftBody.find('tbody').empty();htmlRightBody.find('tbody').empty();$.each($('table.leftTable'),function(x,y){$(y).remove()});$.each($('table.rightTable'),function(x,y){$(y).remove()});$('.num').text(data.data.rows.length);if(data.data.rows.length>0){$.each(data.data.rows,function(i,n){var bool=true;for(let j=0;j<repetitionArr.length;j+=1){if(i==repetitionArr[j]){bool=false}}if(bool==false){return true}ordernum+=1;var leftnum=0;var rightnum=0;var rightbool=true;htmlLeftBody.append('<table class="leftTable leftTable'+i+'" width="100%"><tbody class="yt-body project-tbody"></tbody></table>');htmlRightBody.append('<table class="rightTable rightTable'+i+'" width="100%"><tbody class="yt-body project-tbody"></tbody></table>');$.each(data.data.paymentList,function(k,v){if(n.identification==v.identification){rightbool=false;rightnum+=1;if(rightnum==1){htmlRightTr='<tr class="'+i+'">'+'<td width="190px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:center"><input class="identification-last" style="display:none;" value="'+v.identification+'">'+v.projectSell+'</td>'+'<td width="90px" class="project-th-righthide payment-list claimDate merge-last" style="display: none;text-align:center">'+v.claimDate+'</td>'+'<td width="137px" class="payment-list merge-last" style="text-align:left">'+v.projectName+'</td>'+'<td width="200px" class="payment-list merge-last" style="text-align:center">'+v.projectDate+'</td>'+'<td width="200px" class="payment-list merge-last" style="text-align:left">'+v.traineeOrGroupName+'</td>'+'<td width="200px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:left">'+v.orgName+'</td>'+'<td width="68px" class="payment-list merge-last uncollectedTotal" style="text-align:right;">'+v.uncollectedTotal+'</td>'+'<td width="67px" class="payment-list merge-last reconciliationsTotal rightTd'+i+'" style="text-align:right;">'+v.reconciliationsTotal+'</td>'+'<td width="70px" class="payment-list merge-last admissiontotal rightTd'+i+'" style="text-align:right;">'+v.admissiontotal+'</td>'+'<td width="90px" class="payment-list merge-last differencetotal rightTd'+i+'" style="text-align:right;">'+v.differencetotal+'</td>'+'<td width="60px" class="payment-list merge-last rightTd'+i+'" style="text-align:center;">'+(claimRecord.confirmFunc(v.reconciliationState))+'</td>'+'<td width="100px" class="payment-list merge-last rightTd'+i+'" style="text-align:center;">'+v.admissionConfirmUser+'</td></tr>';$('.rightTable'+i).find('tbody').append(htmlRightTr)}else{htmlRightTr='<tr class="'+i+'">'+'<td width="190px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:center;"><input class="identification-last" style="display:none;" value="'+v.identification+'">'+v.projectSell+'</td>'+'<td width="90px" class="project-th-righthide payment-list claimDate merge-last" style="display: none;text-align:center;">'+v.claimDate+'</td>'+'<td width="137px" class="payment-list merge-last" style="text-align:left;">'+v.projectName+'</td>'+'<td width="200px" class="payment-list merge-last" style="text-align:center;">'+v.projectDate+'</td>'+'<td width="200px" class="payment-list merge-last" style="text-align:left;">'+v.traineeOrGroupName+'</td>'+'<td width="200px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:left;">'+v.orgName+'</td>'+'<td width="68px" class="payment-list merge-last uncollectedTotal" style="text-align:right;">'+v.uncollectedTotal+'</td></tr>';$('.rightTable'+i).find('tbody').append(htmlRightTr)}}});$.each(data.data.rows,function(x,y){if(n.identification==y.identification&&n.identification!=''){repetitionArr.push(x);leftnum+=1;if(leftnum==1){htmlLeftTr='<tr class="'+i+'"><td width="30px" style="text-align: center;" class="merge leftTd'+i+'"><label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test"/></label></td><td width="31px" class="merge leftTd'+i+'" style = "text-align:center"><input class="identification-last" style="display:none;" value="'+y.identification+'">'+ordernum+'</td>'+'<td width="90px" class="merge" style = "text-align:center"><input type="text" name="test" style="display:none" class="pkId" value="'+y.pkId+'"/>'+y.exchangeHour+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+y.draw+'</td>'+'<td width="98px" class="merge income" style="text-align:right">'+y.income+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+y.balance+'</td>'+'<td width="60px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.currency+'</td>'+'<td style="text-align: left;" width="131px" class="otherPartyName merge">'+y.otherPartyName+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none"><input class="identification" style="display:none;" value="'+y.identification+'">'+y.otherPartyAccounts+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none;text-align: left;">'+y.otherPartyGroup+'</td>'+'<td width="80px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.accountDate+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none; text-align: left;">'+y.abstractData+'</td>'+'<td style="text-align: left;" width="116px" class="merge">'+y.remarks+'</td>'+'<td width="131px" class="merge">'+y.enterpriseTradeNumber+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none">'+y.voucherType+'</td>'+'<td width="77px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.voucherNo+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.associatedAccount+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none">'+y.alias+'</td>'+'<td width="160px" class="bank-th-hide merge" style="display:none">'+y.bankTradeNumber+'</td></tr>';htmlLeftTr=$(htmlLeftTr).data('data',y);$('.leftTable'+i).find('tbody').append(htmlLeftTr)}else{htmlLeftTr='<tr class="'+i+'">'+'<td width="90px" class="merge" style = "text-align:center"><input type="text" name="test" style="display:none" class="pkId" value="'+y.pkId+'"/>'+y.exchangeHour+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+y.draw+'</td>'+'<td width="98px" class="merge income" style="text-align:right">'+y.income+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+y.balance+'</td>'+'<td width="60px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.currency+'</td>'+'<td width="131px" class="otherPartyName merge" style = "text-align:left">'+y.otherPartyName+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none"><input class="identification" style="display:none;" value="'+y.identification+'">'+y.otherPartyAccounts+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none;text-align:left;">'+y.otherPartyGroup+'</td>'+'<td width="80px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.accountDate+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none;text-align:left;">'+y.abstractData+'</td>'+'<td style="text-align:left;" width="116px" class="merge">'+y.remarks+'</td>'+'<td width="131px" class="merge">'+y.enterpriseTradeNumber+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none">'+y.voucherType+'</td>'+'<td width="77px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.voucherNo+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none;text-align:center">'+y.associatedAccount+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none">'+y.alias+'</td>'+'<td width="160px" class="bank-th-hide merge" style="display:none">'+y.bankTradeNumber+'</td></tr>';htmlLeftTr=$(htmlLeftTr).data('data',y);$('.leftTable'+i).find('tbody').append(htmlLeftTr)}}});if(n.identification==''){leftnum=1;htmlLeftTr='<tr class="'+i+'"><td width="30px" style="text-align: center;" class="merge leftTd'+i+'"><label class="check-label yt-checkbox select-teacher-checkbox"><input type="checkbox" name="test"/></label></td><td width="31px" class="merge leftTd'+i+'" style = "text-align:center"><input class="identification-last" style="display:none;" value="'+n.identification+'">'+ordernum+'</td>'+'<td width="90px" class="merge" style = "text-align:center"><input type="text" name="test" style="display:none" class="pkId" value="'+n.pkId+'"/>'+n.exchangeHour+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+n.draw+'</td>'+'<td width="98px" class="merge income" style="text-align:right">'+n.income+'</td>'+'<td width="98px" class="bank-th-hide merge" style="text-align:right;display:none">'+n.balance+'</td>'+'<td width="60px" class="bank-th-hide merge" style="display:none;text-align:center">'+n.currency+'</td>'+'<td style="text-align:left;" width="131px" class="otherPartyName merge">'+n.otherPartyName+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none"><input class="identification" style="display:none;" value="'+n.identification+'">'+n.otherPartyAccounts+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none;text-align:left;">'+n.otherPartyGroup+'</td>'+'<td width="80px" class="bank-th-hide merge" style="display:none;text-align:center">'+n.accountDate+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none;text-align:left;">'+n.abstractData+'</td>'+'<td style="text-align:left;" width="116px" class="merge">'+n.remarks+'</td>'+'<td width="131px" class="merge">'+n.enterpriseTradeNumber+'</td>'+'<td width="116px" class="bank-th-hide merge" style="display:none">'+n.voucherType+'</td>'+'<td width="77px" class="bank-th-hide merge" style="display:none;text-align:center">'+n.voucherNo+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none;text-align:center">'+n.associatedAccount+'</td>'+'<td width="131px" class="bank-th-hide merge" style="display:none">'+n.alias+'</td>'+'<td width="160px" class="bank-th-hide merge" style="display:none;text-align:left;">'+n.bankTradeNumber+'</td></tr>';htmlLeftTr=$(htmlLeftTr).data('data',n);$('.leftTable'+i).find('tbody').append(htmlLeftTr)}if(rightbool){htmlRightTr='<tr class="'+i+'">'+'<td width="190px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:center"><span style="opacity:0">无</span></td>'+'<td width="90px" class="project-th-righthide payment-list claimDate merge-last" style="display: none;text-align:center"><span style="opacity:0">无</span></td>'+'<td width="137px" class="payment-list merge-last" style="text-align:left"><span style="opacity:0">无</span></td>'+'<td width="200px" class="payment-list merge-last" style="text-align:center"><span style="opacity:0">无</span></td>'+'<td width="200px" class="payment-list merge-last" style="text-align:left"><span style="opacity:0">无</span></td>'+'<td width="200px" class="project-th-righthide payment-list merge-last" style="display: none;text-align:left"><span style="opacity:0">无</span></td>'+'<td width="68px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>'+'<td width="67px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>'+'<td width="70px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>'+'<td width="90px" class="payment-list merge-last" style="text-align:right;"><span style="opacity:0">无</span></td>'+'<td width="60px" class="payment-list merge-last" style="text-align:center;"><span style="opacity:0">无</span></td>'+'<td width="100px" class="payment-list merge-last" style="text-align:center;"><span style="opacity:0">无</span></td></tr>';$('.rightTable'+i).find('tbody').append(htmlRightTr)}$('.leftTd'+i).attr('rowspan',leftnum);$('.rightTd'+i).attr('rowspan',rightnum);var tableHeight=0;$('.leftTable'+i).height()>$('.rightTable'+i).height()?tableHeight=$('.leftTable'+i).height():tableHeight=$('.rightTable'+i).height();$('.leftTable'+i).height()==$('.rightTable'+i).height()?tableHeight=$('.leftTable'+i).height():false;$('.leftTable'+i).css('height',tableHeight+'px');$('.rightTable'+i).css('height',tableHeight+'px');if($(".bank-more-div").text()=='收起'){htmlLeftBody.find('.bank-th-hide').show()}if($(".project-more-div").text()=='收起'){htmlRightBody.find('.project-th-righthide').show()}var uncollectedTotal=0;$.each($(".rightTable"+i).find('.uncollectedTotal'),function(i,n){uncollectedTotal+=Number($(n).text())});var income=0;$.each($(".leftTable"+i).find('.income'),function(i,n){income+=Number($(n).text())});$(".rightTable"+i).find('.reconciliationsTotal').text(uncollectedTotal);$(".rightTable"+i).find('.admissiontotal').text(income);$(".rightTable"+i).find('.differencetotal').text(income-uncollectedTotal)})}}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},confirmFunc:function(confirm){if(confirm==1){return "已入账"}else if(confirm==0){return "未入账"}},projectTypeInfo:function(code){if(code==1){return "计划"}else if(code==2){return "委托"}else if(code==3){return "选学"}else if(code==4){return "调训"}else{return ''}}};$(function(){claimRecord.init()});