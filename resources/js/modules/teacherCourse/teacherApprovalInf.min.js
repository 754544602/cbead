var teacherList={courseList:"",init:function(){$(".btn-return").click(function(){if(window.parent.document.getElementById("teacherName")==null){window.history.back()}else{$(window.parent.document.getElementById("teacherName")).hide();$(window.parent.document.getElementsByTagName("body")).css('overflow','auto')}});$('#opintion').off('keydown').on('keydown',function(){$('#opintion').blur()});teacherList.teacherProject();teacherList.getTeacherInf();$('.basicsStandardHalf,.floatStandardHalf,.customizedStandardHalf,.basicsStandardOne,.floatStandardOne,.customizedStandardOne').off('focus').on('focus',function(){$(this).val($yt_baseElement.rmoney($(this).val()))});$('.basicsStandardHalf').off('blur').on('blur',function(){$('.basicsStandardOne').val($yt_baseElement.fmMoney($(this).val()*2));$(this).val($yt_baseElement.fmMoney($(this).val()));allmoney('half')});$('.floatStandardHalf').off('blur').on('blur',function(){$('.floatStandardOne').val($yt_baseElement.fmMoney($(this).val()*2));$(this).val($yt_baseElement.fmMoney($(this).val()));allmoney('half')});$('.customizedStandardHalf').off('blur').on('blur',function(){$('.customizedStandardOne').val($yt_baseElement.fmMoney($(this).val()*2));$(this).val($yt_baseElement.fmMoney($(this).val()));allmoney('half')});$('.basicsStandardOne,.floatStandardOne,.customizedStandardOne').off('blur').on('blur',function(){$(this).val($yt_baseElement.fmMoney($(this).val()));allmoney('one')});function allmoney(type){var half=$yt_baseElement.rmoney($('.basicsStandardHalf').val())+$yt_baseElement.rmoney($('.floatStandardHalf').val())+$yt_baseElement.rmoney($('.customizedStandardHalf').val());var one=$yt_baseElement.rmoney($('.basicsStandardOne').val())+$yt_baseElement.rmoney($('.floatStandardOne').val())+$yt_baseElement.rmoney($('.customizedStandardOne').val());if(type=='half'){$('.teacherMoneyHalf').text($yt_baseElement.fmMoney(half));$('.teacherMoneyOne').text($yt_baseElement.fmMoney(one))}else if(type=='one'){$('.teacherMoneyOne').text($yt_baseElement.fmMoney(one))}}$('#last-submit').click(function(){var teacherId=$yt_common.GetQueryString('pkId');var processInstanceId=$yt_common.GetQueryString('processInstanceId');var dealingWithPeople=$('#nextPeople').val();var opintion=$('#opintion').val();var nextCode=$('input[name="radioType"]:checked ').val();var tastKey=$('#taskKey').val();if(nextCode=="returnedSubmit"||tastKey=="activitiEndTask"){dealingWithPeople=""}if(dealingWithPeople=="no"){$yt_alert_Model.prompt("请选择下一步操作人！",3000)}else{$.ajax({type:"post",url:$yt_option.base_path+"teacher/updateApply",async:false,data:{teacherId:teacherId,businessCode:"teacher",processInstanceId:processInstanceId,dealingWithPeople:dealingWithPeople,opintion:opintion,nextCode:nextCode},success:function(data){if(data.flag==0){window.history.back()}else{$yt_alert_Model.prompt("审批提交失败!",3000)}}})}});$('#last-cancel').click(function(){window.history.back()})},teacherApproveNew:function(dataStates){var me=this;$.ajax({type:"post",url:$yt_option.base_path+"teacher/addOrApprovalTeacherNew",async:true,beforeSend:function(){},data:{dataStates:dataStates,teacherId:$yt_common.GetQueryString('pkId'),dollarsStandardHalf:me.teacherData.dollarsStandardHalf,dollarsStandardOne:me.teacherData.dollarsStandardOne,projectCode:$('.teacherProjectCode').val(),courseId:$('.teacherCourse').val(),dollarsStandardType:$('input[name=moneyType]:checked').val(),basicsStandardHalf:$yt_baseElement.rmoney($('.basicsStandardHalf').val()),basicsStandardOne:$yt_baseElement.rmoney($('.basicsStandardOne').val()),floatStandardHalf:$yt_baseElement.rmoney($('.floatStandardHalf').val()),floatStandardOne:$yt_baseElement.rmoney($('.floatStandardOne').val()),customizedStandardHalf:$yt_baseElement.rmoney($('.customizedStandardHalf').val()),customizedStandardOne:$yt_baseElement.rmoney($('.customizedStandardOne').val()),businessCode:'teacher',dealingWithPeople:$("#nextPeople").val(),opintion:$('#opintion').val(),processInstanceId:$yt_common.GetQueryString('processInstanceId'),nextCode:'submited'},success:function(data){if(data.flag==0){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt('提交成功');window.history.back()})}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt('提交失败')})}},error:function(){$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt('网络异常，提交失败')})}})},teacherData:'',getTeacherInf:function(){var me=this;var urls;if(window.parent.document.getElementById("teacherName")==null){urls='teacher/getTeacherBeanByIdByApproval';var processInstanceId=$yt_common.GetQueryString('processInstanceId')}else{urls='finance/teacherExpense/getTeacherBeanByTeacherExpense'}var pkId=$yt_common.GetQueryString('pkId');var backPage=$yt_common.GetQueryString('backPage');var indexNum=$yt_common.GetQueryString('indexNum');$.ajax({type:"post",url:$yt_option.base_path+urls,data:{pkId:pkId,processInstanceId:processInstanceId},async:true,success:function(data){if(data.flag==0){var tastKey;if(data.data.dollarsStandardType==1){data.data.dollarsStandardTypeVal='长期课酬'}else if(data.data.dollarsStandardType==2){data.data.dollarsStandardTypeVal='并行课酬'}else if(data.data.dollarsStandardType==3){data.data.dollarsStandardTypeVal='单次课酬'}data.data.basicsStandardHalfVal=$yt_baseElement.fmMoney(data.data.basicsStandardHalf);data.data.basicsStandardOneVal=$yt_baseElement.fmMoney(data.data.basicsStandardOne);data.data.floatStandardHalfVal=$yt_baseElement.fmMoney(data.data.floatStandardHalf);data.data.floatStandardOneVal=$yt_baseElement.fmMoney(data.data.floatStandardOne);data.data.customizedStandardHalfVal=$yt_baseElement.fmMoney(data.data.customizedStandardHalf);data.data.customizedStandardOneVal=$yt_baseElement.fmMoney(data.data.customizedStandardOne);data.data.dollarsStandardHalfVal=$yt_baseElement.fmMoney(Number(data.data.basicsStandardHalf)+Number(data.data.floatStandardHalf)+Number(data.data.customizedStandardHalf));data.data.dollarsStandardOneVal=$yt_baseElement.fmMoney(Number(data.data.basicsStandardOne)+Number(data.data.floatStandardOne)+Number(data.data.customizedStandardOne));data.data.deptName=data.data.org+data.data.title;$(".box-list").setDatas(data.data);$('.teacherProjectCode').setSelectVal(data.data.projectCode);me.teacherProjectCourse(data.data.projectCode);$('.teacherCourse').setSelectVal(data.data.courseId);me.teacherData=data.data;$('input[name=moneyType][value='+data.data.dollarsStandardType+']').setRadioState('check');if(data.data.flowLog!=""){$(".approve-content-box").show();var flowLog=$.parseJSON(data.data.flowLog);var middleStepHtml;var length=flowLog.length;$(".middle-box").remove();$.each(flowLog,function(i,v){if(i==0){if(v.tastKey=="activitiStartTask"){tastKey='activitiStartTask'}if(v.tastKey=="activitiEndTask"){$(".next-operate-person-tr").hide();if(v.deleteReason!=''||backPage!=2){$(".btn-box").hide();$('.last-box').hide();var order=length-i;middleStepHtml='<div class="middle-box"><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+v.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+v.operationState+'</span></li><li class="view-time-li middle-step-commentTime" style="text-align:right;">'+v.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment">'+v.comment+'</div></li></ul></div></div>';$('.last-step').append(middleStepHtml)}}else if((v.tastKey=="activitiStartTask"&&indexNum=="2")||backPage!=2){$(".btn-box").hide();$('.last-box').hide();var order=length-i;middleStepHtml='<div class="middle-box"><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+v.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+v.operationState+'</span></li><li class="view-time-li middle-step-commentTime" style="text-align:right;">'+v.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment">'+v.comment+'</div></li></ul></div></div>';$('.last-step').append(middleStepHtml)}$('#taskKey').val(v.tastKey);$('.last-step-order').text(length);$('.last-step-operate-person-userName').text(v.userName);$('.last-step-operationState').text(v.operationState);$('.last-step-commentTime').text(v.commentTime)};if(i==length-1){$('.first-step-order').text(1);$('.first-step-operate-person-userName').text(v.userName);$('.first-step-taskName').text(v.operationState);$('.first-step-commentTime').text(v.commentTime);$(".first-step-comment").text(v.comment)};if(i!=0&&i<length-1){var order=length-i;middleStepHtml='<div class="middle-box"><div style="height: 150; "><div class="number-name-box"><span class="number-box-span middle-step-order middle-a-index" >'+order+'</span><span class="name-box-span middle-step-userName middle-a-index" >'+v.userName+'</span><img src="../../resources/images/open/openFlow.png" class="order-img" /></div></div><div class="middle-step-box-div"><ul class="middle-step-box-ul"><li style="height: 30px;"><span  class="middle-step-taskName view-taskName-span"  style="float: left;">'+v.operationState+'</span></li><li class="view-time-li middle-step-commentTime"  style="text-align:right;">'+v.commentTime+'</li><li class="operate-view-box-li"><div class="operate-view-title-li">操作意见：</div><div class="operate-view-text-li middle-step-comment">'+v.comment+'</div></li></ul></div></div>';$('.last-step').append(middleStepHtml)}})};var showBox='';$.each(data.data.dollarsStandardHis,function(i,n){if(n.dataStates==1){showBox+='<div class="tip-box"><table class="tip-table"><tr><td class="tip-lable">变更时间：</td><td>'+n.updateTimeString+'</td></tr><tr><td class="tip-lable">课酬标准：</td><td>'+n.dollarsStandardHalfBefore+'元/半天</td></tr><tr><td class="tip-lable"></td><td>'+n.dollarsStandardOneBefore+'元/天</td></tr><tr><td class="tip-lable">审批状态：</td><td>'+n.workFlawState+'</td></tr></table></div>'}else if(n.dataStates==2){showBox+='<div class="tip-box"><table class="tip-table"><tr style="border-top: 1px dashed #ffffff;"><td class="tip-lable">变更时间：</td><td>'+n.updateTimeString+'</td></tr><tr><td class="tip-lable">课酬标准：</td><td>'+n.dollarsStandardHalfBefore+'元/半天</td></tr><tr><td class="tip-lable"></td><td>'+n.dollarsStandardOneBefore+'元/天</td></tr><tr><td class="tip-lable">变更原因：</td><td>'+n.changeReason+'</td></tr><tr><td class="tip-lable">审批状态：</td><td>'+n.workFlawState+'</td></tr></table></div>'}});if(data.data.dollarsStandardHis.length==0){showBox+='<tr><td class="tip-lable">无变更记录</td></tr>'}showBox+='';$('.changeRecord').tooltip({position:'right',content:function(){return showBox},onShow:function(){$(this).tooltip('tip').css({backgroundColor:'#666',borderColor:'#666',color:'#fff'})}});var nextPersonList=teacherList.getworkFlowOperate();if(nextPersonList!=null){$("#nextPeople").empty();$("#nextPeople").append('<option value="no">请选择下一步操作人</option>');$.each(nextPersonList,function(g,p){$("#nextPeople").append('<option value="'+p.userCode+'">'+p.userName+'</option>')})};$("#nextPeople").niceSelect();if(tastKey=='activitiStartTask'){$('.dollarsApproveTableDetail').hide();$('.dollarsApproveTable').show();$(".btn-box").show();$('.last-box').show();$('.middle-box').eq(0).hide();$('.agree-disagree').parents('tr').hide();$('#last-submit').attr('id','lastsub');$('#lastsub').click(function(){if($yt_valid.validForm($(".dollarsApproveTable"))){if($('#nextPeople').val()=='no'){$yt_alert_Model.prompt('请选择下一步操作人')}else{teacherList.teacherApproveNew(data.data.dataStates)}}else{$yt_alert_Model.prompt('请补全信息')}})}}else{$yt_alert_Model.prompt(data.message);}}})},getworkFlowOperate:function(){var processInstanceId=$yt_common.GetQueryString('processInstanceId');var list=[];$.ajax({type:"post",url:$yt_option.base_path+"uniform/workFlowOperate/getSubmitPageData",data:{businessCode:"teacher",processInstanceId:processInstanceId},async:false,success:function(data){if(data.data!=null){$.each(data.data,function(i,n){for(var k in n){list=n[k]}})}}});return list},teacherProject:function(){var me=this;$.ajax({type:"post",url:$yt_option.base_path+"teacher/lookForAllProjectByDollarsStandard",async:true,data:{selectParam:'',pkId:$yt_common.GetQueryString("pkId")},beforeSend:function(){},success:function(data){if(data.flag==0){$('select.teacherProjectCode').empty();$('select.teacherProjectCode').append('<option value="">请选择</option>');$.each(data.data,function(i,n){$('select.teacherProjectCode').append('<option value="'+n.projectCode+'">'+n.projectName+'</option>')});$('select.teacherProjectCode').niceSelect({search:true,backFunction:function(text){$('select.teacherProjectCode option').remove();if(text==""){$('select.teacherProjectCode').append('<option value="">请选择</option>')}$.each(data.data,function(i,n){if(n.projectName.indexOf(text)!=-1){$('select.teacherProjectCode').append('<option value="'+n.projectCode+'">'+n.projectName+'</option>')}})}});$('select.teacherCourse').niceSelect();$('.teacherProjectCode').off('change').on('change',function(){if($(this).val()==''){$('select.teacherCourse').empty();$('select.teacherCourse').append('<option value="">请选择</option>');$('select.teacherCourse').niceSelect()}else{$('.teacherProjectCode').removeClass('valid-hint');me.teacherProjectCourse($(this).val())}})}else{}},error:function(){}})},teacherProjectCourse:function(projectCode){$.ajax({type:"post",url:$yt_option.base_path+"teacher/lookForAllCourseByProject",async:false,data:{selectParam:'',projectCode:projectCode,teacherId:$yt_common.GetQueryString('pkId')},beforeSend:function(){},success:function(data){if(data.flag==0){$('select.teacherCourse').empty();$('select.teacherCourse').append('<option value="">请选择</option>');$.each(data.data,function(i,n){$('select.teacherCourse').append('<option value="'+n.courseId+'">'+n.courseName+'</option>')});$('select.teacherCourse').niceSelect();$('.teacherCourse').off('change').on('change',function(){if($(this).val()!=''){$('.teacherCourse').removeClass('valid-hint')}})}else{}},error:function(){}})},pageToScroll:function(validObj){var scrollTopVal=0;$(validObj).each(function(){if($(this).text()!=""){if($(window).scrollTop()&&($(this).eq(0).parent().offset().top<$(window).scrollTop()||$(this).eq(0).parent().offset().top>$(window).height())){scrollTopVal=$(this).eq(0).parents().offset().top-30;$(window).scrollTop(scrollTopVal)}return false}})}};$(function(){teacherList.init()});