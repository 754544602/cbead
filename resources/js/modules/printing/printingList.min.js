var printingList={init:function(){printingList.getprintingListInfo();$('.search-select-states').niceSelect();$('.search-select-states').change(function(){printingList.getprintingListInfo($(this).val())});$('.search-btn').click(function(){printingList.getprintingListInfo()});$(".btn-invalid").click(function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}if($(".yt-table-active .states-input").val()!=4&&$(".yt-table-active .states-input").val()!=2){var states=4;printingList.amendPrintingStates(states);$yt_alert_Model.prompt("已作废")}else{$yt_alert_Model.prompt("请选择等待打印的文件进行作废")}if($(".yt-table-active .states-input").val()!=4&&$(".yt-table-active .states-input").val()==2){$yt_alert_Model.prompt("该文件已经打印,无法作废")}});$(".btn-restore").click(function(){if($("tr.yt-table-active").length==0){$yt_alert_Model.prompt("请选择要操作的数据");return false}if($(".yt-table-active .states-input").val()==4){var states=3;printingList.amendPrintingStates(states);$yt_alert_Model.prompt("已恢复")}else{$yt_alert_Model.prompt("请选择作废文件进行恢复")}});$(".printing-tbody").on('click','.file-name',function(){sessionStorage.setItem("searchParams",$('#keyword').val());sessionStorage.setItem("pageIndexs",$('.num-text.active').text());window.location.href="printingDetails.html?pkId="+$('.yt-table-active .pkId').val()})},getprintingListInfo:function(printingStates){sessionStorage.getItem("searchParams")?$('#keyword').val(sessionStorage.getItem("searchParams")):'';var searchParameters=$('#keyword').val();$('.printing-page').pageInfo({pageIndexs:sessionStorage.getItem("pageIndexs")?sessionStorage.getItem("pageIndexs"):1,pageNum:15,pageSize:10,url:$yt_option.base_path+"class/printing/lookForAll",type:"post",data:{searchParameters:searchParameters,printingStates:printingStates,startTime:"",endTime:"",createTimeStart:"",createTimeEnd:""},async:true,before:function(){$yt_baseElement.showLoading()},objName:'data',success:function(data){sessionStorage.clear();if(data.flag==0){var htmlTbody=$('.printing-tbody');var htmlTr='';var num=1;if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){if(v.fileName==null){v.fileName=""}if(v.projectCode==null){v.projectCode=""}if(v.projectName==null){v.projectName=""}if(v.projectUserName=="null"){v.projectUserName=""}if(v.startDate==null){v.startDate=""}if(v.endDate==null){v.endDate=""}v.startDate=v.startDate.split(" ")[0];v.endDate=v.endDate.split(" ")[0];htmlTr+='<tr><td><input type="hidden" value="'+v.pkId+'" class="pkId">'+num++ +'</td><td style="text-align: left;color:#3c4687 !important;"><a style="color:#3c4687;" class="file-name">'+v.fileName+'</a></td><td >'+v.createUserName+'</td><td>'+v.createTimeString+'</td><td class="text-overflow"">'+v.projectCode+'</td><td class="text-overflow" style="text-align: left;">'+v.projectName+'</td><td style="text-align: left;">'+v.projectUserName+'</td><td>'+v.startDate+'</td><td>'+v.endDate+'</td><td><input type="hidden" value="'+v.states+'" class="states-input">'+(v.states==1?"打印中":(v.states==2?"已完成":(v.states==3?"等待打印":"已作废")))+'</td></tr>';$(".printing-page").show()})}else{$(".printing-page").hide();htmlTr+='<tr style="border:0px;background-color:#fff !important;" ><td colspan="10" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>'}htmlTbody.html(htmlTr);$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},amendPrintingStates:function(states){var pkId=$(".yt-table-active .pkId").val();$.ajax({type:"post",url:$yt_option.base_path+"class/printing/updatePrinting",data:{pkId:pkId,states:states},success:function(data){if(data.flag==0){$('.printing-page').pageInfo("refresh")}else{$yt_alert_Model.prompt("操作失败")}}})}};$(function(){printingList.init()});