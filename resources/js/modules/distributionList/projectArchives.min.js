var projectArchivesInfo={init:function(){$(".search-startDate").calendar({controlId:"startDates",nowData:true,dateFmt:"yyyy-MM",callback:function(){if(new Date($(".search-endDate").val())<new Date($(".search-startDate").val())){$(".search-endDate").val($(".search-startDate").val())}projectArchivesInfo.getPlanListInfo()}});$(".search-endDate").calendar({controlId:"endDates",nowData:true,dateFmt:"yyyy-MM",callback:function(){if(new Date($(".search-endDate").val())<new Date($(".search-startDate").val())){$(".search-startDate").val($(".search-endDate").val())}projectArchivesInfo.getPlanListInfo()}});sessionStorage.getItem("startDate")?$('.search-startDate').val(sessionStorage.getItem("startDate")):'';sessionStorage.getItem("endDate")?$('.search-endDate').val(sessionStorage.getItem("endDate")):'';projectArchivesInfo.getPlanListInfo();$('.key-word').off().on('click','.search-btn',function(){projectArchivesInfo.getPlanListInfo()});$('.list-table .yt-tbody').on("click","a.pk-id",function(){var pkId=$(this).parent().find("input.pk-id").val();var className=$(this).parent().find(".yt-link").text();sessionStorage.setItem("startDate",$(".search-startDate").val());sessionStorage.setItem("endDate",$(".search-endDate").val());sessionStorage.setItem("searchParams",$('#keyword').val());sessionStorage.setItem("pageIndexs",$('.list-page .num-text.active').text());var dataArchiving=encodeURI("dataArchiving.html?className="+className+"&pkId="+pkId);window.location.href=dataArchiving});$(".urge-btn").click(function(){projectArchivesInfo.urgeFn()})},urgeFn:function(){var checkLen=$(".open-class-tbody").find(".yt-table-active").length;if(checkLen==0){$yt_alert_Model.prompt("请选中要催办的数据！")}else{var projectCode=$(".yt-table-active").find(".project-code").text();$.ajax({type:"post",url:$yt_option.base_path+"project/toProjectFileUrge",data:{projectCode:projectCode},async:false,success:function(data){if(data.flag==0){$yt_alert_Model.prompt("操作成功！")}}})}},getPlanListInfo:function(){sessionStorage.getItem("searchParams")?$('#keyword').val(sessionStorage.getItem("searchParams")):'';var keyword=$('#keyword').val();$('.page-info').pageInfo({pageIndexs:sessionStorage.getItem("pageIndexs")?sessionStorage.getItem("pageIndexs"):1,pageNum:15,pageSize:10,url:$yt_option.base_path+"project/lookForAllByProjectArchives",type:"post",data:{selectParam:keyword,selectProjectStart:$('.search-startDate').val(),selectProjectEnd:$('.search-endDate').val()},async:true,before:function(){$yt_baseElement.showLoading()},objName:'data',success:function(data){sessionStorage.clear();if(data.flag==0){var htmlTbody=$('.list-table .yt-tbody');var htmlTr='';var num=1;htmlTbody.empty();if(data.data.rows.length>0){$('.page-info').show();var states;var projectStates;$.each(data.data.rows,function(i,v){htmlTr='<tr><td class="project-code">'+v.projectCode+'</td><td style="text-align:left"><a style="color:#3c4687;" class="pk-id yt-link" href="#">'+v.projectName+'</a><input style="display:none" class="pk-id" value="'+v.pkId+'"/></td><td class="project-type">'+(projectArchivesInfo.projectTypeInfo(v.projectType))+'</td><td class="distribution-date">'+v.startDate+'</td><td class="distribution-date">'+v.endDate+'</td><td class="project-head">'+v.projectSell+'</td><td class="project-head">'+v.projectHead+'</td><td class="distribution-user">'+v.unarchivedItem+'</td></tr>';htmlTbody.append(htmlTr)})}else{$('.page-info').hide();htmlTr='<tr><td colspan="8" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},projectTypeInfo:function(code){if(code==1){return "计划"}else if(code==2){return "委托"}else if(code==3){return "选学"}else if(code==4){return "中组部调训"}else if(code==5){return "国资委调训"}else{return ''}}};$(function(){projectArchivesInfo.init()});