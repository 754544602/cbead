var noSetProjectList={init:function(){$(".search-startDate").calendar({controlId:"startDates",nowData:true,dateFmt:"yyyy-MM",callback:function(){if(new Date($(".search-endDate").val())<new Date($(".search-startDate").val())){$(".search-endDate").val($(".search-startDate").val())}noSetProjectList.getNoProjectApprovalList()}});$(".search-endDate").calendar({controlId:"endDates",nowData:true,dateFmt:"yyyy-MM",callback:function(){if(new Date($(".search-endDate").val())<new Date($(".search-startDate").val())){$(".search-startDate").val($(".search-endDate").val())}noSetProjectList.getNoProjectApprovalList()}});sessionStorage.getItem("startDate")?$('.search-startDate').val(sessionStorage.getItem("startDate")):'';sessionStorage.getItem("endDate")?$('.search-endDate').val(sessionStorage.getItem("endDate")):'';noSetProjectList.getNoProjectApprovalList();$('.search-btn').click(function(){$(".search-box .project-types").setSelectVal('');noSetProjectList.getNoProjectApprovalList()});noSetProjectList.hideSearch();$(".noSetProject-tbody").on('click',".file-name",function(){var pkId=$('.yt-table-active .pkId').val();var projectCode=$('.yt-table-active .project-code-list').val();var projectState=$(this).parents('tr').find(".project-state-step").val();var projectType=$(this).parents('tr').data('data').projectType;sessionStorage.setItem("startDate",$(".search-startDate").val());sessionStorage.setItem("endDate",$(".search-endDate").val());sessionStorage.setItem("searchParams",$('.selectParam').val());sessionStorage.setItem("pageIndexs",$('.num-text.active').text());window.location.href="/cbead/website/view/project/projectDetails.html?pkId="+pkId+"&tp="+1+"&history=noSetProjectList&projectCode="+projectCode+'&projectState='+projectState+"&projectType="+projectType+"&approve="+1})},getNoProjectApprovalList:function(){sessionStorage.getItem("searchParams")?$('.selectParam').val(sessionStorage.getItem("searchParams")):'';var selectParam=$(".select-param").val();var years=$(".search-startDate").val().split('-')[0];var projectType=$(".search-box .project-types").val();$('.noSetProject-page').pageInfo({pageIndexs:sessionStorage.getItem("pageIndexs")?sessionStorage.getItem("pageIndexs"):1,pageNum:15,pageSize:10,url:$yt_option.base_path+"project/lookForAllByProjectNoPass",type:"post",data:{selectParam:selectParam,years:years,projectType:projectType,selectProjectStart:$('.search-startDate').val(),selectProjectEnd:$('.search-endDate').val()},objName:'data',async:true,before:function(){$yt_baseElement.showLoading()},success:function(data){sessionStorage.clear();if(data.flag==0){var htmlTbody=$('.noSetProject-tbody').empty();var htmlTr='';if(data.data.rows.length>0){$.each(data.data.rows,function(i,v){if(v.projectType==2){v.projectTypeVal="委托"}else if(v.projectType==3){v.projectTypeVal="选学"}else if(v.projectType==4){v.projectTypeVal="中组部调训"}else if(v.projectType==5){v.projectTypeVal="国资委调训"}if(v.projectStates==1){v.projectStatesVal="初定意向"}else if(v.projectStates==2){v.projectStatesVal="审批中"}else if(v.projectStates==3){v.projectStatesVal="未通过"}else if(v.projectStates==4){v.projectStatesVal="已取消"}else{v.projectStatesVal=""}htmlTr='<tr><td style="width:50px;word-wrap:break-word;"><input type="hidden" value="'+v.pkId+'" class="pkId">'+(i+1)+'</td><td style="text-align:left"><a style="color:#3c4687;" class="file-name"><input type="hidden" value="'+v.projectCode+'" class="project-code-list">'+v.projectName+'</a></td><td>'+v.projectTypeVal+'</td><td>'+v.startDate+'</td><td style="text-align:right">'+v.trainDateCount+'</td><td style="text-align:left">'+v.projectSell+'</td><td style="text-align:right">'+v.traineeCount+'</td><td><input type="hidden" value="'+v.projectStates+'" class="project-state-step">'+v.projectStatesVal+'</td></tr>';$(".noSetProject-page").show();htmlTr=$(htmlTr).data('data',v);htmlTbody.append(htmlTr)})}else{$(".noSetProject-page").hide();htmlTr='<tr style="border:0px;background-color:#fff !important;" ><td colspan="8" align="center" style="border:0px;"><div class="no-data" style="width: 280px;margin: 0 auto;"><img src="../../resources/images/common/no-data.png" alt="" style="padding: 35px 0 20px;"></div></td></tr>';htmlTbody.append(htmlTr)}$yt_baseElement.hideLoading()}else{$yt_baseElement.hideLoading(function(){$yt_alert_Model.prompt("查询失败")})}},isSelPageNum:true })},hideSearch:function(){$(".project-types").niceSelect();var clickTime=0;$(".senior-search-btn").click(function(e){if(clickTime%2==0){$(".search-box").show();$("img.search-put").addClass('flipy')}else{$(".search-box").hide();$("img.search-put").removeClass('flipy')}clickTime+=1;e.stopPropagation()});$(document).click(function(e){clickTime=0;$(".search-box").hide();$("img.search-put").removeClass('flipy');e.stopPropagation()});$(".search-box .yt-model-sure-btn").click(function(){noSetProjectList.getNoProjectApprovalList()});$(".search-box .yt-model-reset-btn").click(function(){$(".search-box .project-types").setSelectVal('')})}};$(function(){noSetProjectList.init()});