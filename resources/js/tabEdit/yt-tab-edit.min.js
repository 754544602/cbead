var tabEdit={selTestData:[{"name":"String"},{"name":"Long"},{"name":"Boolean"}],addTabDatas:[],addTabJsons:"",updateTabDatas:[],updateTabJsons:"",tabHeardHandleEvent:function(){$(".heard-handel-model .left-handle").off("click").on("click",function(){var handelHidFlag=$(this).find(".hid-flag").val();var thisTbody=$(this).parent().next().find("tbody");var lastTr=thisTbody.find("tr").eq(thisTbody.find("tr").length-1);if(handelHidFlag==1){$(this).find(".left-handle-font").text("保存");$(this).find(".edit-title-icon").attr("src","./resources/images/icons/look-save.png");$(this).find(".hid-flag").val(2);$(this).next().css("display","inline-block");if(thisTbody.find("tr").hasClass("no-data-tr")){thisTbody.find(".no-data-tr").remove()}thisTbody.find(".last-tr-add").remove();if(!thisTbody.hasClass("last-tr-add")){var thNum=thisTbody.prev().find("th").length;var addStr=$('<tr class="last-tr-add"><td align="center" colspan="'+thNum+'"><img class="tr-add-icon" src="./resources/images/icons/tab-add.png"/></td></tr>');thisTbody.append(addStr);addStr.off().on("click",function(){var addFlag=true;var lastPrevTr=$(".last-tr-add").prev();if(thisTbody.find("tr").length>1){thisTbody.find("tr:not(.last-tr-add)").each(function(i,n){if($(n).find("input").val()==""&&$(n).find("select").val()==""&&$(n).find(".textarea-div").text()==""){$yt_alert_Model.prompt("存在空行未编辑,请检查...");addFlag=false;return}if($(n).find("input").val()==""||$(n).find("select").val()==""||$(n).find(".textarea-div").text()==""){$yt_alert_Model.prompt("请填写完整信息");addFlag=false;return}});}if(addFlag){tabEdit.addTabRow(thisTbody)}})}if(thisTbody.find("tr.last-tr-null").find("input:not([type='checkbox'])").val()==""&&thisTbody.find("tr.last-tr-null").find("select").val()==""&&thisTbody.find(".textarea-div").text()==""){thisTbody.find("tr:not(.last-tr-null)").find(".td-text").hide();thisTbody.find("tr:not(.last-tr-null)").find(".td-val").css("display","inline-block")}else{thisTbody.find("tr").find(".td-text").hide();thisTbody.find("tr").find(".td-val").css("display","inline-block")}thisTbody.parent().find(".handle-td").css("display","table-cell")}if(handelHidFlag==2){debugger;if(thisTbody.find("tr").length==1){if(lastTr.find("input:not([type='checkbox'])").val()==""&&lastTr.find("select").val()==""&&lastTr.find(".textarea-div").text()==""){$yt_alert_Model.prompt("请填写完整信息");return false}}var trFlag=true;$.each(thisTbody.find("tr:not(.last-tr-null,.last-tr-add)"),function(i,n){if($(n).find("td:eq(0) input").val()==""&&$(n).find("td:eq(1) select").val()==""&&$(n).find("td:eq(3) input").val()==""&&$(n).find("td:eq(4) .textarea-div").text()==""){$(n).remove();return}if($(n).find("td:eq(0) input").val()==""||$(n).find("td:eq(1) select").val()==""||$(n).find("td:eq(3) input").val()==""||$(n).find("td:eq(4) .textarea-div").text()==""){$yt_alert_Model.prompt("请填写完整信息");trFlag=false;return}});if(trFlag){if(lastTr.prev().hasClass("last-tr-null")){if(lastTr.prev().find("input:not([type='checkbox'])").val()==""&&lastTr.prev().find("select").val()==""&&lastTr.prev().find(".textarea-div").text()==""){lastTr.prev().remove()}else if(lastTr.prev().find("input:not([type='checkbox'])").val()==""||lastTr.prev().find("select").val()==""||lastTr.prev().find(".textarea-div").text()==""){$yt_alert_Model.prompt("请填写完整信息");return}}if(thisTbody.find("tr td:eq(0) input").val()!=""&&thisTbody.find("tr td:eq(0) select").val()!=""&&thisTbody.find("tr td:eq(3) input").val()!=""&&thisTbody.find("tr td:eq(4) .textarea-div").text()!=""){$(this).find(".left-handle-font").text("修改");$(this).find(".edit-title-icon").attr("src","./resources/images/icons/blue-edit.png");$(this).find(".hid-flag").val(1);thisTbody.find(".last-tr-add").remove();$(this).next().hide();$.each(thisTbody.find("tr .is-null-text").next().find("label"),function(i,n){if($(n).hasClass("check")){$(n).parent().prev().text("允许")}else{$(n).parent().prev().text("不允许")}});$.each(thisTbody.find("tr .desc-val"),function(i,v){$(v).parent().prev().text($(v).text())});thisTbody.find("tr").find(".td-text").css("display","inline-block");thisTbody.find("tr").find(".td-val").hide();lastTr.find("td").eq(lastTr.find("td").length-1).html('<span class="entry-del-icon"><img src="./resources/images/icons/t-del.png" class="table-add"></span>');tabEdit.setSpanVal(thisTbody);thisTbody.find(".del-tr").remove()}else{if(thisTbody.find("tr").length!=1&&!thisTbody.find("tr").hasClass("last-tr-add")){$yt_alert_Model.prompt("请填写完整信息");return false}else{thisTbody.find(".last-tr-add td").attr("colspan",5);$(this).find(".left-handle-font").text("修改");$(this).find(".edit-title-icon").attr("src","./resources/images/icons/blue-edit.png");$(this).find(".hid-flag").val(1);$(this).next().hide()}}if(thisTbody.find("tr").length==0){var noTr='<tr class="no-data-tr"><td colspan="5" align="center">暂无参数</td></tr>';thisTbody.append(noTr)}thisTbody.find("tr").removeClass("last-tr-null");thisTbody.parent().find(".handle-td").hide()}}tabEdit.canelEdit()})},canelEdit:function(){$(".heard-handel-model .right-handle").off("click").on("click",function(){$(this).prev().find(".left-handle-font").text("修改");$(this).prev().find(".edit-title-icon").attr("src","./resources/images/icons/blue-edit.png");$(this).prev().find(".hid-flag").val(1);$(this).hide();var thisTbody=$(this).parent().next().find("tbody");var lastTr=thisTbody.find("tr").eq(thisTbody.find("tr").length-1);thisTbody.find(".last-tr-add").remove();thisTbody.find("tr").each(function(i,n){if($(n).find(".td-text").text()==""){$(n).remove()}});thisTbody.find("tr").find(".td-text").css("display","inline-block");thisTbody.find("tr").find(".td-val").hide();if(thisTbody.find("tr").length==0){var noTr='<tr class="no-data-tr"><td colspan="5" align="center">暂无参数</td></tr>';thisTbody.append(noTr)}thisTbody.parent().find(".handle-td").hide();thisTbody.find(".del-tr").css("display","table-row")})},setSpanVal:function(thisTbody){$(thisTbody).find("tr input[type='text'],tr select").each(function(i,n){$(n).parent().prev().text($(n).val())})},addTabRow:function(obj){var flag=0;if(obj==undefined||obj==""){$('.edit-tab tbody').on('click','.add-icon',function(){flag=1;tabEdit.addRow($(this).parent().parent().parent(),flag)})}else{tabEdit.addRow(obj,flag)}},addRow:function(obj,flag){var opts='<option value="">请选择</option>';$.each(tabEdit.selTestData,function(i,n){opts+='<option value="'+n.name+'">'+n.name+'</option>'});var trStr='<tr><td align="center"><span class="td-text name-text" data-text="parameterName"></span><span class="td-val"><input type="text" class="yt-input name-val" placeholder="" style="width:220px;" /></span></td><td align="center"><span class="td-text type-text" data-text="parameterType"></span><span class="td-val"><select name="" class="yt-select type-val">'+opts+'</select></span></td><td align="center"><span class="td-text is-null-text" data-text="isCanBeNull"></span><span class="td-val"><label class="check-label yt-checkbox"><input class="checkbox-inpu" type="checkbox" name="test" value=""/></label></span></td><td align="center"><span class="td-text len-text" data-text="parameterLength"></span><span class="td-val"><input type="text" class="yt-input len-val" value="" style="width: 66px;"/></span></td><td align="center"><span class="td-text desc-text" style="text-align: left;" data-text="parameterDesc"></span><span class="td-val"><div class="textarea-div desc-val" contenteditable="true"><br /></div></span></td>';if(flag==1){trStr+='<td align="center" class="handle-td"><span class="add-icon"><img src="./resources/images/icons/t-add.png" class="table-add"></span></td>'}else{trStr+='<td align="center" class="handle-td"><span class="entry-del-icon"><img src="./resources/images/icons/t-del.png" class="table-add"></span></td>'}trStr+= +'</tr>';var addElement=$(trStr);addElement.find(".add-icon").on("click",function(){if(addElement.find("input").val()!=""&&addElement.find("select").val()!=""){tabEdit.addRow(addElement.parent(),1)}else{$yt_alert_Model.prompt("请填写完整信息");return false}});addElement.find("select").niceSelect();var lastStr=$(obj).find("tr").eq($(obj).find("tr").length-1);if(flag==1){lastStr.after(addElement);addElement.prev().find(".handle-td").html('<span class="entry-del-icon"><img src="./resources/images/icons/t-del.png" class="table-add"></span>')}else{lastStr.before(addElement)}tabEdit.delTabRwo();$(".len-val").off().on("keyup",function(){$(this).val($(this).val().replace(/[^\d]/g,''))});addElement.find(".checkbox-inpu").setRadioState(true)},delTabRwo:function(){$(".edit-tab tbody").find(".entry-del-icon").click(function(){var tr=$(this).parent().parent();$yt_alert_Model.alertOne({haveAlertIcon:false,closeIconUrl:"",leftBtnName:"确定",rightBtnName:"取消",cancelFunction:"",alertMsg:"数据删除将无法恢复,确认删除吗?",confirmFunction:function(){tr.hide();tr.addClass("del-tr")}})})},getEditTabData:function(){var dataList=[{"parameterName":"PKId","parameterType":"Long","isCanBeNull":"YES","parameterLength":"10","parameterDesc":"主键Id"},{"parameterName":"userName","parameterType":"String","isCanBeNull":"NO","parameterLength":"30","parameterDesc":"用户姓名"},{"parameterName":"userCode","parameterType":"String","isCanBeNull":"YES","parameterLength":"10","parameterDesc":"用户code值"}];if(dataList.length>0){tabEdit.setInputParamsOutParamsVal($(".update-tab tbody"),dataList)}else{$(".update-tab tbody").empty();var noTr='<tr class="no-data-tr"><td colspan="5" align="center">暂无参数</td></tr>';$(".update-tab tbody").append(noTr);if($(".update-tab tbody").find(".no-data-tr")){$(".update-tab .handle-td").hide()}}$(".update-tab").prev().find(".left-handle-font").text("修改");$(".update-tab").prev().find(".edit-title-icon").attr("src","./resources/images/icons/blue-edit.png");$(".update-tab").prev().find(".hid-flag").val(1)},setInputParamsOutParamsVal:function(tbodyFlag,dataList){$(tbodyFlag).empty();$(tbodyFlag).parent().prev().show();var tabTr="";$.each(dataList,function(i,n){tabTr='<tr><td align="center"><span class="td-text name-text" data-text="parameterName">'+n.parameterName+'</span><span class="td-val"><input type="text" class="yt-input name-val" value="'+n.parameterName+'" placeholder="" style="width:220px;" /></span></td><td align="center"><span class="td-text type-text" data-text="parameterType">'+n.parameterType+'</span><span class="td-val"><select name="" class="yt-select type-val">';tabTr+='<option value="">请选择</option>';$.each(tabEdit.selTestData,function(v,t){if(t.name==n.parameterType){tabTr+='<option value="'+t.name+'" selected="selected">'+t.name+'</option>'}else{tabTr+='<option value="'+t.name+'">'+t.name+'</option>'}});tabTr+='</select></span></td><td align="center"><span class="td-text is-null-text" data-text="isCanBeNull">'+(n.isCanBeNull=="YES"?"允许":"不允许")+'</span><span class="td-val"><label class="check-label yt-checkbox '+(n.isCanBeNull=="YES"?"check":"")+'"><input class="checkbox-inpu" type="checkbox" name="test" value="" checked="'+(n.isCanBeNull=="YES"?"checked":"")+'"/></label></span></td><td align="center"><span class="td-text len-text" data-text="parameterLength">'+n.parameterLength+'</span><span class="td-val"><input type="text" class="yt-input len-val" value="'+n.parameterLength+'" style="width: 66px;" /></span></td><td align="center"><span class="td-text desc-text" style="text-align: left;" data-text="parameterDesc">'+n.parameterDesc+'</span><span class="td-val"><div class="textarea-div desc-val" contenteditable="true">'+n.parameterDesc+'</div></span></td>';tabTr+='<td  align="center" class="handle-td"><span class="entry-del-icon"><img src="./resources/images/icons/t-del.png" class="t-del.png"></span></td></tr>';tbodyFlag.append(tabTr)});tbodyFlag.find("tr:not(.last-tr-null)").find(".td-text").css("display","inline-block");tbodyFlag.find("tr:not(.last-tr-null)").find(".td-val").hide();tbodyFlag.find("select.type-val").niceSelect();tbodyFlag.parent().find(".handle-td").hide();tabEdit.delTabRwo();$(".len-val").off().on("keyup",function(){$(this).val($(this).val().replace(/[^\d]/g,''))})},getParamsType:function(){$(".edit-tab tbody select.type-val");$(".edit-tab tbody select.type-val").replaceWith('<select name="parameterType" class="yt-select type-val"><option value="">请选择</option></select>');if(tabEdit.selTestData!=""&&tabEdit.selTestData!=null){$.each(tabEdit.selTestData,function(i,n){$(".edit-tab tbody select.type-val").append('<option value="'+n.name+'">'+n.name+'</option>')})}$(".edit-tab tbody select.type-val").niceSelect()},clickTrAdd:function(){$(".last-tr-add").off().on("click",function(){var addFlag=true;var lastPrevTr=$(this).prev();if($(this).parent().find("tr").length>1){$(this).parent().find("tr:not(.last-tr-add)").each(function(i,n){if($(n).find("input").val()==""&&$(n).find("select").val()==""&&$(n).find(".textarea-div").text()==""){$yt_alert_Model.prompt("存在空行未编辑,请检查...");addFlag=false;return false}if($(n).find("input").val()==""||$(n).find("select").val()==""||$(n).find(".textarea-div").text()==""){$yt_alert_Model.prompt("请填写完整信息");addFlag=false;return false}});}if(addFlag){tabEdit.addTabRow($(this).parent())}})}};$(function(){$(".edit-tab select").niceSelect();$(".edit-tab .checkbox-inpu").setRadioState(true);$(".edit-tab .checkbox-inpu").setRadioState(true);tabEdit.getParamsType();tabEdit.addTabRow();tabEdit.tabHeardHandleEvent();tabEdit.getEditTabData();tabEdit.clickTrAdd();tabEdit.canelEdit()});